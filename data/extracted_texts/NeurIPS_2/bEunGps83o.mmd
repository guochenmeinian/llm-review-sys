# Fair Allocation in Dynamic Mechanism Design

Alireza Fallah

University of California, Berkeley

afallah@berkeley.edu

&Michael I. Jordan

University of California, Berkeley and INRIA, Paris

jordan@cs.berkeley.edu

&Annie Ulichney

University of California, Berkeley

annie_ulichney@berkeley.edu

###### Abstract

We consider a dynamic mechanism design problem where an auctioneer sells an indivisible good to two groups of buyers in every round, for a total of \(T\) rounds. The auctioneer aims to maximize their discounted overall revenue while adhering to a fairness constraint that guarantees a minimum average allocation for each group. We begin by studying the static case (\(T=1\)) and establish that the optimal mechanism involves two types of subsidization: one that increases the overall probability of allocation to all buyers, and another that favors the group which otherwise has a lower probability of winning the item. We then extend our results to the dynamic case by characterizing a set of recursive functions that determine the optimal allocation and payments in each round. Notably, our results establish that in the dynamic case, the seller, on the one hand, commits to a participation reward to incentivize truth-telling, and, on the other hand, charges an entry fee for every round. Moreover, the optimal allocation once more involves subsidization in favor of one group, where the extent of subsidization depends on the difference in future utilities for both the seller and buyers when allocating the item to one group versus the other. Finally, we present an approximation scheme to solve the recursive equations and determine an approximately optimal and fair allocation efficiently.

## 1 Introduction

Auctions play a pivotal role in allocation decisions across various domains, serving as a structured methodology for determining the distribution of resources based on bids. Housing, government contracts, electromagnetic spectrum rights, and advertising slots are a few of the many domains where allocations are determined by auctions. In many of the real-world applications of auction-based allocations, the resource in question is both valuable and limited, which raises concerns about fairness.

For instance, housing auctions are often governed by policies addressing the needs of low- and moderate-income households, such as Affordable Housing Quotas in the United Kingdom to tax credits and vouchers in the United States . Government procurement contracts for goods and services in the United States are subject to the United States Small Business Act which outlines target contracting rates across categories (e.g., woman-owned businesses, veteran-owned businesses, historically underutilized zones) . The United States Federal Communications Commission drives initiatives ensuring, for instance, that small and regional companies maintain reasonable access to connectivity .

The importance of incorporating a consideration of fairness in important real-world use cases motivates recent work that extends classical work on auction design emphasizing economic efficiency to ensure outcomes do not disproportionately favor some bidders over others. Integrating fairnessinto auction designs is, however, a source of significant complexity, given that buyers often have different valuations, which can lead to strategic bidding behavior that may skew fairness.

In this paper, we focus on studying the question of fairness in a dynamic mechanism design setting, where a seller allocates an indivisible item through an auction at every round and for \(T\) rounds to two groups of buyers, each group including \(n\) buyers. At each round, the buyers' values are realized independently from an underlying distribution (which may differ between the two groups), and the buyers then submit their bids. The seller's goal is to decide on an allocation rule as a function of the submitted bids that maximizes their total discounted revenue with a discount factor \(\), while ensuring that each group receives a minimum allocation, or more specifically, that group \(i\)'s average discounted allocation is greater than or equal to some \(_{i}\).

This fairness constraint enforces a proportional notion of fairness regarding the number of items each group wins. There are several advantages to adopting such a fairness notion. First, it is typically more straightforward from a policy perspective compared to, for instance, focusing on the total value won by each group. For example, most regulations concerning fair housing allocation emphasize the percentage of housing allocated to low-income groups as a measure of success . Moreover, a buyer's value in private-value auctions is not solely determined by the intrinsic value of the item but also depends on the financial constraints of the buyers or asymmetric information about the item's value. Therefore, a proportional fairness constraint is a suitable choice in cases where one group's values are systematically lower than another's. For example, in the context of housing allocation, low-income individuals may assign lower monetary value to homes compared to wealthier individuals, as they are more concerned with basic shelter than with investment or resale value. In such scenarios, the allocation ratio is a more effective approach to mitigate allocation inequality compared to using buyers' value.

We start by considering the static case with \(T=1\). In the unconstrained case, it is well-known that the optimal allocation is the second-price auction with a reserve price, which allocates the item to the buyer with the highest bid, conditioned on the bid being above a certain reserve price. Here, we establish that the optimal allocation under the fairness constraint has two main differences: first, the optimal fair mechanism subsidizes one group that would otherwise not meet the target fairness constraint. Second, the optimal allocation may increase the chance of allocating the item to both groups in general by reducing the reserve price (again disproportionately in favor of one group).

We next focus on the general dynamic case. Here, we characterize the optimal allocation through a set of recursive functions. At any round \(t\), we define the _residual minimum allocation_, which, roughly speaking, given the allocation so far, updates the fairness constraint as if we were to start at this round. We establish that, given the residual minimum allocation, we may have to allocate the item to one of the two groups to be on track to satisfy the fairness constraint overall, and that, in this case, we would simply allocate to the highest bidder in the group and charge them the second-highest bid within their group. However, in cases where we have the option to allocate to both groups, the design of the optimal allocation is more complicated because buyers in each group may consider underreporting their value in the current round to keep their chances of winning the item in future rounds higher, especially if they expect their value in future rounds to be higher.

In this case, we establish that, as the above reasoning suggests, there is a utility associated with not winning the item. This utility is the difference between a buyer's expected utility in future rounds if their group does not win the item this round, compared to the scenario where their group wins the item at the current round. We establish that, in the optimal allocation, and to incentivize buyers to report their values truthfully, the seller commits to paying them a participation reward if their group wins the item, and this reward is equal to the aforementioned net utility of not winning the item. On the other hand, the seller charges them an entry fee, which is equal to the expected reward payment that they would miss if they did not participate. Finally, we also prove that the optimal allocation rule is similar to the static case at a high level: when allocating an item to a group, it is assigned to the buyer with the highest bid. Second, the decision regarding which group receives the item takes the form of a subsidy. However, here, the amount of the subsidy depends on the above net utility of not winning the item and the seller's future utility from allocating the item to one group or the other.

As our results so far suggest, finding the optimal allocation requires solving a set of recursive functions, and as we see, the computational complexity could grow exponentially with the number of rounds. Our next contribution is to provide an efficient approximation scheme. In particular, we establish that, for any \(>0\), we can find an allocation that guarantees the same utility to the seller and a fairness constraint of \((1-)(_{i}-)\) for group \(i\). This requires only \((^{-1/(1-)})\)) calls to an oracle that computes integrals. We further provide a constant approximation scheme which requires \((1/(1-))\) calls to the oracle, which is more applicable to scenarios where \(\) is close to one. We conclude our paper by providing a simple numerical experiment to illustrate the impact of the fairness constraint on the utility of both the seller and users.

**Related work:** Our work is related to the growing literature on questions related to fairness in mechanism design [15; 36; 24]. Many works in fair mechanism design with an algorithmic focus draw from notions of fairness central to computer science and machine learning . For instance, a prominent related area of fair algorithmic mechanism design studies frameworks that ensure equity in the distribution of online advertisements across protected user attributes in the setting of online auctions, e.g. [14; 13], and .

Our work is also related to a rich literature on fair division that studies fair allocation without considering the strategic behavior of agents, e.g. [8; 16; 11; 34; 12; 3]. Our work joins the set of works that consider both fairness and incentive compatibility in allocation. Where [25; 9; 12] consider truthful fair allocations with respect to variants of envy-freeness and [7; 6] consider more broadly the feasibility of different notions of fairness in a strategic setting, we join works that adopt a proportional notion of fairness, e.g, [1; 2; 4; 15]. We further depart from these works in our focus on revenue optimization (instead of, e.g., optimizing social welfare ) and in our treatment of the dynamic strategic environment.

Another group of related works studies the impact of budgetary and liquidity constraints on auction revenue, e.g. , and . These works' motivation for considering budget constraints aligns with the setting where fair allocation guarantees are relevant. In particular, both settings drop the assumption that a bidder's valuation is accurately reflected by their willingness to pay. The setting of asymmetric budgetary constraints studied by  motivates the relevance of our work's introduction of guarantees for relative allocative fairness between groups. We build upon this set of work by introducing a framework where the allocative limitations of both homogeneous and heterogeneous budget constraints can be simultaneously overcome as efficiently as possible. A separate set of related works empirically studies the impact on efficiency of subsidizing targeted groups of bidders in procurement auctions [23; 5]. These works complement ours by pointing to bid subsidies as the cost-optimal mechanism to enforce fairness.

The closest setting to ours is that of  which examines a similar notion of fairness in the single-round (static) case, but only for one group. We depart from their work as we consider the dynamic case and present an approximation scheme. Additionally, even in the static case, we consider a minimum allocation constraint for both groups, which introduces a second type of subsidization.

## 2 Model

We consider a monopolist seller that interacts with two groups of buyers over \(T\) rounds,1 with \(n\) buyers in each group.2 At each round \(t[T]\),3 the seller conducts an auction to sell a single indivisible item. The private value of buyer \(k[n]\) from group \(i\) (or simply, buyer \((i,k)\)) for this item is denoted by \(v^{t}_{i,k}\), which is drawn from the publicly known and full support continuous distribution with density \(f^{t}_{i}:[v^{t}_{i},^{t}_{i}]\). We also denote its cumulative distribution function by \(F^{t}_{i}()\). We assume the buyers' values are independent.

**Timeline of the auction:** At each time \(t\), buyers' private values are realized, and then each buyer \((i,k)\) submits a bid \(b^{t}_{i,k}\). We denote the vector of bids at round \(t\) by \(^{t}\). The seller then conducts the auction and decides on the allocation \(^{t}(^{t},^{t})\) where \(^{t}\) denotes the public history of allocations up to (but not including) time \(t\), i.e., which buyers received the items in the previous \(t-1\) rounds. In particular, \(x^{t}_{i,k}(^{t},^{t})\{0,1\}\) denotes whether the \(k\)th buyer in group \(i\) gets the item in round \(t\). Notice that since we allocate a single item at each round, we should have \(_{i=1}^{2}_{k=1}^{n}x^{t}_{i,k}(^{t},^{t}) 1\) for every \(t[T]\). Finally, buyer \((i,k)\) makes the payment \(p^{t}_{i,k}(^{t},^{t})\)to the seller. The vector of payments at time \(t\) is denoted by \(^{t}(^{t},^{t})\). Notice that the mechanism is determined by the allocation and payment functions \((^{1:T},^{1:T})\).

Utility functions:The utility function of buyer \((i,k)\) at time \(t\) is given by \(^{t}_{i,k}(v^{t}_{i,k};^{t},^{t}):=x^{t}_{i,k}(^{t},^{t})v^{t}_{i,k}-p^{t}_{i,k}(^{t},^{t})\). Buyer \((i,k)\) and seller's overall utilities are, respectively, given by:

\[_{i,k}(^{1:T}_{i,k};^{1:T},^{1:T}):=_{t=1}^{T }^{t-1}^{t}_{i,k}(v^{t}_{i,k};^{t},^{t})_{0}(^{1:T},^{1:T}):=_{t=1}^{T}^{t-1}_{(i,k)}p^{t}_{i,k}(^{t},^{t}) \]

where \((0,1]\) is the discount factor. Our goal is to identify mechanisms that maximize the seller's expected utility, subject to certain fairness constraints ensuring a minimum allocation is guaranteed to each group. We next formally define these fairness constraints.

The fairness constraint:The seller, acting as the auctioneer, aims to ensure that a minimum allocation is guaranteed to each group in this dynamic setting. More specifically, let \(_{i}\) represent the minimum (discounted) average allocation promised to group \(i\), with the condition that \(_{1}+_{2} 1\). Then, at each round \(t\), the seller ensures that the discounted average of the items allocated to group \(i\) thus far, combined with the expected allocation in the remaining rounds, is at least \(_{i}\):

\[}(_{r=1}^{t-1}^{-1}_{k=1}^{ n}x^{}_{i,k}+[_{r=t}^{T}^{-1}_{k=1}^{n}x^{ }_{i,k}])_{i}, \]

where the expectation is taken over the realization of the private values at time \(t\) and the future rounds. We call the auction _infeasible_ at round \(t\) if it is not possible to satisfy the fairness constraint over the remaining rounds.

Notice that this condition is ex ante with respect to the allocation at time \(t\) onwards as we find this condition more compatible compared to an ex post fairness in a setting with indivisible goods. Also, it is straightforward to verify that if the condition (2) holds for \(t=T\), then it would hold for any \(t T\). However, as we will elaborate later, this condition determines the set of feasible allocations for any \(t T-1\). For instance, suppose \(T=4\) and \(_{1}=_{2}=1/3\). Then, if we allocate the item to group 1 in the first three rounds, we cannot satisfy condition (2) for group 2 in the last round.

Direct truthful mechanisms:The dynamic revelation principle states that, without loss of generality, we can focus on direct, truthful mechanisms where buyers bidding truthfully is a Nash equilibrium . It is important to note that the dynamic revelation principle requires truthful reporting only on the equilibrium path; that is, assuming all buyers have been truthful in the past. However, in our setting, this would imply truthful reporting under any history, even if a buyer has previously been dishonest (and we are off the equilibrium path). To see why this is the case, note that the utility of each buyer depends on their current (private) value and all past bids (but not on the past true values). Thus, when it is optimal for the buyer to bid truthfully when past reports have been truthful, it remains optimal for them to bid truthfully even if some buyers have lied in the past. This argument generally holds true for Markovian environments (see  for a detailed discussion on this topic.)

In this paper, we use the _periodic ex post incentive compatibility_ (see  for a discussion on this definition and its comparison with the weaker notion of Bayesian incentive compatibility in dynamic mechanism design). More specifically, for any mechanism \((^{1:T},^{1:T})\), the following Markovian decision problem finds the best bid for buyer \(k\) from group \(i\), assuming that all other buyers are reporting their values truthfully:

\[U^{t}_{i,k}(^{t},^{t}):=_{b^{t}_{i,k}}\{^{t}_{ i,k}(v^{t}_{i,k};b^{t}_{i,k},^{t}_{-(i,k)},^{t})+ \ [U^{t+1}_{i,k}(^{t+1},^{t+1})^{t} ]\}, \]

with the convention that \(U^{T+1}_{i,k}(,):=0\). This is a recursive formula in which the buyer identifies the optimal bid by maximizing the sum of their utility at the current moment and the maximum of what they could achieve in the future, while they assume that all other buyers are bidding truthfully. A mechanism is called ex post incentive compatible if the maximum is achieved through truthful bidding. The formal definition is provided below.

**Definition 1**.: _A mechanism \((^{1:T},^{1:T})\) is ex post incentive compatible (EPIC) if:_

\[v^{t}_{i,k}*{arg\,max}_{b^{t}_{i,k}}\{^{t}_{i,k }(v^{t}_{i,k};b^{t}_{i,k},^{t}_{-(i,k)},^{t})+\ [U^{t+1}_{i,k}(^{t+1},^{t+1})^{t} ]\}\  i,k,t,^{t},^{t}. \]Note that the EPIC mechanism can be identified through backward induction, starting at the last round and progressing back to the first. By doing so, at time \(t\), we would realize that maximum utility in future rounds is achieved through truthful bidding. Consequently, the term \(U^{t+1}_{i,k}(^{t+1},^{t+1})\) could be replaced with the utility assuming that everyone reports truthfully. In other words, to identify the EPIC mechanism, it is sufficient to find a mechanism that satisfies the following condition:

\[v^{t}_{i,k}*{arg\,max}_{b^{t}_{i,k}}\{^{t}_{i,k }(v^{t}_{i,k};b^{t}_{i,k},^{t}_{-(i,k)},^{t})+\ [_{=t+1}^{T}^{}_{i,k}(v^{}_{i,k};^{},^{})^{t}]\}. \]

Finally, we state the individual rationality assumption or the participation condition. This assumption ensures that, at each round, each buyer (knowing only their value) would weakly prefer to participate in the auction. In other words, each buyer's expected utility is weakly higher if they participate rather than choosing their outside option, which is skipping that round.

**Definition 2**.: _A mechanism \((^{1:T},^{1:T})\) is individually rational (IR) if for all \(i,k,t,v^{t}_{i,k}\), and \(^{t}\):_

\[[U^{t}_{i,k}(^{t},^{t})]\ [U^{t+1}_{i,k}(^{t+1},(^{t})^{t+1})^{t} ], \]

_where \((^{})^{t+1}\) denotes the history under which buyer \((i,k)\) has not participated at round \(t\), and the expectations are taken over \(^{t}_{-(i,k)}\) and \(^{t+1:T}\).4_

The left hand side of (6) demonstrates the expected utility of buyer \((i,k)\) at time \(t\) and thereafter, assuming their participation in round \(t\). However, the right hand side of (6) shows the expected utility of buyer \((i,k)\) when they skip the \(t\)-th round (and receive no utility in the \(t\)-th round).

Throughout our analysis, we adopt the following regularity assumption on the distribution of values that is common in mechanism design literature. This assumption applies to a variety of distributions, including uniform, exponential, and normal distributions.5

**Assumption 1**.: _For any \(i\) and \(t\), the distribution \(F^{t}_{i}\) is regular, i.e., the virtual value function \(^{t}_{i}(v):=v-_{i}(v)}{f^{t}_{i}(v)}\) is increasing in \(v\)._

For the rest of the paper, our goal is to find an EPIC and IR mechanism \((^{1:T},^{1:T})\) that maximizes the expected seller utility subject to the fairness constraint (2). We start our analysis by discussing the static case, i.e., \(T=1\), which will be used in our analysis for the dynamic setting.

## 3 The static case

To simplify the notation, we drop the dependence of the parameters on time \(t\) in this section. Here, our fairness constraint (2) reduces to \([_{k=1}^{n}x_{i,k}]_{i},\) where the expectation is taken over a single realization of the private values.

It is well-known that in the absence of the fairness constraint, and under Assumption 1, the item is allocated to the buyer who has the highest virtual value, provided that at least one buyer's virtual value is non-negative. Conversely, the seller does not allocate the item if all virtual values are negative. This mechanism is known as the second-price auction (or Vickrey auction) with reserve pricing, as detailed in . This allocation is depicted in Figure 0(a). We next present the main result of this section which establishes the optimal allocation under the fairness constraint.

**Theorem 1**.: _Suppose Assumption 1 holds. For any \(i\), let \(v_{i}:=_{k}v_{i,k}\) be the maximum value among buyers in group \(i\). Then, the following results hold for the optimal allocation:_

1. _If the item is allocated to group_ \(i\)_, then it is allocated to the buyer in group_ \(i\) _with the highest value, i.e., if_ \(x_{i,k}=1\)_, then_ \(v_{i,k}=v_{i}\)

[MISSING_PAGE_FAIL:6]

The dynamic case

We next turn our attention to the dynamic case. Here, our main approach involves using backward induction. The analysis from the previous section serves as the basis for the optimal allocation at the last round, i.e., \(t=T\). In this section, we describe how we proceed backward to find the optimal dynamic auction under the fairness constraint. We make the following assumption which simplifies the characterization of the optimal mechanism and allows us to focus on the insights. In the appendix, we discuss how our analysis extends to cases where this assumption does not hold.

**Assumption 2**.: _We assume the seller must allocate the item in any round, except possibly the last._

We start our analysis by making a number of definitions and observations. Suppose we are at the beginning of round \(t\). Given (2), our allocation at round \(t\) and the future rounds should satisfy the following constraint:

\[_{=t}^{T-1}^{-t}_{k=1}^{n}x_{i,k}^{}+ ^{T-t}[_{k=1}^{n}x_{i,k}^{T}] R_{i}^{t}:= }(}{1-}_{i}-_{ =1}^{t-1}^{-1}_{k=1}^{n}x_{i,k}^{}), \]

We refer to the right-hand side as the _residual minimum allocation_ for group \(i\). It is noteworthy that equation (8) can be interpreted as if the auction is starting at time \(t\), with the fairness constraint given by \(R_{i}^{t}(1-)/(1-^{T-t})\). We next make the following simple observation:

**Fact 1**.: _Given the allocation at time \(t\), the residual minimum allocation at time \(t+1\), i.e., \(R_{i}^{t+1}\), is equal to \((R_{i}^{t}-1)\) when the item is allocated to group \(i\) and equal to \(R_{i}^{t}\) otherwise._

We next introduce two interim functions. For the sake of these two definitions, assume the auction starts at time \(t\), i.e., the utility at any time \(\), for \( t\), is discounted by a factor of \(^{-t}\). With this assumption, and for a given pair of residual minimum allocations \((R_{1}^{t},R_{2}^{t})\), we define \(^{t}(R_{1}^{t},R_{2}^{t})\) as the (discounted) sum of the expected utility of the seller at time \(t\) and thereafter, under the optimal mechanism satisfying equation (8), prior to the realization of values. Similarly, \(_{i}^{t}(R_{1}^{t},R_{2}^{t})\) represents the expected utility of a buyer in group \(i\). It is worth noting that, given the distribution of values within each group is similar, \(_{i}^{t}\) does not depend on \(k\) (the buyer's index within the group). We also set the these functions equal to \(-\) if there is no feasible auction satisfying (8). The following result regarding \(_{i}^{T}(,)\) and \(^{T}(,)\) is a corollary of Theorem 1. Notice that the last round can be seen as a static auction with fairness constraint for group \(i\) given by \(R_{i}^{T}\).

**Corollary 1**.: _At round \(T\), and for a given pair of residual minimum allocations \((R_{1}^{T},R_{2}^{T})\), we have_

\[_{i}^{T}(R_{1}^{T},R_{2}^{T}) =_{G_{i}}^{T}(v_{i})}{f_{i}^{T}(v_{i} )}dF_{}^{T}(v_{1},v_{2}), \] \[^{T}(R_{1}^{T},R_{2}^{T}) =_{G_{1}}_{1}^{T}(v_{1})dF_{}^{T}(v_{1},v_{2})+ _{G_{2}}_{2}^{T}(v_{2})dF_{}^{T}(v_{1},v_{2}), \]

_where \(F_{}^{T}(v_{1},v_{2})=F_{1}^{T}(v_{1})^{n}F_{2}^{T}(v_{2})^{n}\) and \(G_{i}\)'s are defined in Theorem 1._

This corollary is proved in the appendix. Now, suppose we are in the \(t\)-th round, conducting the backward induction. Consequently, we have access to \(_{i}^{t+1}(,)\) (for \(i\)) and \(^{t+1}(,)\). Next, we will establish the optimal allocation for round \(t\) and describe how to compute \(_{i}^{t}(,)\) and \(^{t}(,)\) accordingly. We have three main regimes:

(I) When the auction is infeasible:Suppose that no matter whether the seller gives the item to the first or second group, they would not be able to satisfy the residual minimum allocation constraint in the remaining rounds. In this case, we declare the auction is infeasible at round \(t\).

**Fact 2**.: _For a given pair of residual minimum allocations \((R_{1}^{t},R_{2}^{t})\), suppose we have \(^{t+1}((R_{1}^{t}-1)/,R_{2}^{t}/)\) and \(^{t+1}(R_{1}^{t}/,(R_{2}^{t}-1)/)=-\). Then, there is no feasible auction satisfying the residual minimum allocation constraints, and hence, we set \(^{t}(R_{1}^{t},R_{2}^{t})\) and \(_{i}^{t}(R_{1}^{t},R_{2}^{t})\), for both \(i\), equal to \(-\)._

To better highlight this proposition, let us consider a simple example. Suppose \(T=2\), \(=0.5\), and \(_{1}=_{2}=0.4\). In this scenario, \(R_{1}^{1}=R_{2}^{1}=0.6\). Now, the residual minimum allocation for the second round for the group that doesn't receive the item in the first round would be \(1.2\), which is not feasible. Hence, there is no feasible auction that satisfies the fairness constraint.

(II) When the item must be allocated to a certain group:Suppose, for instance, that if the seller allocated the item to the second group, they would not be able to satisfy the resulting residual minimum allocation constraints in the remaining rounds. However, allocating the item to the first group would result in a feasible auction. Therefore, in this case, the seller must allocate the item (if keeping it were feasible, then allocating it to the second group would also have been feasible), and moreover, the item must be allocated to the first group. The following result formalizes the optimal allocation for this scenario.

**Proposition 2**.: _Suppose Assumption 1 holds. For a given pair of residual minimum allocations \((R_{1}^{t},R_{2}^{t})\) and some \(i\), suppose we have \(^{t+1}(R_{i}^{t}/,(R_{-i}^{t}-1)/)=-\) but \(^{t+1}((R_{i}^{t}-1)/,R_{-i}^{t}/)>-\). Then, the seller allocates the item to the buyer with the highest value in group \(i\), with the payment being equal to the second-highest value within the same group._

Intuitively, if the item must be allocated to the first group, the question of who within that group receives the item essentially boils down to a static Vickrey auction: the buyer offering the highest value acquires the item and pays the price equal to the second highest value in the group. It is important to note that, in this scenario, there is no reserve price (and we do not need to explicitly impose Assumption 2) because the seller is obliged to allocate the item to meet the fairness constraint. Lastly, the update of interim functions are provided in Appendix A.4.1.

(III) When allocation to both groups is feasible:Suppose that whether the seller allocates the item to the first or second group, they still have the opportunity to meet the allocation constraint in future rounds. Now, what should be the seller's allocation strategy to maximize their utility?

Note that the expected utility of buyers in each group changes based on whether or not they receive the item in the current round. The difference between these two scenarios can be interpreted as the expected utility of not receiving the item. More formally, for a given pair of residual minimum allocations \((R_{1}^{t},R_{2}^{t})\), and when allocation to both groups is feasible, the net utility of not receiving the item for group \(i\) is defined as

\[_{i}^{t}(R_{1}^{t},R_{2}^{t}):=_{i}^{t+1}(R_{i}^{t}/,(R_{-i}^{t }-1)/)-_{i}^{t+1}((R_{i}^{t}-1)/,R_{-i}^{t}/). \]

It is worth noting that, interestingly, the net utility of not receiving the item could be negative in some case (See Appendix A.5). Lastly, we define \(_{0}^{t}(R_{1}^{t},R_{2}^{t})\) as the difference in seller's future utility by allocating the item to the first group, compared to allocating it to the second group, i.e.,

\[_{0}^{t}(R_{1}^{t},R_{2}^{t}):=^{t+1}((R_{1}^{t}-1)/,R_{2}^{t}/ )-^{t+1}((R_{2}^{t}-1)/,R_{1}^{t}/). \]

**Theorem 2**.: _Suppose Assumptions 1 and 2 hold. For a given pair of residual minimum allocations \((R_{1}^{t},R_{2}^{t})\), suppose both \(^{t+1}(R_{1}^{t}/,(R_{2}^{t}-1)/)\) and \(^{t+1}((R_{1}^{t}-1)/,R_{2}^{t}/)\) are finite. Then, the seller allocates the item to the buyer with the highest value in group \(i\) if \((v_{1}^{t},v_{2}^{t}) G_{i}^{t}\), where \(v_{j}^{t}:=_{k}v_{j,k}^{t}\) is the maximum value among buyers in group \(j\) and \(G_{i}^{t}\) is given by_

\[G_{i}^{t}:=(v_{1},v_{2})\,\,_{i}^{t}(v_{i})-_{-i}^{t}(v_ {-i}) n\,_{i}^{t}(R_{1}^{t},R_{2}^{t})-_{-i}^{t}(R _{1}^{t},R_{2}^{t})+(-1)^{i}_{0}^{t}(R_{1}^{t},R_{2}^{t}) }.\]

_Moreover, let \(i^{*}\) denote the index of the winner group. Then, the payment of buyer \((i,k)\) is given by_

\[v_{i,k}^{t}\;x_{i,k}^{t}(v_{i,k}^{t},_{-(i,k)}^{t})-_{_{ i}^{t}}^{v_{i,k}^{t}}x_{i,k}^{t}(z,_{-(i,k)}^{t})dz+_{i}^{t}(R _{1}^{t},R_{2}^{t})(_{i}^{t}-\,(i^{*}=i)), \]

_where \(_{i}^{t}\) denotes the probability of group \(i\) winning the item if the auction runs with \(n-1\) buyers from their group instead of \(n\) buyers._

The explicit characterization of \(_{i}^{t}\)'s along with the update of interim functions are provided in Appendix A.6. It is worth emphasizing that while the term \(_{i}^{t}\) depends on the allocation rule of an auction with \(2n-1\) buyers, we can derive it in a non-recursive manner. The reason is that finding the allocation, similar to \(G_{i}^{t}\) above, does not require running the smaller-size auction. Next, we would like to draw a few insights from this result. First, notice that, similar to the static case, the boundary of allocation rule is a linear function of the maximum virtual values of both group.

Next, note that the payment function consists of three terms. The first term, \(v_{i,k}^{t}\;x_{i,k}^{t}(v_{i,k}^{t},_{-(i,k)}^{t})-_{_{ i}^{t,k}}^{v_{i,k}^{t}}x_{i,k}^{t}(z,_{-(i,k)}^{t})dz\), represents what only the winner pays and is equal to the minimum bid they could have made to still win the item. This is indeed similar to the second-price auction in which the winner's payment is equal to the second highest bid. To better understand the other two terms, and for the sake of discussion, suppose \(_{i}^{t}(R_{1}^{t},R_{2}^{t})\)'s are non-negative, indicating a non-negative net future utility associated with not receiving the item at the current time (because it means your chance of receiving it in the future increases). The second term of the payment function is \(-_{i}^{t}(R_{1}^{t},R_{2}^{t})(i^{*}=i)\), which is negative and thus represents a transfer from the seller to the buyers (we call this _participation reward_). Only the buyers from the group that wins the item receive this payment. To understand why such a reward is needed from the seller, notice that when a buyer's group wins the item, they are in fact losing an amount of \(_{i}^{t}(R_{1}^{t},R_{2}^{t})\) in their future utility because their group has a lower chance of winning in the future. Hence, in some sense, this reduces the value of the item in the current round, and the buyers may find it profitable to underreport their value. That said, this payment serves to incentivize truthful reporting. Finally, the last term in the payment function is \(_{i}^{t}(R_{1}^{t},R_{2}^{t})_{i}^{t}\), which is a payment that every buyer should make to the seller. The rationale here is that if the buyer skips the current round, then if their group wins, which happens with probability \(_{i}^{t}\), their group would receive a payment equal to \(_{i}^{t}(R_{1}^{t},R_{2}^{t})\) from the seller, as we elaborated above. Hence, the seller charges the same amount as the _entry fee_.

Lastly, notice that in the allocation rule \(G_{i}^{t}\), there is a threshold of \(n(_{i}^{t}(R_{1}^{t},R_{2}^{t})-_{-i}^{t}(R_{1}^{t},R_{ 2}^{t}))+(-1)^{i}_{0}^{t}(R_{1}^{t},R_{2}^{t})\) which determines which group receives the item. Notice that this threshold increases as \(_{i}^{t}(R_{1}^{t},R_{2}^{t})\) increases, meaning that the seller is less willing to give the item to group \(i\). This is because a higher \(_{i}^{t}(R_{1}^{t},R_{2}^{t})\) means that the seller has to make a higher payment to group \(i\)'s buyers if they win. Additionally, this threshold decreases for the first group when \(_{0}^{t}(R_{1}^{t},R_{2}^{t})\) increases, indicating that the seller is more willing to allocate the item to the first group when \(_{0}^{t}(R_{1}^{t},R_{2}^{t})\) is higher. This is intuitive as this term represents the seller's future net utility by allocating the item to the first group compared to allocating it to the second group.

**An approximation scheme:** Our results so far offer an exact characterization of the optimal dynamic allocation. However, due to the recursive nature of the analysis, the computational complexity of this allocation increases exponentially with the number of rounds, \(T\). We conclude this section by discussing efficient methods to find an approximately optimal allocation. Since our focus is not on approximating the integrals here, we assume we have access to an oracle which can compute integrals and solve integral equations.

**Assumption 3**.: _We have access to an oracle that, for any \(i[n]\) and \(t[T]\), can compute the integrals \(_{G}_{i}^{t}(v_{i}^{t}),dF_{}^{t}(v_{1},v_{2})\) and \(_{G}^{t}(v_{i})}{f_{i}^{t}(v_{i})},dF_{}^{t}(v_{1},v _{2})\) with \(F_{}^{t}(v_{1},v_{2})=F_{1}^{t}(v_{1})^{nNotice that the complexity of the approximation given by proposition 3 grows large for \(\) close to 1. Next, we present a second approximation scheme for the case where \(\) is close to one.

**Proposition 4**.: _Suppose Assumptions 1-3 hold and that \(<1\). Then, for a fixed constant \(c<^{2}\), there exists an allocation \(^{}\) with the following properties: \((1)\)\(^{}\) satisfies the fairness constraint for group \(i\) at a level of at least \(c_{i}\), \((2)\)\(^{}\) guarantees that the sellers total utility is at least \(c\) times that of that of the optimal allocation, and \((3)\)\(^{}\) can be computed by calling the oracle Poly \(()\) times where the polynomial's degree and coefficients depend on \(c\)._

This \(^{}\) modifies the approximation \(^{}\) presented in Proposition 3 by introducing a discontinuous discounting technique. In \(^{}\), we partition the first \(T_{0}\) rounds into buckets that use a common approximate discount factor such that the computational complexity of each bucket may be controlled in the same manner as Fact 3. A complete proof as well as a complete proof statement that relates the early stopping approximation with the discounting approximation that can be tuned to achieve an overall approximation level \(c\) can be found in Appendix A.8.

## 5 Experiments

Here, we present the results of a numerical experiment assessing the impact on utilities of varying the fairness constraints of each group. In particular, we implement the case where \(=0.99\), \(n=1\), \(v_{1}^{t}(0.5,1.5)\), and \(v_{2}^{t}(0,1)\) for \(t\) for \(T=2,4\).

For each value of \(T\), we consider combinations of fairness constraints on a discretized grid where \(_{1}\) and \(_{2}\) range over \((0,0.5)\) with increments of \(0.1\). For each pair \(_{1},_{2}\), we calculate the mean difference in utility between the optimal fair allocation at level \(_{1},_{2}\) and the unconstrained optimal allocation satisfying Assumption 2 (i.e., \(_{1},_{2}=0\)), for the seller and buyers over 10,000 iterations of the mechanism. Note that, for these distributions, when \(T=2\) the average unconstrained allocation probabilities are \(0.69\) and \(0.31\) for groups one and two, respectively. The results are reported in Figures 2-3.

We see that the seller utility is decreasing in \(_{1},_{2}\) but only after the point at which the constraints bind. For group one, we see that, for a fixed \(_{1}\), utility is decreasing in \(_{2}\), since, to satisfy the fairness constraint, we re-allocate higher value regions to group two and allocate lower-value regions that would otherwise go unallocated to group one. In contrast, for group two, we see that, for a fixed \(_{2}\), utility is relatively constant in \(_{1}\) since the optimal allocation tends to reallocate to group one from the lower-value no-allocation region.

Figure 3: Difference in utility relative to unconstrained optimal allocation for \(T=4\)

Figure 2: Difference in utility relative to unconstrained optimal allocation for \(T=2\)

Acknowledgements

The authors thank Scott Kominers, Rakesh Vohra, and anonymous reviewers for insightful discussion and comments. Alireza Fallah acknowledges support from the European Research Council Synergy Program, the National Science Foundation under grant number DMS-1928930, and the Alfred P. Sloan Foundation under grant G-2021-16778. The latter two grants correspond to his residency at the Simons Laufer Mathematical Sciences Institute (formerly known as MSRI) in Berkeley, California, during the Fall 2023 semester. Michael Jordan acknowledges support from the Vannevar Bush Faculty Fellowship program under grant number N00014-21-1-2941 and the European Research Council (ERC-2022-SYG-OCEAN-101071601). Annie Ulichney's work is supported by the National Science Foundation Graduate Research Fellowship Program under Grant No. DGE 2146752. Any opinions, findings, and conclusions or recommendations expressed in this material are those of the author(s) and do not necessarily reflect the views of the National Science Foundation or the European Research Council.