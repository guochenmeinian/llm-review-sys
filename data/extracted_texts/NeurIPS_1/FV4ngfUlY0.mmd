# Non-stationary Experimental Design

under Linear Trends

David Simchi-Levi \({}^{@sectionsign}\), Chonghuan Wang \({}^{@sectionsign}\), Zeyu Zheng \({}^{}\)

\({}^{}\) Institute for Data, Systems, and Society, Department of Civil and Environmental Engineering,

Operations Research Center, MIT

\({}^{@sectionsign}\) Laboratory for Information and Decision Systems, MIT

\({}^{}\) Department of Industrial Engineering and Operations Research, University of California, Berkeley

dslevi@mit.edu, chwang9@mit.edu, zyzheng@berkeley.edu

###### Abstract

Experimentation has been critical and increasingly popular across various domains, such as clinical trials and online platforms, due to its widely recognized benefits. One of the primary objectives of classical experiments is to estimate the average treatment effect (ATE) to inform future decision-making. However, in healthcare and many other settings, treatment effects may be non-stationary, meaning that they can change over time, rendering the traditional experimental design inadequate and the classical static ATE uninformative. In this work, we address the problem of non-stationary experimental design under linear trends by considering two objectives: estimating the dynamic treatment effect and minimizing welfare loss within the experiment. We propose an efficient design that can be customized for optimal estimation error rate, optimal regret rate, or the Pareto optimal trade-off between the two objectives. We establish information-theoretical lower bounds that highlight the inherent challenge in estimating dynamic treatment effects and minimizing welfare loss, and also statistically reveal the fundamental trade-off between them.

## 1 Introduction

Experimental design plays a critical role in conducting research across various fields including clinical trials (see, e.g., , , ) and online platforms (see, e.g., , , , ). It enables the evaluation of the effectiveness of treatments, interventions, or policies in a rigorous and systematic manner, protecting the safety and well-being of participants and the wider population. Typically, one of the primary objectives of conducting experiments is to estimate the average treatment effect (ATE), which represents the difference in outcomes between different treatments or controls. The outcomes of each treatment are assumed to be stationary by default (see, e.g., ), ensuring that the information collected and conclusions drawn from in-experiment periods are informative for future decision-making. However, in some situations, ATE may be non-stationary, meaning that it evolves over time. Here, we present one illustrative example from clinical trials to highlight the importance of considering non-stationarity in ATE estimation.

Malaria has been one of the world's deadliest diseases, with approximately 247 million cases and 618 thousand deaths reported in 2021 according to the World Health Organization (WHO). Antimalarial drug resistance in Africa has been highlighted by the world malaria report (see, ) as one the global key events of malaria control and elimination efforts in 2021-2022. _P. falciparum_, the deadliest species of _Plasmodium_ that causes malaria in humans, has shown resistance to first-line treatments such as artemether-lumefantrine (AL), artesunate-amodiaquine (AS-AQ), artesunate-pyronaridine (AS-PY), and dihydroartemisinin-piperaquine (DHA-PPQ) in Africa recently. Alarmingly, at least four recent studies have reported treatment failure rates greater than 10% after treatment with ALin Burkina Faso (see, ) and Uganda (see, ). Two study sites in Burkina Faso also reported treatment failure rates greater than 10% after treatment with DHA-PPQ. These alarming findings underscore the importance of understanding and estimating how the treatment effects evolve over time, i.e., how rapidly drug resistance escalates. Failure to account for non-stationarity in treatment effect may lead to suboptimal treatment plans, harming social welfare.

Given the ubiquity of non-stationarity, ignoring such a structure can lead to misleading information and poor decision-making. Figure 1 provides an illustrative example where non-stationarity can be well captured by linear models. If we use traditional randomized control trials and classical estimators based on sample averages without considering non-stationarity, we may conclude that the treatment is always better than the control. However, the linear non-stationarity implies that we need to pay more attention since the treatment outcomes decrease much faster than the control. This means that the treatment does not always outperform the control during the after-experimental periods. In the context of the drug resistance example, this phenomenon can be interpreted as follows: a new treatment may have a significant positive effect during the experiment, but drug resistance develops much faster than the control. Therefore, we cannot always rely on the treatment after the experiment. Understanding how treatment effects evolve over time is thus crucial for making informed decisions.

In this paper, we focus on the challenge of designing experiments in non-stationary environments. To tackle this problem, we first need to answer the question of _how to formulate non-stationarity_. If there is no underlying structure to the non-stationarity, such as when outcomes are determined by a malicious adversary, then it is not justifiable to conduct experiments because there is little information that we can infer for future decision-making. In this work, we limit our attention to scenarios where potential outcomes follow structured trends. Specifically, we consider situations where outcomes are linear with time, which provides a suitable starting point for research on experimental design under non-stationarity. Such structures also help us to determine meaningful metrics to use instead of the traditional static ATE, since it is no longer informative enough in non-stationary environments. While other ways to formulate non-stationarity can be found in the literature (e.g., ), we carefully argue in Section 1.2 that these traditional formulations may not suffice for our purposes.

In addition to metrics related to the treatment effect, non-stationarity can also increase attention to the welfare loss issue during experiments. Specifically, every time a suboptimal treatment is assigned, there is a welfare loss as the unit could have been treated better with the optimal treatment. In a stationary environment, this welfare loss remains constant over time. However, non-stationarity can lead to an increasing welfare loss over time. Thus, it might not be ideal to ignore the welfare loss during the experiment, particularly when the in-experiment periods are not negligible compared to the after-experiment periods. In this work, we also aim to address _how to control welfare loss during experiments_ and _explore the relationship between minimizing welfare loss and maximizing the statistical power of estimating the dynamic treatment effect_.

### Main results and contribution

The primary contribution of this work is the presentation of a framework that enables experimenters and researchers to design reliable, efficient, and flexible experiments in structured non-stationary environments. To the best of our knowledge, this is the first study of the dynamic treatment effect in the experimental design literature, extending the classical static ATE. We believe that this work could serve as a starting point for further research on designing experiments in non-stationary environments.

We examine what is arguably the most foundational scenario, where the expected potential outcomes of each treatment are represented by linear functions of time \(t\). In this context, the dynamic treatment

Figure 1: An illustrating example of the non-stationarity.

effect can be described by a linear function as well. We introduce a flexible experimental design framework that draws upon the well-established principle of Optimism in the Face of Uncertainty from the online learning literature . Our design can be readily customized to suit various notions of optimality. Specifically, in this work, we systematically explore optimality from three distinct perspectives: optimal estimation error rate, optimal regret rate, and Pareto optimality.

**The optimal estimation error rate design** maximizes statistical power for inferring dynamic treatment effects. We establish a lower bound of \(}\) for the error rate of any estimator, where \(T\) is the total experimental horizon length. Our design achieves this lower bound by selecting appropriate input parameters. **The optimal regret rate design** minimizes in-experiment welfare loss (regret) in the worst case scenario. Traditional regret analysis techniques are not applicable due to unbounded outcomes. Our design achieves an \(\) upper bound for regret rate by selecting input parameters, matching the worst-case lower bound. Linear non-stationarity in our problem may result in a regret rate of \(T^{2}\) without careful design, unlike the stationary setting where regret is bounded by \(T\). **The Pareto optimal design** strikes an optimal and flexible balance between the two objectives of maximizing statistical power and minimizing regret. We reveal the inherent and fundamental trade-off between these objectives statistically. Specifically, among all designs that can ensure a regret upper bound of \(T^{}\), the smallest error any estimator can achieve is \(T^{-}\) in the worst case. Conversely, among all designs that can guarantee an error bound of \(T^{-}\), a regret of order \(T^{}\) is unavoidable. Our design achieves different levels of trade-off by flexibly selecting input parameters.

### Literature Review

**Inference under non-stationarity.** Considerable literature focuses on inference and decision-making under non-stationarity. One area is the inference for non-stationary Poisson processes  is relevant as they establish statistical inference models for non-stationary arrival models with linear trends.  shows that ignoring non-stationarity can lead to inefficient or invalid A/B tests. They propose a new framework for statistical analysis of non-stationary A/B tests.

**Decision-making under non-stationarity.** This work relates to adaptive decision-making in non-stationary environments. Existing literature has two main streams. The first stream focuses on budget-based drifting environments, where changes are dynamically and adversarially made within a variation budget . The second stream considers piecewise stationary/switching environments, with adaptive assignment policies designed for various bandit settings . However, these formulations lack the knowledge transferability to after-experimental periods, which is essential for our purpose. Recent studies address bandit experiments with non-stationary contexts , provide information-theoretic analysis , propose improved algorithms , and define non-stationary bandits more rigorously . Moreover, various bandit models consider specific non-stationary reward structures, such as recharging bandits , restless bandits , blocking bandits , rotting bandits , and rising bandits . In operations, assortment decisions under non-stationarity are studied , as well as pricing with evolving demands .  study the recommendation problem. Recent work extends bandit analysis to reinforcement learning . Some works focus on optimizing with full feedback .

**Adaptive Experimental Design.** Multi-armed bandit is an efficient paradigm for adaptive experiments .  and  apply diffusion-asymptotic analysis to study randomized experiments, including bandit problems.  consider experimental design for choosing the best arm with arriving units in waves.  integrate adaptively weighted doubly robust estimator into Thompson sampling.  incorporate synthetic control into MAB for interference scenarios.  also investigate the trade-off between regret and causal inference using Pareto optimality. Non-stationarity that we consider here greatly impacts Pareto optimality structure and reveals stochastic bandit as a special case.  design a two-stage experiment for ATE estimation.  model adaptive assignment as a Markov decision process, highlighting suboptimality of RCTs.  propose sequential testing framework with finite and infinite sample analysis.  consider an optimization problem in adaptive experiments.  transform experimental design with temporal interference into a Markov decision problem.  optimize subject allocation for ATE estimation precision.  address adaptive experimental design for sequential unit assignment with heterogeneous covariates.

**Post-experiment Inference.** There is a substantial literature on post-experiment inference from logged adaptively collected data where adaptive experiment data is a typical example. One of the central tasks along this line is the evaluation of a new policy given historic data (see, e.g., ).  provide a procedure to adopt bootstrap on the data collected by a bandit to debias the sample means.  construct confidence intervals for policy evaluation, including ATE, in adaptive experiments. Works along this line usually impose some "overlapping" assumptions on the data collection process. Since we are jointly considering the experimentation and the inference, such an overlapping assumption may harm the welfare gained within the experiment.

Finally, we remark that the full version of this paper (containing additional theoretical results, extensions, and missing proofs) is available at [https://ssrn.com/abstract=4514568](https://ssrn.com/abstract=4514568).

## 2 Experimental Design with Linear Trends

### Formulation

We establish the formulation of our non-stationary experiments with a finite set of arms \(\). Without loss of generality, we focus on \(=\{1,2\}\) representing a treatment and a control. The total length of the experiment is denoted as \(T\). At each time \(t[T]\)1, the environment generates potential outcomes \(r_{t}(a)\) for each arm \(a\). The chosen arm \(a_{t}\) determines the observed outcome \(r_{t}=r_{t}(a_{t})\). Our study focuses on non-stationary experiments with linear trends, specifically considering the follows,

\[r_{t}(a)=_{a,0}+_{a,1}t+_{a,t}:=_{a}^{}(t )+_{a,t}, \]

where \((t)=(1,t)^{}\), \(_{a}^{2}\) is fixed throughout the experimental horizon \(T\) but unknown to the decision maker. For a specific arm \(a\), \(\{_{a,t}\}_{t 1}\) are independent and identically distributed (i.i.d.) mean-zero \(_{a}^{2}\)-sub-Gaussian random variables (r.v.'s), i.e., \([e^{_{a,t}}](^{2}_{a}^{2}/2)\) for any \(\). For simplicity, we also assume for \(_{a}_{0}<\) for all \(a\). Note that while \(_{a}\) remains fixed, the distribution of the reward of arm \(a\), \(r_{t}(a)\), evolves over time, thereby satisfying the definition of non-stationarity as outlined in . Another mild assumption we make is the boundedness of \(_{a}\), i.e., \(\|_{a}\| S\) for all \(a\), which is commonly used (see, e.g., , , and ). A non-stationary experiment instance with linear trends can be denoted by \(=(P_{1},P_{2})\), where \(P_{i}\) is the distribution of the rewards of arm \(i\). The optimal arm at time \(t\) is the one with the maximum expected reward, which is denoted by \(a_{t}^{*}:=_{a}_{a,0}+_{a,1}t\), and thus is also unknown and may even change over time. The dynamic treatment effect can be fully captured by the column vector \(_{}:=_{1}-_{2}^{2}\). Denote all non-stationary experiment instances with linear trends to constitute a feasible set \(_{1}\).

At every time \(t\), the decision maker observes the history \(_{t-1}=(a_{1},r_{1},,a_{t-1},r_{t-1})\). An _admissible_ design \(=\{_{t}\}_{t 1}\) maps the history \(_{t-1}\) to an action \(a_{t}\). We use the traditional accumulative _regret_ to measure the efficiency of online learning, defined as the difference between the expected reward under the clairvoyant optimal policy and the policy \(\), i.e., \(_{}^{}(T)=_{t=1}^{T}_{a_{t}^{*}}(t)^{}- _{a_{t}}(t)^{}\). Note that \(_{}^{}(T)\) is still a random variable because \(\{a_{t}\}_{t 1}\) are still random. Similarly, an admissible estimator \(_{t}\) of the treatment effect at time \(t\) maps \(_{t}\) to an estimate of \(_{}\). The quality of the estimator can be measured by the norm of the difference between \(_{t}\) and \(_{}\), for example, the \(l_{1}\)-norm \(\|_{t}-_{}\|_{1}\). _The design of experiment includes designing \(\) (i.e., how to make an adaptive assignment decision) and \(_{T}\) (i.e., how to conduct causal inference)._

**Remark 1:** Linear trends, admittedly, is a strong assumption, but they have proven to be highly useful for understanding and predicting certain phenomena across various fields.  observe a linear trend in the prevalence of obesity and overweight among US adults, based on national survey data collected between 1970s and 2004. This linear trend served as a benchmark for predicting the prevalence from 2004 to 2050, influencing numerous epidemiology studies.  conduct a study on monitoring and predicting the California sea otter population using linear trends observed in aerial surveys, showcasing the usefulness of linear trends in ecological studies.  reveal a linear trend in the integrated water vapor content based on a 10-year ground-based GPS data, highlighting the application of linear trends in atmospheric research

**Remark 2:** The traditional multi-armed bandit problems are primarily focused on designing \(\) to have minimal regrets (see, e.g., ). However, in our design, we have an equally important task of designing \(_{T}\). Furthermore, we outline the unique challenges and opportunities we face compared to the stochastic bandits and contextual bandits studied in the current literature.

Our problem encompasses the well-studied stationary stochastic multi-armed bandit problem (e.g., ) by setting \(_{a,1}=0\) in Eq. (1) for all \(a\). The non-stationary structure introduces new challenges, such as the possibility of the optimal action varying over time, requiring additional efforts to control the regret. Second, while \((1,t)^{}\) in Eq. (1) can be seen as a special kind of context connecting our problem to the contextual bandit problem (e.g., ), the first difference lies in that the context \((1,t)^{}\) is fixed and known at each time period. However, a challenge arises as we can no longer assume the context \((1,t)^{}\) to be bounded, as commonly done in the literature. Some works assume the \(l_{2}\)-norm to be no larger than a universal constant, say \(1\) (see, e.g.,  and ). A straightforward solution to address this issue may involve relaxing the bound of the context to \(+1}\) if the experimental horizon \(T\) is known in advance. However, such a relaxation might be too loose, particularly when analyzing regret upper bounds. A more thorough discussion on this relaxation is deferred to the next subsection when we analyze the regret of our new design.

### Design of Experiments with Linear Trends

We present our design called _Linear Exploration and OFU_ (\(\)) design in Algorithm 1. The term OFU refers to the well-known principle of Optimism in the Face of Uncertainty, which arises from and has been widely adopted in the multi-armed bandit literature (see, e.g., ,  and their follow-ups). For brevity, we use the notation \(()\) to emphasize the crucial input parameter \(\), whose role will become evident in the subsequent discussion. Our design operates in a two-phase manner: the exploration phase and the OFU phase. We now elaborate on each phase in detail.

The exploration phase is the first steps of our design, which lasts for approximately \(T^{}\) periods. The parameter \(\) plays a crucial role in controlling the length of this phase. During this phase, our \(\) algorithm deterministically alternates between playing arms 1 and 2. In Algorithm 1, we choose to play arm 1 when the time index \(t\) is odd and arm 2 when \(t\) is even. This deterministic approach preserves the independence between the collected data. By the end of this phase, the decision-maker obtains approximately \(}{2}\) independent samples for each arm, although these samples may not be identically distributed. \(\) will utilize the data collected during this initial phase to produce an estimator for the treatment effect, denoted as \(_{T}^{()}\) in line 18 of the algorithm. Specifically, we estimate \(_{1}\) and \(_{2}\) separately by regressing the rewards against the time \(t\) using the data collected up to time \(T^{}\), i.e., \(_{1,T}^{()}=(_{t[T^{}]}(t) (t)^{})^{-1}_{t[[T^{}]]}r_{t}(t)\), where \([[T^{}]]\) denotes the set of all the odd numbers that are no larger than \(T^{}\). The final estimate of \(_{}\) is \(_{T}^{()}=_{1,T}^{()}-_{2,T}^{()}\). While the estimator we use may be sample-inefficient as we do not utilize the \(T-T^{}\) samples in the second phase, we will show in the next subsection that the data collected in the first stage is sufficient to achieve a rate-optimal estimator of the treatment effect. Intuitively, if one arm consistently outperforms the other, most of the data in the second phase comes from the optimal arm, with fewer observations from the suboptimal arm. Thus, observations from the suboptimal arm are mostly obtained during the first stage. Moreover, the bottleneck for estimating the treatment effect is very likely determined by the arm with the fewest observations, which is typically the suboptimal arm. Although we discard much data from the optimal arm when conducting inference, the bottleneck is still the suboptimal arm whose most information will be collected through the first phase. Additionally, we choose not to use all the data since adaptively collected data in the second stage can harm the independence of the data, leading to undesirable statistical properties such as bias. This issue has been pointed out in a large body of recent work . Formally, we have the following Theorem 2 characterizing the properties of the estimator we choose.

**Theorem 1**: _Assuming \(T^{} 4\), for any \(_{1}\), there exists a constant \(c_{1}>0\) such that for any \(>0\), with probability at least \(1-\), \(\|_{T}^{()}-_{}\|_{1} c _{1}T^{-}}\), where \(c_{1}=(_{1}_{2})\). Moreover, we have \(_{_{1}}[\|_{T}^{()}-_{}\|_{1}]=(T^{-})\)._

Our assumption that \(T^{} 4\) aligns with our intuition that a minimum of two samples per arm is required to identify a linear structure. Theorem 1 demonstrates that the bound \(T^{-}\) decreases as \(\) increases, indicating that a longer exploration period leads to better estimation of the dynamic treatment effect. When \(\) is set to 1, we conduct pure exploration throughout the entire experimental horizon, similar to the well-known switchback experiments . In this case, the estimation error can be controlled to the order of \((1/)\), which aligns with traditional statistical results of linear regression . Moreover, our analysis can be extended to any \(l_{p}\)-norm, with only slight variationsin the constant \(c_{1}\). Additionally, note that the high probability bound can be used for constructing _confidence intervals_ and conduct _hypothesis testing_.

The second phase of our \(\) follows the OFU principle. Specifically, at each time period \(t\), \(\) calculates an optimistic estimate of the rewards for each arm, denoted as \(_{t}(a)\) in line 12. This estimate is referred to as optimistic because, with probability at least \(1-\), for all \(t[T]\) and \(a\{1,2\}\), \(_{t}(a)=_{a,t}^{}(t)+_{a,t}\|(t)\|_{V _{a,t}^{-1}}_{a}^{}(t)=[R_{t}(a)]\), where \(_{a,t}_{a}(+^{1 /2}S)\) and by default, \(\) is set to be 1. The proof of this claim follows the standard techniques outlined in Theorem 2 of .

```
1Input: Controlling parameter \(\), instance parameters: \(_{a}\) for all \(a\{1,2\},T,S,\)
2Initialization:\(=1\), \(_{1,0}=_{2,0}=_{1,T}=_{1,T}=\), \(()=(1,)^{}\)
3for\(t=1,2,, T^{}\)do// Phase 1: Exploration
4 Select \(A_{t}=1\) if \(t\) is odd; otherwise select \(A_{t}=2\);
5 Observe reward \(r_{t}\);
6\(_{A_{t},0}_{A_{t},0}\{((t),r_{t})\}\) and \(_{A_{t},T}_{A_{t},T}\{((t),r_{t})\}\);
7 endfor
8for\(t= T^{}+1, T^{}+2,,T\)do// Phase 2: OFU
9\(V_{a,t}=_{((t),r_{i})_{a,T}}(i)()^{}+ I\) for \(a\{1,2\}\);
10\(_{a,t}=_{a})^{1/2}( I)^{ -1/2}}{})}+^{1/2}S\) for \(a\{1,2\}\);
11\(_{a,t}=V_{a,t}^{-1}_{((t),r_{i})_{a,T}}r_{ i}(i)\) for \(a\{1,2\}\);
12\(_{t}(a)=_{a,t}^{}(t)+_{a,t}\|(t)\|_{V_{ a,t}^{-1}}\) for \(a\{1,2\}\);
13 Select \(A_{t}=_{a\{1,2\}}_{t}(a)\);
14 Observe reward \(r_{t}\);
15\(_{A_{t},T}_{A_{t},T}\{((t),r_{t})\}\);
16 endfor
17\(_{a,T}^{()}=(_{((i),r_{i}) _{a,0}}(i)()(i)^{})^{-1}_{((i),r_{i})_{a,0}}r _{i}(i)\) for \(a\{1,2\}\);
18 Output:\(_{T}^{()}=_{1,T}^{( )}-_{2,T}^{()}\);
```

**Algorithm 1**Linear Exploration and OFU (\(\))

Based on the optimistic estimation, \(\) selects the arm with the highest optimistic estimated value. The OFU principle has been shown to strike a delicate balance between exploration and exploitation in the bandit literature . As mentioned earlier, one of the challenges in our problem is the possibility of the optimal arm changing over time. The OFU principle has an additional advantage in that it can automatically and implicitly detect when the optimal arm switches from one to another. To illustrate this, Figure 2 presents an example of how OFU behaves when the optimal arm switches. Initially (before \(t_{3}\)), arm 1 outperforms arm 2. According to \(\), we continue to play arm 1, resulting in a relatively fast shrinkage of the confidence interval for the estimated values of arm 1. Conversely, for arm 2, the confidence interval even expands as \((t)\) increases in magnitude. As time approaches \(t_{3}\), the difference between arm 1 and arm 2 gradually diminishes. At time period \(t_{3}\), the optimistic estimation of arm 2 surpasses that of arm 1, prompting \(\) to start playing arm 2. This addresses the challenge mentioned earlier. The following theorem presents the regret upper bound.

**Theorem 2**: _For any \(_{1}\) and \(0< 1\), with probability at least \(1-\),_

\[_{}^{L()}(T) 4ST^{2}+4(_{1} _{2})(+^{1/2}S) }}{ 2}(2T)T}, \]

_where \(\) is initialized as 1. Furthermore, \(=1/T\) leads to \([_{}^{L()}(T)]=(T^{2 })\)._

Equation (2) can be decomposed into two terms: a \(T^{2}\) term and a \(\) term. The first term arises from the exploration stage, as \(_{t=1}^{T^{}}t=(T^{2})\) intuitively. The second term is a result of the

Figure 2: An illustrative example on OFU.

OFU phase. Only when \(\) does the first term dominate the second term. In fact, there is little motivation for a decision maker to choose \(<\), as we will discuss in detail in the next subsection. For pure theoretical interest, the regret behavior in the region around \(=0\) could be studied by choosing \(=1/(T)\), given that there is an \(\) in the denominator. For those familiar with the bandit literature, a similar \(()\) bound can be obtained in the stochastic contextual bandit setting . As we mentioned before, one possible approach to reduce our problem to the one in  is by treating \((t)\) as a special kind of context. However, a key difference is that the context in  is assumed to be bounded by a constant, whereas in our setting, the bound should be \(}\) if we know \(T\) in advance. Consequently, to apply all the techniques from , \(\) in Equation (2) should be chosen as \((T)\) instead of \(1\). However, such a choice of \(\) would yield a regret bound of \((T)\), which is significantly weaker than the \(()\) regret we derived. Furthermore, in the stochastic contextual bandit setting, where everything is assumed to be bounded, the regret can always be upper bounded by \((T)\) for any policy, and thus only sublinear regrets are meaningful. However, here, with the linear trend, the largest possible regret for a policy without careful design can be on the order of \((T^{2})\). Thus, the \((T^{2})\) regret bound is still informative even if \(1/2<<1\).

Another important point to emphasize is that although the regret can be decomposed into two terms, it does not mean that we can analyze each phase independently of the other. The \(T^{}\) samples we collect from the first stage play a crucial role in our analysis for the second phase. This is evidenced by the fact that \(\) not only appears in the first term, but also takes effect in the second term by a non-trivial way. Specifically, the regret of the second phase can be upper bounded by the sum of the length of the confidence interval at each time, i.e., the regret at time \(t\) can be bounded by \(2(t)_{V_{1,t}^{-1}}_{A_{t}=1}+2 (t)_{V_{2,t}^{-1}}_{A_{t}=2}\), where \(V_{a,t}\) is defined to be \(_{i=1}^{t}(i)(i)^{}_{A_{t}=a}+ I\). The \(T^{}\) samples collected in the first stage are efficient in controlling the minimum eigenvalue of \(V_{a,t}\), and thus be useful in controlling the magnitude of the regret.

In addition, we would like to compare our two-stage design with the traditional exploration-then-exploitation design . The similarity between the two lies in the fact that the first exploration phase provides valuable information for future decision-making, as we discussed earlier. However, the key difference is that exploration-then-exploitation typically only exploits the information gathered during the first exploration phase and does not continue to learn new information during the second phase. In contrast, our L-EOFU algorithm continues to and has to learn throughout the entire learning period, since the environment may rapidly evolve over time. Moreover, the exploration phase in L-EOFU also plays an important role in conducting causal inference. Therefore, when designing the length of the first phase, we must consider not only the regret but also the quality of causal inference. One reason why we move away from the exploration-then-exploitation method is that it may not always guarantee the optimal regret rate. Another important motivation for conducting pure exploration first is that the cost of exploration may increase linearly with time.

### Optimality of The Design

In this subsection, we will examine the optimality of our L-EOFU design from three different perspectives. Firstly, we will consider two extremes where the decision maker is solely concerned about either the estimation error of the dynamic treatment effect or the regret. Subsequently, when jointly considering the two objectives, we will introduce the concept of Pareto optimality, which describes a scenario where neither the statistical power of estimating the treatment effect nor the regret can be improved without compromising the other. First, we focus on the best achievable quality of the inference of \(_{}\), regardless of the regret incurred during the experiment. The following lemma describes the intrinsic difficulty of conducting inference for the dynamic treatment effect.

**Lemma 1**: _For any constant \(c_{2}>0,_{}_{_{1}}_{}( -_{}_{1}>c_{2} _{0}}{})-c_{2}\). Moreover, \(_{}_{_{1}}_{}[ -_{}_{1}]_{0}}{ 8}\)._

This lemma establishes an information-theoretic lower bound on the best achievable quality of inference for \(_{}\). It indicates that, for any estimator \(\), there will always exist a challenging instance that results in the estimator being at least \((1/)\) away from the true value. Our proof idea is to reduce the two-dimensional estimation problem to a one-dimensional problem. Specifically, we consider a subset of all the problem instances \(_{0}:=\{_{1}:_{a,1}=0, a\{1,2\}\}\), which includes all the stationary instances (i.e., without time trends), and this provides a natural lower bound that \(_{}_{_{1}}_{}(\|-_{}\|_{1}>c_{2}_{0}}{} )_{}_{_{0}}_{} (\|-_{}\|_{1}>c_{2} _{0}}{})\). For the instance class \(_{0}\), the problem is reduced to estimating only the intercept terms. By choosing \(=1\), Theorem 1 indicates \(\|_{T}^{(1)}-_{}\|_{1}\) can be upper bounded by \((1/)\), which matches with the lower bound we derive in Lemma 1 in terms of the dependence of the order of \(T\). Therefore, we can state the following theorem.

**Theorem 3** (Optimal Error Rate Design): \(_{T}^{(1)}\) _achieves the optimal \(1/\) error rate, which can not be improved up to a constant factor. Moreover, \(_{}_{_{1}}_{}[\| -_{}\|_{1}]=(1/)\)._

Theorem 3 further establishes that the existence of \(_{T}^{(1)}\) confirms the tightness of the \(1/\) lower bound derived in Lemma 1. As mentioned earlier, setting \(=1\) corresponds to the simple switchback experimental design. Theorem 3 implies that even in the presence of linear trends, switchback experiments can still maintain strong statistical power. However, there is no free lunch. Choosing \(=1\) results in a regret upper bound of \((T^{2})\), which can be highly undesirable if minimizing regret is also one of the objectives. Now, we turn to discuss about the other extreme that the regret minimization is the only objective. We present the minimax regret lower bound as follows.

**Lemma 2** (Regret Lower Bound): \(_{}_{_{1}}[_{}^{} (T)]}{32e}\)_._

This lemma describes that any admissible policy \(\) will face some hard instance such that the expected regret could be no less than \(()\). Similar as before, we can bridge our problem with the tradition stochastic bandit problem by noticing that \(_{0}_{1}\). It is widely recognized that the stochastic bandit problem has a well-established minimax regret lower bound of \(()\). Intuitively, given that the traditional stochastic bandit problem is a special case within our framework, this lower bound naturally extends to our setting. Formally, by Theorem 2, we have the following theorem, which states that the \(\) lower bound is indeed possible to achieve and is optimal.

**Theorem 4** (Optimal Regret Rate Design): _For any \(0<\), \(()\) can guarantee a regret of \(}()\), which can not be further improved up to logarithmic factors. Furthermore, \(_{}_{_{1}}[_{}^{} (T)]=()\)._

Theorem 4 reveals that any \((0,]\) yields a homogeneous regret rate dependence on \(T\). However, the estimation error, as shown in Theorem 1, decreases with increasing \(\). Consequently, increasing \(\) from nearly \(0\) to \(\) does not significantly increase the regret rate, which remains at \(}()\). However, it significantly reduces the estimation error bound. Therefore, there is limited motivation for decision makers to select \(<\). Nevertheless, there is no free lunch. Even if we choose \(=\), the estimation error can only be bounded by \((T^{-})\), which is much larger than the optimal bound of \(}\). While the optimal regret rate in this case aligns with that of the traditional stochastic bandit, the optimal design for linear trends faces additional challenges. Intuitively, a regret rate optimal design for linear trends needs to improve from a naive design's \(T^{2}\) regret to the \(\) order. In contrast, the regret rate optimal design for traditional multi-armed bandits only needs to improve from \(T\) regret to \(\).

From the two cases discussed above, we have uncovered a fundamental trade-off between regret and the statistical power. The design that achieves the optimal regret rate suffers from a large estimation error, while the design that achieves the optimal error rate incurs a large regret. To address this trade-off, we now employ the concept of Pareto optimality from multi-objective optimization theory. This concept allows us to characterize the circumstances where neither regret nor estimation error of the treatment effect can be improved without worsening the other. In other words, we aim to statistically determine the type of optimality that can be achieved between these two extremes.

Formally, we first define the policy class \(_{}\) as \(_{}:=\{: c_{0}>0,_{1}T, [_{}^{}(T)] c_{0}T^{}\}\), where \(c_{0}\) in this context can depend on universal constants or logarithmic terms of \(T\), but it cannot include any polynomial terms of \(T\). The set \(_{}\) encompasses all policies that can achieve a regret of \(}(T^{})\). It is evident that \(()\) belongs to \(_{(2)}\). Our aim is to investigate the best achievable estimation error when the decision maker incurs a regret of at most \(}(T^{})\). The following lemma reveals the inherent difficulty of conducting inference under limited regret budget.

**Lemma 3**: _For any \(_{}\), there exists a constant \(c^{}\) only dependent of numerical constants and logarithm terms of \(T\), such that for any \(>0\), \(_{}_{_{1}}_{}^{}(\| -_{}\|_{1} c^{}_{0} T^{-})-\). Moreover, \(_{}_{_{1}}_{}^{}[ \|-_{}\|_{1}]_{0 }}{16}T^{-}\)._

Lemma 3 demonstrates that when employing an assignment policy \(\) with a regret of \(}(T^{})\), any estimator, regardless of its sophistication, will encounter challenging instances where the estimation error is at least \((T^{-})\). This finding distinguishes our study, which incorporates linear trends, from the work of  that investigates multi-armed bandit experimental design without linear trends. In the absence of linear trends,  reveals that under an assignment policy \(\) with a regret of \(}(T^{})\), the estimation error has a minimax lower bound of \((T^{-})\). The key distinction arises from the fact that linear trends can significantly increase the cost of exploration, resulting in higher regret during the exploration phase. Consequently, with the same regret budget, the information collected in our case may be substantially less than in the absence of linear trends. The proof follows this intuition by constructing two similar instances with the same optimal arm but slightly different suboptimal arms. The only way to obtain useful information to distinguish the two is by playing the suboptimal arm. Given a regret budget of \(T^{}\), at most approximately \(T^{}\) samples can be obtained from the suboptimal arm, leading to a lower bound of \(T^{-}\).

**Theorem 5** (Pareto Optimal Design): _If \(\), \(\)-\(()_{2}\), and thus, the \(T^{-}\) error rate in Theorem 1 can not be further improved in terms of the dependence on \(T\). Furthermore, for a fixed \(\), \(_{_{T},_{}}_{_{1}}_{}^{}[\|_{T}-_{}\|_{1}]= (T^{-})\)._

The theorem establishes that the regret bound of \(T^{-}\) achieved by \(\)-\(()\) cannot be improved by a constant factor, given that the decision-making policy belongs to \(_{2}\). This implies that \(\)-\(()\) is Pareto optimal for any \(\). The reasons are as follows: on the one hand, if one desires a better guarantee on the estimation error than \(T^{-}\), the only option is to accept a higher regret rate by adopting a larger decision-making policy class \(_{2+}\) for some \(>0\). On the other hand, if a regret of \(}(T^{2-})\) is aimed for, the estimation error will inevitably increase to the order of \(T^{-2+}\). In other words, improving either the statistical power of causal inference or the efficiency of online decision-making necessitates a degradation in the other. Intuitively, Theorem 5 captures a statistical Pareto frontier for the trade-off between conducting causal inference and minimizing regret, which can be expressed as Estimation Error \(=(^{-})\). In Theorem 3, we reveal that \(=1\) leads to the optimal design in terms of error rate. By combining Theorem 5, we further conclude that the large \(T^{2}\) regret incurred by \(=1\) is necessary for any estimator achieving the optimal error rate of \(}\). Moreover, the \(T^{-}\) error rate achieved by \(=\), although relatively large, is the best that any regret-optimal policy can achieve. Figure 3 illustrates the Pareto frontier under linear trends, alongside the Pareto frontier for standard multi-armed bandit experimental design studied in .

From Figure 3, we can observe the significant impact of the non-stationary structure on optimal experimental design. First, in standard bandit experiments, the maximum possible regret is of the order \(T\) since all parameters are assumed to be bounded. However, with the presence of linear trends, traditional designs such as switchback experiments are likely to incur regret of the order \(T^{2}\). Furthermore, under the same regret budget, the best achievable estimation error bounds differ substantially. For instance, given assignment policies with regret of the order \(T\), the optimal design for standard bandit experiments can attain an error bound of \(T^{-1/2}\), whereas in the presence of linear trends, the best achievable bound is \(T^{-1/4}\). Intuitively, this is because linear trends make gathering information from the suboptimal arm increasingly costly in terms of regret. Similarly,

Figure 3: The Pareto Frontier.

when linear trends exist, the decision maker will always have to pay additional regret to obtain an estimator with the same level of precision. Additionally, there is a worst-case infeasible region as indicated by Lemma 2 that no policy can achieve a regret smaller than \(\) order in the worst case.

## 3 Discussion

In this section, we'll discuss the limitations and future directions of our work. Firstly, the assumption of prior knowledge about non-stationarity following a linear form is strong. While it provides a starting point for understanding experiment design under structured non-stationarity, practical approaches are needed. One option is to use historical data for prior information, if there exists some. Alternatively, we can use data collected during the first phase of our L-OFUE algorithms to verify trends. Another question is model misspecification. What if the true underlying model is non-parametric, but the decision maker prefers using interpretable linear functions? Understanding how our design performs in such scenarios will provide valuable insights into its practical applicability. Furthermore, our framework and results are formulated based on a specific notion of non-stationarity. Exploring whether our framework can be adapted to different formulations of non-stationarity is another area of interest for future research. Another important direction for our future research is the exploration of instance-dependent regret bounds under linear and polynomial trends. In this paper, we focus on studying the worst-case optimal regret. However, in the field of classical stochastic bandits, there has been increasing attention on instance-dependent regret bounds (e.g., ). It would be valuable to extend our analysis to incorporate instance-dependent parameters. Defining suitable instance-dependent parameters is not a trivial task, as the classical parameters such as arm gaps may not be directly applicable in our setting, where the parameters themselves change over time. Another more practical question that people may be of interest is how to choose \(\). One possible approach is to adaptively end the first phase of the experiment. Ideally, continuous monitoring during Phase 1 would allow for the experiment to halt as soon as certain criteria are met, eliminating the need to manually select \(\). However, reliable and efficient continuous monitoring of the switchback experiment poses significant challenges. Even in basic A/B testing without a linear trend, designing continuous monitoring requires substantial effort and delicate power analysis, as demonstrated in .

## 4 Conclusion

In this work, we present a comprehensive investigation into the problem of non-stationary experimental design with linear trends. Our focus is on two objectives: accurate estimation of dynamic treatment effects and minimizing welfare loss within the experiment. For scenarios involving linear trends, we propose an efficient design called L-EOFU. This design can be customized to achieve optimal estimation error rates, optimal regret rates, or strike a Pareto optimal trade-off between the two objectives. To establish the efficacy of our approach, we provide information-theoretical lower bounds that highlight the inherent challenges in estimating dynamic treatment effects and minimizing welfare loss. Additionally, we unveil the fundamental trade-off between the two objectives.