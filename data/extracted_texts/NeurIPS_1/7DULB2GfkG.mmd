# Learning Inter-Graph Interactions Between Heterogeneous Substructures of Chemical Systems

Gyoung S. Na

Korea Research Institute of Chemical Technology

ngs0@krict.re.kr

###### Abstract

Complex chemical systems containing heterogeneous substructures are common in real-world applications. Various physical phenomena of the complex chemical systems are derived from the interactions between the heterogeneous substructures. However, existing graph representation learning methods for inter-graph interactions assumed graph-level interactions between homogeneous structures, such as organic molecules and inorganic crystalline materials. We propose a data descriptor of the complex chemical systems and a graph neural network for learning inter-graph interactions between organic and inorganic compounds. We applied the proposed method to predict the physical properties of hybrid solar cell materials containing heterogeneous substructures, which have received significant attention for sustainable energy resources. By learning heterogeneous inter-graph interactions, the proposed method achieved state-of-the-art accuracy in predicting band gaps of 1,682 hybrid solar cell materials.

## 1 Introduction

Complex chemical systems with multiple heterogeneous atomic substructures are common in various scientific applications, such as sensor materials , energy materials , and catalysts . In particular, the complex chemical systems containing organic molecules and inorganic crystalline materials have been widely studied in chemistry and materials science, such as inorganic catalysts  and hybrid organic-inorganic perovskites . We refer to the organic-inorganic chemical systems as _hybrid chemical systems_. Many chemical experiments and analyses revealed that the physical and chemical interactions between the organic and inorganic substructures play an important role in determining the physical nature of the hybrid chemical systems .

Graph neural networks (GNNs)  have been widely applied to various chemical applications, such as descriptor learning , drug design , and materials discovery . In graph-based machine learning, the molecules and crystalline materials are represented as a single mathematical graph \(G=(,,,)\), where \(\) is a set of nodes (atoms), \(\) is a set of edges (chemical bonds) between the atoms, \(^{|| d}\) is a \(d\)-dimensional node-feature matrix, and \(^{|| l}\) is a \(l\)-dimensional edge-feature matrix. However, although various GNNs have achieved numerous successes in predicting the physical and chemical properties of a single molecule of crystalline material, regression problems on hybrid chemical systems of multiple heterogeneous graphs are hardly investigated in graph-based machine learning.

One of the naive approaches for predicting target properties of the hybrid chemical systems is to employ GNNs by representing the entire atomic structure of the hybrid chemical system as a single homogeneous graph. However, appropriate descriptors of the organic molecules and the inorganic crystalline materials can be different, and the appropriate descriptors of the chemical systems are crucial in successful machine learning . Therefore, a graph representation learning method tolearn inter-graph interactions between heterogeneous organic and inorganic substructures is crucial in real-world chemical applications.

In this paper, we propose \(\)\(\)\(\)-graph \(\) (\(\)) for learning heterogeneous inter-graph interactions. In the data pre-processing step of \(\), the hybrid chemical systems are decomposed into \(K\) substructures, where \(K\) is a pre-defined hyperparameter. The decomposition rule should be designed by domain knowledge of the target hybrid chemical systems. For example, the hybrid organic-inorganic perovskites [19; 20] are decomposed into the organic molecules and the inorganic frames. For the decomposed \(K\) substructures, \(\) calculates the latent node embedding of the atoms in the \(K\) substructures. Then, \(\) is a system-level vector-shaped embedding \(\) through a node-wise attention map. The number of attention maps grows by \(\) to learn node-level attentions for each pair of \(K\) heterogeneous substructures. For the calculated node-level attentions, \(\) calculates the system-level embedding \(\) based on the graph readout operations [10; 21].

We evaluated the prediction capabilities of \(\) on two benchmark datasets containing **2,355** hybrid solar cell materials. We applied \(\) to the problems of predicting band gaps of the hybrid solar cell materials because the band gap is one of the most important physical properties that determine the scientific applications of the solar cell materials [19; 20]. \(\) achieved state-of-the-art prediction accuracy in the experiments. Quantitatively, \(\) showed the \(R^{2}\)-scores  greater than 0.9 in the problems of predicting the band gaps of the materials containing heterogeneous substructures.

## 2 Related Work

### Graph Neural Networks for Chemical Data

GNNs have been widely applied to predict the physical and chemical properties of the chemical compounds from their molecular and crystal structures [23; 17]. Crystal graph convolutional neural network (CGCNN)  is one of the most successful GNNs to predict the physical properties of the crystal structures in materials science. In addition to CGCNN, various GNNs with sophisticatedly designed node aggregation schemes and graph representation methods have been widely applied to the crystal structures, such as gated graph neural network (GG-NN) , materials graph network (MEGNet) , and tuple-wise graph neural network (TGNN) . In addition to the 2D-based GNNs, various 3D structure-based GNNs have been proposed to learn molecular and materials representation based on 3D geometry of the atoms. \(\) is a 3D-based GNN to learn molecular representations based on the directional message passing determined by the inter-atomic angles. M3GNet  is a physics-informed 3D-based GNN to learn inter-atomic potentials. In addition to the problem of inter-atomic potential learning, M3GNet showed state-of-the-art accuracy in predicting the physical and chemical properties of the molecules and crystalline materials.

### Inter-Graph Interaction Learning

Several GNN-based frameworks were proposed to learn the physical interactions between organic molecules. CIGIN is a GNN-based architecture of two GNNs for learning physical interactions between solute and solvent molecules to predict aqueous solubilities of drug-like molecules . CIGIN employs a conditional attention mechanism to learn the physical interactions between two organic molecules. CIGIB learns the physical interactions between two organic molecules based on conditional information bottleneck . CGIB generates latent embedding of two organic molecules through individual GNNs and calculates a system-level embedding based on the latent embeddings under the information bottleneck theory. However, although CIGIN and CGIB were successfully applied to various chemical applications, these methods assumed the chemical applications of the inter-graph interactions between two homogeneous organic molecules.

### Hybrid Organic-Inorganic Perovskites

Perovskite materials have received significant attention as the solar cell materials for the sustainable energy resource . In particular, hybrid organic-inorganic perovskites (HOIP) showed various useful physics as device-level solar cells . HOIPs usually consist of two heterogeneous substructures called inorganic frame and organic molecule , as shown in Fig. 1a. The inorganic frames are crystalline materials that enclose the organic molecules. The physical characteristics of HOIPs are essentially derived from the interactions between the organic molecules and the inorganic frames [32; 33], as shown in Fig. 1b. For the data-driven discovery of HOIP, various datasets containing crystal structures of HOIP and their physical properties were constructed. The calculated HOIP (CHOIP) dataset contains calculated atomic structures of 1,346 HOIPs with their band gaps . The two-dimensional HOIP (THOIP) dataset includes the atomic structures of 515 two-dimensional HOIPs collected from scientific literature .

## 3 Method

### Problem Definition

Our problem can be defined as a regression problem to build a prediction model \(f:\), where \(=_{1}_{K}\) is a chemical space of the complex chemical systems containing \(K\) heterogeneous substructures in \(_{1},...,_{K}\). For the HOIP materials, the problem is reduced to the regression problem of \(f:\), where \(\) and \(\) is the chemical spaces of the crystalline materials (inorganic frames) and organic molecules in HOIPs.

### Substructure Decomposition with Virtual Node Augmentation

For a given atomic structure of HOIP, we decompose the atomic structure into the inorganic frame and the organic molecule. Formally, a given complex chemical system \(R\) is decomposed to the crystal graph \(G_{c}=(_{c},_{c},_{c},_{c})\) and the molecular graph \(G_{m}=(_{m},_{m},_{m},_{m})\), i.e. the input chemical system is given by \(R=(G_{c},G_{m})\). \(_{c}\) and \(_{m}\) are sets of the nodes (atoms) in the inorganic frame and the organic molecule, respectively. Similarly, \(_{c}\) and \(_{m}\) are sets of the edges (chemical bonds) in the inorganic frame and the organic molecule, respectively. However, the node-feature matrices (\(_{c}\) and \(_{m}\)) and the edge-feature matrices (\(_{c}\) and \(_{m}\)) can be differently defined by the chemical descriptors for the inorganic frame and the organic molecule. For example, each row of \(_{c}\) is the real-valued physical distances between two atoms, and each row of \(_{m}\) is the one-hot vector indicating the bonding types between two atoms. These heterogeneous representation enables to appropriately describe the physical and chemical information about the substructures in the complex chemical systems.

However, the decomposed crystal graph \(G_{c}\) is not physically valid because the empty space is generated during the decomposition process of the organic molecule. The empty space in the chemical structures causes several mathematical and implementation errors in the data pre-processing step. To solve this problem, we define a trainable virtual node that represents the empty space caused by the decomposition of the organic molecules. That is, \(G_{c}\) is first constructed from the original atomic structure of \(R\), then the atoms of the organic molecules are replaced with the virtual node. There are several ways to initialize the virtual node. In the implementation of HeteroSIN, we initialized the virtual node based on the vector-shaped representation of the decomposed organic

Figure 1: The overall structure of HOIPs. a: Two heterogeneous substructures of HOIP. b: Physical properties of HOIP from the physical interactions between inorganic frames and organic molecules.

molecule [34; 35] as:

\[=_{i=1}^{N_{e}}}{_{j=1}^{N_{e}}r_{j}}_{i}, \]

where \(r_{i}\) is the ratio of the \(i\)-th element in the decomposed organic molecule, \(_{i}\) is the physical and chemical attributes of the \(i\)-th element. The vector-shaped molecular representation \(\) is assigned to the virtual nodes that replace the empty space caused by the decomposition of the organic molecule.

### Overall Architecture of Heterogeneous Substructure Inter-Graph Network (HeteroSIN)

As shown in Fig. 2, HeteroSIN consists of three components: (1) two GNN-based encoders, (2) heterogeneous node interaction map, and (3) dense layers. The GNN-based encoders \(h_{c}\) and \(h_{m}\) calculate the vector-shaped latent embeddings of the nodes in the input crystal graph \(G_{c}\) and molecular graph \(G_{m}\), respectively. The heterogeneous node interaction map learns the node-wise attentions between two nodes from individual heterogeneous substructures. A system-level embedding that describes the entire hybrid chemical system is calculated based on the node-wise attention. Finally, the target property is predicted by entering the system-level embedding into the dense layers.

### Heterogeneous Node Interaction Map

The purpose of the heterogeneous node interaction map in HeteroSIN is to learn the physical interactions between the atoms in the heterogeneous substructures. In our problem setting, two \(l\)-dimensional node embedding matrices \(_{c}^{|_{c}| l}\) and \(_{m}^{|_{m}| l}\) are passed to the heterogeneous node interaction map. The heterogeneous node interaction map calculates the node-level attention as:

\[_{ij}=_{c,i}_{m,j}))}{_{k= 1}^{|_{c}|}_{q=1}^{|_{m}|}(_{c,k} _{m,q})}, \]

where \(\) is the vector concatenation operator, and the input node embeddings \(_{c,i}\) and \(_{m,j}\) are the \(i\)- and \(j\)-th row vectors of \(_{c}\) and \(_{m}\), respectively.

After the attention score calculation, the system-level embedding vector that describes the entire structure of the input hybrid chemical system is calculated as:

\[=_{i=1}^{|_{c}|}_{j=1}^{|_{m}|}_ {i,j}(_{c,i}_{m,j}). \]

Unlike the conventional attention-based graph pooling methods [36; 37], HeteroSIN calculates the system-level embedding based on the atom-level inter-structure interactions and their attention scores to capture the nature of the hybrid chemical systems, which is derived from the physical interactions between the heterogeneous substructures.

### Structural Complexity Reduction

One of the main limitations of GNNs in the graph-level representation learning is that the representation capabilities of GNNs can be degraded on large graphs . However, our dive-and-conquer

Figure 2: The overall architecture of HeteroSIN for learning inter-graph interactions between two heterogeneous substructures of the input hybrid chemical system.

approach that learns the graph-level representations of the entire structure by decomposing it into the substructures can naturally reduce the structural complexity of the input graph. If we completely decompose the input graph \(G\) into \(K\) substructure \(G_{1},...,G_{K}\), i.e., \(=_{1}_{K}\) and \(_{1}_{K}=\), then the number of possible edges holds the following inequality.

\[||^{2}=(_{i=1}^{K}_{i})^{2}_{i=1 }^{K}|_{i}|^{2}. \]

Therefore, the substructure decomposition of HeteroSIN in Section 3.2 reduces the structural complexity of the input chemical systems. We will experimentally demonstrate the performance improvement of HeteroSIN on large graphs in Section 4.

## 4 Experiments

We conducted experiments to evaluate the prediction capabilities of HeteroSIN in a problem of predicting the physical properties of hybrid chemical systems. For the experiments, we used the CHOIP and THOIP datasets containing 1,346 and 515 hybrid perovskites with their band gaps. We converted the decomposed inorganic frames into the crystal graphs based on the PyMatgen library1. We used the pre-trained inorganic atom embeddings  to generate the node-feature matrix of the crystal graph. For the edge-features of the crystal graph, we followed the conventional implementation that generates the edge-features of the chemical bonds by applying the radial basis function to the atomic distances of the chemical bonds . We converted the decomposed organic molecules into the molecular graphs based on the RDKit library2. The node- and edge-features of the molecular graphs are generated by one-hot vectors of the atomic numbers and the bond types, respectively. For GNNs for homogeneous graph representation learning, we converted the entire hybrid chemical systems into the crystal graphs. In the experiments, we used 1,316 and 366 materials in the CHOIP and THOIP datasets, respectively, because there were several errors in the PyMatgen and RDKit libraries in reading the raw chemical data.

### Experiment Settings

We used CGCNN and GATv2 as the GNN-based encoders of HeteroSIN for the decomposed inorganic frames and organic molecules, respectively. We compared the prediction capabilities of HeteroSIN with state-of-the-art GNNs: GATv2 , MPNN , CGCNN , UniMP , DimeNet++ , and M3GNet . The training hyper-parameters of the competitor GNNs and HeteroSIN based on the grid search on the ranges of initial learning rate {1e-4, 5e-4, 1e-3, 5e-3, 1e-2} and batch size {24, 32, 64, 128}. The prediction accuracy of the competitor methods and HeteroSIN based on 5-fold cross-validation. The prediction accuracy was measured by the \(R^{2}\)-score between the ground truth and predicted materials properties.

Although we applied GNNs for a single homogeneous graph by converting HOIP as a single homogeneous graph, we were not able to implement the inter-graph interaction learning methods  in the experiments because they require pre-defined and physically-valid individual molecules. In other words, we were not able to apply the inter-graph interaction learning methods to the prediction problems on HOIPs because they cannot handle the decomposed substructures with the empty spaces.

### Datasets

We evaluated the prediction capabilities of the competitor methods and HeteroSIN on the CHOIP and THOIP datasets. The CHOIP and THOIP datasets contain the crystal structures and band gaps of 1,346 and 515 HOIPs, respectively. We converted the HOIPs in the CHOIP and THOIP datasets based on the atomic cutoff that determines the maximum distance of the neighborhood atoms . The atomic cutoff was fixed to 4 A on the CHOIP and THOIP datasets. In this implementation setting, the average number of edges of the CHOIP and THOIP datasets were 1,120 and 7,288, respectively. In other words, the graph representation learning methods should handle large and complex graphs for successful representation learning on the THOIP dataset.

### Band Gap Prediction

Band gap is one of the most important physical properties that roughly determines the applications of the solar cell materials [19; 20; 42]. Table 1 shows the \(R^{2}\)-scores of the competitor GNNs and HeteroSIN on the CHOIP and THOIP datasets. For all benchmark datasets, HeteroSIN achieved state-of-the-art prediction accuracy. The \(R^{2}\)-scores of HeteroSIN were 0.965 and 0.927 on the CHOIP and THOIP datasets, respectively. In particular, the accuracy improvement by HeteroSIN was significant on the CHOIP dataset, which contains large and complex chemical systems. Furthermore, DimNet++ failed to predict the band gaps on the THOIP dataset because the computational and model complexities of most 3D-structure GNNs significantly increase with respect to the structural complexity of the input graphs [27; 43; 44]. By contrast, HeteroSIN achieved state-of-the-art prediction accuracy based on the CGCNN and GATv2 encoders, which are simple and efficient 2D-structure GNNs.

### Prediction Accuracy for Different Virtual Node Initialization

Virtual node augmentation in Section 3.2 of HeteroSIN is a key concept to handle the complex chemical systems as a set of decomposed substructures. In this experiment, we measured the \(R^{2}\)-scores of HeteroSIN for different initialization methods of the virtual nodes in \(G_{c}\). We implemented four HeteroSIN with the following four different initialization methods of the virtual nodes as:

* **Zero initialization:** The node-features of the augmented virtual nodes in \(G_{c}\) are initialized by zero.
* **Gaussian initialization:** The node-features of the virtual nodes are initialized by the unit Gaussian distribution \((0,1)\).
* **Initialization with I.F.:** The node-features of the virtual nodes are initialized by the vector-shaped representation in Eq. (1) of the decomposed inorganic frame (I.F.).
* **Initialization with q:** The virtual nodes are initialized by the vector-shaped representation in Eq. (1) of the decomposed organic molecule, which is the actual implementation of HeteroSIN.

Table 2 shows the measured \(R^{2}\)-scores of HeteroSin for different initialization methods of the virtual nodes. Although the zero initialization simply set the node-features of the virtual nodes to zero, HeteroSIN achieved comparable prediction accuracy because the appropriate latent embeddings of the zero-initialized virtual nodes are eventually trained through the GNN-based encoders of HeteroSIN. The Gaussian initialization can be regarded as a method to add the Gaussian noise to the input graphs, and it improved the prediction accuracy of HeteroSIN on the HOIP dataset. However, we were

   Dataset & GATv2 & MPNN & CGCNN & UniMP & DimeNet++ & M3GNet & HeteroSIN \\  CHOIP & 0.846 & 0.931 & 0.928 & 0.895 & 0.902 & 0.948 & **0.965** \\  & (\(\)0.038) & (\(\)0.003) & (\(\)0.010) & (\(\)0.026) & (\(\)0.015) & (\(\)0.006) & (\(\)**0.009)** \\   & 0.817 & 0.838 & 0.825 & 0.783 &  & 0.859 & **0.927** \\  & (\(\)0.037) & (\(\)0.024) & (\(\)0.043) & (\(\)0.087) & & (\(\)0.036) & (\(\)**0.046)** \\   

Table 1: Measured \(R^{2}\)-scores of the competitor GNNs and HeteroSIN in the problem of predicting the band gaps of HOIPs on the CHOIP and THOIP datasets. N/A means the negative \(R^{2}\)-score, which indicates the failure of the prediction.

   Dataset & Zero Initialization & Gaussian Initialization & Initialization & Initialization \\  & Initialization & Initialization & with I.F. & with **q** \\  CHOIP & 0.913 & 0.935 & 0.915 & **0.965** \\  & (\(\)0.012) & (\(\)0.017) & (\(\)0.011) & (\(\)**0.009)** \\  THOIP & 0.908 & 0.858 & 0.892 & **0.927** \\  & (\(\)0.035) & (\(\)0.051) & (\(\)0.048) & (\(\)**0.046)** \\   

Table 2: Measured \(R^{2}\)-scores of HeteroSIN on the CHOIP and THOIP datasets for different initialization methods of the virtual node augmentation.

not able to observe the accuracy improvement by the Gaussian Initialization on the THOIP dataset because too many noises are passed to the GNN encoder due to an extensive number of virtual nodes in the HOIPs of the THOIP dataset. For all datasets, HeteroSIN with the virtual node initialization with \(\) showed the highest \(R^{2}\)-scores. This experimental result implies that domain knowledge to initialize the virtual nodes appropriately is crucial for successful machine learning on the complex chemical systems, and it should be studied in future work.

## 5 Conclusion

We proposed a new framework called HeteroSIN to predict the target physical properties of the complex chemical systems containing heterogeneous substructures. We devised a graph decomposition method based on the virtual node augmentation to generate the physically-valid substructures of the atomic systems. We applied HeteroSIN in the problems of predicting the band gaps of HOIPs, which have received significant attention for sustainable energy resources. In the experiment, HeteroSIN achieved state-of-the-art prediction accuracy on the benchmark datasets of HOIPs.