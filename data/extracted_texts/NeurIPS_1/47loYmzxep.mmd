# E2E-MFD: Towards End-to-End Synchronous Multimodal Fusion Detection

Jiaqing Zhang\({}^{1}\), Mingxiang Cao\({}^{1}\), Weiying Xie\({}^{1}\)1, Jie Lei\({}^{2}\),

Daixun Li\({}^{1}\), Wenbo Huang\({}^{3}\), Yunsong Li\({}^{1}\), Xue Yang\({}^{4}\)

\({}^{1}\)The State Key Laboratory of Integrated Services Networks, Xidian University

\({}^{2}\)University of Technology Sydney \({}^{3}\)Southeast University \({}^{4}\)Shanghai AI Laboratory

[https://github.com/icey-zhang/E2E-MFD](https://github.com/icey-zhang/E2E-MFD)

###### Abstract

Multimodal image fusion and object detection are crucial for autonomous driving. While current methods have advanced the fusion of texture details and semantic information, their complex training processes hinder broader applications. Addressing this challenge, we introduce E2E-MFD, a novel end-to-end algorithm for multimodal fusion detection. E2E-MFD streamlines the process, achieving high performance with a single training phase. It employs synchronous joint optimization across components to avoid suboptimal solutions associated to individual tasks. Furthermore, it implements a comprehensive optimization strategy in the gradient matrix for shared parameters, ensuring convergence to an optimal fusion detection configuration. Our extensive testing on multiple public datasets reveals E2E-MFD's superior capabilities, showcasing not only visually appealing image fusion but also impressive detection outcomes, such as a 3.9% and 2.0% mAP\({}_{50}\) increase on horizontal object detection dataset M3FD and oriented object detection dataset DroneVehicle, respectively, compared to state-of-the-art approaches.

## 1 Introduction

Precise and reliable object parsing is critical in fields such as autonomous driving  and remote sensing monitoring . Relying solely on visible sensors can lead to inaccuracies in object recognition in challenging environments, like increment weather conditions. Visible-infrared image fusion [3; 4; 5; 6] as a typical common multimodal fusion (MF) task addresses these challenges by leveraging complementary information from different modalities, leading to the rapid development of various multimodal image fusion techniques [7; 8; 9; 10; 11]. Techniques like CDDFuse  and DIDFuse  employ a two-step process where a MF network is trained initially, followed by training an object detection (OD) network with the results from the MF network to assess fusion effectiveness separately. Although deep neural networks have significantly enhanced the ability to learn representations across modalities, resulting in promising multimodal fusion outcomes, the focus has predominantly been on producing visually appealing images. This emphasis often overlooks the improvement of downstream high-level visual tasks, such as enhanced object parsing, which remains a substantial hurdle.

Recent studies have devoted into designing joint learning methods that integrate fusion networks with high-level tasks such as object detection  and segmentation [15; 16]. The synergy between MF and OD in Multimodal Fusion Detection (MFD) methods has emerged as a vibrant area of research. This partnership allows MF to produce richer, more informative images, enhancing OD performance, while OD contributes valuable object semantic insights to MF, aiming to accurately locate and identify objects in a scene. Typically, MFD networks adopt a cascaded design where jointoptimization techniques  use the OD network to guide the MF network toward creating images that facilitate easier object detection. Notably, Zhao _et. al_ introduced a joint learning method for multimodal fusion detection, incorporating meta-feature embedding from OD to improve fusion by generating semantic object features through meta-learning simulation. Despite these advancements, as highlighted in Figure 1, significant challenges persist: 1) Current optimization approaches rely on a multi-step, progressively joint method, compromising efficiency; 2) These methods overly focus on leveraging OD information for fusion enhancement, leading to difficulty in parameter balancing and susceptibility to local optima of individual tasks. Therefore, the quest for a unified feature set that simultaneously caters to each task remains formidable.

In this paper, we introduce E2E-MFD, an end-to-end algorithm for multimodal fusion detection, designed to seamlessly blend detailed image fusion and object detection from coarse to fine levels. E2E-MFD facilitates the interaction of intrinsic features from both domains through synchronous joint optimization, allowing for a streamlined, one-stage process. To reconcile fine-grained details with semantic information, we propose the novel concept of an Object-Region-Pixel Phylogenetic Tree (ORPPT) coupled with a coarse-to-fine diffusion processing (CFDP) mechanism. This approach is inspired by the natural process of visual perception, tailored to meet the specific needs of MF and OD. Furthermore, we introduce a Gradient Matrix Task-Alignment (GMTA) technique to fine-tune the optimization of shared components, thereby minimizing the adverse impacts traditionally associated with inherent optimization challenges. This ensures an efficient convergence towards an optimal set of fusion detection weights, enhancing both the accuracy and efficacy of multimodal fusion detection.

Our contributions in this paper are highlighted as follows: (1) We present E2E-MFD, a pioneering approach to efficient synchronous joint learning, innovatively integrating image fusion and object detection into a single-stage, end-to-end framework. This methodology significantly enhances the outcomes of both tasks. (2) We introduce a novel GMTA technique, designed to evaluate and quantify the impacts of the image fusion and object detection tasks. This aids in optimizing the training process's stability and ensures convergence to an optimal configuration of fusion detection weights. (3) Through comprehensive experimentation on image fusion and object detection, we demonstrate the efficacy and robustness of our proposed method.

## 2 Related Work

### Multimodal Fusion Object Detection

Due to the powerful nonlinear fitting capabilities of deep neural networks, deep learning has made significant progress in low-level vision tasks, particularly in image fusion tasks [19; 20; 7; 21; 22; 23; 24]. Early efforts [9; 25; 13; 26; 27; 28] tended to achieve excellent fusion results by adjusting network structures or loss functions, overlooking the fact that image fusion should aim to improve the performance of downstream application tasks. Fusion images with good quality metrics may be suitable for human visual perception but may not be conducive to practical application tasks [16; 29]. Some research has acknowledged this issue, Yuan _et al_.  utilized various aligned modalities for improved oriented object detection [31; 32; 33; 34] to address the challenge of cross-modal weakly misalignment in aerial visible-infrared images. Liu _et al_.  proposing a joint learning method,

Figure 1: Comparison of (d) E2E-MFD with existing MF-OD task paradigms (a) Two-Stage (Separate Cascaded), (b) Two-stage (Joint Cascaded) and (c) Multi-stage (Joint Cascaded).

pioneered the exploration of the MF and OD combination methods. Then the optimization of the loss function for segmentation  and detection  has been validated to be effective in guiding the generation of fused images. They consider the downstream task network as an additional constraint to assist the MF network in generating fusion results with clearer objects. Zhao _et al._ leveraged semantic information from OD features to aid MF and perform meta-feature embedding to generate meta-features from OD features, which are then used to guide the MF network in learning pixel-level semantic information. Liu _et al._ proposed multi-interactive feature learning architecture for image fusion and segmentation by enhancing fine-grained mapping of all the vital information between two tasks, so that the modality or semantic features can be fully mutual-interactive. However, OD considers the semantic understanding of objects, while MF and segmentation primarily focus on the pixel-level relationship between image pairs. The optimization coupling of detection and fusion tasks becomes more challenging to investigate these complementary differences, from which both fusion and detection can benefit. It is worth mentioning that these visible-infrared multimodal fusion detection methods are usually designed in a cascaded structure with tedious training steps. Researchers lack the adoption of end-to-end architectures, which would enable one-step network inference to generate credible fused images and detection results through a set of network parameters.

### Multi-task Learning

Multi-task learning (MTL) [35; 36] involves the simultaneous learning of multiple tasks through parameter sharing. Prior approaches involve manually crafting the architecture, wherein the bottom layers of a model are shared across tasks [37; 38]. Some approaches tailor the architecture based on task affinity , while others utilize techniques such as Neural Architecture Search [40; 37; 41] or routing networks  to autonomously discern sharing patterns and determine the architecture. An alternative method typically combines task-specific objectives into a weighted sum [43; 44; 45]. In addition, most approaches (e.g. [46; 47; 48; 49; 50]) aim to mitigate the effects of conflicting or dominating gradients. The approach of explicit gradient modulation [48; 49; 50; 51], has demonstrated superior performance in resolving conflicts between task gradients by substituting conflicting gradients with modified, non-conflicting gradients. Inspired by the above multimodal learning methods, we introduce a Gradient Matrix Task-Alignment method to align the orthogonal components contained in image fusion and object detection tasks thereby effectively eliminating the inherent optimization barrier that exists between two tasks.

## 3 The Proposed Method

### Problem Formulation

MF-OD task concentrates on generating an image that benefits emphasizing objects with superior visual perception capability. The goal of OD is to find the location and identify the class of each object in an image which can naturally provide rich semantic information along with object location information. Therefore, the motivation of OD-aware MF is to construct a novel infrared and visible image fusion framework that can benefit from the semantic information and object location information contained in OD. For this purpose, we suppose a pair of visible image \(^{H W C_{x}}\) and infrared image \(^{H W C_{y}}\). The optimization model is formulated as:

\[_{_{ t}}(,(,;_{ t})), \]

where \(\) represents the output of the different task network \(\) with the learnable parameters \(_{ t}\). \(()\) is a constraint term to optimize the network. Previous approaches solely design image fusion or object detection networks in a cascaded way, which can only achieve outstanding results for one task. To produce visually appealing fused images alongside accurate object detection results, we jointly integrate the two tasks into a unified goal synchronously which can be rewritten as:

\[_{ u},_{ d}=^{ u} (,(,;_{ u}))+( 1-)^{ d}(,(,;_{ d}))+(^{}), \]

where \(^{}=_{ u}^{s}=_{ d}^{s}\), defined as the shared parameters for MF and OD networks. \(\) and \(\) denote the fused image and detection result, which are produced by the MF network \(()\) and OD network \(()\) with the learnable parameters \(_{ u}\) and \(_{ d}\). \(w\) is a predefined weighting factor to balance the task training. \(()\) is a constrained term to jointly optimize the two tasks. In this paper, we regard the \(()\) as a feature learning constrained manner and achieve this goal by designing a Gradient Matrix Task-Alignment training scheme.

### Architecture

Our proposed E2E-MFD is designed with parallel principle, composited by image fusion and object detection sub-network. Details of the whole architecture are shown in Figure 2. A fusion network (ORPPT) and object detection network (CFDP) can sufficiently realize the granularity-aware detail information and semantic information extraction.

**Object-Region-Pixel Phylogenetic Tree.** The important fact of that humans pay more attention to different regions from coarse to fine for object detection in object scale and image fusion in pixel scale. Inspired by a phylogenetic tree, to simulate humans to study the interactions of hierarchies under different granularity views, we construct an Object-Region-Pixel Phylogenetic Tree (ORPPT) as \(()\) to extract different features in multiple region scales. Given an image pair \(^{W H C_{}}\), \(^{W H C_{}}\), we firstly extract image features \(f()\) and \(f()\) by shared parallel backbone to save memory and computing resources. Then these features are added in channel dimension to obtain the final \(L\) multimodal image features \(},...,},...,}^{W_{1} H_{1} C _{1}}\). The parameters in \(f()\) are shared with the OD network.

Although \(f()\) and \(f()\) can describe the characteristics of visible and infrared modalities, they lack insights into the multi-granularity perspective. Therefore, we utilize the branches including the one pixel feature mining module (PFMM) and \(L\) region feature refine module (RFRM) to mine the multiple granularities from coarse to fine. The PFMM \(B_{0}\) is set the same with feature fusion block in the MetaFusion  with the input pair \(,\). We set \(1,2,,l, L\) to denote each region branch. For branch \(l\), a CNN \(_{l}()\) is firstly utilized to extract the granularity-wise feature \(_{l}(})^{W_{2} H_{2} C_{2}}\) at the region level. A set of learnable region prompts \(_{l}=\{_{l,m}^{C_{2}}\}_{m=1}^{M_{l}}\) are introduced to define the \(M_{l}\) different regions of granularity-wise feature, where \(r_{l,m}\) denotes the \(m^{ th}\) region prompt at branch \(l\). Then the feature vector is mapped into the region mask \(_{l}=\{_{l,m}^{W_{2} H_{2}}\}_{m=1}^ {M_{l}}\) by conducting the dot product between the feature vector and region prompt followed by batch normalization and a ReLU activation:

\[_{l}={ ReLU}({ BN}(_{l}_{l}(})). \]

Finally, the vector of the object-level feature is weighted by the region mask and further aggregated to form region representation:

\[b_{l,m}^{i,j}(})=_{l,m}^{i,j}_{l}^{i,j}(}), \]

where \(b_{l,m}(})\) denotes the \(m^{ th}\) region representation and \((i,j)\) denotes the spatial location. These region-level representations are further concatenated to form the observation \(B_{l}(})=[b_{l,1}(}),b_{l,2}(}),,b_{l,M_{l}}( })]\) of branch \(l\). These multi-grained attentions concentrate operation on the spatial location information and the extent of the regions which are similar to the task requirements. The \(B_{1}\), \(B_{2}\),..., \(B_{L}\) are up-sampled to keep the consistent spatial size with the

Figure 2: An overview of the proposed E2E-MFD framework, which consists of a backbone, nodes, and branches. The backbone is utilized to extract multimodal image features. A fine-grained fusion network (ORPPT) and diffusion-based object detection network (CFDP) are optimized by synchronous joint optimization (GMTA) in an end-to-end manner.

pixel-level fusion features \(B_{0}\). Then, the region-level fusion features \(B_{1},B_{2},...,B_{L}\) are assembled by addition operation followed by a Convolution with \(1 1\) kernel + ReLU to reduce the channel numbers. Highlighted region-level features are extracted by a Convolution with \(1 1\) kernel + Sigmoid and then injected into pixel-level features by multiplication and addition. Finally, five Convolutions with \(3 3\) kernel + ReLU layers are constructed to reconstruct the fusion result \(u\).

**Coarse-to-Fine Diffusion Process.** Diffusion models, inspired by nonequilibrium thermodynamics, are a class of likelihood-based models. DiffusionDet  is the first neural network model to utilize the diffusion model for object detection, introducing a novel paradigm that achieves promising results compared to traditional object detection models. Combining diffusion simulation with the diffusion and recovery process of the object box, the Coarse-to-Fine Diffusion Process (CFDP) introduces it as an efficient detection head to assist fusion networks to focus more on object areas. CFDP model defines a Markovian chain of diffusion forward process by gradually adding noise to a set of bounding boxes. The forward noise process is defined as:

\[q(_{t}_{0})=(_{t}_{t}}_{0},(1-_{t})), \]

which transforms bounding boxes \(z_{0}^{N 4}\) to a latent noisy bounding boxes \(_{t}\) for \(t\{0,1,,T\}\) by adding noise to \(_{0}\). \(_{t}:=_{s=0}^{t}_{s}=_{s=0}^{t}(1-_{s})\) and \(_{s}\) represents the noise variance schedule. During training stage, a neural network \(_{_{}}(z_{t},t)\) is trained to predict \(z_{0}\) from \(z_{t}\) by minimizing the training objective with \(_{2}\) loss:

\[_{}=\|_{_{}}( _{t},t)-_{0}\|^{2}. \]

At inference stage, bounding boxes \(z_{0}\) is reconstructed from noise \(z_{T}\) with the model \(_{_{}}\) and updating rule in an iterative way, i.e., \(_{T}_{T-}_{0}\). In this work, we aim to solve the object detection task via the diffusion model. A neural network \(_{_{}}(_{t},t,,)\) is trained to predict \(z_{0}\) from noisy boxes \(_{t}\), conditioned on the corresponding image pair \(,\).

### Loss Function

The total loss is combined with an image fusion loss function \(_{}\) and object detection loss \(_{}\). \(_{}\) consists of three types of losses, i.e., structure loss \(_{}\), pixel loss \(_{}\) and gradient loss \(_{}\). For one fused image, it should preserve overall structures and maintain a similar intensity distribution from source images. To this end, the structural similarity index (SSIM) is introduced in function:

\[_{}=(1-(,))/2+( 1-(,))/2, \]

where \(_{}\) denotes structure similarity loss. In the fused image, we expect the object regions to have a more significant contrast compared to the background region. Therefore, the object regions need to preserve the maximum pixel intensity and the background region needs to be slightly below the maximum pixel intensity to bring out the contrast between the object and background. The ground-truth bounding boxes of the objects in images are denoted as \((x_{c},y_{c},w,h)\) for horizontal boxes and \((x_{c},y_{c},w,h,)\) for rotated boxes, where \((x_{c},y_{c})\) is the center location, \(w\) and \(h\) are the width and height, \(=angle*pi/180\), respectively. Based on these ground-truth bounding boxes, we construct the object mask \(I_{m}\), and the background mask is denoted as \(1-I_{m}\). The object regions pixel loss \(_{}^{}\) and the background region pixel loss \(_{}^{}\) are formulated as:

\[_{}^{}=\|I_{m}(-max(,))\|_{1},_{}^{}=\| (1-I_{m})(-mean(,))\|_{1}, \]

where

### Gradient Matrix Task-Alignment

The MF and OD tasks have distinct optimization objectives. MF primarily emphasizes capturing the pixel-level relationship between image pairs, while OD incorporates object semantics within the broader context of diverse scenes. An inherent optimization barrier exists between these two tasks. We observe that the prevailing challenges in multi-task learning are arguably task dominance and conflicting gradients. We introduce a Gradient Matrix Task-Alignment (GMTA) by presenting the condition number to mitigate the undesired effects of the optimization barrier in task-shared parameters \(^{*}\) which are supposed to be balanced between the MF and OD tasks. The individual task gradients of MF and OD task are calculated by \(_{u}=_{^{*}}_{u}\) and \(_{d}=_{^{*}}_{d}\) in the training optimization process. The gradient matrix can be defined as \(=\{_{u},_{d}\}\). In multi-task optimization, a cumulative gradient \(=\) is a linear combination of task gradients and the stability of a linear system is measured by the condition number of its matrix in numerical analysis. Hence the stability of the gradient matrix is equal to the ratio of the maximum and minimum singular values (non-negative) of the corresponding matrix: \(()=}}{_{}}\). Learning from the Aligned-MTL , the condition number is optimal (\(()=1\)) if and only if the gradients are orthogonal and equal in magnitude which means that the system of gradients has no dominance or conflicts:

\[()=1<_{u},_{d}>=1. \]

The final linear system of gradients defined by \(}\) satisfies the optimal condition in terms of a condition number. Thereby, we consider the feature learning constraint \((^{*})\) can be defined as the following optimization to eliminate instability in the training process:

\[_{}}\|-}\|_{F}^{2}(})=1 _{}}\|-}\|_{F}^{2}}^{}}=. \]

The problem can be treated as a Procrustes problem and can be solved by performing a singular value decomposition (SVD) to \(\) (\(=^{T}\)) and rescaling singular values corresponding to principal components so that they are equal to the smallest singular value:

\[}=^{}=^{-1}^{T}, \]

where,

\[(,)=eigh(^{}), \]

\[^{-1}=diag(},}), \]

\(eigh\) represents a function for finding eigenvectors \(\) and eigenvalues \(\) and \(diag\) stands for diagonal matrix. \(_{max}\) and \(_{min}\) are maximum eigenvalues and minimum eigenvalues from \(\).The stability criterion, a condition number, defines a linear system to an arbitrary position scale. To alleviate this ambiguity, we choose the largest scale that guarantees convergence to the optimum: this is a minimal singular value of an initial gradient matrix:

\[=_{}()=}. \]

Figure 3: Visual results of image fusion on M3FD.

## 4 Experiments and Analysis

### Dataset and Implementation Details

We conduct experiments on four widely-used visible-infrared image datasets: **TNO**, **RoadScene**, **M3FD** and **DroneVehicle**. TNO and RoadScene are just used to evaluate MF performance. M3FD is adopted to evaluate both MF and OD performance. RoadScene with 37 image pairs, TNO with 42 image pairs and M3FD with 300 pairs are only used for the MF task in the testing stage, and the MF network is trained by the M3FD dataset which is divided into a training set (2,940 image pairs) and a testing set (1,260 image pairs). Besides, DroneVehicle consists of 28,439 image pairs is utilized to train and test MF and OD for oriented objects. We conduct all the experiments with one GeForce RTX 3090 GPU, and the code of M3FD is based on Detectron2 , while the code of DroneVehicle is based on MMDetection 2.26.0  and MMRotate 0.3.4 . On the M3FD dataset, the pretrained DiffusionDet is used for the initialization of the OD network. In the training phase, E2E-MFD is optimized by AdamW with a batch size of 1. We set the learning rate to \(2.5e-5\) and the weight decay as \(1e-4\). The default training iteration is only 15,000. On the DroneVehicle dataset, the pretrained LSKNet  is used for the initialization of the object detection network, and we fine-tune it for 12 epochs with a batch size of 4. The E2E-MFD is optimized by AdamW and the learning rate and the weight decay is set to \(1e-4\) and 0.05.

### Main Results

**Results on Multimodal Image Fusion.** Qualitative results of different fusion methods are depicted in Figure 3. All the fusion methods can fuse the main features of the infrared and visible images to some extent and we can observe two remarkable advantages of our method. First, the significant characteristics of infrared images can be effectively highlighted by our method. Our M3FD fusion image captures the person riding a motorcycle. In comparison with other methods, our method demonstrates high contrast and recognition of the objects. Second, our method preserves rich details from the visible images, including color and texture. Our advantages are evident in the fusion images across the M3FD dataset, such as the clear outline of the white car's rear and a man on a motorcycle. While retaining a substantial amount of detail, our method maintains a high resolution without introducing blurriness. In contrast, other methods fail to achieve these two advantages simultaneously. Sequentially, we provide quantitative results of different fusion methods in Table 1. Our E2E-MFD generally achieves the best metric values. Specifically, the largest average value on MI proves that our method transfers more considerable information from both source images. Values of EN reveal that our results contain edged details and the highest contrast between objects and the background. The large VIF shows our fusion results have high-quality visual effects and small distortion compared with the source images. Moreover, our method achieves the fastest training time to finish the joint learning at one stage which means that faster iterative updates can be done on new datasets. The test time to generate a fused image ranked third.

**Results on Multimodal Object Detection.** To more effectively evaluate the fusion images and observe their impact on downstream detection tasks, we conduct tests using the baseline detector YOLOv5s on all SOTA methods on the M3FD dataset. We follow the same parameter settings, and the visualization results are shown in Figure 4. The detection results are poor when using only single-modal image inputs, with instances of missed detection, such as the motorcycle and rider next to the car and people on the far right in the image. Almost all fusion methods reduce

    &  &  &  &  &  &  \\  & & **EN** & **MI** & **VIF** & **EN** & **MI** & **VIF** & **EN** & **MI** & **VIF** & **Time** & **Time** \\   & DIDFuse & 6.13 & 14.65 & 1.51 & 6.30 & 15.30 & 1.47 & 6.67 & 16.65 & 1.55 & 3h9m388 & 0.096s \\  & U2Fusion & 5.66 & 14.22 & 1.50 & 5.78 & 14.89 & 1.49 & 6.25 & 16.30 & 1.57 & 4h8m36s & 2.091s \\  & PIAFusion & 5.75 & 13.92 & 1.59 & 5.05 & 13.61 & 1.36 & 6.37 & 16.22 & 1.58 & 5h53m20s & 0.003s \\  & SwinFusion & 5.80 & 13.83 & 1.58 & 6.09 & 14.28 & 1.55 & 6.30 & 15.93 & 1.60 & 3h38m5s & 0.044s \\  & CDDFuse & 5.77 & 13.82 & 1.58 & 6.21 & 15.03 & 1.49 & 6.54 & 16.54 & 1.57 & 5h59m59m59s & 0.096s \\   & Tardat & 5.72 & 14.68 & 1.47 & 5.87 & 14.99 & 1.43 & 6.72 & 16.98 & 1.54 & 5h56m22s & 0.093s \\  & Metafusion & 6.20 & 15.19 & 1.54 & 6.29 & 16.03 & 1.44 & 6.35 & 16.76 & 1.57 & 6h47m38s & **0.002s** \\  & E2E-MFD & **6.36** & **15.47** & **1.65** & **6.40** & **16.28** & **1.60** & **6.79** & **17.11** & **1.69** & **2h50m32s** & 0.014s \\   

Table 1: Quantitative results of different fusion methods on TNO, RoadScene, and M3FD datasets. The model training (Tr.) and test (Te.) time is counted on an NVIDIA GeForce RTX 3090. The best result is **highlighted**.

missed detection and improve confidence by fusing information from both modalities. Through the design of an end-to-end fusion detection synchronous optimization strategy, we obtain fusion images that are visually and detection-friendly, especially for occluded and overlapping objects, as seen in the blue ellipse with the motorcycle and the overlapping people on the far right in the image. To further assess the quality of fusion images, we conduct a fair comparison between our method and the SOTA methods on YOLOv5s. As shown in Table 2, the MF methods demonstrate a performance improvement compared to single-modal detection, indicating that well-fused images can effectively assist downstream tasks. In contrast, the fusion image we generate has achieved the best performance on YOLOv5s. Additionally, the detection performance of fusion images on DiffusionDet is also impressive, albeit slightly lower than when optimizing fusion and detection tasks

  
**Task** & **Method** & **People** & **Car** & **Bus** & **Motorcycle** & **Lamp** & **Truck** & **mAP\({}_{50}\)** & **mAP\({}_{50-95}\)** \\   & Infrared & 49.3 & 67.1 & 72.9 & 35.8 & 43.6 & 61.6 & 85.3 & 55.1 \\  & Visible & 38.1 & 69.4 & 75.5 & 44.4 & 48.8 & 63.2 & 86.3 & 55.9 \\   & DIDFusion & 45.8 & 68.8 & 73.6 & 42.2 & 43.7 & 61.5 & 86.2 & 56.2 \\  & U2Fusion & 47.7 & **70.1** & 73.2 & 43.2 & 44.6 & 63.9 & 87.1 & 57.1 \\  & PIAFusion & 46.5 & 69.6 & 75.1 & 45.4 & 44.8 & 61.7 & 87.3 & 57.2 \\  & SwinFusion & 44.5 & 68.5 & 73.3 & 42.2 & 44.4 & 63.5 & 85.8 & 56.1 \\  & CDPWe use & 46.1 & 69.7 & 74.2 & 42.2 & 44.2 & 62.7 & 87.0 & 56.5 \\   & CFT & 52.0 & 68.2 & 79.2 & 49.9 & 45.2 & 69.6 & 89.8 & 60.7 \\  & ICAFusion & 48.8 & 68.5 & 72.3 & 45.5 & 43.6 & 64.7 & 87.4 & 57.2 \\   & Iardal & 49.8 & 65.4 & 69.3 & 46.6 & 43.7 & 61.1 & 86.0 & 56.0 \\  & MetaFusion & 48.4 & 66.7 & 70.5 & 49.1 & 46.4 & 59.9 & 86.7 & 56.8 \\  & Ours (YOLOv5s)\({}^{}\) & 51.0 & 67.9 & 69.4 & 50.2 & **48.7** & 61.6 & 87.9 & 58.1 \\  & Ours (DiffusionDet)\({}^{}\) & 58.5 & 67.7 & 79.9 & 50.3 & 46.2 & 70.2 & 90.3 & 62.1 \\  & Ours (E2E-MFD) & **60.1** & 69.5 & **81.4** & **52.2** & 47.6 & **72.2** & **91.8** & **63.8** \\   

Table 2: Quantitative results of object detection on M3FD dataset among all the image fusion methods + detector (i.e. YOLOv5s ). \({}^{}\) means using the fusion images generated by E2E-MFD for object detection training. The best result is **highlighted**.

Figure 4: Visual results of object detection on M3FD.

  
**Modality** & **Detectors** & **Car** & **Truck** & **Freight Car** & **Bus** & **Van** & **mAP\({}_{50}\)** \\   & RetinaNet-OBB  & 67.5 & 28.2 & 13.7 & 62.1 & 19.3 & 38.1 \\  & Faster R-CNN-OBB  & 67.9 & 38.6 & 26.3 & 67.0 & 23.2 & 44.6 \\  & Giding Vertex  & 75.8 & 46.1 & 33.8 & 68.1 & 38.7 & 52.5 \\  & YOLOv5s-OBB  & 89.0 & 53.6 & 41.9 & 84.8 & 32.6 & 60.4 \\  & LSKNet-OBB  & 89.5 & 70.0 & 51.8 & 89.4 & 56.9 & 71.5 \\   & RetinaNet-OBB  & 79.9 & 32.8 & 28.1 & 67.3 & 16.4 & 44.9 \\  & Faster R-CNN-OBB  & 88.6 & 42.5 & 35.2 & 77.9 & 28.5 & 54.6 \\  & Giding Vertex  & 89.2 & 59.7 & 43.0 & 78.8 & 43.9 & 62.9 \\  & YOLOv5s-OBB  & 95.6 & 57.2 & 47.5 & 89.4 & 35.2 & 65.0 \\  & LSKNet-OBB  & 90.3 & 73.3 & 57.8 & 89.2 & 53.2 & 72.8 \\   & UA-CMDet  & 87.5 & 60.7 & 46.8 & 87.1 & 38.0 & 64.0 \\  & TSFADet  & 89.2 & 72.0 & 54.2 & 88.1 & 48.8 & 70.4 \\  & CALNet  & 90.3 & 76.2 & 63.0 & 89.1 & 58.5 & 75.4 \\  & Ours (YOLOv5s-OBB)\({}^{}\) & **96.7** & 69.9 & 49.9 & **92.6** & 44.5 & 70.7 \\  & Ours (LSKNet-OBB)\({}^{}\) & 90.3 & 77.0 & 63.5 & 89.5 & 59.0 & 75.9 \\  & Ours (E2E-MFD) & 90.3 & **79.3** & **64.6** & 89.8 & **63.1** & **77.4** \\   

Table 3: Quantitative results of object detection on DroneVehicle test sets among all the SOTA methods, where \({}^{}\) means using the fusion images generated by E2E-MFD for object detection training and testing. The best result is **highlighted**.

[MISSING_PAGE_FAIL:9]

the network determines task optimization directions.

However, excessively large \(n\) leads to significant deviations in task paths, making alignment more challenging and negatively impacting performance.

**Study of Branches in the Object-Region-Pixel Phylogenetic Tree.** We investigate the combination of the pixel feature mining module (0) and the region feature refinement module (1,2,3,4). The results are shown in Table 7. It can be observed that with the increase in the number of branches, the fusion network achieves higher image fusion quality and object detection performance. Region features provide the fusion network with multi-level semantic features of objects. However, when higher-level semantic object information is added, the performance of the fusion network declines. This is because the detailed information contained in the deeper layers of the backbone structure shared with the detection network decreases abruptly, which may affect the fusion network's absorption of these features, thereby influencing pixel-level fusion tasks.

We have implemented the Object-Region-Pixel Phylogenetic Tree (ORPPT) to explore the hierarchical interactions under different granularity views and extract various features across multiple region scales, as introduced in Section 3.2. As shown in Figure 6, the detailed information will decrease as the backbone structure shared by the detection network deepens, resulting in a decrease in detailed information. This may affect the absorption of these features by the fusion network of the shared backbone network, thereby affecting pixel-level fusion tasks. This provides evidence for our analysis of the reasons for Section 4.3 ablation experiment for Object-Region-Pixel Phylogenetic Tree. This illustrates the importance of balancing the semantic information provided between the OD and MF network with pixel-level information.

## 5 Conclusion

Within this paper, an end-to-end optimization is proposed to formulate fusion and detection in a harmonious one-stage training process. We introduce a object-region-pixel phylogenetic tree structure and coarse-to-fine diffusion process to simulate these two tasks in different visual perceptions needed for diverse task requirements. In addition, we align the orthogonal components of the fusion detection linear system of the gradients by gradient matrix task-alignment. By unrolling the model to a well-designed fusion network and diffusion-based detection network, we can generate a visual-friendly result for fusion and object detection in an efficient way without tedious training steps and inherent optimization barriers.

 
**Branch** & **EN** & **MI** & **VIF** & **mAP\({}_{50}\)** & **mAP\({}_{0:0.95}\)** \\ 
0 & 6.10 & 15.19 & 1.54 & 91.51 & 63.20 \\
0,1 & 6.10 & 15.29 & 1.54 & 91.65 & 62.96 \\
0,1,2 & 6.19 & 15.28 & 1.58 & 91.73 & 63.46 \\
0,1,2,3 & **6.36** & **15.47** & **1.65** & **91.80** & **63.83** \\
0,1,2,3,4 & 5.99 & 14.31 & 1.40 & 91.73 & 63.55 \\  

Table 7: Ablation study of the number of ORPPT branches on M3FD.

Figure 5: Visualization of task dominance and conflicting gradients in joint learning of OD and MF.

Figure 6: Feature map visualization of various branches in the ORPPT.