# Towards Optimal Effective Resistance Estimation

Rajat Vadiraj Dwaraknath

Stanford University

rajatvd@stanford.edu &Ishani Karmarkar

Stanford University

ishanik@stanford.edu &Aaron Sidford

Stanford University

sidford@stanford.edu

###### Abstract

We provide new algorithms and conditional hardness for the problem of estimating effective resistances in \(n\)-node \(m\)-edge undirected, expander graphs. We provide an \((m^{-1})\)-time algorithm that produces with high probability, an \((n^{-1})\)-bit sketch from which the effective resistance between any pair of nodes can be estimated, to \((1)\)-multiplicative accuracy, in \((1)\)-time. Consequently, we obtain an \((m^{-1})\)-time algorithm for estimating the effective resistance of all edges in such graphs, improving (for sparse graphs) on the previous fastest runtimes of \((m^{-3/2})\)[Chu et. al. 2018] and \((n^{2}^{-1})\)[Jambulapati, Sidford 2018] for general graphs and \((m+n^{-2})\) for expanders [Li, Sachdeva 2022]. We complement this result by showing a conditional lower bound that a broad set of algorithms for computing such estimates of the effective resistances between all pairs of nodes require \((n^{2}^{-1/2})\)-time, improving upon the previous best such lower bound of \((n^{2}^{-1/13})\)[Musco et. al. 2017]. Further, we leverage the tools underlying these results to obtain improved algorithms and conditional hardness for more general problems of sketching the pseudoinverse of positive semidefinite matrices and estimating functions of their eigenvalues.

## 1 Introduction

In a weighted, undirected graph \(G\) the _effective resistance_ between a pair of vertices \(a\) and \(b\), denoted \(r_{G}(a,b)\), is defined as the energy of a unit of electric current sent from \(a\) to \(b\) in the natural resistor network induced by \(G\). Effective resistances arise for a broad set of graph processing tasks and have multiple equivalent definitions. For example, \(r_{G}(a,b)\) is proportional to the expected roundtrip commute time between \(a\) and \(b\) in the natural random walk induced on the graph and when \(\{a,b\}\) is an edge in the graph, it is proportional to the probability that the edge is in a random spanning tree.

Effective resistances also form a particular class of metrics on the vertices  and are a key measure of proximity between vertex pairs. Correspondingly, effective resistances can arise in a variety of data analysis tasks. For example, effective resistances have been used in social network analysis for measuring edge centrality in social networks  as well as for measuring chemical distances .

Effective resistances have a broad range of algorithmic implications. Sampling edges of a graph using effective resistance is known to efficiently produce cut and spectral sparsifiers (sparse graphs which approximately preserve cuts, random walk properties, and more) . Effective resistance-based graph sparsifiers have also been applied to develop fast graph attention neural networks , to design graph convolutional neural networks for action recognition , to sample from Gaussian graphical models , and beyond . Effective resistances have also been used in algorithms for maximum flow problems, , sampling random spanning trees , and graph partitioning . More recently, effective resistances have also been used to analyze the problem of oversquashing in GNNs and in designing algorithms to alleviate oversquashing  and have been applied to increase expressivity when incorporated as edge features into certain GNNs .

Algorithms.Given the broad utility of effective resistances, there have been many methods for estimating and approximately compressing them . In this paper, our main focus is the following effective resistance estimation problem. (We use \(x_{}y\) as shorthand for \((1-)y x(1+)y\) and assume all edge weights in graphs are positive. See Section 2 for notation more broadly).

**Definition 1** (Effective Resistance Estimation Problem).: _In the effective resistance estimation problem we are given an undirected, weighted graph \(G=(V,E,w)\), a set of vertex pairs \(S V V\), and \((0,1)\) and must output \(^{S}\) such that with high probability (whp.), \(_{(a,b)}_{}r_{G}(a,b)\) for all \((a,b) S\)._

The state-of-the-art runtimes for solving the effective resistance estimation problem on \(n\)-node, \(m\)-edge graphs are given in Table 2. To contextualize these results, consider the special case of estimating the effective resistance of a graph's edges, i.e., when \(S=E\). This special case appears in many of the aforementioned applications, e.g., . The state-of-the-art runtimes for this problem are \((n^{2}^{-1})\) due to  and \((m^{-1.5})\) due to . A major open problem is whether improved runtimes, e.g., \((m^{-1})\) (which would subsume prior work), are attainable.

One of the main results of this paper is resolving this open problem in the case of well-connected graphs, i.e., expanders. Expanders are a non-trivial, previously studied, special case that is often the first step or a key component for developing more general algorithms . In particular we provide an \((m^{-1}(G))\) time algorithm where \(\) is a measure of the graph's connectivity. Previously, the only non-trivial improvement in this setting was an independently obtained runtime of \((m+n^{-2}((G))^{3/2})\) for graphs with \((G)=(1)\). We improve upon the result of  for sparse enough graphs and, as we explain in Section 1.1, we can almost match the result of  (up to an \(m^{o(1)}\) factor) in dense graphs. 1

Interestingly, we obtain our main result by providing new effective resistance sketch algorithms.

**Definition 2** (Effective Resistance Sketch).: _We call a randomized algorithm an \((_{},_{},s)\)-effective resistance sketch algorithm if given an input \(n\)-node, \(m\)-edge undirected, weighted graph \(G=(V,E,w)\) and \((0,1)\) in time \(O(_{}(G,))\) it creates a binary string of length \(O(s(G,))\) from which when queried with any \(a,b V\), it outputs \(_{a,b}_{}r_{G}(a,b)\) whp. in time \(O(_{}(G,))\)._

Effective resistance sketching algorithms immediately imply algorithms for the effective resistance estimation problem. We obtain our result by obtaining an \(((m^{-1}),(1),(n^{-1}))\)-effective resistance sketch algorithm for expanders (see Section 1.1 for a comparison to prior work).

Lower Bounds.Given the central role of effective resistance estimation and the challenging open-problem of determining its complexity, previous work has sought complexity theoretic lower bounds for the problem.  showed a conditional lower bound of \((n^{2}^{-1/13})\) for the problem by showing that an algorithm that computes effective resistances in \((n^{2}^{-1/13+})\) for some \(>0\) time could be used to obtain a subcubic algorithm for the _triangle detection problem_, that we define below.

**Definition 3** (Triangle Detection Problem).: _Given an \(n\)-node undirected unweighted graph \(G=(V,E)\), determine whether there are distinct \(a,b,c V\) with \(\{a,b\} E\), \(\{b,c\} E\) and \(\{c,a\} E\)._

Currently, the only known subcubic algorithms for the triangle detection problem leverage fast matrix multiplication (FMM) and therefore their practical utility (in the worst case) is questionable.

**Theorem 1** (Informal, ).: _Given an algorithm which solves the triangle detection problem in subcubic time, we can produce a subcubic algorithm, which only performs combinatorial operations and uses the triangle detection algorithm, for Boolean matrix multiplication (BMM) and additional problems which currently are not known to be solvable subcubicly without FMM._

This theorem implies that any subcubic algorithm for triangle detection that doesn't use FMM implies a subcubic BMM algorithm that doesn't use FMM. Consequently, subcubic triangle detection is a common hardness assumption used to illustrate barriers towards improving non-FMM based methods, e.g., the effective resistance estimation algorithms of this paper.

In this paper we take a key step towards closing the gap between the best known running times for effective resistance estimation and lower bounds by improving the conditional lower bound of \((n^{2}^{-1/13})\) to \((n^{2}^{-1/2})\) for randomized algorithms. We show this lower bound holds _even for expander graphs_, and hence our effective resistance estimation algorithm (as well as ) are optimal up to an \(^{-1/2}\)-factor among non-FMM based algorithms, barring a major breakthrough in BMM.

Broader Linear Algebraic Tools.The effective resistance between vertex \(a\) and vertex \(b\) in a graph \(G\) has a natural linear algebraic formulation. For all \(a,b V\) it is known that \(r_{G}(a,b)=_{a,b}_{G}^{}_{a,b}\), where \(_{G}^{V V}\) is a natural matrix associated with \(G\) known as the _Laplacian matrix_ and \(_{a,b}=e_{a}-e_{b}\) (see Section 2 for notation). Thus, sketching effective resistances can be viewed as problems of preserving information about subsets of entries of the pseudoinverse of a Laplacian.

Both our algorithms and lower bounds develop more general tools for handling related problems for more general (not-necessarily Laplacian) matrices. On the algorithmic side, we show our techniques can also lead to algorithms and data structures for computing certain quadratic forms involving well-conditioned SDD and PSD matrices. On the hardness side, we show our techniques also improve triangle detection hardness bounds for estimating various properties of the singular values of a matrix.

Paper Organization.In the remainder of the introduction we provide a more precise statement and comparison of our results in Section 1.1. In the remainder of the paper we cover preliminaries in Section 2, present upper bounds in Section 3, and present lower bounds in Section 4. Omitted proofs and additional discussion of related proofs are deferred to the supplementary material.

### Our Results

Algorithms.Here we outline our main algorithmic results pertaining to effective resistance sketching and estimation, and in Section 3 we describe a extensions of our work to broader linear algebraic problems involving SDD and PSD matrices. Our main algorithmic result is a new efficient effective resistance sketch for _expanders_, a term which is used to refer to graphs with \((1)\)-expansion.

**Definition 4** (Expander).: _For \(>0\), we say that a graph \(G=(V,E,w)\) has \(\)-expansion if \((G)\), where \((G)\) denotes the conductance of \(G\) and is defined as_

\[(G):=_{S V,S\{0,V\}}:w S,v V  S}w_{u,v}}{(_{u S}d_{u},_{v V S}d_{ u})},d_{u}:=_{\{u,v\} E}w_{u}.\]

**Theorem 2**.: _There is an \((}(m^{-1}),}(1), {}(n^{-1}))\)-effective resistance sketch algorithm for graphs with \((1)\)-expansion._

Table 1 summarizes and compares our Theorem 2 to previous work on effective resistance sketches, including naive algorithms to explicitly compute the pseudoinverse of the Laplacian of \(G\), which can be computed in \(O(n^{})\) time using FMM or \(}(mn)\) time using a Laplacian system solver (labeled Solver). 2 A \((_{},_{},s)\) effective-resistance sketch algorithm implies an \(O(_{}+|S|_{})\) algorithm for the effective resistance estimation problem. Hence, Theorem 2 implies the following.

**Theorem 3** (Effective Resistance Estimation on Expanders).: _There is an \(}(m^{-1}+|S|)\) time algorithm which solves the effective resistance estimation problem for graphs with \((1)\)-expansion._

Effective resistance sketches are a common approach to solving the effective resistance estimation problem; but there are also approaches to the problem that do not explicitly construct effective resistance sketches. Table 2 summarizes prior work on effective resistance estimation more broadly.

There has been a long line of research on the problem of computing sketches and sparsifiers of graph Laplacians  (i.e., computing a sparse graph \(G^{}\) such that quadratic forms in the Laplacian of \(G^{}\) approximately preserves quadratic forms in the Laplacian of \(G\)). Building on this work,  showed there is an algorithm which processes a graph \(G\) on \(n\) nodes and \(m\) edges in \(O(m^{1+o(1)})\) time and produces a sparse sketch graph \(H\) with only \(}(n^{-1})\) edges such that \(r_{G}(a,b) r_{H}(a,b)\)for all \(a,b V\). Consequently, any algorithm which runs in \((m^{-c})\) on expanders can be improved to run in \((m^{1+o(1)}+n^{-(c+1)})\) on expanders simply by running the algorithm on \(H\) instead of \(G\).

Summary of prior work on Effective Resistance Sketch (Table 1) and Effective Resistance Estimation (Table 2) algorithms on \(n\)-node, \(m\)-edge expanders. All time and space complexities are reported up to to \(()\). The methods of This Paper and  apply only to expanders; however, the remaining works apply to general graphs. As discussed, when \(m^{1+o(1)}+n^{-(c+1)}=o(m^{-c})\), any runtime dependence on \(m^{-c}\) in the table can be improved to a dependence on \(m^{o(1)+1}+n^{-(c+1)}\).

Lower BoundsFor the effective resistance estimation problem,  showed that any combinatorial algorithm (i.e., an algorithm that uses only combinatorial operations in the sense of Theorem 1) which solves the effective resistance estimation problem for \(S=V V\) in \((n^{2}^{-1/13+})\) for some \(>0\), would imply a combinatorial subcubic deterministic algorithm which detects a triangle in an \(n\)-node undirected unweighted graph. We improve on their result, as follows.

**Theorem 4**.: _Given a combinatorial algorithm which solves the effective resistance estimation problem for \(S=V V\) on graphs with \((1)\)-expansion in \((n^{2}^{-1/2+})\) time for \(>0\), we can produce a randomized combinatorial algorithm which solves the triangle detection problem on an \(n\)-node graph in \((n^{3-2})\) time whp._

Theorem 4 implies an \((n^{2}^{-1/2})\) randomized conditional lower bound for the problem of estimating effective resistances of all pairs of nodes in an undirected unweighted expander graph, while  shows only an \((n^{2}^{-1/13})\) lower bound. As we show in Section 4, by a simple reduction we can extend any \((n^{2}^{-c})\) lower bound for the all-pairs effective resistance problem to a \((m^{-c})\) lower bound for the all-edges effective resistance problem. Consequently, our result also yields a \((m^{-1/2})\) randomized lower bound for the problem of estimating effective resistances of all edges in an undirected expander graph.

In addition to conditional lower bounds for effective resistance estimation, we also improve on existing conditional lower bounds for the problem of estimating spectral sums that we define below.

**Definition 5** (Spectral Sum).: _For \(f:^{+}^{+}\) and \(^{n n}\) with singular values \(_{1}()_{2}() _{n}()\), we define the spectral sum \(_{f}:^{n n}^{+}\) as \(_{f}():=_{i=1}^{n}f(_{i}())\)._

 showed that for several spectral sums \(_{f}\), any combinatorial algorithm that outputs \(Y_{}_{f}()\) in \((n^{}^{-c})\) time on an \(n n\) PSD matrix would imply an \(O(n^{+ c})\) time combinatorial algorithm which solves the triangle detection problem, where the scaling \(\) varies depending on the specific \(_{f}\) (see Table 3). We build on their results to show improved randomized conditional lower bounds for several spectral sum estimation problems, as presented in Theorem 5 below.

**Theorem 5**.: _Given a combinatorial algorithm which on input \(^{n n}\) outputs a spectral sum estimate \(Y_{}_{f}()\) in \(O(n^{}^{-c})\) time with \( 2\) for the spectral sums in Table 3, we can produce a randomized combinatorial algorithm that can detect a triangle in an \(n\)-node graph whp. in \((n^{+ c})\) time, where \(\) is a scaling that depends on properties of the function \(f\) (see Table 3 for values of \(\) for several spectral sums.)_

   Citation & \(_{p}\) & \(_{q}\) & \(s\) & Citation & Runtime & \(S\) Restrictions \\  FMM & \(n^{}\) & \(1\) & \(n^{2}\) & FMM & \(n^{}+|S|\) & None \\ Solver & \(nm\) & \(1\) & \(n^{2}\) & Solver & \(nm+|S|\) & None \\
 & \(m^{-2}\) & \(^{-2}\) & \(n^{-2}\) &  & \(n^{2}^{-2}\) & \(S=V V\) \\
 & \(n^{2}^{-1}\) & \(1\) & \(n^{-1}\) &  & \(n^{2}^{-1}\) & \(S=V V\) \\
 & \(m+n^{-2}\) & \(1\) & \(n^{-1}\) &  & \(m+(n+|S|)^{-2}\) & None \\
**This Paper** & \(m^{-1}\) & \(1\) & \(n^{-1}\) &  & \(m+|S|\,^{-2}\) & None \\  & & & &  & \(m^{-1.5}\) & \(S=E\) \\  & & & &  & \(m+n^{-2}+|S|\) & None \\  & & & & **This Paper** & \(m^{-1}+|S|\) & None \\   

Table 1: Effective Resistance Sketch

## 2 Preliminaries

General notation.We use \(_{i,j}\) to denote the \((i,j)\)-th entry of \(\). For \(^{n n}\) we use \(()\) for its spectrum, \(_{i}()\) and \(_{i}()\) for its \(i\)-th smallest eigenvalue and singular value respectively, and \(():=|_{n}()|\) for its spectral radius. \(\|\|_{p}\) denotes the \(_{p}\)-norm. When \(\) is PSD, \(_{}()\) denotes its smallest nonzero eigenvalue and \(():=_{n}()/_{}()\) denotes its pseudo-condition number. We use \(,\) for the Euclidean inner product, \(\) for the all ones vector, and \(e_{i}\) for the \(i\)-th standard basis vector. We define \(_{i,j}:=e_{i}-e_{j}\) and \([k]:=\{1,...,k\}\). We use \(x_{}y\) as shorthand for \((1-)y x(1+)y\). For \(v^{n}\), we use \(v[i:j]\) for the sub-vector from index \(i\) to \(j\). We use \(v w\) to indicate that \(v,w^{n}\) are orthogonal (i.e., \(v^{}w=0\)).

Graphs.We use \(G=(V,E,w)\) to denote a weighted undirected graph on \(V\) with edges \(E\) and edge weights \(w_{>0}^{E}\) (or \(G=(V,E)\) if unweighted). We use \(_{G}\) to denote its (weighted) adjacency matrix \((_{G})_{u,v}=w_{u,v}\) for \(u,v V V\) and \(_{G}\) to denote its diagonal (weighted) degree matrix \((_{G})_{u}=_{\{u,v\} E}w_{u,v}\) for \(u V\) (treated as \(w_{u,v}=1\) if \(G\) is unweighted). We define \(_{G}:=_{G}-_{G}\) as its graph Laplacian. \(d_{}(G)\) and \(d_{}(G)\) refer to the max and min diagonal entry in \(_{G}\). We may drop the argument or subscript \(G\) if it is clear from context. The effective resistance between nodes \(i,j V\) is denoted \(r_{G}(i,j)=_{i,j}^{}_{G}^{}_{i,j}\). We assume all input graphs are connected, as effective resistances can be computed separately on connected components. We use \(_{G}\) to denote the \(E V\) edge-incidence matrix of \(G\), where \((_{G})_{e,u}=1\) and \((_{G})_{e,v}=-1\) for all \(e E\), and \(e=\{u,v\}\), with \(_{Ge,l}=0\) for all \(l u\) and \(l v\).

Symmetric Diagonally Dominant (SDD) MatricesA matrix \(^{n n}\) is SDD if it can be decomposed as \(=_{}-_{}\), where the \(_{}\) is a diagonal matrix with non-negative entries and \(_{M}\) is a matrix with zeros on the diagonal such that \(d_{i,i}>_{j=1}^{n}|a_{i,j}|\). We define the normalization of \(\) as \(_{M}:=_{M}^{-1/2}_{M}^{-1/2}\). Throughout this paper, we assume, without loss of generality that \(_{M}\) has strictly positive entries on the diagonal (otherwise, we can simply remove an entire row and column of zeros). We use \(d_{}()\) and \(d_{}()\) to denote the max and min entry in the diagonal of \(_{M}\) respectively. We may drop the argument or subscript \(\) if it is clear from context.

Spectral Graph Theory.Our results leverage well-known spectral graph theory results. In particular, our algorithm complexities are parameterized by the normalized pseudo condition number of a graph (or SDD matrix).

**Definition 6** (Normalized (pseudo-)condition number).: _We define the normalized (pseudo-)condition number of an SDD matrix \(^{n}\) as \(():=_{n}(_{M})/_{ }(_{M})\)._

To connect the normalized condition number to expander graphs, we can apply Cheeger's inequality, which guarantees that if \(G\) has \(\)-expansion for some \(=(1)\), then \((_{G})=_{n}(_{L_{G}})/ _{2}(_{L_{G}}) 4/^{2}=(1)\).

**Theorem 6** (Cheeger's Inequality ).: _Let \(G=(V,E,w)\) be an undirected graph. Then, \(_{2}(_{L})(G)( _{L})}\)._

    & &  &  \\  Spectral Sum & TD Runtime & Lower Bound & TD Runtime & Lower Bound \\  Schatten 3-norm & \(n^{+4c}\) & \(n^{2}^{-1/4}\) & \(n^{+5c/2}\) & \(n^{2}^{-2/5}\) \\ Schatten p-norm, \(p 1,2\), & \(n^{+13c}\) & \(n^{2}^{-1/13}\) & \(n^{+10c}\) & \(n^{2}^{-1/10}\) \\ SVD Entropy & \(n^{+6c}\) & \(n^{2}^{-1/6}\) & \(n^{+5c}\) & \(n^{2}^{-1/5}\) \\ Log Determinant & \(n^{+6c}\) & \(n^{2}^{-1/6}\) & \(n^{+5c}\) & \(n^{2}^{-1/5}\) \\ Trace of Exponential & \(n^{+13c}\) & \(n^{2}^{-1/13}\) & \(n^{+10c}\) & \(n^{2}^{-1/10}\) \\   

Table 3: Runtimes for the triangle detection (TD) problem in an \(n\)-node graph using algorithms that produce \((1)\) multiplicative approximations to various spectral sums in \(O(n^{}^{-c})\) time. The second columns contain the best achievable runtimes for \(=2\) that do not use FMM, barring a breakthrough in subcubic triangle detection. All runtimes are reported up to \(()\).

In addition, we leverage the fact that effective resistances can be expressed in several equivalent expressions. In particular, it is known that:

\[r_{G}(i,j)=_{i,j}^{}_{G}^{}_{i,j}= _{i,j}D^{-1/2}_{G}{}^{}D^{-1/2}_{i,j}=( _{G}^{1/2}_{G}_{G}^{}_{i,j})^ {}(_{G}^{1/2}_{G}_{G}^{}_{ i,j}),\]

where \(_{G}^{E E}\) is the diagonal matrix of weights in \(G\).

Runtimes and Space Complexities.In our algorithmic results and analysis, when clear from context, we use \(()\) (resp., \(()\)) notation to hide polylogarithmic factors (resp., inverse polylogarithmic factors) in the number of vertices, the number of edges, the size of the matrix, the number of nonzero entries in a matrix, the maximum and minimum diagonal element of a matrix, the maximum and minimum weighted degree of a graph, \(\), the condition number, and the normalized psuedo-condition number of a matrix. We say event \(E\) occurs with high probability in \(t\) if \([E] 1-t^{-c}\), where \(c>0\) can be controlled by appropriately configuring the algorithm parameters. We may simply say that an event occurs "with high probability" or "whp." if it occurs with high probability in the size of a matrix or number of nodes in a graph.

## 3 Algorithmic Results

In this section, we present our main algorithmic results. Section 3.1 outlines our approach to effective resistance sketches and estimation; we defer discussion of our approach to SDD and PSD extensions to the supplementary material. Section 3.2, presents our original results on effective resistance sketching and estimation and generalizations to SDD matrices. Section 3.3 extends our techniques to yield an interesting data structure for estimating quadratic forms of PSD matrices.

### Our Approach

Approach in prior work: Johnson Lindenstrauss sketches.Our starting inspiration is a classic result of , which obtains an \(((m^{-2}),(^{-2}),(n ^{-2}))\)-effective resistance sketch by using the Johnson Lindenstrauss Lemma (JL)  and its algorithmic instantiations .

**Lemma 1** (Johnson-Lindenstrauss Lemma ).: _Given fixed vectors \(v_{1},...,v_{n}^{d}\) and \((0,1)\), let \(\) be an independently sampled random matrix in \(\{ 1/\}^{k d}\). For \(k=((n)^{-2})\), whp. in \(n\), \(\|v_{i}\|_{2}_{}\|v_{i}\|_{2}\) for all \(i[n]\)._

 observe that \(r_{G}(i,j)=(_{G}^{1/2}_{G}_{G}^{}_{i,j})^{}(_{G}^{1/2}_{G}_{G}^{ }_{i,j})\). Consequently, w.h.p in \(n\), \(\|_{G}^{1/2}_{G}_{G}^{} _{i,j}\|_{2}_{}r_{G}(i,j)\). With SDD linear system solvers, \(_{G}^{1/2}_{G}_{G}^{}\) can be approximated in \((m^{-1})\) time, from which \(\|_{G}^{1/2}_{G}_{G}^{}_{i,j}\|_{2}\) can be queried in \((^{-2})\) time.

Our approach: asymmetric CountSketch in \(_{1}\).Towards improving upon JL sketches for effective resistance estimation, our key tool is to use other sketching algorithms. In particular we use that there are algorithms that achieve better than \((^{-2})\)-sketch dimension for vectors with small \(_{1}\) norm with comparable guarantees, e.g., CountSketch. CountSketch is a classic memory-efficient algorithm for estimating the number of occurences of various datapoints in a data stream  and efficiently computing inner products . Given \(v^{n}\) and integer parameters \(s,t>0\), CountSketch transforms \(v\) to a vector \(v^{3ts n}\), where \(^{3ts n}\) is a \(3t\)-column-sparse 0/1 matrix. Lemma 2 is a special case of Theorem 4 from , which provides accuracy guarantees for inner product estimation using CountSketch.

**Lemma 2** (Special Case of , Theorem 4).: _Let vectors \(v,w^{n}\). Let \(\) be a random CountSketch matrix. Let \(x_{i}=(v)[(i-1)s+1:i s],(w)[(i-1)s+1:i s]\) for \(i[3t]\), and let \(X\) denote the median of \(\{x_{i}\}\). For \(s=O((|w|}{e| v,w|},^{2} |w|_{2}^{2}}{e| v,w|^{2}}))\), and \(t=(n^{c})\), \(|X- v,w|| v,w|\) with probability at least \((1-n^{-c})\)._

To improve the guarantee in Lemma 2 to hold whp. _for all \(v,w S\)_ rather than for each fixed pair, one can simply choose \(t=(n^{c}|S|)\) and apply a union bound. Consequently, if we knew that \(\|_{G}^{1/2}_{G}_{G}^{}_{i,j} \|_{1}^{2}/r_{G}(i,j)=(1)\), then building a CountSketch with \(s=(^{-1})\) would yield a \((n^{-1})\)-size sketch, improving over the \((n^{-2})\) sketch obtained using the \(_{2}\) JL sketch in . Unfortunately, it is unclear if and when such a bound holds, and so, it is unclear how the \(_{1}\) CountSketches could be useful in this setting. This leads to the main insight that fuels our algorithms. Rather than seeking a symmetric factorization of \(r_{G}(i,j)\) as a quadratic form \(v^{}v\) and applying a sketching procedure to \(v\), we instead work with an _asymmetric factorization_. In particular, we observe

\[r_{G}(i,j)=_{_{G}}^{-1}_{i,j},_{}^{1/2}(_{_{G}})^{}_{ _{G}}^{-1/2}_{i,j}. \]

At first glance, it may seem unclear why (1) is helpful. However, we show that indeed, for expanders

\[\|_{}^{-1}_{i,j}\|_{1}\| _{}^{1/2}(_{})^{}_{ }^{-1/2}_{i,j}\|_{1}/r_{G}(i,j)=(1). \]

Our main result essentially follows from (2). Using SDD linear system solvers, we can efficiently approximate \(_{}^{1/2}(_{})^{}_{ }^{-1/2}^{(^{-1}) n}\) in \((m^{-1})\) time, yielding our \(_{}\) of \((m^{-1})\) and \(s\) of \((n^{-1})\) (see discussion in supplementary material). Moreover, \(_{}^{-1}\) is \((1)\)-sparse, due to the structure of Count-Sketch. So, using our (approximate) access to \(_{}^{1/2}(_{})^{}_{ }^{-1/2}\), for any query \(i,j V\), we can efficiently approximate (1) using the recovery procedure of Lemma 2 in \((1)\) time.

### Our Results

We use the approach in Section 3.1 to develop algorithms to compute spectral sketch data structures for SDD matrices \(\) with \((1)\) normalized condition number, as defined in Definitions 6 and 7. So, as discussed in Section 2, this implies that our spectral sketch algorithms will automatically apply to normalized Laplacians of expanders and enable us to compute effective resistances.

**Definition 7** (Spectral Sketch Data Structure).: _We say an algorithm produces an \((_{},_{},s)\)-spectral sketch data structure for a PSD matrix \(^{n n}\) if given \(^{n n}\) and \((0,1)\), the algorithm creates a binary string of length \(O(s(A,))\) in time \(O(_{}(A,),\) from which, for any supported query \(b^{n}\), w.h.p it outputs \(q_{A}(b)_{}b^{}b\) in time \(O(_{}(A,)((b))^{2})\)._

Our spectral sketches of SDD matrices \(\) will only support \(_{M}\)-numerically sparse query vectors.

**Definition 8** (D-numerically sparse).: _For a diagonal matrix \(\), the \(\)-numerical sparsity of \(x^{n}\) is \(_{}(x):=\|^{-1}x\|_{1} \|x\|_{1}/\|^{-1/2}x\|_{2}^{2}\). We say \(x\) is \((c,)\)-numerically sparse if \(_{}(x) c\)._

Definition 8 is restrictive; however, several natural classes of vectors satisfy the requirements. For example, \(_{i}\) are (1, \(\))-numerically sparse and \(_{i,j}\) is (2, \(_{M}\))-numerically sparse for any \(i,j[n]\) and invertible diagonal matrix \(^{n n}\) (see supplementary material for additional examples.)

The following asymmetric rearrangement of quadratic forms is crucial to our analysis.

**Lemma 3**.: _Let \(^{n n}\) be SDD and \(x^{n}\) be orthogonal to \(()\). Then,_

Proof.: For notational convenience, let \(_{ M}=_{M}/2\). Let \(v=^{}x=(_{M}-_{M})^{}x\). Note that \(_{M}^{-1/2}x(_{M})\), and \(2_{M}^{1/2}_{ M}_{M}^{1/2}=\). Consequently, \(v=_{M}^{-1/2}_{ M}^{}_{M} ^{-1/2}x\), and hence \(x^{}^{}x=_{M}^{-1}x,_{M}^{1/2}_{ M}^{}_{M}^{-1/2}x\). The second equality now follows immediately by rearranging terms. To obtain the inequality, note that, because \(\) is SDD and \(\) is invertible, \(_{M}\) is PSD. Furthermore, \(2-_{M}=-_{M}^{-1/2}_{M} _{M}^{-1/2}\), which is also PSD, as \((_{M})[-d_{},d_{}]\). So, \(0(_{M}) 2\). So, \(_{}(_{M}) 1/2\) and the lemma follows. 

Lemma 4 bounds \(\|_{M}^{1/2}(_{M}/2)^{}_{M}^{-1/2}x \|_{1}\). The proof uses the power series expansion of \((_{M}/2)^{}\).

**Lemma 4**.: _Let \(^{n n}\) be an SDD matrix and \(x^{n}\) be a unit vector orthogonal to \(()\). Then_

\[\|_{M}^{1/2}(_{M}/2)^{}_{M}^{-1/2}x \|_{1}(1,2() (2}()/} ))\|x\|_{1}+1.\]Combining our Lemmas 3 and 4 with the guarantees of Lemma 2 and prior work on SDD linear system solvers (see supplementary material), we obtain the following theorem.

**Theorem 7**.: _For any SDD matrix \(^{n n}\), there is an algorithm to construct an \((}(()( )^{-1}),}(1),}( ()n^{-1}))\)-spectral sketch data structure of \(^{}\) supported over queries \(S\), where \(S\) is any set of \((}(1),_{M})\)-numerically sparse vectors orthogonal to \(()\)._

Because the \(_{i,j}\) queries appearing in effective resistance computations are 2-sparse and \((2,_{M})\)-numerically sparse for all SDD matrices \(\), taking \(=_{G}\) in Theorem 7 immediately implies Theorem 2 and Theorem 3 (see supplementary material for detailed discussion and pseudocode.)

### Extensions to PSD Matrices

Our approach of approximating quadratic forms via asymmetric inner products also yields a query-efficient sketching procedure for approximating quadratic forms of well-conditioned PSD matrices.

**Theorem 8**.: _There is an algorithm to construct an \((}(()() ^{-2}),}(1),}(( )n^{-2}))\)-spectral sketch data structure of \(\) supported over \(S\), where \(S\) is any set of vectors orthogonal to \(()\) and \(\) is PSD._

In comparison, JL  gives an \((}(n^{}),}(^{-2}), }(n^{-2}))\)-spectral sketch data structure using efficient square root algorithms . JL achieves better compression than Theorem 8, while Theorem 8 achieves faster query time. When the matrix is well conditioned and error tolerance is sufficiently high, Theorem 8 may achieve better construction time and query time than JL while maintaining comparable compression.

## 4 Lower Bounds

In this section, we present our main hardness results. Section 4.1 outlines our approach. In Section 4.2, we present our lower bounds for the problem of estimating effective resistances for all pairs of nodes (case where \(S=V V\)), which we call the "all pairs effective resistance estimation problem." Section 4.3 shows our techniques also yield lower bounds for other spectral sum estimation problems.

### Our Approach

Approaches of Previous WorkThe approach of  begins with the fact that \(G\) has a triangle if and only if \((_{G}^{3})/6 1\). They use the fact that various spectral sums \(_{f}\) of the of the SDD matrix \(-_{G}\) (for \(\) sufficiently small) can be expressed as a power series \(_{f}(-_{G})=_{k=0}^{}c_{k} ^{k}(_{G}^{k})\). The first two terms of this series can be computed directly. So given \(Y_{}_{f}(-_{G})\), one can estimate \((_{G}^{3})\), where the estimation error is controlled by the magnitude of the first two terms of the series and the tail error due to truncating at the third term. By bounding this estimation error,  show that, for appropriate choices of \(\), \(Y_{}_{f}(-_{G})\) yields an additive 1/2 approximation to \((_{G}^{3})\), which is sufficient for triangle detection. They also reduce the problem of estimating the spectral sum \((^{-1})\) for an SDD matrix \(\) to the all pairs effective resistance estimation problem.

Our ApproachWe use three key techniques to better bound the estimation errors incurred in the power-series-inspired approach of . This yields faster reductions and better lower bounds for effective resistance estimation. Rather than obtaining effective resistance lower bounds by reducing the problem of computing \((_{G}^{3})/6\) to computing the _trace_ of an SDD matrix as in , we use a reduction that closely resembles the structure of effective resistances. For \(>0\) sufficiently small,

\[(-_{G})^{-1}=_{k=0}^{ }}{n^{k}}_{G}^{k}. \]

Since \(_{G}\) is known, given access to \(_{i,j}^{}(-_{G})^{-1}_{i,j}\), we can estimate the entries of \(_{G}^{2}\), where the estimation error is controlled by \(\) and the tail error of truncating (3) at the third term. By bounding this estimation error, for appropriate choice of \(\), we can obtain additive 1/2 approximations to all entries of \(_{G}^{2}\), which is sufficient to identify all paths of length 2. We can then detect a triangle by simply scanning for an edge \(\{u,v\}\) such that \(u\) and \(v\) are connected by a path of length 2. Estimating the entries of \(_{G}^{2}\) leads to lower estimation error than estimating \((_{G}^{3})\) as in ). Second, we use a standard randomized reduction that reduces the triangle detection problem to the triangle detection problem restricted to tripartite graphs. The reduction relies on the fact that a randomly sampled tripartition of the original graph preserves triangles with constant probability. To detect a triangle in a tripartite graph \(G=(V_{1} V_{2} V_{3},E)\), we construct a graph \(H\) by removing all edges \(E_{1,2}:=\{\{u,v\} E:u V_{1},v V_{2}\}\) between \(V_{1}\) and \(V_{2}\). \(G\) has a triangle if and only if there is an edge \(\{u,v\} E_{1,2}\) and a path of length 2 between \(u\) and \(v\) in \(H\). Crucially, we can show that the third term \(}_{H}^{3}\) does not contribute to the tail error when estimating the \(\{u,v\}\)-th entry of \((_{H}^{2})\) using (3). Third, to lower the spectral norm of \(_{H}\) (and consequently better bound the convergence of the power series (3)), we introduce the symmetric random signing of \(_{H}\) below.

**Definition 9** (Symmetric Random Signing).: _Given a symmetric matrix \(^{n n}\), its symmetric random signing \(}\) is the random matrix with \(}_{i,j}:=_{i,j}_{i,j}\), where \(_{i,j}\) are independent Rademacher random variables that satisfy \(_{i,j}=_{j,i}\)._

We show that this random signing preserves the non-seroness of entries of \(_{H}^{2}\) with constant probability, allowing us to detect whether \(G\) has a triangle even if we replace \(_{G}\) in (3) with \(}_{H}\) instead. This is beneficial, as matrix Chernoff guarantees \(\|}_{H}\|_{2}=()\) whp. whereas \(\|_{H}\|_{2}\) may be as large as \(n\). So the tail error of truncating the power series is smaller. To compute entries of \(}_{H}^{2}\) efficiently using effective resistance estimates on expanders, we first show that we can use all pairs effective resistance estimates on expanders to estimate \(_{i,j}^{}^{-1}_{i,j}\) for all \(i,j[n]\), where \(=(-)\) is an SDD matrix with \(() 1/3\). Then, by choosing \(=-}_{H}\) as in (3) for an appropriate constant \(\), we can estimate \(}_{H}^{2}\) from estimates of \(_{i,j}^{}^{-1}_{i,j}\). This yields our lower bound on the all pairs effective resistance estimation problem.

Additionally, we show that random signing also preserves the non-seroness of \((_{G}^{3})\) with constant probability, and leverage this to obtain improved randomized conditional lower bounds for various spectral sum estimation problems. We closely follow the trace estimation approach of , and again use the smaller spectral radius of \(}_{G}\) to improve bounds on the power series truncation error.

### Improved Lower Bounds for Effective Resistance Estimation

In this section we provide a series of reductions which yield our main result on lower bounds for the all pairs effective resistance estimation problem for all pairs of nodes (case where \(S=V V\)).

**Definition 10**.: _In the SDD effective resistance estimation problem, given an SDD matrix \(\) such that \(_{}=\), \(_{}=\), with \(() 1/3\) and \((0,1)\), we must output \(^{n^{2}}\) such that \(_{a,b}_{}_{a,b}^{}^{-1} _{a,b}\  a,b[n]\). We call \(_{a,b}^{}^{-1}_{a,b}\) the SDD effective resistance of \((a,b)\) in \(\)._

For brevity, we use \(()\) to refer to the solution of the SDD effective resistance problem on input \(\). Our first step is to show that an algorithm for the all pairs effective resistance estimation problem on expanders implies an algorithm for the SDD effective resistance estimation problem.

**Lemma 5**.: _Given an algorithm to solve the all pairs effective resistance estimation problem on graphs with \((1)\)-expansion in \((n^{2}^{-c})\) time for some \(c>0\), we can produce an algorithm to solve the SDD effective resistance estimation problem in \((n^{2}^{-c})\) time._

To prove Lemma 5, we first prove the lemma for the case where \(\) is entrywise non-negative by constructing an expander \(G\) with \(n+1\) vertices such that \(r_{G}(a,b)=_{a,b}^{}^{-1}_{a,b}\) for all \(a,b[n]\). We extend the reduction to arbitrary \(\) by constructing \(^{}\) of size \(2n\) so that \(^{}\) is entrywise non-negative and \((-)\) is a simple linear transform of \((-^{})\).

We turn our attention to reducing the triangle detection problem to the SDD effective resistance problem. As discussed, a key aspect of our approach is to work with the random signing \(}_{G}\) of \(_{G}\). Lemma 6 shows that to determine whether \((_{G}^{2})_{i,j}>0\) with constant probability, it suffices to determine whether \((}_{G}^{2})_{i,j}>0\). Matrix Chernoff ensures whp. \((}_{G})=()\), while \((_{G})\) could be as large as \(n\). So, estimating entries of \(}_{G}\) leads to lower power series tail error.

**Lemma 6**.: _For \(i j\), if \((_{G}^{2})_{i,j}=0\), then \((}_{G}^{2})_{i,j}=0\); if \((_{G}^{2})_{i,j}>0\), \([|(}_{G}^{2})_{i,j}|>1] 1/2\)._The idea of the proof is that if \(\{a,b\},\{b,c\}\) exist in \(G\), either \(_{a,c}=1\) or \(_{a,c}=-1\) results in \((}_{G}^{2})_{a,c}>0\). Finally, we use the power series approach in Section 4.1 to obtain Theorem 9.

**Theorem 9**.: _Given an algorithm which solves the SDD effective resistance estimation problem in \((n^{2}^{-c})\) time, we can produce a randomized algorithm that solves the triangle detection problem in \((n^{2(1+c)})\) time whp._

Theorem 9 and Lemma 5 with \(c=1/2-\) immediately imply our main result Theorem 4.

Additionally, we extend the lower bound of Theorem 4 to the all edges effective resistance estimation by the following reduction.

**Lemma 7**.: _Given an algorithm to solve the all edges effective resistance estimation problem (i.e., Definition 1 where \(S=\) E) in \((m^{-c})\) time, we can produce an algorithm to solve the all pairs effective resistance estimation problem in \((n^{2}^{-c})\) time for some \(c>0\)._

The rough idea behind the reduction is to add a complete graph of edges of sufficiently small weight that would not change the effective resistances much. Lemma 7 combined with Theorem 4 then imply a \((m^{-1/2})\) randomized lower bound for the all edges effective resistance estimation problem on graphs with graphs with \((1)\)-expansion.

### Improved Lower Bounds for Spectral Sum Estimation

Finally, we discuss our improved lower bounds for various spectral sum estimation problems. Analogous to Lemma 6, in the following lemma we show that to determine whether a graph has a triangle (i.e., \((_{G}^{3})>0\)) with constant probability, it suffices to determine whether \((}_{G}^{3})>0\).

**Lemma 8**.: _If \((_{G}^{3})=0\), then \((}_{G}^{3})=0\), and if \((_{G}^{3})>0\) then \([|(}_{G}^{3}) |>0] 1/4\)._

The central idea of the proof is that if a triangle \(\{a,b\},\{b,c\},\{c,a\}\) exists in \(G\), then amongst the 4 possible configurations of the Rademacher random signing variables \(_{a,b}\) and \(_{b,c}\), at least one configuration must result in \(|(}_{G}^{3})|>0\). By following the proof of Theorem 15 from , and replacing their use of \(_{G}\) with a symmetric random signing \(}_{G}\), we obtain an improved randomized version of their result by leveraging the smaller spectral radius of \(}_{G}\). Theorem 5 follows by applying this result to the functions \(f\) that define the corresponding spectral sums (see supplementary material).

## 5 Conclusion

In this paper we provided improved upper and lower bounds on the problem of estimating and sketching effective resistances on expanders. On the algorithmic side we show how sketches tailored to \(_{1}\) when carefully applied to asymmetric formulations of the quadratic form of the Laplacian pseudoinverse gave our results. On the lower bound side, we provided an alternative to the trace estimation approach of  for showing lower bounds and coupled it with techniques of randomly signing edges of the graph to obtain our results. Further, we showed that these techniques had broader implications for addressing algorithmic challenges in numerical linear algebra.

Beyond the natural open problem of improving both our upper and lower bounds towards bringing them together, there are interesting open problems in broadening the applicability of both our upper and lower bounds. For example, obtaining an \((m^{-1})\) time algorithm for estimating the effective resistance of all edges in a general (non-expander) graph and extending our \((n^{2}^{-1/2})\) lower bounds to deterministic algorithms remain interesting open problems. We hope that the results of this paper provide useful tools for addressing each.