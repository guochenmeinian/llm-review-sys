# Neural approximation of Wasserstein distance via a universal architecture for symmetric and factorwise group invariant functions

Neural approximation of Wasserstein distance via a universal architecture for symmetric and factorwise group invariant functions

Samantha Chen

Department of Computer Science Engineering

University of California - San Diego

sac003@ucsd.edu

&Yusu Wang

Halicioglu Data Science Institute

University of California - San Diego

yusuwang@ucsd.edu

###### Abstract

Learning distance functions between complex objects, such as the Wasserstein distance to compare point sets, is a common goal in machine learning applications. However, functions on such complex objects (e.g., point sets and graphs) are often required to be invariant to a wide variety of group actions e.g. permutation or rigid transformation. Therefore, continuous and symmetric _product_ functions (such as distance functions) on such complex objects must also be invariant to the _product_ of such group actions. We call these functions _symmetric and factor-wise group invariant functions_ (or _SFGI functions_ in short). In this paper, we first present a general neural network architecture for approximating SFGI functions. The main contribution of this paper combines this general neural network with a sketching idea to develop a specific and efficient neural network which can approximate the \(p\)-th Wasserstein distance between point sets. Very importantly, the required model complexity is _independent_ of the sizes of input point sets. On the theoretical front, to the best of our knowledge, this is the first result showing that there exists a neural network with the capacity to approximate Wasserstein distance with bounded model complexity. Our work provides an interesting integration of sketching ideas for geometric problems with universal approximation of symmetric functions. On the empirical front, we present a range of results showing that our newly proposed neural network architecture performs comparatively or better than other models (including a SOTA Siamese Autoencoder based approach). In particular, our neural network generalizes significantly better and trains much faster than the SOTA Siamese AE. Finally, this line of investigation could be useful in exploring effective neural network design for solving a broad range of geometric optimization problems (e.g., \(k\)-means in a metric space).

## 1 Introduction

Recently, significant interest in geometric deep learning has led to a focus on neural network architectures which learn functions on complex objects such point clouds [34; 22] and graphs . Advancements in the development of neural networks for complex objects has led to progress in a variety of applications from 3D image segmentation  to drug discovery [3; 13]. One challenge in learning functions over such complex objects is that the desired functions are often required to be invariant to certain group actions. For instance, functions on point clouds are often permutation invariant with respect to the ordering of individual points. Indeed, developing permutation invariant or equivariant neural network architectures, as well as understanding their universal approximation properties, has attracted significant attention in the past few years; see e.g., [22; 34; 19; 20; 25; 16; 33; 29; 30; 4]However, in many geometric or graph optimization problems, our input goes beyond a single complex object, but multiple complex objects. For example, the \(p\)-Wasserstein distance \(_{p}(X,Y)\) between two point sets \(X\) and \(Y\) sampled from some metric space (e.g., \(^{d}\)) is a function over pairs of point sets. To give another example, the \(1\)-median of the collection of \(k\) point sets \(P_{1},,P_{k}\) in \(^{d}\) can be viewed as a function over \(k\) point sets.

A natural way to model such functions is to use product space. In particular, let \(\) denote the space of finite point sets from a bounded region in \(^{d}\). Then the \(p\)-Wasserstein distance can be viewed as a function \(_{p}:\). Similarly, 1-median for \(k\) point sets can be modeled by a function from the product of \(k\) copies of \(\) to \(\). Such functions are not only invariant to permutations of the factors of the product space (i.e. \(_{p}(X,Y)=_{p}(Y,X)\)) but are also invariant or equivariant with respect to certain group actions for each factor. For \(p\)-Wasserstein distance, \(_{p}\) is invariant to permutations of the ordering of points within both \(X\) and \(Y\). This motivates us to extend the setting of learning continuous group invariant functions to learning continuous functions over _product_ spaces which are both invariant to some product of group actions and symmetric. More precisely, we consider a type of function which we denote as an SFGI product functions.

**Definition 1.1** (SFGI product function): _Given compact metric spaces \((_{i},_{_{i}})\) where \(i[k]\), we define symmetric and factor-wise group invariant (SFGI) product functions as \(f:_{1}_{2}_{k} \) where \(f\) is (1) symmetric over the \(k\) factors, and (2) invariant to the group action \(G_{1} G_{2} G_{k}\) for some group \(G_{i}\) acting on \(_{i}\), for each \(i[1,k]\)._

Contributions.SFGI product functions can represent a wide array of geometric matching problems including computing the Wasserstein or Hausdorff distance between point sets. In this paper, we first provide a general framework for approximating SFGI product functions in Section 3.1. Our primary contribution, described in Section 3.2, is the integration of this general framework with a sketching idea in order to develop an efficient and specific SFGI neural network which can approximate the \(p\)-Wasserstein distance between point sets (sampled from a compact set in a nice metric space, such as the fixed-dimensional Euclidean space). Most importantly, the complexity of our neural network (i.e., number of parameters needed) is _independent_ of the maximum size of the input point sets, and depends on only the additive approximation error. To the best of our knowledge, this is the first architecture which provably achieves this property. This is in contrast to many existing universal approximation results on graphs or sets (e.g., for DeepSet) where the network sizes depend on the size of each graph or point set in order to achieve universality . We also provide a range of experimental results in Section 4 showing the utility of our neural network architecture for approximating Wasserstein distances. We compare our network with both a SOTA Siamese autoencoder , a natural Siamese DeepSets network, and the standard Sinkhorn approximation of Wasserstein distance. Our results show that our universal neural network architecture produces Wasserstein approximations which are better than the Siamese DeepSets network, comparable to the SOTA Siamese autoencoder and generalize much better than both to input point sets of sizes which are unseen at training time. Furthermore, we show that our approximation (at inference time) is much faster than the standard Sinkhorn approximation of the \(p\)-Wasserstein distance at similar error threshholds. Moreover, our neural network trains much faster than the SOTA Siamese autoencoder. Overall, our network is able to achieve **equally accurate or better** Wasserstein approximations which **generalize better** to point sets of unseen size as compared to SOTA while **significantly reducing** training time. In Appendix B, we provide discussion of issues with other natural choices of neural network architectures one might use for estimating Wasserstein distances, including one directly based on Siamese networks, which are often used for metric learning.

All missing proofs / details can be found in the **Supplementary materials**.

Related work.Efficient approximations of Wasserstein distance via neural networks are an active area of research. One approach is to use input convex neural networks to approximate the 2-Wasserstein distance. However, for this approach, training is done _per_ pair of inputs and is restricted to the 2-Wasserstein distance which makes it unsuitable for a general neural network approximation of \(p\)-Wasserstein distances between discrete distributions. This neural approximation method contrasts with our goal: a general neural network that can approximate the \(p\)-Wasserstein distance between any two point sets in a compact metric space to within \(\)-accuracy. Siamese networks are another approach for popular approach for learning Wasserstein distances. Typically, a Siamese network is composed of a single neural network which maps two input instances to Euclidean space.

The output of the network is represented then by \(_{p}\)-norm between the output embeddings. In , the authors utilize a Siamese autoencoder which takes two histograms (images) as input. For their architecture, a single encoder network is utilized to map each histogram to an embedding in Euclidean space, while a decoder network maps each Euclidean embedding back to an output histogram. The Kullback-Liebler (KL) divergence between original histogram and the output histogram (i.e. reconstruction loss) is used during training to regularize the embeddings and the final estimate of 2-Wasserstein distance is the \(_{2}\) norm between the embeddings. The idea of learning Wasserstein distances via Siamese autoencoders was extended in  to point cloud data with the Wasserstein point cloud embedding network (WPCE) where the original KL reconstruction loss was replaced with a differentiable Wasserstein approximation between the original point set and a fixed-size output point set from the decoder network. In our subsequent experiments, we show that our neural network trains much more efficiently and generalizes much better than WPCE to point sets of unseen size.

Moreover, the concept of group invariant networks was previously investigated in several works, including [34; 22; 19; 17; 9]. For instance, DeepSets  and PointNet  are two popular permutation invariant neural network which were shown to be universal with respect to set functions. In addition to group invariance, there have also been efforts to explore the notion of invariance with respect to combinations of groups, such as invariance to both SE(3) and permutation group [11; 21] or combining basis invariance with permutation invariance . Our work differs from previous work in that we address a universal neural network which is invariant with respect to a _specific_ combination of permutation groups that corresponds to an SFGI function on point sets. In general, we can view this as a subgroup of the permutation group - encoding the invariance of each individual point set with the symmetric requirement of the product function corresponds to a specific subgroup of the permutation group. Thus, previous results regarding permutation invariant architectures such as DeepSets, PointNet or combinations of group actions (such as ) do not address our setting of SFGI functions or \(p\)-Wasserstein distances.

## 2 Preliminaries

We will begin with basic background on groups, universal approximation, and Wasserstein distances.

Groups and group actionsA group \(G\) is an algebraic structure that consists of a set of elements and a binary operation that satisfies a specific set of axioms: (1) the associative property, (2) the existence of an identity element, and (3) existence of inverses for each element in the set. Given a metric space \((,_{})\), the action of the group \(G\) on \(\) is a function \(:G\) that transforms the elements of \(\) for each element \( G\). For each element \( G\), we will write \( x\) to denote the action of a group element \(\) on \(x\) instead of \((,x)\). For example, if \(G\) is the permutation group over \([N]:=\{1,2,,N\}\), and \(=^{N}\), then for any \( G\), \( x\) represents the permutation of elements in \(x^{N}\) via \(\) i.e. given \(x=(x_{1},x_{2},,x_{N})\), \( x=(x_{(1)},x_{(2)},x_{(N)})\). A function \(f:\) is \(G\)-_invariant_ if for any \(X\) and any \( G\), we have that \(f(X)=f( X)\).

Universal Approximation.Let \((,)\) denote the set of continuous functions from a metric space \((,d_{})\) to \(\). Given two families of functions \(_{1}\) and \(_{2}\) where \(_{1}_{2}\) and \(_{1},_{2}(,)\), we say that \(_{1}\)_universally approximates_\(_{2}\) if for any \(>0\) and any \(f_{2}\), there is a \(g_{1}\) such that \(\|g-f\|_{}<\). Different norms on the space of functions can be used, but we will use \(L_{}\) norm in this paper, which intuitively leads to additive pointwise-error over the domain of these functions. The classic universal approximation theorem for multilayer perceptrons (MLPs)  states that a feedforward neural network with a single hidden layer, using certain activation functions, can approximate any continuous function to within an arbitrary _additive \(\)-error._

Permutation invariant neural networks for point cloud dataOne of the most popular permutation invariant neural network models is the DeepSets model defined in . DeepSets is designed to handle unordered input point sets by first applying a neural network to each individual element, then using sum-pooling to generate an embedding for the input data set, and finally, applying a final neural network architecture to the ouput embedding. Formally, suppose we are given a finite _multiset_\(S=\{x:x^{d}\}\) (meaning that an element can appear multiple times, and the number of times an element occurs in \(S\) is called its _multiplicity_). The DeepSets model is defined as

\[_{}(S)=g_{_{2}}_{x S}h_{_{1 }}(x)\]

where \(h_{_{1}}\) and \(g_{_{2}}\) are neural network architectures. DeepSets can handle input point sets of variable sizes. It was also shown to be universal with respect to continuous _multiset functions_.

**Theorem 2.1** ([34; 1; 12]): _Assume the elements are from a compact set in \(^{k}\), and the input multiset size is fixed as \(N\). Let \(t=2kN+1\). Then any continuous multiset function, represented as \(f:^{k N}\) which is invariant with respect to permutations of the columns, can be approximated arbitrarily close in the form of \(_{x X}(x)\), for continuous transformations \(:^{k}^{t}\) and \(:^{t}\)._

While universality for the case when \(k=1\) was shown using symmetric polynomials, the case for \(k>1\) in fact is quite subtle and the proof in  misses key details. For completeness, we provide a full proof in Appendix E.1 for when the output dimension of \(\) is \(t=\). It was recently shown in [12; 1] that the output dimension of \(\) can be reduced to \(2kN+1\), which is the dimension of \(t\) which we use in Theorem 2.1 and subsequent theorems. In both the cases where the output dimension of \(\) is \(t=\) or \(t=2kN+1\), Theorem 2.1 implies that if we want to achieve universality, the required network size depends on input point cloud size.

Wasserstein distances and approximations.Here we will introduce Wasserstein distance for discrete measures. Let \((X,_{X})\) be a metric space. For two weighted point sets \(P=\{(x_{i},w_{i}):x_{i} X,_{w_{i}}=1,i[n]\}\) and \(Q=\{(x^{}_{i},w^{}_{i}):x^{}_{i} X,_{w_{i}}=1,i[m]\}\), we define the Wasserstein distance between \(P\) and \(Q\) as

\[_{p}(P,Q)=_{^{n m}_{+}} ,D^{p}^{1/p}:=[w_{1},,w_{n}],^{T }=[w^{}_{1},,w^{}_{m}]}\]

where \(D^{n m}_{+}\) is the distance matrix with \(D_{i,j}=_{X}(x_{i},x^{}_{j})\). One can think of these weighted point sets as discrete probability distributions in \((X,_{X})\). When \(p=1\), \(_{1}\) is also commonly known as the Earth Mover's distance (EMD). Additionally, note that when \(p=\), \(_{p}\) is the same as the Hausdorff distance between points in \(P\) and \(Q\) with non-zero weight. Computing Wasserstein distances amounts to solving a linear programming problem, which takes \(O(N^{3} N)\) (where \(N=\{n,m\}\)) time. There have been a number of methods for fast approximations of Wasserstein distances, including multi-scale and hierarchical solvers , and \(L_{1}\) embeddings via quadtree algorithms [2; 14]. In particular, entropic regularization of Wasserstein distance , also known as the Sinkhorn distance, is often used as the standard Wasserstein distance approximation for learning tasks. Unlike Wasserstein distance, the Sinkhorn approximation is differentiable and can be computed in approximately \(O(n^{2})\) time. The computation time is governed by a regularization parameter \(\). As \(\) approaches zero, the Sinkhorn distance approaches the true Wasserstein distance.

## 3 Learning functions between point sets

We will first present a general framework for approximating SFGI-functions and then show how this framework along with geometric sketches of our input data enables us to define neural networks which can approximate \(p\)-Wasserstein distances with complexity independent of input data size.

### A general framework for functions on product spaces

One of the key ingredients in our approach is the introduction of what we call a _sketch_ of input data to an Euclidean space whose dimension is independent of the size of the input data.

**Definition 3.1** (Sketch): _Let \(>0\), \(a^{+}\), and \(G\) be a group which acts on \(\). A \((,a,G)\)-**sketch** of a metric space \((,_{})\) consists of a \(G\)-invariant continuous encoding function \(h:^{a}\) and a continuous decoding function \(g:^{a}\) such that \(_{}(g h(S),S)<\)._Now let \((_{1},_{_{1}}),,(_{m},_{ _{m}})\) be compact metric spaces. The product space \(_{1}_{m}\) is still a metric space equipped with the following natural metric induced from metrics of each factor:

\[_{_{1}_{m}}((A_{1},,A_{ m}),(A^{}_{1},,A^{}_{m}))=_{_{1}}(A_{1},A^{ }_{1})++_{_{m}}(A_{m},A^{}_{m}).\]

Suppose \(G_{i}\) is a group acting on \(_{i}\), for each \(i[m]\). In the following result, instead of SFGI product functions, we first consider the more general case of _factor-wise group invariant functions_, namely functions \(f:_{1}_{m}\) such that \(f\) is uniformly continuous and invariant to the group action \(G_{1} G_{m}\).

**Lemma 3.2**: _Suppose \(f:_{1}_{m}\) is uniformly continuous and invariant to \(G_{1} G_{m}\). Additionally, assume that for any \(>0\), \((_{i},_{_{i}})\) has a \((,a_{i},G_{i})\)-sketch where \(a_{i}\) may depend on \(\). Then for any \(>0\), there is a continuous \(G_{i}\)-invariant functions \(_{i}:_{i}^{a_{i}}\) for all \(i[k]\) and a continuous function \(:^{a_{1}}^{a_{m}}\) such that_

\[|f(A_{1},A_{2},,A_{m})-(_{1}(A_{1}),_{2}(A_{2}),,_ {k}(A_{m}))|<\]

_for any \((A_{1},,A_{m})_{1}_{m}\). Furthermore, if \(_{1}=_{2}==_{m}\), then we can choose \(_{1}=_{2}=_{m}\)._

Note that a recent result from  shows that a continuous factor-wise group invariant function \(f:_{1}_{m}\) can be **represented** (not approximated) by the form \(f(v_{1},,v_{m})=(_{1}(v_{1}),,_{k}(v_{m}))\) if _there exists a topological embedding from \(_{i}/G_{i}\) to Euclidean space_. The condition that each quotient \(_{i}/G_{i}\) has a topological embedding in fixed dimensional Euclidean space is strong. A topological embedding requires injectivity, while in a sketch, one can collapse input objects as long as after decoding, we obtain an approximated object which is close to the input. Our result can be viewed as a relaxation of their result by allowing our space to have an approximate fixed-dimensional embedding (i.e., our \((,a,G)\)**-sketch**).

We often consider the case where \(=_{1}==_{m}\) i.e. \(f:\) where \(G\) is a group acting on the factor \(\). Oftentimes, we require the function to not only be invariant to the actions of a group \(G\) on each individual \(\) but also _symmetric_ with respect to the ordering of the input. By this, we mean \(f(A_{1},,A_{m})=f(A_{(1)},,A_{(m)})\) where \(\) is a permutation on \([m]\). In other words, we now consider the _SFGI product function_\(f\) as introduced in Definition 1.1. The extra symmetry requirement adds more constraints to the form of \(f\). We show that the set of uniformly continuous SFGI product function can be universally approximated by product function with an even simpler form than Lemma 3.2 as stated in the theorem below.

**Lemma 3.3**: _Assume the same setup as Lemma 3.2 with \(=_{1}==_{m}\) and \(G=G_{1}==G_{m}\). Assume that \(\) has a \((,a,G)\)-sketch. Additionally, suppose \(f\) is symmetric; hence \(f\) is a SFGI function. Let \(t=2am+1\). Then for any \(>0\), there is a continuous \(G\)-invariant function \(:^{t}\) and a continuous function \(:^{t}\) such that_

\[|f(A_{1},,A_{m})-_{i=1}^{m}(A_{i})|<\]

Now suppose we want approximate an SFGI product function, \(f\), with a neural network. Lemma 3.3 implies that we can approximate \(\) with any universal \(G\)-invariant neural network which embeds our original space \(\) to some Euclidean space \(^{a}\). Then the outer architecture \(\) can be any universal architecture (e.g. MLP). Finding a universal \(G\)-invariant neural network to realize \(\) over a single factor space \(\) is in general much easier than finding a SFGI neural network, and as we discussed at the end of Section 1, we already know how to achieve this for several settings. We will show how this idea is at work for approximating SFGI functions between point sets in the next subsection.

### Universal neural networks for functions between point sets

We are interested in learning symmetric functions between point sets (i.e. any \(p\)-Wasserstein distance) which are factor-wise _permutation_ invariant. In this section, we will show that we can find a \((,a,G)\)-sketch for the space of weighted point sets. This allows us to combine Lemma 3.3 with DeepSets to define a set of neural networks which can approximate \(p\)-th Wasserstein distances to arbitrary accuracy. Furthermore, the encoding and decoding functions can be approximated with neural networks where their model complexity is _independent_ of input point set size. Thus, the resulting neural network used to approximate Wasserstein distance also has **bounded model complexity**.

Set up.Given some metric space \((,_{})\), let \(\) be the set of _weighted_ point sets with at most \(N\) elements. In other words, each \(S\) has the form \(S=\{(x_{i},w_{i}):w_{i}_{+},_{i}w_{i}=1,x_{i}\}\) and \(|S| N\). One can also consider \(\) to be the set of weighted Dirac measures over \(\). For simplicity, we also sometimes use \(S\) to refer to just the set of points \(\{x_{i}\}\) contained within it. We will consider the metric over \(\) to be the \(p\)-th Wasserstein distance, \(_{p}\). We refer to the metric space of weighted point sets over \(\) as \((,_{p})\).

First, we will show that given a \(\), there is a \((,a,G)\)-sketch of \(\) with respect to \(_{p}\). The embedding dimension \(a\) depends on the so-called _covering number_ of the metric space \((,_{})\) from which points are sampled. Given a compact metric space \((,_{})\), the _covering number_\(_{}(r)\)_w.r.t. radius \(r\) is the minimal number of radius \(r\) balls needed to cover \(\). As a simple example, consider \(=[-,]\). Given any \(r\), we can cover \(X\) with \(\) intervals so \(_{}(r)\). The collection of the center of a set of \(r\)-balls that cover \(\) an _\(r\)-net of \(\)_. For a compact set \(^{d}\) with diameter \(D\), its covering number \(_{}(r)\) is a constant depending on \(D\), \(r\) and \(d\) only.

**Theorem 3.4**: _Set \(_{}\) to be \(W_{p}\) for \(1 p<\). Let \(G\) be the permutation group. For any \(>0\), let \(_{0}=[d]{/2}\) and \(a=_{}(_{0})\) be the covering number w.r.t. radius \(_{0}\). Then there is a \((,a,G)\)-sketch of \(\) with respect to \(_{p}\). Furthermore, the encoding function \(:^{a}\) can be expressed as the following where \(h:^{a}\) is continuous:_

\[(S)=_{x S}h(x). \]

_Proof:_ Let \(>0\) and let \(S\) be \(S=\{(x_{i},w_{i}): w_{i}=1,x_{i}\}\) and \(|S| N\). Given \(_{0}=[d]{/2}\) and \(a=_{}(_{0})\), we know \(\) has a \(_{0}\)-net, \(C\), and we denote the elements of \(C\) as \(\{y_{1},,y_{a}\}\). In other words, for any \(x\), there is a \(y_{i} Cd\) such that \(_{}(x,y_{i})<_{0}\).

First, we will define an encoding function \(:^{a}\). For each \(y_{i}\), we will use a soft indicator function \(e^{-b_{}(x,B_{_{0}}(y_{i}))}\) and set the constant \(b\) so that \(e^{-b_{}(x,B_{_{0}}(y_{i}))}\) is "sufficiently" small if \(_{}(x,B_{_{0}}(y_{i}))>_{0}\). More formally, we know that \(_{b}e^{-b_{0}}=0\) so there is \(\) such that for all \(b>\), \(e^{-b_{0}}<^{p}}{d_{max}^{p}a}\). Set \(b_{0}\) to be such that \(b_{0}>\). Let \(h_{i}(x)=e^{-b_{0}_{}(x,B_{_{0}}(y_{i}))}\) for each \(i[a]\). For a given \(x\), we compute \(h:^{a}\) as

\[h(x)=[h_{1}(x),,h_{a}(x)]\]

Then we define the encoding function \(:^{a}\) as

\[(S)=_{i=1}^{n}w_{i})}{\|h(x_{i})\|_{1}}\]

Note that \(\|(S)\|_{1}=1\) and \(\) is continuous since Wasserstein distances metrize weak convergence. Additionally, since \(_{}(x,B_{_{0}}(y_{i}))\) is the distance from \(x\) to the \(_{0}\)-ball around \(y_{i}\), we are guaranteed to have one \(j\) where \(h_{j}(x_{i})=1\) so \(\|h(x_{i})\|_{1}>1\).

Now, we define a decoding function \(g:^{a}\) as \(g(v)=\{(y_{i},}{\|v\|_{1}}):i[a]\}\). In order to show that \(g\) and \(\) yields a valid \((,a,G)\)-sketch of \(\), we must show that \(g(S)\) is sufficiently close to \(S\) under the \(_{p}\) distance. First, we know that

\[_{p}^{p}(g(S),S)_{i=1}^{n}_{j=1}^{a}w_{1} (x_{i})}{\|h(x_{i})\|_{1}}d(x_{i},y_{j})^{p}.\]

Let \(d_{max}\) be the diameter of \(\). For a given \(x_{i}\), we can partition \(\{h_{1}(x_{i}),,h_{a}(x_{i})\}\) into those where \(h_{j}(x_{i})^{p}}{d_{max}^{p}a}\) and those where \(h_{j}(x_{i})<^{p}}{d_{max}^{p}a}\) i.e. \(\{h_{j_{1}}(x_{i}),,h_{j_{k}}(x_{i})\}\) and \(\{h_{j_{k+1}}(x_{i}),,h_{j_{a}}(x_{i})\}\) respectively. If \(h_{j}(x)^{p}}{d_{max}^{p}a}\), then

\[e^{-b_{0}_{}(x,B_{_{0}}(y_{i}))}^{p} }{d_{max}^{p} a}>e^{-b_{0}_{0}}\]so \(_{}(x,B_{_{0}}(y_{i}))<_{0}\). Then

\[_{p}^{p}(g(S),S) _{i=1}^{n}_{j=1}^{m}w_{i}(x_{i})}{\|h(x_{i} )\|_{1}}_{}(x_{i},y_{j})^{p}.\] \[<_{i=1}^{n}w_{i}_{=1}^{k}}(x_ {i})}{\|h(x_{i})\|_{1}}(2_{0})^{p}+_{=k+1}^{a}^{ p}}{d_{max}^{p} a}d_{max}^{p}_{}(x_{i},y_{j}) d_{max}\] \[_{i=1}^{n}w_{i}(2^{p}_{0}^{p}+_{0}^{p}) 2 ^{p}[p]{/2}^{p}+} <+=\]

Thus, the encoding function \(\) and the decoding function \(g\) make up a \((,a,G)\)-sketch. 

Note that the sketch outlined in Theorem 3.4 is a smooth version of a one-hot encoding. With Theorem 3.4 and Lemma 3.3, we will now give an explicit formulation of an \(\)-approximation of \(f\) via sum-pooling of continuous functions.

**Corollary 3.5**: _Let \(>0,\;(,d_{})\) be a compact metric space and let \(\) be the space of weighted point sets equipped with the \(p\)-Wasserstein, \(_{p}\). Suppose for any \(,\;(,d_{})\) has covering number \(a()\). Then given a function \(f:\) that is uniformly continuous and permutation invariant, there is continuous functions \(h:^{a()}\), \(:^{a()}^{a^{}}\), and \(:^{a^{}}\), such that for any \(A,B\)_

\[|f(A,B)-_{(x,w_{x}) A}w_{x}h(x)+ _{(x,w_{x}) B}w_{x}h(x)|<\]

_where \(h,\) and \(\) are all continuous and \(a^{}=4 a()+1\)._

Due to Eqn. (1), instead of considering the function \(\) which takes a set of points \(S\) as input, we now only need to model the function \(h:^{a}\), which takes **a single point \(x S\)** as input. For simplicity, assume that the input metric space \((,d_{})\) is a compact set in some Euclidean space \(^{d}\). Note that in contrast to Lemma 3.3, each \(h\), \(\) and \(\) is simply a continuous function, and there is no further group invariance requirement. Furthermore, all the dimensions of the domain and range of these functions are bounded values that depend only on the covering number of \(\), the target additive error \(\), and independent to the maximum size \(N\) of input points. We can use multilayer perceptrons (MLPs) \(h_{_{1}}\), \(_{_{2}}\), and \(_{_{3}}\) in place of \(h\), \(\) and \(\) to approximate the desired function. Formally, we define the following family of neural networks:

\[_{}(A,B)=_{_{3}}_{_{2 }}_{(x,w_{x}) A}w_{x}h_{_{1}}(x)+_{_{2}} _{(x,w_{x}) B}w_{x}h_{_{1}}(x). \]

In practice, we consider the input to the the neural network \(h_{_{1}}\) to be a point \(x\) along with its weight \(w_{x}\). As per the discussions above, functions represented by \(_{}\) can universally approximate SFGI product functions on the space of point sets. See Figure 1 for an illustration of our universal architecture for approximating product functions on point sets. As \(p\)-Wasserstein distances, \(_{p}:\), are uniformly continuous with respect to the underlying metric \(_{p}\), we can apply our framework for the problem of approximating \(p\)-Wasserstein.

Importantly, the number of parameters in \(_{}\) does not depend on the maximum size of the point set but rather only on the \(\) additive error and by extension, the covering number of the original metric space. This is because the encoding function for our sketch is defined as the summation of single points into \(^{a}\) where \(a\) is independent of the size of the input set. Contrast this result with latent dimension in the universality statement of DeepSets (cf. Theorem 2.1), which is dependent on the input point set size. Note that in general, the model complexities of the MLPs \(_{_{3}}\), \(_{_{2}}\), and \(h_{_{1}}\) depend on the dimensions of the domain and co-domain of each function they approximate (\(\), \(\) and \(h\)) and the desired approximation error \(\). We assume that MLPs are Lipschitz continuous. In our case, \(_{_{2}}\) operates on the sum of \(h_{_{1}}(x)\)s for all \(N\) number of input points in \(A\) (or in \(B\)). In general, the error made in \(h\)s may accumulate \(N\) times, which causes the precision we must achieve for each individual \(h_{_{1}}(x)\) (compared to \(h(x)\)) to be \((/N)\). This would have caused the model complexity of \(h_{_{1}}\) to depend on \(N\). Fortunately, this is not the case for our encodingfunction \(h\). In particular, because our encoding function can be written in the specific form of a normalized sum of individual points in the set \(S\); i.e, \(_{_{2}}\) operates on \(_{(x,w_{x}) S}w_{x}h_{_{1}}(x)\) with \(_{x}w_{x}=1\), the error accumulated by the normalized sum will be less than the maximum error from any single point \(h(x)\) for \(x S\). Thus, as both the error for each MLP and the dimension of the domain and co-domain of each approximated function \((,,h)\) do not depend on the size of the input point set \(N\), we get that \(_{_{3}}\), \(_{_{2}}\) and \(h_{_{1}}\) each have model complexity independent of the size of the input point set. In short, because the encoding and decoding functions of our sketch can be approximated with neural networks with model complexity _independent_ of input point set size, we are able to achieve a low model complexity neural network which can approximate Wasserstein distance arbitrarily well. Note that in general, we are not guaranteed to be able to find a sketch which can be approximated by neural networks which are independent of input size. Finally, this neural network architecture can also be applied to approximating Hausdorff distance. More details regarding Hausdorff distance approximation are available in Appendix A. We summarize the above results in the following corollary.

**Corollary 3.6**: _There is a network in the form of \(_{}\) which can approximate the \(p\)-Wasserstein distance between point sets to within an additive \(\)-error. The number of parameters in this network depends on \(\) and the covering number of \(\) and not on the size of each point set._

_Additionally, if we replace the sum-pooling with \(\) in \(_{}\), there is a network of such a form where we can also approximate Hausdorff distance between point sets to additive \(\) accuracy._

Exponential dependence on dimensionAlthough the model complexity of \(_{}\) is independent of the size of the input point set, it depends on the covering number of \(\) which, in turn, can have an exponential dependence on the dimension of \(\). In short, this means that the model complexity of \(_{}\) has an exponential dependence on the dimension of \(\). However, in practice, many machine learning tasks (e.g. 3D point processing) involve large point sets sampled from low-dimensional space (\(d=3\)). Furthermore, in general, the covering number of \(\) will depend on the _intrinsic dimension_ of \(\) rather than the _ambient dimension_. For instance, if the input point sets are sampled from a hidden manifold of dimension \(d^{}\) (where \(d^{}\) which is much lower than the ambient dimension \(d\)), then the covering number would depend only on \(d^{}\) and the curvature bound of the manifold. In many modern machine learning applications, it is often assumed that the data is sampled from a hidden space of low dimension (the manifold hypothesis) although the ambient dimension might be very high.

Using max-pooling instead of sum-pooling.Observe that in the final step of combining the Euclidean outputs for two point sets \(A,B\), \(_{(x,w_{x}) A}w_{x}h_{_{1}}(x)+_{(x,w_{x}) B}w_{x}h_{ _{1}}(x)\), we use the sum of these two components (as in a DeepSet architecture) : \(_{(x,w_{x}) A}w_{x}h_{_{1}}(x)\) and \(_{(x,w_{x}) B}w_{x}h_{_{1}}(x)\), to ensure the symmetric condition of SFGI product functions. One could replace this final sum with a final max such as in PointNet. However, to show that PointNets are able to universally approximate continuous functions \(F:K\) where \(K^{a 2}\) is compact, we need

Figure 1: Visually representing a neural network which can universally approximate uniformly continuous SFGI product functions over pairs of point sets.

[MISSING_PAGE_FAIL:9]

search with respect to the parameters of each model. Finally, we use the ModelNet40  dataset which consists of point clouds in \(^{3}\) and a gene expression dataset (RNAseq) which consists of 4360 cells each represented by 2000 genes (i.e. 4360 points in \(^{2000}\)) as well as three synthetic datasets: (1) uniform, where point sets are in \(^{2}\), (2) noisy-sphere-3, where point sets are in \(^{3}\), (3) noisy-sphere-6, where point sets are in \(^{6}\). The RNAseq dataset is publicly available courtesy of the Allen institute . Additional details and experiments approximating the 2-Wasserstein distance are available in Appendix D.

Approximating Wasserstein distances.Our results comparing 1-Wasserstein distance approximations are summarized in Table 1. Additionally, see Table 3 for a summary of time needed for training. For most datasets, \(_{}\) produces more accurate approximations of Wasserstein distances for both input point sets seen at training time and for input point sets unseen at training time. For the high dimensional RNAseq dataset, our approximation remains accurate in comparison with other methods, including the standard Sinkhorn approximation for input point sets seen at training time. The only exception is ModelNet-small, where \(_{}\) approximation error is slightly larger than WPCE for input point set sizes using during training (top row for each dataset in Table 1). However, for point sets where the input sizes were not used during training (bottom row for each dataset in Table 1), \(_{}\) showed significantly lower error than all other methods including WPCE. These results along with a more detailed plot in Figure 2 in Appendix D indicate that \(_{}\) generalizes better than WPCE to point sets of input sizes unseen at training time. Also, see Appendix D for additional discussion about generalization. Furthermore, one major advantage of \(_{}\) over WPCE is the dramatically reduced time needed for training (cf. Table 2). This substantial difference in training time is due to WPCE's usage of the Sinkhorn reconstruction loss as the \(O(n^{2})\) computation time for the Sinkhorn distance can be prohibitively expensive as input point set sizes grow. Thus, our results indicate that, compared to WPCE, \(_{}\) can reduce training time while still achieving comparable or better quality approximations of Wasserstein distance. Using our \(_{}\), we can produce high quality approximations of 1-Wasserstein distance while avoiding the extra cost associated with using an autoencoder architecture and Sinkhorn regularization. Finally, all models produce much faster approximations than the Sinkhorn distance (see Tables 3 and 6 in Appendix D). In summary, as compared to WPCE, our model is more accurate in approximating both 1-Wasserstein distance, generalizes better to larger input point set sizes, and is more efficient in terms of training time.

## 5 Concluding Remarks

Our work presents a general neural network framework for approximating SFGI functions which can be combined with geometric sketching ideas into a specific and efficient neural network for approximating \(p\)-Wasserstein distances. We intend to utilize \(_{}\) as an **accurate, efficient, and differentiable** approximation for Wasserstein distance in downstream machine learning tasks where Wasserstein distance is employed, such as loss functions for aligning single cell multi-omics data  or compressing energy profiles in high energy particle colliders [10; 26]. Beyond Wasserstein distance, we will look to apply our framework to a wide array of geometric problems that can be considered SFGI functions and are desireable to approximate via neural networks. For instance, consider the problems of computing the optimal Wasserstein distance under rigid transformation or the Gromov-Wasserstein distance, which both can be represented as an SFGI function where the factor-wise group invariances include both permutation and rigid transformations. Then our sketch must be invariant to both permutations and orthogonal group actions on the left. It remains to be seen if there is a neural network architecture which can approximate such an SFGI function to within an arbitrary additive \(\)-error where the complexity does not depend on the maximum size of the input set.

## 6 Acknowledgements

The authors thank anonymous reviewers for their helpful comments. Furthermore, the authors thank Rohan Gala and the Allen Institute for generously providing the RNAseq dataset. Finally, Samantha Chen would like to thank Puoya Tabaghi for many helpful discussions about permutation invariant neural networks and Tristan Brugere for his implementation of the Sinkhorn algorithm. This research is supported by National Science Foundation (NSF) grants CCF-2112665 and CCF-2217058 and National Institutes of Health (NIH) grant RF1 MH125317.