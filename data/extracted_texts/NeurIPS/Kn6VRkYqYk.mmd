# [MISSING_PAGE_FAIL:1]

[MISSING_PAGE_FAIL:1]

Our main contribution in this work is motivated by this need for benchmarking exploratory camera motion estimations in deforming scenes. Publicly available datasets imaging deforming scenes do not cover exploratory trajectories, and the ones that do cover them do not have ground truth geometric annotations. Our proposal is a synthetic dataset that we denote as the "Drunkard's Dataset", containing a set of high-resolution RGB images, ground truth depth, optical flow, normal maps and camera pose trajectories in synthetic but texture-realistic deforming scenes. In order to generate a sufficient amount and variety of data, we imported the real-world scanned indoor 3D models of the Habitat-Matterport 3D dataset , added dynamic deformations, and generated trajectories within them. Figure 1 shows several data samples with the camera trajectory that advances over time. As the original 3D models are real-world scans, camera trajectory and depth are in consistent metric scale along scenes. To make it a scalable benchmark dataset, every scene was recorded under four different levels of reconstruction difficulty, increasing the deformation and camera trajectory perturbations (observe them in Figure 1). The Drunkard's Dataset is unique in its kind, providing large-scale data in deformable scenes, which will enable both, benchmarking non-rigid navigation and reconstruction methods, as well as sufficient data to evaluate the potential benefits of deep learning. Please visit our project website for further details and access to the dataset and source code.

Scientific progress is in many occasions based on well-established and public benchmarks. This has been the specific case in computer vision research in the last decades, up to the point that the existence of some benchmarks is highly correlated with scientific progress in the field. Data repositories are also essential nowadays not only to benchmark different methods, but also to train deep neural networks. However, collecting large amounts of data with non-rigid content is challenging due to difficulties in annotation, as argued by Li et al. . Indeed, some very popular datasets are synthetic .

Capturing large-scale data in sufficiently large non-rigid spaces, in order to benchmark odometry/SLAM methods, is even more challenging. Having ground truth annotations, in particular in the medical domain, hugely increases the challenge. The most popular medical datasets  are small, lack geometric ground truth, or both. As a result, comparisons between methods are very often inaccurate, inconclusive or questionable. This motivates our work.

The second contribution of this paper is the Drunkard's Odometry (see Figure 2), a flow-based odometry method for camera motion estimation from RGB-D sequences in deformable scenes. Our method is inspired by the pose estimation of DROID-SLAM  and by the 3D scene flow prediction of RAFT-3D . Our novelty compared to both is that our architecture models potential scene deformations.

Figure 1: **Sample scene of the Drunkard’s Dataset.** The dataset provides various levels of scene deformation. **Top row:** Sample frames from Scene 0 over all difficulty levels \(0-3\). **Bottom row:** External views showing the ground truth camera trajectory in green and the camera frame in purple. With increasing deformation level the camera motion is more abrupt. See animations with _Adobe Reader_, _KDE Okular_ or YouTube.

As third contribution, in order to validate methods also in non-annotated data, we present a novel metric, the Absolute Palindrome Trajectory Error (\(\)). Our novel metric is based on running odometry methods forwards and backwards in a sequence of images, and comparing the pose errors between the first and last frames through different loop lengths. This metric may be useful for validating methods in realistic setups, but it is limited to relative errors between two poses, and hence it is not as informative as metrics using ground truth labels. For this reason, we believe that \(\) in real sequences should not be trusted on its own, but as a complement to a larger and more informative set of metrics in our simulated Drunkard's Dataset.

## 2 Related Work

Structure from Motion, visual odometry and visual SLAM methods for rigid scenes are commonly evaluated in a well established set of publicly available datasets , with ground truth geometric annotations and under the same metrics, which facilitates comparisons between them and progress in the field. Large-scale annotations for geometric ground truth are quite challenging in real scenarios, and still contain small errors due to the accuracy of the equipment (GPS or motion capture systems) used. An accurate approximation of the depth and camera pose could be recorded with sensors, but could not obtain such a good quality of optical flow and normal maps. In real-world applications that involve significant deformations, such as endoscopies, these sensors cannot be even equipped. While we could attempt to simulate a small-scale scenario using moving blankets or bouncy castles, it would fall short in terms of capturing a wide range of textures, deformations, and camera trajectories. Virtual environments, on the other hand, offer superior solution, providing a rich and diverse representation of the complex conditions that are found in real-world settings. Synthetic datasets solve these issues at the price of the sim-to-real gap, and are common for benchmarking methods on navigation and reconstruction on rigid scenes . For similar reasons, synthetic datasets are widely used in other computer vision tasks, such as stereo and flow , depth , object recognition and segmentation , object pose estimation and tracking , and scene segmentation, understanding and reasoning . For additional insights and references on the use of synthetic data in deep learning, the reader is referred to the excellent survey by Nikolenko .

Note that, in most of the datasets cited, in particular those for faces and humans bodies, the camera is almost stationary. For the few datasets where the camera moves sufficiently, exploring new areas, the covered region is in any case reduced, deformations are small or there is absence of geometric

    &  &  &  &  &  \\  & & & & & **ratory** \\  De Aguiar _et al._ & Real & ✓ & ✗ & \( 6\)K & Human bodies \\ FAUST  & Real & ✓ & ✗ & \( 9\)K & Human bodies \\ NRSSM Challenge  & Real & ✓ & ✗ & - & Objects \\ Deforming Things4D  & Sim & ✓ & ✗ & \( 122\)K & Humans \& animals \\ Prou  & Sim & ✓ & ✗ & \( 20\)K & Faces \\ EndoMapper  & Real & ✗ & ✓ & \( 4\)M & Colonocopies \\ Hamlyn  & Real & ✗ & ✓ & \( 93\)K & Laparoscopies \\
**Drunkard’s (ours)** & Sim & ✓ & ✓ & \( 416\)K & Indoor scenes \\   

Table 1: **Overview of existing non-rigid dataset specifications compared to our Drunkard’s dataset.**

Figure 2: **Overview of the Drunkard’s Odometry pipeline.**

ground truth (see Table 1). This poses difficulties for benchmarking methods for odometry and SLAM targeting non-rigid environments, such as . Odometry and SLAM methods for deformable scenes are scarce in the literature, being  the most representative ones. However, they are all based on feature matching or direct tracking, which make them unstable in challenging sequences. Differently, our Drunkard's Odometry is based on scene flow, which makes it significantly more robust.

## 3 The Drunkard's Dataset

The Drunkard's Dataset is a publicly available set of \(19\) different camera trajectory recordings of \(19\) different deforming indoor scenes, where each one has been recorded four times, one for each difficulty level. For each level, we generated over \(100\)K frames and recorded camera poses, RGB images, depths, optical flow and normal maps at \(1920 1920\), being the camera poses and the depth in consistent real-world metric scale throughout different scenes. Find sample images in Figure 3.

We used Blender  to render the deformations of the \(19\) real-world scanned indoor 3D models of the Habitat-Matterport 3D dataset . We manually designed camera trajectories such that every room in each building is visited once and the camera trajectory returns at the starting point, except for scenes \(4\), \(9\) and \(14\), in which the camera traverses the building three times, but in each loop visiting the rooms in different order. The Blender files are publicly available, along with the scripts we used for generating them, so that anyone can render in-house versions of the Drunkard's Dataset scenes modifying parameters of deformations, pose trajectory, resolution or camera type among others.

As Table 2 details, level 0 stands for zero deformation and camera noise, resulting in a rigid scene and a smooth camera motion, well suited for rigid SfM/SLAM methods. The following levels have an increasing degree of deformation and trajectory noise. Having four levels of difficulty allows to benchmark both rigid and non-rigid methods in a graduated manner.

  
**Difficulty level** & **Deformations** & **Trajectory noise** \\  Level 0 & 0 & 0 \\ Level 1 & Low & Low \\ Level 2 & Medium & Medium \\
**Level 3** & **High** & **High** \\   

Table 2: **Overview of the four difficulty levels.** Deformation and camera trajectory noises increases with higher levels. At level 0 there is neither deformation nor camera noise, i.e. it represents a rigid scene and a smooth motion.

Figure 3: **Sample images of the Drunkard’s Dataset** with their corresponding depth, optical flow and normal maps. Non-rigid deformations are simulated by smooth deformations of all scene parts.

## 4 The Drunkard's Odometry

Given a pair of RGB-D images \(\{_{i},}_{i}\}\), \(_{i}^{w h 3}\) and \(}_{i}^{w h}\), \(i\{1,2\}\), our Drunkard's Odometry estimates a dense scene flow \(^{k}(3)^{w h}\) between them, and the relative camera motion \(^{k}_{c}(3)\) iteratively (\(k\{1,,M\}\) stands for the iterative block step). \(^{k}\) contains pixel-wise rigid-body transformations that ideally, i.e. in absence of noise, maps every 3D point \(_{j}=^{-1}(_{j},_{j})\) -corresponding to pixel \(j_{1}\), back-projected from the pixel with image coordinates \(_{j}_{1}\) (\(_{1}\) is the image domain for \(_{1}\)) and its sensor (ground truth) depth \(_{j}}_{1}[_{j}]\)- to its ground truth equivalent 3D point \(}_{j^{}}=^{-1}(}_{j^{}}, _{j^{}})\) back-projected from the true associated pixel with image coordinates \(}_{j^{}}_{2}\) (\(_{2}\) as the image domain for \(_{2}\)) and sensor depth \(_{j^{}}}_{2}[}_{j^{}}]\). \(^{-1}(,z)\) stands for the inverse projection model. As the estimated scene flow \(^{k}\) might be affected by noise, we will denote as \(^{k}_{j^{}}=^{k}[_{j}]_{j}\) the transformation of \(_{j}\) to the local frame of \(_{2}\), that in general will not coincide the true corresponding point \(}_{j^{}}\). \(^{k}[_{j}]\) is composed of the rigid transformation coming from the camera motion \(^{k}_{c}\) and the one coming from the non-rigid surface deformations \(^{k}_{d}[_{j}](3)\), so that \(^{k}[_{j}]=^{k}_{c}^{k}_{ d}[_{j}]\). If the scene is rigid \(^{k}_{j^{}}=^{k}_{c}^{k}_{j}\), and if it is deforming \(^{k}_{j^{}}=^{k}_{c}^{k}_{d}[ _{j}]^{k}_{j}\).

Our iterative pose estimation model, shown in detail in Figure 4, is based on the foundations of the 3D flow estimation architecture of RAFT-3D , which does not have pose estimation capabilities at all. Firstly, a pose regression network encodes both color images \(_{1}\) and \(_{2}\) and outputs a initial pre-estimate for the camera motion \(^{}_{c}\). This rigid transformation is used for initialization, so that for any \(_{j}\) pixel of camera 1 \(^{}[_{j}]=^{}_ {c}\). Additionally, we encode both images \(_{1}\) and \(_{2}\) in two feature maps, which we use to build a 4D correlation pyramid between the features of all pixel pairs at four different scales, each scale halving the resolution of the previous one. From \(^{k}\) and \(}_{1}\) at each iteration \(k\), we can obtain dense 2D pixel correspondences \(_{j}_{j^{}}\)

\[^{k}_{j^{}}=(^{-1}(_{j},_{j} ),^{k}[_{j}])\,\] (1)

where \((,[])\) stands for the pinhole camera projection model. At the beginning of each iteration, these correspondences are used to sample the correlation features from the fixed 4D correlation pyramid and it is one of the inputs of the update block. The estimated optical flow \(^{k}^{w h 2}\) coming from these correspondences is also an input for the update block, being \(^{k}[_{j}]=^{k}_{j^{}}-_{j}\).

The update block also takes as input an inverse depth residual obtained from the difference between the estimated inverse depth map \(^{k}_{2}^{w h}\) and the sensor inverse depth \(}_{2}^{w h}\), \(}_{2}[^{k}_{j^{}}]= }{{}_{2}}}[^{k}_{j^{}}]\), \(^{k}_{j^{}}_{2}\). Values for \(^{k}_{2}\) are interpolated from the grid defined by \(^{k}_{2,j^{}}=^{k}_{2}[^{k}_{j^{}} ]=^{}_{3}^{k}_{j^{}}\). \(_{3}=(0\ 0\ 1)^{}\) acts as a selector of the third dimension of the 3D point.

Figure 4: **Drunkard’s Odometry architecture in detail.**A pair of context features that extracts semantic and contextual information from image 1 are also pre-rendered before entering the iterative process using a context encoder network and given to the update block. One context feature map is kept fixed during all iterations and another is used as initialization of the hidden state of the General Recurrent Unit (GRU) , which is at the heart of the update block (see the network fine-grained details in the supplementary material).

At each iteration \(k\), the estimates for \(^{k}\) and \(^{k}_{c}\) are mapped to the Lie algebra with a logarithm map to result in a twist field \(^{k}=_{(3)}(^{k})\) and \(^{k}_{c}=_{(3)}(^{k}_{c})\) before being given to the update block. The update operator outputs a set of updates for the optical flow \(^{k}\), for the twist camera pose \(^{k}_{c}\) and for the inverse depth \(^{k}_{2}\), the hidden state of the recurrent network, a mask and a set of rigid-motion embeddings and confidence maps. These last two maps, next to the updated estimate of \(^{k}_{2}\) and \(^{k}\), and \(_{1}\) are used by the least-squares optimizer block to update \(^{k}\) (see details in  for this update). Scene flow is updated as \(^{k+1}=^{k}_{(3)}(^{k})\).

Internally the network works at \(1/8^{th}\) of the original resolution, and the estimated mask at each iteration of the update block is used to perform a convex upsampling to the original resolution of \(^{k}\) and intermediate updated 2D flow \(^{k}^{w h 2}\) by the update block.

The supervision comes from comparing the estimated optical flow \(^{k}\) obtained from \(^{k}\) and \(}_{1}\) with Eq. 1 and the intermediate pre-estimated \(^{k}\) with the ground truth optical flow \(}^{w h 2}\), the inverse depth error between \(_{2}\) and \(}_{2}\), the relative camera pose error of \(_{c}\) and the initial guess pre-estimated by the pose network \(^{}_{c}\) against \(}_{c}\). The total loss results in

\[=^{}_{}+_{k=1}^{M}^{M-k} (^{k}_{}+^{k}_{}+^{k}_{})\ \,\] (2)

with \(^{k}_{}=_{_{j}}(\|^{k}- }\|_{1}+w_{1}\|^{k}- }\|_{1})\) being the optical flow loss term, \(^{k}_{}=w_{2}_{_{j}}\|^{ k}_{2}[_{j}]-}_{2}[_{j}]\|_{1}\) the inverse depth loss term, and \(_{}=w_{3}\|_{(3)}(_{c} }^{-1}_{c})\|_{1}\) and \(^{}_{}=w_{4}\|_{(3)}( ^{}_{c}}^{-1}_{c})\|_{1}\) the relative camera pose loss terms. \(w_{l}\) stands for the relative weight of the \(l^{th}\) loss term and \(\) weights each loop.

## 5 Experiments

In this section, we show the evaluation results of our Drunkard's Odometry against several relevant baselines in two non-rigid datasets: our synthetic Drunkard's and the real Hamlyn data [39; 30; 40; 41].

**Drunkard's Setup.** We trained our Drunkard's Odometry in all scenes of the Drunkard's Dataset except the test ones, with around \(90-10\%\) ratio for training and testing, respectively, of the difficulty level 1 with an input resolution of \(320 320\), batch size of \(12\), learning rate of \(10^{-4}\), Adam optimizer , weight decay of \(10^{-5}\), \(12\) iterations of the iterative block during training and test, hyperparameters \(w_{1}=0.2\), \(w_{2}=100\), \(w_{3}=200\) and \(w_{4}=6\), and during \(10\) epochs (\( 3\) days) on a single RTX Nvidia Titan. An ablation study available in the Supplementary Material was performed to obtain the hyperparameter values. Everything was trained from scratch except for the pose network encoder which was pre-trained on ImageNet .

**Drunkard's Benchmark.** We put to fight our Drunkard's Odometry in the Drunkard's Dataset benchmark against the gold-standard SfM pipeline COLMAP [72; 73], that searches for matches across all images in an offline manner using only the RGB channels of our images; the robust and accurate DROID-SLAM  that uses a combination of local-online and global-offline bundle adjustment refinements, trained also in virtual environments of buildings with optical flow and with a well-proved generalization capability between datasets, evaluated using the same RGB-D images as Drunkard's Odometry; and the frame-to-frame tracking designed for non-rigid endoscopic scenes Endo-Depth-and-Motion (EDaM)  that here uses the RGB plus the single-view estimated depth maps by a network trained self-supervisedly on monocular images of KITTI . The non-rigid SfM SD-DefSLAM  was tested but fails in the beginning of the sequences. Complex non-rigid optimization methods such as this one are unstable and tend to fail in difficult sequences with complicated 3D surfaces and abrupt camera trajectories like the ones in our Drunkard's Dataset.

We chose scenes 0, 4 and 5 as the test ones with \(3.816\), \(4.545\) and \(1.655\) frames respectively. The rest of the scenes were used for training. The trajectories estimated by COLMAP and EDaM are compared against the ground truth after \((3)\) alignment, as they are up-to-scale. DROID-SLAM and our Drunkard's are aligned to the ground truth with a \((3)\) transformation, as the RGB-D input allows them to estimate the real scale. As using \((3)\) against \((3)\) is not totally fair since the former applies a scale correction, we also test EDaM using the ground truth depth maps so we can apply \((3)\) alignment. The reported metrics are: Relative Position Error (RPE) for translation and rotation, that measures the local accuracy of the estimated trajectory against the ground truth between consecutive frames, and the Absolute Trajectory Error (ATE) for translation that computes the global consistency between both trajectories (see  for details).

For each sequence, the percentage of registered frames over the total is shown, a metric in which COLMAP shows poor performance. As a consequence, its trajectory metrics are influenced positively as it excludes frames that are challenging to track and probably would have increased the error. This is beneficial in particular for the ATE, as it takes into account the global consistency rather than frame-to-frame errors like the RPE, and happens earlier in higher deforming scenes. Also note that DROID-SLAM is very GPU-memory demanding, in part because of the final global bundle adjustment and it is not able work with long sequences like Scene 4. However, our Drunkard's Odometry and EDaM are more robust, partly due to tracking only between adjacent frames.

Table 3 shows our results. Note that our Drunkard's Odometry practically always outperforms DROID-SLAM and EDaM (with and without ground truth depth) in RPE and ATE, also in rigid scenes, even if our model is trained exclusively in non-rigid scenes and does not use loop closure or full bundle adjustment. The gap is significantly larger at higher deformation levels, for which the Drunkard's Odometry errors increase much less. This demonstrates that our method is able to generalize at predicting surface deformations. Only COLMAP is able to outperform our Drunkard's Odometry in ATE. Note, in any case, that COLMAP has a much lower recall, as it only estimates camera motion for a substantially lower percentage of frames. If we focus on RPE, a more fair metric in this case, our Drunkard's Odometry is on par to COLMAP at lower deformation levels, and clearly outperforms it at higher ones.

**Validation in real endoscopies.** We used the Hamlyn dataset , that contains intracorporeal endoscopic RGB scenes with weak textures, deformations and reflections. Specifically, we chose scenes 1 and 17 (see Figure 5), which are significant exploratory ones. Most of Hamlyn's videos have very small camera motions, being of no interest for benchmarking odometry methods. We slightly cropped the images to remove black pixels at the borders. Depth data was taken from the public tracking test data of EDaM  which was estimated by a single-view dense depth network trained in a self-supervised manner in all Hamlyn scenes except for the test ones. Note that this depth does not have the same quality as the real ground truth one from the Drunkard's Dataset.

    & &  &  &  &  \\   & & & frames & RPE & RPE & ATE & frames & RPE & RPE & ATE & frames & RPE & RPE & ATE \\
**Scene Method** & **ment** & [\%] & [\%] & [\%] & [\%] & [\%] & [\%] & [\%] & [\%] & [\%] & [\%] & [\%] & [\%] & [\%] & [\%] & [\%] & [\%] & [\%] \\  COLMAP  & \((3)\) & 42 & 0.36 & 0.10 & 0.11 & 42 & 0.85 & 0.18 & 0.12 & 42 & 1.89 & 0.35 & 0.81 & 25 & 3.64 & 0.51 & 1.14 \\ DROD-SLAM  & \((3)\) & 0 & 0.07 & 0.78 & 0.28 & 2.38 & 100 & 1.41 & 0.24 & 1.79 & 1.00 & 2.53 & 0.69 & 1.26 & 100 & 3.58 & 0.11 & 1.00 \\ EDaM  & \((3)\) & 100 & 1.83 & 1.21 & 1.49 & 1.08 & 1.23 & 1.73 & 1.83 & 100 & 2.05 & 1.72 & 1.95 & 100 & 2.66 & 2.27 & 2.01 \\ EDaM w/GT depth & \((3)\) & 100 & 2.05 & 1.13 & 2.01 & 100 & 2.28 & 1.28 & 1.78 & 100 & 2.89 & 1.17 & 2.24 & 100 & 3.57 & 2.15 & 2.42 \\ Drunkard's Odometry \((3)\) & 100 & **0.34** & **0.10** & 0.67 & 100 & **0.59** & **0.16** & 1.00 & 1.14 & **0.22** & 1.35 & 100 & **1.28** & **0.48** & 1.74 \\  COLMAP  & \((3)\) & 32 & **0.03** & **0.03** & **0.10** & 32 & 1.2 & **0.15** & **0.24** & 32 & 31.20 & 0.30 & 0.20 & 23 & 8.59 & 0.71 & 2.31 \\ DROD-SLAM  & \((3)\) & 0 & 0 & - & - & - & - & - & - & - & - & - & - & - & - & - \\
4 EDaM  & \((3)\) & 100 & 5.50 & 2.16 & 4.85 & 100 & 5.27 & 2.27 & 4.81 & 100 & 5.39 & 2.56 & 4.79 & 100 & 5.88 & 2.96 & 4.90 \\ EDaM w/GT depth & \((3)\) & 100 & 6.01 & 2.02 & 7.85 & 100 & 5.99 & 2.14 & 7.26 & 100 & 6.31 & 2.04 & 7.94 & 30 & 6.81 & 8.90 & 2.96 \\ Drunkard's Odometry \((3)\) & 100 & 6.00 & 0.14 & 1.21 & 100 & **0.03** & **0.18** & 11.39 & 1.30 & 100 & **0.28** & **0.24** & 100 & 2.26 & **0.36** & 4.66 \\  COLMAP  & \((3)\) & 100 & **0.40** & **0.08** & **0.20** & 80 & 1.12 & **0.16** & **0.53** & 100 & 3.58 & 0.356 & 13.38 & 31 & 4.95 & **0.46** & **2.45** \\ DROD-SLAM  & \((3)\) & 100 & 0.56 & 0.21 & 1.25 & 100 & 1.52 & 0.39 & 1.56 & 100 & 3.16 & 0.67 & 2.43 & 100 & 4.69 & 1.02 & 2.70 \\
5 EDaM w/GT depth & \((3)\) & 100 & 3.05 & 1.98 & 2.82 & 100 & 3.13 & 2.11 & 2.73 & 100 & 3.57 & 2.46 & 2.99 & 100 & 4.12 & 2.98 & 2.86 \\ Drunkard's Odometry \((3)\) & 100 & 4.63 & 1.95 & 4.00 & 100 & 4.65 & 2.07 & 2.86 & 100 & 5.21 & 2.43 & 4.19 & 100 & 6.01 & 2.91 & 4.03 \\ Drunkard’s Odometry \((3)\) & 100 & 0.45 & 0.13 & 0.47 & 100 & **0.74** & 0.18 & 0.70 & 100 & **1.44** & **0.29** & **1.24** & 100 & **2.40** & 0.49 & **2.45** \\   

Table 3: **Trajectory errors for Drunkard’s test scenes for all difficulty levels.** Note that COLMAP is an offline method and is only shown for reference. Our odometry method mostly outperforms the compared online odometry methods. Best results are highlighted as **first**, **second**, and **third**.

Since the Hamlyn dataset lacks ground truth camera poses, we propose a novel ground truth-free trajectory metric to measure the quality of the estimated odometries. The key idea is to generate loopy videos by duplicating and reversing a given image sequence and concatenating it to the end of the original sequence. The generated "palindrome video" is twice as long as the original sequence and any tracking method should ideally loop back to its starting position. We then simply measure the discrepancy between start and end pose and accumulate it over various loop lengths. We denote the new metric as the Absolute Palindrome Trajectory Error (\(\)) and define it as

\[=^{N}_{k}}{N} _{k}=\|(_{j=1}^{k}_{cj}^{back} )(_{j=1}^{k}_{cj})\|_{2}\,\] (3)

where \(N\) is the total number of frames and \(_{k}\) the translation Root Mean Squared Error (RMSE) of between the first and last pose of the sub-trajectory loop \(k\). This last pose of the loop \(k\) is the result of sequentially applying to the starting camera pose -the identity \((3)\)- the first \(k\) estimated relative camera poses \(_{c}\) for the scene plus the first \(k\) estimated relative camera poses for the same scene but ran backwards \(_{c}^{back}\). Then, the \(_{k}\) is the module of the translation of this last estimated pose. We note that the \(\) error is trivially minimized if all transformations are zero or close to the origin, but these cases are easy to check visualizing the trajectory.

Table (c)c shows our \(\) metric in the Hamlyn test scenes for the baselines that are able to track the whole scene (EDaM and DROID-SLAM) and two versions of our Drunkard's Odometry, one trained only in rigid scenes of the Drunkard's Dataset, i.e. scenes from difficulty level 0, and other in deformable scenes, specifically from level 1. SD-DefSLAM  was also tested here and breaks after a few frames, far from the full length of the trajectory, even having originally been built and tested in Hamlyn. In consequence, it is not possible to compute the \(\) since we need the full trajectory run forward and backward. Before computing the \(\), all the trajectories are scaled with the one given by \((3)\) alignment, having as reference the trajectory estimated by EDaM, since it showed a good qualitative tracking performance in Endo-Depth-and-Motion .

Figure 6 helps to visualize how the \(_{k}\) values evolve as the length of the loops grows. Notice that a longer loop does not always mean higher \(_{k}\). This is because there can be some specific problematic frames with a bad pose estimation that induce a drift accumulation in the following ones getting worse \(_{k}\) measures. However, this can be reversed if the tracking recovers partially during the way back in the loop. The single \(\) values shown in the main paper are the average of all the \(_{k}\) measures.

Figure 7 collects the estimated 3D camera trajectories in the Hamlyn test scenes for all the baselines. It is noteworthy how DROID-SLAM is incorrectly producing sharp and chaotic trajectories around the origin, particularly evident in Scene 1 and partially in Scene 17. This can be further observed in Figure (b)b, where the plot of DROID-SLAM becomes similar to the others in the second half of the video. The other methods produce smoother and plausible estimates. The qualitative evaluation of visualizing the trajectories and the quantitative by the \(\) complement each other. The former helps in recognizing when a method is producing entirely incorrect camera poses, while the latter provides an objective measure for comparing methods when the trajectories already appear good and plausible.

One clear conclusion we can extract is that our model performs better if it is trained in non-rigid scenes rather than rigid. Again, this shows its capacity to learn deformation patterns and retrieve

Figure 5: **Sample color and depth frames and \(\) results for the Hamlyn test videos.**

a more stable camera pose under real-world non-rigid challenging scenes, and even trained in a different domain. Besides, DROID-SLAM's superiority of \(\) in Scene 1 results invalidated by observing how it completely fails to estimate the trajectory in Figure 7. This validates the robustness of the Drunkard's Odometry pipeline in addressing the domain gap problem. Another interesting point to comment on is that the advantage of our Drunkard's Odometry over EDaM may not be clear enough. Their performances are similar in Scene 1, while Drunkard's is better for Scene 17. The evaluation in our dataset shows that our Drunkard's Odometry is significantly better than EDaM. This indeed shows the motivation and benefit for our Drunkard's Dataset: looking at Table 3 we can confidently claim that our Drunkard's Odometry is better than EDaM for camera trajectory estimation. The apparent disagreement with the Hamlyn evaluation may arise from the fact that deformations are not graduated in Hamlyn, and qualitatively they are very small, which may benefit rigid methods.

**Limitations.** Our Drunkard's Dataset's most clear limitation is that it is synthetic. However, as we argued, we believe that the difficulties for acquiring high-quality data with ground truth annotations in the target application domains motivates their use. Notice that it is not possible to record true ground truth optical flow in real-world sequences, as we do not have access to the exact pixel motion information. It is precisely this optical flow availability which unlocks the use of powerful flow-based models trained in synthetic deformable data which generalize well to real non-rigid scenes. Despite the real indoor images of the Drunkard's Dataset may resemble real deformable scenes in texture and

Figure 6: **Camera tracking performance on the Hamlyn dataset. \(_{k}\) values along the \(N\) different \(k\)-frames-length-loops in Hamlyn’s scenes 1 (a) and 17 (b) for EDaM , DROID-SLAM  and Drunkard’s Odometry (ours) with and without having been trained in deformable scenes of the Drunkard’s Dataset (i.e. trained in level 1 and 0, respectively). The training on deforming scene substantially improves the performance of our method.**

Figure 7: **Estimated 3D trajectories in Hamlyn test scenes for different methods. See animations with _Adobe Reader_, _KDE Okular_ or YouTube.**

shape, such as bouncy castles, moving fabrics or canvas, they are far from the medical application environment. Still, we think that generating medical data with realistic deformations, fluids or textures in large scale is out of reach. As a proof, such data does not exist yet and motivates the use of the Drunkard's data. Our Drunkard's Odometry has all the limitations inherent to a frame-to-frame tracking method. Drift accumulates very quickly, and even if our sequences are loopy we do not either detect loop closures or correct our trajectories based on them. However, the SLAM literature shows that SLAM methods (e.g., ) can be built on top of odometry ones (e.g., ).

## 6 Conclusions

Estimating camera motion in deformable scenes is a challenging research problem relatively under-explored in the literature, and for which a lack of clear benchmarks slows down research progress. In this work, we created the Drunkard's Dataset, a large-scale simulated dataset with perfect ground truth and a wide variety of scenes and deformation levels to train and validate deep neural models. In addition, we propose the Drunkard's Odometry method for deformable scenes to validate our dataset. The method minimizes a scene flow loss, but as its main contribution, intrinsically decomposes the estimated twist flow into two components: The majority of motion is aimed to be explained by a rigid-body camera motion, and all remaining motion is explained by scene deformations. In contrast to most existing works our method does not require a static scene part for estimating a reference coordinate frame which is crucial in fully deforming scenarios like endoscopy. To also assess odometry estimates in the absence of ground truth data, we further define a novel ground truth-free metric for trajectory evaluation that measures the cyclic consistency of a tracking algorithm. Both the dataset and source code for our baseline method are publicly available. Our experimental results validate our dataset, illustrates its challenges, and also shows that our Drunkard's Odometry is able to outperform relevant baselines.

**Acknowledgements.** This work was supported by the EU Comission (EU-H2020 EndoMapper GA 863146), the Spanish Government (PID2021-127685NB-I00 and TED2021-131150BI00), the Aragon Government (DGA-T45 17R/FSE), and a research grant from FIFA.