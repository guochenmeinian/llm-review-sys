# MassSpecGym: A benchmark for the discovery and identification of molecules

Roman Bushuiev\({}^{1,2}\), Anton Bushuiev\({}^{2}\), Niek F. de Jonge\({}^{3}\), Adamo Young\({}^{4}\),

Fleming Kretschmer\({}^{5}\), Raman Samusevich\({}^{1,2}\), Janne Heirman\({}^{6}\), Fei Wang\({}^{7,8}\),

Luke Zhang\({}^{9}\), Kai Dihrkop\({}^{5}\), Marcus Ludwig\({}^{10}\), Nils A. Haupt\({}^{5}\), Apurva Kalia\({}^{11}\),

Corinna Brungs\({}^{1}\), Robin Schmid\({}^{1}\), Russell Greiner\({}^{7,8}\), Bo Wang\({}^{4}\), David S. Wishart\({}^{7,12}\),

Li-Ping Liu\({}^{11}\), Juho Rousu\({}^{13}\), Wout Bittremieux\({}^{6}\), Hannes Rost\({}^{9}\), Yttus D. Mak\({}^{14}\),

Soha Hassoun\({}^{11,15}\), Florian Huber\({}^{16}\), Justin J.J. van der Hooft\({}^{3,17}\), Michael A. Stravs\({}^{18}\),

Sebastian Bocker\({}^{5}\), Josef Sivic\({}^{2}\), Tomas Pluskal\({}^{1}\)

###### Abstract

The discovery and identification of molecules in biological and environmental samples is crucial for advancing biomedical and chemical sciences. Tandem mass spectrometry (MS/MS) is the leading technique for high-throughput elucidation of molecular structures. However, decoding a molecular structure from its mass spectrum is exceptionally challenging, even when performed by human experts. As a result, the vast majority of acquired MS/MS spectra remain uninterpreted, thereby limiting our understanding of the underlying (bio)chemical processes. Despite decades of progress in machine learning applications for predicting molecular structures from MS/MS spectra, the development of new methods is severely hindered by the lack of standard datasets and evaluation protocols. To address this problem, we propose MassSpecGym - the first comprehensive benchmark for the discovery and identification of molecules from MS/MS data. Our benchmark comprises the largest publicly available collection of high-quality labeled MS/MS spectra and defines three MS/MS annotation challenges: _de novo_ molecular structure generation, molecule retrieval, and spectrum simulation. It includes new evaluation metrics and a generalization-demanding data split, therefore standardizing the MS/MS annotation tasks and rendering the problem accessible to the broad machine learning community. MassSpecGym is publicly available at https://github.com/pluskal-lab/MassSpecGym.

## 1 Introduction

The discovery and identification of small molecules profoundly influence numerous scientific fields, including organic chemistry , molecular biology , drug development , disease diagnosis , environmental analysis , and space exploration . Despite significant progress, it is estimated that only a small fraction of molecules across the kingdoms of life have been discovered . Tandem mass spectrometry (MS/MS) is the most widely used technique for elucidating molecular structures from biological and environmental samples, supporting a wide range of applications in biotechnology and medicine . In drug development, MS/MS is crucial for identifying novel bioactive compounds , such as those targeting cancer and infectious diseases . MS/MS also plays a key role in clinical settings for determining appropriate drug dosages and assessing potential side effects . In environmental analysis, it enables the detection of pollutants at trace levels, which is vital for monitoring and preserving environmental health . Moreover, MS/MS addresses various challenges in structural biology, including the discovery of ligands that bind to target proteins  and the elucidation of metabolic pathways .

When analyzing a sample, a mass spectrometer typically generates thousands of tandem mass spectra, each characterizing a specific molecule present in the sample. While the annotation of mass spectra with molecular structures is inherent to mass spectrometry, it remains a significant challenge. From typical samples of interest, typically less than 10% of MS/MS spectra are annotated using state-of-the-art methods [14; 15]. As a result, the natural chemical space remains largely unexplored, thereby hindering scientific advancements.

To generate an MS/MS spectrum, a mass spectrometer follows an intricate multi-step procedure. First, the instrument ionizes the molecule using methods such as electrospray ionization (ESI). During this process, the molecule gains additional atoms, known as the ionization adduct. Subsequently, the ionized molecule (often referred to as precursor ion) is fragmented using collision-induced dissociation (CID), higher energy collisional dissociation (HCD), or other fragmentation method . Finally, for each individual fragment ion, the instrument records its (i) mass-to-charge ratio (m/z value; the charge is typically equal to one for small molecules) and (ii) its corresponding abundance (signal intensity). The collection of these two-dimensional data points, characterizing the molecule as a distribution of fragment masses, is referred to as a tandem mass spectrum, MS/MS spectrum, or MS\({}^{2}\) spectrum.

The most notable progress in MS/MS annotation has been achieved by machine learning methods augmented with combinatorial optimization and domain expertise [17; 18]. However, these methods have not seen significant improvements in recent years due to their lack of scalability and small return of increased human knowledge. In contrast, recent years have witnessed numerous purely data-driven deep learning models performing competitively or even surpassing the classic approaches [19; 20; 21; 22; 23; 24; 25; 26; 27]. Nevertheless, the development of this new generation of modern machine learning methods for MS/MS spectrum annotation is currently hindered by multiple factors. These factors include the heterogeneity of data acquired under different mass spectrometry settings, the scarcity of high-quality annotated spectra, variations in data pre-processing techniques, inconsistencies in data splitting methods resulting in data leakage, differences in approaches to MS/MS annotation, varying evaluation metrics, and the proprietary nature of many datasets. As a result, developing a machine learning algorithm for mass spectrum annotation currently necessitates

Figure 1: **MassSpecGym provides three challenges for benchmarking the discovery and identification of new molecules from MS/MS spectra**. The provided challenges abstract the process of scientific discovery from biological and environmental samples into well-defined machine learning problems.

mass spectrometry domain expertise, rigorous data preparation, and the reevaluation of existing methods for benchmarking purposes.

At the same time, dataset collection and benchmarking efforts have been one of the key drivers responsible for breakthrough progress in machine-learning-driven fields, for example: ImageNet , SQuAD , Gym , ProteinGym , and OGB . Inspired by these efforts, we propose MassSpecGym - a new public dataset of MS/MS spectra and a unified benchmarking protocol for MS/MS spectrum annotation (Figure 1). Our dataset provides a standardized collection of 231 thousand high-quality mass spectra representing 29 thousand unique molecular structures, making it the largest publicly available dataset. 10 thousand molecules (33%) present in the dataset are derived from our newly measured in-house data (i.e., MSLab library presented in ). Additionally, we provide a curated selection of large unlabeled datasets of mass spectra and molecules allowing for the combination of supervised and unsupervised methods . Importantly, we develop a new splitting procedure based on the edit distance of molecular structures and divide our dataset into non-leaking train-validation-test folds. The MassSpecGym benchmark defines three MS/MS annotation challenges: _de novo_ molecular structure generation, molecule retrieval, and spectrum simulation. We make each of the challenges easily accessible to the broad machine learning community by providing MassSpecGym through a user-friendly interface leveraging PyTorch Lightning and Hugging Face platforms1. Users can build new models on top of the prepared components and submit their results to the _Papers With Code_ leaderboard. We anticipate that our unified benchmark will have a significant impact on the community by enabling reproducible research and accelerating the development of new MS/MS spectrum annotation methods.

## 2 Related work

Labeled MS/MS data.The creation of spectral libraries is driven by the desire to facilitate the annotation of a measured query spectrum . A spectral library catalogues a molecule and one or more of its spectra that are measured under different mass spectrometry instrument conditions. There are in-house private spectral libraries, commercial libraries, and openly accessible crowd-sourced libraries. MassBank , MassBank of North America (MoNA)  and GNPS  are the three largest crowdsourced libraries comprising tens of thousands of molecules in total. The National Institute of Standards and Technology (NIST) provides a variety of for-perwhase spectral libraries comprising up to 52 thousand compounds. However, NIST libraries are not available for machine learning due to licensing restrictions. A similar situation exists with mzCloud , which provides MS/MS spectra for 32 thousand compounds but cannot be downloaded and used outside its native web interface.

The availability of spectral libraries has provided labeled datasets for supervised machine learning, but there are many challenges. These libraries are relatively small, covering only thousands to tens of thousands of molecules. Consequently, many annotation tools combine data from various libraries, including proprietary sources, limiting reproducibility and introducing biases. Public crowdsourced datasets often contain low-quality, noisy mass spectra or invalid metadata, necessitating custom pre-processing and filtering techniques. While these techniques aim to improve dataset quality, they often limit the applicability and reproducibility of the corresponding machine learning methods. Additionally, the heterogeneity and non-standardization of mass spectrometry instruments and parameters challenge effective learning from spectral libraries. Our MassSpecGym dataset offers the first carefully curated and standardized collection of MS/MS spectra, maintaining high quality and surpassing existing datasets in size (Table 1).

   Dataset & Spectra & High-quality spectra & Molecules & Split \\  GNPS  & **322K** & 104K & 16K & ✗ \\ MoNA  & 98K & 62K & 10K & ✗ \\ MassBank  & 62K & 58K & 4K & ✗ \\ MIST CANOPUS  & 11K & \(\) 11K & \(\) 9K & ✓ \\ MassSpecGym (ours) & 231K & **231K** & **29K** & ✓ \\   

Table 1: **MassSpecGym is the largest publicly available dataset of high-quality labeled MS/MS spectra.** Our quality assessment workflow eliminates noisy or corrupted spectra and ensures reliable molecular labels and metadata (Section 3.3). The “Split” column highlights that, unlike other large-scale datasets, MassSpecGym provides a pre-defined data split.

Train-validation-test splitting of MS/MS data.Most of the previous studies split labeled MS/MS data such that molecules with identical planar structures do not appear in different training, validation, and test sets [17; 35; 24; 19; 21]. This is achieved by using distinct 2D InChiKey hash descriptions of molecules for each data fold. However, this method can be compromised by minor structural modifications often found in spectral libraries as a result of, for example, click chemistry . Our MassSpecGym benchmark has undergone extensive wetting in terms of data splitting. In this work, to prevent data leakage and to accurately assess model generalization to novel molecules, we develop a data splitting strategy that guarantees that there are no leaks with the chemical bond edit distance (i.e., MCES distance ) less than 10 (Figure 2).

Benchmarking MS/MS annotation.Currently, there are no comprehensive and standardized datasets available for the development and evaluation of models predicting spectra or molecular structures. One recently utilized dataset for benchmarking is MIST CANOPUS [19; 35], which was curated to ensure an even distribution of chemical classes . However, this dataset is relatively small, comprising only 9 thousand molecules and 11 thousand spectra, and employs a data split based on 2D InChiKey, a method resulting in data leakage (Figure 2).

The Critical Assessment of Small Molecule Identification (CASMI) series  is another example of a recent benchmarking initiative. However, the CASMI challenge is held only once every two years at best, limiting opportunities for continuous evaluation and benchmarking. Additionally, the CASMI datasets are relatively small, comprising several hundred spectra representing challenging test cases. Participation in the challenge also demands significant mass spectrometry domain expertise for preprocessing the data into the format suitable for machine learning. In contrast, our proposed MassSpecGym is based on the new largest publicly available dataset (Table 1) and is designed to be machine learning-ready, thereby addressing the limitations inherent in the MIST CANOPUS and CASMI benchmarks.

## 3 MassSpecGym benchmark

This section describes the construction of the MassSpecGym benchmark. First, we define three challenges of mass spectrum annotation along with the corresponding evaluation metrics (Section 3.2). Then, we describe the collection and processing of the underlying dataset of mass spectra and analyze its composition (Section 3.3). Finally, we outline our procedure for splitting the dataset into train-validation-test folds and demonstrate its generalization-demanding nature (Section 3.4). Please see the details on the construction of MassSpecGym in Supplementary Information.

### Motivation for the challenges

De novo molecule generation.The first challenge is the _de novo_ prediction of a molecular graph from an MS/MS mass spectrum. This challenge can be compared to the goal of AlphaFold  but instead of predicting protein structures from their sequences, the task here is to predict small molecule structures from their MS/MS spectra. As such, this task represents a grand challenge in computational mass spectrometry, given its potential to drive the discovery of novel natural products, drug metabolites, environmental transformation products, and other crucial molecules . A model

Figure 2: **Our MCES-based data split resolves the data-leakage issue abundant in prior work**. The standard approach separates molecules with identical planar structures (2D InChiKeys) into different folds, disregarding minor molecular modifications. This leads to near-duplicate test molecules (with Tanimoto similarity > 0.85) being leaked from the training data (red), as shown in the example below. In contrast, our approach maximizes molecular edit distance (MCES) between training and test sets, ensuring distinct data folds (green).

that can accurately predict molecular structures from MS/MS spectra could significantly advance our understanding of biology by enabling the annotation of metabolomics of uncharacterized organisms .

Molecule retrieval.The second challenge focuses on retrieving a molecular graph from a molecular database given a mass spectrum, rather than generating a completely new molecule. This scenario is common in practice when determining if a sample contains specific compounds, such as pesticides, environmental pollutants, or other known substances . This approach is also relevant in drug design, particularly in affinity selection-mass spectrometry, where protein binders are identified from combinatorial libraries of ligands .

Spectrum simulation.The third challenge, called spectrum simulation, is the inverse problem of predicting a mass spectrum from a molecular graph. This task has two main motivations. First, it enhances the understanding of MS/MS fragmentation mechanisms in organic chemistry, leading to more precise predictions of how molecules will behave under various conditions. This insight can aid in the design of novel compounds and the optimization of synthetic pathways . Second, it allows for pseudolabeling, expanding training datasets for machine learning models by generating synthetic spectra, which can improve model performance when experimental data is limited .

### Definition of the challenges

_De novo_ molecule generation.The task of _de novo_ molecular generation is to generate a molecular structure from a mass spectrum. Formally, the input is a mass spectrum \(X_{+}(0,1]\), consisting of a set of two-dimensional points (referred to as signals or peaks) representing m/z (mass-to-charge) values and their corresponding intensities, which are normalized by dividing each by the maximum intensity. Intuitively, these points describe the abundance of molecular fragments with different masses. The goal is to generate a molecular graph \(=(V,E)\), where vertices \(V^{N}\), \(||=118\) is a set of \(N\) atoms from the vocabulary of 118 chemical elements (or, for example, 10 most common ones ) characterized by the periodic table, and \(E^{M}\), \(||=4\) is a set of \(M\) edges from the vocabulary of 4 chemical bonds between atoms: single, double, triple, and aromatic . Note that we do not model the 3D coordinates of chemical graphs, as the information in MS/MS spectra is typically insufficient for predicting exact molecular conformations .

Given the complexity of _de novo_ generation, we propose an additional, simpler, challenge where chemical formulae are provided as input, meaning the set of vertices \(V\) is known. In practice, chemical formulae can be derived with high accuracy by utilizing MS\({}^{1}\) mass spectra, an orthogonal data source to MS/MS [50; 51]. Since working with MS\({}^{1}\) data is typically based on combinatorial optimization rather than machine learning , our benchmark directly provides chemical formulae instead of MS\({}^{1}\) spectra, imitating the output of the MS\({}^{1}\) spectra processing pipelines. However, we present this scenario as a bonus challenge because chemical formula prediction remains a partially unsolved problem. For example, elements such as fluorine, which have only one stable isotope, cannot be derived from MS\({}^{1}\) data alone and still pose challenges with MS/MS data .

While each mass spectrum is a measurement on a specific compound, the spectrum may not contain all the necessary information to fully reconstruct the molecular structure as the spectrum is a partial view of the measured compound. Therefore, our approach acknowledges this complexity and permits multiple plausible molecular structures corresponding to a given spectrum. To this end, we formulate the problem as predicting a set of \(k\) graphs \(}_{k}=\{_{1},,_{k}\}\) rather than a single solution \(\). These graphs can be sampled randomly from a model or selected as the top-\(k\) predictions from a larger set, if a scoring function is available. This approach reflects the inherent uncertainty and challenges of accurately predicting the correct molecular graph from spectral data.

We evaluate the correspondence between the generated molecular graphs \(}_{k}\) and the ground-truth graph \(G\) using three metrics. Ideally, the set of predictions includes the ground-truth graph, which we assess by measuring

\[k\{G}_{k}\},\] (1)

averaged across all test examples. In the equation, \(\) is the indicator function returning 1 if the condition is true and 0 otherwise. The top-\(k\) accuracy varies between 0 and 1, where 0 corresponds to none of the test samples having the ground truth graph among the top-\(k\) prediction and 1 correspondsto all test samples having the ground truth graph among the top-\(k\) predictions. Given the difficulty of predicting the exact graph, we also assess the similarity between predicted molecules and the true molecule using two molecular similarity measures. First, we use the maximum common edge subgraph (MCES) metric , which is an edit distance on molecular graphs. Specifically, we evaluate how close the most similar prediction is to the true molecule in terms of the MCES distance across top-\(k\) predictions (we evaluate \(k\{1,10\}\)):

\[k_{_{k}}MCES(,G),\] (2)

averaged across test examples. The MCES distance is \(0\) when two graphs are identical, and increasing values correspond to decreasing similarity. We also use the Tanimoto similarity (or Jaccard coefficient) on the Morgan fingerprints of molecules , which measures how well a generative model recognizes true molecular fragments:

\[k_{_{k}}Tanimoto(,G).\] (3)

The Tanimoto similarity between two molecules ranges from 0 to 1, where a value of 1 indicates identical molecules.

Molecule retrieval.In practice, _de novo_ molecule generation is often infeasible due to the combinatorial complexity of the solution space. An alternative and practically relevant problem is molecule retrieval, which is to rank candidate molecular graphs (from a chemical database) for a given input spectrum. Formally, given a mass spectrum \(X_{+}(0,1]\), the task is to order a set of candidate graphs \(=\{G_{1},,G_{n}\}\) such that the correct molecular graph \(G\) has the lowest index.

Chemical databases may contain millions of molecules, e.g., the PubChem database has over 118 million molecules , making it impractical to sort the entire set. However, since the mass of the true molecule can be derived from an MS/MS spectrum, the candidate set \(\) can be constructed to include only molecules with same masses as the true one (within an acceptable experimental error range). To standardize the task across examples, we limit \(|C| 256\) candidates per spectrum, sampled randomly if more molecules with the same mass are available. Additionally, similar to the _de novo_ generation task, we define a bonus challenge where the set \(V\) is known via the molecular formula, allowing further pruning of \(\) to include only graphs with the given nodes \(V\).

We evaluate molecule retrieval using standard information retrieval metrics, as well as the molecular similarity of the top hit with the true molecule. Specifically, we measure:

\[k\{G_{k}\},\] (4)

averaged across all test examples, where \(_{k}\) is the set of top-\(k\) hits sorted by the model and \(\) is the indicator function. The hit rate @ \(k\) ranges from 0 to 1, with 1 indicating perfect performance, meaning all true molecules were correctly retrieved among the top \(k\) candidates. Additionally, we evaluate the average similarity of the top-1 hit \(G_{1}\) with the ground truth molecule \(G\) by measuring the maximum common edge subgraph (MCES) distance :

\[1MCES(G_{1},G).\] (5)

The MCES @ 1 value is 0 if the top-1 retrieved candidate is exactly the true molecule, with higher positive values indicating lower similarity between the molecules.

Spectrum simulation.In contrast to the above spectrum-to-molecule tasks, spectrum simulation is the inverse problem of predicting an MS/MS spectrum. The input is a molecular graph \(G=(V,E)\) and the measurement parameters \(I\{I_{1},I_{2},...,I_{n}\},A\{A_{1},A_{2},...,A_{m}\},\) and \(C_{+}\), where \(I\) represents the type of instrument used, \(A\) represents the adduct associated with the precursor ion, and \(C\) is the amount of energy used during fragmentation (the collision energy, measured in electronvolts or eV). The output is a predicted mass spectrum \(_{+}(0,1]\). To limit complexity from extra parameters tangential to the issue, we restrict the task to spectra with the most abundant adduct (\(A=\) [M+H]\({}^{+}\)) and simplify the instrument types to the two principal technologies (\(I\) {QTOF, Orbitrap)}.

Typically, \(\) and the true spectrum \(X\) have binned representations \(,}^{d}\), where \(d\) is the number of bins. Instead of listing exact locations of m/z peaks and their intensities, they discretize the space into a series of m/z bins to store peaks in their approximate positions [55; 56; 57]. The selection of bin size, and by extension \(d\), requires consideration: in this benchmark, we choose a bin size of 0.01 Da and a maximum m/z of 1005 Da, resulting in \(d=100500\). These values are precise enough to retain important information about peak accuracy without becoming overly sensitive to measurement error. Additionally, we exclude potential precursor signals from both ground truths and predictions in the benchmark since there is a tendency for strong precursor signals to inflate model performance.

An evaluation metric for the quality of the prediction is the cosine similarity between the predicted binned spectrum \(}\) and the ground truth \(\) (Equation 6), averaged across all graph-spectra pairs:

\[}^{T}}{\|}\|\|\|}.\] (6)

Cosine similarity between two spectra ranges from 0 to 1, where 1 corresponds to a perfect prediction. Jensen-Shannon similarity is reported as an additional metric (see Supplementary Information).

A key application of accurately predicting spectra from molecules is in molecular retrieval [55; 21; 23]. Accurate and scalable models enable the automatic annotation of molecular databases, bolstering the coverage of existing spectral libraries. Therefore, we can additionally use an analagous setup as a downstream task to evaluate spectrum predictions. Similarly to the molecule retrieval task defined previously, for a molecule-spectrum pair \((G,X)\), the set of candidates \(\) comprises of \(G\) and the set of molecules from a chemical database most similar to \(G\). For each molecule \(G_{i}\), we predict a spectrum \(}_{i}\) and rank all candidates by decreasing cosine similarity between \(}_{i}\) and \(\). We evaluate the model by the rate at which \(G\) is ranked in the top-\(k\) hits in the sorted \(\), using the same hit rate @\(k\) metrics as defined in the previous section.

### Dataset collection

To construct the MassSpecGym dataset, we first exhaustively collected MS/MS spectra from the largest publicly available spectral libraries: MoNA , MassBank , and GNPS  (downloaded from the official websites on May 27, 2024), as well as from our in-house data . We then deduplicated and cleaned the spectra by applying a series of matchs filtering criteria . These criteria are mainly based on the protocol described in  and involve additional filters to better standardize the dataset, such as keeping only spectra of molecules with m/z < 1000 or spectra with fewer than 1000 signals. To ensure the high quality of the dataset, we applied additional criteria, such as removing all spectra where more than 50% of the total intensity cannot be explained by combinatorially decomposing molecular mass into plausible chemical subformulae . We preprocessed the mass spectra by removing signals estimated to be instrument noise. Finally, we standardized both molecular structures and mass spectra, and harmonized metadata entries, inferring

Figure 3: **MassSpecGym provides a diverse and highly-standardized dataset of MS/MS spectra.** The histogram of precursor m/z values (**a**) and a TMAP  projection of precursor molecules (**e**) demonstrate a rich coverage of molecular masses and chemical classes  in MassSpecGym. Unlike other spectral libraries, our dataset is highly standardized in terms of mass spectrometry metadata. Each spectrum has an associated ionization adduct, either [M+H]+ or [M+Na]+, and nearly all spectra (98%) are linked to MS instruments, either Orbitrap or QTOF (**b**, **c**). Approximately half of the dataset entries (53%) contain normalized collision energies (**b**, **d**).

missing or incorrect values where possible [62; 60]. Figure 3 shows that our resultant dataset is rich in terms of molecular structures and highly standardized in terms of mass spectrometry metadata.

Additionally, we provide curated unlabeled datasets of mass spectra and molecules. For the mass spectra, we provide the GeMS-A10 dataset, a deduplicated collection of 24 million high-quality mass spectra mined from the MassIVE repository . For the molecules, we provide (i) 1 million molecules of biological and environmental origin, including collections of natural products, pesticides, industrial chemicals, food additives, and other compounds , (ii) 4 million molecules spanning a diverse range of chemical classes , and (iii) all 118 million molecules from PubChem  (downloaded from the official website on May 31, 2024).

First, we utilize these three molecular datasets to construct retrieval candidates \(\) for the molecule retrieval and spectrum simulation tasks (Section 3.2). For each spectrum-molecule pair, we iteratively sample molecules with the same mass as the query molecule from (i), followed by (ii) and (iii) until the maximum number of candidates \(||=256\) is reached. The sequence of the datasets used for sampling reflects the relevance of their composition for mass spectrometry applications. A similar procedure is applied for the bonus challenge, where candidates are selected based on identical molecular formulae.

Second, when developing new methods that leverage unlabeled data, we anticipate that users will rely solely on the following two datasets: the GeMS-A10 dataset of unlabeled MS/MS spectra and a refined subset of the unlabeled 4 million-molecule dataset. The molecular dataset has been refined by excluding any molecules with an MCES distance of less than two from any molecule in the test fold of MassSpecGym. This refinement is intended to reduce the potential for data leakage, particularly when used in the context of the _de novo_ generation challenge.

### Dataset splitting

We split our dataset using MCES distances between molecular graphs corresponding to mass spectra. Specifically, we group all 29 thousand unique molecules into training, validation, and test folds using agglomerative clustering with MCES as the metric and the minimum distance as the linkage criterion. By setting the linkage distance threshold to 10, our approach ensures that no molecules have an edge edit distance of less than 10 between different data folds. Figure 2 shows that our method significantly surpasses the commonly applied 2D InChIKey disjoint approach, used in nearly all related works, in terms of preventing data leakage. Additionally, we stratify the spectra by instrument types, collision energies, ionization adducts, and the frequency of the molecules in the entire dataset, resulting in balanced folds with respect to metadata. A more detailed description of the splitting and additional analysis is available in the Supplementary Information.

## 4 Experiments

### Baseline models

To establish reference performance across the tasks, we evaluate an initial set of representative baseline methods summarized in this section. Please see Supplementary Information for details.

De novo molecule generation.For the _de novo_ molecule generation challenge, we begin by implementing a baseline model based on prior chemical knowledge, referred to as **Random chemical generation**, which produces random chemically valid molecules given specific molecular masses or formulae. This baseline uses combinatorial and graph theory algorithms, drawing from statistics derived from the training data. To complement this domain-knowledge baseline, we also implement two Transformer models . These models encode two-dimensional continuous tokens, representing m/z-intensity value pairs of MS/MS spectra, and decode string representations of molecular graphs. The first model, **SMILES Transformer**, decodes molecules as byte-pair-encoded  SMILES strings . The second model, **SELFIES Transformer**, decodes molecules as SELFIES strings , offering the advantage of always producing valid chemical structures. We do not include any published state-of-the-art baselines because, to the best of our knowledge, all are either not publicly available or leverage proprietary data for training [24; 68; 69; 70].

Molecule retrieval.The simplest baseline method for molecule retrieval, **Random**, sorts the candidate molecules \(\) randomly. The second method, **Fingerprint FFN**, employs a feedforward neural network to predict the Morgan fingerprint of the target molecule. The candidates are then sorted based on their cosine similarity to the predicted fingerprint. Next, we evaluate **MIST**, a state-of-the-art deep learning approach, also based on fingerprint prediction. MIST assigns chemical subformulae to spectral peaks via energy-based modeling , then predicts a molecular fingerprint via a chemical formula-based transformer, and finally ranks the candidates by cosine similarity between the fingerprints . Finally, we evaluate **DeepSets**. The model processes spectra as sets of raw 2D peak representations, providing a complementary approach to FingerprintFFN and the state-of-the-art MIST which are based on alternative representations of spectra. **DeepSets + Fourier features** enhances DeepSets by using Fourier features enabling more accurate modeling of m/z values .

Spectrum simulation.We include three deep learning baseline models for the spectrum simulation task. The **molecular fingerprint (FFN Fingerprint)** model consists of a simple feedforward network on top of a fingerprint representation of the input molecule, inspired by . The **graph neural network (GNN)** model, inspired by , uses a variant of Graph Isomorphism Network augmented with edge features  to process a 2D graph representation of the input molecule. Finally, state-of-the-art **FraGNNet** uses combinatorial fragmentation and GNNs to parametrize

    & Cosine Similarity \(\) & Jensen-Shannon Similarity \(\) & Hit Rate \(\) 1 \(\) & Hit Rate \(\) 5 \(\) & Hit Rate \(\) 20 \(\) \\  Precursor mz & 0.15 (0.14-0.17) & 0.59 (0.58-0.60) & 0.38 (0.21-0.62) & 1.72 (1.32-1.28) & 7.17 (6.32-8.04) \\ FFN Fingerprint & 0.25 (0.24-0.26) & 0.69 (0.63-0.65) & 8.44 (5.9-3.49) & 21.43 (0.10-22.29) & 3.75 (36.9-40.23) \\ GNN & 0.19 (0.18-0.20) & 0.64 (0.63-0.65) & 3.95 (3.37-4.62) & 1.19 (0.18-10.30) & 26.27 (42.33-27.28) \\ FraGNNet & **0.52 (0.51-0.53)** & **0.91 (0.91-0.42)** & **46.64 (44.95-48.26)** & **72.56 (71.18-74.00)** & **83.58 (0.23-34.87.75)** \\  _Boston channel formulae challenge_ & & & & & \\  Precursor mz & - & - & 2.99 (1.66-2.59) & 8.52 (7.65-9.53) & 22.65 (21.26-24.01) \\ FFN Fingerprint & - & - & 7.62 (6.77-8.54) & 22.70 (21.32-24.12) & 44.12 (42.51-45.75) \\ GNN & - & - & 3.63 (0.54-2.29) & 13.55 (12.46-14.68) & 33.77 (32.26-35.37) \\ FraGNNet & - & - & **31.93 (0.40-33.50)** & **63.20 (61.64-64.76)** & **82.70 (81.45-83.93)** \\   

Table 4: **Baseline results for the spectrum simulation challenge. The values in brackets indicate 99.9% confidence intervals upon bootstrapping (20,000 resamples).**

    &  &  \\   & Accuracy \(\) & MCES \(\) & Tanimoto \(\) & Accuracy \(\) & MCES \(\) & Tanimoto \(\) \\  Random chemical generation & 0.00 & **28.59 (28.33-28.84)** & 0.07 (0.07 - 0.07) & 0.00 & 25.72 (25.49-25.95) & 0.10 (0.10 - 0.10) \\ SMILES Transformer & 0.00 & 53.80 (52.95-54.61) & 0.07 (0.07 - 0.08) & 0.00 & 21.97 (21.79-22.16) & **0.17 (0.17 - 0.17)** \\ SELFIES Transformer & 0.00 & 33.28 (33.00-33.57) & **0.10 (0.10 - 0.10)** & 0.00 & **21.84 (21.67-22.00)** & 0.15 (0.15 - 0.15) \\  _Boston constant formulae challenge_ & & & & & \\  SMILES Transformer & 0.00 & 79.39 (78.64-80.08) & 0.03 (0.03 - 0.04) & 0.00 & 52.13 (51.45-52.81) & 0.10 (0.09 - 0.10) \\ SELFIES Transformer & 0.00 & 38.88 (38.57-39.20) & **0.08 (0.08 - 0.08)** & 0.00 & 26.87 (26.66-27.11) & **0.13 (0.13 - 0.13)** \\ Random chemical generation & 0.00 & **21.11 (20.97-21.26)** & **0.08 (0.08 - 0.08)** & 0.00 & **18.25 (18.14-18.35)** & 0.11 (0.11 - 0.11) \\   

Table 2: **Baseline results for the _de novo_ molecule generation challenge. The values in brackets indicate 99.9% confidence intervals upon bootstrapping (20,000 resamples).**

    & Hit rate @ 1 \(\) & Hit rate @ 5 \(\) & Hit rate @ 20 \(\) & MCES @ 1 \(\) \\  Random & 0.37 (0.24-0.54) & 2.01 (1.68-2.39) & 8.22 (7.53-8.89) & 30.81 (30.40-31.21) \\ DeepSets & 1.47 (1.18-1.77) & 6.21 (5.64-6.82) & 19.23 (18.24-20.26) & 25.11 (24.84-25.39) \\ Fingerprint FFN & 2.54 (2.17-2.99) & 7.59 (6.96-8.28) & 20.00 (19.01-20.98) & 24.66 (24.38-24.94) \\ DeepSets + Fourier features & 5.24 (4.71-5.83) & 12.58 (11.80-13.42) & 28.21 (27.10-29.36) & 22.13 (21.85-22.43) \\ MIST & **14.64 (13.82-15.54)** & **34.87 (33.69-36.10)** & **59.15 (57.89-60.39)** & **15.37 (15.12-15.62)** \\   _Bons chemical formulae challenge_ & & & & \\  Random & 3.06 (2.64-3.52) & 11.35 (10.60-12.12) & 27.74 (26.52-28.84) & 13.87 (13.70-14.03) \\ DeepSets & 4.42 (3.92-4.97) & 14.46 (13.58-15.36) & 30.76 (29.67-31.93) & 15.04 (14.89-15.19) \\ Fingerprint FFN & 5.09 (4.57-5.66) & 14.69 (13.83-15.56) & 31.97 (30.86-33.10) & 14.94 (14.79-15.09) \\ DeepSets + Fourier features & 6.56 (5.95-7.16) & 16.46 (15.58-17.35) & 33.46 (32.39-34.59) & 14.14 (13.98-14.31) \\ MIST & **9.57 (8.88-10.30)** & **22.11 (21.10-23.13)** & **41.12 (39.98-42.34)** & **12.75 (12.59-12.91)** \\   

Table 3: **Baseline results for the molecule retrieval challenge. The values in brackets indicate 99.9% confidence intervals upon bootstrapping (20,000 resamples).**a probability distribution over fragments of the input molecule and their associated chemical formulae. The precise formula masses are used to map the distribution over formulae to a high resolution mass spectrum, without requiring binning. In addition, we include a trivial baseline **Precursor m/z** that simply predicts a single-peak spectrum by calculating the precursor m/z from the masses of the input molecule and the ionization adduct.

### Baseline performance

We train and validate the performance of baseline methods on MassSpecGym. For the challenge of _de novo_ generation (Table 2), we find that none of the baselines achieve an accuracy above zero, emphasizing the need for new method development. Additionally, our SMILES Transformer baseline does not outperform random generation of chemically valid graphs, highlighting the insufficiency of simplistic learning approaches in our generalization-demanding setup. For molecule retrieval (Table 3), the advanced MIST model significantly outperforms the simpler Fingerprint FFN and DeepSets baselines, suggesting strong gains from algorithmic development, which we posit as a driving force for MS/MS annotation with our benchmark. The same holds true for the spectrum simulation challenge (Table 4), where the advanced FraGNNet model demonstrates superior performance over simpler baselines. Nevertheless, the absolute metric scores still leave a substantial gap for future improvements.

## 5 Conclusions

In this work, we developed MassSpecGym, the first comprehensive and standardized benchmark for the discovery and identification of molecules from MS/MS spectra. MassSpecGym is based on our newly created largest open-source dataset of labeled tandem mass spectra and a standardization pipeline ensuring high data quality. We split the dataset using our novel generalization-demanding splitting technique, enabling robust evaluation of molecular identification and discovery. We evaluated a series of baseline methods and demonstrated that the annotation of MS/MS spectra remains a highly unsolved problem. To address this, we provide MassSpecGym as a public resource with a user-friendly interface requiring minimal domain expertise for the submission and evaluation of new machine learning models.

Our future work has two main directions. First, we plan to continuously update MassSpecGym with new public and in-house MS/MS data, potentially incorporating simulated spectra or additional data modalities, such as EI spectra. We also aim to expand the scope of challenges to include tasks such as molecular networking, a prominent technique in the field that focuses on clustering spectra of structurally related molecules rather than predicting individual molecules. Second, by progressively enhancing the MassSpecGym ecosystem with more advanced methods, we intend to transform it into a hub for state-of-the-art models in MS/MS spectra annotation. This will empower machine learning researchers to make rapid progress in developing innovative models, a particularly crucial focus given the historically limited collaboration between mass spectrometry experts and AI specialists. As a consequence, many well-established machine learning paradigms, such as generating molecular graphs via diffusion models or applying domain adaptation techniques across different mass spectrometry systems, remain largely unexplored. Furthermore, by providing a user-friendly interface to run these models, we aim to make cutting-edge algorithms readily accessible to life scientists interested in annotating their mass spectra. We believe that MassSpecGym will play a pivotal role in fostering the development of next-generation machine learning methods, ultimately driving significant progress across the biomedical and chemical sciences.

## Competing interests

RS and TP are co-founders of the company mzio GmbH, which develops technologies related to mass spectrometry data processing. SB, KD and ML are co-founders of Bright Giant GmbH. JJJvdH is member of the Scientific Advisory Board of NAICONS Srl., Milano, Italy and consults for Cortex Agriscience, Indianapolis, IN, USA.