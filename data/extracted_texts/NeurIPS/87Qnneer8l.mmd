# Out-of-distribution Detection Learning with Unreliable Out-of-distribution Sources

Haotian Zheng\({}^{1,2}\)   Qizhou Wang\({}^{1}\)   Zhen Fang\({}^{3}\)   Xiaobo Xia\({}^{4}\)

**Feng Liu\({}^{5}\)   Tongliang Liu\({}^{4}\)   Bo Han\({}^{1}\)**

\({}^{1}\)Department of Computer Science, Hong Kong Baptist University

\({}^{2}\)School of Electronic Engineering, Xidian University

\({}^{3}\)Australian Artificial Intelligence Institute, University of Technology Sydney

\({}^{4}\)Sydney AI Centre, The University of Sydney

\({}^{5}\)School of Computing and Information Systems, The University of Melbourne

htzheng.xdu@gmail.com  {csqzwang, bhanml}@comp.hkbu.edu.hk

zhen.fang@uts.edu.au   xiaoboxia.uni@gmail.com

fengliu.ml@gmail.com   tongliang.liu@sydney.edu.au

Equal contributions.Correspondence to Bo Han (bhanml@comp.hkbu.edu.hk).

###### Abstract

Out-of-distribution (OOD) detection discerns OOD data where the predictor cannot make valid predictions as in-distribution (ID) data, thereby increasing the reliability of open-world classification. However, it is typically hard to collect real out-of-distribution (OOD) data for training a predictor capable of discerning ID and OOD patterns. This obstacle gives rise to _data generation-based learning methods_, synthesizing OOD data via data generators for predictor training without requiring any real OOD data. Related methods typically pre-train a generator on ID data and adopt various selection procedures to find those data likely to be the OOD cases. However, generated data may still coincide with ID semantics, i.e., mistaken OOD generation remains, confusing the predictor between ID and OOD data. To this end, we suggest that generated data (with mistaken OOD generation) can be used to devise an _auxiliary OOD detection task_ to facilitate real OOD detection. Specifically, we can ensure that learning from such an auxiliary task is beneficial if the ID and the OOD parts have disjoint supports, with the help of a well-designed training procedure for the predictor. Accordingly, we propose a powerful data generation-based learning method named _Auxiliary Task-based OOD Learning_ (ATOL) that can relieve the mistaken OOD generation. We conduct extensive experiments under various OOD detection setups, demonstrating the effectiveness of our method against its advanced counterparts. The code is publicly available at: https://github.com/tmlr-group/ATOL.

## 1 Introduction

Deep learning in the open world should not only make accurate predictions for in-distribution (ID) data meanwhile should detect out-of-distribution (OOD) data whose semantics are different from ID cases . It drives recent studies in OOD detection , which is important for many safety-critical applications such as autonomous driving and medical analysis. Previous works have demonstrated that well-trained predictors can wrongly take many OOD data as ID cases , motivating recent studies towards effective OOD detection.

In the literature, an effective learning scheme is to conduct model regularization with OOD data, making predictors achieve low-confidence predictions on such data . Overall, they directly let the predictor learn to discern ID and OOD patterns, thus leading to improved performance in OOD detection. However, it is generally hard to access real OOD data , hindering the practical usage scenarios for such a promising learning scheme.

Instead of collecting real OOD data, we can generate OOD data via data generators to benefit the predictor learning, motivating the _data generation-based methods_. Generally speaking, existing works typically fit a data generator  on ID data (since real OOD data are inaccessible). Then, these strategies target on finding the OOD-like cases from generated data by adopting various selection procedures. For instance, Lee et al.  and Vernekar et al.  take boundary data that lie far from ID boundaries as OOD-like data; PourReza et al.  select those data generated in the early stage of generator training. However, since the generators are trained on ID data and these selection procedures can make mistakes, one may wrongly select data with ID semantics as OOD cases (cf., Figure 1(a)), i.e., _mistaken OOD generation_ remains. It will misguide the predictors to confuse between ID and OOD data, making the detection results unreliable, as in Figure 1(b). Overall, it is hard to devise generator training procedures or data selection strategies to overcome mistaken OOD generation, thus hindering practical usages of previous data generation-based methods.

To this end, we suggest that generated data can be used to devise an _auxiliary task_, which can benefit real OOD detection even with data suffered from mistaken OOD generation. Specifically, such an auxiliary task is a crafted OOD detection task, thus containing ID and OOD parts of data (termed _auxiliary ID_ and _auxiliary OOD data_, respectively). Then, two critical problems arise --_how to make such an auxiliary OOD detection task learnable w.r.t. the predictor_ and _how to ensure that the auxiliary OOD detection task is beneficial w.r.t. the real OOD detection_. For the first question, we refer to the advanced OOD detection theories , suggesting that the auxiliary ID and the auxiliary OOD data should have the disjoint supports in the input space (i.e., without overlap w.r.t. ID and OOD distributions), cf., **C**1 (Condition 1 for short). For the second question, we justify that, for our predictor, if real and auxiliary ID data follow similar distributions, cf., **C**2, the auxiliary OOD data are reliable OOD data w.r.t. the real ID data. In summary, if **C**1 and **C**2 hold, we can ensure that learning from the auxiliary OOD detection task can benefit the real OOD detection, cf., Proposition 1.

Based on the auxiliary task, we propose _auxiliary Task-based OOD Learning_ (ATOL), an effective data generation-based OOD learning method. For **C**1, it is generally hard to directly ensure the disjoint supports between the auxiliary ID and auxiliary OOD data due to the high-dimensional input space. Instead, we manually craft two disjoint regions in the low-dimensional latent space (i.e., the input space of the generator). Then, with the generator having _distance correlation_ between input space and latent space , we can make the generated data that belong to two different regions in the latent space have the disjoint supports in the input space, assigning to the auxiliary ID and the auxiliary OOD parts, respectively. Furthermore, to fulfill C2, we propose a distribution alignment risk for the auxiliary and the real ID data, alongside the OOD detection risk to make the predictor benefit from the auxiliary OOD detection task. Following the above learning procedure, we can relieve the mistaken OOD generation issue and achieve improved performance over previous works in data generation-based OOD detection, cf., Figure 2 for a heuristic illustration.

To verify the effectiveness of ATOL, we conduct extensive experiments across representative OOD detection setups, demonstrating the superiority of our method over previous data generation-based methods, such as Vernekar et al. , with \(12.02\%\), \(18.32\%\), and \(20.70\%\) improvements measured by average FPR\(95\) on CIFAR-\(10\), CIFAR-\(100\), and ImageNet datasets. Moreover, compared with more advanced OOD detection methods (cf., Appendix F), such as Sun et al. , our ATOL can also have promising improvements, which reduce the average FPR\(95\) by \(4.36\%\), \(15.03\%\), and \(12.02\%\) on CIFAR-\(10\), CIFAR-\(100\), and ImageNet datasets.

**Contributions.** We summarize our main contributions into three folds:

* We focus on the mistaken OOD generation in data generation-based detection methods, which are largely overlooked in previous works. To this end, we introduce an auxiliary OOD detection task to combat the mistaken OOD generation and suggest a set of conditions in Section 3 to make such an auxiliary task useful.
* Our discussion about the auxiliary task leads to a practical learning method named ATOL. Over existing works in data generation-based methods, our ATOL introduces small costs of extra computations but is less susceptible to mistaken OOD generation.
* We conduct extensive experiments across representative OOD detection setups, demonstrating the superiority of our method over previous data generation-based methods. Our ATOL is also competitive over advanced works that use real OOD data for training, such as outlier exposure , verifying that the data generation-based methods are still worth studying.

## 2 Preliminary

Let \(^{n}\) the input space, \(=\{1,,c\}\) the label space, and \(=:^{n} ^{c}\) the predictor, where \(:^{n}^{d}\) is the feature extractor and \(:^{d}^{c}\) is the classifier. We consider \(^{}_{X,Y}\) and \(^{}_{X}\) the joint and the marginal ID distribution defined over \(\) and \(\), respectively. We also denote \(^{}_{X}\) the marginal OOD distribution over \(\). Then, the main goal of OOD detection is to find the proper predictor \(()\) and the scoring function \(s(;):^{n}\) such that the OOD detector

\[f_{}()=,&s(; ),\\ ,&s(;)<,\] (1)

can detect OOD data with a high success rate, where \(\) is a given threshold. To get a proper predictor \(()\), outlier exposure  proposes regularizing the predictor to produce low-confidence predictions for OOD data. Assuming the real ID data \(_{}\) and label \(y_{}\) are randomly drawn from \(^{}_{X,Y}\), then the learning objective of outlier exposure can be written as:

\[_{}_{^{}_{X,Y}}[_{}(_{},y_{};)]+_{ ^{}_{X}}[_{}(;) ],\] (2)

where \(\) is the trade-off hyper-parameter, \(_{}()\) is the cross-entropy loss, and \(_{}()\) is the Kullback-Leibler divergence of softmax predictions to the uniform distribution. Although outlier exposure remains one of the most powerful methods in OOD detection, its critical reliance on OOD data hinders its practical applications.

Fortunately, data generation-based OOD detection methods can overcome the reliance on real OOD data, meanwhile making the predictor learn to discern ID and OOD data. Overall, existing works [31; 62; 67] leverage the _generative adversarial network_ (GAN) [12; 51] to generate data, collecting those data that are likely to be the OOD cases for predictor training. As a milestone work, Lee et al.  propose selecting the "boundary" data that lie in the low-density area of \(^{}_{X}\), with the following learning objective for OOD generation:

\[_{G}_{D}_{_{X}}[_{}( ;)]}_{}+_{^{}_{X}}[ D(_{})]+ _{_{X}}[(1-D())]}_{},\] (3)where \(_{X}\) denotes the OOD distribution of the generated data w.r.t. the generator \(G:^{m}^{n}\) (\(m\) is the dimension of the latent space). Note that the term (a) forces the generator \(G()\) to generate low-density data and the term (b) is the standard learning objective for GAN training . Then, with the generator trained for OOD generation, the generated data are used for predictor training, following the outlier exposure objective, given by

\[_{}_{_{X,Y}^{}}[_{}(_{},y_{};)]+_{ _{X}}[_{}(;)].\] (4)

**Drawbacks.** Although a promising line of works, the generated data therein may still contain many ID semantics (cf., Figure 1(a)). It stems from the lack of knowledge about OOD data, where one can only access ID data to guide the training of generators. Such mistaken OOD generation is common in practice, and its negative impacts are inevitable in misleading the predictor (cf., Figure 1(b)). Therefore, how to overcome the mistaken OOD generation is one of the key challenges in data generation-based OOD detection methods.

## 3 Motivation

Note that getting generators to generate reliable OOD data is difficult, since there is no access to real OOD data in advance and the selection procedures can make mistakes. Instead, given that generators suffer from mistaken OOD generation, we aim to make the predictors alleviate the negative impacts raised by those unreliable OOD data.

Our key insight is that these unreliable generated data can be used to devise a reliable _auxiliary task_ which can benefit the predictor in real OOD detection. In general, such an auxiliary task is a crafted OOD detection task, of which the generated data therein are separated into the ID and the OOD parts. Ideally, the predictor can learn from such an auxiliary task and _transfer_ the learned knowledge (from the auxiliary task) to benefit the real OOD detection, thereafter relieving the mistaken OOD generation issue. Therein, two issues require our further study:

* Based on unreliable OOD sources, how to devise a learnable auxiliary OOD detection task?
* Given the well-designed auxiliary task, how to make it benefit the real OOD detection?

For the first question, we refer the advanced work  in OOD detection theories, which provides necessary conditions for which the OOD detection task is learnable. In the context of the auxiliary OOD detection task, we will separate the generated data into the _auxiliary ID_ parts and _auxiliary OOD_ parts, following the distributions defined by \(_{X}^{}\) and \(_{X}^{}\), respectively. Then, we provide the following condition for the _separable property_ of the auxiliary OOD detection task.

**Condition 1** (**Separation for the Auxiliary Task**).: _There is no overlap between the auxiliary ID distribution and the auxiliary OOD distribution, i.e., \(\ _{X}^{}\ _{X}^{}=\), where \(\) denotes the support set of a distribution._

Overall, **C**1 states that the auxiliary ID data distribution \(_{X}^{}\) and the auxiliary OOD data distribution \(_{X}^{}\) should have the disjoint supports. Then, according to Fang et al.  (Theorem 3), such an auxiliary OOD detection might be learnable, in that the predictor can have a high success rate in discerning the auxiliary ID and the auxiliary OOD data. In general, the separation condition is indispensable for us to craft a valid OOD detection task. Also, as in the proof of Proposition 1, the separation condition is also important to benefit the real OOD detection.

For the second question, we need to first formally define if a data point can benefit the real OOD detection. Here, we generalize the separation condition in Fang et al. , leading to the following definition for the _reliability_ of OOD data.

**Definition 1** (**Reliability of OOD Data**).: _An OOD data point \(\) is reliable (w.r.t. real ID data) to a mapping function \(^{}()\), if \(^{}()^{}_{\#}_{X}^ {}\), where \(^{}_{\#}\) is the distribution transformation associated with \(^{}()\)._

With identity mapping function \(^{}()\), the above definition states that \(\) is a reliable OOD data point if it is not in the support set of the real ID distribution w.r.t. the transformed space. Intuitively, if real ID data are representative almost surely , \(^{}()\) far from the ID support also indicates that \(^{}()\) will not possess ID semantics, namely, reliable. Furthermore, \(^{}()\) is not limited to identity mapping,which can be defined by any transformed space. The feasibility of such a generalized definition is supported by many previous works [10; 41] in OOD learning, demonstrating that reliable OOD data defined in the embedding space (or in our context, the transformed distribution) can also benefit the predictor learning in OOD detection.

Based on Definition 1, we want to make auxiliary OOD data reliable w.r.t. real ID data, such that the auxiliary OOD detection task is ensured to be beneficial, which motivates the following condition.

**Condition 2** (**Transferability of the Auxiliary Task**).: _The auxiliary OOD detection task is transferable w.r.t. the real OOD detection task if \(^{}_{\#}^{}_{X}^{}_{ \#}^{}_{X}\)._

Overall, **C**2 states that auxiliary ID data approximately follow the same distribution as that of the real ID data in the transformed space, i.e., \(^{}()\). Note that, Auxiliary ID and OOD data can arbitrarily differ from real ID and OOD data in the data space, i.e., _auxiliary data are unreliable OOD sources_. However, if **C**2 is satisfied, the model "_believes_" the auxiliary ID data and the real ID data are the same. Then, we are ready to present our main proposition, demonstrating why **C**2 can ensure the reliability of auxiliary OOD data.

**Proposition 1**.: _Assume the predictor \(=\) can separate ID and OOD data, namely,_

\[_{^{}_{X,Y}}[_{}(_{ID}, y_{ID};)]+_{^{}_{X}}[_{ }(;)]\] (5)

_approaches 0. Under **C**1 and **C**2, auxiliary OOD data are reliable w.r.t. real ID data given \(^{}=\)._

The proof can be found in Appendix C. In heuristics, Eq. (5) states that the predictor should excel at such an auxiliary OOD detection task, where the model can almost surely discern the auxiliary ID and the auxiliary OOD cases. Then, if we can further align the real and the auxiliary ID distributions (i.e., **C**2), the predictor will make no difference between the real ID data and the auxiliary ID data. Accordingly, since the auxiliary OOD data are reliable OOD cases w.r.t. the auxiliary ID data, the auxiliary OOD data are also reliable w.r.t. the real ID data. Thereafter, one can make the predictor learn to discern the real ID and auxiliary OOD data, where no mistaken OOD generation affects. Figure 2 summarizes our key concepts. As we can see, learning from the auxiliary OOD detection task and further aligning the ID distribution ensure the separation between ID and OOD cases, benefiting the predictor learning from reliable OOD data and improving real OOD detection performance.

**Remark 1**.: _There are two parallel definitions for real OOD data , related to different goals towards effective OOD detection. One definition is that an exact distribution of real OOD data exists, and the goal is to mitigate the distribution discrepancy w.r.t. the real OOD distribution for effective OOD detection. Another definition is that all those data whose true labels are not in the considered label space are real OOD data, and the goal is to make the predictor learn to see as many OOD cases as possible. Due to the lack of real OOD data for supervision, the latter definition is more suitable than the former one in our context, where we can concentrate on mistaken OOD generation._

## 4 Learning Method

Section 3 motivates a new data generation-based method named _Auxiliary Task-based OOD Learning_ (ATOL), overcoming the mistaken OOD generation via the auxiliary OOD detection task. Referring to Theorem 1, the power of the auxiliary task is built upon **C**1 and **C**2. It makes ATOL a two-staged learning scheme, related to auxiliary task crafting (crafting the auxiliary task for **C**1) and predictor training (applying the auxiliary task for **C**2), respectively. Here, we provide the detailed discussion.

### Crafting the Auxiliary Task

We first need to construct the auxiliary OOD detection task, defined by auxiliary ID and auxiliary OOD data generated by the generator \(G()\). In the following, we assume the auxiliary ID data \(}_{}\) drawn from \(^{}_{X}\) and the auxiliary OOD data \(}_{}\) drawn from \(^{}_{X}\). Then, according to **C**1, we need to fulfill the condition that \(^{}_{X}\) and \(^{}_{X}\) should have the disjoint supports.

Although all distribution pairs \((^{}_{X},^{}_{X})\) with disjoint supports can make **C**1 hold, it is hard to realize such a goal due to the complex data space \(^{n}\) of images. Instead, we suggest crafting such a distribution pair in the latent space \(^{m}\) of the generator, of which the dimension \(m\) is much lower than \(n\). We define the latent ID and the latent OOD data as \(_{}\) and \(_{}\), respectively. Then, we assume the latent ID data are drawn from the high-density region of a Mixture of Gaussian (MoG):

\[_{}^{}^{}=\{ _{Z}|()>\},\] (6)

where \(\) is the threshold and \(_{Z}\) is a pre-defined MoG, given by the density function of MoG \(()=_{i=1}^{c}(| _{i},_{i})\), with the mean \(_{i}\) and the covariance \(_{i}\) for the \(i\)-th sub-Gaussian. Furthermore, as we demonstrate in Section 4.2, we also require the specification of labels for latent ID data. Therefore, we assume that \(_{Z}\) is constructed by \(c\) sub-distributions of Gaussian, and data belong to each of these \(c\) sub-distributions should have the same label \(_{}\).

**Remark 2**.: _MoG provides a simple way to generate data, yet the key point is to ensure that auxiliary ID/OOD data should have the disjoint support, i.e, \(1\). Therefore, if \(1\) is satisfied properly, other noise distributions, such as the beta mixture models and the uniform distribution, can also be used. Further, our ATOL is different from previous data generation-based methods in that we do not require generated data to be reliable in the data space. ATOL does not involve fitting the MoG to real ID data, where the parameters can be pre-defined and fixed. Therefore, we do not consider overfitting and accuracy of MoG in our paper._

Furthermore, for the disjoint support, the latent OOD data are drawn from a uniform distribution except for the region with high MoG density, i.e.,

\[_{}^{}^{}=\{ _{Z}|()\},\] (7)

with \(_{Z}\) a pre-defined uniform distribution. For now, we can ensure that \(^{}^{}=\).

However, \(^{}^{}=\) does not imply \(G(^{}) G(^{})=\), i.e., \(1\) is not satisfied given arbitrary \(G()\). To this end, we suggest further ensuring the generator to be a distance-preserving function , which is a sufficient condition to ensure that the disjoint property can be transformed from the latent space into the data space. For distance preservation, we suggest a regularization term for the generator regularizing, which is given by

\[_{}(_{1},_{2};G)=-_{ _{Z}_{Z}}[d(_{1},_{2})  d(G(_{1}),G(_{2}))]}{_{ _{Z}_{Z}}[d(_{1},_{2}) ]_{_{Z}_{Z}}[d(G(_ {1}),G(_{2}))]}},\] (8)

where \(d(_{1},_{2})\) is the centralized distance given by \(\|_{1}-_{2}\|_{2}-\|_ {1}-_{2}\|_{2}\). Overall, Eq. (8) is the correlation for the distances between data pairs measured in the latent and the data space, stating that the closer distances in the latent space should indicate the closer distances in the data space.

In summary, to fulfill \(1\), we need to specify the regularizing procedure for the generator, overall summarized by the following two steps. First, we regularize the generator with the regularization in Eq. (8) to ensure the distance-preserving property. Then, we specify two disjoint regions in the latent space following Eqs. (6)-(7), of which the data after passing through the generator are taken as auxiliary ID and auxiliary OOD data, respectively. We also summarize the algorithm details in crafting the auxiliary OOD detection task in Appendix D.

### Applying the Auxiliary Task

We have discussed a general strategy to construct the auxiliary OOD detection task, which can be learned by the predictor following an outlier exposure-based learning objective, similar to Eq. (2). Now, we fulfill \(2\), transferring model capability from the auxiliary task to real OOD detection.

In general, \(2\) states that we should align distributions between the auxiliary and the real ID data such that the auxiliary OOD data can benefit real OOD detection, thus overcoming the negative effects of mistaken OOD generation. Following Tang et al. , we align the auxiliary and the real ID distribution via supervised contrastive learning , pulling together data belonging to the same class in the embedding space meanwhile pushing apart data from different classes. Accordingly, we suggest the alignment loss for the auxiliary ID data \(}_{}\), following,

\[_{}(}_{},_{}; )=-_{l}^{_{}}|}_{ _{}^{B}_{l}^{_{}}}(}_{})( _{}^{p})]}{_{_{}^{B}_ {l}}[(}_{})( _{}^{a})]}.\] (9)

\(_{l}\) is a set of data of size \(l\) drawn from the real ID distribution, namely, \(_{l}=\{_{}^{i}|(_{}^{i},y_{ }^{i})_{X,Y}^{},i\{1,,l\}\}\). Furthermore, \(_{l}^{y}\) is a subset of \(_{l}\) with ID data that below to the label of \(y\), namely, \(^{y}_{l}=\{^{i}_{}|(^{i}_{},y^{i} _{})^{}_{X,Y}\;,y^{i}_{}=_{},i \{1,,l\}\}\). Accordingly, based on Theorem 1, we can ensure that learning from the auxiliary OOD detection task, i.e., small Eq. (5), can benefit real OOD detection, freeing from the mistaken OOD generation.

### Overall Algorithm

We further summarize the training and the inferring procedure for the predictor of ATOL, given the crafted auxiliary ID and the auxiliary OOD distributions that satisfy **C**1 via Eqs. (6)-(7). The pseudo codes are further summarized in Appendix D due to the space limit.

**Training Procedure.** The overall learning objective consists of the real task learning, the auxiliary task learning, and the ID distribution alignment, which is given by:

\[_{=} _{^{}_{X,Y}}^{}[_{}(_{},y_{};) ]}^{}+_{^{}_{X,Y}}[_{}(}_{},_{};)]+_{^{}_{X}}[ _{}(}_{};)]}^{}+\] (10) \[_{^{}_{X,Y}}[ _{}(}_{},_{};)]}_{},\]

where \(, 0\) are the trade-off parameters. By finding the predictor that leads to the minimum of the Eq. (10), our ATOL can ensure the improved performance of real OOD detection. Note that, Eq. (10) can be realized in a stochastic manner, suitable for deep model training.

**Inferring Procedure.** We adopt the MaxLogit scoring  in OOD detection. Given a test input \(\), the MaxLogit score is given by:

\[s_{}(;)=_{k}_{k}(),\] (11)

where \(_{k}()\) denotes the \(k\)-th logit output. In general, the MaxLogit scoring is better than other commonly-used scoring functions, such as maximum softmax prediction , when facing large semantic space. Therefore, we choose MaxLogit instead of MSP for OOD scoring in our realization.

## 5 Experiments

This section conducts extensive experiments for ATOL in OOD detection. In Section 5.1, we describe the experiment setup. In Section 5.2, we demonstrate the main results of our method against the data generation-based counterparts on both the CIFAR  and the ImageNet  benchmarks. In Section 5.3, we further conduct ablation studies to comprehensively analyze our method.

### Setup

**Backbones setups.** For the CIFAR benchmarks, we employ the WRN-40-2  as the backbone model. Following , models have been trained for \(200\) epochs via empirical risk minimization, with a batch size \(64\), momentum \(0.9\), and initial learning rate \(0.1\). The learning rate is divided by \(10\) after \(100\) and \(150\) epochs. For the ImageNet, we employ pre-trained ResNet-50  on ImageNet, downloaded from the PyTorch official repository.

**Generators setups.** For the CIFAR benchmarks, following , we adopt the generator from the Deep Convolutional (DC) GAN ). Following the vanilla generation objective, DCGAN has been trained on the ID data, where the batch size is \(64\) and the initial learning rate is \(0.0002\). For the ImageNet benchmark, we adopt the generator from the BigGAN  model, designed for scaling generation of high-resolution images, where the pre-trained model biggan-256 can be downloaded from the TensorFlow hub. Note that our method can work on various generators except those mentioned above, even with a random-parameterized one, later shown in Section 5.3.

**Baseline methods.** We compare our ATOL with advanced data generation-based methods in OOD detection, including (1) BoundaryGAN , (2) ConfGAN , (3) ManifoldGAN , (4) G2D  (5) CMG . For a fair comparison, all the methods use the same generator and pre-trained backbone without regularizing with outlier data.

**Auxiliary task setups.** Hyper-parameters are chosen based on the OOD detection performance on validation datasets. In latent space, the auxiliary ID distribution is the high density region of the Mixture of Gaussian (MoG). Each sub-Gaussian in the MoG has the mean \(=(_{1},_{2},,_{m})\) and the same covariance matrix \(\), where \(m\) is the dimension of latent space, \(_{i}\) is randomly selected from the set \(\{-,\}\), and \(\) is the identity matrix. The auxiliary OOD distribution is the uniform distribution except for high MoG density region, where each dimension has the same space size \(u\). For the CIFAR benchmarks, the value of \(\) is set to \(1\), \(\) is \(5\), \(\) is \(0.1\), and \(u\) is \(8\). For the ImageNet benchmarks, the value of \(\) is set to \(1\), \(\) is \(5\), \(\) is \(0.8\), and \(u\) is \(8\).

**Training details.** For the CIFAR benchmarks, ATOL is run for \(10\) epochs and uses SGD with an initial learning rate \(0.01\) and the cosine decay . The batch size is \(64\) for real ID cases, \(64\) for auxiliary ID cases, and \(256\) for auxiliary OOD cases. For the ImageNet benchmarks, ATOL is run for \(10\) epochs using SGD with an initial learning rate \(0.0003\) and a momentum \(0.9\). The learning rate is decayed by a factor of \(10\) at \(30\%\), \(60\%\), and \(90\%\) of the training steps. Furthermore, the batch size is fixed to \(32\) for real ID cases, \(32\) for auxiliary ID cases, and \(128\) for auxiliary OOD cases.

**Evaluation metrics.** The OOD detection performance of a detection model is evaluated via two representative metrics, which are both threshold-independent : the false positive rate of OOD data when the true positive rate of ID data is at \(95\%\) (FPR\(95\)); and the _area under the receiver operating characteristic curve_ (AUROC), which can be viewed as the probability of the ID case having greater score than that of the OOD case.

### Main Results

We begin with our main experiments on the CIFAR and ImageNet benchmarks. Model performance is tested on commonly-used OOD datasets. For the CIFAR cases, we employed Texture , SVHN , Places\(365\), LSUN-Crop , LSUN-Resize , and iSUN . For the ImageNet case, we employed iNaturalist , SUN , Places\(365\), and Texture . In Table 1, we report the average performance (i.e., FPR\(95\) and AUROC) regarding the OOD datasets mentioned above. Please refer to Tables 17-18 and 19 in Appendix F.1 for the detailed reports.

**CIFAR benchmarks.** Overall, our ATOL can lead to effective OOD detection, which generally demonstrates better results than the rivals by a large margin. In particular, compared with the advanced data generation-based method, e.g., ManifoldGAN , ATOL significantly improves the performance in OOD detection, revealing \(12.02\%\) and \(2.96\%\) average improvements w.r.t. FPR\(95\) and AUROC on the CIFAR-\(10\) dataset and \(18.32\%\) and \(9.84\%\) of the average improvements on the CIFAR-\(100\) dataset. This highlights the superiority of our novel data generation strategy, relieving mistaken OOD generation as in previous methods.

**ImageNet benchmark.** We evaluate a large-scale OOD detection task based on ImageNet dataset. Compared to the CIFAR benchmarks above, the ImageNet task is more challenging due to the large semantic space and large amount of training data. As we can see, previous data generation-based methods reveal poor performance due to the increased difficulty in searching for the proper OOD-like data in ImageNet, indicating the critical mistaken OOD generation remains (cf., Appendix F.9). In contrast, our ATOL can alleviate this issue even for large-scale datasets, e.g., ImageNet, thus leading to superior results. In particular, our ATOL outperforms the best baseline ManifoldGAN  by \(20.70\%\) and \(8.09\%\) average improvement w.r.t. FPR\(95\) and AUROC, which demonstrates the advantages of our ATOL to relieve mistaken OOD generation and benefit to real OOD detection.

    &  &  &  \\   & FPR\(95\) & AUROC \(\) & FPR\(95\) & AUROC \(\) & FPR\(95\) & AUROC \(\) \\  BoundaryGAN  & 55.60 & 86.46 & 76.72 & 75.79 & 85.48 & 66.78 \\ ConfGAN  & 31.57 & 93.01 & 74.86 & 77.67 & 74.88 & 77.03 \\ ManifoldGAN  & 26.68 & 94.09 & 73.54 & 77.40 & 72.50 & 77.73 \\ G2D  & 31.83 & 91.74 & 70.73 & 79.03 & 74.93 & 77.16 \\ CMG  & 39.83 & 92.83 & 79.60 & 77.51 & 72.95 & 77.63 \\ 
**ATOL** (ours) & **14.66** & **97.05** & **55.22** & **87.24** & **51.80** & **85.82** \\   

Table 1: Comparison in OOD detection on the CIFAR and ImageNet benchmarks. \(\) (or \(\)) indicates smaller (or larger) values are preferred; a bold font indicates the best results in a column.

### Ablation Study

To further demonstrate the effectiveness of our ATOL, we conduct extensive ablation studies to verify the contributions of each proposed component.

**Auxiliary task crafting schemes.** In Section 4.1, we introduce the realization of the auxiliary OOD detection task in a tractable way. Here, we study two components of generation: the disjoint supports for ID and OOD distributions in the latent space and the distance-preserving generator. In particular, we compare ATOL with two variants: 1) ATOL \(w/o\ \), where the ID and OOD distributions may overlap in latent space without separation via the threshold \(\); 2) ATOL \(w/o\ _{}\), where we directly use the generator to generate the auxiliary data without further regularization. As we can see in Table 2, the overlap between the auxiliary ID and the auxiliary OOD distributions in latent space will lead to the failure of the auxiliary OOD detection task, demonstrating the catastrophic performance (e.g., \(92.20\%\) FPR\(95\) and \(51.34\%\) AUROC on CIFAR-\(100\)). Moreover, without the regularized generator as a distance-preserving function, the ambiguity of generated data will compromise the performance of ATOL, which verifies the effectiveness of our generation scheme.

**Auxiliary task learning schemes.** In Section 4.2, we propose ID distribution alignment to transfer model capability from auxiliary OOD detection task to real OOD detection. In Table 2, we conduct experiments on a variant, namely, ATOL \(w/o\ _{}\), where the predictor directly learns from the auxiliary task without further alignment. Accordingly, ATOL \(w/o\ _{}\) can reveal better results than ATOL \(w/o\ _{}\), with \(18.84\%\) and \(3.70\%\) further improvement w.r.t. FPR\(95\) and AUROC on CIFAR-\(10\) and \(8.60\%\) and \(6.61\%\) on CIFAR-\(100\). However, the predictor learned on the auxiliary task cannot fit into the real OOD detection task. Thus, we further align the distributions between the auxiliary and real ID data in the transformed space, significantly improving the OOD detection performance with \(7.75\%\) on CIFAR-\(10\) and \(19.14\%\) on CIFAR-\(100\) w.r.t. FPR\(95\).

**Generator Setups.** On CIFAR benchmarks, we use the generator of the DCGAN model fitting on the ID data in our ATOL. We further investigate whether ATOL remains effective when using generators with other setups, summarized in Table 3. First, we find that even with a random-parameterized DCGAN generator, i.e., Rand-DCGAN, our ATOL can still yield reliable performance surpassing its advanced counterparts. Such an observation suggests that our method requires relatively low training costs, a property not shared by previous methods. Second, we adopt more advanced generators, i.e., BigGAN  and StyleGAN-v2 . As we can see, ATOL can benefit from better generators, leading to large improvement \(18.80\%\) and \(5.12\%\) w.r.t. FPR\(95\) and AUROC on CIFAR-\(100\) over the DCGAN case. Furthermore, even with complicated generators, our method demonstrates promising performance improvement over other methods with acceptable computational resources. Please refer to the Appendix E.8 and Appendix F.7 for more details.

    &  & }\)} & }\)} &  \\   & FPR\(95\) & 87.64 & 41.13 & 22.29 & **14.54** \\  & AUROC \(\) & 59.32 & 90.38 & 94.08 & **97.01** \\   & FPR\(95\) & 92.90 & 82.80 & 74.20 & **55.06** \\  & AUROC \(\) & 51.34 & 73.95 & 80.56 & **87.26** \\   

Table 2: Effectiveness of auxiliary task crafting and learning scheme of ATOL. \(\) (or \(\)) indicates smaller (or larger) values are preferred; a bold font indicates the best results in a row.

    & DCGAN & Rand-DCGAN & StyleGAN & BigGAN \\   & FPR\(95\) & 14.66 & 20.78 & 13.65 & **8.61** \\  & AUROC \(\) & 97.05 & 95.57 & 96.63 & **97.90** \\   & FPR\(95\) & 55.52 & 65.69 & 42.62 & **36.72** \\  & AUROC \(\) & 86.21 & 83.26 & 89.17 & **91.33** \\   

Table 3: Performance comparisons with different setups of the generator on CIFAR benchmarks; \(\) (or \(\)) indicates smaller (or larger) values are preferred; a bold font indicates the best results in a row.

Quantitative analysis on computation.

Data generation-based methods are relatively expensive in computation, so the consumed training time is also of our interest. In Table 4, we compare the time costs of training for the considered data generation-based methods. Since our method does not need a complex generator training procedure during the OOD learning step, we can largely alleviate the expensive cost of computation inherited from the data generation-based approaches. Overall, our method requires minimal training costs compared to the advanced counterparts, which further reveals the efficiency of our method. Therefore, our method can not only lead to improved performance over previous methods, but it also requires fewer computation resources.

## 6 Conclusion

Data generation-based methods in OOD detection are a promising way to make the predictor learn to discern ID and OOD data without real OOD data. However, mistaken OOD generation significantly challenges their performance. To this end, we propose a powerful data generation-based learning method by the proposed auxiliary OOD detection task, largely relieving mistaken OOD generation. Extensive experiments show that our method can notably improve detection performance compared to advanced counterparts. Overall, our method can benefit applications for data generation-based OOD detection, and we intend further research to extend our method beyond image classification. We also hope our work can draw more attention from the community toward data generation-based methods, and we anticipate our auxiliary task-based learning scheme can benefit more directions in OOD detection, such as wild OOD detection .