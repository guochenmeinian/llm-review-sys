# LoReUn: Data Itself Implicitly Provides Cues to Improve Machine Unlearning

Xiang Li Qianli Shen Haonan Wang Kenji Kawaguchi

School of Computing

National University of Singapore

{xiang_li,shenqianli,haonan.wang}@u.nus.edu, kenji@comp.nus.edu.sg

Qianli Shen Haonan Wang Renji Kawaguchi

School of Computing

National University of Singapore

{xiang_li,shenqianli,haonan.wang}@u.nus.edu, kenji@comp.nus.edu.sg

###### Abstract

Recent generative models face significant risks of producing harmful content, which has highlighted machine unlearning (MU) as a crucial method for removing the influence of undesired data. However, different difficulty levels among data points can affect unlearning performance. In this paper, we propose that the loss of a data point implicitly reflects its varying difficulty level, leading to our plug-and-play strategy, Loss-based Reweighting Unlearning (LoReUn), which dynamically reweight data throughout the unlearning process with minimal computational effort. Our method significantly reduces the performance gap with exact unlearning in both image classification and generation tasks, effectively enhancing the prevention of harmful content generation from text-to-image diffusion models.

Figure 1: Given a forgetting set that contains data to be unlearned and a retaining set of remaining data from the training set, the unlearned model updates upon the original model to remove the influence of the forgetting data, while maintaining utility of the retaining data. To achieve this, the overall unlearning loss consists of two parts: forgetting loss, which uses random labels for the forgetting data, and retaining loss, which employs clean labels for the retaining data. We propose Loss-based Reweighting Unlearning (LoReUn) to dynamically reweight data based on the difference between the current loss on the unlearned model and a reference loss on the original model, enabling effective and efficient handling of data with varying difficulties during the forgetting and retaining process.

Introduction

As generative models have grown rapidly in size and capacity, they unintentionally memorize sensitive, private, harmful, or copyrighted information from their training data [3; 25]. This causes the potential risk to generate inappropriate content when triggered by certain inputs. For instance, researchers have shown that text-to-image generative models are particularly prone to generating undesirable content, such as nudity or violence, when exposed to inappropriate prompts . In response, machine unlearning (MU) has gained renewed attention as a strong strategy to eliminate the influence of specific data points for building trustworthy machine learning systems. Exact MU methods [11; 2], such as retraining from scratch without the forgetting dataset, offer provable unlearning guarantees but are computationally expensive, making them impractical for real-world usage. To this end, most works [15; 28; 10; 26; 5] focus on approximate MU methods to achieve a balance between unlearning effectiveness and efficiency. As an emerging area of research, approximate unlearning still has significant potential for improvement to narrow the performance gap with exact MU.

To understand the limitations and mechanisms behind existing approximate MU methods, several efforts have focused on analyzing data that is relatively challenging to unlearn. For example, Fan et al.  finds unlearning can fail when evaluated on the worst-case forget set. Barbulescu and Triantafillou  suggests treating data individually based on how well the original model memorizes it, while a following work  examines how entanglement and memorization degrees affect the unlearning difficulty of different data. However, the previous approaches are too computationally expensive to dynamically identify the difficulty of data points .

In this paper, instead of explicitly evaluating the difficulty of each data point, we present the idea that the data itself's loss can implicitly reflect its varying difficulty during unlearning. We introduce a simple yet effective plug-and-play strategy, **L**oss-based **R**eweighing for **U**nlearning (LoReUn), which dynamically reweights data according to the current loss on the unlearned model and a reference loss from the original model. This reweighting process requires no additional inference for the data, making it significantly more lightweight compared to previous methods or exact MU. Our experimental results demonstrate that LoReUn remarkably reduces the performance gap with exact MU approaches, providing an effective and practical approach in both image classification and generation tasks. Notably, LoReUn excels in the application of eliminating harmful images generated from stable diffusion with inappropriate prompts (I2P ).

## 2 Related Work

### Safety Concerns in Generation Models

Generative models like diffusion models are usually trained on data sets collected from diverse open sources, such as LAION . This causes them to face the risk of generating inappropriate images  or copyright-infringed content by mimicking artistic style . While  argue that simply using a safety filter can not prevent diffusion models from generating harmful content, another line of works [7; 17; 8; 21; 29; 5; 13] studies erasing unsafe concepts from pre-trained diffusion models to mitigate undesirable generations.

### Machine Unlearning

Machine Unlearning (MU) aims to eliminate the influence of specific data points from a pre-trained model [9; 18; 27; 23]. Though retraining from scratch provides exact unlearning , it suffers from impractical computation demands. Alternatively, approximate unlearning methods [28; 10; 26; 15; 4] have been proposed as a more effective and efficient solution. Among them, Random Labeling  (RL) proposes to fine-tune the model with randomly labeled forgetting data. SalUn  further introduced gradient-based weight saliency to update specific model weights instead of the whole model during the unlearning process. The application of SalUn covers both image classification and generation tasks. In this paper, we design an effective plug-and-play strategy for RL-based unlearning methods.

Preliminaries and Problem Statement

Machine Unlearning.Let \(=\{_{i}\}_{1}^{N}\) be the training set consisting of \(N\) data points, where each data point is represented as feature \(_{i}\) with or without label \(y_{i}\). Let \(_{}\) be the forgetting dataset and \(_{}=_{}\) be the remaining dataset. The original model \(_{}\) is trained on \(\) and we regard Retrain as the gold standard model \(\), which is trained on \(_{}\) only from scratch. The problem of machine unlearning is to obtain an unlearned model \(_{}\) from the original model \(_{}\) using \(_{}\) with or without \(_{}\), such that it can be a perfect surrogate model for Retrain model \(\) but is much more computationally efficient. One of the biggest challenges in MU is to balance between unlearning efficacy on \(_{}\) and model utility on \(_{}\) as well as generalization ability on test set \(_{}\).

Machine Unlearning for Classification.There are two scenarios for machine unlearning in image classification: class-wise forgetting and random data forgetting. The former task aims to remove the influence of an image class, while the latter aims to forget a subset of randomly selected data points from the training set. In this paper, we will focus on one of the most effective MU method Random Labeling (RL). The objective of RL for unlearning in classification can be formulated as:

\[L^{(1)}(_{})=_{(,y)_{ },y^{} y}[_{}(_{};,y^{})]+_{(,y)_{}}[_{ }(_{};,y)],\] (1)

where \(y^{}\) is the random label of \(\) different from \(y\), \(>0\) is a regularization parameter.

Machine Unlearning for Generation.In this paper, we focus on unlearning in conditional latent diffusion model Stable Diffusion . Text-to-image diffusion models use prompts as conditions to guide the sampling process for generating images, which may contain unsafe content with inappropriate prompts as input. The training of diffusion models consists of a predefined forward process adding noise to data and a reverse process denoising the corrupted data, with its loss given by:

\[_{}(;)=_{t,(,c) ,e(0,1)}[||-_{}( _{t}|c)||_{2}^{2}],\] (2)

where \(_{t}\) is a noisy latent of \(\) at timestep \(t\), \(_{}(_{t}|c)\) is the noise estimation given conditioned prompt \(c\). Unlearning in image generation also encompasses a trade-off between two objectives: eliminating undesired content generated from the pre-trained diffusion model when conditioned on forgetting concepts like nudity, and preserving the quality of normal images generated from the unlearned model. Accordingly, following , the unlearning loss of random labeling in diffusion models becomes twofold:

\[L^{(2)}(_{})=_{t,(,c)_{ },e(0,1),c^{} c}[||_{ _{}}(_{t}|c^{})-_{_{}}( _{t}|c)||_{2}^{2}]+_{}(_{};_{}),\] (3)

where \(c^{}\) is a concept different from \(c\), \(>0\) is a regularization parameter.

## 4 Method

In this section, we introduce a lightweight plug-and-play strategy to dynamically manage data of diverse difficulty levels during the unlearning process. The key idea of our method is to reweight data according to the current loss on the unlearned model and a reference loss from the original model.

Motivation.Previous works [6; 1; 30] have shown that the difficulty of different data points can result in varied unlearning performance. However, adding extra steps to estimate data difficulty can be computationally expensive during the unlearning process. This motivates our method of using the difference of current loss on the unlearned model and a reference loss from the original model to implicitly capture the dynamic difficulty of each data point according to the model's response over time. In Figure 2, we illustrate the average loss of the original and unlearned models on the three sets. We can observe that compared with the original model,

Figure 2: The average loss on different sets of data. LoReUn acheives the smallest gap with exact MU (Retrain) compared to baseline models RL and SalUn.

exact MU (Retrain) shows a significant increase in average loss on the forgetting set, while the average loss on the retaining set slightly decreases, and remains similar on the test set. This observation is consistent with the expectation that an ideal unlearned model should exhibit increased loss in the forgetting set and preserved loss performance in the retaining set and test set. It also implies that the unlearning efficacy and retaining ability of MU models can be implicitly reflected in the loss values.

Building on this motivation, we introduce a simple yet effective plug-and-play unlearning strategy to increase the weight of data points in the forgetting set if their loss decreases, while for the retaining set, we lower the weight of data points with dropped loss.

A detailed algorithm for our proposed LoReUn is provided in Algorithm 1.

Step 1: Obtain reference losses with the original modelWe use a reference loss to provide a point of comparison for tracking the unlearning progress, as it would be hard to differentiate data of varying difficulties without an initial gauge. Specifically, we compute an averaged loss \(_{}^{}\) of forgetting dataset (\(_{}^{}\) for retaining dataset) on the original model \(_{}\). For the image generation task, however, the magnitudes of loss values are not the same for data at different sampled time steps \(t\) within a batch when training diffusion models (overall speaking, larger time steps result in smaller loss magnitudes). However, computing an initial average loss for all time steps is time-consuming. Instead, we first computed average loss at sampled time step \(t\) with a fixed interval (e.g., a total of 10 time steps ranging from 0 to 1000 with an interval of 100). We then fit the sampled loss with an exponential function to obtain an approximated loss curve at all time steps. The estimated loss at time step \(t\) is termed as \(_{t}^{}\).

Step 2: Unlearning with reweighted lossWe leverage the excess loss to reweight each data point at every unlearning iteration. The excess loss is the difference between the current loss on the unlearned model and the reference loss from the original model. Following the motivation above, in the forgetting phase, we pay more weight to data with smaller excess loss, which may be memorized well by \(_{}\) and harder to unlearn. Whereas in the retaining process, we increase weights to data with larger loss values, whose performance may be falsely degraded by the unlearned model \(_{}\). Formally, following notations in Section 3, we define weight functions as:

\[w^{}_{}() =} d((,), _{}^{}))},\] (4) \[w^{}_{}() =} d((,),_ {}^{}))},\] (5)

where \(d(,)\) measures the difference with the reference loss, specifically, for image classification, \(d(,^{})=-^{}\) and for image generation task \(d(,^{},t)=/_{t}^{}\). We use a different excess loss measure in the generation task for a fair comparison among loss values of varying magnitudes as mentioned earlier. Notice that we use exponential decay for the weight function on the forgetting set but exponential growth for the retaining set (\(\) is entrywise). Thus the weight function aims to reward forgetting data with smaller excess loss and retaining data with larger excess loss.

All the weights are normalized and the final loss function is defined as:

\[L(_{},w_{},w_{})=_{i=1}^{n}w_{}( _{i})(_{i},y^{}_{i})+_{j=1}^{n}w_{}(_{j})(_{j},y_{j}),\ w(_{i})=(_{i})}{ _{i=1}^{n}w^{}(_{i})},\] (6)

where \(n\) is the batch size, \(>0\) is a regularization parameter same as mentioned in Equation 1.

## 5 Experiments

### Experimental Setup

Datasets and ModelsIn image classification tasks, we consider both random data forgetting and class-wise forgetting scenarios with model ResNet-18  on dataset CIFAR-10 . In image generation tasks, we consider both class-wise forgetting and concept-wise forgetting with latent diffusion model  (Stable Diffusion). The class-wise scenario is evaluated on Imagenette dataset , where 10 classes are presented by prompt 'an image of [class name]'. The concept-wise scenario is evaluated on the generation of NSFW (not safe for work) content using I2P dataset  (under category "sexual") including 931 nudity-related prompts, e.g.,'shirtless man on a bed'.

Evaluation MetricsFor image classification, to comprehensively assess the effectiveness of MU methods, we consider the following 6 evaluation metrics: unlearning accuracy (UA): accuracy of \(_{}\) on \(_{}\), retaining accuracy(RA): accuracy of \(_{}\) on \(_{}\), testing accuracy (TA): accuracy of \(_{}\) on \(_{}\), membership inference attack (MIA): privacy measure of \(_{}\) on \(_{}\), and run-time efficiency (RTE): computation time of running an MU method. Following , to better capture the trade-offs among forgetting quality (indicated by UA), model utility (indicated by RA), and generalization ability (indicated by TA), we also evaluate image classification unlearning using "tug-of-war" (ToW), which is measured by matching the performance to the Retrain model \(_{}\) on each of the forget \(_{}\), retain \(_{}\), and test \(_{}\) sets. Formally,

\[=_{\{_{},_{ {r}},_{}\}}(1-(_{}, _{},)),\ \ \ (_{},_{}, )=|(_{},)-( _{},)|,\]

where \((,)=_{(,) }[f(;)=]\) is the accuracy on \(\) with a model \(f\) parameterized by \(\) and \((_{},_{},)\) is the absolute difference between accuracy of \(_{}\) and \(_{}\) on \(\).

For image generation, we use an external classifier to measure UA for the forgetting class or concept, and FID to measure the quality of generated images in the retaining class or prompts.

Implementation DetailsFor image classification, we use a learning rate of \(0.01\) and train for 20 epochs in random forgetting with \(_{}=0.1\) and \(_{}=0.25\); in class-wise forgetting, we use the same learning rate for 10 epochs with \(_{}=0.2\) and \(_{}=0.1\). For image generation, for class-wise forgetting on Imagenette, we train the model in 5 epochs with a batch size of 8 and use a learning rate of 1e-5, \(=1.0\), \(_{}=0.1\), and \(_{}=0.2\). For NSFW removal, only 1 epoch is needed with the same hyperparameter settings above. Following , the forgetting set is under the concept with prompt 'a photo of a nude person' and the retaining set is constructed using concept 'a photo of a person wearing clothes'. The sampling process uses 100 DDIM time steps with a conditional scale of 7.5.

### Experimental Results

Performance in image classification.As shown in Table 1, we report the results of random data unlearning (standard 10% random data) and class-wise unlearning scenarios. Aside from the Retrain model, we also compare our method to two baseline models we developed upon, Random Labeling  (RL) and Saliency Unlearn  (SalUn). We find that our proposed LoReUn achieves improved performance across all the metrics compared with baseline models in both scenarios. Notably, LoReUn performs the smallest performance gap with Retrain, and the best trade-off between 

[MISSING_PAGE_FAIL:6]

## 6 Conclusion

To practically leverage the difficulty levels of different data points, we introduce a lightweight yet effective strategy LoReUn that dynamically reweighting data during unlearning. LoReUn not only demonstrates its superiority in both image classification and generation tasks but also remarkably diminishes the risk of harmful generation from stable diffusion.