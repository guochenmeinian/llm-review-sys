# Wormhole Loss for Partial Shape Matching

Amit Bracha Thomas Dages Ron Kimmel

Technion - Israel Institute of Technology

Haifa, Israel

{amit.bracha,thomas.dages}@cs.technion.ac.il

Equal contribution

###### Abstract

When matching parts of a surface to its whole, a fundamental question arises: Which points should be included in the matching process? The issue is intensified when using isometry to measure similarity, as it requires the validation of whether distances measured between pairs of surface points should influence the matching process. The approach we propose treats surfaces as manifolds equipped with geodesic distances, and addresses the partial shape matching challenge by introducing a novel criterion to meticulously search for consistent distances between pairs of points. The new criterion explores the relation between intrinsic geodesic distances between the points, geodesic distances between the points and surface boundaries, and extrinsic distances between boundary points measured in the embedding space. It is shown to be less restrictive compared to previous measures and achieves state-of-the-art results when used as a loss function in training networks for partial shape matching.

## 1 Introduction

Shape correspondence is a core challenge in computer graphics and computer vision, distinguished by its wide array of applications extending from 3D modeling and animation to object recognition and beyond. The task involves establishing mappings between corresponding points across different surfaces that undergo non-rigid transformations. Shape correspondence grows particularly intricate when it involves partial surfaces, where the objective is to find correspondences between parts of surfaces or between a complete surface and a part of another. This sub-task is particularly difficult as it involves incomplete data and possible different topology of the matched surfaces. Consequently, training neural networks for the partial matching task is challenging, especially for unsupervised methods, as there is no information about which parts are missing and which should be matched.

The state of the art in partial shape matching is performed with Functional Maps (FM), a popular framework for relating functions defined on surfaces via basis functions defined on the surfaces . Recently, it was argued that the unused information from the full surface impairs the learning process when FM is incorporated in the learning pipeline , with better results obtained when bypassing FM altogether by direct estimation of correspondences. This method is primarily guided by a loss function preserving the pairwise geodesic distances , which relies on the fact that such distances are preserved under isometric transformations. When dealing with partial surfaces, not all distances are preserved, as minimal geodesics on the full surface may go through a region which is missing in the partial surface. Therefore, undesired biases are integrated into the learning procedure, which can impair the quality of the learned correspondence. This applies to both FM-based unsupervised loss functions  and geodesic-based ones , where isometry between the surfaces is assumed.

In this paper, we present a novel loss for partial shape correspondence that takes into account partial surfaces. It is constructed upon the notion of _consistent_ pairs of points, where a pair is said to be consistent if the geodesic distance between the points is the same on the partial and full surface. Our task is to define a criterion that captures as much as possible consistent pairs, where these pairs are referred to as _guaranteed_ pairs. Using such a criterion, we can limit our matching procedures to consider only guaranteed pairs, thereby avoiding distortions. Filtering out potentially inconsistent distances between pairs of points was first studied in [13; 12; 14; 46; 47]. In particular, in [12; 46] the authors showed that for non-Euclidean spaces the geodesic distance between two points on a manifold is preserved when this distance is smaller than the sum of the surface distances of each point to the boundary of the surface. We show that this criterion is too conservative and it filters out a substantial number of consistent pairs of points. It can be improved by using the extrinsic information encapsulated in the manifold's embedding space. The new condition can be shown to provide significantly more guaranteed pairs of points.

Using this novel criterion to find consistent pairs of points, we present a new loss function for unsupervised shape correspondence tailored for partial surfaces. It is based on the ratio between the geodesic pairwise distance, that is calculated on the partial surface, and a measure defined by our criterion, which involves distances to points on the boundaries and the distance in the embedding space between the corresponding boundary points. The new loss was used for training an unsupervised shape correspondence neural network achieving state-of-the-art (SOTA) results on the reference SHREC'16 CUTS and HOLES datasets  and on the recent PFAUST dataset . Our code can be found at https://github.com/ABracha/Wormhole.

**Contributions**

* We introduce a novel criterion for identifying consistent pairs, which are pairs of points between which the geodesic distance is the same for the full and the partial surfaces.
* Using this criterion, we create a novel unsupervised loss function tailored specifically for partial surfaces, achieving SOTA results on partial shape correspondence benchmarks.

## 2 Related Efforts

Early attempts to solve shape correspondence involved extracting hand-crafted features for each point [4; 55]. Leveraging the intrinsic nature of the Laplace-Beltrami operator (LBO), its eigenfunctions were often employed to define such features on the manifold, invariant to non-rigid isometry, thereby, removing the dependency on the manifold's embedding in Euclidean space. Later, the Functional-Map (FM) framework was proposed . It builds on the fact that the mapping of consistent feature representations in local bases is linear, even for complex non-rigid spatial deformations of the manifolds. In fact, the first neural network for solving shape correspondence was based on the FM framework , which introduced a differentiable FM-layer to learn the correspondence map.

More recent methods suggested two alternative approaches for unsupervised shape matching. The first is based on the fact that isometries preserve geodesic distances , and the second is based on properties satisfied by the FM operator for isometric transformations . Improved architectures followed [22; 53; 31; 54]. Alternative loss functions were suggested, such as a supervised contrastive loss , or using the objective function from , which penalizes the difference between the FM output from the FM-layer and the FM estimated from the point-to-point mapping . Other papers explored different metrics, such as the scale invariant metric [11; 41], or anisotropic Riemannian metrics using the Finsler-based LBO .

Several efforts were made to tackle surface matching under partiality. Some approaches are based on a search strategy to find either the missing parts [7; 6; 43], or direct correspondence by exhaustive search . Few methods learn to find the correspondence, one such example learned linear invariant bases suited for partial surfaces rather than the classical LBO eigenspaces . Another supervised learning approach applied an attention layer  on extracted features, allowing feature interaction between the full and partial surfaces prior to the FM-layer . An unsupervised learning method, based on preserving intrinsic distances, avoided the use of an FM-layer altogether . The motivation was that FM introduces noise when used to match the whole to a part of a surface.

When dealing with partial surfaces, one needs to consider the fact that distances can be significantly different when measured between corresponding points in the partial and the whole surface. Thus,encouraging distance preservation between corresponding points can introduce undesired biases on the learned matching. Although  reported the current SOTA, it only tackles part of the problem. Here, we introduce a novel loss function based on _consistent_ pairs of points and geodesic distances, greatly reducing the effect of inconsistent distances on the learned correspondence.

To construct our loss function, we first revisit the notion of consistent pairs. The link between geodesic distances and distances to the boundaries of flat and non-flat surfaces was studied in [12; 14; 46; 47]. Validity conditions were suggested to predict whether distances between matching points are consistent between the partial and the full surface. Here, we revisit and refine these conditions, and introduce a more inclusive criterion that guarantees more consistent pairs by which the matching results improve.

## 3 On the Consistency of Distances between Pairs of Points in Partial Surfaces

### Consistent and Guaranteed Pairs of Points

In this section, we present the concept of _consistent_ and _guaranteed_ pairs of points.

Let \(\) and \(\) be isometric surfaces with a bijective mapping \(:\). In partial shape matching, the surfaces may have missing parts, meaning that we only have access to \(^{}\) and \(^{}\). For simplicity, we assume that we have access to the full surface \(\) but not the full surface \(\) and so \(^{}=\) and \(^{}\). We can easily generalise the discussion if \(^{}\). Consider two points \(P_{}\) and \(Q_{}\) on the partial surface \(^{}\) and their corresponding points \(P_{}=^{-1}(P_{})\) and \(Q_{}=^{-1}(Q_{})\) on \(\). As the mapping \(\) is isometric, the geodesic distances, reflecting the length of the shortest paths, on the full surfaces \(d_{}\) and \(d_{}\) are equal by definition, \(d_{}(P_{},Q_{})=d_{}(P_{},Q_{})\). However, it may be that the shortest path on the full surface \(\) between \(P_{}\) and \(Q_{}\) passes through a missing part of \(^{}\). In such a case, computing the geodesic path between these two points could lead to a longer path than the one on the full surface, implying that \(d_{}(P_{},Q_{}) d_{^{}}(P _{},Q_{})\) and that, in turn, \(d_{}(P_{},Q_{}) d_{^{}}(P _{},Q_{})\), even if the original mapping \(\) is isometric (see Figure 1). As such, methods relying on or enforcing the preservation of geodesic distances based on the isometry of the transformation \(\) are inappropriate when dealing with partial surfaces. They could incorrectly enforce equal distances when they should not. Although not all geodesic distances are preserved for partial surfaces, many nevertheless are preserved, leading to the definition of _consistent_ pairs.

**Definition 1** (Consistent Pair of Points).: A pair of points \(P_{}\) and \(Q_{}\) of a partial surface \(^{}\) is said to be _consistent_ if the geodesic distance on the partial surface is the same as that on the original full surface, i.e. \(d_{}(P_{},Q_{})=d_{^{}}(P_{ },Q_{})\).

As there are many consistent pairs even in cases of cuts and partiality, methods enforcing distance preservation between all pairs, even inconsistent ones, perform fairly well. However, penalizing distance dissimilarity for inconsistent pairs is undesired and decreases the quality of the resulting mapping. Our goal is to filter the set of pairs by finding as many as possible consistent pairs, and then relying only on these _guaranteed_ pairs when matching surfaces.

Figure 1: For a distance preserving map between full surfaces \(\) and \(\), also known as an isometry, the minimal geodesics in the partial version \(^{}\) may not correspond to those in the full surfaces \(\). That is, the geodesic distances between corresponding points may get larger.

**Definition 2** (Guaranteed Pair of Points).: A pair of points \(P_{}\) and \(Q_{}\) of a partial surface \(^{}\) is said to be _guaranteed_ with respect to a criterion \(:^{}^{}\{0,1\}\), or \(\)-guaranteed in short, if the criterion proves that the pair is consistent.

Note, that the criterion is unsupervised as no oracle provides knowledge from the full surface \(\) to compute it. The better the criterion, the more consistent pairs it finds, allowing for more consistent information to be used for finding the matching, see Figure 2. In the rest of this section, we focus on the search for consistent pairs in the partial surface \(^{}\) as a preprocessing step and will return to the surface \(\) when we perform partial shape matching.

### Expanding the Set of Guaranteed Pairs via Extrinsic Distances between Boundary Points

We introduce a criterion that finds as many consistent pairs as possible, which we then denote as guaranteed. Denote \(^{}\) the boundary of \(^{}\). For simplicity, we treat all boundaries equally. In , the criterion, \(_{}\), was designed to reject pairs of points, \(P_{}\) and \(Q_{}\) on \(^{}\), for which the sum of their distances on to the boundary \(\) is less than the geodesic distance between them,

\[_{}(P_{},Q_{}) = 1&\,d_{^{}}(P_{},Q_{ }) d_{^{}}(P_{},)+d_{ ^{}}(Q_{},)\\ 0&,\] (1)

where \(d_{^{}}(P_{},)\) is the minimal length of the minimal geodesic of \(P_{}\) to any boundary point,

\[d_{^{}}(P_{},)=_{B}d _{^{}}(P_{},B).\] (2)

This condition naturally follows from the fact that the length of a path between the points in the full surface \(\) that passes through the boundary \(\) is at least as long as the sum of their distances to the boundary.

Note, that this criterion is overly conservative and removes many consistent pairs. It practically ignores the length of possible trajectories connecting the boundary points, see Figure 3. To mitigate this condition, we propose to include extrinsic information that bounds from below the distances between pairs of boundary points. Note that when solving intrinsic problems, the practice of combining intrinsic and extrinsic information is uncommon, yet it has been shown to be beneficial for other types of robustness . For simplicity, we assume from now on that the manifold is embedded in a Euclidean space. We then readily use the following straightforward relation between geodesic distances and Euclidean ones.

**Theorem 1** (Euclidean bound).: _The geodesic distance between any points \(P\) and \(Q\) on a surface \( E\), for some embedding Euclidean space \(E=^{n}\), is larger than or equal to the Euclidean distance between the points measured in the embedding space,_

\[d_{}(P,Q) d_{E}(P,Q),\]

_where \(d_{E}(P,Q)=\|P-Q\|_{2}\)._

For a proof see Appendix A.1. We propose to consider trajectories passing through any pairs of boundary points \(B_{1}\) and \(B_{2}\) in \(\). By acting like a _wormhole_ connecting two boundary points, the length of the straight line in \(E\) connecting \(B_{1}\) and \(B_{2}\) can serve as a lower bound of the geodesic distance on the full surface between the points. Geodesic distance measures the distance of \(P\) and

Figure 2: Venn diagrams showing the relation between all pairs of points, consistent and guaranteed pairs for a surface with boundaries. All guaranteed pairs are consistent. Our criterion \(_{}\) is more inclusive than that of , \(_{}\). All guaranteed pairs by \(_{}\) are also guaranteed by \(_{}\).

to boundary points \(B_{1}\) and \(B_{2}\), whereas the Euclidean distance \(d_{E}(B_{1},B_{2})\) bounds from below the geodesic distance on the full surface between \(B_{1}\) and \(B_{2}\). Our _wormhole_ criterion \(_{}\) is given by

\[_{}(P_{},Q_{})=1& \;\;d_{^{}}(P_{},Q_{}) _{B_{1},B_{2}}d_{^{}}(P_{},B_{1} )+d_{^{}}(Q_{},B_{2})+d_{E}(B_{1},B_{2}),\\ 0&.\] (3)

By design, this criterion can be used to find consistent pairs.

**Theorem 2** (\(_{}\) guarantees).: _The wormhole criterion \(_{}\) yields guaranteed pairs._

See Appendix A.2 for a proof. The new criterion for finding consistent pairs, generalizes the best known criterion \(_{}\) as all \(_{}\)-guaranteed pairs are also \(_{}\)-guaranteed, see, e.g. Figure 4.

So far, we implicitly assumed that the metric on the manifold is the one induced from the Euclidean metric of the embedding space, meaning that curves have the same length from the perspective of the manifold and the embedding space. We can generalize the wormhole criterion to handle general Riemannian metrics on the manifold, by modulating the Euclidean distance of the straight line between boundary points by the minimal scaling relation between arclength measured by the embedding metric restricted to the manifold and one measured by the Riemannian metric of the embedded manifold. We present our generalised metric-sensitive criterion in Appendix A.3

The definition of consistent pairs has been in a continuous setting. We need to adapt it to the discrete world. We describe in Appendix B.2 how to do so. In short, we only consider points on the surface or its boundary to belong to a finite sampled set \(V\) of vertices on the continuous surface. We construct the threshold and binary mask matrices \(\) and \(\) of size \(|V||V|\), containing at entry \(ij\) respectively the threshold of the criterion \(_{}\) and the binary criterion value \(_{}\) of the \(ij\) pair of vertices,

\[_{ij}=_{B_{1},B_{2}}d_{^{}}(v_{i},B_ {1})+d_{^{}}(v_{j},B_{2})+d_{E}(B_{1},B_{2})\] (4)

Figure 4: We plot in green the set of points that together with the blue point satisfy \(_{}\) (left) and \(_{}\) (right). The blue point and any of the green ones form a guaranteed pairs. The cat surface is taken from the SHREC’16 HOLES dataset .

Figure 3: Example of inconsistent and consistent pairs of points. The minimal geodesic paths are colored red, while paths to the boundary points are colored blue. Different boundary points are selected in \(_{}\) and \(_{}\). The Euclidean lines connecting the boundary points selected by \(_{}\) are dashed blue. Both criteria correctly reject inconsistent pairs (left). Since \(_{}\) ignores the distance between boundary points, it discards many consistent pairs (middle). Criterion \(_{}\) finds more consistent pairs by including the extrinsic Euclidean distance between boundary points (right).

\[_{ij}=_{(_{^{}})_{ij}_{ij}},\] (5)

where \(\) is the indicator function and \((_{^{}})_{ij}\) is the computed geodesic distance on the partial surface \(^{}\) between \(v_{i}\) and \(v_{j}\).

To evaluate the quality of our criterion \(_{}\), we searched empirically for consistent pairs using either our criterion or \(_{}\) on the PFAUST-M and PFAUST-H  datasets, the latter comprising of shapes with more holes than the former. We provide in Table 1 the percentage of consistent pairs, and among those the percentage of guaranteed pairs by the different criteria, along with the standard deviations. Our criterion \(_{}\) is able to recover most pairs and it guarantees twice as many as the previous criterion \(_{}\).

## 4 Applications

### Multi-Dimensional Scaling

In this paper, we concentrate on partial shape matching. Additionally, we demonstrate that the proposed criterion for identifying consistent pairs can be beneficial for other tasks. Specifically, we show how it can be incorporated into a multidimensional scaling (MDS) pipeline. The MDS goal is to embed curved manifolds into a low dimensional Euclidean space \(^{m}\), for some small \(m\), such that the pairwise Euclidean distances of the new embedding are as close as possible to the original geodesic distances between corresponding pairs of points. To obtain embeddings robust to missing parts, we handle boundary conditions on partial surfaces by relying on consistent distances of guaranteed pairs. In [46; 47], the TCIE method minimises a masked distance preservation objective, with mask weights \(w_{ij}=_{}(P_{i},P_{j})\). Our MDS method, named _wormhole constrained isometric embedding_ (WHCIE), adapts this approach by replacing the mask weights with our criterion \(w_{ij}=_{}(P_{i},P_{j})=_{ij}\).

We plot the resulting WHCIE planar embedding of toy surfaces in Figure 5. For each Swiss roll, we removed either a hole or a full rectangular cut connected to the boundary. We compare with several reference manifold learning techniques: Isomap , MLLE , Laplacian eigenmaps , UMAP , and TCIE [46; 47]. Methods that do not check for distance consistency between pairs of points yield distorted embeddings. The wormhole criterion finds significantly more consistent pairs compared to the TCIE, resulting in an embedding similar to that of the actual surface. That is, a flat rectangle with a hole or a cut. For more details and comparison with related methods, see Appendix B.1.

### Partial Shape Matching

We next return to our primary application - matching shapes. To that end, we introduce the _wormhole loss,_ a method based on guaranteed pairs specifically designed for partial shape matching.

#### 4.2.1 Wormhole Loss: Unsupervised Partial Shape Matching using Consistent Pairs

Our mask \(\) and threshold \(\) matrices operate on minimal geodesic distances. A relevant unsupervised loss function using such distances for near isometric surfaces \(\) and \(\) is ,

\[_{}(,_{},_{}) =|^{2}}\|_{}^{}- _{}\|_{F}^{2},\] (6)

   Dataset & \%Consistent & \%Guaranteed (\(_{}\)) [12; 46] & \%Guaranteed (\(_{}\)) (Ours) \\  PFAUST-M & 78 (\( 16\)) & 48 (\( 18\)) & **82** (\( 14\)) \\ PFAUST-H & 53 (\( 16\)) & 30 (\( 18\)) & **65** (\( 18\)) \\   

Table 1: Empirical quantitative evaluation of the ability to recover consistent pairs. The numbers represent either the average percentage of consistent pairs out of the total number of pairs of points in a discrete shape, or the average percentage of guaranteed pairs by criteria \(_{}\) and \(_{}\) out of the number of consistent pairs. In parenthesis we provide the standard deviation across different shapes. Averages and standard deviations are computed within the PFAUST-M or PFAUST-H  datasets, the latter possessing shapes with more holes.

where \(\|.\|_{F}\) is the Frobenius norm, \(\) is the estimated point-to-point soft correspondence matrix, \(_{}\) is the geodesic distance matrix on surface \(\), and \(||\) is the area of surface \(\). The stochastic matrix \(\) of size \(|V_{}||V_{}|\) takes values in \(_{ij}\), and is row-normalized such that \(_{i}_{ij}=1\). This continuous setting accounts for possible different samplings of the surfaces, as the matched part in \(\) of each sampled vertex in \(V_{}\) may not have a corresponding sample point in \(V_{}\). If \(\) is estimated to be the correct correspondence matrix, then, the distances are preserved and the loss is minimal. We incorporate our mask \(\) into this loss function for partial surfaces \(^{}\) as follows,

\[_{}(,_{},_{ ^{}},) = _{ij}_{ij}_{^{}ii}_{ ^{}jj}(_{}^{}-_{ ^{}})_{ij}^{2},\] (7)

where \(\), now a matrix of size \(|V_{}||V_{^{}}|\) is a full-to-partial correspondence matrix, and \(_{^{}}\) is diagonal matrix of the vertex areas of shape \(^{}\). Thus, \(_{}^{}\) of size \(|V_{^{}}||V_{^{}}|\) maps the distances between pairs of vertices in \(\) to distances between pairs of vertices in \(^{}\). The mask matrix \(\) filters out inconsistent pairs, allowing the loss to be minimized with distances transferred from the full surface matched with those on the partial surface. This loss generalises the one proposed in  by incorporating masking weights. We provide full details on how to derive this loss in the supplementary material Appendix B.3.

In our experiments, we found that the binary criterion can be relaxed to better use the interaction between pairs. Many inconsistent pairs have distances only slightly increased by the presence of holes, thus, filtering them out removes valuable, though slightly noisy, information. We propose to regularize the binary mask matrix into a soft mask \(^{s}\) as follows,

\[^{s}_{ij} = (_{ij}}{(_{^{}})_{ij }},1).\] (8)

The weights of the soft mask matrix inhibit the contribution to the loss of non-guaranteed pairs whose distance is significantly larger than the theoretical threshold of our criterion \(}_{}\). By the same token, it preserves the influence of distances of non-guaranteed pairs which are near the threshold.

#### 4.2.2 Implementation Considerations

We evaluate the new geometric-wormhole loss, \(_{}\), by integrating it into a pipeline adapted from , replacing their primary loss component, first introduced in . Our pipeline takes raw input

Figure 5: MDS embedding of various manifold learning methods on a whole Swiss roll (top) and on two versions of it with Gaussian noise, having either a rectangular hole (middle) or a rectangular cut (bottom). Other methods are referred to in Figures 7 and 8 in Appendix B.1.

features and then refines them independently for the surfaces using a shared-weights neural network, DiffusionNet . These refined features are then matched using Softmax similarity [7; 18] to directly compute a correspondence matrix \(\), which is then plugged into the geometric-wormhole loss. We keep the regularization loss  promoting the preservation of vertex area between corresponding vertices, which is computed with the functional map extracted from the correspondence matrix. We provide further details of the proposed pipeline and implementation details in the supplementary material Appendix B.4.

#### 4.2.3 Evaluation

**Datasets.** We evaluate our method on the benchmarks SHREC'16  and PFAUST . SHREC'16 includes two datasets, CUTS and HOLES. Both datasets contain processed figures from the TOSCA  dataset. In CUTS, the figures were cut using several 3D planes. In HOLES, besides the cuts made by the planes, additional holes were added, resulting in partial surfaces with more topological changes and a longer boundary, which makes this dataset particularly harder for shape correspondence. The second benchmark on which we evaluate our method is PFAUST, recently created by . It contains figures from the FAUST-Remeshed dataset  that were processed by creating holes in them. This benchmark is also divided into two datasets; in PFAUST-M, there are bigger but fewer holes, and in the PFAUST-H, there are smaller but more numerous holes. The latter presents a harder task for shape correspondence, as a greater number of holes results in more significant changes in the topology.

**Baselines.** The baseline methods we evaluated fall into three categories: Axiomatic methods - PFM  and FSP , supervised methods - GeomFMaps  and DPFM , which is the current SOTA for the CUTS and PFAUST datasets, and unsupervised methods - unsupervised DPFM , RobustFmaps , and DirectMatchNet , which is the current SOTA for the HOLES and the unsupervised SOTA on the PFAUST datasets. We had to re-implement the loss function for unsupervised DPFM due to source code unavailability. Recently, the authors of RobustFmaps updated their models to include a pretraining phase including four external datasets. For completeness, we include this pretrained version in our results table, albeit we separate it from the other methods not using any external datasets. For fairness, we also provide the results of RobustFmaps when trained only on HOLES or CUTS without any pretraining, following the common protocol of the benchmarks. For post-processing refinement, we employed either Zoom-out  or test time adaptation refinement  depending on what the original papers used.

   Test-set & CUTS & HOLES \\  Training-set & CUTS & HOLES & CUTS & HOLES \\   \\  PFM \(\)Zoomout &  &  \\ FSP \(\)Zoomout &  &  \\   \\  GeomFMaps \(\)Zoomout & 12.8 \(\) 10.4 & 19.8 \(\) 16.7 & 20.6 \(\) 17.4 & 15.3 \(\) 13.0 \\ DPFM \(\)Zoomout & 3.2 \(\) 1.8 & 8.6 \(\) 7.4 & 15.8 \(\) 13.9 & 13.1 \(\) 11.9 \\   \\  RobustFMnet with Refinement  & 3.2 & 5.6 & 13.5 & 8.2 \\   \\  Unsupervised-DPFM \(\)Zoomout & 11.8 \(\) 12.8 & 19.5 \(\) 18.7 & 19.1 \(\) 18.3 & 17.5 \(\) 16.2 \\ RobustFMnet \(\)Refinement & 16.9 \(\)10.6 & 22.7\(\)16.6 & 18.7 \(\) 16.2 & 23.5 \(\) 18.8 \\ DirectMatchNet \(\)Refinement & **6.9**\(\) 5.6 & 12.2 \(\) 8.0 & **14.2**\(\) **10.2** & 11.4 \(\) 7.9 \\ DirectMatchNet LPF \(\)Refinement & 7.1 \(\) 4.7 & **8.6**\(\) **5.5** & 16.4 \(\) 11.6 & 12.3 \(\) 8.6 \\ Wormhole (Ours)\(\)Refinement & **6.9**\(\) **4.3** & 10.8 \(\) 7.2 & 17.1 \(\) 10.9 & **10.9**\(\) **6.6** \\   

Table 2: Quantitative analysis on SHREC’16 . The numbers represent the average geodesic error (multiplied by 100) of the results following post-processing refinement. The best performance is highlighted in bold, and the second best is underlined. These results underscore the proposed method’s dominance in unsupervised shape matching. It surpasses both supervised, unsupervised, and pretrained methods on the HOLES benchmark, known for its highly challenging scenarii.

**Results.** The quantitative results shown in Tables 2 and 3 indicate that our method reaches state-of-the-art performance for unsupervised partial shape correspondence. We also display superior qualitative performance in Figure 6 and Appendix B.5, demonstrating our method's robustness to missing parts. Indeed, unlike other methods our mappings are hardly distorted at challenging locations, such as points close to boundaries. A major improvement over other approaches was in the more challenging datasets HOLES, PFAUST-H, and PFAUST-M, whereas in the CUTS dataset a relatively modest improvement is shown. The missing parts in the CUTS dataset were created by slicing figures with 3D planes. In practice, this procedure does not modify much the topology of the surface and it does not introduce many inconsistent pairs. As such, cuts mostly preserve all geodesic distances, thus, our novel loss function was almost identical to the one in Equation (6) . On the more challenging datasets, a larger part of the inter-geodesic distances differ between the partial and full surfaces, enabling our method to demonstrate its strength, even in comparison to supervised methods or pretrained models on external datasets. In fact, our unsupervised approach demonstrates superior performance to the best supervised approaches on the HOLES and PFAUST-H benchmarks.

**Ablation study.** To evaluate which criterion, ours \(_{}\) or the more conservative \(_{}\)[12; 46], leads to better masks for partial shape correspondence, we compare masking strategies on the HOLES dataset in the following setting: Binary mask from \(_{}\)[12; 46], non-binary mask from \(_{}\)[12; 46], our binary mask, and our non-binary mask. As can be seen in Table 4, learning with masks derived from our wormhole criterion surpass the alternatives for partial shape correspondence, showing the importance of less restrictive criteria to find consistent distances between pairs of points.

## 5 Conclusion

In this paper, we analyzed invariant properties of geodesic distances between partial and full surfaces. Following it we developed an improved criterion for identifying _consistent_ pairs - pairs where the geodesic distance remains consistent between the partial and full surfaces. Our improved criterion

    & & PFAUST-M & PFAUST-H \\  Supervised & DPFM  & 3.0 & 6.8 \\   & Unsupervised-DPFM  & 9.3 & 12.7 \\  & RobustFMnet  & 7.9 & 12.4 \\   & DirectMatchNet  & 5.1 & 7.9 \\   & Wormhole (Ours) & **4.6** & **6.7** \\   

Table 3: Quantitative results on PFAUST . The numbers indicate average geodesic error (\( 100\)). Our method surpasses previous unsupervised shape correspondence methods on the medium and hard datasets, and is on par with the supervised method on the hard dataset. The largest improvement is on the hard dataset, showing robustness to topological changes due to missing parts of the surface.

Figure 6: Qualitative results on the test set of PFAUST-H. Our method yields less distortions near boundaries demonstrating its robustness to missing parts.

finds consistent pairs, or _guarantees_ them, if the distance between two points on the partial surface is, for all couple of boundary points, smaller than the the sum of distances to the boundary points and of the distance in the embedding space between these boundary points, which is given by the straight line for Euclidean embeddings. We used this criterion to tackle the complex challenge of partial shape correspondence, by incorporating our guaranteed pairs in a novel unsupervised loss function specially designed to handle partial surfaces. With this loss function, our method demonstrated SOTA results on reference partial shape correspondence benchmarks, namely the SHREC'16 CUTS and HOLES and the recent PFAUST dataset.

**Limitations.** Our paper presents a novel criterion for finding consistent pairs in partial surfaces. However, it is still not able to recover all consistent pairs in general surfaces, meaning that some information that would be useful for partial shape matching is discarded. We suspect there could exist even less restrictive criteria for finding consistent geodesic distances in the presence of holes and cuts. The exploration of such criteria is left for future research. Additionally, finding boundaries in higher dimensions should be addressed with care, and operating in the embedding space in higher dimensions would not be as forgiving as what we have done for 2D surfaces in \(^{3}\). In this work, we focused on partial-to-full shape matching. Although the wormhole criterion can be used to find consistent pairs on each shape independently, we would also need to find the shared consistent pairs for matching the shapes. Designing a full pipeline for partial-to-partial shape matching with our criterion is left for future work.