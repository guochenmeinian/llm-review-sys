# Detecting and Measuring Confounding Using Causal Mechanism Shifts

Abbavaram Gowtham Reddy

Indian Institute of Technology Hyderabad

cs19resch11002@iith.ac.in

&Vineeth N Balasubramanian

Indian Institute of Technology Hyderabad

vineethnb@iith.ac.in

###### Abstract

Detecting and measuring confounding effects from data is a key challenge in causal inference. Existing methods frequently assume causal sufficiency, disregarding the presence of unobserved confounding variables. Causal sufficiency is both unrealistic and empirically untestable. Additionally, existing methods make strong parametric assumptions about the underlying causal generative process to guarantee the identifiability of confounding variables. Relaxing the causal sufficiency and parametric assumptions and leveraging recent advancements in causal discovery and confounding analysis with non-i.i.d. data, we propose a comprehensive approach for detecting and measuring confounding. We consider various definitions of confounding and introduce tailored methodologies to achieve three objectives: (i) detecting and measuring confounding among a set of variables, (ii) separating observed and unobserved confounding effects, and (iii) understanding the relative strengths of confounding bias between different sets of variables. We present useful properties of a confounding measure and present measures that satisfy those properties. Our empirical results support the usefulness of the proposed measures.

## 1 Introduction

Understanding the underlying causal generative process of a set of variables is crucial in many scientific studies for applications in treatment and policy designs . While randomized controlled trials (RCTs) and causal inference through active interventions are ideal choices for understanding the underlying causal model , RCTs and/or active interventions are often impossible/infeasible, and some times unethical . Research efforts in causal inference hence rely on observational data to study causal relationships . However, recovering the underlying causal model purely from observational data is challenging without further assumptions; this challenge is further exacerbated in the presence of unmeasured confounding variables.

A confounding variable is a variable that _causes_ two other variables, resulting in a spurious association between those two variables. As exemplified with _Simpson's paradox_ and many other studies , the presence of confounding variables is an important quantitative explanation for why _correlation does not imply causation_. It is challenging to observe and measure all confounding variables in a scientific study . Identifying _latent_ or _unobserved_ confounding variables is even more challenging, and misinterpretation presents various challenges in downstream applications, such as discovering causal structures from observational data. Numerous methods operate under the assumption of _causal sufficiency_, implying the non-existence of unobserved confounding variables. Causal sufficiency presupposes that all pertinent variables required for causal inference have been observed. However, this may not be a practical or testable assumption.

The study of confounding has various applications, chief among them being causal discovery - identifying the causal relationships among variables . It is also useful for determining whether a set of observed confounding variables is sufficient to adjust for estimating causal effects , measuring the extent to which statistical correlation between variables can be attributed to confounding [24; 25; 62], and verifying the comparability of treatment and control groups in non-randomized interventional studies .

A fundamental problem in causal inference tasks lies in detecting hidden confounding variables from observational data alone. However, this is non-trivial and poses various challenges. For example, a key issue is that given a marginal distribution over observed variables, there are infinitely many joint distributions corresponding to causal graphs involving unobserved variables . To tackle such challenges, recent endeavors show that using data from different environments helps in improved causal discovery [40; 38; 33; 45; 23], detecting causal mechanism shifts , and detecting unobserved confounding [29; 38]. However, such recent efforts often subsume confounding detection under causal discovery, focusing primarily on identifying confounding factors while overlooking other useful information, such as the relative strength of confounding between variable sets and the distinction between observed and unobserved confounding within a variable set. We seek to address these gaps in this work.

We focus exclusively on the problem of studying confounding from multiple perspectives, including (i) detecting and measuring confounding among a set of variables, (ii) assessing the relative strengths of confounding among different sets of observed variables, and (iii) distinguishing between observed and unobserved confounding among a set of variables. _The primary focus of causal inference often lies in verifying the presence or absence of confounding rather than determining the exact value of the measured confounding. However, we leverage the measured confounding to assess the relative strengths of confounding between sets of variables. To achieve the above objectives, we utilize data from various contexts, where each context results from shifts in the causal mechanisms of a set of variables [38; 45]._ This allows us to propose different measures of confounding based on the available context information. Our contributions can be summarized as follows.

* For various definitions of confounding, we propose corresponding measures of confounding and present useful properties of the proposed measures. To our knowledge, this is the first comprehensive study that examines various aspects of observed and unobserved confounding using data from multiple contexts without making parametric or causal sufficiency assumptions.
* We study pair-wise confounding, confounding among multiple variables, how to separate unobserved confounding from overall confounding, and present ways to assess relative confounding.
* We present an algorithm for detecting and measuring confounding using data from multiple contexts. Experimental results are performed to verify theoretical analysis.

## 2 Related Work

The study of confounding has typically been embedded as part of causal discovery algorithms in most existing work. Causal discovery methods can be categorized according to several criteria, including the type of data utilized (observational versus interventional/experimental), parametric versus non-parametric approaches, or whether they relax causal sufficiency assumptions [65; 59]. Considering our focus in this work on studying confounding comprehensively by going beyond observed confounding variables, we discuss literature that are directed towards methods that relax the causal sufficiency assumption and rely on experimental data.

**Causal Discovery via Observational Data, Relaxing Causal Sufficiency:** Constraint based causal discovery algorithms produce equivalence class of graphs that satisfy a set of conditional independence constraints [60; 11; 9; 42]. Other methods such as [2; 28; 27] reduce the problem complexity by assuming a parametric form of the underlying causal model (e.g., variables are jointly Gaussian in Chandrasekaran et al. ), thereby returning unique causal graphs. Nested Markov Models (NMMs) [56; 57; 49; 14] allow identifiability of causal models with latent factors by using (pairwise) Verma constraints. A recent approach using differentiable causal discovery  combines NMMs with the differentiable constraint  to discover a partially directed causal network and likely confounded nodes. Unlike these methods, our focus in this work is on detecting and measuring confounding under various settings, instead of recovering the entire causal graph or equivalence class.

**Causal Discovery Using Data From Multiple Environments:** Given access to a set of observed confounding variables, very recent work  presented testable conditional independence tests that are violated only when there is unobserved confounding. However, their analysis is focused towards the downstream causal effect estimation. We aim to provide a unified framework for studying and measuring confounding under different types of contextual information available.

Other methods [33; 23] learn an equivalence class of graphs when data from observational and interventional distribution are available. Confounding has also shown to be detected in linear models with non-Gaussian variables . In linear models, a spectral analysis method was proposed in  to understand to what extent the statistical correlation between a set of variables on a target variable can be attributed to confounding. See Tab. 4 of  for an overview of causal discovery methods that use data from multiple environments or contexts. Under the specific assumptions of causal sufficiency and sparse mechanism shift, a method was proposed in  to reduce the size of a given Markov equivalence class using mechanism shift score. A differentiable causal discovery method was proposed in  to use interventional data to recover interventional Markov equivalence class. While these methods use data from different contexts, they assume the absence of unobserved confounding variables; we instead focus on capturing both observed and unobserved confounding.

**Measuring and Interpreting Confounding:** Earlier efforts in the field have studied different measures for observed confounding, each tailored to address specific challenges [44; 15; 35; 3; 39; 30; 43; 34]. Such measures have also been refined to address specific issues [24; 54]; for e.g., a method to correct the non-linearity effect present in confounding estimates via the exposure-outcome association with and without adjustment for confounding was proposed in . In contrast, we measure the effects of both observed and _unobserved_ confounding. Motivated from the _ignorability_ property in potential outcomes framework [61; 26], the divergence between nominal and complete propensity density has been considered as an indicative of hidden confounding . To the best of our knowledge, the efforts closest to ours are [38; 40], which study confounding using data from multiple contexts without the causal sufficiency assumption. However, they _do not measure confounding_ and detect confounding only as a step to discover the causal graph. Ours is a more general framework for studying and measuring confounding from multiple perspectives.

In regression models, certain difference thresold between the coefficients of treatment variable before and after adjusting for the possible confounding is considered as the indication for the presence of confounding. This process of choosing a threshold is also called _change-in-estimate_ criterion. Typical threshold used in literature is \(10\%\)[54; 32; 5].

## 3 Background and Problem Setup

Let \(\) be a set of observed variables and \(\) be a set of unobserved or latent variables. The values of \(,\) can be real, discrete, or mixed. Let \(\) be the underlying directed acyclic graph (DAG) among the variables \(=\). Directed edges among the variables in \(\) indicate direct causal influences. Assume that the set of unobserved variables \(\) are jointly independent and are exogenous to \(\) (i.e., \(Z_{i} Z_{j}\) and \(X_{k} Z_{j}\ \  i,j,k\)). In this setting, any two nodes \(X_{i},X_{j}\) sharing a common parent \(Z_{k}\) are said to be confounded, and \(Z_{k}\) is said to be a confounding variable. For a node \(X_{i},_{i}=\{X_{j}|X_{j} X_{i}\}\{Z _{j}|Z_{j} X_{i}\}\) denotes the set of parents of \(X_{i}\).

For a node \(X_{i}\), \((X_{i}|_{i})\) is called the _causal mechanism_ of \(X_{i}\). The causal mechanism \((X_{i}|_{i})\) encodes how the variable \(X_{i}\) is influenced by its parents \(_{i}\). Following earlier work [22; 38; 45; 21; 46; 52], we make the following general assumption about the underlying causal mechanisms of data.

**Assumption 3.1**.: _(Independent Causal Mechanisms [44; 47]) A change in \((X_{i}|_{i})\) has no effect on and provides no information about \((X_{j}|_{j})\  j i\)._

Identifying confounding from only observational data is challenging without further assumptions . Hence, following earlier work [38; 29; 40], we assume that the data over the variables \(\) is observed over multiple _contexts or environments_. While there are various ways of formulating/constructing contexts, in this paper, we assume that each context is created as a result of either _hard (a.k.a. structural)_ interventions or _soft (a.k.a. parametric)_ interventions on a subset \(_{S}\) of variables where \(S\) is a set of indices. Performing hard intervention on a variable \(V_{i}\) is the same as setting the value of \(V_{i}\) to a value \(v_{i}\). Hard intervention on a variable \(V_{i}\) removes the influence of its parents \(_{i}\) on \(V_{i}\). Performing soft intervention on a variable \(V_{i}\) is the same as changing the causal mechanism of \(V_{i}\), \((V_{i}|_{i})\), with a new causal mechanism \(}(V_{i}|_{i})\). Soft intervention on a variable \(V_{i}\) does not remove the influence of its parents \(_{i}\) on \(V_{i}\). The idea of explicitly considering context information and using different contexts as context variables to create extended causal graphs has been studied in the literature. Context variables are also called as _policy variables, decision variables, regime variables, domain variables, environment variables, etc._[40; 45; 17; 22].

Let \(=\{c_{1},c_{2},,c_{n}\}\) be the set of \(n\) contexts and let \(^{c}(),c\), denotes the probability distribution of the observed variables \(\) in the context \(c\). Let \(_{S R}\), where \(S,R\) are sets of indices, be the set of contexts in which we observe mechanism changes for the set of variables \(_{S R}\). Similarly, let \(_{S R}\) be the set of contexts in which we observe mechanism changes for the set of variables \(_{S}\) but not for the variables \(_{R}\). We say that the causal mechanism of a variable \(X_{i}\) changes between two contexts \(c,c^{}\) if \(^{c}(X_{i}|_{i})^{c^{}}(X_{i}|_{i})\). Given the data over observed variables in each context, there exist methods for detecting mechanism shifts of each variable between the contexts [36; 38; 45; 37]. For example, the \(p\)-value\((^{c}(X_{i}|_{i}^{o})^{c^{}}(X_{i}| _{i}^{o}))\) where \(_{i}^{o}\) is the set of observed parents of \(X_{i}\) can be used to detect mechanism change for \(X_{i}\) between the contexts \(c,c^{}\)[36; 36]. Hence, we focus on detecting and measuring confounding among a set of variables, assuming that the causal mechanism shifts are observed among that set of variables.

Context information is not very useful if there is no restriction on how causal mechanisms are changed between the contexts [45; 38]. For example, the causal mechanisms of \(X_{i}\) and \(X_{j}\) both differing across all (or no) contexts would trivially satisfy Assumption 3.1, but reveal no information about the underlying causal mechanisms [10; 38]. Hence, following earlier work [45; 38; 17], we make the following assumptions.

**Assumption 3.2**.: _(Sparse Causal Mechanism Shift ) Causal mechanisms of variables change sparsely across contexts, i.e., if \(p(^{c}(X_{i}|_{i})^{c^{}}(X_ {i}|_{i}))\), then \(0<p<0.5;\;\;\; c,c^{}\)._

Assumption 3.2 implies that the causal mechanisms change infrequently across contexts. This assumption is more general because, in many scientific studies, for any given context, interventions typically affect only a few variables .

**Assumption 3.3**.: _(Markov Property under Mechanism Shifts ) The distribution \(()\) is given by \(()=^{C}()d(C)=_{ }^{C}(V_{i}|_{i})d(C)\). In other words, variables \(\) are assumed to be conditionally exchangeable, so that the same graph \(\) applies in every context \(c\)._

**Assumption 3.4**.: _(Causal Sufficiency Over \(\)) All common parents of any pair of observed nodes belong to the set \(\). In other words, all relevant variables for detecting confounding and the unobserved confounding variables are already present in \(\)._

_Problem Statement: Given data over the observed variables \(\) in multiple contexts, each context resulting from a sparse causal mechanism shift of variables in \(\), (i) can we identify which pairs or sets of variables are confounded and can we measure the confounding strength? (ii) can we isolate the confounding effects of observed and unobserved confounding variables? and (iii) can we study the relative strengths of confounding among different sets of variables?_

To address the above problem, in the next section, we consider various definitions of confounding and present appropriate confounding measures depending on the context information available.

## 4 Detecting and Measuring Confounding

In this section, we present methods for detecting and measuring confounding for various scenarios in which shifts in causal mechanisms are observed. Considering any three observed variables \(X_{i},X_{j},X_{o}\) and an unobserved confounding variable \(Z\), we present measures of confounding depending on the information about mechanism shifts of \(X_{i},X_{j},X_{o},Z\). Each of the following subsections includes: (i) a definition of confounding, (ii) a corresponding definition of the confounding measure, (iii) a method for isolating the unobserved confounding measure from the overall confounding, (iv) an extension of the confounding measure to more than two variables, and (v) key properties of the proposed confounding measures. See Tab. 1 and Fig. 1 for an overview.

### Setting 1: Measuring Confounding Using Directed Information Between \(X_{i},X_{j}\).

In this setting, we use the fact that directed information does not vanish in the presence of a confounding variable [64; 48]. To this end, we leverage the interventional effects of \(X_{i},X_{j}\) on each other to define a measure of confounding.

  
**Settings** & **Confounding Definition** & **Regular Context** & **Type of** \\
**Based On** & **Information** & **Intervention** \\ 
1 & Directed Information  \& & \(_{\{i\} P_{ij}}\) & Hard / Structural \\  & Noncollapsibility [15; 43; 54] & \(_{\{j\} P_{ij}}\) & \\ 
2 \& 3 & Mutual Information & \(_{\{j\}\{j\}}\) & Soft / Parametric \\   

Table 1: Summary of the various settings for detecting and measuring confounding between \(X_{i},X_{j}\). Here \(P_{ij}\) is the set of node indices that belong to a path from \(X_{i}\) to \(X_{j}\) including \(j\).

**Definition 4.1**.: _(Directed Information ). The directed information \(I(X_{i} X_{j})\) from \(X_{i}\) to \(X_{j}\) is defined as the conditional Kullback-Leibler divergence between the distributions \((X_{i}|X_{j}),(X_{i}|do(X_{j}))\). That is:_

\[I(X_{i} X_{j}) D_{KL}((X_{i}|X_{j})||(X_{i}|do (X_{j})))_{(X_{i},X_{j})}(X_ {i}|X_{j})}{(X_{i}|do(X_{j}))}\] (1)

**Definition 4.2**.: _(No Confounding ) When measuring the causal effect of a (treatment) variable \(X_{i}\) on a (target) variable \(X_{j}\), the ordered pair \((X_{i},X_{j})\) is unconfounded if and only if the directed information from \(X_{j}\) to \(X_{i}\): \(I(X_{j} X_{i})\) is zero. Equivalently, \((X_{j}|X_{i})=(X_{j}|do(X_{i}))\)._

A similar definition of confounding that relates the conditional distribution \((X_{i}|X_{j})\) and interventional distribution \((X_{i}|do(X_{j}))\) is defined as follows.

**Definition 4.3**.: _(Noncollapsibility)  The statistical association between two variables \(X_{i}\) and \(X_{j}\) is said to be noncollapsible if the association strength differs in each level/strata of other variable \(X_{k}\). That is, if \(X_{k}\) is a confounding variable between \(X_{i},X_{j}\), we have \((X_{j}|X_{i})(X_{j}|do(X_{i}))=_{X_{k}}( (X_{j}|X_{i},X_{k}))\)._

From Defns. 4.1 and 4.2, for a pair of variables \((X_{i},X_{j})\), observing \(I(X_{j} X_{i})>0\) and \(I(X_{i} X_{j})>0\) implies that \((X_{j}|do(X_{i}))(X_{j}|X_{i})\) and hence the presence of confounding (see Tab. 2). Using the above properties of directed information, we measure _confounding_ as follows.

**Definition 4.4**.: _(Confounding Measure 1) When causal mechanism shifts of two variables \(X_{i},X_{j}\) are observed, resulting in different contexts, under the Assumptions 3.2-3.4, the measure of confounding \(CNF\)-\(1(X_{i},X_{j})\) between \(X_{i}\) and \(X_{j}\) is defined as follows._

\[CNF1(X_{i},X_{j}):=1-e^{-(I(X_{i} X_{j}),I(X_{j} X_{i} ))}\] (2)

For all the confounding measures, we use exponential transformation to limit the range of the measure between \(0\) and \(1\). Note that in a DAG, one of \(I(X_{i} X_{j})\), \(I(X_{j} X_{i})\) is zero under no confounding (see Tab. 2 for a simple example with two and three node graphs). Hence \(CNF\)-\(1(X_{i},X_{j})\) outputs zero when there is no confounding between \(X_{i},X_{j}\). Similarly \(CNF\)-\(1(X_{i},X_{j})\) outputs positive real value in the range \((0,1]\) when there is confounding. We leverage data from multiple contexts to evaluate \((X_{i}|X_{j})\) and \((X_{i}|do(X_{j}))\) as follows. In this setting, we assume each context is generated as a result of _hard_ interventions on a subset of variables. Let \(P_{ij}\) be the set of node indices that belong to a path from \(X_{i}\) to \(X_{j}\) including \(j\), we use the contexts \(_{\{i\} P_{ij}}\) to evaluate \((X_{j}|do(X_{i}))\) as \((X_{j}|do(X_{i}))=_{c_{\{i\} P_{ ij}}}[^{c}(X_{j}|X_{i})]\). Intuitively, to compute the interventional effects of \(X_{i}\) on \(X_{j}\), we need to observe mechanism changes only for \(X_{i}\) to account for the potential causal influence from \(X_{i}\) to \(X_{j}\). In addition, none of the nodes in a causal path from \(X_{i}\) to \(X_{j}\) should be intervened. We use observational data to evaluate \((X_{j}|X_{i})\).

Figure 1: **Setting 1: When contexts \(_{\{i\} P_{ij}}\) and \(_{\{j\} P_{ji}}\) are known where \(P_{ij}\) is the set of node indices that belong to a path from \(X_{i}\) to \(X_{j}\) including \(j\), we leverage directed information from \(X_{i}\) to \(X_{j}\) and from \(X_{j}\) to \(X_{i}\) to define a measure of confounding (Defn. 4.4). Setting 2: Causal mechanism changes in \(Z\) introduces dependencies on the observed distributions of \(X_{i},X_{j}\). We leverage such dependencies to measure confounding when contexts \(_{\{i\}\{i\}}\) are known (Defn. 4.6). Setting 3: If we know that there is a causal path from \(X_{i}\) to \(X_{j}\), we leverage dependencies between the pairs \((X_{i},X_{j})\) and \((Z,X_{j})\) to measure confounding. Similarly, if we know that there is a causal path from \(X_{j}\) to \(X_{i}\), we leverage dependencies between the pairs \((X_{i},X_{j})\) and \((Z,X_{i})\) to measure confounding (Defn. 4.7). Dashed arrows from \(Z\) indicate that \(Z\) is unobserved.**

**Proposition 4.1**.: _(**Identifiability of \((X_{j}|do(X_{i}))\)**) \((X_{j}|do(X_{i}))\) is identifiable from the set of contexts \(_{\{i\} P_{ij}}\). To detect and measure confounding between a pair of nodes \(X_{i}\), \(X_{j}\), it is enough to observe two sets of contexts \(_{\{i\} P_{ij}}\) and \(_{\{j\} P_{ji}}\). Thus, \(n\) sets of contexts are needed to detect and measure confounding between \(\) distinct pairs of nodes in a causal DAG with \(n\) nodes._

When a confounding variable \(X_{o}\) between \(X_{i},X_{j}\) is observed, and there may exist an unobserved confounding variable \(Z\), it is crucial to detect and measure unobserved confounding effect . We utilize conditional directed information to define the measure of unobserved confounding.

**Definition 4.5**.: _(**Conditional Directed Information ). The conditional directed information \(I(X_{i} X_{j}|X_{o})\) from \(X_{i}\) to \(X_{j}\) conditioned on \(X_{o}\) is defined as the conditional Kullback-Leibler divergence between the distributions \((X_{i}|X_{j},X_{o}),(X_{i}|do(X_{j}),X_{o})\) as follows._

\[I(X_{i} X_{j}|X_{o}) D_{KL}((X_{i}|X_{j},X_{o})|| (X_{i}|do(X_{j}),X_{o}))(X_{i},X_{j},X _{o})}{}(X_{i}|X_{j},X_{o})}{(X_{i}|do( X_{j}),X_{o})}\] (3)

This measure can trivially be extended to the case where there exist multiple observed and unobserved confounding variables. The expression \((X_{i}|do(X_{j}),X_{o})\) means conditioning on \(X_{o}\) in the interventional distribution \((X_{i}|do(X_{j}))\). Now, the conditional confounding can be measured as:

\[CNF1(X_{i},X_{j}|X_{o}) 1-e^{-(I(X_{i} X_{j}|X_{o}),I(X_{j} X_{i}|X_{o}))}\] (4)

Intuitively, by conditioning on an observed confounding variable \(X_{o}\), we control the association between \(X_{i},X_{j}\) flowing via \(X_{o}\) and measure the influence via the unobserved confounding variables.

**Beyond Pairwise Confounding:** We now study when a set \(_{S}\) of variables where \(|_{S}|>2\) are jointly confounded i.e., share a common confounding variable and how to measure the joint confounding among the variables \(_{S}\).

**Theorem 4.1**.: _A set of observed variables \(_{S}\) are jointly unconfounded if and only if there exists three variables \(X_{i},X_{j},X_{k}_{S}\) such that \(I(X_{i} X_{j}|X_{k})=I(\{X_{i},X_{k}\} X_{j})\)._

We now define the measure of confounding among the variables in \(_{S}\) as follows.

\[CNF1(_{S})=_{i S}CNF1(_{S \{i\}},X_{i})\] (5)

Conditional confounding among a set of variables can be defined similarly to Eqn. 4. We now study some useful properties of the measure \(CNF1\).

**Theorem 4.2**.: _For any three observed variables \(X_{i},X_{j},X_{o}\) and an unobserved confounding variable \(Z\), the following statements are true for the measure \(CNF1\)._

1. _(_**Reflexivity and Symmetry.**_)_ \(CNF1(X_{i},X_{i}|X_{o})=0\)_,_ \(CNF1(X_{i},X_{j}|X_{o})=CNF1(X_{j},X_{i}|X_{o})\)_._
2. _(_**Positivity.**_)_ \(CNF1(X_{i},X_{j})>0\) _if and only if_ \(X_{i},X_{j}\) _are confounded. Given an observed confounding variable_ \(X_{o}\) _between_ \(X_{i},X_{j}\)_,_ \(CNF1(X_{i},X_{j}|X_{o})>0\) _if and only if there exists an unobserved confounding variable_ \(Z\) _between_ \(X_{i},X_{j}\)_._
3. _(_**Monotonicity.**_)_ \(CNF1(X_{i},X_{j})>CNF1(X_{k},X_{l})\) _implies that the pair of variables_ \(X_{i},X_{j}\) _are more strongly confounded than the pair of variables_ \(X_{k},X_{l}\) _in the sense of Defns._ 4.2 _and_ 4.3_._

### Setting 2: Detecting and Measuring Confounding Using the Mechanism Shifts of \(Z\).

The previous setting utilizes the interventional effects of \(X_{i}(X_{j})\) on \(X_{j}(X_{i})\) to define a measure of confounding between \(X_{i},X_{j}\). In this setting, we utilize the association between the observed marginal distributions of \(X_{i},X_{j}\) under causal mechanism shifts of \(Z\) to measure confounding. To this end, similar to , we make the following assumption.

**Assumption 4.1**.: _(**Shift Faithfulness **) Let \(Z\) be a common parent for a set of variables \(_{S}\). Then each causal mechanism shift in \(Z\) between two contexts \(c,c^{}\) entails a causal mechanism change in each \(X_{i}_{S}\) between the same contexts \(c,c^{}\)._

One consequence of the Assumption 4.1 is that a change in the causal mechanism of \(Z\) induces correlations between the expectations of \(X_{i},X_{j}\) in different contexts. To understand this, consider the following structural equations.

\[Z((c),^{2}(c)) X_{i} Z+ _{i} X_{j} X_{i}+ Z+_{j}\] (6)Where \(c\) denotes the context and \(_{x}\) and \(_{y}\) are noise variables with zero mean and have no additional restriction on the underlying probability distribution. The causal graph corresponding to this model has the nodes \(X_{i},X_{j},Z\) and edges: \(Z X_{i},Z X_{j},X_{i} X_{j}\). It is easy to see that \((X_{i})=(c)\) and \((X_{j})=(+)(c)\). Following Assumption 4.1, whenever there is a change in causal mechanism of \(Z\) (e.g., \(c\) changes to \(\) in Eqn. 6), there is a change in both \((X_{i}),(X_{j})\). Additionally, since \(Z\) is a common cause of both \(X_{i},X_{j}\), there is a spurious association between \((X_{i}),(X_{j})\). Subsequently, in the set of contexts \(_{\{i\}\{j\}}\) the values \((X_{i})\), \((X_{i})\) are spuriously associated. Under Assumptions 3.2 and 4.1, restricting our analysis to \(_{\{i\}\{j\}}\) ensures that with high probability, the association between \((X_{i})\), \((X_{i})\) is due to the confounding variable \(Z\). In this example, the association between \((X_{i}),(X_{j})\) exists even if \(=0\), i.e., \(X_{i} X_{j}\). To define confounding measure, we create two random variables \(E_{i}^{C},E_{j}^{C}\) which we define as \(E_{i}^{C}=_{X_{i}^{c}(X_{i})}(X_{i}),E_{j}^{C}=_{X_{j}^{c}(X_{j})}(X_{j})\) respectively where \(c_{\{i\}\{j\}}\). Relying on the context information \(_{\{i\}\{j\}}\) and utilizing the association between \(E_{i}^{C}\) and \(E_{j}^{C}\), we define a confounding measure as follows.

**Proposition 4.2**.: _(Confounding Based on Mutual Information) If two variables \(X_{i},X_{j}\) are confounded by a variable \(Z\), the induced random variables \(E_{i}^{C},E_{j}^{C}\) as described above have non zero mutual information \(I(E_{i}^{C};E_{j}^{C})\)._

**Definition 4.6**.: _(Confounding Measure 2) When the causal mechanism shifts are observed for \(X_{i},X_{j}\) in different contexts and the contexts \(_{\{i\}\{j\}}\) are known, under the Assumptions 3.2-4.1, the measure of confounding \(CNF\)-\(2(X_{i},X_{j})\) between \(X_{i}\) and \(X_{j}\) is defined as_

\[CNF2(X_{i},X_{j}):=1-e^{-I(E_{i}^{C};E_{j}^{C})}\] (7)

To measure the unobserved confounding strength when we already observe a confounding variable \(X_{o}\), we condition on the observed confounding variable \(X_{o}\) to define \(CNF\)-\(2(X_{i},X_{j}|X_{o})\) as follows.

\[CNF2(X_{i},X_{j}|X_{o}):=1-e^{-I(E_{i}^{C};E_{j}^{C}|X_{o})}\] (8)

**Beyond Pairwise Confounding:** Following earlier work , we utilize total correlation among triplets \((E_{i}^{C},E_{j}^{C},E_{k}^{C})\) of random variables in \(\{E_{i}^{C}\}_{i S}\) to verify whether a set of variables \(_{S}\) are jointly confounded. By Assumption 4.1, we know that the variables in \(_{S}\) jointly confounded only if each pair \(X_{i},X_{j};\;\;i,j S\) is pairwise confounded. If all three variables share the same latent confounding variable \(Z\), then knowing about one of \(E_{i}^{C},E_{j}^{C},E_{k}^{C}\) explains away some of the association between the other two, so that we have \(I(E_{i}^{C},E_{j}^{C}|E_{k}^{C})<I(E_{i}^{C},E_{j}^{C})\). However, for a triplet \((X_{i},X_{j},X_{k})\), it is possible that, rather than jointly confounded, there may be three disjoint confounding variables \(Z_{12},Z_{13},Z_{23}\) confounding each of the individual pairs: \((X_{i},X_{j}),(X_{j},X_{k}),(X_{k},X_{i})\). In general, for a set of variables of size \(s\) to permit such an equivalent explanation, we would need to have a total of \(\) confounding variables with \(s(s-1)\) outgoing edges to obtain the same structure of pairwise confounding . While this may plausibly occur for small sets of variables that appear to be pairwise correlated, we assume the true graph \(\) to be causally minimal in the following sense.

**Assumption 4.2**.: _(Confounder Minimality ) For every subset \(_{S}\) of at least \(|S| 4\) variables, there are at most \(2|S|\) edges incoming into \(_{S}\) from latent confounding variables with at least three children in \(_{S}\)._

Assumption 4.2 ensures that variables that appear to be jointly confounded are indeed confounded. In other words, when a small number of latent variables suffice to explain the observed correlations, there should indeed exist only few confounding variables. With this assumption, we can guarantee that joint confounding can be identified from the total correlation.

**Theorem 4.3**.: _Let \(_{S}\) be a set of variables such that all \(X_{i},X_{j}_{S}\) are pairwise confounded. Then \(_{S}\) is jointly confounded if and only if for each triple \(X_{i},X_{j},X_{k}_{S}\) we have \(I(E_{i}^{C};E_{j}^{C}|E_{k}^{C})<I(E_{i}^{C};E_{j}^{C})\)._

Now, the measure of joint confounding among a set of variables \(_{S}\) can be defined using total correlation \(T(E_{i}^{C},,E_{|S|}^{C})\) as follows. To evaluate the following expression, we need to use the contexts \(_{\{1\}\{|S|\}}\) to ensure that with high probability, the association among the variables in \(_{S}\) is due to the joint confounding variable \(Z\).

\[CNF2(_{S})=1-e^{-T(E_{i}^{C},,E_{|S|}^{C})}\] (9)

**Theorem 4.4**.: _For any three observed variables \(X_{i},X_{j},X_{o}\) and an unobserved confounding variable \(Z\), the following statements are true for the measure \(CNF\)-\(2\)._

1. _(_**Reflexivity and Symmetry.**_)_ \(CNF\)_-_\(2(X_{i},X_{i}|X_{o})=1-e^{-H(E_{i}^{C}|X_{s})}\ \  i\) _where_ \(H(.|.)\) _denotes conditional entropy and_ \(CNF\)_-_\(2(X_{i},X_{j}|X_{o})=CNF\)_-_\(2(X_{j},X_{i}|X_{o})\)_._
2. _(_**Positivity.**_)_ \(CNF\)_-_\(2(X_{i},X_{j})>0\) _if and only if_ \(X_{i},X_{j}\) _are confounded. Given an observed confounding variable_ \(X_{o}\) _between_ \(X_{i},X_{j}\)_,_ \(CNF\)_-_\(2(X_{i},X_{j}|X_{o})>0\) _if and only if there exists an unobserved confounding variable_ \(Z\) _between_ \(X_{i},X_{j}\)_._
3. _(_**Monotonicity.**_)_ \(CNF\)_-_\(2(X_{i},X_{j})>CNF\)-_\(2(X_{k},X_{l})\) _implies that the pair of variables_ \(X_{i},X_{j}\) _are more strongly confounded than the pair of variables_ \(X_{k},X_{l}\) _in the sense of Defn._ 4.2_._

Setting 3: Observing the Causal Mechanism Shifts in \(Z\) and Known Causal Path Direction Between \(X_{i}\) and \(X_{j}\)

Similar to the previous settings, we utilize marginal and conditional distributions of \(X_{i},X_{j}\) to define a measure of confounding. By prior knowledge, if we know the direction of causal path between \(X_{i},X_{j}\), we can utilize the causal direction to measure confounding as explained below. In addition to the notations \(E_{i}^{C},E_{j}^{C}\) introduced in the previous setting, let us denote for each \(c_{\{i\}\{j\}},_{X_{i}^{c}(X_{i}|X_ {j})}(X_{i}|X_{j}),_{X_{j}^{c}(X_{j}|X_{i})}(X_{j}|X_{ i})\) with \(E_{ij}^{C},E_{li}^{C}\) respectively. We now leverage dependency among these variables to define the measure of confounding. Intuitively, if \(X_{i} X_{j}\) and if we observe a change in the causal mechanisms of both \(X_{i},X_{j}\) due to the causal mechanism changes in \(Z\), we also observe a change in the causal mechanism \((X_{j}|X_{i})\).

**Definition 4.7**.: _(Confounding Measure 3) When the causal mechanism shifts are observed for \(X_{i},X_{j}\) and the causal direction between the nodes \(X_{i},X_{j}\) is known, under the Assumptions 3.2-4.1, the measure of confounding \(CNF\)-\(3(X_{i},X_{j})\) between \(X_{i}\) and \(X_{j}\) is defined as_

\[CNF3(X_{i},X_{j}):=1-e^{-I(E_{ji}^{C};E_{j}^{C})}&if\ \ \ X_{i} X_{j}\\ 1-e^{-I(E_{ji}^{C};E_{j}^{C})}&if\ \ \ X_{j} X_{i}\\ CNF2(X_{i},X_{j})&Otherwise\] (10)

To measure the unobserved confounding strength in the presence of an observed confounding variable \(X_{o}\), similar to setting 2, we can modify Eqn. 10 to condition on the variable \(X_{o}\).

**Beyond Pairwise Confounding:** Using the Assumption 4.2, we have the following.

**Theorem 4.5**.: _Let \(_{S}\) be a set of variables such that all \(X_{i},X_{j}_{S}\) are pairwise confounded and the causal relationships among each pair \(X_{i},X_{j}\). Then \(_{S}\) is jointly confounded if and only if for each triple \(X_{i},X_{j},X_{k}_{S}\) we have \(I(E_{ij}^{C};E_{jk}^{C}|E_{j}^{C})<I(E_{ij}^{C};E_{jk}^{C})\)._

Since we have access to random variables \(E_{ij}^{C}\) in addition to \(E_{i}^{C},E_{j}^{C}\), it is not straightforward to use all of them to measure joint confounding. To keep the measure simple, we let the measure of joint confounding among the variables \(_{S}\) be the same as \(CNF\)-\(2(_{S})\). That is, \(CNF\)-\(3(_{S})=CNF\)-\(2(_{S})\). Setting 3 is an alternative to Setting 2 when we know the direction of the causal path between \(X_{i},X_{j}\). Settings 2 and 3 act as complementary to each other in validating the correctness of our analysis.

**Theorem 4.6**.: _For any three observed variables \(X_{i},X_{j},X_{o}\) and an unobserved confounding variable \(Z\), the following statements are true for the measure \(CNF\)-\(3\)._

1. _(_**Reflexivity and Symmetry.**_)_ \(CNF\)_-_\(3(X_{i},X_{i}|X_{o})=1-e^{-H(E_{i}^{C}|X_{s})}\ \  i\) _where_ \(H(.|.)\) _denotes conditional entropy and_ \(CNF\)_-_\(3(X_{i},X_{j}|X_{o})=CNF\)_-_\(3(X_{j},X_{i}|X_{o})\)_._
2. _(_**Positivity.**_)_ \(CNF\)_-_\(3(X_{i},X_{j})>0\) _if and only if_ \(X_{i},X_{j}\) _are confounded. Given an observed confounding variable_ \(X_{o}\) _between_ \(X_{i},X_{j}\)_,_ \(CNF\)_-_\(3(X_{i},X_{j}|X_{o})>0\) _if and only if there exists an unobserved confounding variable_ \(Z\) _between_ \(X_{i},X_{j}\)_._
3. _(_**Monotonicity.**_)_ \(CNF\)_-_\(3(X_{i},X_{j})>CNF\)_-_\(3(X_{k},X_{l})\) _implies that the pair of variables_ \(X_{i},X_{j}\) _are more strongly confounded than the pair of variables_ \(X_{k},X_{l}\) _in the sense of Defn._ 4.2_._Algorithm

Algorithm 1 outlines the procedures to measure confounding in all three settings and can be extended to the case where we evaluate conditional confounding and evaluating confounding among multiple variables. We present two real-world examples where our methods can be applied in Appendix SS B.

``` Data: Context information \(_{\{i\}_{i^{}}},_{\{j\}_{j_{i}}}, _{\{i\}\{j\}}\), Contextual Datasets \(\{^{c}\}_{c}\). Result:\(CNF\)-\(1(X_{i},X_{j})\), \(CNF\)-\(2(X_{i},X_{j})\), \(CNF\)-\(3(X_{i},X_{j})\) Step 1: Evaluate \((X_{i}|X_{j}),(X_{j}|X_{i})\) using observational data; Step 2: Evaluate \((X_{i}|do(X_{j}))\) using \(\{^{c}\}_{c_{\{j\}_{j}}}\); Step 3: Evaluate \((X_{j}|do(X_{i}))\) using \(\{^{c}\}_{c_{\{i\}_{j}}}\); Step 4: Evaluate \(I(X_{i} X_{j}),I(X_{j} X_{i})\); Step 5: \(CNF\)-\(1(X_{i},X_{j})=1-e^{-min\{I(X_{i} X_{j}),I(X_{j} X_{i})\}}\); Step 6: Evaluate \(E_{i}^{c},E_{j}^{c}\) using \(\{^{c}\}_{c_{\{i\}\{j\}}}\) ; Step 7: \(CNF\)-\(2(X_{i},X_{j})=1-e^{-I(E_{i}^{c};E_{j}^{c})}\); Step 8: Evaluate \(E_{ij}^{c},E_{ji}^{c}\) using \(\{^{c}\}_{c_{\{i\}\{j\}}}\) ; Step 9: compute \(CNF\)-\(3(X_{i},X_{j})\) according to Defn. 4.7; return \(CNF\)-\(1(X_{i},X_{j}),CNF\)-\(2(X_{i},X_{j}),CNF\)-\(3(X_{i},X_{j})\) ```

**Algorithm 1**Algorithm for evaluating pairwise \(CNF\)-\(1\), \(CNF\)-\(2\), \(CNF\)-\(3\)

## 6 Experiments and Results

We perform simulation studies to verify the correctness of the proposed measures. All the experiments are run on a CPU. We report the mean and standard deviation of results taken over five random seeds. Code to reproduce the results is presented in the supplementary material. Code is available at https://github.com/gautam0707/CD_CNF.

**Measuring Confounding:** In this set of experiments, we consider the following four causal structures made of three nodes \(X_{i},X_{j}\); \(_{1}\) : Empty graph over \(Z,X_{i},X_{j}\) i.e., nodes are isolated in the graph, \(_{2}\) : \(X_{i} X_{j}\), \(_{3}:Z X_{i},Z X_{j}\), \(_{4}:Z X_{i},Z X_{j},X_{i} X_{j}\). In \(_{1},_{2}\), there is no confounding between \(X_{i},X_{j}\) and in \(_{3},_{4}\) there is confounding effect of \(Z\) on \(X_{i}\) and \(X_{j}\). Results in Fig. 2 show that our measures output zero when there is no confounding between \(X_{i},X_{j}\) and output positive values when \(X_{i},X_{j}\) are confounded by a confounding variable \(Z\).

**Measuring Conditional Confounding:** We consider the following two causal structures. \(_{5}:Z_{1} X_{i},Z_{1} X_{j},Z_{2} X_{i},Z_{2} X_{j},X _{i} X_{j}\), \(X_{i} X_{j}\). \(_{6}:Z X_{i},Z X_{j},X_{i} X_{j}\). In \(_{5}\), \(X_{i}\) and \(X_{j}\) are confounded by two variables \(Z_{1},Z_{2}\). We measure conditional confounding between \(X_{i},X_{j}\) conditioned on \(\), \(Z_{1}\), and \(Z_{2}\) respectively. Since confounding still exists in all of the above conditioning settings, \(CNF\)-\(2\) correctly returns positive confounding value in all three cases (see Fig. 3 left). On the other hand, in \(_{6}\), we measure conditional confounding

Figure 3: **Left:** Conditioning on one of \(\), \(Z_{1},Z_{2}\) will not remove confounding between \(X_{i},X_{j}\) in \(_{5}\). Hence \(CNF\)-\(2\) returns positive values. **Right:** In \(_{6}\), conditioning on \(\) does not remove the confounding effect of \(Z\) on \(X_{i},X_{j}\). Hence, we observe a positive value for \(CNF\)-\(2(X_{i},X_{j}|)\). Conditioning on \(Z\) will block the confounding between \(X_{i},X_{j}\). Hence \(CNF\)-\(2\) is closer to zero.

Figure 2: Measure of confounding between a pair of variables \(X_{i},X_{j}\). Our measures output zero when there is no confounding between \(X_{i},X_{j}\) and output positive values when \(X_{i},X_{j}\) are confounded.

between \(X_{i},X_{j}\) conditioning on empty set and \(Z\). Since conditioning on \(Z\) will block the confounding association between \(X_{i},X_{j}\), \(CNF\)-\(2\) returns confounding value closer to zero. However, the unconditioned confounding (conditioning on empty set) value is still large. These results empirically validate the correctness of the proposed measures.

**Downstream Causal Effect Estimation:** For the causal graphs \(_{3},_{4}\), we examine the impact of controlling for nodes identified using our method. We measure the causal effect of \(X_{i}\) on \(X_{j}\) with and without controlling for the detected confounding variable and report the absolute difference between the true and estimated causal effects in Tab. 3. The results show that controlling for the variables identified by our method reduces the bias in the estimated causal effects.

**Binary Data - Erdos-Renyi Causal Graphs:** To verify the performance of our method on a large scale, similar to , we generate causal graphs of various number nodes using Erdos-Renyi model. In these experiments, each context is a result of intervention on one node. This is the reason for having the same value for number of nodes \(N\) and number of contexts \(|C|\). Sample size denotes the number of data points used in each context. We detect and measure whether each pair of nodes is confounded or not. We then calculate the _Precision, Recall_, and _F1_ scores. Our confounding measures obtain good results across all settings.

## 7 Conclusions, Limitations, and Future Work

In this paper, based on the known causal mechanism shifts of observed variables, we propose three measures of confounding along with their conditional and multivariate variants. We also study key properties of these measures. Our measures complement each other depending on the available context information. We propose algorithms to compute the proposed measures and empirically verify their correctness. However, for the same confounded pair of variables, our metrics may yield different results depending on the chosen measure. As discussed in the introduction, the measures are intended to assess the relative strengths of confounding rather than for point-to-point comparison. The number of contexts required to evaluate the measure can be large because many contexts without changes in particular mechanisms are discarded. Identifying appropriate real-world datasets and applying the proposed measures to those datasets is an interesting area for future work, as is developing measures that efficiently use context information. Additionally, devising new definitions for confounding and proposing corresponding confounding measures is also an interesting future direction. We aim to pursue these ideas.

    &  &  &  \\  \(N\), \(|C|\) & **Sample Size** & **Precision** & **Recall** & **F1** & **Precision** & **Recall** & **F1** & **Precision** & **Recall** & **F1** \\ 

[MISSING_PAGE_POST]

   

Table 4: Results on synthetic datasets for settings 1,2,3.

   Causal &  &  \\ Graph & 1000 & 2000 & 3000 & 4000 & 5000 & 1000 & 2000 & 3000 & 4000 & 5000 \\  \(_{3}\) & 0.55 & 0.57 & 0.55 & 0.52 & 0.52 & 0.06 & 0.02 & 0.007 & 0.03 & 0.009 \\ \(_{4}\) & 0.24 & 0.26 & 0.23 & 0.24 & 0.23 & 0.04 & 0.05 & 0.06 & 0.02 & 0.05 \\  

Table 3: Downstream application of causal effect estimation.