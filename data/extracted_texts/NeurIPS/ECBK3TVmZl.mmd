# Zero-Regret Performative Prediction Under Inequality Constraints

Wenjing Yan Xuanyu Cao

Department of Electronic and Computer Engineering

The Hong Kong University of Science and Technology

wj.yan@connect.ust.hk, eexcao@ust.hk

Corresponding Author.

###### Abstract

Performative prediction is a recently proposed framework where predictions guide decision-making and hence influence future data distributions. Such performative phenomena are ubiquitous in various areas, such as transportation, finance, public policy, and recommendation systems. To date, work on performative prediction has only focused on unconstrained scenarios, neglecting the fact that many real-world learning problems are subject to constraints. This paper bridges this gap by studying performative prediction under inequality constraints. Unlike most existing work that provides only performative stable points, we aim to find the optimal solutions. Anticipating performative gradients is a challenging task, due to the agnostic performative effect on data distributions. To address this issue, we first develop a robust primal-dual framework that requires only approximate gradients up to a certain accuracy, yet delivers the same order of performance as the stochastic primal-dual algorithm without performativity. Based on this framework, we then propose an adaptive primal-dual algorithm for location family. Our analysis demonstrates that the proposed adaptive primal-dual algorithm attains \(()\) regret and constraint violations, using only \(+2T\) samples, where \(T\) is the time horizon. To our best knowledge, this is the first study and analysis on the optimality of the performative prediction problem under inequality constraints. Finally, we validate the effectiveness of our algorithm and theoretical results through numerical simulations.

## 1 Introduction

Stochastic optimization plays a critical role in statistical sciences and data-driven computing, where the goal is to learn decision rules (e.g., classifiers) based on limited samples that generalize well to the entire population. Most prior studies on stochastic optimization  rely on the assumption that the data of the entire population follows a static distribution. This assumption, however, does not hold in applications where the data distributions change dynamically in response to decision-makers' actions . For instance, in transportation, travel time estimates  influence routing decisions, resulting in realized travel times; in banking, credit evaluation criteria  guide borrowers' behaviors and subsequently their credit scores; and in advertising, recommendations  shape customer preferences, leading to consumption patterns. Such interplay between decision-making and data distribution arises widely in various areas, such as transportation, finance, public policy, and recommendation systems.

The seminal work  formalized the phenomenon as _performative prediction_, which represents the strategic responses of data distributions to the taken decisions via decisiondependent distribution maps (Quinonero-Candela et al., 2008). Since then, an increasing body of research has been dedicated to informative prediction problems. Most existing studies are focused on identifying _performative stable points_(Li and Wai, 2022; Li et al., 2022; Drusvyatskiy and Xiao, 2022; Brown et al., 2022; Mendler-Dunner et al., 2020; Wood et al., 2021; Ray et al., 2022), given the complexities of the decision-induced distribution shifts and the unknown decision-dependent distributions. The proposed algorithms typically iteratively retrain the deployed models until convergence. However, performative stability generally does not imply performative optimality. Aiming to achieve optimal performance, a few recent works designed effective algorithms by leveraging rich performative feedback (Jagadeesan et al., 2022), or by making some parametric assumptions on the underlying distribution maps. For instance, the distribution maps belong to the location family with linear structure (Miller et al., 2021) or are from the exponential family (Izzo et al., 2021).

All the aforementioned work on performative prediction is focused on unconstrained learning problems. However, in the real world, many performative prediction applications are subject to constraints (Detassis et al., 2021; Wood and Dall'Anese, 2022a). Constraints can be used to ensure the satisfaction of desired properties, such as fairness, safety, and diversity. Examples include safety and efficiency constraints in transportation (Metz, 2021), relevance and diversity constraints in advertising (Khamis, 2020), and risk tolerance and portfolio constraints in financial trading (Follmer and Schied, 2002), etc. In addition, constraints can serve as side information to enhance the learning outcomes, e.g., by narrowing the scope of exploration or by incorporating prior knowledge Serafini and Garcez (2016); Wu et al. (2018). As performative shifts can rarely be analyzed offline, incorporating constraints on what constitutes safe exploration (Turchetta et al., 2019) or facilitates optimization (Wood and Dall'Anese, 2022b) is of crucial importance.

Despite its importance, research on performative prediction under constraints has been neglected so far. Although some work (Izzo et al., 2021; Piliouras and Yu, 2022) restricted decision variables to certain regions, this feasible set restriction was simply handled by projections. This paper bridges this gap by studying the performative prediction problem under inequality constraints, for which simple projection is inadequate to handle. Unlike most existing work that provides only performative stable points, we aim to find the optimal solutions. As aforementioned, finding performative optima is a challenging task because we now need to anticipate performative effect actively rather than simply retrain models in a myopic manner.

However, the performative effect on distribution maps is unknown, which hinders the computation of exact performative gradient. To solve this problem, we develop a robust primal-dual framework that admits inexact gradients. We ask the following questions: _How does the gradient approximation error affect the performance of the primal-dual framework? Under what accuracy can the approximate gradients maintain the performance order of the stochastic primal-dual algorithm without performativity? How to construct effective gradient approximations that attain the desired accuracy?_ We answer the above thoroughly. Our idea hinges on enhancing gradient approximation with the parametric knowledge of distribution maps. In particular, we follow existing studies (Miller et al., 2021; Jagadeesan et al., 2022) and focus on the family of location maps. Location family exhibit a favorable linear structure for algorithm development while maintaining broad generality to model many real-world applications. Distribution maps of this type are ubiquitous throughout the performative prediction literature, such as strategic classification (Hardt et al., 2016; Perdomo et al., 2020), linear regression (Miller et al., 2021), email spam classification (Li et al., 2022), ride-share (Narang et al., 2022), among others. Nevertheless, we emphasize that our robust primal-dual framework is applicable to other forms of distributions with effective gradient approximation methods.

To our best knowledge, this paper provides the first study and analysis on the optimality of performative prediction problems under inequality constraints. We highlight the following key contributions:

* We develop a robust primal-dual framework that requires only approximate gradients up to an accuracy of \(()\), yet delivers the same order of performance as the stochastic primal-dual algorithm without performativity, where \(T\) is the time horizon. Notably, the robust primal-dual framework does not restrict the approximate gradients to be unbiased and hence offers more flexibility to the design of gradient approximation.
* Based on this framework, we propose an adaptive primal-dual algorithm for location family, which consists of an online stochastic approximation and an offline parameter estimation for the performative gradient approximation. Our analysis demonstrates that the proposed algorithm achieves \(()\) regret and constraint violations, using only \(+2T\) samples.

Finally, we conduct experiments on two examples: multi-task linear regression and multi-asset portfolio. The numerical results validate the effectiveness of our algorithm and theoretical analysis.

### Related Work

The study on performative prediction was initiated in (Perdomo et al., 2020), where the authors defined the notion of performative stability and demonstrated how performative stable points can be found through repeated risk minimization and stochastic gradient methods. Since then, substantial efforts have been dedicated to identifying performative stable points in various settings, such as single-agent (Mendler-Dunner et al., 2020; Drusvyatskiy and Xiao, 2022; Brown et al., 2022), multi-agent (Li et al., 2022; Piliouras and Yu, 2022), games (Narang et al., 2022), reinforcement learning (Mandal et al., 2023), and online learning (Wood et al., 2021; Wood and Dall'Anese, 2022a).

A few recent works aimed to achieve performative optimality, a more stringent solution concept than performative stability. In (Miller et al., 2021), the authors evaluated the conditions under which the performative problem is convex and proposed a two-stage algorithm to find the performative optima for distribution maps in location family. Another paper on performative optimality is (Izzo et al., 2021), which proposed a PerfGD algorithm by exploiting the exponential structure of the underlying distribution maps. Both works took advantage of parametric assumptions on the distribution maps. Alternatively, (Jagadeesan et al., 2022) proposed a performative confidence bounds algorithm by leveraging rich performative feedback, where the key idea is to exhaustively explore the feasible region with an efficient discarding mechanism.

A closely related work is (Wood and Dall'Anese, 2022b), which studied stochastic saddle-point problems with decision-dependent distributions. The paper focused on performative stable points (equilibrium points), whereas we aim at the performative optima, which is more challenging. Another difference is that (Wood and Dall'Anese, 2022b) only demonstrated the convergence of the proposed primal-dual algorithm in the limit, without providing an explicit finite-time convergence rate. In contrast, we provide \(()\) regret and \(()\) constraint violation bounds for the proposed algorithm in this paper.

## 2 Problem Setup

We study a performative prediction problem with loss function \((;Z)\), where \(\) is the decision variable, \(Z^{k}\) is an instance, and \(^{d}\) is the set of available decisions. Different from in stationary stochastic optimization where distributions of instances are fixed, in performative prediction, the distribution of \(Z\) varies with the decision variable \(\), represented by \(Z()\). In this paper, we consider that the decision variable \(\) is subject to a constraint \(()\), where \(():^{m}\). The constraint \(()\) can be imposed on \(\) to ensure certain properties, such as fairness, safety, and diversity, or to incorporate prior knowledge. We assume that \(()\) is available at the decision-maker in advance of the optimization. Ideally, the goal of the decision-maker is to solve the following stochastic problem:

\[_{}_{Z( )}(;Z) (),\] (1)

where \(_{Z()}(;Z)\) is referred to as _performance risk_, denoted by \(()\).

Problem (1) is, however, impossible to be solved offline because the distribution map \(()\) is unknown. Instead, the decision-maker needs to interact with the environment by making decisions to explore the underlying distributions. Given the online nature of this task, we measure the loss of a sequence of chosen decisions \(_{1},,_{T}\) by _performative regret_, defined as

\[(T):=_{t=1}^{T}([(_{t})]- (_{})),\]

where the expectation is taken over the possible randomness in the choice of \(\{_{t}\}_{t=1}^{T}\), and \(_{}\) is the performative optimum, defined as

\[_{}_{} _{Z()}(;Z) ().\]

Performative regret measures the suboptimality of the chosen decisions relative to the performative optima. Another performance metric for problem (1) on evaluating the decision sequence \(\{_{t}\}_{t=1}^{T}\) is constraint violation_, given by

\[_{i}(T):=_{t=1}^{T}[g_{i}(_{t})],  i[m],\]

where we use the symbol \([m]\) to represent the integer set \(\{1,,m\}\) throughout this paper.

Applications pertaining to problem (1) are ubiquitous. Next is an example.

**Example 1** (**Multi-Asset Portfolio)**.: _Consider a scenario where an investor wants to allocate his/her investment across a set of \(l\) assets, such as stocks, bonds, and commodities. The objective is to maximize the expected return subject to certain constraints, including liquidity, diversity, and risk tolerance. Let \(z_{i}\) denote the rate of return of the \(i\)th asset and \(_{i}\) denote its weight of allocation, \( i[l]\). The investment can affect the future rates of return of the assets and, consequently, the overall expected return of the portfolio. For example, excessive investment in a particular asset may lead to a decline in the rate of return of other assets. Let \(=[z_{1},,z_{l}]^{}\) and \(=[_{1},,_{l}]^{}\). Then, the expected return of the portfolio is \([r_{p}]:=_{()} ^{}\). Typically, the risk of the portfolio is measured by the variance of its returns, given by \(^{}\), where \(\) is the covariance matrix of \(\). One common approach to model liquidity is using the bid-ask spread, which measures the gap between the highest price a buyer is willing to pay (the bid) and the lowest price a seller is willing to accept (the ask) for a particular asset. Denote the vector of the bid-ask spread of the \(l\) assets by \(=[s_{1},,s_{l}]^{}\). Then, a liquidity constraint on the portfolio can be defined as \(^{} S\), where \(S\) is the maximum allowable bid-ask spread. The multi-asset portfolio problem can be formulated as:_

\[_{}\ -_{()} ^{}\ _{i=1}^{l}_{i} 1,\  ,\ ^{} S,^{} ,\]

_where \(\) restricts the maximum amount of investment to one asset, and \(\) is the risk tolerance threshold._

In this paper, our goal is to design an online algorithm that achieves both sublinear regret and sublinear constraint violations with respect to the time horizon \(T\), i.e., \((T) o(T)\) and \(_{i}(T) o(T)\), for all \(i[m]\). Then, the time-average regret satisfies \((T)/T o(1)\), and the time-average constraint violations satisfy \(_{i}(T)/T o(1)\), for all \(i[m]\). Both asymptotically go to zero as \(T\) goes to infinity. Therefore, the performance of the decision sequence \(\{_{t}\}_{t=1}^{T}\) generated by the algorithm approaches that of the performative optimum \(_{}\) as \(T\) goes to infinity.

## 3 Adaptive Primal-Dual Algorithm

### Robust Primal-Dual Framework

In this subsection, we develop a robust primal-dual framework for the performative prediction problem under inequality constraints. Our approach involves finding a saddle point for the regularized Lagrangian of problem (1). The Lagrangian, denoted by \((,)\), is defined as

\[(,):=()+ ^{}()-\|\|_{2}^{2},\] (2)

where \(\) is the primal variable (decision), \(\) is the dual variable (multiplier), \(>0\) is the stepsize of the algorithm, and \(>0\) is a control parameter. In (2), we add the regularizer \(-\|\|_{2}^{2}\) to suppress the growth of the multiplier \(\), so as to improve the stability of the algorithm.

To find the saddle point of the Lagrangian \((,)\), we utilize alternating gradient update on the primal variable \(\) and the dual variable \(\). The gradients of \((,)\) with respect to \(\) and \(\) are respectively given by

\[_{}(,)= _{}()+_{}()^{},\] (3) \[_{}(,)= ()-,\]

where \(_{}()\) is the Jacobian matrix of \(()\). In (3), \(_{}()\) is the gradient of the performative risk \(()\), given by

\[_{}()=_{Z( {})}_{}(;Z)+_{Z ()}(;Z)_{} p_{}(Z),\] (4)

where \(p_{}(Z)\) is the density of \(()\).

Since the data distribution \(()\) is unknown, the exact gradient of the performative risk \(()\) is unavailable, posing a significant challenge to the algorithm design. In this paper, we tackle this issue using a robust primal-dual framework. The main idea is to construct gradient approximations from data and then perform alternating gradient updates based on the inexact gradients. Denote by \(_{}}_{t}()\) the approximation of the gradient \(_{}()\) at the \(t\)th iteration. Correspondingly, an approximation for the Lagrangian gradient \(_{}(,)\) at the \(t\)th iteration is given by

\[_{}}_{t}(, ):= _{}}_{t}()+_{}}()^{}, t[T].\]

The robust alternating gradient update is then performed as

\[_{t+1} =_{}(_{t}- _{}}_{t}(_{t}, _{t})),\] (5) \[_{t+1} =[_{t}+_{} _{t}(_{t},_{t})]^{+}\,.\] (6)

Then, the next question is how to construct effective gradient approximations that achieve satisfactory performance.

By (4), the expectation over \(()\) in the gradient \(_{}()\) can be approximated by samples, while the unknown probability density \(p_{}(Z)\) presents the main challenge. Most existing research circumvented this problem by omitting the second term in \(_{}()\). This essentially gives a performative stable point. However, as pointed out in (Miller et al., 2021), performative stable points can be arbitrarily sub-optimal, leading to vacuous solutions. Instead, if we have further knowledge about the parametric structure of \(p_{}(Z)\), the complexity of gradient approximation can be greatly reduced. In this regard, (Miller et al., 2021) and (Jagadeesan et al., 2022) exploited the linear structure of location family, and (Izzo et al., 2021) considered distribution maps within exponential family. Following (Miller et al., 2021; Jagadeesan et al., 2022), we focus on the family of location maps in this paper because it exhibits a favorable linear structure for algorithm development while maintaining broad generality to various applications. Next, we develop an adaptive algorithm for problem (1) with location family distribution maps based on the above robust primal-dual framework.

### Algorithm Design for Location family

In the setting of location family, the distribution map depends on \(\) via a linear shift, i.e.

\[Z() Z}{{=}}Z_{0}+,\] (7)

where \(Z_{0}_{0}\) is a base component representing the data without performativity, \(^{k d}\) captures the performative effect of decisions, and \(}{{=}}\) means equal in distribution. Denote by \(\) the covariance matrix of the base distribution \(_{0}\). Note that \(_{0}\) is still unknown. Plugging the distribution definition (7) into (4), we obtain a more explicit expression for \(_{}()\) as

\[_{}()=_{Z_{0} _{0}}[_{}(;Z_{0}+)+^{}_{Z} (;Z_{0}+)].\]

To compute \(_{}()\), we still need to address two problems: the unknown base distribution \(_{0}\) and the unknown performative parameter \(\). We tackle them as follows.

**Offline Stochastic Approximation:** We approximate the base distribution \(_{0}\) offline by sample average approximation (Kleyweg et al., 2002). Specifically, before the start of the alternating gradient update, we first draw \(n\) samples \(\{Z_{0,i}\}_{i=1}^{n}\) from \(()\). These samples are used to approximate the expectation over \(Z_{0}\) throughout the algorithm iteration. Hence, the sample complexity from this expectation approximation is fixed at \(n\).

**Online Parameter Estimation:** We estimate the parameter \(\) via online least squares. In each round of the alternating gradient update, we first take the current decision \(_{t}\) and its perturbed point \(_{t}+_{t}\) to observe samples \(Z_{t}(_{t})\) and \(Z_{t}^{}(_{t}+_{t})\), respectively, where \(_{t}\) is an injected noise specified by the decision-maker. We have \([Z_{t}-Z_{t}^{}|_{t}]=_{t}\). Then, the least-square problem at the \(t\)th iteration is designed as

\[_{}\|Z_{t}^{}-Z_{t}-_{ t}\|_{2}^{2}.\]

Let \(}_{t-1}\) be the estimate of \(\) at the \((t-1)\)th iteration. Based on it, we construct a new estimate \(}_{t}\) for \(\) by using gradient descent on the above least-square objective. This gives us the update

\[}_{t}=}_{t-1}+_{t}(Z_{t}^{ }-Z_{t}-}_{t-1}_{t})_{t}^{ },\]where \(_{t}\) is the stepsize of the online least squares at the \(t\)th iteration.

**Adaptive Primal-Dual Algorithm:** With the above preparation, we obtain an approximation for the gradient \(_{}(_{t})\) at the \(t\)th iteration as

\[_{}}_{t}(_{t}):= _{i=1}^{n}[_{}(_{t};Z_{0,i}+ }_{t}_{t})+}_{t}^{} _{Z}(_{t};Z_{0,i}+}_{t}_{t})].\] (8)

Given \(_{}}_{t}(_{t})\), we develop an adaptive primal-dual algorithm for the constrained informative prediction problem (1) based on the robust primal-dual framework in SS 3.1, which is presented in Algorithm 1. In Algorithm 1, the initial decision is randomly chosen from the admissible set \(\). Both the dual variable and the parameter estimate \(}_{0}\) are initialized to be zero. The algorithm maintains two sequences. One is the estimate \(}_{t}\), which is updated based on the newly observed samples \(Z_{t}\) and \(Z_{t}^{}\), as given in Step 7. The other is the alternating gradient update on the primal and dual variables, which are respectively given in Step 10 and Step 12.

```
1: Take decision \(=\) and observe \(n\) samples \(Z_{0,i}_{0}\), \( i[n]\).
2: Initialize \(_{1}\) arbitrarily. Set \(_{1}=\) and \(}_{0}=\).
3:for\(t=1\) to \(T\)do
4: Take decision \(_{t}\) and observe \(Z_{t}(_{t})\).
5: Generate noise \(_{t}\).
6: Take decision \(_{t}+_{t}\) and observe \(Z_{t}^{}(_{t}+_{t})\).
7: Update parameter estimate by \(}_{t}=}_{t-1}+_{t}(Z_{t}^{ }-Z_{t}-}_{t-1}_{t})_{t}^ {}\).
8: Update gradient approximation \(_{}}_{t}(_{t})\) by (8).
9: Compute \(_{}}_{t}(_{t},_{t })=_{}}_{t}(_{t})+_{ {}}(_{t})^{}_{t}\).
10: Update the primal variable by \(_{t+1}=_{}(_{t}-_{}}_{t}(_{t},_{t}))\).
11: Compute \(_{}(_{t},_{t})=(_{t})-_{t}\).
12: Update the dual variable by \(_{t+1}=[_{t}+_{} (_{t},_{t})]^{+}\).
13:endfor ```

**Algorithm 1** Adaptive Primal-Dual Algorithm

## 4 Convergence Analysis

In this section, we analyze the convergence performance of the proposed adaptive primal-dual algorithm. We first provide the convergence result of the robust primal-dual framework. Then, we bound the error of gradient approximation in our adaptive algorithm for the location family. With these results, the convergence bounds of the adaptive primal-dual algorithm are derived. Our analysis is based on the following assumptions.

**Assumption 1** (**Properties of \((;Z)\)**).: _The loss function \((;Z)\) is \(\)-smooth, \(L_{}\)-Lipschitz continuous in \(\), \(L_{Z}\)-Lipschitz continuous in \(Z\), \(_{}\)-strongly convex in \(\), and \(_{Z}\)-strongly convex in \(Z\). Moreover, we have \(_{}-^{2}/_{Z}>0\)._

**Assumption 2** (**Compactness and Boundedness of \(\)**).: _The set of admissible decisions \(\) is closed, convex, and bounded, i.e., there exists a constant \(R>0\) such that \(\|\|_{2} R\), \(\)._

**Assumption 3** (**Properties of \(()\)**).: _The constraint function \(()\) is convex, \(L_{}\)-Lipschitz continuous, and bounded, i.e., there exists a constant \(C\) such that \(\|()\|_{2} C\), \(\)._

**Assumption 4** (**Bounded Stochastic Gradient Variance**).: _For any \(i[n]\) and \(\), there exists \( 0\) such that_

\[_{Z_{0,i}_{0}}\|_{}( {};Z_{0,i}+)+^{}_{Z} (;Z_{0,i}+)-_{} ()\|_{2}^{2}^{2}.\]Assumption 1 is standard in the literature of performative prediction. Assumptions 2 and 3 are widely used in the analysis of constrained optimization problems (Tan et al., 2018; Yan et al., 2019; Cao and Basar, 2020), even with perfect knowledge of objectives. Assumption 4 bounds the variance of the stochastic gradient of \(()\). Additionally, to ensure a sufficient exploration of the parameter space, we make the following assumption on the injected noises \(\{_{t}\}_{t=1}^{T}\).

**Assumption 5** (**Injected Noise)**.: _The injected noises \(\{_{t}\}_{t=1}^{T}\) are independent and identically distributed. Moreover, there exist positive constants \(_{1}\), \(_{2}\), and \(_{3}\) such that for any \(t[T]\), the random noise \(_{t}\) satisfies_

\[_{1}[_{t} _{t}^{}],\|_{t}\|_{2}^ {2}_{2},[\|_{t} \|_{2}^{2}_{t}_{t}^{}]_{3} [_{t}_{t}^{}].\]

Consider a Gaussian noise that \(_{t}(0,)\), \( t[T]\), we have \(_{1}=1\), \(_{2}=d\), and \(_{3}=3d\).

With the above assumptions, we provide some supporting lemmas below. First, we show \(\)-sensitivity of the location family given in (7).

**Lemma 1** (\(\)-**Sensitivity of \(()\))**.: _Define \(_{}():=_{\|\|_{2}=1}\| \|_{2}\). The location family given in (7) is \(\)-sensitive with parameter \(_{}()\). That is, for any \(,^{}\), we have \(_{1}((),(^{ }))\|-^{} \|_{2}\), where \(_{1}(,^{})\) denotes the Wasserstein-1 distance._

See SS A of the supplementary file for the proof. Building upon Lemma 1, we have the following Lemma 2 about the performative risk \(()\).

**Lemma 2** (**Lipschitz Continuity and Convexity of \(()\))**.: _Consider the location family given in (7). With Assumption 1 and Lemma 1, we have that: 1) the performative risk \(()\) is \(L\)-Lipschitz continuous for \(L L_{}+L_{Z}_{}()\); 2) the performative risk \(()\) is \(\)-strongly convex for_

\[\{-^{2}/_{Z},_{}-2+_{Z}_{}^{2}()\},\]

_where \(_{}():=_{\|\|_{2}=1}\| \|_{2}\)._

See SS B of the supplementary file for the proof. Based on the Lipschitz continuity and convexity of \(()\), we provide the convergence result of the robust primal-dual framework below.

**Lemma 3** (**Convergence Result of Robust Primal-Dual Framework)**.: _Set \(=}\). Then, there exists a constant \([L_{}^{2}}}{4^{2}}, L_{}^{2}}}{4^{2}}]\) such that under Assumptions 1-3, for \(T 32L_{}^{2}\), the regret satisfies:_

\[_{t=1}^{T}([(_{t})]- (_{})) }{-a}(2R^{2}+C^{2}+2L^{2})\] \[+(+} )_{t=1}^{T}\|_{} }_{t}(_{t})-_{}(_{t})\| _{2}^{2},\]

_where \(a(0,)\) is a constant. Further, for any \(i[m]\), the constraint violation satisfies:_

\[[_{t=1}^{T}g_{i}(_{t})] (2R+C+2L)\] \[+(}}{}+ )(_{t=1}^{T}\|_{}}_{t}(_{t})-_{}(_{t })\|_{2}^{2})^{}.\]

**Remark 2**.: _Lemma 3 reveals the impact of gradient approximation error on the convergence performance of the robust primal-dual framework. By Lemma 3, if the accumulated gradient approximation error is less than \(()\), both the regret and the constraint violations are bounded by \(()\). Although stochastic primal-dual methods for constrained problems without performativity also use approximated (stochastic) gradients, they generally require unbiased gradient approximation (Tan et al., 2018; Yan et al., 2019; Cao and Basar, 2022). This requirement, however, is difficult to satisfy in performative prediction since the unknown performative effect of decisions changes the data distribution. In contrast, the robust primal-dual framework does not restrict the approximate gradients to be unbiased and hence offers more flexibility to the design of gradient approximation._

Proof of Lemma 3 is provided in SS C of the supplementary file. In the next lemma, we bound the gradient approximation error of the adaptive primal-dual algorithm.

**Lemma 4** (**Gradient Approximation Error**).: _Set \(_{t}=(t-1)+2_{3}},\, t[T]\). Then, under Assumptions 4 and 5, the accumulated gradient approximation error is upper bounded by:_

\[_{t=1}^{T}\|_{}}}}}_{t}(_{t})-_{ }}}}_{t} _{t}\|_{2}^{2}}{ n}+(2L_{Z}^{2}+^{2}R^{2}(1+2_{}() ))(T),\]

_where \(:=\{}{_{1}}\|}_{}-\|_{}^{2},\, }}}}()}{_{1}^{2}}\}\). In Algorithm 1, we set \(}_{0}=\), and thus we have \(=\{}{_{1}}\|\|_{ }^{2},}} }}()}{_{1}^{2}}\}\)._

**Remark 3**.: _Lemma 4 demonstrates that the gradient approximation error of the adaptive primal-dual algorithm is upper bounded by \((T/n+(T))\). If we set the number of initial samples \(n\), we have \(_{t=1}^{T}\|_{}}}}(_{t})-_{}}}}_{t}(_{t})\|_{2}^{2}()\). According to Lemma 3, this suffices to make the regret and constraint violation bounds to be \(()\)._

Proof of Lemma 4 is presented in SS D of the supplementary file. Combining Lemma 3 and Lemma 4 yields the regret and constraint violations of Algorithm 1, which is elaborated in Theorem 1 below.

**Theorem 1**.: _Set \(=}\) and \(_{t}=(t-1)+2_{3}},\, t[T]\). Then, there exists a constant \([L_{}^{2}}}{4^{2}}, L_{}^{2}}}{4^{2}}]\) such that under Assumptions 1-5, for \(T 32L_{}^{2}\), the regret of Algorithm 1 is upper bounded by:_

\[_{t=1}^{T}([}}}(_{t})]-}}}(_{}}}})) }{-a}(2R^{2}+C^{2}+2L^{2})+ }{-a}(+}) \] \[+(T)}{n(-a)}(+})(2L_{Z}^{2}+^{2}R^{2}(1+2_{}( ))),\]

_Further, for any \(i[m]\), the constraint violation is upper bounded by:_

\[[_{t=1}^{T}g_{i}(_{t} )] [(2R+C+2L)+( }{}+}})}}{}]\] \[+(1+)(T)}}{}( }}{}+)(2L_{Z}^{2}+^{2}R^{2 }(1+2_{}()))^{}.\]

**Remark 4**.: _Theorem 1 demonstrates that Algorithm 1 achieves \((+T/n)\) regret and \((+T^{}/)\) constraint violations. By setting \(n=\), we have \(T/n=\) and \(T^{}/=\), and hence both the regret and constraint violations are upper bounded by \(()\). This indicates that Algorithm 1 attains the same order of performance as the stochastic primal-dual algorithm without performativity (Tan et al., 2018; Yan et al., 2019)._

**Remark 5**.: _Throughout the time horizon \(T\), Algorithm 1 requires a total of \(+2T\) samples. Among them, \(\) samples are dedicated to approximate the expectation over the base component \(Z_{0}\). Furthermore, each iteration requires an additional \(2\) samples to construct the online least-square objective, accumulating the remaining \(2T\) samples._

## 5 Numerical Experiments

This section verifies the efficacy of our algorithm and theoretical results by conducting numerical experiments on two examples: multi-task linear regression and multi-asset portfolio.

We first consider a multi-task linear regression problem in an undirected graph \(:=(,)\), where \(\) represents the node set and \(\) represents the edge set. Each node \(i\) handles a linear regression task \(}}}_{i}(_{i }):=_{(_{i},y_{i})_{i}(_{ i})}_{i}(_{i};(_{i},y_{i}))\), where \(_{i}\) is the parameter vector and \((_{i},y_{i})\) is a feature-label pair. The loss function of each task is \(_{i}(_{i};(_{i},y_{i}))= (y_{i}-_{i}^{}_{i})^{2}, i\). The parameters of each connected node pair are subject to a proximity constraint \(\|_{i}-_{j}\|_{2}^{2} b_{ij}^ {2}\), \((i,j)\). The entire network aims to solve the following problem:

\[_{_{i},\, i} _{i}_{(_{i},y_{i} )_{i}(_{i})}(y_{i}-_{i}^{ }_{i})^{2}  \|_{i}-_{j} \|_{2}^{2} b_{ij}^{2},(i,j).\]The second example considers the multi-asset portfolio described in Example 1. The simulation details are provided in SS F of the supplementary file.

We compare the proposed adaptive primal-dual algorithm (abbreviated as APDA) with two approaches. The first approach is "PD-PS", which stands for the primal-dual (PD) algorithm used to find the performative stable (PS) points. The algorithm PD-PS is similar to APDA, but it uses only the first term in Eq. (8) as the approximate gradient. The second approach is "baseline", which runs the same procedures as APDA with perfect knowledge of \(\), i.e., the performative effect is known. We consider four performance metrics: (a) relative time-average regret \((t)}{t(1)}\), (b) relative time-average constraint violation \(_{i}(t)}{t|_{1}(1)|}\), (c) decision deviation \(\|_{t}-_{}\|_{2}^{2}\), and (d) parameter estimation error \(\|}_{t}-\|_{}^{2}\).

Fig. 1 and Fig. 2 show the numerical results of the multi-task linear regression and the multi-asset portfolio, respectively. In both figures, we consider two settings for the sensitivity parameter of \(()\), namely \(=1\) and \(=10\). The results of these two figures are qualitatively analogous. First, we observe that APDA outperforms PD-PS significantly that both the relative time-average regret and the decision derivation of the former achieve an accuracy around or up to \(10^{-3}\) for the setting of \(T=10^{6}\), while these of the latter have worse performance for \(=1\) and converge to constants for \(=10\). The relative time-average constraint of all cases converges to zero or negative numbers. This corroborates the sublinearity of the regret and the constraint violations of APDA, as shown in Theorem 1. More importantly, this result implies that the larger the sensitivity parameter \(\), the stronger the performative power is and, consequently, the worse PD-PS performs. In contrast, by tracking the performative gradient, APDA adapts to the unknown performative effect and performs well constantly. Moreover, both subfigures (d) show that the error of parameter estimates decreases sublinearly with iterations, validating the effectiveness of the online parameter estimation. Last but not least, the performance of APDA is close to the performance of the baseline, which manifests the effectiveness of our proposed APDA algorithm.

Conclusions

This paper has studied the performative prediction problem under inequality constraints, where the agnostic performative effect of decisions changes future data distributions. To find the performative optima for the problem, we have developed a robust primal-dual framework that admits inexact gradients up to an accuracy of \(()\), yet delivers the same \(()\) regret and constraint violations as the stochastic primal-dual algorithm without performativity. Then, based on this framework, we have proposed an adaptive primal-dual algorithm for location family with effective gradient approximation method that meets the desired accuracy using only \(+2T\) samples. Numerical experiments have validated the effectiveness of our algorithm and theoretical results.