# FreqMark: Invisible Image Watermarking via Frequency Based Optimization in Latent Space

Yiyang Guo\({}^{*}\)\({}^{1,5}\), Ruizhe Li\({}^{*}\)\({}^{2}\), Mude Hui\({}^{3}\), Hanzhong Guo\({}^{4}\), Chen Zhang\({}^{1}\)

**Chunangian Cai\({}^{5}\), Le Wan\({}^{5}\), Shangfei Wang\({}^{11}\)**

\({}^{1}\)University of Science and Technology of China \({}^{2}\)Fudan University

\({}^{3}\)University of California, Santa Cruz \({}^{4}\)The University of Hong Kong \({}^{5}\)IEG, Tencent

{guoyiyang, zhangchenzc}@mail.ustc.edu.cn; lirz22@m.fudan.edu.cn; mmuui@ucsc.edu; hanzhong@connect.hku.hk; {herbertcai, vinowan}@tencent.com; sfwang@ustc.edu.cn

Equal Contribution. \({}^{}\)Work is done during an internship at IEG, Tencent. \({}^{}\)Corresponding Author.

###### Abstract

Invisible watermarking is essential for safeguarding digital content, enabling copyright protection and content authentication. However, existing watermarking methods fall short in robustness against regeneration attacks. In this paper, we propose a novel method called FreqMark that involves unconstrained optimization of the image latent frequency space obtained after VAE encoding. Specifically, FreqMark embeds the watermark by optimizing the latent frequency space of the images and then extracts the watermark through a pre-trained image encoder. This optimization allows a flexible trade-off between image quality with watermark robustness and effectively resists regeneration attacks. Experimental results demonstrate that FreqMark offers significant advantages in image quality and robustness, permits flexible selection of the encoding bit number, and achieves a bit accuracy exceeding 90% when encoding a 48-bit hidden message under various attack scenarios.

## 1 Introduction

As the development of generative models [42; 32], distinguishing between AI-generated and real images becomes increasingly challenging, which brings new risks such as deepfakes and copyright infringement [5; 31]. By adding invisible watermarks within images, the concealed message can be tracked and used for purposes such as copyright verification, identity authentication, copy control, etc., thereby safeguarding against the misuse of image content.

Traditional methods [12; 15; 14; 36; 15] conceal hidden messages in the frequency space of images, providing resistance to Gaussian noise attacks but susceptibility to brightness, contrast, and regeneration attacks. The rapid development of deep learning has also promoted the iteration of watermarking techniques with enhanced robustness to numerous attacks. A common approach is to train a watermark embedding network through supervised learning to introduce imperceptible perturbations to images, and then to retrieve the hidden messages through a decoding network [46; 10; 55; 3]. An alternative method sets the optimization objective as the image itself, utilizing pre-trained neural networks to calculate the perturbations to be added, thereby bypassing the higher cost of training networks and providing a more flexible approach [29; 20]. However, with the continued advancement of generative models, leveraging their generalization capabilities to denoise watermarked images through regeneration attacks has proven to be an effective method for watermark removal [58; 43]. A logical step is to encode the watermark in the image latent space, allowing the watermark tobe incorporated into the latent semantics of images. This approach improves robustness against regeneration attacks but increases susceptibility to Gaussian noise.

In this paper, we propose FreqMark, a novel self-supervised watermarking approach that amalgamates the benefits of frequency domain space and latent space, endowing it with a dual-domain advantage. Specifically, it utilizes fixed pre-trained Variational Autoencoder (VAE)  to embed watermark messages into images by making subtle adjustments in the latent frequency space. These messages are then decoded using a fixed pre-trained image encoder. Figure 1 illustrates the primary motivation behind our method. Introducing perturbations to watermark images in the latent and frequency domains offers distinct advantages. By optimizing the latent frequency domain of the image, we combine both approaches to effectively leverage their strengths, achieving a synergistic effect where the whole is greater than the sum of its parts.

We evaluate the performance of FreqMark on the DiffusionDB  and ImageNet  datasets, experimental results demonstrated that FreqMark achieves strong robustness while maintaining image quality, configurable payload capacity, and flexibility. With a 48-bit encoding setting, the bit accuracy can exceed 90% under various attacks. This performance indicates significant advantages over baseline methods, particularly excelling during regeneration attacks [7; 13; 58].

**Contributions:** (1) We propose a novel invisible image watermarking method named FreqMark, which encodes hidden messages within the latent frequency space of images. FreqMark achieves watermark embedding through indirect optimization centered on the image itself without requiring network training. (2) FreqMark is highly flexible, allowing for a free trade-off between the bits number of the encoded message, image quality and watermark robustness to meet diverse requirements. (3) FreqMark demonstrates significant robustness advantages, particularly during regeneration attacks compared to baseline methods. Experimental results validate the superiority of our proposed method.

## 2 Related Work

Generative ModelsFor a long time, Generative Adversarial Networks (GANs) [27; 1; 26; 22; 41; 33] have dominated image generation. Recently, diffusion models have emerged as a solid alternative to GANs for image generation [25; 17; 34; 35]. These models show significant improvements and applications across various domains. DDIM sampling  and latent diffusion  further accelerate the generation progress, while ControlNet  provides a powerful, controllable generation method. As high-quality image generation becomes more accessible, digital watermarking gains importance for protecting intellectual property rights and ensuring content authenticity.

Image WatermarkingThe research history of image watermarking techniques is extensive. Early methods employ hand-crafted methods to hide messages within the spatial or frequency domain of images. Frequency-domain-based techniques typically exhibit better robustness and have been widely applied even before the rise of deep learning [12; 15; 14; 36; 15; 4]. The widely used open-source

Figure 1: The robustness of different watermark encoding positions. **Left**: Encoding in image frequency space resists Gaussian noise but is vulnerable to regeneration attacks. **Middle**: Encoding in image latent space enhances resistance to regeneration attacks but introduces vulnerabilities to Gaussian noise. **Right**: FreqMark encodes latent frequency space in the image, achieving a strong defense against regeneration and traditional attacks.

model, Stable Diffusion , employs DwtDctSvd  as its default watermarking method. However, this method has been demonstrated to be relatively vulnerable to various attacks .

With the development of deep learning, methods utilizing encoder-decoder architectures have gained prominence. HiDDeN  and RivaGAN  train encoders to embed watermark messages into images and decoders to extract them, thereby enhancing robustness against noise while preserving image quality. RedMark  and StegaStamp  improve robustness by integrating a series of differentiable perturbations. RoSteALS  enhances the robustness of the watermark by fine-tuning the secret encoder and secret decoder in the latent space. In recent years, several innovative methods have been introduced. WatermarkDM  trains a diffusion model on watermarked images to create detectable watermarked images. Stable Signature  fine-tunes the decoder of a latent diffusion model to embed specific hidden messages. Tree-Ring  adopts a unique approach by encoding a particular pattern shape in the initial noise frequency space during the diffusion process and utilizes DDIM inversion  to detect watermarks. Differently, FNNS  and SSL  achieve message encoding by optimizing the image itself. However, the aforementioned methods struggle to strike a perfect balance between flexibility and robustness. In contrast, FreqMark offers higher degrees of freedom, allowing for a better trade-off among task requirements, and demonstrates robustness against regeneration attacks.

## 3 Background

FreqMark operates on the following scenario: A user embeds a \(k\)-bit watermark message \(m_{e}\) into an image \(I\) to get the watermarked image \(I_{w}\) for which they hold the copyright. Upon discovering unauthorized usage of the image \(I_{w}\), the user decodes the infringed image to obtain the message \(m_{d}\), which serves as evidence to prove their ownership of the image's copyright.

Assuming that each bit of the decoded message from clean images is independent and has an equal probability of being -1 or 1, this method allows us to mathematically calculate the False Positive Rate (FPR) of decoding.

Let the encoded message be \(m_{e}\{-1,1\}^{k}\) and the decoded message be \(m_{d}\{-1,1\}^{k}\). The function \(M(m_{e},m_{d})\) measures the number of matching bits between \(m_{e}\) and \(m_{d}\). Given the assumption regarding the image encoder output mentioned earlier, each bit of the decoded message from clean images is independent and follows Bernoulli random variables with a probability of 0.5 . By set a decoding threshold \(\{0,,k\}\), once \(M(m_{e},m_{d})\), we consider that the image has encoded the message \(m_{e}\). Consequently, \(M(m_{e},m_{d})\) follows a binomial distribution \(B(k,0.5)\). The final message will be transformed to \(\{0,1\}^{k}\) by applying function \(f(x)=(x+1)/2\) for easier processing of the binary format.

We could test the hypothesis \(H_{1}\): _the image \(x\) has hidden watermark_, and against the null hypothesis \(H_{0}\): _the image \(x\) has no hidden watermark_. From this, we can obtain a closed-form solution for the FPR under the threshold \(()\) using the regularized incomplete beta function \(I_{x}(a;b)\):

\[()=P(M(m_{e},m_{d})>|H_{0})=}_{i=+1}^{k} C_{k}^{i}=I_{1/2}(+1,k-).\] (1)

Based on the above formula, FPR \( 1.65 10^{-6}\) when \(k\) = 48, \(\) = 39; FPR \( 5.04 10^{-8}\) when \(k\) = 48, \(\) = 41. The results of watermark detection True Positive Rate (TPR) under various FPR settings are shown in Figure 8 of Appendix A.3.

## 4 Method

### Overview

Figure 2 presents an overview of FreqMark. FreqMark employs a strategic methodology to embed invisible watermarks in images by adding perturbations in the latent frequency space. Specifically, we utilize a Variational Autoencoder (VAE)  to encode images into representations and then transform these image latents into the frequency domain. Only the perturbation within the latent frequency space of images is trained during watermark encoding and all the networks are fixed. A

pre-trained image encoder is used for watermark extraction, the features of the watermarked image obtained from the encoder are compared with predefined directional vectors to reveal the hidden message.

In the optimization process, the image quality is maintained with minimal degradation by utilizing PSNR and LPIPS loss , while the watermark message is constrained by using hinge loss. In addition, noises and augmentation are introduced for enhanced robustness. Figure 3 shows some watermark image examples from FreqMark.

### Message Embed in Latent Frequency Space

Some current methods embed hidden messages by directly optimizing image pixels [20; 29], which leads to poor robustness against regeneration attacks . FreqMark involves strategically adding perturbations in the frequency domain of the image latent representation to embed an invisible watermark. These perturbations in the frequency domain are more concealed than those in the pixel space, making them harder to eliminate and thus offering superior robustness against regeneration attacks while minimizing the impact on image quality.

First, we use a pre-trained VAE encoder \(E\) to encode the image into a latent image and then transform the latent image into the frequency domain using Fast Fourier Transform (FFT), represented as:

\[F_{Z}=FFT(E(I)),\] (2)

where \(I\) is the input image, \(E(I)\) is the latent representation encoded by the VAE encoder \(E\), and \(F_{Z}\) is the frequency domain latent representation of the image.

Next, we embed the hidden message into the frequency domain latent representation \(F_{Z}\) by adding a slight perturbation, then decode the frequency domain latent representation back into the image using inverse Fast Fourier Transform (iFFT) \(FFT^{-1}\) and the VAE decoder \(D\), as follows:

\[I_{w}=D(FFT^{-1}(F_{Z}+_{m})),\] (3)

where \(I_{w}\) is the watermarked image, \(_{m}\) is the perturbation added in the frequency domain of the latent image for embedding the watermark.

Figure 2: Overview of FreqMark. **Encoding**: FreqMark employs a pre-trained VAE model to encode watermarks within the latent frequency space of the image. \( 1\) and \( 2\) are Gaussian noise perturbations added during training. All networks are fixed and only perturbation \(_{m}\) is trained. **Decoding**: FreqMark utilizes a pre-trained image encoder to extract features from the image and extracts the watermark by comparing this feature against predefined directions.

### Decoding by Pre-trained Image Encoder

During the decoding process, similar to SSL, we predefine a set of K N-dimensional vectors \(V_{K}^{N}=\{v_{1},v_{2},...,v_{K} K N\}\) within the feature space of the pre-trained image encoder \(E_{img}\). For images with embedded watermarks \(I_{w}\), the feature vector \(z_{I_{w}}=E_{img}(I_{w})\) is obtained after passing through \(E_{img}\). By calculating the signs of the dot product between the direction vectors \(V_{K}^{N}\) and \(z_{I_{w}}\), we can extract the hidden message \(m_{d}\):

\[m_{d}^{k}=sign(z_{I_{w}} v_{k})=sign(E_{img}(I_{w}) v_{k}),v_{k} V _{K}^{N},\] (4)

where \(m_{d}^{k}\) represents the \(k\)-th bit of \(m_{d}\) and \(v_{k}\) denotes the \(k\)-th direction vector of \(V_{K}^{N}\), \(sign(x)=1\) when \(x>=0\); \(sign(x)=-1\) when \(x<0\).

One significant advantage of this decoding method is its flexibility in setting the number of watermark bits. The number of direction vectors determines the encoding bits. Using the technique mentioned above of optimizing images within the frequency domain, we can ensure the robustness of the hidden messages while significantly minimizing the quality impact on the image.

### Training Objective

Our goal is to embed an invisible watermark by optimizing the frequency map of the image latent \(F_{Z}\), where the perturbation \(_{m}\) serves as the trainable parameter, with all pre-trained networks remaining fixed. The optimization via perturbations ensures both watermark robustness and the preservation of image quality, offering flexibility in encoding bits and embedding strength.

Image QualityWe utilize PSNR loss to reduce discrepancies between the watermarked image and the original image and also incorporate LPIPS loss  to make alterations less perceptible.

\[_{p}=-PSNR(I_{w},I),\] (5)

\[_{i}=LPIPS(I_{w},I).\] (6)

Watermark MessageThe optimization goal is to modify the image features \(z_{I_{w}}\) processed by the pre-trained image encoder \(E_{img}\), aligning them on the K direction vectors \(V_{K}^{N}\) to correspond with the encoded message. We define message loss as the hinge loss with margin \( 0\) on the projections:

\[_{m}(I_{w})=_{k=1}^{K}max(0,(-(z_{I_{w}} v_ {k}) m_{k})),v_{k} V_{K}^{N},\;m_{k}\{-1,1\}.\] (7)

### Robustness Enhancement Strategy

During the training process, we employ an augmentation strategy by adding Gaussian noise with a mean of 0 and standard deviations of \(s1\) and \(s2\) to the latent space and pixel space, represented as \( 1\) and \( 2\), respectively. The result is the acquisition of the perturbed images \(I_{p1}\) and \(I_{p2}\):

\[I_{p1}=D(FFT^{-1}(F_{Z}+_{m})+ 1),\] (8)

\[I_{p2}=D(FFT^{-1}(F_{Z}+_{m}))+ 2.\] (9)

The final loss is defined as:

\[=_{m}(I_{w})+_{m}(I_{p1})+_{m}(I_{ p2})+_{p}_{p}(I_{w},I)+_{i}_{i}(I_{w},I),\] (10)

where \(_{p}\) and \(_{i}\) are the respective weights for each loss function.

By incorporating corresponding attacks during training, we optimize the solution space for hidden message embedding, enabling the image to withstand a broader range of attacks. Experimental results reveal that this straightforward approach can effectively enhance the model's robustness against regeneration attacks.

## 5 Experiments

In this section, we evaluate our method based on the image quality and robustness metrics under various attacks, comparing it with the baseline methods. Additionally, ablation studies and analyses are carried out to explore the process deeply. In our experiments, KL auto-encoder  from Stable Diffusion  is used as the pre-trained VAE, and DINO v2 small  is used as the pre-trained image encoder. More implementation details are in the Appendix A.1.

### Experimental Setup

DatasetsA test dataset is compiled, consisting of 500 images randomly selected from the ImageNet validation set , in conjunction with 500 images generated using Stable Diffusion  based on prompts from the DiffusionDB  dataset. This diverse data collection enables a thorough assessment of the performance across various scenarios and perspectives.

Comparison MethodsThree methodologies are selected for comparison. DwtDctSvd  is a classic frequency-domain-based approach and the default watermarking method in Stable Diffusion . Stable Signature  embeds specific hidden messages by fine-tuning the VAE decoder of Stable Diffusion, enabling the watermarking process to be integrated with the generation process. SSL  is the latest method that employs image pixel optimization to embed watermarks. We employ their default configurations, wherein the PSNR threshold of SSL is set to 31 dB for a convenient comparison of bit accuracy.

Evaluation MetricsFollowing previous work [19; 20; 58], PSNR and SSIM  are used as the image quality benchmark. To evaluate robustness, we utilize bit accuracy as a metric to measure the degradation of hidden messages under diverse attacks. Various attack methods have been implemented, including a brightness change of 0.5, a contrast change of 0.5, 50% JPEG compression, Gaussian blur with a kernel size of 5, and Gaussian noise with \(\) = 0.05. Moreover, the experiments incorporate two types of VAE regeneration attacks [7; 13] from the CompressAI library  with a compression factor of 3, and a diffusion regeneration attack is carried out with 60 denoising steps .

### Benchmarking Watermark Accuracy and Image Quality

Table 1 displays the image quality and bit accuracy following watermark embedding on ImageNet  and DiffusionDB  datasets. The classic method DwtDctSvd  shows robustness against Gaussian attacks but poor performance against others, while the others show better robustness against

Figure 3: Examples of watermarked images. The first three columns are from ImageNet , and the others are generated by the prompts from DiffusionDB . These watermarked images have 48-bit messages and are robust to various attacks. **Top**: origin image. **Middle**: watermarked image. **Bottom**: pixel difference (amplified by a factor of 10 to enhance the visual effect).

brightness, contrast, and JPEG attacks but still poor in regeneration attacks. FreqMark demonstrates exceptional robustness against regeneration attacks with acceptable image quality.

We also calculate the PSNR and SSIM of the images from two datasets after VAE reconstruction. The data in Table 2 demonstrates that the impact of FreqMark on image quality is limited. Moreover, the standard deviation of image quality after FreqMark processing is also reduced to some extent.

In order to verify the hypothesis proposed in Section 3, we randomly select 2,000 clean images to perform message decoding in 128-bit and calculate the correlation coefficients between each bit, comparing them to random messages. Figure 4 shows that different bits with near-zero correlation coefficients can be considered as independent random variables.

Notably, FreqMark allows users to adjust image quality and encoding bits, showing remarkable robustness while maintaining acceptable image quality, particularly against VAE and diffusion regeneration attacks [9; 7; 13; 58]. We will further evaluate the robustness of FreqMark on the DiffusionDB dataset  in Section 5.4. The ablation studies in Section 5.5 will explore the impact of parameter adjustments on robustness.

### Why the Frequency Domain of Image Latent Space

To further illustrate the advantages of optimizing in the frequency domain of the image latent space, We conducted experiments using the same settings to optimize the pixel, the image latent space, and the frequency domain of image pixels in the DiffusionDB dataset . Simultaneously, enhancements in pixel and latent domains are retained (if the method involves the latent space). A consistent average image quality range is maintained for comparison purposes.

As illustrated in Figure 5 and Table 3, optimizing the frequency domain of image pixels provides the watermarked image with robustness against all attacks except the regeneration attack. In contrast,

    &  &  &  \\   & & & **None** & **Brightness** & **Contrast** & **JPEG** & **Gau. blur** & **Gau. noise** & **VAE-B** & **VAE-C** & **Diffusion** & **Avg** \\   \\ 
**DwitDicStQ** & **39.67** & **0.978** & 0.993 & 0.636 & 0.489 & 0.848 & 0.992 & **0.993** & 0.550 & 0.562 & 0.592 & 0.739 \\ \(\)std & 1.939 & 0.011 & 0.049 & 0.307 & 0.222 & 0.147 & 0.058 & 0.051 & 0.063 & 0.078 & 0.106 & N/A \\ SSL Watermark & 31.04 & 0.862 & **1.000** & **1.000** & **1.000** & 0.972 & **1.000** & 0.937 & 0.793 & 0.777 & 0.743 & 0.914 \\ \(\)std & 0.110 & 0.029 & 0.000 & 0.000 & 0.000 & 0.034 & 0.000 & 0.028 & 0.073 & 0.096 & 0.077 & N/A \\ \(\)std & 2.874 & 0.838 & 0.978 & 0.971 & 0.937 & 0.832 & 0.859 & 0.892 & 0.630 & 0.645 & 0.534 & 0.809 \\ \(\)std & 3.246 & 0.080 & 0.054 & 0.061 & 0.092 & 0.106 & 0.121 & 0.117 & 0.086 & 0.105 & 0.064 & N/A \\ FreqMark(Ours) & 31.27 & 0.857 & **1.000** & 0.995 & **1.000** & **0.991** & **1.000** & 0.939 & **0.938** & **0.924** & **0.969** & **0.973** \\ \(\)std & 3.359 & 0.038 & 0.000 & 0.028 & 0.000 & 0.024 & 0.000 & 0.088 & 0.083 & 0.081 & 0.052 & N/A \\   \\ 
**DwitDicStQ** & **39.49** & **0.978** & **1.000** & 0.607 & 0.457 & 0.887 & **1.000** & **1.000** & 0.563 & 0.556 & 0.569 & 0.738 \\ \(\)std & 1.182 & 0.006 & 0.000 & 0.308 & 0.194 & 0.109 & 0.000 & 0.000 & 0.053 & 0.059 & 0.085 & N/A \\ SSL Watermark & 31.01 & 0.827 & **1.000** & **1.000** & **1.000** & 0.956 & **1.000** & 0.954 & 0.742 & 0.744 & 0.729 & 0.903 \\ \(\)std & 0.064 & 0.027 & 0.000 & 0.000 & 0.0048 & 0.000 & 0.037 & 0.109 & 0.102 & 0.081 & N/A \\ Stable Signature & 28.31 & 0.844 & 0.996 & 0.996 & 0.990 & 0.896 & 0.858 & 0.967 & 0.668 & 0.733 & 0.527 & 0.848 \\ \(\)std & 1.608 & 0.033 & 0.013 & 0.012 & 0.014 & 0.042 & 0.086 & 0.028 & 0.063 & 0.049 & 0.040 & N/A \\ FreqMark(Ours) & 31.20 & 0.854 & **1.000** & **1.000** & **1.000** & **1.000** & **1.000** & 0.934 & **0.925** & **0.897** & **0.945** & **0.967** \\ \(\)std & 1.538 & 0.029 & 0.000 & 0.000 & 0.000 & 0.000 & 0.000 & 0.061 & 0.066 & 0.059 & 0.047 & N/A \\   

Table 1: Performance of different watermarking methods on ImageNet and DiffusionDB.

   Dataset & PSNR & SSIM \\   \\ ImageNet  & 31.37 \(\) 4.59 & 0.868 \(\) 0.085 \\ DiffusionDB  & 31.22 \(\) 1.96 & 0.879 \(\) 0.032 \\   \\ ImageNet  & 31.27 \(\) 3.36 & 0.857 \(\) 0.038 \\ DiffusionDB  & 31.20 \(\) 1.54 & 0.854 \(\) 0.029 \\   

Table 2: Comparison of image quality between VAE and FreqMark.

images obtained by optimizing the image latent space appear more natural and smooth, with a strong correlation to the semantic information of the image. This approach demonstrates robust potential against diffusion attacks, indicating that both optimization methods have unique features. Combining the advantages of both approaches, FreqMark optimizes the frequency space of the image latent. The watermark is closely related to local patterns while retaining the characteristics of frequency domain optimization. Combining these two aspects produces a synergistic effect, making FreqMark robust against regeneration attacks.

### Further Robustness Results

Diffusion Attack StepsWe evaluate the impact of diffusion attacks of varying intensities on bit accuracy and also calculate the PSNR between the attacked image and the original watermarked image. Table 4 indicates that FreqMark maintains commendable robustness even under higher intensity attacks.

Vae Attack StrengthWe employ the same VAE used in the watermarking process of FreqMark to conduct perturbation attacks. Table 5 demonstrates that FreqMark exhibits exceptional robustness under such attacks. This is because the perturbation on the latent FFT changes the overall distribution of the image latent, making the watermark message affect the entire image

   Diffusion Steps & 60 & 80 & 100 & 120 & 140 & 160 & 180 & 200 \\  Bit Acc & 0.945 & 0.863 & 0.831 & 0.754 & 0.712 & 0.692 & 0.660 & 0.637 \\ PSNR & 27.67 & 26.95 & 26.19 & 25.46 & 24.92 & 24.47 & 23.99 & 23.57 \\   

Table 4: Performance under Different Diffusion Steps.

Figure 5: Watermarked images under different optimization locations. We compared four distinct optimization objectives for watermark embedding, including the image pixel domain, the frequency domain of the image pixel, the image latent space, and the frequency domain of the image latent space (ours). The difference after watermarking addition is amplified by a factor of 10.

    &  &  &  \\   & & & **None** & **Brightness** & **Contrast** & **JPEG** & **Gau. blur** & **Gau. noise** & **VAE-B** & **VAE-C** & **Diffusion** & **Avg** \\  Pixel & **31.36** & 0.771 & 0.950 & 0.935 & 0.937 & 0.848 & 0.885 & 0.925 & 0.642 & 0.654 & 0.542 & 0.813 \\ Pixel Frequency & 31.31 & 0.809 & **1.000** & **1.000** & **1.000** & 0.950 & 0.937 & **1.000** & 0.797 & 0.775 & 0.596 & 0.895 \\ Latent & 31.35 & **0.886** & 0.994 & 0.993 & 0.981 & 0.906 & 0.979 & 0.804 & 0.796 & 0.833 & 0.675 & 0.885 \\ Latent Frequency & 31.20 & 0.854 & **1.000** & **1.000** & **1.000** & **1.000** & 0.934 & **0.925** & **0.897** & **0.945** & **0.967** \\   

Table 3: Performance of different optimization locations.

is difficult for perturbations on the latent of image to damage the watermark message. A similar phenomenon is observed in the pixel FFT when facing the Gaussian Noise attack.

Adversarial AttackFollowing the settings in , we apply adversarial attacks targeting the latent representations of the watermarked images.

\[max_{I_{adv}}|E(I_{adv})-E(I)\|_{2},s.t.\|I_{adv}-I\|_{}\] (11)

Table 6 demonstrates that FreqMark exhibits strong robustness when facing adversarial attacks targeting latent representations. We believe that this can be attributed to the limited impact of attacks targeting latent representations on the latent FFT domain.

### Ablation Studies

Image QualityAs watermarking always requires modifications to the image pixels, a trade-off between image quality and embedded message robustness is inevitable. FreqMark allows users to find a satisfactory balance. We control watermarked image quality within a specific range by adjusting the weight of the PSNR loss function. As shown in Figure 5(a), FreqMark can achieve a PSNR that is nearly 2dB higher compared to the reconstruction obtained using VAE with robustness against varying attacks, maintaining strong performance with over 80% accuracy.

Encoding BitsThe number of bits in the encoding message significantly impacts robustness, with more bits embedded at a given image quality potentially reducing robustness. FreqMark allows users to adjust the watermark bit number based on their needs. Figure 5(b) shows bit accuracy for encoding bit numbers. We test robustness from 32 to 128 bits of watermark message in 16-bit increments, setting the PSNR of the watermarked image to about 31 dB. FreqMark also demonstrates strong robustness, with the lowest bit accuracy remaining above 0.75 even under regeneration attacks on images watermarked with 128-bit messages.

Noising ScaleWe also study the impact of latent noise \(_{1}\) and pixel noise \(_{2}\) on robustness. Incorporating noise attacks during training can effectively improve robustness in Gaussian noise and regeneration attacks, but excessive noise may disrupt training and reduce performance. We analyze how noises in latent and pixel space affect robustness by fixing either \(_{1}\) or \(_{2}\) and changing the other standard deviation. As shown in Figure 5(c) and Figure 5(d), the results confirm that introducing both types of noise positively influences robustness, and adding an appropriate amount of noise can significantly enhance resistance against regeneration attacks. We finally set \(_{1}\) to 0.25 and \(_{2}\) to 0.06 based on the experimental results. The complete experimental data can be found in Table 11 of the Appendix A.3.

Spacial PerturbationsThe bit accuracy of FreqMark significantly declines under specific spatial transformation attacks, such as rotation and cropping. By incorporating relevant augmentations like

   Attack Strength (eps) & Bit Acc & TPR@0.1\%FPR \\ 
2/255 & 1.000 & 1.000 \\
4/255 & 0.987 & 1.000 \\
6/255 & 0.944 & 0.986 \\
8/255 & 0.893 & 0.972 \\   

Table 6: Performance under Different Adversarial Attack Strength.

    &  &  \\  PSNR & 31.43 & 30.31 & 28.98 & 27.39 & 25.82 & 31.09 & 29.68 & 28.04 & 26.46 & 25.04 \\ Bit Acc & 1.000 & 1.000 & 0.998 & 0.990 & 0.975 & 1.000 & 1.000 & 1.000 & 1.000 & 1.000 \\   

Table 5: Performance under VAE Attack in Latent FFT Domain and Gaussian Noise Disruption in Pixel FFT Domain.

random rotation and random cropping during training, we effectively bolster the robustness against these transformations, as evidenced in Table 7.

## 6 Conclusion

In this paper, we introduce a technique for embedding hidden messages in images by optimizing the frequency domain in the latent space, named FreqMark, providing remarkable robustness due to deeper perturbations. FreqMark allows user-defined encoding bits and watermark strength, striking an optimal balance between image quality and robustness.

Limitations and Broader ImpactsFreqMark exhibits notable flexibility and robustness, yet there is room for optimization, particularly in the degree of naturalness in the fusion of watermarks and images. Future research can focus on improving image quality and human perceptibility constrained by the limitations of VAE, as a superior VAE would likely boost processing time and overall effectiveness. FreqMark presents an innovative image watermarking approach for image provenance, copyright protection, etc. However, like other image watermarking methods, it also necessitates the prevention of unauthorized misuse such as copyright abuse .

    &  \\   & Resize 0.3 & Rotate 90 & Crop 0.7 \\  ✗ & 0.961 & 0.621 & 0.721 \\ ✓ & 0.968 & 0.927 & 0.921 \\   

Table 7: Performance on Spatial Perturbations.

Figure 6: Impact of different parameter settings on the robustness of the watermark. **(a)** Bit accuracy under different watermarked image quality (48 bits). **(b)** Bit accuracy under different encoding bits (31dB). **(c)** Bit accuracy under different latent noise \(_{1}\) (\(_{2}=0.06\)). **(d)** Bit accuracy under different latent noise \(_{2}\) (\(_{1}=0.25\)).