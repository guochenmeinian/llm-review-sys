# Differentially Private Sequential Data Synthesis with Structured State Space Models and Diffusion Models

Differentially Private Sequential Data Synthesis with Structured State Space Models and Diffusion Models

 Tomoya Matsumoto\({}^{1}\) Takayuki Miura\({}^{1,2}\) Toshiki Shibahara\({}^{2}\) Masanobu Kii\({}^{2}\) Kazuki Iwahana\({}^{1,2}\) Osamu Saisho\({}^{2}\) Shingo Okamura\({}^{1,3}\)

\({}^{1}\)Osaka University \({}^{2}\)NTT Social Informatics Laboratories

\({}^{3}\)National Institute of Technology, Nara College

t-matsumoto@ist.osaka-u.ac.jp

{tkyk.miura,toshiki.shibahara,masanobu.kii}@ntt.com

{kazuki.iwahana,osamu.saisho}@ntt.com

okamura@info.nara-k.ac.jp

###### Abstract

Sequential data such as electrocardiograms and electroencephalograms are being increasingly utilized, and protecting the privacy of individuals in data has become an important issue. For statistical analysis while preserving privacy, data synthesis with differential privacy (DP) has been attracting attention. However, DP synthetic data generally suffers from a decrease in quality. In this paper, we aim to achieve high-quality DP synthesis for sequential data. First, we show that previous DP sequential data synthesis has quality issues. We then propose DP structured state space diffusion (DP-SSSD), a DP sequential data synthesis method based on novel generative AI, which combines structured state space models and diffusion models. Experiments show that DP-SSSD can generate higher-quality sequential data than the previous methods under equal privacy protection strength.

## 1 Introduction

With the spread of wearable devices and advances in data analysis technology, sequential data such as electrocardiograms (ECGs) and electroencephalograms (EEGs) are being increasingly collected and utilized [17; 4]. These data are valuable, for example, in the healthcare field, where they can be used for early detection and prevention of diseases. However, handling such data requires careful consideration because they contain private information such as personal health and should not be shared with third parties as they are.

To solve this issue, data synthesis techniques based on differential privacy (DP)  have attracted attention for statistical analysis of sensitive data. Its generated data are called privacy-preserving synthetic data because they retain the statistical characteristics of the raw data while making it difficult to invade the privacy of individuals . However, it requires noise to be added to satisfy DP and thus suffers from a trade-off between utility and privacy protection strength. In particular, sequential data synthesis is a difficult task in itself, so improving the privacy-utility trade-off of differentially private sequential data is a major challenge.

Therefore, this paper aims to generate high-quality sequential data that satisfy DP by combining a structured state space model [13; 12] and a diffusion model , which are recent breakthroughs in the field of deep learning. The main contributions of this paper are as follows: (1) We demonstrate that previous differentially private sequential data synthesis  has quality issues. (2) We propose a differentially private generative model using structured state space models and diffusion models and evaluate its synthesis quality on ECG and EEG datasets. (3) We show that the proposed method can generate higher-quality sequential data than the previous method under equal privacy protection strength. (4) To improve the privacy-utility trade-off, we test a method to reduce the amount of noise per parameter by fixing weight parameters that are not to be updated much during training and show its effectiveness in a classification task.

## 2 Preliminary

In this section, we introduce basic concepts and models to describe our results.

### Differential Privacy (DP)

DP is a framework that guarantees the privacy of individuals in a dataset.

**Definition 2.1** (Neighboring datasets): _Datasets \(D,D^{}\) are called neighboring datasets if \(D\) and \(D^{}\) differ only in one record._

**Definition 2.2** (\((,)\)-Dp): _A randomized function \(f\) satisfies \((,)\)-DP if for any neighboring \(D,D^{}\) and any range \(S\), it holds that_

\[[f(D) S] e^{}[f(D^{}) S]+.\] (1)

The smaller the values of \(,\), the stronger the privacy protection. \(\) is called the privacy loss.

DP-SGD is a modified version of stochastic gradient descent (SGD) and is widely used to train neural networks with DP. In regular SGD, the weight parameters \(\) are updated using the gradient \(\). In DP-SGD, the gradient is clipped, as shown in Eq. (2), and Gaussian noise is added to it. Here, \(x_{i}\) is a data sample, \(C\) is an upper bound of the norm, \(\) is the learning rate, \(L\) is the batch size and \(\) is the noise multiplier.

\[}_{t}(x_{i}) _{t}(x_{i})/1,_ {t}(x_{i})\|_{2}}{C},\] (2) \[_{t+1} _{t}-}{L}(_{i}}_{t}(x_{i})+(0,^{2}C^{2})).\] (3)

The privacy loss in DP-SGD is calculated on the basis of the number of uses of the original dataset by the trained model. Many versions of DP-SGD have been proposed [1; 23; 11].

### Structured State Space Model

The structured state space model is a sequential model that uses the state space representation expressed by Eq. (4). Here, \(u(t)\) is the input signal, \(x(t)^{N}\) is the latent state and \(y(t)\) is the output signal, where \(\) is the set of real numbers. \(^{N N},^{N 1}, ^{1 N},\) and \(\) are trainable parameters, where \(\) is the set of complex numbers.

\[x^{}(t)=x(t)+u(t), y(t)=x(t)+u(t).\] (4)

By discretizing Eq. (4), it can be expressed in recursive form as in Eq. (5).1 Here, \(\) is a trainable parameter, which expresses the step size.

\[& x_{k}=}x_{k-1}+}u _{k}, y_{k}=}x_{k},\\ &}=(),}=( )^{-1}(()-), }=.\] (5)

Also, Eq. (5) can be expressed in convolution form as in Eq. (6).

\[y=u*},}=(}, }}},,} }^{L-1}}).\] (6)

The parameter \(\) requires appropriate initial values. The parameter of S4D , which is a structured state space model, is expressed by the following diagonal matrix:

\[_{nn}=-+i n.\] (7)

### Diffusion Model

A diffusion model  is a generative model consisting of a diffusion process and a denoising process described as follows;

\[q(x_{t}|x_{t-1})=(x_{t};}x_{t-1},_{t}I), p _{}(x_{t-1}|x_{t})=(x_{t-1};_{}(x_{t},t),_{ }(x_{t},t)).\] (8)

In the diffusion process, we transform observed data \(x_{0}\) into noise \(x_{T}\) by adding Gaussian noise in accordance with the noise schedule \(_{t}\). In the denoising process, we reconstruct the data \(x_{0}\) from the noise \(x_{T}\) by repeating the denoising noises with a neural network \(\). The loss function is defined as follows:

\[L:=_{t,x_{0},}||-_{}(_{t}}x_{0}+_{t}},t)||^{2}.\] (9)

This expresses the error of the estimation of noise \(\). Here, we set \(_{t}:=_{s=1}^{t}(1-_{s})\). In the diffusion model, the neural network is trained to minimize this error.

## 3 Related Work

In this section, we describe sequential data synthesis and differentially private data synthesis as the related work.

### Sequential Data Synthesis

The sequential data synthesis is generally performed using deep learning models, which can be further classified into four types depending on the generative model used: generative adversarial network (GAN), auto-regressive model, variational autoencoder (VAE), and diffusion model.

GAN has been the most widely used model in data synthesis. In particular, TimeGAN  is a well-established method for sequential data synthesis. However, when we experimented with ECG and EEG data, TimeGAN failed to generate useful samples. This has been pointed out in previous studies .

For the sequential data synthesis by auto-regressive models, the conditional probabilistic auto-regressive model (CPAR)  is widely used. CPAR is employed in the synthetic data library Synthetic Data Vault , but in our experiments, CPAR was unable to generate useful samples, similar to TimeGAN. Nishikimi et al.  proposed an approach for synthesizing sequential data using a VAE. This method uses ECG data on hearts simulated by a supercomputer, whereas we focus on only raw ECG data in this paper.

Diffusion models have recently garnered attention as data synthesis methods surpassing GANs. Alcaraz and Strodthoff  presented structured state space diffusion (SSSD), which synthesizes sequential data using a diffusion model. SSSD combines DiffWave , which is a diffusion-based speech synthesis method, with S4 , which is a type of structured state space model. Our experimental results on ECG and EEG data show that SSSD can generate higher-quality sequential data than conventional models. Therefore, we implement and evaluate a DP-compliant synthesis method based on SSSD in this paper.

### Differentially Private Data Synthesis

The related works mentioned in Section 3.1 are all methods that do not satisfy DP. Therefore, in this section, we review related research on data synthesis methods that satisfy DP.

In our experiments, we use diffusion models and structured state space models, and one diffusion model that satisfies DP is Differentially Private Diffusion Model (DPDM) . DPDM trains a diffusion model using DP-SGD and introduces a technique called noise multiplicity to improve generation quality. However, DPDM is designed for image generation models and does not evaluate diffusion models that satisfy DP for sequential data synthesis. Additionally, to our knowledge, there is no research applying DP to structured state space models.

On the other hand, several studies provide differentially private sequential data synthesis [8; 3; 29]. All of these methods involve training GAN models with DP-SGD. In particular, Renyi DP and Convolutional GAN (RDP-CGAN)  focuses on synthesizing ECG and EEG data, the sameas in this paper, so we evaluate RDP-CGAN as a baseline on the basis of the public source code. RDP-CGAN is a deep learning model that combines a one-dimensional convolutional neural network (1D-CNN) and GAN and adopts a method based on Renyi DP  to calculate privacy loss .

## 4 Evaluation of Previous Method

This section presents the issue of a previous method for differential private sequential data synthesis and describes the problem setup for the experiments in Section 5.

### Issues in Previous Method

Existing studies of differentially private sequential data synthesis described in Section 3.2 face a major challenge in term of the quality of synthetic data. Figure 1 shows ECG and EEG waveforms generated by RDP-CGAN . The figure shows that differentially private synthetic data struggles to reproduce the features and diversity of the raw data, regardless of privacy protection strength. This is largely due to a problem common to GAN models called mode collapse , which is particularly likely to occur in learning with DP-SGD. This is because DP-SGD cannot use batch normalization , which helps stabilize the learning of the GAN model, to limit the impact of each sample on the sum of gradients. Instead, group normalization  is used, but this change prevents cross-sample normalization, making the GAN model training unstable and prone to mode collapse. Therefore, a generative model needs to be used that is less prone to mode collapse to generate high-quality differentially private synthetic data.

### Purpose of This Paper

Considering the issues of the previous study, this paper proposes a differentially private generative model based on SSSD , a synthesis method using a diffusion model. Specifically, we applied DP-SGD to the SSSD model that is not differentially private to make it satisfy DP. This differentially private SSSD model is hereafter referred to as DP-SSSD.

Section 5 proceeds as follows. Section 5.2.1 evaluates and compares the synthesis quality of the structured state space model with that of other sequential models. The SSSD model uses structured state space models for the inner sequential model, and an experiment to verify whether the choice is optimal is described. Section 5.2.2 evaluates and compares the synthesis quality of DP-SSSD with that of the previous method, RDP-CGAN. The purpose of this experiment was to clarify whether DP-SSSD can synthesize higher-quality sequential data than RDP-CGAN.

Figure 1: The first row is a waveform of raw data, and the second to fourth rows are waveforms generated by RDP-CGAN with varying epsilon values (\(=100,10,1\)). The first and second columns represent ECG, and the third and fourth columns represent EEG, each containing normal (negative) and abnormal (positive) samples, respectively.

## 5 Experiments

In this section, we evaluate the synthesis performance of the proposed method on ECG and EEG data.

### Experimental Settings

#### 5.1.1 Datasets

We use ECG and EEG datasets in the experiments because they are widely used in sequential data synthesis research and are considered to be of high privacy-preserving importance. We use the MIT-BIH arrhythmia database [24; 9] for ECG and the epileptic seizure recognition dataset from the UCI Machine Learning Repository  for EEG. Hereafter, we refer to them as ECG/EEG data.

Both datasets are preprocessed and used as single-channel signals with a sampling frequency of 180 Hz for 1 second. The ECG samples are labeled as normal or ventricular ectopic beats, and the EEG samples are labeled as normal or epileptic seizures. In this paper, normal samples are labeled negative, and abnormal samples are labeled positive. Each dataset is divided into training and test data. The training data is used to train the generative model and the test data is used to evaluate the performance of the classification models, as described below. In the experiments in this paper, the number of samples generated by a generative model is always equal to the number of samples of training data. Table 1 shows a breakdown of the number of samples for each dataset.

#### 5.1.2 Synthesis Method

DP-SSSD uses a structured state space model as a sequential model, with the model overview shown in Figure 2. The original SSSD model uses a structured state space model called S4 , but DP-SSSD uses S4D , which is smaller than S4 and has the same level of performance. The generative model is smaller than the original SSSD model because the smaller the number of parameters in the model, the smaller the effect of noise added by DP-SGD .

We used the Python library Opacus  to implement DP-SGD and the privacy loss was calculated using the library's standard method, Privacy Loss Random Variables (PRVs) . We also reimplemented RDP-CGAN, which was used as a prior method, using PRVs to ensure a fair comparison with DP-SSSD. The value of \(\), which affects the strength of privacy protection, was set to \(5.0 10^{-5}\) for the ECG data and \(1.0 10^{-4}\) for the EEG data on the basis of the number of samples.

#### 5.1.3 Evaluation Metrics

As reliable evaluation metrics based on the results of previous studies and preliminary experiments, we adopted the following three metrics: (1) For visual evaluation, we plot the waveform of synthetic sequential data. The more similar the shape is to that of the raw data, the higher the synthesis quality. Following previous studies , we draw the median of all samples as a solid line and the interquartile range as a band. (2) We compare the performances of classification models trained on the labeled synthetic data. The smaller the drop in the performance when trained on the raw data, the higher the synthesis quality. We use CatBoost , a decision tree-based model, and a deep learning-based model (Deep Neural Network; DNN) . Following the previous study , the area

Figure 2: Overview of the implemented model. DP-SSSD is the one that uses S4D for the sequential model.

under the receiver operating characteristic curve (AUROC) and the area under the precision-recall curve (AUPRC) are used as the performance metrics. Table 1 shows the performance of classification models trained on the raw training data. (3) We compare the distribution of synthetic data using the dimensionality reduction technique. The closer the distribution is to that of the raw data, the higher the synthesis quality. We use t-distributed Stochastic Neighbor Embedding (t-SNE)  as the dimensionality reduction technique.

### Results

#### 5.2.1 Comparison of Structured State Space Models with Other Sequential Models

First, to clarify whether the structured state space model (S4D) is the most appropriate sequential model to be included in the diffusion model, we compared the synthesis quality using S4D with other sequential models. For comparison, we chose LSTM , Transformer  and 1D-CNN, which are representative sequential models. However, Transformer and 1D-CNN were unable to generate meaningful samples, so only the results for S4D and LSTM are included in this paper.

Figure 3 shows the synthetic ECG and EEG using S4D or LSTM. This figure shows that S4D can reproduce the detailed features of the raw data waveforms better than LSTM. The difference is especially noticeable in the positive EEG samples. Table 2 shows the performance of classification models trained on each synthetic data. S4D has a higher AUPRC on ECG data than LSTM, which means the model can be trained to correctly classify a small number of positive samples. In the visualized data distribution shown in Figure 5, the synthetic data distribution using S4D is closer to the raw data distribution than that using LSTM is. These results indicate that the structured state space model (S4D) is suitable for sequential data synthesis.

   &  &  &  &  \\   & Num. of & Pos. & Num. of & Pos. &  &  &  &  \\  & samples & rate & samples & rate & & & & \\   ECG & 30,810 & 20\% & 24,179 & 3.2\% & 0.81 \(\).007 & 0.87 \(\).009 & 0.45 \(\).035 & 0.23 \(\).060 \\ EEG & 9,200 & 20\% & 2,300 & 20\% & 1.00 \(\).000 & 0.99 \(\).001 & 0.98 \(\).001 & 0.95 \(\).003 \\  

Table 1: The left side shows the number of samples and positive rates for each dataset, while the right side shows the performance of classification models trained on the raw data.

   & Sequential &  &  \\   & model & CatBoost & DNN & CatBoost & DNN \\    & S4D & 0.75 \(\).002 & 0.82 \(\).009 & **0.56 \(\).037** & 0.37 \(\).065 \\  & LSTM & 0.80 \(\).009 & **0.88 \(\).024** & 0.27 \(\).053 & 0.19 \(\).018 \\   & S4D & 0.98 \(\).001 & 0.98 \(\).002 & 0.93 \(\).012 & **0.94 \(\).009** \\  & LSTM & **0.99 \(\).000** & 0.98 \(\).001 & 0.92 \(\).005 & **0.94 \(\).003** \\  

Table 2: Classification performance trained on synthetic ECG/EEG using S4D/LSTM for the sequential model.

Figure 3: The first row is a waveform of raw ECG/EEG, and the second and third rows are waveforms of synthetic ECG/EEG using S4D/LSTM for the sequential model.

#### 5.2.2 Comparison of DP-SSSD with RDP-CGAN

We evaluated the synthesis quality of DP-SSSD and RDP-CGAN under various privacy loss values \(\). Figure 4 shows the ECG and EEG waveforms generated by DP-SSSD. Comparing this figure with the waveforms in Figure 1, DP-SSSD can clearly generate differentially private synthetic data more similar to the raw data waveforms than RDP-CGAN. DP-SSSD succeeds in generating waveforms that satisfy DP without mode collapse due to stable learning, which is one of the advantages of the diffusion model. However, the stronger the privacy protection, the more features of the raw data are lost, and especially for \(=1\), it fails to generate meaningful waveforms.

Table 3 shows the performance of classification models trained on differentially private synthetic ECG/EEG. DP-SSSD outperformed RDP-CGAN for all \(\) values. Figure 6 shows the distribution of differentially private synthetic data visualized by t-SNE. This figure also shows that DP-SSSD can generate more diverse data than RDP-CGAN. These results indicate that DP-SSSD can generate differentially private sequential data of higher quality than RDP-CGAN in the previous study. On the other hand, in a strong privacy protection setting such as \(=1\), waveforms that resemble the raw data are difficult to generate even with DP-SSSD.

## 6 Additional Analysis

In this section, we propose a method to improve the privacy-utility trade-off of structured state space models and examine its effectiveness.

### Fixing Weight Parameters

The experimental results in the previous section revealed that the quality of synthetic waveforms deteriorates significantly when privacy protection is strengthened. Therefore, it is necessary to reduce the effect of noise added to the gradient in DP-SGD and improve the quality of the learning

Figure 4: The first row is a waveform of raw ECG/EEG, and the second to fourth rows are waveforms generated by DP-SSSD with varying epsilon values (\(=100,10,1\)).

   &  &  &  &  \\   & &  &  &  &  \\   & & CatBoost & DNN & CatBoost & DNN & CatBoost & DNN & CatBoost & DNN \\   DP- \\ SSSD \\  } & 10 & 0.81 \(\) 0.034 & **0.86 \(\) 0.024** & **0.52 \(\) 0.014** & 0.33 \(\) 0.038 & **0.98 \(\) 0.000** & **0.98 \(\) 0.003** & 0.92 \(\) 0.010 & **0.94 \(\) 0.000** \\  & 10 & 0.77 \(\) 0.06 & **0.85 \(\) 0.028** & **0.45 \(\) 0.002** & 0.16 \(\) 0.008 & **0.98 \(\) 0.000** & 0.97 \(\) 0.014 & 0.98 \(\) 0.000 & **0.93 \(\) 0.017** \\  & 1 & **0.86 \(\) 0.02** & 0.62 \(\) 0.017 & **0.16 \(\) 0.006** & 0.05 \(\) 0.000 & **0.97 \(\) 0.002** & 0.97 \(\) 0.003 & 0.91 \(\) 0.010 & **0.93 \(\) 0.003** \\   RDP- \\ CGAN \\  } & 10 & 0.64 \(\) 0.049 & 0.53 \(\) 0.059 & 0.05 \(\) 0.009 & 0.05 \(\) 0.020 & 0.84 \(\) 0.001 & 0.72 \(\) 3.15 & 0.74 \(\) 0.20 & 0.62 \(\) 3.354 \\  & 10 & 0.50 \(\) 0.061 & 0.51 \(\) 0.023 & 0.04 \(\) 0.008 & 0.04 \(\) 0.004 & 0.74 \(\) 0.097 & 0.89 \(\) 0.060 & 0.54 \(\) 1.23 & 0.84 \(\) 0.055 \\  & 1 & 0.66 \(\) 0.015 & 0.54 \(\) 1.65 & 0.05 \(\) 0.001 & 0.07 \(\) 0.057 & 0.81 \(\) 0.000 & 0.85 \(\) 0.054 & 0.68 \(\) 0.000 & 0.77 \(\) 0.024 \\  

Table 3: Classification performance trained on differentially private synthetic ECG/EEG generated by DP-SSSD/RDP-CGAN.

results. While some DP-SGD learning methods have been proposed for diffusion models and transformers [6; 5], this section examines the effectiveness of a simple method focused on structured state space models (S4D).

Specifically, differentially private learning is performed with \(\) and \(\), two of the weight parameters of the structured state space model described in Section 2.2, fixed at their initial values. \(\) and \(\) are parameters that repeatedly affect the latent state \(x\) in Equation (5), and since small changes in these parameters greatly impact the model, a small learning rate is specially set. Preliminary experiments have shown that the usual non-DP learning with these parameters fixed to their initial values barely affects the accuracy. As mentioned in Section 5.1.2, the smaller the number of model parameters in DP-SGD, the smaller the effect of added noise, so we will experimentally verify whether fixing the above parameters improves the quality of differentially private learning.

### Effectiveness of Parameter Fixing

First, we examine the effect of parameter fixing on a classification task using the structured state space model (S4D) alone. The reason for this is that there are few weight parameters other than the S4D model, and the effect of parameter fixing is easy to understand. A classifier using the S4D model is trained on the flattened CIFAR-10  (sCIFAR) . Table 4 shows the classification accuracy when parameters are and are not fixed. The classification accuracy is higher when the parameters are not fixed in the usual non-DP training, but the accuracy is higher when the parameters are fixed in differentially private training.

Next, the effect of fixing parameters is verified by generating ECG and EEG using the same DP-SSSD as in Section 5. Table 5 shows the performance of classification models trained on differentially private synthetic data when the parameters are fixed. Figure 7 shows the differentially private synthetic (positive) waveforms with and without parameter fixing. When the parameters were fixed, although the quality of the synthetic waveforms did not improved, the AUPRC of the ECG did. Thus, parameter fixing can be said to effectively improve some tasks.

## 7 Conclusion

In this paper, we proposed differential privacy structured state space diffusion (DP-SSSD), a differentially private synthesis method combining structured state space models and diffusion models to achieve high-quality sequential data synthesis that satisfies DP. We evaluated it using ECG and EEG datasets and experimental results showed that DP-SSSD can generate higher-quality sequential data than previous methods under equal privacy protection strength, as indicated by several evaluation metrics. In addition, we verified that fixing some of the weight parameters is effective to improve quality, especially in the classification task.

Future work is to develop a method that can generate synthetic sequences that accurately capture the characteristics of the raw data even in strong privacy-preserving settings. This will require a sequential generative model that is more compact and robust to noise. Future work includes validation using long-time sequential data and sequences other than biosignals.

  \(\) & No fix & Fix \\   inf & \(\) & \(75.1 0.20\) \\
100 & \(53.0 0.47\) & \(\) \\
10 & \(48.8 0.36\) & \(\) \\
1 & \(42.3 0.65\) & \(\) \\  

Table 4: S4D classification accuracy on sCIFAR dataset. The left and right columns show the cases where the parameters are not fixed and are fixed, respectively.

   &  &  &  \\   & & CatBoost & DNN & CatBoost & DNN \\    & 100 & 0.79 (\(\) 0.2) & 0.89 (\(\)0.3) & 0.56 (\(\)0.04) & 0.45 (\(\)1.12) \\  & 10 & 0.84 (\(\)0.07) & 0.85 (\(\)00) & 0.53 (\(\)0.08) & 0.23 (\(\)0.07) \\  & 1 & 0.72 (\(\) 1.4) & 0.63 (\(\)0.01) & 0.19 (\(\)0.03) & 0.05 (\(\)00) \\   & 100 & 0.98 (\(\) 00) & 0.98 (\(\) 00) & 0.88 (\(\)0.04) & 0.94 (\(\)00) \\  & 10 & 0.98 (\(\) 00) & 0.98 (\(\)0.01) & 0.92 (\(\)0.03) & 0.94 (\(\)0.01) \\   & 1 & 0.95 (\(\) 0.2) & 0.95 (\(\)0.02) & 0.86 (\(\)0.05) & 0.90 (\(\)0.03) \\  

Table 5: Classification performance trained on synthetic ECG/EEG by DP-SSSD when the weights are fixed and the difference in performance when the weights are not fixed. \(\) represents a performance improvement and \(\) represents a deterioration.