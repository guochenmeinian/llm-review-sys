# Experiment Planning with Function Approximation

Aldo Pacchiano

Broad Institute & Boston University

apacchia@broadinstitute.org &Jonathan N. Lee

Stanford University

jnl@stanford.edu &Emma Brunskill

Stanford University

ebrun@cs.stanford.edu

###### Abstract

We study the problem of experiment planning with function approximation in contextual bandit problems. In settings where there is a significant overhead to deploying adaptive algorithms--for example, when the execution of the data collection policies is required to be distributed, or a human in the loop is needed to implement these policies--producing in advance a set of policies for data collection is paramount. We study the setting where a large dataset of contexts but not rewards is available and may be used by the learner to design an effective data collection strategy. Although when rewards are linear this problem has been well studied , results are still missing for more complex reward models. In this work we propose two experiment planning strategies compatible with function approximation. The first is an eluder planning and sampling procedure that can recover optimality guarantees depending on the eluder dimension  of the reward function class. For the second, we show that a uniform sampler achieves competitive optimality rates in the setting where the number of actions is small. We finalize our results introducing a statistical gap fleshing out the fundamental differences between planning and adaptive learning and provide results for planning with model selection.

## 1 Introduction

Data-driven decision-making algorithms have achieved impressive empirical success in various domains such as online personalization [4; 48], games [36; 43], dialogue systems  and robotics [25; 35]. In many of these decision-making scenarios, it is often advantageous to consider contextual information when making decisions. This recognition has sparked a growing interest in studying adaptive learning algorithms in the setting of contextual bandits [26; 33; 6] and reinforcement learning (RL) . Adaptive learning scenarios involve the deployment of data collection policies, where learners observe rewards or environment information and utilize this knowledge to shape subsequent data collection strategies. Nonetheless, the practical implementation of adaptive policies in real-world experiments currently presents significant challenges. First, there is significant infrastructure requirements and associated overheads which require skills and resources many organizations lack. For example, while there are end-user services that enable organizations to automatically send different text messages to different individuals, such services typically do not offer adaptive bandit algorithms. Second, the resulting reward signal may be significantly delayed. As an example, the effect of personalized health screening reminders on a patient making a doctors appointments may take weeks. Therefore, while it is increasingly recognized that there exist other settings where context-specific policies are likely to be beneficial, including behavioural science, many organizations working in these settings may find it infeasible to run experiments with adaptive policies. To bridge this gap, there is a need to explore the deployment of non-adaptive or static strategies that can effectively collect data with minimal or no updates. Surprisingly, limited research has been conducted to investigate this particular setting, highlighting the importance of further exploration in this area.

In this work, we consider how to design a static experimental sampling strategy for contextual multi-armed bandit settings which, when executed, will yield a dataset from which we can compute a near-optimal contextual policy (one with small simple regret). Our framework closely adheres to the experiment planning problem formulation originally introduced by . The problem involves a learner interacting with a contextual bandit problem where the reward function is unknown. Our assumption is that the learner possesses a substantial offline dataset comprising of \(m\) sample contexts, none of which include reward information. The learner's objective is to utilize this data to design a static policy sequence of length \(T\) (where \(m T\)) that enables the collection of valuable reward information when deployed in the real world. The ultimate goal is to produce an almost optimal policy using the data gathered during deployment. To address this scenario, the authors of  propose a two-phase approach involving Planner and Sampler algorithms. In the planner phase, the learner employs the context data to generate a set of sampling policies, which are then utilized in the sampler phase. The primary focus of  lies in the analysis of the linear case, assuming the reward function to be a linear function of the context vectors. Their key algorithmic contribution is the linear Planner Algorithm, which encompasses a reward-free instance of \(\). The analysis presented in  demonstrates that the required number of samples under the static sampler to achieve an \(\)-optimal policy (also referred to as simple regret) scales as \((d^{2}/^{2})\), where \(d\) represents the dimension of the underlying space. This result matches the online minimax sample complexity for the simple regret problem .

The algorithm proposed by  effectively constructs a static policy sequence of adequate span, utilizing the linear structure of the problem. However, in many problem settings, linearity alone may not be sufficient to capture the true nature of the underlying reward model. This limitation is particularly evident in scenarios such as genetic perturbation experimentation  or other similar contexts. In such cases, the availability of algorithms that do not rely on linearity becomes crucial. Unfortunately, extending the results and techniques presented in  to the generic function approximation regime is not straightforward.

Here we consider when the reward function is realized by an unknown function \(f_{}\) belonging to a known function class \(\) (which can be more complex than linear).

Adaptive Learning with Function Approximation.In adaptive learning settings where a learner can change the data collection policies as it observes rewards and has much more flexibility than in experiment planning scenarios, various adaptive learning procedures compatible with generic function approximation have been proposed for contextual bandit problems. Among these, two significant methods relevant to our discussion are the Optimistic Least Squares algorithm (\(\) ) introduced by  and the SquareCB algorithm introduced by . Both of these methods offer guarantees for cumulative regret. Specifically, the cumulative regret of \(\) scales as \((}(||)T})\), while the cumulative regret of \(\) scales as \((|(||)T})\), where \(\) corresponds to the set of actions. The eluder dimension1 (\(d_{}\)) is a statistical complexity measure introduced by , which enables deriving guarantees for _adaptive_ learning algorithms based on the principle of optimism in the face of uncertainty in contextual bandits and reinforcement learning . By employing an online-to-batch conversion strategy, these two methods imply that the number of samples required to achieve \(\)-simple regret using an adaptive algorithm is at most \((d_{}(||)/^{2})\) and \((||(||)/^{2})\) respectively.

Contributions.In this paper, we address the function approximation setting within the contextual bandit (static) experiment planning problem. Although in experiment planning the data collection policies have to be produced before interacting with the environment, we establish that surprisingly the adaptive \(\)-simple regret rates achieved by \(\) and \(\) are also attainable by a static experiment sampling strategy. To achieve this, we introduce and analyze two experimental planning algorithms. The \(\) algorithm (see Section 4) utilizes confidence intervals derived from least squares optimization to construct a static set of policies to be executed during the sampling phase. When the algorithm has access to a sufficient number of offline samples to generate \(T=(d_{}(||)/^{2})\) static policies, the learner can produce an \(\)-optimal policy denoted as \(_{T}\) thus matching the online-to-batch \(\)-simple regret rates of \(\). Since the eluder dimension of linear function classes of dimension \(d\) is -up to logarithmic factors- of order \((d)\), our resultsrecover the linear experiment planning rates of . Additionally, in Section 5, we demonstrate that collecting \(T=(||(||)/^ {2})\) uniform samples is sufficient to obtain an \(\)-optimal policy \(_{T}\). This matches the online-to-batch \(\)-simple regret rates of \(\). These two results yield conclusions similar to those known in the linear setting , but for general function classes.

These results prompt two important questions: (1) are existing adaptive cumulative regret algorithms already optimal for simple regret minimization, and (2) is static experiment planning sufficient to match the simple regret guarantees of adaptive learning for realizable contextual bandits?

In Section 6, we provide a negative answer to both questions. We present a certain structured class of bandit problems where a different adaptive algorithm can require significantly less samples than that implied by the bounds from \(\) and \(\). Our result is for the _realizable_ setting , where the true reward function \(f_{}\) belongs to a known function class \(\), where the true complexity of simple regret problems in adaptive learning scenarios has not be known known in this setting. This result complements recent results  that online-to-batch strategies are suboptimal for minimizing simple regret in the agnostic contextual bandits setting.2

For the second question, our statistical lower bound shows that for this class of problems, a significantly smaller number of samples are needed to find an \(\)-optimal policy when using adaptive learning, than when using a static policy. This result complements related work in reinforcement learning with realizable linear state-action value function approximation.

Finally, we address the problem of model selection when the learner is presented with a family of reward function classes \(\{_{i}\}_{i=1}^{M}\) and is guaranteed that the true reward function \(f_{}\) belongs to \(_{i_{}}\), where the index \(i_{}\) is unknown. We demonstrate that as long as \(T=(||((M,|_{} |))/^{2})\) uniform samples are available, it is possible to construct an \(\)-optimal policy denoted as \(_{T}\). Further details regarding these results can be found in Section 7.

## 2 Further Related Work

Best Arm Identification and Design of Experiments.Previous work to efficiently produce an almost optimal policy for non-contextual linear and multi-armed bandits settings is based on best-arm identification procedures . These are strategies that react adaptively to the collected rewards and achieve instance dependent sample complexity. Other papers in the design of experiments literature  introduce methods for designing a non-adaptive policy that can be used to find an optimal arm with high probability in non-contextual scenarios.

Safe Optimal Design.When safety concerns are imposed in the exploration policy, works such as  and  have studied the problem of producing a safe and efficient static policy used to collect data that can then be used for policy evaluation in the MAB and linear settings. This is in contrast with the unconstrained contextual function approximation scenario we study.

Reward Free Reinforcement Learning.In Reinforcement Learning settings a related line of research  considers the problem of producing enough exploratory data to allow for policy optimization for all functions in a reward class. These works allow for the learner to interact with the world for a number of steps, enough to collect data that will allow for zero-shot estimation of the optimal policy within a reward family. This stands in contrast with the experiment planning setup, where the objective is to produce a sequence of policies for static deployment at test time with the objective of learning the unknown reward function.

## 3 Problem Definition

We study a two-phase interaction between a learner and its environment consisting of a _Planning_ and a _Sampling_ phase. During the planning phase the learner has access to \(m T\) i.i.d. offlinecontext samples3 from a context distribution \(\) supported on a context space \(\) as well as knowledge of a reward function class \(\) where each element \(f\) has domain \(\) where \(\) is the action set. During the sampling phase the learner interacts with a contextual bandit problem for \(T\) steps where at each time-step \(t\) a context \(x_{t}\) is revealed to the learner, the learner takes an action \(a_{t}\) and receives a reward \(r_{t}\). We adopt the commonly used realizability assumption, which is widely employed in the contextual bandit literature [2; 18; 17; 44; 9].

**Assumption 3.1** (Realizability).: _There exists a function \(f_{}\) such that \(r_{t}=f_{}(x_{t},a_{t})+_{t}\) where \(f_{}\) and \(_{t}\) is a conditionally zero mean \(1-\)subgaussian random variable for all \(t[T]\) during the sampling phase._

During the planning phase the learner is required to build a static policy sequence \(\{_{i}\}_{i=1}^{T}\) (a policy is a mapping from \(\) to \(_{}\), the set of distributions over actions) that, without knowledge of the reward, can be deployed to collect data during the sampling phase. In contrast with adaptive learning procedures, in the experiment planning problem the policies in \(\{_{i}\}_{i=1}^{T}\) have to be fully specified during the planning phase and cannot depend on the learner's observed reward values during the sampling phase. The learner's objective is to use the reward data collected during the sampling phase to produce an \(-\)optimal policy \(_{T}\) such that,

\[_{x,a_{T}(x)}[f_{}(x,a) ]+_{}_{x,a(x)} [f_{}(x,a)].\]

for a suboptimality parameter \(>0\). Because we have assumed realizability of the reward function, the optimal policy among all possible policies \(_{}=_{}_{x,a(x)}[f_{ }(x,a)]\) can be written as \(_{}(x)=_{a}f_{}(x,a)\) for all \(x\).

Throughout this work we make the following boundedness assumptions,

**Assumption 3.2** (Bounded Function Range).: _The range of \(\) is bounded, i.e. for all \(x,a\), \(|f(x,a)| B\) for some constant \(B>0\)._

**Assumption 3.3** (Bounded Noise).: _The noise variables are bounded \(|_{t}|\) for all \(t[T]\) for some constant \(>0\)._

Assumptions 3.2 and 3.3 imply \(|r_{t}| B+\) for all \(t[T]\).

## 4 Planning Under the Eluder Dimension

The eluder dimension is a sequential notion of complexity for function classes that was originally introduced by . The eluder dimension can be used to bound the regret of optimistic least squares algorithms in contextual bandits [42; 9] and reinforcement learning . Informally speaking the eluder dimension is the length of the longest sequence of points one must observe to accurately estimate the function value at any other point. We use the eluder dimension definition from .

**Definition 4.1**.: _(\(-\)dependence) Let \(\) be a scalar function class with domain \(\) and \(>0\). An element \(z\) is \(-\)dependent on \(\{z_{1},,z_{n}\}\) w.r.t. \(\) if any pair of functions \(g,g^{}\) satisfying \(^{n}(g(z_{i})-g^{}(z_{i}))^{2}}\) also satisfies \(g(z)-g^{}(z)\). Furthermore, \(z\) is \(-\)independent of \(\{z_{1},,z_{n}\}\) w.r.t. \(\) if it is not \(-\)dependent on \(\{z_{1},,z_{n}\}\)._

**Definition 4.2**.: _(\(\)-eluder) The \(-\)non monotone eluder dimension \(_{}(,)\) of \(\) is the length of the longest sequence of elements in \(\) such that every element is \(-\)independent of its predecessors. Moreover, we define the \(-\)eluder dimension \(d_{}(,)\) as \(d_{}(,)=_{^{} }d_{}(,)\)._

By definition the \(-\)eluder dimension increases as \(\) is driven down to zero. Let \(\) be a dataset of \(\), \(\) pairs. For any \(f,f^{}\) with support \(\) we use the notation \(\|f-f^{}\|_{}\) to denote the data norm of the difference between functions \(f\) and \(f^{}\):

\[\|f-f^{}\|_{}=}(f(x,a)-f^{ }(x,a))^{2}}.\]\(\{_{}\}_{=1}^{t-1}\). We adopt the convention that \(_{1}=\). The output of the \(\) algorithm is the sequence of policies \(\{_{t}\}_{t=1}^{T}\). Policy \(_{t}\) is defined as \(_{t}(x)=*{arg\,max}_{a}(x,a,_{ t})\) such that \((x,a,_{t})\) is an uncertainty measure defined as,

\[(x,a,_{t})=_{f,f^{}\ |f-f^{}|_{t} 4_{ }(t,)}f(x,a)-f^{}(x,a).\] (1)

Where the confidence radius function \(_{}(,t)\) equals

\[_{}(,t)=(B+)|t}{})}\] (2)

for some universal constant \(>0\) defined in Proposition A.7. This is a complexity radius implied by the guarantees of least squares regression (Lemma A.8) and constraints imposed by Lemma 4.6. See Appendix A.1 and Proposition A.7 for a detailed discussion about this definition. We call the combination of the \(\) and \(\) as the _eluder planning algorithm_. Its performance guarantees are obtained by relating the regret of a constructed sequence of optimistic policies \(\{_{t}^{}\}_{t=1}^{T}\) based on the data collected by \(\{_{t}\}_{t=1}^{T}\) to the sum of uncertainty radii \(_{t=1}^{T}(x_{t},_{t}(x_{t}),_{t})\) of the context-actions collected during the planning phase. Using optimism when constructing this policy sequence is important. In contrast with the sequence of greedy policies \(_{t}^{}(|x)=*{arg\,max}_{a} _{t}(x,a)\), where \(_{t}=*{arg\,min}_{f}_{(x,a,r) }_{t}}(f(x,a)-r)^{2}\) resulting from a least squares over \(}_{t}\), the sequence of optimistic policies satisfies a regret bound. Thus, playing a uniform policy from the sequence \(\{_{t}^{}\}_{t=1}^{T}\) satisfies a simple regret guarantee. The sum of uncertainty radii \(_{t=1}^{T}(x_{t},_{t}(x_{t}),_{t})\) is bounded using a Lemma we borrow from .

**Lemma 4.3**.: _[Lemma 3 from ] Let \(\) be a function class satisfying Assumption 3.2 with \(\)-eluder dimension \(d_{}(,)\). For all \(T\) and any dataset sequence \(\{D_{t}\}_{t=1}^{}\) with \(_{1}=\) and \(_{t}=\{\{_{},_{}\}\}_{=1}^{t-1}\) of context-action pairs, the following inequality on the sum of the uncertainty radii holds,_

\[_{t=1}^{T}(_{t},_{t},_{t}) ((BT,Bd_{}(,B/T)+_{ }(T,)}(,B/T)T} )).\]Extracting Policy \(_{T}\) from Data.At the end of the execution of the Sampler algorithm, the learner will have access to a sequence of datasets \(\{_{t}\}_{t=1}^{T}\) of contexts, actions and reward triplets. The learner will use this sequence of datasets to compute the sequence of regression functions,

\[_{t}=*{arg\,min}_{f}_{=1}^{t-1} (f(_{},_{})-_{})^{2}.\] (3)

Standard Least Squares (LS) results (see Lemma A.8) imply that \(\|_{t}-f_{}\|_{}_{t}}(t,)\) with high probability for all \(t\). These confidence sets are used to define a sequence of optimistic (deterministic) policies \(\{_{t}^{}\}_{t=1}^{T}\):

\[_{t}^{}(x)=*{arg\,max}_{a}_{\|_{t}-f\|_{}_{t}}_{ }(t,)}(x,a)\] (4)

The candidate optimal policy \(_{T}\) is then defined as \(_{T}=(_{1}^{}, ,_{T}^{})\). The main result in this section is the following Theorem.

**Theorem 4.4**.: _Let \(>0\). There exists a universal constant \(c>0\) such that if_

\[T c(B,,1)d_{}(,B/T) (||T/)}{^{2}}\] (5)

_then with probability at least \(1-\) the eluder planning algorithm's policy \(_{T}\) is \(-\)optimal._

**Remark 4.5**.: _The results of this section hold for the structured bandits setting [23; 27]; that is, scenarios where \(=\{\}\)._

Both sides of the inequality defining \(T\) in Theorem 4.4 depend on \(T\). Provided \(d_{}(,B/T)\) is sub-linear as a function of \(T\), there exists a finite value of \(T\) satisfying Equation 5. When \(d_{}(,)=_{} (1/)\) for some \(_{}\) and for all \(>0\) setting \(T c(B,,1)d_{}(,B )(||/)}{^{2}}\) is enough to guarantee the conditions of Theorem 4.4 are satisfied. Examples 4 and 5 from  show the eluder dimension of linear or generalized linear function classes can be written in such way. In these cases \(_{}\) is a constant multiple of the underlying dimension of the space.

Using standard techniques, the results of Theorem 4.4 can be adapted to the case when the function class \(\) is infinite but admits a metrization and has a covering number. In this case the sample complexity will scale not with \((||)\) but instead with the logarithm of the covering number of \(\). For example, in the case of linear functions, the logarithm of the covering number of \(\) under the \(_{2}\) norm will scale as \(d\), the ambient dimension of the space up to logarithmic factors of \(T\) (see for example Lemma D.1 of ). Plugging this into the sample guarantees of Theorem 4.4 recovers the \(}(d^{2}/^{2})\) sample complexity for linear experiment planning from .

### Proof Sketch of Theorem 4.4

Let \(_{1},,_{T}\) be the sampler's context sequence. The proof works by showing that with probability at least \(1-\) the regret of the \(\{_{t}^{}()\}_{t=1}^{T}\) sequence satisfies the regret bound

\[_{t=1}^{T}_{a}f_{}(_{t},a)-f_{}( _{t},_{t}^{}(_{t})) ((B+)}(,B/T)T(| |T/)})\]

A key part of the proof involves relating the balls defined by the data norms of the planner datasets \(\{_{t}\}_{t=1}^{T}\) and those induced by the data norms of the sampler datasets \(\{}_{t}\}_{t=1}^{T}\). The precise statement of this relationship is provided in Lemma 4.6, and its proof can be found in Appendix C.

**Lemma 4.6**.: _With probability at least \(1-\),_

\[\{(f,f^{})\|f-f^{}\|_{}_{t}} 2 _{}(t,)\}\{(f,f^{})\|f-f^{}\|_{_{t}} 4_{ }(t,)\}\] (6)

_Simultaneously for all \(t[T]\). Where \(\{D_{t}\}_{t=1}^{T}\) is the dataset sequence resulting of the execution of \(\) while \(\{_{t}\}_{t=1}^{T}\) is the dataset sequence resulting of the execution of the \(\) and \(_{}(,t)\) is the confidence radius function defined in Equation 2._Let \(_{t}\) as in Equation 3 and define \(\) as the event where the Standard Least Squares results (see Lemma A.8) hold i.e. \(\|_{t}-f_{}\|_{}_{t}}_{ }(t,)\) for all \(t[T]\) and also Equation 6 from Lemma 4.6 holds for all \(t[T]\). The results of Lemmas A.8 and 4.6 imply \(() 1-\).

For context \(x\) and action \(a\) let's denote by \(_{t}^{x,a}\) as a function achieving the inner maximum in the definition of \(_{t}^{}\) (see Equation 4). When \(\) holds the policies \(\{_{t}^{}\}_{t=1}^{T}\) are optimistic in the sense that \(_{t}^{x,_{t}^{}(x)}(x,_{t}^{ }(x))_{a}f_{}(x,a)\) and therefore,

\[_{t=1}^{T}_{a}f_{}(_{t},a)-f_ {}(_{t},_{t}^{}(_{t}))  _{t=1}^{T}_{t}^{x,_{t}^{}(x )}(_{t},_{t}^{}(_{t}))-f_{}( _{t},_{t}^{}(_{t}))\] \[ _{t=1}^{T}_{f,f^{}_{t}(2,}_{t})}f(_{t},_{t}^{}(_{t }))-f^{}(_{t},_{t}^{}(_{t}))\] \[ _{t=1}^{T}_{f,f^{}_{t}(2,_{t}) }f(_{t},_{t}^{}(_{t}))-f^{}( _{t},_{t}^{}(_{t}))=().\]

Where \(_{t}(,)=\{f,f^{}\|f-f^{}\|_{}_{}(,t)\}\). Inequality \((i)\) follows by optimism, \((ii)\) is a consequence of \(_{t}^{x,_{t}^{}(x)},f_{}_{t} (2,}_{t})\) when \(\) holds since in this case \(\|_{t}-f_{}\|_{}_{t}}_{}(t,)\) and \(\|_{t}^{x,_{t}^{}(x)}-_{t}\|_{ }_{t}}_{}(t,)\), and \((iii)\) follows because when \(\) holds, Equation 6 of Lemma 4.6 is satisfied and therefore \(_{t}(2,}_{t})_{t}(4, }}_{t})\). The RHS \(()\) of theequation above satisfies,

\(()=_{t=1}^{T}(_{t},_{t}^{}( _{t}),_{t})_{t=1}^{T}_{a}( _{t},a,_{t})=_{t=1}^{T}(_{t},_{t}( _{t}),_{t}).\)

We relate the sum of uncertainty radii \(\{(_{t},_{t}(_{t}),_{t})\}_{t=1}^{T}\) with those of the planner \(\{(x_{t},_{t}(x_{t}),_{t})\}_{t=1}^{T}\) via Hoeffding Inequality (see Lemma A.1) and conclude that w.h.p,

\[_{t=1}^{T}_{a}f_{}(_{t},a)-f_{}( _{t},_{t}^{}(_{t}))_{t=1}^{T} (x_{t},_{t}(x_{t}),_{t})+(B}).\]

Lemma 4.3 allows us to bound the sum of these uncertainty radii as

\[_{t=1}^{T}(x_{t},_{t}(x_{t}),_{t}) ((BT,Bd_{}(,B/T)+_{}(T, )}(,B/T)T})),\]

and therefore w.h.p,

\[_{t=1}^{T}_{a}f_{}(_{t},a)-f_{}( _{t},_{j}^{}(_{t})) ((BT,Bd_{}(,B/T)+_{}(T, )}(,B/T)T})).\]

Converting this cumulative regret bound into a simple regret one (Lemma B.1) finalizes the result. A detailed version of the proof can be found in Appendix C.1.

## 5 Uniform Sampling Strategies

In this section we show that a uniform sampling strategy can produce an \(\) optimal policy with probability at least \(1-\) after collecting \(((B,)||(||/ )}{^{2}})\) samples. This procedure achieves the same simple regret rate as converting \(\)'s cumulative regret into simple regret4.

In contrast with the eluder planning algorithm the uniform sampling strategy does not require a planning phase. Instead it consists of running of the \(\) (Algorithm 2) setting \(_{j}=()\) for all \(j[T]\). Given a dataset \(}_{T}\) of contexts, actions and rewards collected during the sampling phase, we solve the least squares problem:

\[_{T}=*{arg\,min}_{f}_{(x_{i},a_{i},r_{i}) }_{T}}(f(x_{i},a_{i})-r_{i})^{2}\]

and define the policy \(_{T}\) as \(_{T}(x)=*{arg\,max}_{a}_{T}(x,a)\). The main result of this section is,

**Theorem 5.1**.: _There exists a universal constant \(>0\) such that if \(T(B,B)||(||/)}{ ^{2}}\) then with probability at least \(1-\) the uniform planning algorithm's policy \(_{T}\) is \(-\)optimal._

The proof of Theorem 5.1 can be found in Appendix D.

Comparison Between \(\) and \(\).The regret rate after \(T\) steps of the \(\) algorithm applied to a contextual bandit problem with discrete function class \(\) scales5 (up to logarithmic factors) as \((}(,B/T)(|| /)T})\). In contrast, the regret of the \(\) algorithm satisfies a regret guarantee (up to logarithmic factors) of order \((|(||/)T})\) where the eluder dimension dependence is substituted by a polynomial dependence on the number of actions \(||\). When the number of actions is small, or even constant, the regret rate of \(\) can be much smaller than that of \(\). The opposite is true when the number of actions is large or even infinite. Converting these cumulative regret bounds to simple regret implies the number of samples required to produce an \(-\)optimal policy from the _adaptive_\(\) policy sequence scales as \(}(,B/T)(||/)}{ ^{2}}\) whereas for the _adaptive_\(\) policy sequence it scales as \(|(||/)}{^{2}}\). The results of Theorems 4.4 and 5.1 recover these rates in the experiment planning setting.

## 6 Gap Between Experiment Planning and Adaptive Learning

The results of Sections 4 and 5 imply planning bounds that are comparable to the corresponding online-to-batch guarantees for \(\) and \(\). The main result of this section Theorem 6.1 shows there are problems where the number of samples required for experiment planning can be substantially larger than the number of samples required of an adaptive learning algorithm. This result implies the suboptimality of algorithms such as \(\) and \(\) for adaptive learning.

In order to state our results we consider an action set \(_{}\) indexed by the nodes of a height \(L\) binary tree defined here

The following result fleshes out a separation action set \(_{}\) and function class \(_{}\) in the setting where at time \(T\) the learner will produce a guess for the optimal policy \(_{T}\).

**Theorem 6.1**.: _Let \(>0\), \(T\). Consider the action set \(_{}\) and function class \(_{}\) and a reward noise process such that \(_{t}(0,1)\) conditionally for all \(t[T]\). For any planning algorithm \(\) there is a function \(f_{}_{}\) such that when \(T}\) and \(\) interacts with \(f_{}\) then,_

\[_{,f_{}}[_{a_{T}} [f_{}(a)]]_{a_{}}f_{ }(a)-.\]

_Moreover, there is an adaptive algorithm \(_{}\) such that if \(T}\),_

\[_{_{}}[_{a_{T}}[f(a)]]_{a_{}}f( a)-.\]

_for all \(f_{}\). Where \(_{}_{,}}[]\) is the expectation over the randomness of \(}\) and the environment for target function \(\), and \(_{T}\) is the algorithm's final policy guess after the sampling phase._

Figure 1: Binary TreeThe main insight behind Theorem 6.1 is that adaptive strategies to find an optimal action in the \(_{}\) function class can make use of the conditional structure of the action space by trying to determine a path of actions from the root to the leaf containing the optimal action. An adaptive strategy can determine this path by querying only nodes that are adjacent to it. In contrast, a static experiment planning strategy cannot leverage this structure and has to query all leaf nodes. Theorem 6.1 implies a gap between the adaptive and experiment planning problems. Moreover, since the eluder dimension of \(_{}\) scales with \(2^{L}\) (see Lemma D.1), \(\) and \(\) are suboptimal adaptive algorithms for this model class. In contrast with the \((})\) upper bound in Theorem 6.1, converting the cummulative regret bounds of \(\) and \(\) yield guarantees scaling as \(((|_{}|)}{^ {2}})\).

## 7 Model Selection

In this section we consider a setting where the learner has access to \(_{1},,_{M}\) function (model) classes all with domain \(\). The learner is promised there exists an index \(i_{}\) such that \(f_{}_{i_{}}\). The value of index \(i_{}\) is not known by the learner. We will show the uniform sampling strategy has a sample complexity that scales logarithmically with the number of models and with the complexity of the optimal model class \(|_{i_{}}|\). In this setting the \(\) will collect two uniform actions datasets \((}_{T}^{()},}_{T}^{( )})\) of size \(T/2\) each. Using the "train" dataset \(}_{T}^{()}\) the learner computes candidate reward models \(_{T}^{(i)}\) for all \(i[M]\) by solving the least squares problems:

\[_{T}^{(i)}=*{arg\,min}_{f_{i}}\;\;_ {(x_{i},a_{i},r_{i})}_{T}^{()}}(f( x_{i},a_{i})-r_{i})^{2}.\]

Using the "test" dataset the learner extracts a guess for the optimal model class index \(\) by solving,

\[=*{arg\,min}_{i[M]}\;_{(x_{},a_{},r_{ })}_{T}^{()}}(_{T}^{ (i)}(x_{},a_{})-r_{})^{2}.\] (7)

The candidate policy \(_{T}\) is defined as \(_{T}(x)=*{arg\,max}_{a}_{T }^{()}(x,a)\). Let's start by relating the expected least squares loss of the candidate model \(_{T}^{()}\) to the size of the optimal model class \(|_{i_{}}|\),

**Proposition 7.1**.: _There exists a universal constant \(>0\) such that,_

\[_{x,a()}[(f_ {}(x,a)-_{T}^{()}(x,a))^{2}] ^{2}(B,)(T(M,|_{i_{}}|)/ )}{T}.\]

_With probability at test \(1-\)._

The proof of Proposition 7.1 can be found in Appendix E.1. The uniform sampling model-selection algorithm has the following performance guarantees,

**Theorem 7.2**.: _There exists a universal constant \(^{}>0\) s.t. if \(T^{}(B,)||( _{}|)}{^{2}})}{^{2}}\) then with probability at least \(1-\), the candidate policy \(_{T}\) of the uniform sampling model-selection algorithm is \(-\)optimal._

Proof.: Due to the realizability assumption \((r_{t}=f_{}(x_{t},a_{t})+_{t})\) the instantaneous regret of \(_{T}\) on context \(x\) equals \(_{a}f_{}(x,a)-f_{}(x,_{T}(x))\). Let \(_{}(x)=*{arg\,max}_{a}f_{}(x,a)\). Just like in the proof of Theorem 5.1 (see Equation 25), we can relate the suboptimality of \(_{T}\) with the expected least squares loss of \(_{T}^{()}\) under the uniform policy,

\[_{x}[_{a}f_{}(x,a)-f_{ }(x,_{T}(x))] 2|_{x ,a()}[(f_{}(x,a)- _{T}^{()}(x,a))^{2}]}.\] (8)

Finally Proposition 7.1 implies thre is a universal constant \(>0\) such that,

\[_{x,a()}[(f_ {}(x,a)-_{T}^{()}(x,a))^{2}](^{2}+B^{2})(T(M,|_{i_{}}|)/ )}{T}\]with probability at least \(1-\). Plugging this result back into Equation 8 we see the suboptimality of \(_{T}\) can be upper bounded as,

\[_{x}[_{a}f_{}(x,a)-f_{ }(x,_{T}(x))] 2|( ^{2}+B^{2})(T(M,|_{i_{}}|)/)}{T}}\]

Setting \(g(T)=4||(^{2}+B^{2})(T(M,|_{i_{}}|)/)}{T}\) in Lemma A.6 implies there exists a universal constant \(^{}>0\) such that \(g(T)^{2}\) for all \(T^{}(B,)||_{i_{}}|)}{^{2}}}{^{2}}\). 

The results of Theorem 7.2 can be best understood by contrasting them to the uniform sampling algorithm with input model class equal to the union of the function classes \(_{}=_{i[M]}_{i}\). Applying the results of Theorem 5.1 to \(_{}\) yields a sample complexity scaling with \(_{i[M]}(||_{i})\), a quantity that could be much larger than \((|_{i_{}}|)\). In contrast, the uniform sampling model-selection algorithm achieves a sample complexity scaling with \((|_{i_{}}|)\) at a price logarithmic in the number of models classes \(M\). This logarithmic dependence on \(M\) stands apart from model selection algorithms for cumulative regret scenarios such as \(\)[5; 39], \(\) and \(\)[38; 12] that instead have a polynomial dependence on \(M\). The uniform sampling model-selection algorithm is agnostic to the value of \(\). The results of Theorem 7.2 hold for any \(\). If \(\) is known in advance the learner can compute the model class index \(=\{i[M]T^{^{2}(B,)| |(|_{i}|/)}{^{2}}\}\) and use the uniform sampling strategy for \(_{}\). For this choice of \(\), Theorem 5.1 guarantees similar bounds to those of Theorem 7.2. Unfortunately in contrast with the uniform sampling model-selection algorithm this method would be valid for a single choice of \(\).

## 8 Conclusion

In this work we have introduced the first set of algorithms for the experiment planning problem for contextual bandits with general function approximation. We have developed the \(\) algorithm that produces a static policy sequence that after deployment can be used to recover an \(-\)optimal policy. We showed it is enough for the number of static policies and therefore samples during the sampling phase to be as large as the number of samples required from an adaptive procedure based on an online-to-batch conversion of the \(\) algorithm. Similarly we also demonstrated the uniform sampling strategy enjoys the same online-to-batch conversion sample complexity as the \(\) algorithm. These results seemingly suggest that simple regret rates for adaptive learning may also be achieved in experiment planning scenarios. We show this is not the case. There exist structured bandit problems for which adaptive learning may require a number of samples that is substantially smaller than the number of samples required by a static policy sequence. This is significant because it implies the suboptimality of the rates achieved by existing adaptive learning algorithms such as \(\) and \(\) and also because it draws a clear distinction between adaptive learning and experiment planning. This implies these algorithms are either suboptimal or their upper bound analysis is not tight. We believe the first to be correct. This is an important open question we hope to see addressed in future research. We have also introduced the first model selection results for the experiment planning problem.

Many important questions remain regarding this setting. Chief among them is to characterize the true statistical complexity of experimental design for contextual bandits with general function approximations. Our results indicate the eluder dimension is not the sharpest statistical complexity measure to characterize learning here. Developing a more new form of complexity, as well as an accompanying algorithm that can achieve the true statistical lower bound for the problem of experiment planning remains an exciting and important open question to tackle in future research.