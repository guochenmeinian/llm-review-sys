# Stochastic force inference via density estimation

Victor Chardes\({}^{1,}\), **Suryanarayana Maddu\({}^{1,}\), Michael J. Shelley\({}^{1,2}\)**

\({}^{1}\) Center for Computational Biology,

Flatiron Institute, New York, NY, USA, 10010

\({}^{2}\) Courant Institute of Mathematical Sciences,

New York University, New York, NY, USA, 10012

These authors contributed equally

###### Abstract

Inferring dynamical models from low-resolution temporal data continues to be a significant challenge in biophysics, especially within transcriptomics where separating molecular programs from noise remains an important open problem. We explore a common scenario in which we have access to an adequate amount of cross-sectional samples at a few time-points, and assume that our samples are generated from a latent diffusion process. We propose an approach that relies on the probability flow associated with an underlying diffusion process to infer an autonomous, nonlinear force field interpolating between the distributions. Given a prior on the noise model, we employ score-matching to differentiate the force field from the intrinsic noise. Using relevant biophysical examples, we demonstrate that our approach can extract non-conservative forces from non-stationary data, that it learns equilibrium dynamics when applied to steady-state data, and that it can do so with both additive and multiplicative noise models.

## 1 Introduction

Learning dynamical modelsFrom gene expression in cells [1; 2; 3] to collective motion in animal groups  to growth in ecological communities , biological processes undergo stochastic dynamics, and their steady-states emerge from a competition between intrinsic noise and deterministic forces. The ability to separate these two contributions from experimental data is crucial to understanding such dynamics. Instrumentally, such systems can be modeled as diffusion processes for which the time-continuous evolution of the degree of freedom of interest \(^{d}\) obeys an autonomous stochastic differential equation :

\[d=()dt+()d,\] (1)

where \(\) is a standard \(d\)-dimensional Wiener process, \(:^{d}^{d}\) is the deterministic force, \(:^{d}^{d d}\) the diffusion coefficient and the equation is written in the Ito convention. This formulation in terms of stochastic trajectories \(\{(t),t>0\}\) is equivalent to a formulation in terms of the probability density \(p_{t}()\) given by the Fokker-Planck equation:

\[_{t}p_{t}()=-[()p_{t}( )-(()p_{t}()) ],\] (2)

where \(=^{T}\) and the divergence is applied row-wise for any matrix-valued function. Within this framework, the inverse problem of interest is to estimate \(()\) from experimental data given the knowledge of the diffusion field \(()\). In soft-matter and finance, due to the availability of time-resolved trajectories, this problem has largely been addressed through discretizations of (1) [7; 8; 9; 10]. For the higher dimensional systems encountered when studying gene expression, single-cell sequencing technologies give access to many cross-sectional samples with low temporal resolution.

In this scenario, the inverse problem amounts to learning how the probability mass is moved between empirical distributions at successive time points rather than how one trajectory evolves over time. Previous attempts to tackle this question have approached it from an optimal transport point of view; first in a static setting by learning pairwise couplings between successive empirical distributions, and subsequently in a dynamical setting by learning a time-continuous model connecting distributions at all times. While static methods couldn't model time-continuous and non-linear dynamics , their dynamical counterparts lifted these constraints but remained limited to diffusion processes with additive noise . The ability of multiplicative noise to move, create, and destroy fixed points in the energy landscape, in particular in the context of biochemical networks , motivates the development of an inference scheme able to handle it.

Equilibrium vs. non-equilibriumBiological systems exhibit a distinctive feature: they operate out of equilibrium at the molecular level. For instance, irreversible chemical cycles orchestrate various molecular processes in cells, ranging from the work of molecular motors to phosphorylation cycles, enzymatic cycles, and RNA transcription regulation . The dissipation of chemical energy within these cycles induces irreversible transitions between distinct molecular states, maintaining biological systems far from thermodynamic equilibrium. Learning these irreversible cycles is essential for understanding and predicting the behavior of such processes, but it remains a challenge when the time resolution of experiments is limited. To illustrate this issue in the framework of diffusion processes, we consider the problem of estimating the force field \(()\) knowing the noise \(()\) and using a large number of samples drawn from the steady-state distribution \(p()\) of (2). At steady-state, the Fokker-Planck equation reduces to:

\[()=0,\] (3) \[()=(()- ()-() p())p( ),\]

where we assume that \(()\) is invertible and we denote \(()\) the probability current. An estimate of the score function \(() p()\) which does not require computation of the partition function , provides access to a force field \(^{}\) describing an equilibrium steady-state (with vanishing currents):

\[^{}()=()( )+()()- ()/p().\] (4)

This relation was exploited in the recent study  to learn a coarse-grained (CG) force field in molecular dynamics using an estimate of the score function \(()\). To infer \(()\) from (4), one needs to estimate the full probability density of the model \(p()\) as well as the probability currents \(()\). However, at steady-state and with only the knowledge of \(p()\) and its score there is no constraint, besides being divergence-free, on \(()\). This degeneracy is lifted when trajectory information is available , but in the absence of this information non-equilibrium currents are only accessible using data sampled from a non-stationary solution of (2). This issue was observed in early attempts to learn dynamical models from single-cell RNA-seq data .

Our contributionIn this paper, we develop an inference framework to estimate the force field \(()\) from limited static cross-sectional measurements over time, as illustrated in Fig. 1. Our dataset consists of empirical distributions \((^{1},...,^{K})\) known at successive times \(t_{1}<...<t_{K}\), where:

\[^{k}()}}{{=}} {N_{k}}_{i=1}^{N_{k}}(-_{i}(t_{k})),\] (5)

with \(N_{k}\) the number of measurements available from the marginal \(p_{t_{k}}()\) at time \(t_{k}\). Our approach does not presuppose that successive samples form a trajectory of the diffusion process (1), but it reduces to least-square-based force inference methods (akin to ) if trajectory information is available. We propose a method that simultaneously allows us to (i) learn a continuous-time dynamical model with an autonomous non-linear force field and (ii) separate the force field from a known arbitrary noise model. We show that by using non-stationary data our method can learn non-conservative forces and that it learns equilibrium dynamics when applied to steady-state data. Furthermore, we show that our method can extract force fields from both additive and multiplicative noise models, opening promising applications for gene regulatory network inference.

## 2 Related Work

The force inference problem can be conveniently reformulated as a _trajectory inference_ exercise where the goal is to infer the latent dynamics tracing the cross-sectional measurements. In this section, we briefly outline related works in the context of trajectory inference.

Deterministic transportMost approaches proposed to solve the problem of _trajectory inference_ have taken an optimal transport (OT) route: recovering latent dynamics that obey the principle of least-effort. These approaches learn a deterministic map that solves a Monge-Kantarovich problem between each pair of successive snapshots [11; 12; 13] resulting in a time-discontinuous solution. This constraint was later relaxed using a neural ODE  approximating the Benamou-Brenier formulation of OT as regularized continuous normalizing flow . Although OT-inspired transport flow maps are very attractive, they restrict the force fields to be curl-free and are thereby constrained to learn only equilibrium dynamics.

Stochastic transport with additive noiseAlthough successfully applied to data [12; 15], OT approaches also can't infer or accommodate stochastic dynamics. In this direction, the Schrodinger bridge (SB) framework aims to find the most likely diffusion process with additive noise connecting a pair of successive snapshots. The SB formulation can be mapped on an entropically-regularized optimal transport problem [14; 19], and therefore inherits the limitation of the solution being time-discontinuous. The studies [17; 18] tackle this issue by constructing a constant estimator for the distribution over trajectories of a diffusion process with constant additive noise.

Towards general noise modelsDespite the success of SB-inspired methods, they are usually limited to additive noise models. Approaches based on Neural SDEs are less constrained than SB-inspired methods and offer flexibility to handle arbitrary noise models. However, they suffer from issues related to robustness and overfitting  originating from the need to solve SDEs during optimization. In this paper, leveraging the probability flow ODE  and score matching methods [23; 32], we reformulate the neural SDE approach of  into a neural ODE, and show its ability to extract a non-conservative force fields from arbitrary noise models.

## 3 Methods

Probability flow ODEWe consider the SDE in (1), for which the probability density \(p_{t}()\) evolves according to the Fokker-Planck equation (2). It can be shown [31; 33] that there exists a corresponding deterministic process whose trajectories share the same marginal probability density as the SDE

Figure 1: **Force field inference of a diffusion process given cross-sectional samples at a limited number of time points. We assume that the samples are generated through an underlying diffusion process with an unknown force field \(()\) and a known noise model \(()\). We then define a corresponding approximate probability flow ODE by substituting the score by its continuous-time analog \(}(,t)\) estimated via score-matching. Using this approximate probability flow ODE we solve a density fitting problem to learn a force field that best reconstructs the cross-sectional measurements.**

[MISSING_PAGE_FAIL:4]

where \(\) is a vector of independent normal random variables with zero mean and unit variance. We run multiple realizations of the discretized SDE with time-step \( t\) to generate empirical distributions at a given time.

Non-equilibrium Ornstein-Uhlenbeck processWe consider a 6-dimensional Ornstein-Uhlenbeck process with diffusion and interaction terms chosen to break the detailed balance and create irreversible phase-space currents at steady state :

\[d=-dt+}d,\] (12)

where \(\) is the interaction matrix, \(\) the diffusion term (symmetric positive semi-definite matrix) and \(\) a standard 6-dimensional Wiener process. We consider the non-symmetric interaction matrix and the anisotropic diffusion matrix used as a benchmark for a trajectory-based force inference method in . We run \(5000\) realizations of the process to generate empirical distributions with \( t=0.01\) and for inference, we use distributions sampled at \( t=0.1\) with \(K=20\). First, we estimate the score via sliced score matching  using a neural network with \(3\) hidden layers containing \(20\) nodes each. The force field network is modeled using a neural network with \(2\) hidden layers containing \(10\) nodes per layer. In Fig. 2, we illustrate how our framework enables accurate reconstruction of the force field from a few time snapshots of the empirical distributions, and in particular how it captures the non-reciprocal interactions, which manifest themselves as spirals in the 2-dimensional projections of Fig 2B. On the contrary, we see in Fig 2A that our approach captures just reciprocal (symmetric) interactions when applied to stationary data and learns a radial vector field instead. Given the autonomous nature of the inferred non-linear field, we can predict beyond the training horizon as shown in Fig.2D.

Figure 2: **Non-equilibrium 6D Ornstein-Uhlenbeck process.** (A) Equilibrium force \(}^{}()\) inferred from stationary distribution. The background watercolor corresponds to the density field estimated from the samples. (B) The inferred force field (red arrows) overlaid on the exact force field (black arrows). (C) Inferred force field vs. exact force field (1st and 3rd components). (D) Relative Mean-Squared Error \(()=\|}_{}-\|_{2}^{2}/\| \|_{2}^{2}\) as a function of time. The force field is inferred from cross-sectional samples taken before a specific point in time, indicated by a dashed line. (E) Comparison of interaction matrices obtained from inference with stationary data (E2), non-stationary data (E3), non-stationary data + noise model (E4), with the interaction matrix \(\) of the true process (E1).

Once the force field is inferred, we can then compute the interaction matrix as the Jacobian of the estimated force field:

\[}()=(}_{}}{  x_{1}}}_{}}{  x_{d}}),}} _{k=1}^{K}}((t_{k})),\]

where \(...\) represents the average over all measured cross-sectional samples. Since the force field is parameterized by a neural network, we can use backpropagation to evaluate the Jacobian. We see using (9) that at steady-state the equilibrium interaction matrix recovered \(}^{}\) reads:

\[}^{}^{2} p( ).\] (13)

From this equation, we can see that in the presence of anisotropic diffusion, the equilibrium interaction matrix is non-symmetric. In Fig. 2E2 we illustrate this fact as the interaction matrix learned on stationary data (and thus corresponding to vanishing phase-currents) is non-symmetric. Importantly, and in agreement with the results shown Fig. 2A-B, the estimated equilibrium matrix \(}^{}\) is an inaccurate reconstruction of the true interaction matrix \(\) as shown in Fig. 2E1 and 2E2. Following this observation, we show in Fig. 2E3 that inferring on non-stationary data without noise prior (D = 0, akin to TrajectoryNet ) does not permit a faithful reconstruction of \(\), and that only our complete inference scheme in Fig. 2E4 can accurately infer the interaction matrix.

We evaluate our method's effectiveness in inferring non-linear fields in a 2D OU process with harmonic trapping. In Fig. 4, we show the reconstructed force field and also investigate the impact of sampling rate and diffusion constant on inference accuracy, noting a decline in accuracy with increased diffusion coefficients and reduced sampling rates.

Stochastic chemical kineticsMultiplicative noise is ubiquitous in biological processes whose properties emerge from birth-death dynamics . To illustrate the ability of our method to deal with this type of system, we consider the Schlogl model, a canonical chemical reaction system that exhibits bistability:

\[A+2X[k_{2}]{k_{1}}3X,\ B[k_{4}]{k_{3}}X,\] (14)

where species \(A\) and \(B\) are kept at a constant concentration, denoted \(a\) and \(b\) respectively. We can describe the stochastic evolution of this process using a Chemical Master Equation (CME) , which extends the deterministic law of mass-action to account for fluctuations in copy numbers of each species. Denoting \(x\) the concentration of species \(X\), the CME can be approximated by a Chemical Langevin Equation (CLE) :

\[dx=[u(x)-v(x)]dt+}dW,\] (15)

Figure 3: **Non-equilibrium 2D Ornstein-Uhlenbeck process with harmonic trapping at the origin where \(()=-+ e^{-x^{2}/2^{2 }}\), where \(=(2&2\\ -2&2)\). (A) Equilibrium force \(}^{}()\) inferred from stationary data. (B) The inferred force field (red arrows) overlaid on the exact force field (black arrows). (C) RMSE versus sampling rate \( t 1/N_{k}\) for different diffusion coefficients. We ran \(1000\) realization of the process with \( t=0.001\) as per the discretization in (11) with \(=10,=2\), and sample empirical distributions with \( t=\{0.025,0.05,0.1,0.2\}\) during inference. The score was estimated with a neural network with \(4\) hidden layers containing \(10\) nodes each. The force field is inferred via a neural network with \(2\) hidden layers and \(10\) nodes per layer.**

where \(W\) is a standard Wiener process and \(V\) is the volume of the system. According to the law of mass-action applied to (14), the volumetric growth and decay rates of \(X\) are, respectively, \(u(x)=k_{1}ax^{2}+k_{3}b\) and \(v(x)=k_{2}x^{3}+k_{4}x\). At this level of coarse-graining the fluctuations in the concentration of \(X\) are directly prescribed by the volumetric rates \(u\) and \(v\). This observation is especially true in gene regulatory networks which are well described by high-dimensional CLEs , or simplifications of it .

In this example, we rely on the functional correspondence between the force field \((u-v)\) and diffusion \((u+v)\), to infer both. The approximate probability flow associated with (15) is given as

\[=(1-(x)}{2V}u(x)-1+ (x)}{2V}v(x)-_{x}u(x)+ _{x}v(x)).\] (16)

The simulation data is generated for the choice of parameters \(k_{1}=0.3,k_{2}=0.02,k_{3}=1.2,k_{4}=1,a=1,b=1\), and \(V=20\) with \( t=0.01\). We ran \(1000\) realizations of the process to generate \(K=20\) distributions separated by \( t=0.2\). The score was estimated via score matching (7) using a neural network with \(2\) hidden layers and \(10\) nodes per layer. The volumetric growth rate \(u(x)\) and the decay rate \(v(x)\) are modeled as the outputs of a single neural network with concentration \(x\) as input, with \(3\) hidden layers and \(10\) nodes per layer. The neural network is then optimized based on the approximate probability flow (16) to solve the density fitting problem. In Fig. 4, we demonstrate that a few cross-sectional snapshots are sufficient to quantitatively infer both the force and diffusion field. We train our force model on data far from steady state and thus we only capture one stationary point in the force field as shown in Fig. 4B. We also provide a comparison with the TrajectoryNet -like approach where the knowledge about the noise is ignored and, therefore, fails to identify the true force field. This clearly highlights the non-negligible role of multiplicative noise in chemical reaction networks, and how our inference framework can be used to distinguish the force field from intrinsic noise.

## 5 Discussion

In this paper, we developed a force-field inference approach for diffusion processes using cross-sectional samples given at a limited number of time points. We demonstrate our method on biophysically relevant examples, and we show that our approach successfully identifies both linear and non-linear non-conservative force fields from non-stationary data, while it recovers the corresponding equilibrium dynamical model when applied to steady-state data. Additionally, in CLEs where fluctuations are prescribed by the underlying force field, we can jointly infer both the force field and the diffusion term. Unlike most trajectory inference methods, our approach allows simultaneously to (i) learn potentially nonlinear dynamical models consistent with cross-sectional measurements at all times and (ii) investigate the effect of arbitrary noise models, and in particular multiplicative models.

Future work should (i) investigate the effect of sampling rate and measurement noise on the accuracy of the inference scheme, (ii) extend the study on the joint inference of the force field and diffusion to realistic gene regulatory networks where noise is frequently ignored or assumed to be additive, conflicting with the ubiquitous presence of multiplicative noise in biological systems [2; 3; 20].

Figure 4: **Stochastic chemical kinetics.** (A) Cross-sectional empirical distributions are shown at times \(t=\{4,6,8\}\). (B) Comparison between the force field jointly inferred with diffusion term (red) and without the noise model specified (\(=0\), blue). (C) Diffusion term jointly inferred with the force field.