# Convergence Rates of Bayesian Network Policy Gradient for Cooperative Multi-Agent Reinforcement Learning

Convergence Rates of Bayesian Network Policy Gradient for Cooperative Multi-Agent Reinforcement Learning

 Dingyang Chen

University of South Carolina

dingyang@email.sc.edu

&Zhenyu Zhang

Amazon

zhenyuzh@amazon.com

&Xiaolong Kuang

Amazon

xkkuang@amazon.com

&Xinyang Shen

Amazon

xinyans@amazon.com

&Ozalp Ozer

Amazon

ozalpo@amazon.com

&Qi Zhang

University of South Carolina

qz5@cse.sc.edu

###### Abstract

Human coordination often benefits from executing actions in a correlated manner, leading to improved cooperation. This concept holds potential for enhancing cooperative multi-agent reinforcement learning (MARL). Despite this, recent advances in MARL predominantly focus on decentralized execution, which favors scalability by avoiding action correlation among agents. A recent study introduced a Bayesian network to incorporate correlations between agents' action selections within their joint policy, demonstrating global convergence to Nash equilibria under a tabular softmax policy parameterization in cooperative Markov games. In this work, we extend these theoretical results by proving the convergence rate of the Bayesian network joint policy with log-barrier regularization.

## 1 Introduction

Cooperative multi-agent reinforcement learning (MARL) enables autonomous agents to collectively maximize their utility, offering promising applications in areas such as traffic control , coordination of multi-robot systems , and power grid management . However, the joint action space in MARL grows exponentially with the number of agents, posing scalability challenges. To mitigate this, many approaches rely on product policies, where each agent independently selects its action based on its observations. While this simplifies decision-making, it can lead to suboptimal outcomes in cooperative tasks--consider a group of drones performing a synchronized search mission. If each drone acts independently without considering the actions of others, they might overlap in their search areas, wasting resources. In contrast, acting sequentially, where each drone's actions depend on the others, can significantly improve efficiency and coverage. The key research question is how to introduce correlations in multi-agent policies without exacerbating scalability issues. A promising solution is to use a Bayesian network (BN) to capture essential dependencies among agents. This paper provides a theoretical justification on why action dependencies are beneficial.

Recent work has focused on addressing this challenge within Cooperative Markov Games (MGs), a key subclass of Markov games where agents share the same reward function. Policy gradient methods have been shown to converge to Nash policies under product joint policies, with guarantees in tabular settings using both direct  and softmax parameterization [5; 6]. However, while product policies offer scalability, they may incur suboptimality for the learned joint policy. To overcome the limitations of product joint policies, a recent advance  has introduced the use of Bayesian networks to capture correlations among agents' actions. This approach has demonstrated global convergence to Nash equilibria under a tabular softmax policy parameterization. Nonetheless, challenges remain: these methods lack convergence rate analysis and do not achieve optimality as shown in the single-agent setting, particularly when using dense Bayesian networks that can factorize any joint policy, thereby behaving similarly to the single-agent setting . In this paper, we address these gaps by providing a theoretical justification for the benefits of action dependencies in multi-agent policies, along with a convergence rate analysis using log-barrier regularization. Our results show that it is possible to achieve optimality with a dense Bayesian network, offering a promising direction for improving the performance of cooperative MARL systems.

## 2 Preliminaries

Cooperative Markov Game.We consider a cooperative Markov game (MG) \(,,,P,r,\), involving \(N\) agents indexed by \(i=\{1,,N\}\). The game consists of a state space \(\), a joint action space \(=^{1}^{N}\), a transition function \(P:()\), a shared team reward function \(r:\), and an initial state distribution \(()\). Here, \(()\) denotes the set of probability distributions over \(\). We assume full observability, meaning each agent observes the global state \(s\). Under this assumption, a general joint policy \(:()\) maps states to distributions over the joint action space. Given the exponential growth of \(\) with \(N\), the commonly used subclass is the _product policy_, \(=(^{1},,^{N}):_{i} (^{i})\), where the joint policy is factored as a product of local policies \(^{i}:(^{i})\), such that \((a|s)=_{i}^{i}(a^{i}|s)\). The discounted return from time step \(t\) is defined as \(G_{t}=_{l=0}^{}^{l}r_{t+l}\), where \(r_{t}:=r(s_{t},a_{t})\) is the team reward at time step \(t\). The joint policy \(\) induces the value function \(V_{}(s_{t})=_{s_{t+1:},a_{t+1:}}[G_{t}|s_{t}]\) and the action-value function \(Q_{}(s_{t},a_{t})=_{s_{t+1:},a_{t+1:}}[G_{t}|s _{t},a_{t}]\). The cumulative team reward, starting from \(s_{0}\), is denoted as \(V_{}():=_{s_{0}}[V_{}(s_{0})]\). The (unnormalized) _discounted state visitation measure_ under policy \(\), starting at \(s_{0}\), is given by:

\[d_{}^{}(s):=_{s_{0}}[_{t=0}^{}^{t }^{}(s_{t}=s|s_{0})],\]

where \(^{}(s_{t}=s|s_{0})\) is the probability of being in state \(s_{t}=s\) at time \(t\) when starting from \(s_{0}\) and following \(\). Since all agents share the team reward, the objective in cooperative MARL, as in single-agent RL, is to optimize the joint policy to maximize its value, i.e., \(_{}V_{}()\). We now define the concepts of \(\)-Nash and \(\)-optimal policies.

**Definition 1** (\(\)-Nash Policy).: The _Nash-gap_ of a policy \(\) is defined as:

\[():=_{i}(_{^{i}}V_{^{i},^{-i}}()-V_ {}()).\]

A product policy \(=(^{1},,^{N})\) is an \(\)_-Nash policy_ if \(()\).

**Definition 2** (\(\)-Optimal Policy).: The _optimality-gap_ of a policy \(\) is defined as:

\[():=_{^{*}}V_{^{*}}()-V_{}()\]

A policy \(\) is an \(\)_-optimal policy_ if \(()\).

## 3 Bayesian Network Joint Policy

In this work, we focus on a class of joint policies introduced in  that extends beyond product policies by incorporating action dependencies through a Bayesian network (BN). A BN is represented by a directed acyclic graph (DAG) \(=(,)\), where \(\) is the set of vertices (agents), and \(\{(i,j):i,j,i j\}\) is the set of directed edges. The parents of an agent \(i\) are denoted by \(^{i}:=\{j:(j,i)\}\), and their actions are \(a^{^{i}}_{j^{i}}^{j}\), as illustrated in Figure 3. Under full observability, a BN (joint) policy \((,)=(^{1},,^{N},): ()\) is defined, where each local policy \(^{i}:(_{j^{i}}^{j}) (^{i})\) depends on both the global state and the actions of its parents. The joint action \(a=(a^{1},,a^{N})\) is then sampled as \((a|s)=_{i}^{i}(a^{i}|s,a^{^{i}})\).

In this formulation, each local policy \(^{i}\) is parameterized using a tabular softmax function:

\[^{i}=\{^{i}_{s,a^{^{i}},a^{i}}:s ,a^{^{i}}_{j^{i}}^{j}, a^{i}^{i}\},\]

leading to the induced softmax local policy:

\[^{i}_{^{i}}(a^{i}|s,a^{^{i}})(^{i}_{s,a^ {^{i}},a^{i}}),\] (1)

with the BN policy parameterized as \(_{}=(^{1}_{_{1}},,^{N}_{^{N}})\).

In Lemma 1, we derive the policy gradient for the BN policy as parameterized in Equation (1), which will be used to establish our convergence results in this section.

We also introduce several shorthand notations. For a subset \(\) of agents and its complement \(-\), a joint action is decomposed as \(a=(a^{},a^{-})\). The conditional policy for \(a^{}\) is defined as:

\[^{}(a^{}|s,a^{-}):=},a^{-}|s)}{_{^{}}(^{},a^{-}|s)}.\]

The corresponding action-value function is:

\[Q_{}(s,a^{}):=_{a^{-}_{^{- }}(|s,a^{})}[Q_{}(s,a^{},a^{- })].\]

Let \(^{i}_{+}:=^{i}\{i\}\) denote the set of agent \(i\) and its parents. We will also use the abbreviations \(V_{_{}}\) and \(Q_{_{}}\) as \(V_{}\) and \(Q_{}\), respectively.

Note that for BN joint policy, the notion of \(\)-Nash policy and \(\)-optimal policy still hold.

## 4 Learning dynamics

### Policy gradient dynamics with log-barrier regularization

Building on the method in the single-agent setting , we introduce a log-barrier regularized objective, detailed below, to provide finite-time convergence guarantees for policy gradient dynamics:

\[L_{}():= V_{}()-_{i=1}^{N}_{s,a^{ ^{i}}_{S^{^{i}}}} [(_{^{i}},_{}(|s,a^{ ^{i}}))]\] \[= V_{}()+_{i=1}^{N}(^{i}},a^{^{i}}}^{^{i}_{}(a^{i}|s,a^{ ^{i}})}}{|||^{^{i}}||^{ i}|}+|^{i}|)\]

where the log barrier regularization, i.e., the KL divergence with respect to the uniform action-selection distribution, is applied to each agent's policy independently.

**Lemma 1** (Tabular softmax BN policy gradient form with log-barrier regularization, proof in Appendix A).: For the tabular softmax BN policy parameterized as in Equation (1), we have:

\[()}{^{i}_{s,a^{ ^{i}},a^{i}}}=d^{_{}}_{}(s,a^{ ^{i}})^{i}_{^{i}}(a^{i}|s,a^{^{i}})A^{i}_{ }(s,a^{^{i}},a^{i})+||^{ ^{i}}|}(^{i}|}-^{i}_{^{i}}(a^{i}| s,a^{^{i}}))\]

where \(d^{_{}}_{}(s,a^{^{i}}):=d^{_{}}_{}(s)_{ a^{-^{i}}}_{}(a^{-^{i}},a^{^{i}}|s)\), \(A^{i}_{}(s,a^{^{i}},a^{i}):=Q_{}(s,a^{^{i}})- Q_{}(s,a^{^{i}})\).

The policy gradient form with log-barrier regularizer in Lemma 1 generalizes its counterpart for single-agent policies  and for multi-agent product policies [5; 6] under the tabular softmax policy parameterization, which enables us to extend the convergence results to the BN joint policies. Below we state the assumptions used in the convergence results for product policies [5; 6].

**Assumption 1**.: For any \(\) and any state \(s\) of the Markov game, \(d^{}_{}(s)>0\).

**Assumption 2** (Reward function is bounded).: The reward function \(r\) is bounded in the range \([r_{},r_{}]\), such that the value function \(V\) is bounded as \(V_{} V_{}(s) V_{}\  s,\).

We next present our finite-time convergence results for standard policy gradient dynamics with log-barrier regularization in Section 4.2, with proofs in the appendix A.

Figure 1: Various BN policies.

### Convergence rate of Tabular Softmax BN Policy Gradient Dynamics with log-barrier regularization

In Theorem 1, we establish, under the tabular softmax BN policy parameterization, the finite time convergence to a near-Nash policy in a coopertaive MGs of the standard policy gradient dynamics (with log-barrier regularization):

\[_{t+1}^{i}=_{t}^{i}+_{^{i}}L_{}(_{t})\] (2)

where \(\) is the fixed stepsize and the update is performed by every agent \(i\).

For each agent \(i\), parent actions \(a^{^{i}}\), and local action \(a^{i}\), Equation (2) becomes

\[_{s,a^{^{i}},a^{i}}^{i,t+1}=_{s,a^{^{i}},a^ {i}}^{i,t}+_{_{s,a^{^{i}},a^{i}}^{i}}L_{}( _{t})()\] (3)

**Lemma 2**.: ((Log barrier regularization's approximate first-order stationary points are near-Nash, proof in Appendix A.2) Suppose \(\) is such that \(\|_{}L_{}()\|_{2}/(2||||_{i}|^{i}|)\). Then the BN (joint) policy \(_{}=(_{^{1}}^{1},...,_{^{N}}^{N},)\) is a \(2 M\)-Nash policy where \(M:=_{,^{}}\|^{^{}}}{d_{}^{N}} \|_{}\), which is well-defined by Assumption 1.

Lemma 2 extends the results in  in the single-agent setting, and the results in [5; 6] in the multi-agent setting with an uncorrelated uncorrelated product policy, stating that, with the log barrier regularization, approximate first-order stationary points in a BN policy are near-Nash. With Lemma 2, we establish the convergence rate as stated in Theorem 1.

**Theorem 1** (Convergence rate of the BN policy gradient with log-barrier regularization, proof in Appendix A).: Under Assumptions 1 and 2, suppose every agent \(i\) follows the policy gradient dynamics (2), which results in the update dynamics (3) for each each agent \(i\), parent actions \(a^{^{i}}\), and local action \(a^{i}\), with \(}\), then we have \(_{t<T}_{t}\) whenever

\[T ||^{2}_{i}|^{i}|^{2}(r_{ }-r_{})^{2}}{(1-)^{4}^{2}}+|_{i}|^{i}|^{2}_{i}^{P^{i} }|}(r_{}-r_{})}{(1-)}\]

where \(_{}=}-r_{})}{(1-)^{4}}+ _{i}^{P^{i}}|}\) is an upper bound on the smoothness of \(L_{}()\).

The main trick is to view the parent actions \(a^{^{i}}\) as part of the state, so that \(d_{}^{_{}}(s,a^{^{i}})\) becomes the new state visitation measure for the augmented state \((s,a^{^{i}})\). With this transformation, the update dynamics in 1 is similar to the ones for the product policy,i.e., \(:=(,)\), and thus generalize the results to the BN policy.

With the help of a log-barrier regularizer, we establish convergence to the optimal joint policy with a dense Bayesian network in Theorem 2, an outcome not achieved in . This regularizer ensures that every action has a positive and bounded probability of selection, which is crucial for the sufficient coverage of parent actions and achieving optimality.

**Definition 3** (Fully-correlated BN policy).: A BN policy \((,(,))\) is fully-correlated if \(||=N(N-1)/2\), the maximum number of edges in a BN.

**Lemma 3**.: ((Fully-correlated BN policy with Log barrier regularization's approximate first-order stationary points are near-optimal, proof in Appendix A.4) Suppose \(\) is such that \(\|_{}L_{}()\|_{2}/(2||||_{i}|^{i}|)\). Then the BN (joint) policy \(_{}=(_{^{1}}^{1},...,_{^{N}}^{N},)\) is a \(2^{N+1}N M\)-optimal policy where \(M:=_{,^{}}\|^{^{}}}{d_{^{}}^ {2}}\|_{}\), which is well-defined by Assumption 1.

**Theorem 2** (Convergence rate of the fully-correlated BN policy gradient with log-barrier regularization, proof in Appendix A.5).: Under Assumptions 1 and 2, suppose every agent \(i\) follows the policy gradient dynamics (2), which results in the update dynamics (3) for each each agent \(i\), parent actions \(a^{^{i}}\), and local action \(a^{i}\), with \(}\), then we have \(_{t<T}_{t}\) whenever

\[T N^{3}M^{2}|S|^{2}||^{2}_{i}|^{i}|^{2} (r_{}-r_{})^{2}}{^{2}(1-)^{4}}+|^{2}_{i}|^{i}|^{2}(r_{}-r_{}) _{i}^{P^{i}}|}}{(1-)}\]

where \(_{}=}-r_{})}{(1-)^{3}}+ _{i}^{P^{i}}|}\) is an upper bound on the smoothness of \(L_{}()\).

## 5 Limitations

This work primarily focuses on the theoretical aspects of Bayesian network joint policies without exploring their integration with standard MARL algorithms for practical applications.

## 6 Acknowledgments

Qi Zhang acknowledges funding support from NSF award IIS-2154904 and NSF CAREER award 2237963.