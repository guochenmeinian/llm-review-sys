# Optimal Rates for Bandit Nonstochastic Control

Y. Jennifer Sun \({}^{*}\)

Princeton University

Google DeepMind

ys7849@princeton.edu

&Stephen Newman \({}^{*}\)

Princeton University

sn9581@princeton.edu

&Elad Hazan

Princeton University & Google DeepMind

ehazan@princeton.edu

###### Abstract

Linear Quadratic Regulator (LQR) and Linear Quadratic Gaussian (LQG) control are foundational and extensively researched problems in optimal control. We investigate LQR and LQG problems with semi-adversarial perturbations and time-varying adversarial bandit loss functions. The best-known sublinear regret algorithm of Gradu et al. (2020) has a \(T^{}\) time horizon dependence, and the authors posed an open question about whether a tight rate of \(\) could be achieved. We answer in the affirmative, giving an algorithm for bandit LQR and LQG which attains optimal regret (up to logarithmic factors) for both known and unknown systems. A central component of our method is a new scheme for bandit convex optimization with memory, which is of independent interest.

## 1 Introduction

Linear-Quadratic Regulator (LQR) and the more general Linear-Gaussian (LQG) control problems have been extensively studied in the field of control theory due to their wide range of applications and admittance of analytical solutions by the seminal works of Bellman (1954) and Kalman (1960). LQR and LQG control problems study the design of a feedback control policy for a linear dynamical system with the goal of minimizing cumulative, possibly time-varying quadratic costs. The discrete version of the problem studies the control of the following linear dynamical system governed by dynamics \((A,B,C)\)1:

\[_{t+1}=A_{t}+B_{t}+_{t}\;,\;_{t}=C_{t}+_{t}\;,\]

where at time \(t\), \(_{t}\) represents the system's state, \(_{t}\) represents the control exerted on the system, and \(\{_{t}\}_{t=1}^{T}\) represents a sequence of i.i.d. centered Gaussian perturbations injected to the system. For a simple example of the model, consider the problem of controlling an elevator to reach the desired floors while minimizing the discomfort (due to acceleration or deceleration) and the energy consumption. In this case, the state \(_{t}\) would be a vector consisting of the elevator's position and velocity at time \(t\). The control input \(_{t}\) is the force applied by the elevator motor at time \(t\). \(_{t}\) represents process noise at time \(t\), caused possibly by unexpected mechanical disturbances. In the generality of LQG, the system's states are not accessible. In the elevator example, one may not have the access to the measurement of the elevator's velocity or the precise position of the elevator. Instead, the algorithm has access to an observation \(_{t}\), which is a linear transformation of state perturbed by a sequence \(\{_{t}\}_{t=1}^{T}\) of i.i.d. centered Gaussian noises, i.e. the elevator's observed position. The cost isa quadratic function of both the observation and the control exerted. The goal in LQR/LQG problems is to find a control policy \(\) in some policy class \(\) that minimizes the cumulative cost over a finite time horizon \(T\). With \(_{t}^{},_{t}^{}\) denoting the observation and control at time \(t\) resulted from executing policy \(\), the objective is formally given by

\[*{minimize}_{}\;\;J_{T}()}}{{=}}_{t=1}^{T}c_{t}(_{t}^{},_{t}^{ })=_{t=1}^{T}_{t}^{}Q_{t}_{t}^{}+_{t}^{}R_{t}_{t}^{},\]

where \(Q_{t},R_{t}\) are some possibly time-varying state-weighting and control-weighting matrices, respectively. In the elevator example, if our goal is to control the elevator to reach the desired floors while minimizing the discomfort and the energy consumption, the cost function at every time step \(t\) may take the form \(c_{t}(_{t},_{t})=c_{1}\|_{t}-z_{} \|_{2}^{2}+c_{2}\|_{t}\|_{2}^{2}\), where \(z_{}\) is the target position of the elevator, \(c_{1},c_{2}>0\).

Variations of the LQR/LQG problem have garnered considerable interest in the machine learning community. In the recent literature of **online nonstochastic control**, several setting-based generalizations to the aforementioned linear-control framework have been explored, including:

* **Adversarial cost functions**(Cohen et al. (2018); Agarwal et al. (2019)): In this setting, the cost functions are adversarially chosen in an unpredictable way to the learner. This generalized formulation allows for applications such as building climate control in the presence of time-varying energy costs, as the energy costs may depend on unexpected demand fluctuation (Cohen et al. (2018)). More recently, the model of adversarially chosen cost functions, along with adversarial perturbations in the subsequent paragraph, give rise to building connection between control theory and meta optimization (Chen and Hazan (2023)), where the nonconvex problem of hyperparameter tuning (e.g. learning rate tuning) can be reduced to online nonstochastic control, which often admits a convex formulation.
* **Adversarial perturbations**(Agarwal et al. (2019), etc.): In this setting, differing from the usual Gaussian assumption on the perturbation distribution (\(_{t}}{{}}N(0,)\)), nonstochastic control often considers arbitrary disturbances \(_{t}\) in the dynamics. The relaxed assumption on the perturbations allows for the control of nonlinear systems under model inaccuracies by approximating them as linear systems (Ghai et al. (2022)).
* **Bandit feedback**: Together with the aforementioned two generalizations, control under bandit feedback further generalizes the control problem and suits many real-world applications. In the bandit setting, the cost functions is unknown to the learner. The learner has access _only_ to the cost incurred by their chosen control. In addition, the learner has access to the system's state (\(_{t}\) in the fully observed LQR setting) or a noisy, possibly and usually low-dimensional observation (\(_{t}\) in the partially observed LQG setting). The bandit LQG problem can be illustrated with a motivating example. In the problem of controlling medical device such as a ventilator, the state usually represents a number of health status indicators of the patient, such as heart rate, blood pressure, and other related metrics. However, this state may not be fully observable. After the treatment is provided, the learner can observe the patient's response, e.g. changes in some vital indicators, with some observation noise and a cost function, e.g. deviation from the targeted breathing pattern. In this limited information setting, can a learner hope to learn meaning controls under minimal assumptions? Previously, the work of Gradu et al. (2020) and Cassel and Koren (2020) both studied the bandit nonstochastic control problem of fully observed systems and provided provable guarantees.

Taken together, these settings give rise to a general setting in differentiable reinforcement learning that strictly contains a variety of classical problems in optimal and robust control. Naturally, when adversarial costs and perturbations are considered, an optimal solution is _not_ defined a priori. Instead, the primary performance metric is _regret_: the difference between the total cost of a control algorithm and that of the best controller from a specific policy class in hindsight.

As mentioned above, this general setting of bandit nonstochastic control was considered in the recent work of Gradu et al. (2020), whose proposed Bandit Perturbation Controller (BPC) algorithm has a provable regret guarantee of \((T^{})\) when compared to a rich policy class called disturbance action controllers (DAC) for fully observed systems. Similar setting has also been studied by Cassel and Koren (2020), who established an optimal regret up to logarithmic factor of \(()\) for fully observable systems under stochastic perturbations and adversarially chosen cost functions. Recently Ghai et al. (2023) improves the dimension dependence of regret bounds using exploration in action-space rather than parameter-space. However, bandit control for partially observable systems (e.g. LQG) is less understood. Thus, these developments in the search for efficient, low-regret bandit online control algorithms leave a central open question (also stated by by Gradu et al. (2020)):

Can we achieve optimal regret \(O()\) with **bandit LQG** and **nonstochastic noise**?

Our work answers this question up to logarithmic factors. Our novel Ellipsoidal Bandit Perturbation Controller (EBPC) achieves a \(()\) regret guarantee in the presence of semi-adversarial perturbations in bandit LQG problems with strongly convex cost functions, with the additional generality of possibly unknown system dynamics. By Shamir (2013), this is asymptotically optimal up to logarithmic factors, as bandit optimization over quadratics reduces to bandit control with quadratic losses under \(A=0\), \(B=I\). Our work therefore resolves the upper-bound/lower-bound gap for this generalization of LQR/LQG. The following table gives a comprehensive comparison between the regret guarantee of EBPC and existing results in literature.

### Related work

Online Nonstochastic Control and Online LQR.In the last decade, much research has been devoted to the intersection of learning and control. Abbasi-Yadkori and Szepesvari (2011) and Ibrahimi et al. (2012) considered the problem of learning a controller in LQR for known quadratic cost functions and stochastic/martingale difference perturbation sequence when the dynamics of the system is unknown, and achieved \(()\)-regret in this case. Dean et al. (2018) provided the first provable low-regret, efficient algorithm to solve LQR problems with known cost functions and stochastic perturbations. Cohen et al. (2018) extended this result to changing quadratic costs with stochastic perturbations and provided a regret guarantee of \(O()\). Dale et al. (2021) consider the LQG problem with stochastic noise and unknown systems.

More recently, interest has turned to **nonstochastic control**, in which the cost functions and the perturbations can be adversarially chosen Agarwal et al. (2019). A broad spectrum of control problems were reconsidered from the nonstochastic perspective, and several different generalizations were derived. See Hazan and Singh (2022) for a comprehensive text detailing these results.

Online Bandit Convex Optimization with Memory.A classical approach to nonstochastic control of stable/stabilizable linear dynamical systems is to reduce control problems to online convex optimization with bounded memory. This reduction stems from the observation that the effects of past controls decay exponentially in stable/stabilizable systems. In the bandit online convex optimization with bounded memory setting, the learner iteratively plays a decision \(x_{t}\) in a convex set \(^{d}\) and suffers an adversarially chosen loss \(F_{t}(x_{t-H+1:t})\), where \(x_{t-H+1:t}\) is the sequence of points \(x_{t-H+1},...,x_{t}\). In particular, the loss depends on the last \(H\) points played by the algorithm, and the only information revealed to the learner is the scalar loss that they incurred. The goal is to minimize

  Algorithm & Noise & Observation & Feedback & System & Regret \\  Agarwal et al. (2019) & Adversarial & full & full & known & \(()\) \\  Agarwal et al. (2019) & Stochastic & full & full & known & \((1)\) \\  Foster and Simchowitz (2020) & Adversarial & full & full & known & \((1)\) \\  Simchowitz et al. (2020) & Semi-Adv. & partial & full & known & \((1)\) \\  Simchowitz et al. (2020) & Semi-Adv. & partial & full & unknown & \(()\) \\  Gradu et al. (2020) & Adversarial & full & bandit & unknown & \((T^{})\) \\  Cassel and Koren (2020) & Stochastic & full & bandit & known & \(()\) \\  Cassel and Koren (2020) & Adversarial & full & bandit & known & \((T^{})\) \\ 
**Theorem 4.1** & **Semi-Adv.** & **partial** & **bandit** & **known** & \(()\) \\ 
**Theorem 4.2** & **Semi-Adv.** & **partial** & **bandit** & **unknown** & \(()\) \\  

Table 1: Comparison of previous results to our contributions.

_regret_, the difference between the loss actually suffered and the loss suffered under the best single play in hindsight:

\[_{T}}}{{=}}_{t=H}^{T}F_{t}(x_{ t-H+1:t})-_{x}_{t=H}^{T}F_{t}(x,,x).\]

Since the loss function is unknown to the learner in the bandit setting, online bandit convex optimization algorithms make use of low-bias estimators of the true gradient or Hessian. Therefore, it is standard to measure the algorithm's performance by regret over the expectation of losses, where the expectation is taken over the randomness injected when creating such estimators.

Online convex optimization with memory in the full information setting, where the loss function is known to the learner, was proposed by Anava et al. (2015). The work of Agarwal et al. (2019), was the first to connect this to control, and to give a regret bound for online control with adversarial perturbations.

The \((T^{})\) regret bound of Gradu et al. (2020) leveraged the bandit convex optimization method of Flaxman et al. (2005). We focus on the bandit LQR/LQG setting with strongly convex and smooth loss functions. It is thus natural to use the techniques of Hazan and Levy (2014), who obtained a \(()\) regret guarantee for bandit convex optimization without memory.

Online Learning with Delay.One technical difficulty in extending OCO with memory to the bandit setting arises from the requirement of independence between every play and the noises injected from the recent \(H\) steps. We resolve this issue by adapting online learning with delay to the subroutine algorithm used in our BCO algorithm. Online learning with delay was introduced by Quanrud and Khashabi (2015). In particular, Flaspohler et al. (2021) relates online learning with delay to online learning with optimism and established a sublinear regret guarantee for mirror descent algorithms. A similar delay scheme was seen in Gradu et al. (2020).

### Notations and organization

Notation.For convenience and succinctness, we denote \(}}{{=}}H-1\). We use lowercase bold letters (e.g. \(,,,,\)) to denote the states, observations, controls, and noises of the dynamical system 2, and \(d_{},d_{},d_{}\) to denote their corresponding dimensions. We use \(S^{n-1}\) to denote the unit sphere in \(^{n}\), as \(S^{n-1}^{n-1}\). \(_{+},_{++}\) denote all non-negative, positive real numbers, respectively. For a differentiable function \(F:(^{n})^{H}\), we denote the gradient of \(F\) with respect to its \(i\)th argument vector by \(_{i}F()\). \(()\) acting on a square matrix measures the spectral radius of the matrix. For a sequence \(M=(M^{[i]})_{i I}\), we use \(\|M\|_{_{1},}\) to denote the sum of the operator norm: \(\|M\|_{_{1},}}}{{=}}_{i  I}\|M^{[i]}\|_{}\). \((A)\) denotes the \(\)-algebra generated by a random variable \(A\). We use \(O()\) to hide all universal constants, \(()\) to hide \(( T)\) terms, and \(()\) to hide all natural parameters.

Organization.Our method has two main components: a novel algorithm for BCO with memory (EBCO-M), and its application to building a novel bandit perturbation controller (EBPC). Section 2 describes our problem setting. Section 3 gives EBCO-M and its near-optimal regret guarantee. Section 4 introduces EBPC and its regret guarantees to both known and unknown systems.

## 2 The Bandit LQG Problem

In this section we provide necessary background and describe and formalize the main problem of interest. We consider control of linear time-invariant dynamical systems of the form

\[_{t+1}=A_{t}+B_{t}+_{t}\,\ _{t}=C_{t}+_{t}\.\] (2.1)

with dynamics matrices \(A^{d_{} d_{}},B^{d_{ } d_{}},C^{d_{} d_{ }}\). Here, consistent with previous notations, \(_{t}^{d_{}}\) is the state of the system at time \(t\), \(_{t}^{d_{}}\) is the control applied at time \(t\), and \(_{t}^{d_{}},_{t}^{d_{ }}\) are the system and measurement perturbations. At each timestep, the learner may observe \(_{t}^{d_{}}\), which usually represents a possibly noisy projection of the state \(_{t}\) onto some (possibly and usually) low-dimensional space.

In the online bandit setting, the learner is asked to perform a control \(_{t}\) at time \(t\). After the control is performed, the adversary chooses a quadratic cost function \(c_{t}(_{t},_{t})\). The learner observes the scalar \(c_{t}(_{t},_{t})_{+}\) and the signal \(_{t}\), but no additional information about \(c_{t}(,)\), \(_{t}\), \(_{t}\), or \(_{t}\) is given. The goal of the learner is to minimize _expected regret_, where _regret_ against the controller class \(\) is defined as

\[_{T}}}{{=}}_{t=1}^{T}c_{t} (_{t},_{t})-_{}_{t=1}^{T}c_{t}( _{t}^{},_{t}^{})\;,\] (2.2)

where \(_{t}^{}\) is the control exerted at time \(t\) by policy \(\), and \(_{t}^{}\) is the time-\(t\) observation that would have occurred against the same costs/noises if the control policy \(\) were carried out from the beginning.

In controlling linear dynamical systems with partial observations, we often make use of the system's counterfactual signal had no controls been performed since the beginning of the instance:

**Definition 2.1** (Nature's \(\)).: _Nature's \(\) at time \(t\), denoted by \(_{t}^{}\), is the signal that the system would have generated at time \(t\) under \(_{1:t}=0\). We may compute this as_

\[_{t+1}^{}=A_{t}^{}+_{t }\;,\;\;\;_{t}^{}=C_{t}^{},\]

_or, equivalently, \(_{t}^{}=_{t}+_{i=1}^{t-1}CA^{t-i-1} _{i}\)._

Critically, this may be calculated via the Markov operator:

**Definition 2.2** (Markov operator).: _The Markov operator \(G=[G^{[i]}]_{i}\) corresponding to a linear system parametrized by \((A,B,C)\) as in Eq.(2.1) is a sequence of matrices in \(^{d_{} d_{}}\) such that \(G^{[i]}}}{{=}}CA^{i-1}B,\;G^{}}}{{=}}_{d_{} d_{}}\)._

It follows immediately that \(_{t}^{}\) may be computed from observations as \(_{t}^{}=_{t}-_{i=1}^{t}G^{[i]}_ {t-i}\).

### Assumptions

We impose four core assumptions on the problem:

**Assumption 2.3** (Stable system).: _We assume the system is stable: the spectral radius \((A)<1\)3._

This assumption has the following important consequence:

**Remark 2.4** (Decay of stable systems).: _That the system is stable implies that \( P_{d_{} d_{}}\), \(P(d_{})\) such that \(rP A^{}PA\) for some \(0 r<1\), and therefore \(\) depending on \(\|B\|_{},\|C\|_{},_{}(P)\) such that \(\|G^{[i]}\|_{} r^{i-1}\). Then with \(H=O( T)\), we can assume that \(\|G\|_{_{1},}=_{i=0}^{}\|G^{[i]}\|_{} R_ {G}\) and \(_{G}(H)}}{{=}}_{i=H}^{}\|G^{[i] }\|_{}}{T}\)._

Together, Assumption 2.3 and its consequence Remark 2.4 allows modeling the nonstochastic control problem as an online convex optimization problem against adversary with bounded memory, as the effect of past controls decays exponentially. Assumption 2.5-2.7 introduce the assumptions on the adversarial cost functions and perturbations.

**Assumption 2.5** (Noise model).: _The perturbations \(\{_{t},_{t}\}_{t=1}^{T}\) are assumed to be semi-adversarial: \(_{t},_{t}\) decompose as sums of adversarial and stochastic components \(_{t}=_{t}^{}+_{t}^{}\) and \(_{t}=_{t}^{}+_{t}^{}\). The stochastic components of the perturbations are assumed to come from distributions satisfying \(\![_{t}^{}]=\![ _{t}^{}]=0\), \([_{t}^{}_{t}^{ }]_{}^{2}I\), \([_{t}^{}_{t}^{ }]_{}^{2}I\), \(_{}>0\). \(\{_{t},_{t}\}_{t=1}^{T}\) are bounded such that \(\|_{t}^{}\|_{2} R_{}\), \( t\), for some parameter \(R_{}\)._The bound on \(}\) is implied by bounded noise, which is a standard assumption in literature, and the stability of the system. The semi-adversarial assumption is also seen in prior work (Simchowitz et al., 2020), and is a necessary condition for our analysis: we depend on the regret guarantee of a bandit online convex optimization with memory algorithm which requires the strong convexity of the expected loss functions conditioned on all but the \((( T))\) most recent steps of history. This assumption is essentially equivalent to the adversarial assumption in applications: in almost all systems, noise is either endemic or may be injected. We also emphasize that this assumption is much weaker than that of previous optimal-rate work: even in the known-state, known-dynamic case, the previous optimal guarantee in the bandit setting depended on _no_ adversarial perturbation (see Table 1).

**Assumption 2.6** (Cost model).: _The cost functions \(c_{t}(,)\) are assumed to be quadratic, \(_{c}\)-strongly convex, \(_{c}\)-smooth, i.e. \(c_{t}(,)=^{}_{t}+ ^{}R_{t}\) with \(_{c}I Q_{t}_{c}I,_{c}I R_{t} _{c}I\  t\). They are also assumed to obey the following Lipschitz condition: \((,),(^{},^{}) ^{d+d_{u}}\),_

\[|c_{t}(,)-c_{t}(^{},^{})|  L_{c}(\|(,)\|_{2}\|(^{},^{})\|_{2})\|(-^{},-^{ })\|_{2}.\] (2.3)

These conditions are relatively standard for bandit convex optimization algorithms, and are needed for the novel BCO-with-memory algorithm which underpins our control algorithm.

**Assumption 2.7** (Adversary).: \(\{c_{t}(,),_{t}^{},_{t}^{}\}_{t=1}^{T}\) _is chosen by the adversary ahead of time._

### Disturbance Response Controllers

Regret compares the excess cost from executing our proposed control algorithm with respect to the cost of the best algorithm in hindsight from a given policy class. In particular, low regret against a rich policy class is a very strong near-optimality guarantee. We take the comparator policy class \(\) to be the set of disturbance response controllers (DRC), formally given by the following definition.

**Definition 2.8** (Disturbance Response Controllers).: _The disturbance response controller (DRC) and the DRC policy class are defined as:_

* \(A\) _disturbance response controller (DRC)_ _is a policy_ \(_{M}\) _parametrized by_ \(M=(M^{[j]})_{j=0}^{}\)_, where_ \(H_{++}\)_, a sequence of_ \(H\) _matrices in_ \(^{d_{u} d_{y}}\) _s.t. the control at time_ \(t\) _given by_ \(_{M}\) _is_ \(_{t}^{_{M}}=_{j=0}^{}M^{[j]}_{t-j}^{ }\)_. We shorthand_ \(_{t}^{M}=_{t}^{_{M}}\)_._
* _The_ _DRC policy class_ _parametrized by_ \(H_{++}\)_,_ \(R_{+}\) _is the set of all disturbance response controller with bounded length_ \(H\) _and norm_ \(R\)_:_ \((H,R)=\{M=(M^{[j]})_{j=0}^{}\|M\|_{_{1},}=_{j=0}^{}\|M^{[j]}\|_{} R\}\)_._

Previous works have demonstrated the richness of the DRC policy class. In particular, Theorem 1 from Simchowitz et al. (2020) has established that the DRC policy class generalizes the state-of-art benchmark class of stabilizing linear dynamic controllers (LDC) with error \(e^{-(H)}\).

### Approach and Technical Challenges

The classical approach in online nonstochastic control of stable/stabilizable systems is to reduce to a problem of online convex optimization with memory. This insight relies on the exponentially decaying effect of past states and controls on the present, which allows approximating the cost functions as functions of the most recent controls.

A core technical challenge lies in the bandit convex optimization problem obtained from the bandit control problem. In the bandit setting, no gradient information is given to the learner, and thus the learner needs to construct a low-bias gradient estimator. Previous work uses the classical spherical gradient estimator proposed by Flaxman et al. (2004), but the regret guarantee is suboptimal. We would like to leverage the ellipsoidal gradient estimator proposed by Hazan and Levy (2014). However, when extending to loss functions with memory, there is no clear mechanism for obtaining a low-bias bound for general convex functions. We exploit the quadratic structure of the LQR/LQG cost functions to build EBCO-M (Algorithm 1), which uses ellipsoidal gradient estimators. We note that even outside of the control applications, EBCO-M may be of independent interests in bandit online learning theory.

BCO with Memory: Quadratic and Strongly Convex Functions

As with previous works, our control algorithm will depend crucially on a generic algorithm for bandit convex optimization with memory (BCO-M). We present a new online bandit convex optimization with memory algorithm that explores the structure of quadratic costs to achieve near-optimal regret.

### Setting and working assumptions

In the BCO-M setting with memory length \(H\), we consider an algorithm playing against an adversary. At time \(t\), the algorithm is asked to play its choice of \(y_{t}\) in the convex constraint set \(\). The adversary chooses a loss function \(F_{t}:^{H}_{+}\) which takes as input the algorithm's current play as well as its previous \(\) plays. The algorithm then observes a cost \(F_{t}(y_{t-},,y_{t})\) (and no other information about \(F_{t}()\)) before it chooses and plays the next action \(y_{t+1}\). The goal is to minimize regret with respect to the expected loss, which is the excessive loss incurred by the algorithm compared to the best fixed decision in \(\):

\[_{T}}}{{=}}_{t=H}^{T} [F_{t}(y_{t-},,y_{t})]-_{x}_{t=H} ^{T}[F_{t}(x,,x)].\]

For notation convenience, we will at times shorthand \(y_{t-:t}}}{{=}}(y_{t-},,y_{t})^{H}\).

#### 3.1.1 Bco-M assumptions

We make the following assumptions on the loss functions \(\{F_{t}\}_{t=H}^{T}\) and the constraint set \(\).

**Assumption 3.1** (Constraint set).: \(\) _is convex, closed, and bounded with non-empty interior. \(()=_{z,z^{}}\|z-z^{}\|_{2 } D\)._

**Assumption 3.2** (Loss functions).: _The loss functions chosen by the adversary obeys the following regularity and curvature assumptions:_

* \(F_{t}:^{H} R_{+}\) _is quadratic and_ \(\)_-smooth:_
* _Quadratic:_ \( W_{t}^{nH nH},b_{t}^{nH},c_{t} \) _such that_ \(F_{t}(w)=w^{}W_{t}w+b_{t}^{}w+c_{t}\)_,_ \( w^{H}\)_._
* _Smooth:_ \(W_{t} I_{nH nH}\)_._
* \(F_{t}:^{H}_{+}\) _is_ \(\)_-strongly convex in its induced unary form:_ \(f_{t}:_{+}\) _with_ \(f_{t}(z)=F_{t}(z,,z)\) _is_ \(\)_-strongly convex, i.e._ \(f_{t}(z) f_{t}(z^{})+ f_{t}(z^{})^{}(z-z^{})+ \|z-z^{}\|_{2}^{2}\)_,_ \( z,z^{}\)_._
* \(F_{t}\) _satisfies the following diameter and gradient bound on_ \(\)_:_ \( B,L>0\) _such that_ \[B=_{w,w^{}^{H}}|F_{t}(w)-F_{t}(w^{})|,\ \ L=_{w^{H}}\| F_{t}(w)\|_{2}.\]

In the online control problems, when formulating the cost function \(c_{t}\) as a function \(F_{t}\) of the most recent \(H\) controls played, the function \(F_{t}\) itself may depend on the entire history of the algorithm through step \(t-H\). Therefore, it is essential to analyze the regret guarantee of our BCO-M algorithm when playing against an adversary that can be \((t-H)\)-adaptive, giving rise to the following assumption.

**Assumption 3.3** (Adversarial adaptivity).: _The adversary chooses \(F_{t}\) independently of the noise \(u_{t-:t}\) which is drawn by the algorithm in the \(H\) most recent steps, but possibly not independently of earlier noises._

Note that Assumption 3.3 is minimal for BCO: if this fails, then in the subcase of a delayed loss, the adversary may fully control the agent's observations, resulting in no possibility of learning.

Self-concordant barrier.The algorithm makes use of a _self-concordant barrier_\(R()\) of \(\) as the regularization function in the updates.

**Definition 3.4** (Self-concordant barrier).: _A three-time continuously differentiable function \(R()\) over a closed convex set \(^{n}\) with non-empty interior is a \(\)-self-concordant barrier of \(\) if it satisfies the following two properties:_

1. _(Boundary property) For any sequence_ \(\{x_{n}\}_{n}()\) _such that_ \(_{n}x_{n}=x\)_,_ \(_{n}R(x_{n})=\)_._
2. _(Self-concordant)_ \( x()\)_,_ \(h^{n}\)_,_ 1. \(|^{3}R(x)[h,h,h]| 2|^{2}R(x)[h,h]|^{3/2}\)_._ 2. \(| R(x),h||^{2}R(x)[h,h]|^{1/2}\)_._

### Algorithm specification and regret guarantee

We present EBCO-M (Algorithm 1) for online bandit convex optimization with memory. The key novelty is the use of an ellipsoidal gradient estimator. It is difficult to establish a low-bias guarantee for ellipsoidal gradient estimator for general convex loss functions. However, thanks to the quadratic structure of the loss functions in LQR/LQG problems, we can show provable low bias for the ellipsoidal gradient estimator, and therefore achieve optimal regret.

```
1:Input: Convex, closed set \(^{n}\) with non-empty interior, time horizon \(T\), memory length \(\), step size \(\), \(\)-self-concordant barrier \(R()\) over \(\), convexity strength parameter \(\).
2:Initialize \(x_{t}=_{x}R(x)\), \( t=1,,H\).
3:Compute \(A_{t}=(^{2}R(x_{t})+ t)^{-1/2}\), \( t=1,,H\).
4:Sample \(u_{1},,u_{H} S^{n-1}\) i.i.d. uniformly at random.
5:Set \(y_{t}=x_{t}+A_{t}u_{t}, t=1,,H\).
6:Set \(g_{t}=0, t=1,,\).
7:Play \(y_{1},,y_{}\).
8:for\(t=H,,T\)do
9:Play \(y_{t}\), suffer loss \(F_{t}(y_{t-:t})\).
10:Store \(g_{t}=nF_{t}(y_{t-:t})_{i=0}^{}A_{t-i}^{-1}u_{t-i}\).
11:Set \(x_{t+1}=_{x}_{s=H}^{t}(g_{s-}^{-}x+\|x-x_{s-}\|^{2})+R(x)\).
12:Compute \(A_{t+1}=(^{2}R(x_{t+1})+(t+1)I)^{-1/2}\).
13:Sample \(u_{t+1} S^{n-1}\) uniformly at random.
14:Set \(y_{t+1}=x_{t+1}+A_{t+1}u_{t+1}\).
15:endfor ```

**Algorithm 1** Ellipsoidal BCO with memory (EBCO-M)

Before analyzing the regret, we first make note of two properties of Algorithm 1.

**Remark 3.5** (Delayed dependence).: _In Algorithm 1, \(x_{t}\) is independent of \(u_{t-:t}\), \( t\), and therefore \(A_{t}\) is independent of \(u_{t-:t}\) as \(A_{t}\) is determined by \(x_{t}\)._

**Remark 3.6** (Correctness).: \(y_{t}\) _played by Algorithm 1 lies in \(\): \(\|y_{t}-x_{t}\|_{^{2}R(x_{t})}^{2}=\|A_{t}u_{t}\|_{^{2}R(x_{t})}^{ 2}\|u_{t}\|_{2}^{2}=1\), and by Proposition C.1, the Dikin ellipsoid centered at \(x_{t}\) is contained in \(\)._

We give the following two theorems on regret guarantees of the EBCO-M algorithm. In particular, Theorem 3.6.B is a slight generalization of Theorem 3.6.A in its relaxation on the curvature assumption on the sequence of loss functions \(F_{H:T}\).

**Theorem 3.6.A** (EbcO-M regret with strong convexity).: _For any sequence of cost functions \(\{F_{t}\}_{t=H}^{T}\) satisfying Assumption 3.2, constraint set \(\) satisfying Assumption 3.1, adversary satisfying Assumption 3.3, and \(H=( T)\), Algorithm 1 satisfies the regret bound_

\[_{T}()=_{t=H}^{T}[F_{t}(y_{t-:t })]-_{x}_{t=H}^{T}[f_{t}(x)]}(),\]

_where the expectation is taken over the randomness of the exploration noises \(u_{1:T}\), with \(}\) hiding all natural parameters (\(B,D,L\)) and logarithmic dependence on \(T\)._

**Theorem 3.6.B** (Ebco-M regret with conditional strong convexity).: _Suppose Algorithm 1 is run on \(\) satisfying Assumption 3.1 against an adversary satisfying Assumption 3.3 with a sequence of random cost functions \(\{F_{t}\}_{t=H}^{T}\) satisfying that_

1. \(F_{t}\) _is quadratic, convex,_ \(\)_-smooth, has diameter bound_ \(B\) _and gradient bound_ \(L\) _on_ \(^{H}\)_._
2. \(\) _filtration_ \(_{1:T}\) _such that_ \(u_{1:T}\) _is independent of_ \(_{T}\)_,_ \(F_{t}(_{1:t-H})_{t}\)_, and_ \(F_{t}\) _is conditionally_ \(\)_-strongly convex in its induced unary form:_ \(_{t}(z)}}{{=}}[f_{t}(z) u _{1:t-H},_{t-H}]\) _is_ \(\)_-strongly convex._

_Then, Algorithm 1 satisfies the same regret bound attained in Theorem 3.6.A, i.e._

\[_{T}()=_{t=H}^{T}[F_{t}(y_{t-:t})]-_{x}_{t=H}^{T}[f_{t}(x)]}(),\]

_where the expectation is taken over the randomness of the exploration noises \(u_{1:T}\) and the random functions \(F_{H:T}\), with \(}\) hiding all natural parameters \((B,D,L)\) and logarithmic dependence on \(T\)._

## 4 Bandit Controller: Known and Unknown Systems

We will now use our BCO-with-memory algorithm to find an optimal controller (as in Gradu et al. (2020)), arguing that regret in choice of controller transfers into the setting discussed in the previous section. We first consider the case where the system is known, and then reduce the unknown system case to the known system case.

### Known systems

Applying Algorithm 1 to predict controllers4 with losses given by control losses, we obtain Algorithm 2.

```
1:Input: Time horizon \(T\), memory length \(H\), Markov operator \(G\). BCO-M parameters \(,\). Self-concordant barrier \(R()\) over \((H,R)^{H d_{} d_{}}\).
2:Initialize \(M_{1}==M_{H}=(H,R)}{}\ R(M)\).
3:Compute \(A_{i}=(^{\!\!}R(M_{i})+ tI)^{-1/2}\), \( i=1,,H\).
4:Sample \(_{1},,_{H} S^{H d_{} d_{ }-1}\) i.i.d. uniformly at random.
5:Set \(_{i}=M_{i}+_{i}\), \( i=1,,H\). Set \(g_{i}=0\), \( i=1,,\).
6:Play control \(_{i}=0\), incur cost \(c_{i}(_{i},_{i})\), \( i=1,,\).
7:for\(t=H,,T\)do
8:Play control \(_{t}=_{t}(_{t})=_{i=0}^{} _{i}^{[i]}_{t-i}^{}\), incur cost \(c_{t}(_{t},_{t})\).
9:Observe \(_{t+1}\) and compute signal \(_{t+1}^{}=_{t+1}-_{i=1}^{t}G^{[i]}_{t-i}\).
10:Store \(g_{t}=d_{}d_{}HC_{t}(_{t},_{t})_{ i=0}^{}A_{t-i}^{-1}_{t-i}\).
11:Update \(M_{t+1}=(H,R)}{}_{s=H}( g_{s- },M+\|M-M_{s-}\|^{2})+ R(M)\).
12:Compute \(A_{t+1}=(^{\!\!}R(M_{t+1})+(t+1)I)^{-1/2}\).
13:Sample \(_{t+1} S^{H d_{} d_{}-1}\) uniformly at random. Set \(_{t+1}=M_{t+1}+A_{t+1}_{t+1}\).
14:endfor ```

**Algorithm 2** Ellipsoidal Bandit Perturbation Controller (EBPC)

**Theorem 4.1** (Known system control regret).: _Consider a linear dynamical system governed by known dynamics \((A,B,C)\) and the interaction model with adversarially chosen cost functionsand perturbations satisfying Assumption 2.3, 2.5, 2.6, 2.7. Then running Algorithm 2 with \(H=(( T))\), \(=_{c}(_{}^{2}+_{}}(C)}{1+\|A\|_{}^{_{}}})\), and \(=(}d_{}L_{c}H^{3}})\) guarantees_

\[[_{T}()]}(d_{}d_{}}{_{c}}),\]

_where regret is defined as in Eq.(2.2), the expectation is taken over the exploration noises \(_{1:T}\) of the algorithm as well as the stochastic components \(\{_{t}^{},_{t}^{}\}_{t=1}^{T}\) of the perturbations \(\{_{t},_{t}\}_{t=1}^{T}\), and \(}()\) hides all universal constants, natural parameters, and logarithmic dependence on \(T\)._

### Unknown systems: control after estimation

Note that EBPC (Algorithm 2) relies on the access to the system's Markov operator \(G\), which is available if and only if the system dynamics \((A,B,C)\) are known. When the system dynamics is unknown, we can identify the system using a system estimation algorithm, obtain an estimated Markov operator \(\), and run EBPC with \(G\). Algorithm 3 outlines the estimation method of system dynamics via least squares.

```
1:Input: estimation sample size \(N\), system length \(H\).
2:Initialize: \(^{[t]}=0\), \( t H\).
3:Sample and play \(_{t} N(0,I_{d_{} d_{}})\), \( t=1,,N\).
4:Set \(^{[0:]}=_{t=H}^{N}\|_{t}-_{i=0}^{ {H}}^{[i]}_{t-i}\|_{2}^{2}\).
5:Return \(\). ```

**Algorithm 3** System estimation via least squares (SysEst-LS)

**Theorem 4.2** (Unknown system control regret).: _Consider a linear dynamical system governed by unknown dynamics \((A,B,C)\) and the interaction model with adversarially chosen cost functions and perturbations satisfying Assumption 2.3, 2.5, 2.6, 2.7. Suppose we obtain an estimated Markov operator \(\) from Algorithm 3 with \(N=\) and \(H=( T)\). Then Algorithm 2 with \(G\), \(H 3H\), \(=_{c}_{}^{2}\), and \(=(}d_{}L_{c}H^{3}})\) guarantees_

\[[_{T}()]}(d_{}d_{}}{_{c}}),\]

_where regret is defined as in Eq.(2.2), the expectation is taken over the exploration noises \(_{1:T}\) in Algorithm 2, the sampled Gaussian controls \(_{1:N}\) in Algorithm 3, and the stochastic components \(\{_{t}^{},_{t}^{}\}_{t=1}^{T}\) of the perturbations \(\{_{t},_{t}\}_{t=1}^{T}\), and \(}()\) hides all universal constants, natural parameters, and logarithmic dependence on \(T\)._

## 5 Discussion and conclusion

We solve the open problem put forth by Gradu et al. (2020) on the optimal rate for online bandit control for the case of LQR/LQG control, improving to regret \(()\) from \((T^{})\) in the semi-adversarial noise model and for strongly convex LQR/LQG cost functions. Our method builds upon recent advancements in bandit convex optimization for quadratic functions, providing the first near-optimal regret algorithm for bandit convex optimization with memory in a nonstochastic setting.

It would be interesting to investigate (1) whether the results can be extended to fully adversarial noise, (2) whether a similar stable controller recovery as seen in (Chen and Hazan, 2021) for fully observable systems can be established for partially observable systems, and whether that can be incorporated to extend our result to stabilizable systems even without access to a stabilizing controller.

## 6 Acknowledgement

Elad Hazan acknowledges funding from the Office of Naval Research grant N000142312156, the NSF award 2134040, and Open Philanthropy.