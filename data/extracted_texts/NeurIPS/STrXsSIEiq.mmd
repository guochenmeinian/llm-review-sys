# Learning Robust Statistics for Simulation-based Inference under Model Misspecification

Daolang Huang

Aalto University

daolang.huang@aalto.fi

&Ayush Bharti

Aalto University

ayush.bharti@aalto.fi

&Amauri H. Souza

Aalto University

Federal Institute of Ceara

amauri.souza@aalto.fi

&Luigi Acerbi

University of Helsinki

luigi.acerbi@helsinki.fi

&Samuel Kaski

Aalto University

University of Manchester

samuel.kaski@aalto.fi

Equal contribution.

###### Abstract

Simulation-based inference (SBI) methods such as approximate Bayesian computation (ABC), synthetic likelihood, and neural posterior estimation (NPE) rely on simulating statistics to infer parameters of intractable likelihood models. However, such methods are known to yield untrustworthy and misleading inference outcomes under model misspecification, thus hindering their widespread applicability. In this work, we propose the first general approach to handle model misspecification that works across different classes of SBI methods. Leveraging the fact that the choice of statistics determines the degree of misspecification in SBI, we introduce a regularized loss function that penalizes those statistics that increase the mismatch between the data and the model. Taking NPE and ABC as use cases, we demonstrate the superior performance of our method on high-dimensional time-series models that are artificially misspecified. We also apply our method to real data from the field of radio propagation where the model is known to be misspecified. We show empirically that the method yields robust inference in misspecified scenarios, whilst still being accurate when the model is well-specified.

## 1 Introduction

Bayesian inference traditionally entails characterizing the posterior distribution of parameters assuming that the observed data came from the chosen model family . However, in practice, the true data-generating process rarely lies within the family of distributions defined by the model, leading to _model misspecification_. This can be caused by, among other things, measurement errors or contamination in the observed data that are not included in the model, or when the model fails to capture the true nature of the physical phenomenon under study. Misspecified scenarios are especially likely for simulator-based models, where the goal is to describe some complex real-world phenomenon. Such simulators, also known as implicit generative models , have become prevalent in many domains of science and engineering such as genetics , ecology , astrophysics , economics , telecommunications , cognitive science , and agent-based modeling . The growing field of _simulation-based inference_ (SBI)  tackles inference for such intractable likelihood models, where the approach relies on forward simulations from the model, instead of likelihood evaluations, to estimate the posterior distribution.

Traditional SBI methods include approximate Bayesian computation (ABC) , synthetic likelihood  and minimum distance estimation . More recently, the use of neural networksas conditional density estimators  has fuelled the development of new SBI methods that target either the likelihood (neural likelihood estimation) , the likelihood-to-evidence ratio (neural ratio estimation) , or the posterior (neural posterior estimation) . A common feature of all these SBI methods is the choice of summary statistics of the data, which readily impacts their performance . The summary statistics are either manually handcrafted by domain experts, or learned automatically from simulated data using neural networks .

The unreliability of Bayesian posteriors under misspecification is exacerbated for SBI methods as the inference relies on simulations from the misspecified model. Moreover, for SBI methods using conditional density estimators , the resulting posteriors can be wildly inaccurate and may even go outside the prior range ; see  for an instance of this problem in the study of molecules. This behavior is exemplified in Figure 1 for the posterior-targeting neural SBI method called _neural posterior estimation_ (NPE). We see that when the model is misspecified, the NPE posterior goes outside the prior range. This is because the model is unable to match the observed statistic for any value of the parameters, as shown in Figure 1(left), and hence, NPE is forced to generalize outside its training distribution, yielding a posterior that is outside the prior range.

We argue that the choice of statistics is crucial to the notion of misspecification in SBI. Suppose we wish to fit a Gaussian model to data from some skewed distribution. If we choose, for instance, the sample mean and the skewness as statistics, then the Gaussian model would fail to match these statistics for any choice of parameters, and we would end up in the same situation as in Figure 1 where the SBI method is forced to generalize outside its training distribution. However, choosing the sample mean and sample variance as statistics instead may solve this issue, as the model may be able to replicate the chosen statistics for some value of parameters, even though the Gaussian model itself is misspecified for any skewed dataset. This problem of identifying a low-dimensional statistic of a high-dimensional dataset for which the model of interest is correctly specified is termed the _data selection problem_. We refer to the statistics that solve the data selection problem as being _robust_.

Contributions.In this paper, we learn robust statistics using neural networks to solve the data selection problem. To that end, we introduce a regularized loss function that balances between learning statistics that are informative about the parameters, and penalizing those choices of statistics or features of the data that the model is unable to replicate. By doing so, the observed statistic does not go outside the set of statistics that the model can simulate, see Figure 1(middle), thereby yielding a posterior around the true parameter even under misspecification (Figure 1(right)). As our method relies on learning appropriate statistics and not on the subsequent inference procedure, it is applicable to all the statistics-based SBI methods, unlike other robust methods in the literature . We substantiate our claim in Section 4 through extensive numerical studies on NPE and ABC -- two fundamentally different SBI methods. Additionally in Section 5, we apply our method to a real case of model misspecification in the field of radio propagation .

Figure 1: Inference on misspecified Ricker model with two parameters, see Section 4 for details. _Left:_ Learned statistics obtained using NPE; each point (in black) corresponds to a parameter value sampled from the prior. The observed statistic (in red) is outside the set of statistics the model can simulate. _Middle:_ Statistics learned using our robust method; the observed statistic is inside the distribution of simulated statistics. _Right:_ The resulting posteriors obtained from NPE and our method. **The posterior obtained from our method is close to the true parameter value, while that from NPE is completely off, going outside the prior range** (denoted by dashed grey lines).

Related works.Model misspecification has been studied in the context of different SBI methods such as ABC [9; 33; 35; 36; 74], synthetic likelihood [32; 34; 57], minimum distance estimation , and neural estimators [48; 81]. It was first analyzed for ABC methods such as the regression-adjustment ABC  in , and a robust approach was proposed in . In , the authors proposed to handle model misspecification in ABC by incorporating the domain expert while selecting the statistics. Generalized Bayesian inference [12; 43; 49], which is a popular framework for designing methods that are robust to misspecification, has also been linked to ABC  and synthetic likelihood . In , the authors propose a robust SBI method based on Bayesian nonparametric learning and the posterior bootstrap. More recently, robustness to model misspecification has been tackled for neural likelihood  and posterior estimators . We use the latter method, called robust neural posterior estimation (RNPE) , as a baseline for comparing our proposed approach. Our method differs from these previous robust approaches in that it is applicable across distinct SBI methods.

## 2 Preliminaries

Simulation-based inference (SBI).Consider a simulator \(\{_{}:\}\), which is a family of distributions parameterized by \(\) on data space \(^{d}\). We assume that \(_{}\) is intractable, but sampling independent and identically distributed (iid) data \(_{1:n}=\{^{(1)},,^{(n)}\}_ {}\) is straightforward for \(^{(i)}\), \(1 i n\). Given iid observed data \(_{1:n}\), \(^{(i)}\), from some true data-generating process \(\) and a prior distribution of \(\), we are interested in estimating a \(^{}\) such that \(_{^{}}=\), or alternatively, in characterizing the posterior distribution \(p(|_{1:n})\). Since \(\) is a high-dimensional space in most practical cases, it is common practice to project both the simulated and the observed data onto a low-dimensional space of summary statistics \(\) via a mapping \(:^{n}\), such that \(=(_{1:n})\) is the vector of simulated statistics, and \(_{}=(_{1:n})\) the observed statistic. In the following, we assume that this deterministic map \(\) is not known _a priori_, but needs to be learned using a neural network, henceforth called the _summary network_\(_{}\), with trainable parameters \(\). We now introduce two different paradigms for learning the statistics.

Learning statistics in neural posterior estimation (NPE) framework.NPEs are a class of SBI methods which are becoming popular in astrophysics  and nuclear fusion [37; 80], among other fields. They map each statistic vector \(\) to an estimate of the posterior \(p(|)\) using conditional density estimators such as normalizing flows [41; 53; 59; 69]. The posterior is assumed to be a member of a family of distributions \(q_{}\), parameterized by \(\). NPEs map the statistics to distribution parameters \(\) via an _inference network_\(h_{}\), where \(\) constitutes the weights and biases of \(h\), such that \(q_{h_{}()}() p(|)\). The inference network is trained on dataset \(\{(_{i},_{i})\}_{i=1}^{m}\), simulated from the model using prior samples \(\{_{i}\}_{i=1}^{m} p()\), by minimising the loss \(()=-_{p(,)}[ q_{h_{}()}()]\). Once trained, the posterior estimate is then obtained by simply passing the observed statistic \(_{}\) through the trained network. Hence, NPEs enjoy the benefit of amortization, wherein inference on new observed dataset is straightforward after a computationally expensive training phase. In cases where the statistics are not known _a priori_, the NPE framework allows for joint training of both the summary and the inference networks by minimizing the loss function

\[_{}(,)=-_{p(,_{1:n})} [ q_{h_{}(_{}(_{1:n}))}()],\] (1)

on the training dataset \(\{(_{i},_{1:n,i})\}_{i=1}^{m}\). Even though NPEs are flexible and efficient SBI methods, they are known to perform poorly when the model is misspecified [16; 81]. This is because the observed statistic \(_{}\) becomes an out-of-distribution sample under misspecification (see Figure 1 for an example), forcing the inference network in NPE to generalize outside its training distribution.

Learning statistics using autoencoders.Unlike NPEs, statistics for other SBI methods are learned prior to carrying out the inference procedure. This is achieved, for instance, by training an autoencoder with the reconstruction loss 

\[_{}(,_{d})=_{p(,_{1:n}) }[(_{1:n}-_{_{d}}(_{}(_{1:n}) ))^{2}],\] (2)

where \(\) and \(_{d}\) are the parameters of the encoder \(\) and the decoder \(\), respectively. The trained encoder \(_{}\) is then taken as the summarizing function in the SBI method. In this paper, we will use the encoder \(_{}\) to perform inference in an ABC framework, which we now recall.

Approximate Bayesian computation (ABC).ABC is arguably the most popular SBI method, and is widely used in many research domains . ABC relies on computing the distance between the simulated and the observed statistics to obtain samples from the approximate posterior of a simulator. Given a discrepancy \((,)\) and a tolerance threshold \(\), the basic rejection-ABC method involves repeating the following algorithm: (i) sample \(^{} p()\), (ii) simulate \(^{}_{i:n}_{^{}}\), (iii) compute \(^{}=(^{}_{1:n})\), and (iv) if \((^{},_{})<\), accept \(^{}\), until a sample \(\{^{}_{i}\}_{i=1}^{h_{}}\) is obtained from the approximate posterior. Conditional density estimators have also been used in ABC to improve the posterior approximation of the rejection-ABC method [5; 11; 13; 14]. These so-called regression adjustment ABC methods involve fitting a function \(g\) between the accepted parameters and statistics pairs \(\{(^{}_{i},^{}_{i})\}_{i=1}^{n_{}}\) as \(^{}_{i}=g(^{}_{i})+_{i}\), \(1 i n_{}\), where \(\{_{i}\}_{i=1}^{n_{}}\) are the residuals. Once fitted, the acceptance parameter samples are then adjusted as \(^{}_{i}=(_{})+_{i}\), where \(()\) is the estimate of \([|]\) and \(_{i}\) is the empirical residual. Despite the popularity of the regression adjustment ABC methods, they have also been shown to behave wildly under misspecification [9; 35], similar to NPEs.

## 3 Methodology

Model misspecification in SBI.Bayesian inference assumes that there exists a \(^{}\) such that \(_{^{}}=\). Under model misspecification, \(_{}\) for any \(\), which can lead to unreliable predictive distributions. However, this definition does not apply for models whose inference is carried out in light of certain summary statistics. For instance, a Gaussian model is clearly misspecified for a bimodal data sample. However, if inference is based on, say, the sample mean and the sample variance of the data, the model may still match the observed statistics accurately. Hence, even when a simulator is misspecified with respect to the true data-generating process, it may still be well-specified with respect to the observed statistic. The choice of statistics therefore dictates the notion of misspecification in SBI. We propose an analogous definition for misspecification in SBI:

**Definition 3.1** (**Misspecification of model-summarizer pair in SBI**).: _Let \(_{\#}_{}^{n}\) be a pushforward of the probability measure \(_{}^{n}=_{}_{}\) on \(^{n}\) under \(:^{n}\), meaning that for \(A\), \(_{\#}_{}^{n}(A)=_{}^{n}(^{-1}(A))= _{}(^{-1}(A))_{1}_{}( ^{-1}(A)_{n})\). Then, \(\{_{\#}_{}^{n}:\}\) is a set of distributions on the statistics space \(\) induced by the model for a given summarizer \(\), and \(_{\#}^{n}\) is the distribution of the statistics from the true data-generating process. Then, the model-summarizer pair is misspecified if, \(\), \(_{\#}^{n}_{\#}_{}^{n}\)._

It is trivial to see that if the model is well-specified in the data space \(\), it will also be well-specified in the statistic space \(\) for any choice of \(\). The converse, however, is not true, as previously mentioned. Using this definition, we quantify the level of misspecification of a model-summarizer pair as follows:

**Definition 3.2** (**Misspecification margin in SBI**).: _Let \(\) be a distance defined on the set of all Borel probability measures on \(\). Then, for a given \(\), we define the misspecification margin \(_{}\) in SBI as_

\[_{}=_{}\ (_{\#} _{}^{n},_{\#}^{n}).\] (3)

Note that the margin is equal to zero for the well-specified case. Moreover, the larger the margin, the bigger the mismatch between the simulated and the observed statistics w.r.t \(\). Our aim is to learn an \(\) such that \(_{}\) is represented well whilst the model-summarizer pair is no longer misspecified as per Definition 3.1, or alternatively, has zero margin as per Definition 3.2. We formulate this as a constrained optimization problem in Equation (6).

Learning robust statistics for SBI.Suppose we have the flexibility to choose the summarizer \(\) from a family of functions parameterized by \(\). Then, a potential approach for tackling model misspecification in SBI is to select the summarizer \(\) that minimizes the misspecification margin \(_{}\). However, that involves computing the infimum for all possible choices of \(\). To avoid that, we minimize an upper bound on the margin instead, given as

\[_{_{}}_{_{}}^{}=_{p()}[(_{\#}_{}^{n},_{ \#}^{n})].\] (4)

Note that Equation (4) is valid for any choice of \(p()\), and we call \(_{_{}}^{}\) the _margin upper bound_.

Minimizing the margin upper bound alone would lead to \(\) being a constant function, which when used for inference, would yield the prior distribution. Hence, there is a trade-off between choosing an \(\) that is informative about the parameters and an \(\) that minimizes the margin upper bound. Wepropose to navigate this trade-off by including the margin upper bound as a regularization term in the loss function for learning \(\). To that end, let \((,)\) be the loss function used to learn \(_{}\) (along with additional parameters \(\)) which, for instance, can be either \(_{}\) from Equation (1) or \(_{}\) from Equation (2). Then, our proposed loss with robust statistics (RS) is written as

\[_{}(,)=(,)+ {_{p()}[(_{\#}_{} ^{n},_{\#}^{n})]}_{},\] (5)

where \( 0\) is the weight we place on the regularization term relative to the standard loss \(\). Minimizing the loss function in Equation (5) corresponds to solving the Lagrangian relaxation of the optimization problem:

\[_{,} (,)\] (6) s.t. \[_{p()}[(_{\#} _{}^{n},_{\#}^{n})], >0,\]

with \( 0\) being the Lagrangian multiplier fixed to a constant value.

Estimating the margin upper bound.In order to implement the proposed loss from Equation (5), we need to estimate the margin upper bound using the training dataset \(\{(_{i},_{1:n,i})\}_{i=1}^{m} p(,_{1:n})\) sampled from the prior and the model. However, we only have one sample each from the distributions \(_{\#}_{_{i}}^{n}\), \(i=1,,m\), and one sample of the observed statistic from \(_{\#}^{n}\). Taking \(\) to be the Euclidean distance \(\|\|\), we can estimate the margin upper bound as \(_{i=1}^{m}\|_{}(_{1:n,i})-_{}(_{1:n})\|\). Although easy to compute, we found this choice of \(\) to yield overly conservative posteriors even in the well-specified case, see Appendix B.3 for the results. This is because the Euclidean distance is large even if only a handful of simulated statistics -- corresponding to different parameter values in the training data -- are far from the observed statistic. As a result, the regularizer dominates the loss function while the standard loss term \(\) related to \(\) is not minimized, leading to underconfident posteriors. Hence, we need a distance \(\) that is robust to outliers and can be computed between the set \(\{_{}(_{1:n,i})\}_{i=1}^{m}\) and \(_{}(_{1:n})\), instead of computing the distance point-wise.

To that end, we take \(\) to be the maximum mean discrepancy (MMD) , which is a notion of distance between probability distributions or datasets. MMD has a number of attractive properties that make it suitable for our method: (i) it can be estimated efficiently using samples , (ii) it is robust against a few outliers (unlike the KL divergence), and (iii) it can be computed for unequal sizes of datasets. The MMD has been used in a number of frameworks such as ABC , minimum distance estimation , generalized Bayesian inference , and Bayesian nonparametric learning . Similar to our method, the MMD has previously been used as a regularization term to train Bayesian neural networks , and in the NPE framework to detect model misspecification . While we include the mmD-based regularizer to ensure that the observed statistic is not an out-of-distribution sample in the summary space, the regularizer in  involves computing the MMD between the simulated statistics and samples from a standard Gaussian, thus ensuring that the learned statistics are jointly Gaussian. They then conduct a goodness-of-fit test  to detect if the model is misspecified. Their method is complementary to ours, such that our method can be used once misspecification has been detected using .

Maximum mean discrepancy (MMD) as \(\).The MMD is a kernel-based distance between probability distributions, computed by mapping the distributions to a function space called the reproducing kernel Hilbert space (RKHS). Let \(_{k}\) be the RKHS associated with the symmetric and positive definite function \(k:\), called a reproducing kernel , defined on the space of statistics \(\) such that \(f()= f,k(,)_{_{k}}\)\( f_{k}\) (called the reproducing property). We denote the norm and inner product of \(_{k}\) by \(\|\|_{_{k}}\) and \(,_{_{k}}\), respectively. Any distribution \(\) can be mapped to \(_{k}\) via its kernel-mean embedding \(_{k,}=_{}k(,)()\). The MMD between two arbitrary probability measures \(\) and \(\) on \(\) is defined as the distance between their embeddings in \(_{k}\), i.e., \(_{k}(,)=\|_{k,}-_{k,} \|_{_{k}}\). Using the reproducing property, we can express the squared-MMD as

\[_{k}^{2}[,]=_{,^ {}}[k(,^{})]-2_{ ,^{}}[k(, ^{})]+_{,^{} }[k(,^{})],\] (7)

which is computationally convenient as the expectations of the kernel can be estimated using iid samples from \(\) and \(\). Given samples of simulated statistics \(\{_{}(_{1:n,i})\}_{i=1}^{l}\) and the observedstatistic \(_{}(_{1:n})\), we estimate the squared-MMD between them using the V-statistic estimator :

\[_{k}^{2}[_{\#}_{}^{n},_{\# }^{n}] _{k}^{2}[\{_{}(_{1:n,i})\}_{i=1 }^{l},_{}(_{1:n})]\] (8) \[=}_{i,j=1}^{l}k(_{}(_{1:n,i}),_{}(_{1:n,j}))-_{i=1}^{l}k(_{}( _{1:n,i}),_{}(_{1:n})).\]

Note that the last term in Equation (7) is always constant for the estimator above as we only have one data-point of the observed statistic, hence we disregard it. Equation (8) therefore corresponds to estimating the MMD between the distribution of the simulated statistics for a given \(\) and a Dirac measure on \(_{}(_{1:n})\). The computational cost of estimating the squared-MMD is \((l^{2})\) and its rate of convergence is \((l^{-})\). The NPE loss with robust statistics (NPE-RS) can then be estimated as

\[}_{}(,)=-_{i=1}^{m} q _{h_{}(_{}(_{1:n,i}))}(_{i})+_{k }^{2}[\{_{}(_{1:n,i})\}_{i=1}^{l},_{}(_{1:n})].\] (9)

Similarly, the autoencoder loss with robust statistics (AE-RS) reads

\[}_{}(,_{d})=_{i=1}^{m}( _{1:n,i}-_{_{d}}(_{}(_{1:n,i})))^ {2}+_{k}^{2}[\{_{}(_{1:n,i})\}_{i=1} ^{l},_{}(_{1:n})].\] (10)

We use a subset of the training dataset of size \(l<m\) to compute the MMD instead of \(m\) to avoid incurring additional computational cost in case \(m\) is large. The MMD-based regularizer can also be used as a score in a classification task to detect model misspecification, as shown in Appendix A.

Role of the regularizer \(\).The regularizer \(\) penalizes learning those statistics for which the observed statistic \(_{}(_{1:n})\) is far from the set of statistics that the model can simulate given a prior distribution. When \(\) tends to zero, maximization of the likelihood dictates learning of both \(\) and \(\) in Equation (9), and our method converges to the NPE method. On the other hand, the regularization term is minimized when the summary network outputs the same statistics for both simulated and observed data, i.e., when \(\) is zero. In this case, the inference network can only rely on information from the prior \(p()\). As a result, for large values of \(\), we expect the regularization term to dominate the loss and the resulting posterior to converge to the prior distribution. Similar argument holds for the autoencoder loss in Equation (10). We empirically observe this behavior in Section 4. Hence, \(\) encodes the trade-off between efficiency and robustness of our inference method. Choosing \(\) can be cast as a hyperparameter selection problem, for which we can leverage additional data (if available) as a validation dataset, or use post-hoc qualitative analysis of the posterior predictive distribution.

## 4 Numerical experiments

We apply our method of learning robust statistics to two different SBI frameworks -- NPE  and ABC  (see Appendix B.6 for results on applying our method to neural likelihood estimator ). We also compare the performance of our method against RNPE , by using the output of the trained summary network in NPE as statistics for RNPE. Experiments are conducted on synthetic data from two time-series models, namely the Ricker model from population ecology [67; 85] and the Ornstein-Uhlenbeck process . Real data experiment on a radio propagation model is presented in Section 5. Analysis of the computational cost of our method and results on a 10-dimensional Gaussian model is presented in Appendix B.4 and B.5, respectively. The code to reproduce our experiments is available at https://github.com/huangdaolang/robust-sbi.

Ricker modelsimulates the evolution of population size \(N_{t}\) over the course of time \(t\) as \(N_{t+1}=(_{1})N_{t}(-N_{t}+e_{t})\), \(t=1,,T\), where \((_{1})\) is the growth rate parameter, \(e_{t}\) are zero-mean iid Gaussian noise terms with variance \(_{e}^{2}\), and \(N_{0}=1\). The observations \(x_{t}\) are assumed to be Poisson random variables such that \(x_{t}(_{2}N_{t})\). For simplicity, we fix \(_{e}^{2}=0.09\) and estimate \(=[_{1},_{2}]^{}\) using the prior distribution \(()\), and \(T=100\) time-steps.

Ornstein-Uhlenbeck process (OUP)is a stochastic differential equation model widely used in financial mathematics and evolutionary biology. The OU process \(x_{t}\) is defined as:

\[x_{t+1} =x_{t}+ x_{t}, t=1,,T,\] \[ x_{t} =_{1}[(_{2})-x_{t}] t+0.5w,\]where \(T=25\), \( t=0.2\), \(x_{0}=10\), and \(w(0, t)\). A uniform prior \(([-2,2])\) is placed on the parameters \(=[_{1},_{2}]^{}\).

Contamination model.We test for robustness relative to the \(\)-contamination model , similar to . For both the Ricker model and the OUP, the observed data comes from the distribution \(=(1-)_{_{}}+_{_{}}\), where a large proportion of the data comes from the model with \(_{}\), while \(\) proportion of the data comes from the distribution \(_{_{}}\). Hence, \(\) denotes the level of misspecification within both the models, with \(=0\) resulting in the well-specified case. We take \(_{}=[0.5,1.0]^{}\), \(_{c}=[-0.5,1.0]^{}\) for OUP, and \(_{}=^{}\), \(_{c}=^{}\) for the Ricker model.

Implementation details.We take \(m=1000\) samples for the training data and \(n=100\) realizations of both the observed and simulated data for each \(\). We set \(\) using an additional dataset simulated from the models using \(_{}\). For the MMD, we take the kernel to be the exponentiated-quadratic kernel \(k(,^{})=(-\|-^{}\|_{ 2}^{2}/^{2})\), and set its lengthscale \(\) using the median heuristic \(=/2}\), where \(\) denotes the median of the set of squared two-norm distances \(\|_{i}-_{j}\|_{2}^{2}\) for all pairs of distinct data points in \(\{_{i}\}_{i=1}^{m}\). We use \(l=200\) samples of the simulated statistics to estimate the MMD. For the Ricker model, the summary network \(_{}\) is composed of 1D convolutional layers, whereas for the OUP, \(_{}\) is a combination of bidirectional long short-term memory (LSTM) recurrent modules and 1D convolutional layers. The dimension of the statistic space is set to four for both the models. We take \(q\) to be a conditional normalizing flow for all the three NPE methods. We take the tolerance \(\) in ABC to be the top 5% of samples that yield the smallest distance.

Performance metrics.We evaluate the accuracy of the posterior, as well as the posterior predictive distribution of the SBI methods. For the posterior distribution, we compute the root mean squared error (RMSE) as \((1/N_{i=1}^{N}(_{i}-_{})^{2})^{}\) where \(\{_{i}\}_{i=1}^{N}\) are posterior samples. For the predictive accuracy, we compute the MMD between the observed data and samples from the posterior predictive distribution of each method. As the models simulate high-dimensional data, we use the kernel specialized for time-series from . The lengthscale of this kernel is set to \(=1\) for all misspecification levels to facilitate fair comparison.

Results.Figure 2 presents the results for both the Ricker model and the OUP across 100 runs. We observe that both NPE and ABC with our robust statistics (RS) outperform their counterparts, including RNPE, under misspecification (\(=10\%\) and \(20\%\)). Moreover, our performance is similar

Figure 2: Performance of the SBI methods in terms of RMSE and MMD for both the Ricker model and OUP. Each box represents the median and interquartile range (IQR), while the whiskers extend to the furthest points within 1.5 times the IQR from the edges of the box. For the well-specified case (\(=0\%\)), the proposed NPE-RS and ABC-RS methods perform similar to their counterpart NPE and ABC, respectively. Under misspecification (\(>0\%\)), NPE-RS and ABC-RS achieve lower RMSE and MMD values, demonstrating robustness to model misspecification.

to NPE in the well-specified case (\(=0\%\)). An instance of the NPE posteriors is shown in Figure 3 for the Ricker model. Our NPE-RS posterior is very similar to the NPE posterior for the well-specified case, whereas the RNPE posterior is underconfident, as noted in . Although RNPE is more robust than NPE under misspecification, its posterior still drifts away from \(_{}\), while NPE-RS posterior stays around \(_{}\) even for \(=20\%\). This is because our method has the flexibility to choose appropriate statistics based on misspecification level, while RNPE is bound to a fixed choice of pre-selected statistics. Posterior plots for ABC and OUP are given in Appendix B.2.

Prior misspecification.So far our discussion has pertained to the case of likelihood misspecification. However, in Bayesian inference, the prior is also a part of the model. Hence, a potential form of misspecification is _prior misspecification_, in which the prior gives low or even zero probability to the "true" data generating parameters. We investigate the issue of prior misspecification using the Ricker model as an example. To that end, we modify the prior distribution of \(_{2}\) by setting it to \((0.5,1.0)\) while keeping the prior of \(_{1}\) unchanged. We use \(_{}=^{}\) to generate the observed data, as \(_{2}=25\) has very low density under the lognormal prior, and the probability that a value of \(_{2} 25\) will be sampled is 0.00372. The result in Figure 4 shows that NPE and RNPE yield posteriors that do not include the true value of \(_{2}\), whereas our NPE-RS posterior is still around \(_{}\). This highlights the effectiveness of our method to handle cases of prior misspecification as well.

Varying regularizer \(\).As mentioned in Section 3, our method converges to NPE as \(\) tends to zero, and to the prior distribution as \(\) becomes high. To investigate this effect, we vary \(\) and measure the distance between the NPE-RS and the NPE posteriors, and between the NPE-RS posterior and the prior. We use the MMD from Equation (7) to measure this distance on the Ricker model in the misspecified case (\(=20\%\)). We see in Figure 5(left) that the MMD values between the prior and the NPE-RS posteriors go close to zero for \(=10^{3}\), indicating that our method essentially returns the prior for high values of \(\). On the other hand, the MMD values between NPE and NPE-RS posteriors in Figure 5(middle) are smallest for \(=0.01\) and \(=0.1\). For non-extreme values of \(\) (i.e. \(=1\) or 10), we observe maximum difference between NPE-RS and NPE. This is because the NPE posteriors tend to move out of the prior support under misspecification, whereas the NPE-RS posteriors remain around \(_{}\), as shown in Figure 3. Finally, the NPE-RS posteriors are also close to the NPE posteriors for small values of \(\) in the well-specified case, as shown in Figure 5(right).

Figure 4: Posteriors from NPE, RNPE, and NPE-RS for Ricker model. **NPE-RS is robust to prior misspecification**.

Figure 3: Posteriors obtained from NPE, RNPE, and our NPE-RS method for the Ricker model. We perform similar to NPE in the well-specified case, unlike RNPE. Under misspecification, NPE and RNPE posteriors drift away from \(_{}\), going even beyond the prior range (denoted by dashed gray lines) in the case of NPE. **Our method is robust to model misspecification**.

## 5 Application to real data: A radio propagation example

Our final experiment involves a stochastic radio channel model, namely the Turin model , which is used to simulate radio propagation phenomena in order to test and design wireless communication systems. The model is driven by an underlying point process which is unobservable, thereby rendering its likelihood function intractable. The model simulates high-dimensional complex-valued time-series data, and has four parameters. The parameters govern the starting point, the slope of the decay, the rate of the point-process, and the noise floor of the time-series, as shown in Figure 6. We attempt to fit this model to a real dataset from a measurement campaign  for which the model is known to be misspecified , on account of the data samples being non-iid. The averaged power of the data (square of the absolute value) as a function of time is shown by the black curve in Figure 6. The data dimension is 801 and we have \(n=100\) realizations. We take the power of the complex data in decibels* as input to the summary network, which consists of 1D convolutional layers, and we set uniform priors for all the four parameters. Descriptions of the model, the data, and the prior ranges are provided in Appendix C.

Footnote *: In wireless communications, the power of the signal is measured in decibels (dB). A power \(P\) in linear scale corresponds to \(10_{10}(P)\) dB.

We fit the model to the real data using NPE, RNPE and our NPE-RS methods. As there is no notion of ground truth in this case, we plot the resulting posterior predictive distributions in Figure 6. Note that the multiple peaks present in the data are not replicated by the Turin model for any method, which is due to the model being misspecified for this dataset. Despite that, our NPE-RS method appears to fit the data well, while NPE performs the worst. Moreover, our method is better than RNPE at matching the starting point of the data, the slope, and the noise floor, with RNPE underestimating all three aspects on average. The MMD between the observed data and the posterior predictive distribution of NPE, RNPE and NPE-RS is 0.11, 0.09, and 0.03, respectively. Hence, NPE-RS provides a reasonable fit of the model even under misspecification.

## 6 Conclusion

We proposed a simple and elegant solution for tackling misspecification of simulator-based models. As our method relies on learning robust statistics and not on the subsequent inference procedure, it is applicable to any SBI method that utilizes summary statistics. Apart from achieving robust inference under misspecified scenarios, the method performs reasonably well even when the model is well-specified. The proposed method only has one hyperparameter that encodes the trade-off between efficiency and robustness, which can be selected like other neural network hyperparameters, for instance, via a validation set.

Figure 5: MMD between the NPE-RS posteriors and _(left)_ the prior in the misspecified setting, _(middle)_ the NPE posteriors in the misspecified setting, _(right)_ the NPE posteriors in the well-specified setting, for different values of \(\).

Figure 6: Predictive performance of NPE, RNPE and our NPE-RS method on the Turin model under misspecification. **NPE-RS leads to the best fit.** The shaded regions denote \( 1\) std. deviation of the posterior predictive distribution of each method.

Limitations and future work.A limitation of our method is the increased computational complexity due to the cost of estimating the MMD, which can be alleviated using the sample-efficient MMD estimator from  or quasi-Monte Carlo points . Moreover, as our method utilizes the observed statistic during the training procedure, the corresponding NPE is not amortized anymore -- a limitation we share with RNPE. Thus, working on robust NPE methods which are still amortized (to some extent) is an interesting direction for future research. An obvious extension of the work could be to investigate if the ideas translate to likelihood-free model selection methods  which can suffer from similar problems as SBI if all (or some) of the candidate models are misspecified.