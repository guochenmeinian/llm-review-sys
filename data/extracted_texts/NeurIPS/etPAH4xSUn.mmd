# In-Context Symmetries: Self-Supervised

Learning through Contextual World Models

 Sharut Gupta, Chenyu Wang, Yifei Wang, Tommi Jaakkola &Stefanie Jegelka

MIT CSAIL

{sharut, wangchy, yifei_w, jaakkola}@mit.edu {sharut, wangchy, yifei_w, jaakkola}@mit.edu {sharut} Equal contribution

###### Abstract

At the core of self-supervised learning for vision is the idea of learning invariant or equivariant representations with respect to a set of data transformations. This approach, however, introduces strong inductive biases, which can render the representations fragile in downstream tasks that do not conform to these symmetries. In this work, drawing insights from world models, we propose to instead learn a general representation that can adapt to be invariant or equivariant to different transformations by paying attention to _context_ -- a memory module that tracks task-specific states, actions, and future states. Here, the action is the transformation, while the current and future states respectively represent the input's representation before and after the transformation. Our proposed algorithm, Contextual Self-Supervised Learning (ContextSSL), learns equivariance to all transformations (as opposed to invariance). As a result, the model learns to encode all relevant features as general representations while, importantly, it can adapt to restrict to task-wise symmetries when given a few examples as the context. Empirically, we demonstrate significant performance gains over existing methods on equivariance-related tasks, supported by both qualitative and quantitative evaluations. Code is available at https://github.com/Sharut/In-Context-Symmetries.

## 1 Introduction

Self-supervised learning (SSL) of image representations has made remarkable progress in recent years [9; 6; 47; 31; 18; 3; 19; 20; 38; 34; 10; 26; 11; 46; 39; 48], achieving competitive performance to its supervised counterparts on various downstream tasks, such as image classification.

Most of these works are based on the joint-embedding architecture (as shown in Figure 2(a)) which encourages the representations of semantically similar (positive) pairs to be close, and those of dissimilar (negative) pairs to be more orthogonal. Typically, positive pairs are generated by classic data augmentation techniques that correspond to common pretext tasks, e.g., randomizing color, texture, orientation, and cropping. The alignment of representations for positive pairs can be guided by either invariance [9; 6; 11; 26; 46; 20], which promotes insensitivity to these augmentations, or equivariance [22; 13; 12; 16; 1; 17], which maintains sensitivity to them. However, enforcing invariance or equivariance to a pre-defined set of augmentations introduces strong inductive priors which are far from universal across a range of downstream tasks. For example, invariance to image flipping is useful for image classification but can significantly hurt performance on image segmentation, where retaining sensitivity to flipping is crucial. This often results in brittle representations that necessitate retraining the model with different augmentations tailored to each downstream task [42; 12].

This rigidity of traditional SSL methodologies contrasts sharply with human perceptual abilities, which are highly adaptive, tuning into relevant features based on the _context_ of the environment or task at hand. For example, humans focus more on color details when identifying flowers, and on spatial orientation such as rotation angle when determining the time on analog clocks. It suggests that the required feature invariances or equivariances should also vary across different tasks or contexts, which motivates our central question.

_Can incorporating context into self-supervised vision algorithms eliminate augmentation-based inductive priors and enable dynamic adaptation to varying task symmetries?_

This work suggests a positive answer to this question by proposing to enhance the current joint embedding architecture with a finite context -- an abstract representation of a task, containing a few demonstrations that inform about task-specific symmetries, as shown in Figure 2(c). Based on this idea, we propose **Contextual Self-Supervised Learning** (ContextSSL), a contrastive learning framework that uses a transformer module to adapt to selective invariance or equivariance to transformations by paying attention to context representing a task. Unlike previous approaches with built-in symmetries, the ability of ContextSSL to adapt to varying data symmetries--all without undergoing any parameter updates--enables it to learn a general representation across tasks, devoid of specific inductive priors.

This unique prospect makes our model a promising approach to building world models  for vision. World models are essential for building representations of the world based on past experiences, akin to how humans form their internal world representations. Recently, efforts have been made to adapt world modeling into vision through Image World Models (IWM)  ( Figure 2(b)), that consider transformations as actions and the input and its transformed counterpart as world states at different time steps. However, these approaches also enforce equivariance to a predefined set of actions, such as color jitter. ContextSSL addresses this challenge by enhancing traditional IWMs with context, a model we refer to as _Contextual World Models_. We demonstrate that in the absence of context, ContextSSL learns a general representation by encoding all relevant features and data transformations. As the context increases, the model tailors its symmetries to a task, encouraging equivariance to a subset of transformations and invariance to the rest (as shown in Figure 1). This approach promotes learning a general representation that can flexibly adapt to the symmetries relevant to various downstream tasks, eliminating the need to learn separate representations for each task. We empirically validate our approach on the MIMIC-III, UCI Adult, 3D Invariant Equivariant Benchmark (3DIEBench) and CIFAR-10 datasets, extending to naturally occurring sensitive features such as gender and transformations such as rotations, cropping, and blurring.

To summarize, the main contributions of our work are:

* We propose ContextSSL, a self-supervised learning algorithm that adapts to task-specific symmetries by paying attention to context. Our method resolves the long-standing challenge of

Figure 1: We apply a transformation (rotation or color) on a source image in latent space and retrieve the nearest neighbor (NN) of the predicted representation when the context contains pairs of data transformed by (top row) 3D rotation \((R^{x},R^{y},R^{z})\); (bottom row) color transformation \((,)\). In the top row, we see that ContextSSL learns equivariance to rotation and invariance to color as the NN representations match the targetâ€™s angle but not its color. In the bottom row, it adapts to the color context and enforces the reverse, be equivariant to color and invariant to rotation.

enforcing fixed invariances and equivariances to handcrafted data augmentations, enabling adaptive and task-sensitive representations without parameter updates.
* We show that learning with context is prone to identifying shortcuts and subsequently propose two key modules to address it: a context mask and an auxiliary predictor.
* We demonstrate the efficacy of our approach on MIMIC-III, UCI Adult, 3DIEBench and CIFAR10, showing its ability to selectively learn invariance or equivariance to naturally occurring features and sensitive attributed like gender and transformations such as color and rotation while maintaining similar performance on invariant benchmarks.

## 2 Augmentation-based Inductive Bias in Self-Supervised Learning

The goal of self-supervised learning (SSL) is to derive meaningful data representations without relying on human-labeled data. Given an unlabeled dataset \(\), SSL methods learn a representation function \(f_{}:\) that maps input data \(x\) to a latent space \(\).

### Role of data augmentations in Self-Supervised Learning

Data augmentations are arguably the most important component in modern SSL methods, where the representation function is learned to map the augmented views of data into latent space. The choice of data augmentations plays a crucial role in the quality of the learned representations. Formally, we define an augmentation \(A\) as a random variable distributed over a set of \(N\) data transformations with domain \(=\{a_{1},,a_{N}\}\), where \(a_{i}:^{d}^{d^{}}\) denotes an input mapping, and \(d,d^{}\) are its input and output dimensions, respectively. Among existing SSL methods, there are generally two ways to utilize augmentations, either through invariant learning or equivariant learning. In invariant learning, two random augmentations of the example are drawn and their representations are pulled together during feature learning to be invariant to the data augmentations as shown in Figure 2(a). Instead, in equivariant learning, the features are learned to be sensitive to data augmentations.1 Formally, for a representation \(Z\), one can use \(H(A|Z)\) as a measure of the degree of feature invariance or equivariance: if \(H(A|Z)\) is relatively small, the representation \(Z\) is nearly equivariant to the augmentation \(A\); otherwise, if \(H(A|Z)\) is very large (close to \(H(A)\)), \(Z\) is invariant to \(A\). Recent SSL methods [22; 16; 35; 13; 12] have shown that enforcing equivariance can often lead to better representations compared to enforcing invariance, for two key reasons: 1) Invariance restricts the expressive power of the features learned as it removes information about features or transformations that may be relevant in fine-grained tasks [32; 43]; 2) contrastive learning benefits from partial invariance through implicit equivariance of the projection head .

Figure 2: Family of approaches in self-supervised learning (a) **Joint Embedding** methods [9; 6; 8] encode invariances to input transformations \(a\) by aligning representations across views of the same image; (b) **Image World Models**[17; 1] train a world model in the latent space and encode equivariance to input transformations; (c) **Contextual World Models** (ours) selectively enforce equivariance or invariance to a subset of input transformations based on context \(\{(x_{i},a_{i},y_{i})\}_{i=1}^{k}\)

### Drawbacks of Hardcoding Symmetries in Self-Supervised Pretraining

As discussed above, a common theme in existing SSL methods is to enforce invariance or equivariance to a specific set of augmentations \(A\). For instance, in SimCLR, \(A\) is chosen to be a manually selected set of random augmentations such as random cropping, flipping, and color jitter. Therefore, the learned representations, either invariant or equivariant to these augmentations, are tailored to the specific symmetry imposed during pretraining. However, in real world scenarios, there is no single symmetry that is universally applicable across all tasks. For example, object recognition (e.g., a chair) often requires invariance to image color, while certain tasks, e.g., flower recognition, need sensitivity to color information instead. Either to include or not to include color information as part of the augmentations can lead to suboptimal performance in certain tasks, causing a fundamental dilemma in existing SSL. This leads to brittle representations over a range of downstream tasks, as the model needs to be retrained on different augmentations depending on the downstream tasks, as consistently observed in previous works [42; 12].

## 3 Beyond Built-in Symmetry: Contextual Self-Supervised Learning

Recognizing the limitations of existing augmentation-specific SSL methods, we propose a new paradigm: **Context**ual Self-**S**upervised **L**earning (ContextSSL). Unlike traditional methods, this approach learns a single model that adapts to be either invariant or equivariant based on context-specific augmentations, tailored to the needs of the task or data at hand. Instead of enforcing a fixed set of symmetries, ContextSSL learns these symmetries from contextual cues, thus capturing the unique set of features of downstream tasks. This adaptability allows it to serve as a general-purpose SSL framework, capable of learning from a diverse array of pretraining tasks with varying symmetry priors and seamlessly adapting to different downstream tasks.

To design ContextSSL, we draw inspiration from world modeling [24; 25; 37; 45], a widely used framework in reinforcement learning (RL). World modeling aims to build representations of the world from past experience by predict the next state \(x_{t+1}\) from the current state \(x_{t}\) and action \(a_{t}\). This next state prediction task captures the inherent mechanisms of the system and facilitates decision making. Traditionally applied in RL, the benefits of world modeling in vision have been largely unexplored. Recently, Image World Models (IWM)  established a parallel between world models and the image-based SSL by considering data transformations as actions, the representation of input data as world state at time \(t\) and that of the transformed input as next world state. However, IMMs have two key drawbacks: 1) similar to previous SSL approaches, they rely on a predefined set of data augmentations, such as color, which are not tailored to specific downstream tasks and influence the learned features; 2) they lack the memory module of world models that tracks previous experience in terms of past states, actions and corresponding next states and provides context to fully define the current state.

In light of these ideas and challenges, we model ContextSSL in vision self-supervised learning as _Contextual World Models_. In this way, ContextSSL addresses the key drawbacks of IMMs by 1) encouraging the model to preserve all meaningful features to be able to adapt to symmetry from context, and 2) incorporating context to adapt to different task-specific symmetries, removing the need to re-train separate representations for each downstream task. This general ability is akin to human perception that captures versatile aspects of the input, while focusing on specific details depending on the context at hand. For instance, humans focus more on color details when identifying flowers, and on spatial orientation such as rotation angle when determining the time on analog clocks.

### Contextual World Models

Drawing inspiration from the in-context learning  of foundation models in natural language processing, a natural way to incorporate the memory capabilities of world models is by encoding these abilities as contextual information. In this work, we propose an expressive and efficient implementation of ContextSSL through _Contextual World Models_, where we design a transformer-based module to encode the context and extract contextually equivariant or invariant representations. We begin by baking symmetries in the context -- \((x,a,y)\) using positive pairs \(x\) and \(y\) transformed by a series of different augmentations. The key intuition behind our approach is selective inclusion of augmentation parameters for specific transformation groups: excluding parameters enforces invariance, while including them enforces equivariance. This is because providing augmentationparameters allows the model to learn the impact of transformations (equivariance), whereas excluding them during alignment enforces invariance, akin to invariant versus equivariant learning in SSL. We elaborate on these ideas below.

**Symmetries as Context**. Given a set of groups of input transformations \(\{_{1},,_{M}\}\), the goal of ContextSSL is to build a general representation that is adaptive to a set of multiple symmetries corresponding to these different groups. For example, each data augmentation, e.g., rotation, translation, as well as their compositions, can serve as different transformation groups. Each group \(_{c}\) can be represented through the joint distribution \(P(x,a,y|_{c})\), where \(x\) is the input sample (sampled from an unlabeled dataset), \(a\) represents the parameters of the transformation drawn from \(_{c}\) and applied to \(x\), and \(y\) is the transformed input. In principle, \(x\) can be transformed by a composition of augmentations drawn from multiple transformation groups. For instance, in self-supervised learning, it is common to enrich the learning process by transforming an input image through rotations, crops, and blurring. In such a case, \(a\) represents a subset of the transformation parameters belonging to the group \(_{c}\), applied to \(x\) to produce \(y\). We approximate this probability distribution by drawing \(K\) samples from the joint distribution and form a context \(C(_{c})=[(x_{1},a_{1},y_{1}),,(x_{K},a_{K},y_{K})]\), where \(x_{i},a_{i},y_{i} P(x,a,y|_{c}),i[K]\). Therefore, the goal of ContextSSL is to learn data representations \(z=f(x,a|C)\) and \(z=f(x|C)\) that are adaptive to the data symmetries informed by the context \(C\). Specifically, our goal is to train representations that become more equivariant to the underlying transformation group \(_{c}\) with increasing context. Further, if \(x\) and \(y\) are transformed by augmentations from groups apart from \(_{c}\), we aim to learn more invariance to these groups with increase in context \(C(_{c})\). The degree of equivariance of a representation can be quantified by the error in maintaining consistent transformations. Based on this, a representation \(Z\) is considered "more equivariant (invariant)" if it has a lower (higher) error in predicting the transformation parameters i.e. \(H(A|Z)\).

**Contextual World Models.** To implement this broad goal, we propose to adaptively learn the symmetries represented by \(_{c}\) by training the model:

\[y_{i} h((x_{i},a_{i});(x_{1},a_{1},y_{1}),,(x_{i-1},a_{i-1},y_{i- 1})).\] (1)

While the requested prediction \(y_{i}\) concerns only the inputs \(x_{i}\) and \(a_{i}\), the model can now pay attention to the experience so far, enforcing relevant symmetries for the augmentation group \(_{c}\). The predictor \(h\) is updated by minimizing the loss at each context length \(_{i=1}^{K}(h((x,a_{i});C_{i-1}),y_{i})\) where \(C_{i}=\{(x_{1},a_{1},y_{1}),,(x_{i-1},a_{i-1},y_{i-1})\}\) represents the context before index \(i\).

A natural way to facilitate such context-based training is through attention mechanisms in transformer-based autoregressive models. Large language models exhibit a remarkable capability of in-context learning -- the ability to generalize to unseen tasks on-the-fly merely by paying attention to a few demonstrative examples of the task. Gupta et al.  among others, have leveraged this capability to generalize to different distributions merely by paying attention to unlabeled examples from a domain. Inspired by this, we train a decoder-only transformer model in-context by conditioning on the relevant context \(C(_{c})\) representing the transformation group \(_{c}\).

### Contextual Self-Supervised Learning (ContextSSL)

Motivated by the above ideas, we begin by constructing pairs of points \(\{(x_{i},y_{i})_{i=1}^{K}\}\) by either 1) sampling a transformation group \(\) and transforming \(x_{i}\) by augmentation from \(\) to \(y_{i}\); or 2) if available, sampling a meta-latent and its transformation parameters as difference between their individual latent parameters. We use the former construction in datasets such as CIFAR10 but use meta-latents such as 3D pose, lighting etc. for datasets such as 3DIEBench . Note that pairs of data can also be transformed by a series of augmentations sampled from other transformation groups. However, as previously discussed, the transformation parameters used in the context \(C()\) of group \(\) are solely those of the augmentations belonging to the group.

Following this, as illustrated in Figure 2, each input sample \(\{(x_{i},y_{i})\}_{i=1}^{K}\) from the context is independently transformed by the encoder into its corresponding latent representation. Next, representations of the input samples \(x_{i}\) are concatenated with their corresponding transformation action \(a_{i}\). This concatenated vector \((x_{i},a_{i})\) and the representation of the corresponding transformed input \(y_{i}\) collectively form the context corresponding to the symmetry \(\). The corresponding output embeddings are then aligned using the InfoNCE loss, which is minimized at each context length. If \(a_{i}\) is set to zero for all tokens in a sequence, ContextSSL enforces invariance to \(\), since it aligns \(x_{i}\) and without conditioning on the transformation parameters. Overall, we optimize the following loss:

\[_{}(h)=_{\{_{1},,_{M}\}}_{C()}_{i=1}^{K}- h((x_{i},a_{i})|C_{i}())^{}h(y_{i}|C_{i}( ))/}{_{j=1}^{K}h((x_{i},a_{i})|C_{i}())^{}h(y_{j}|C_{j}( ))/}\]

where transformed data tokens \(y_{j}\) (\(j i\)) form the negatives. We use a similar symmetric loss term using \(y_{i}\) as the anchor, \((x_{i},a_{i})\) and \((x_{j},a_{j})\)\((j i)\) as the positive and negatives respectively.

At inference, we tailor the extraction of representations to match the specific requirements of the downstream task, whether it benefits from equivariance or invariance to a transformation group \(\). In particular, if the task benefits from equivariance, we extract the representations of the test data at the maximum context length used during training \(K\), by constructing \(\{(x_{i},a_{i},y_{i})\}_{i=1}^{K}\) as its preceding context. Here \(a_{i}\) belongs to the group \(\) and is used to transform other unlabelled data from the test set \(x_{i}\) into \(y_{i}\). On the contrary, if the downstream task benefits from invariance to the group, we use \(\{(x_{i},0,y_{i})\}_{i=1}^{L}\) as the preceding context. This notion can be generalized to enforce equivariance to a subset of groups and invariance to another. Specifically, including the augmentation parameters for transformations in a group \(\) in the context enforces equivariance, while excluding them enforces invariance. In both cases, the data are still transformed using augmentations, regardless of the type of symmetry desired. This flexibility of context creation in ContextSSL allows us to tailor the representations to different symmetries and optimize for the model's performance across a range of tasks. However, this implementation bears two key challenges, as detailed below.

**Context Masking.** Given that \((x_{i},a_{i})\) precedes \(y_{i}\) in the context sequence, a trivial solution to minimizing the alignment loss arises where the model treats the embeddings of \((x_{i},a_{i})\) identical to \(y_{i}\) due to its access to \(x_{i}\). This phenomenon, often referred to as shortcut learning, poses a significant challenge as it leads the model to collapse to constant representations for each pair \((x_{i},y_{i})\), all while perfectly minimizing the loss. We address this challenge by masking out the input token \((x_{i},a_{i})\) for each token \(y_{i}\) in the context. As a consequence, when encoding the token \(y_{i}\), the transformer only has access to past context \(C_{i}=\{(x_{1},a_{1},y_{1}),,(x_{i-1},a_{i-1},y_{i-1})\}\), excluding its corresponding positive sample \((x_{i},a_{i})\).

This masking approach ensures that both the anchor and its corresponding positive share the same context, thus promoting the alignment of positive samples based on semantic relationships rather than mere replication. However, as shown in Figure 4 for \(p=0\), a residual challenge of shortcut learning persists when distinguishing the positives from the negatives. Since the context corresponding to each negative is different from that of the anchor and the positive, the model could employ trivial solutions, such as using the mean of the context vector to differentiate between positives and negatives. To mitigate this issue, we introduce an additional layer of randomness to our masking strategy. Specifically, for each token in the context vector, we implement random masking with a probability \(p\) for tokens preceding it. This ensures that for a given anchor token, both the positive and the negatives have different contexts from the anchor, thereby necessitating a deeper, semantic understanding to effectively distinguish the positives from the negatives.

**Avoiding collapse to Invariance.** A trivial but undesirable solution that minimizes our optimization objective is invariance to the input transformations i.e. the trained model can ignore the transformation parameters and collapse back to behaviors associated with invariance-based methods. As illustrated in Figure 5, naively training ContextSSL leads to poor equivariance with respect to the transformations. Previous works  have also identified this concern and proposed specialized architectures that incorporate transformation parameters directly into the model, thereby outputting the predictor's weights and ensuring effective utilization of these parameters. For our setting, we introduce a rather simple approach that involves jointly training an auxiliary predictor. This predictor is designed to predict the latent transformations of the target sample \(y_{i}\) from the concatenated input vector \((x_{i},a_{i})\).

## 4 Experimental Results

To evaluate the efficacy of our proposed algorithm ContextSSL, our experiments are designed to address the following questions:* How does ContextSSL fare against competitive invariant and equivariant self-supervised learning approaches in terms of performance across varying context sizes and different sets of data transformations?
* How effectively can ContextSSL identify task-specific symmetries, both within the scope of self-supervised learning and beyond?
* What roles do specific components such as selective masking and the auxiliary latent transformation predictor play in facilitating the learning of general and context-adaptable representations?

### Quantitative Assessment of Adaptation to Task-Specific Symmetries

We use the 3D Invariant Equivariant Benchmark (3DIEBench)  and CIFAR10 to test our approach. We compare ContextSSL with 1) VICReg  and SimCLR  among the invariant self-supervised approaches; 2) EquiMOD , SEN  and SIE  amongst the equivariant baselines. To discard the performance gains potentially arising from ContextSSL's transformer architecture, for each approach \(\), we replaces the original projection head or predictor with our transformer model, denoted as \(^{+}\). We further test this at For all our equivariant baselines on 3DIEBench, we train equivariant approaches to be equivariant to either only 3D rotation, color transformations, or both. We report the test performance on context lengths 0, 2, 14, 30, and 126. To assess the quality of the invariant representations, we employ linear classification over frozen features. For the equivariant counterpart, we report \(R^{2}\) on the task of predicting the corresponding transformation. Additionally, we use Mean Reciprocal Rank (MRR) and Hit Rate at \(k\) (H@k) to evaluate the performance of our context predictor. More details about pretraining algorithms and training setup are provided in Appendix B.

**Invariant Classification and Equivariant transformation prediction task.** As shown in Figure 3, invariant self-supervised learning methods such as SimCLR and VICReg achieve high downstream classification accuracies but underperform in equivariant augmentation prediction tasks. Among the equivariant baselines, EquiMOD persistently maintains its downstream classification accuracy but exhibits improvements in augmentation prediction tasks only when trained to be equivariant to color. SIE and SEN exhibit sensitivity to the trained transformations and remain less sensitive to the others. However, their degree of invariance or equivariance is much worse compared to ContextSSL. Besides, aligning them with different targeted symmetry groups requires retraining the entire model. In contrast, ContextSSL exhibits equivariance to both rotation and color in the absence of context. As seen from the two rows corresponding to ContextSSL in Section 4.1,

Figure 3: (Left) Quantitative evaluation of learned representations on invariant (classification) and equivariant (rotation prediction, color prediction) tasks; (Right) Performance of ContextSSL on equivariant (top) rotation prediction; (bottom) color prediction tasks with varying context length for context corresponding to rotation and color. The algorithm increasingly demonstrates equivariance to rotation (color) as the rotation (color) context length increases while simultaneously becoming more invariant to color (rotation).

when the context corresponds to pairs of data with transformations sampled from the rotation (color) group, the model adaptively learns to be invariant to color (rotation) while improving equivariance to rotation (color). Appendix C.8 shows that ContextSSL learns equivariance or invariance to the same transformation based on the context.

**Equivariant Measures Based on Nearest Neighbours Retrieval.** Table 1 illustrates the performance of ContextSSL on MRR and H@k compared to baseline methods with trained equivariance to rotation. ContextSSL outperforms the baseline models, and its performance on all the metrics consistently improves with increasing context length, showing adaptation to rotation-specific features.

### Role of Context Mask and Auxiliary Predictor

**Role of Context Mask.** To illustrate how context masking effectively eliminates shortcuts, we conduct an ablation study with varying masking probabilities, detailed in Figure 4. We observed that as masking probability increases, performance on both classification and prediction tasks initially improves but later declines, reaching optimal performance at a masking probability of 90%.

**Role of Auxiliary Predictor.** We demonstrate that the auxiliary predictor is crucial for the model to achieve equivariance. In its absence, as depicted in Figure 5, while the model retains its performance on the invariant classification task, it fails to learn equivariance, and cannot effectively adapt to different contexts.

   Method &  &  &  \\   & 0 & 2 & 14 & 30 & 126 & 0 & 2 & 14 & 30 & 126 & 0 & 2 & 14 & 30 & 126 \\  EquMOD &  &  &  \\ SEN &  &  &  \\ ContextSSL & 0.240 & 0.270 & 0.373 & 0.396 & **0.402** & 0.108 & 0.129 & 0.223 & 0.245 & **0.292** & 0.366 & 0.412 & 0.541 & 0.561 & **0.568** \\   

Table 1: Quantitative evaluation of learned predictors equivariant to only rotation based on Mean Reciprocal Rank (MRR) and Hit Rate H@k on the validation dataset. ContextSSL learns to be more equivariant to rotation with context.

### Qualitative Assessment of Adaptation to Task-Specific Symmetries

We conduct a qualitative assessment of model performance by taking the nearest neighbors of the predictor output when inputting a source image and a transformation variable, as shown in Figure 6. The nearest neighbors of invariance models (SimCLR and VICReg) have random rotation angles. Equivariance baselines (SEN, SIE, EquiMOD) correctly generate the target rotation angle for some of the 3-nearest neighbors but fail in others. ContextSSL outperforms by successfully identifying the correct angle in all 3-nearest neighbors while remaining invariant to color variations. Additional qualitative assessments for ContextSSL with varying context are provided in Appendix C.3.

### Expanding to Diverse Data Transformations

Unlike 3DIEBench where meta-latents for each data are available, we manually construct positives by applying augmentations like crop and blur on CIFAR10. The results for the combinations of crop and blur are reported in Table 2. Consistent with our previous results, while almost retaining the classification performance as SimCLR, ContextSSL learns to adaptively enforce equivariance to crop (blur) and invariance to blur (crop) depending upon the context. Note that the invariance performance initially improves with increasing context length but then diminishes. This occurs due to the 90% random masking ratio during training, which necessitates out-of-distribution generalization when the context length is large. Results on additional transformation pairs are provided in Appendix C.4.

### Context World Models for Naturally-Occurring Symmetries

So far, we have evaluated ContextSSL on synthetic transformations such as color shifts and rotations using datasets like 3DIEBench, as well as on hand-crafted augmentations like cropping and blurring in CIFAR10. However, ContextSSL is much more versatile and can be applied to selectively learn sensitivity or insensitivity to naturally occurring symmetries and sensitive features. To demonstrate this, we test ContextSSL on a widely used physiological dataset, MIMIC-III  and a standard fairness benchmark, UCI Adult .

MIMIC-III is a large collection of medical records, which includes crucial identifiers like medications, patient demographics, hospital length of stay (LOS), and survival data. We investigate if ContextSSL could learn representations that are dynamically invariant or equivariant to the sensitive attribute, gender. Equivariance is necessary for gender-specific medical conditions, where different medication dosages may be required, while invariance is critical for ensuring fairness in tasks such as predicting hospital stay duration or medical costs. To construct the context, for each data point \(x_{i}\), we create the transformed data \(y_{i}\) by flipping the value of gender. As shown in Table 3, when the model is equivariant to gender, both gender prediction accuracy and medical treatment prediction improve with context. On the contrary, when the environment is invariant, embedding fairness of hospital stay (LOS) prediction as measured by equalized odds (EO) and equality of opportunity (EOPP), improves with context. We observe similar results for fairness of income prediction in the UCI Adult dataset, as shown in Appendix C.5.

### Context World Models Beyond Self-Supervised Learning

While our analysis has primarily focused on self-supervised learning, the concept of context is versatile and extends beyond representation learning. In principle, irrespective of the task at hand, paying attention to context can learn and identify features defined by it. To validate this and explore broader

   Method & \))} & \))} & Classification (top-1) \\   & 0 & 2 & 14 & 30 & 126 & 0 & 2 & 14 & 30 & 126 & Representation \\  SimCLR & & & 0.459 & & & & 0.371 & & & 89.1 \\ SimCLR\({}^{+}\) (c=0) & & & 0.448 & & & & 0.361 & & & 88.9 \\ SimCLR\({}^{+}\) & & & 0.362 & & & & 0.444 & & & 59.9 \\ ConTextSSL (crop) & 0.608 & 0.607 & 0.607 & 0.608 & 0.608 & 0.920 & 0.854 & 0.624 & 0.667 & 0.694 & 88.5 \\ ContextSSL (blur) & 0.609 & 0.482 & 0.434 & 0.417 & 0.465 & 0.920 & 0.923 & 0.925 & 0.925 & 0.925 & 88.5 \\   

Table 2: Performance of ContextSSL on invariant (classification) and equivariant (crop prediction, blur prediction) tasks in CIFAR-10 under the environment of crop, i.e. ContextSSL (crop), and blur, i.e. ContextSSL (blur).

applications of our algorithm, we consider a supervised learning task where our transformer model is trained to directly predict the labels corresponding to an input image. We further corrupt the labels to be directly influenced by the augmentation group transforming the data. Specifically, for 3DIEBench dataset, we add a constant value of 10 to each label if the context corresponds to the rotation group and leave it unchanged otherwise. We report classification performance along with rotation and color prediction equivariant measures. As shown in Table 4, ContextSSL's classification accuracy improves with context, demonstrating its ability to better identify the underlying symmetry group with increase in context. Additional results are provided in Appendix C.6. Further, ContextSSL serves as a general framework that can adapt to different training regimes such as supervised learning.

## 5 Conclusion and Future Perspectives

The field of language modeling has witnessed a significant paradigm shift over the past decade, moving towards foundation models that generalize across a variety of tasks either directly or through distillation. However, this shift toward generalization has been conspicuously absent in the vision domain. This is largely because self-supervised approaches for vision still heavily rely on inductive priors strongly introduced by enforcing either invariance or equivariance to data augmentations. This renders representations brittle in downstream tasks that do not conform to these priors and necessitates retraining the representation separately for each task. This work forgoes any notion of pre-defined symmetries and instead trains a model to infer the task-relevant symmetries directly from the context through what we term Contextual Self-Supervised Learning (ContextSSL). The ability of our model to learn selective equivariances and invariances based on mere context opens up new avenues for effectively handling a broader range of tasks, particularly in dynamic environments where the relevance of specific features may change over time. However, we limit our scope of symmetries to hand-crafted transformations in the data and do not explore naturally occurring symmetries. Nonetheless, ContextSSL layers the groundwork for models that can potentially discern and adapt to the underlying patterns of tasks, recognize shortcuts, and more effectively generalize across unseen scenarios. Through this work, we hope to contribute to a broader understanding of how machines can learn more like humans -- contextually, adaptively, and with an eye toward the infinite variability of the real world.

   & \))} & \))} &  \\   & 0 & 2 & 14 & 30 & 126 & 0 & 2 & 14 & 30 & 126 & 0 & 2 & 14 & 30 & 126 \\  SimCLR (color) & & & & & & & & 0.056 & & & & & 72.0 & & \\ SimCLR (rotation) & & & & & & & & & & & & & & \\ SimCLR (\(\) =(color)) & & & & & & & & & & & & & \\ SimCLR (\(\) =(color)) & & & & & & & & & & & & & \\ SimCLR (\(\) =(color)) & & & & & & & & & & & & & \\ SimCLR (\(\) =(color)) & & & & & & & & & & & & & \\ SimCLR (\(\) =(color)) & & & & & & & & & & & & & & \\ SimCLR (\(\) =(color)) & & & & & & & & & & & & & & \\ SimCLR (\(\) =(color)) & & & & & & & & & & & & & & \\ ContextSSL (color) & 0.556 & 0.542 & 0.538 & 0.540 & 0.539 & 0.913 & 0.973 & 0.981 & 0.982 & 0.982 & 8.9 & 82.4 & 82.7 & 82.8 & 83.0 \\ ContextSSL (rotation) & 0.556 & 0.624 & 0.661 & 0.665 & 0.666 & 0.913 & 0.379 & 0.111 & 0.095 & 0.093 & 73.5 & 82.7 & 82.6 & 82.6 & 83.0 \\  

Table 4: Performance of ContextSSL on equivariant tasks (including classificaion) for context-dependent labels. ContextSSL adapts to context-dependent labels with varying context.

  \(\) & Gender prediction Acc \(\) & LOS prediction Acc \(\) & Equalized odds \(\) & Equality of opportunity \(\) & Treatment prediction Acc \(\) \\  Context Length & 0 & 126 & 0 & 126 & 0 & 126 & 0 & 126 & 0 & 126 \\  Equivariant & 0.969 & 0.991 & 0.942 & 0.944 & 0.028 & 0.035 & 0.023 & 0.031 & 0.333 & 0.344 \\ Invariant & 0.969 & 0.626 & 0.942 & 0.943 & 0.028 & 0.023 & 0.023 & 0.004 & 0.333 & 0.316 \\  

Table 3: Performance of ContextSSL on invariant (length of stay (LOS) prediction) and equivariant (treatment prediction accuracy) tasks in the MIMIC III dataset.