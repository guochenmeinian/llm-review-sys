# Mixture of neural fields for heterogeneous reconstruction in cryo-EM

Axel Levy

Stanford University

axlevy@stanford.edu

&Rishwanth Raghu

Princeton University

rraghu@princeton.edu

David Shustin

Princeton University

dshustin@princeton.edu

&Adele Rui-Yang Peng

Princeton University

adelep@princeton.edu

&Huan Li

Columbia University

hl3170@columbia.edu

Oliver Biggs Clarke

Columbia University

oc2188@cumc.columbia.edu

Gordon Wetzstein

Stanford University

gordon.wetzstein@stanford.edu

&Ellen D. Zhong

Princeton University

zhonge@princeton.edu

Equal contribution

###### Abstract

Cryo-electron microscopy (cryo-EM) is an experimental technique for protein structure determination that images an ensemble of macromolecules in near-physiological contexts. While recent advances enable the reconstruction of dynamic conformations of a single biomolecular complex, current methods do not adequately model samples with mixed conformational and compositional heterogeneity. In particular, datasets containing mixtures of multiple proteins require the joint inference of structure, pose, compositional class, and conformational states for 3D reconstruction. Here, we present Hydra, an approach that models both conformational and compositional heterogeneity fully _ab initio_ by parameterizing structures as arising from one of \(K\) neural fields. We employ a new likelihood-based loss function and demonstrate the effectiveness of our approach on synthetic datasets composed of mixtures of proteins with large degrees of conformational variability. We additionally demonstrate Hydra on an experimental dataset of a cellular lysate containing a mixture of different protein complexes. Hydra expands the expressivity of heterogeneous reconstruction methods and thus broadens the scope of cryo-EM to increasingly complex samples. Webpage: https://hydra.cs.princeton.edu

## 1 Introduction

Structural information is key to understanding the function of macromolecular complexes, making protein structure determination a crucial tool in basic structural biology and rational drug design. Among experimental structure determination methods, cryogenic electron microscopy (cryo-EM) is unique in its capability to reveal dynamic information about large macromolecular complexes in near-native states.

In single particle cryo-EM, a set of biomolecular complexes (i.e. particles) is flash-frozen and imaged with a transmission electron microscope. Each collected image consists of a noisy, randomly oriented projection of an individual particle of unknown identity or composition, frozen in an unknown state. Reconstruction algorithms processing these data without information from upstream algorithms are called _ab initio heterogeneous_ reconstruction methods. Classical reconstruction techniques use a Bayesian approach to optimize a finite number of voxel-based representations [50; 45]. These algorithms enabled biologists to process datasets made of a mixture of different protein compositions and, thus illuminate the molecular details of fundamental biological processes. These methods, however, tend to aggregate all the proteins of the same composition in a _single class_, despite these proteins being trapped in different conformational states, due to thermal fluctuations prior to the freezing step. Another line of work has extensively studied the possibility of reconstructing continuous motion from cryo-EM datasets, using linear combinations of voxel arrays , neural-based representations [68; 69; 25; 26], Gaussian mixture models [5; 20], or combining a voxel array with a flow field . These methods sometimes leverage a structural prior about proteins (e.g., proteins are made of a fixed number individual atoms) and enable the reconstruction of molecular motion at high resolution. However, none of these methods can handle datasets containing different types of proteins, thereby strongly limiting their application, especially in the context of _in situ_ cryo-EM.

As of today, there exist no approaches to simultaneously reveal compositional (discrete) and conformational (continuous) heterogeneity in cryo-EM datasets, potentially limiting the structures that can be revealed from the data. Unraveling this information poses a nontrivial problem that sequential strategies cannot solve. Due to their low signal-to-noise-ratio, cryo-EM images cannot be clustered depending on the type of protein they contain prior to the reconstruction. Because orientations are unknown, the problem cannot be solved by handling compositional heterogeneity before conformational heterogeneity as consensus poses (i.e., orientations) are inaccurate for large motions.

Here, we introduce Hydra, a neural-based method for _ab initio_ heterogeneous reconstruction in cryo-EM. Inspired by the success of implicit neural representations in cryo-EM, we extend the neural field representation of DRGN-AI  with a mixture model of \(K\) neural fields. Using a new likelihood-based loss function, we simultaneously optimize orientations, conformations and class assignments and circumvent the pitfalls of sequential approaches. We demonstrate that our method allows neural-based methods to handle strong compositional heterogeneity and enables the simultaneous reconstruction of compositional and conformational heterogeneity with state-of-the-art accuracy. In an experimental cryo-EM dataset of a cell lysate mixture, we reveal three compositional states in a single pass, fully _ab initio_. We therefore make the following contributions:

* We develop a mixture of neural fields model for _ab initio_ heterogeneous reconstruction in cryo-EM;
* We demonstrate that our method improves the expressiveness of neural-based methods for handling strong compositional heterogeneity;
* We enable simultaneous reconstruction of conformational and compositional heterogeneity beyond the limits of existing methods;
* We demonstrate the reconstruction of multiple protein complexes from an experimental dataset of an unpurified sample.

## 2 Related Work

### Heterogeneous Reconstruction in Cryo-EM

Discrete Variability.Cryogenic electron microscopy offers the potential to reveal the structure of macromolecules in heterogeneous samples, where multiple types or multiple conformations are mixed together . The first reconstruction algorithms handling 3D variability modeled the set of particles as a finite set of static structures. RELION  popularized the Bayesian approach to tackle heterogeneous reconstruction and the later introduced _multi-body refinement_ tool  offered the possibility to segment static density maps and model continuous motion as a combination of rigid transformations. The software suite was recently improved with the Blush regularization tool [22; 4], leveraging a data-driven prior to enable the reconstruction of small protein-nucleic acid complexes (\( 40\) kDa). CryoSPARC  accelerated the inference with stochastic gradient descent and, in the 3DVA  extension, modeled continuous motion with a linear combination of density maps. These methods represent the state of the art for cryo-EM reconstruction but do not have the capability to represent complex non-linear motion and tackle the discrete heterogeneity (e.g., with "multi-class _ab initio_") before the continuous variability (e.g., with 3DVA or ), leading to inaccurate pose estimation for states exhibiting large motion.

Non-Linear Methods for Heterogeneous Reconstruction.In the past years, significant progress has been made in revealing non-linear dynamics from cryo-EM data. Manifold embedding  and Laplacian methods  are among the first attempts to model non-linear continuous motion but have only been applied to a small number of macromolecular complexes [8; 7]. HEMNMA  used a decomposition over the low-energy normal modes of an atomic model, thereby leveraging a prior over the structure and the dynamics of macromolecules. Herreros et al.  proposed the use of 3D Zernike polynomials and eliminated the need for pseudo-atomic models. CryoDRGN  used neural networks to continuously represent deformable density maps as well a variational auto-encoding framework to estimate conformational states. E2GMM , cryoFold , and DynaMight  followed this encoder-decoder framework and used Gaussian mixture models to represent density maps, thereby reducing the memory footprint of previous non-linear methods. 3DFlex  introduced the use of a parametric flow field to smoothly deform canonical 3D density maps, leveraging the knowledge that energetically favorable deformations tend to preserve the local geometry of proteins. Although these methods demonstrated the ability to reconstruct molecular motions and heterogeneity, they all need a coarse initialization of the density map, or the poses to be provided by an upstream reconstruction algorithm. In practice, this _ab initio_ step is error prone in the presence of large conformational motions.

Ab Initio Heterogeneous Reconstruction.Recent works investigated the problem of reconstructing an ensemble of density maps where poses are unknown. The preliminary cryoDRGN method  tackled the _ab initio_ reconstruction problem by combining traditional pose search algorithms with the encoder-decoder neural-based architecture, which was refined in cryoDRGN2 . Multi-CryoGAN  sidestepped pose estimation by casting the reconstruction problem as a distribution matching problem and successfully revealed 3D variability in synthetic cryo-EM datasets. Rosenbaum et al.  showed that the auto-encoding framework could be applied to jointly estimate poses and conformations of atomic models, and Levy et al.  demonstrated a fully autoencoding framework for _ab initio_ heterogeneous reconstruction on real benchmark datasets. DRGN-AI  recently introduced a hybrid pose search strategy combined with an autodecoding architecture to handle low-signal datasets and demonstrated _ab initio_ heterogeneous reconstruction on challenging datasets containing a significant number of junk images. These methods extend neural-based reconstruction to scenarios where poses cannot be reliably estimated by any upstream algorithms, but have a limited capability to represent mixtures of biomolecular complexes, due to the limited capacity of a single neural representation.

Here, we propose to represent the landscape of accessible structures via an ensemble of \(K\) neural networks, each _specialized_ in representing the variability within a single compositional state. By jointly estimating structures and orientations, our method handles datasets that exhibit strong compositional heterogeneity and large motions.

### Neural Fields for Large and Dynamic Scenes

Dynamic Scenes.In graphics, neural networks have also been used as light-weight, differentiable representations of continuously defined signals (e.g., occupancy fields , signed distance functions [37; 6], surface light fields , latent representation of appearance [52; 53], radiance fields [32; 1], and light fields ). In order to handle time-dependency and represent dynamic scenes, two approaches have been explored, as described in . Similar to the cryo-EM method 3DFlex , _deformation-based_ approaches apply a spatially-varying deformation to some canonical radiance field [38; 42; 59]. Methods following this strategy recover detailed dynamic scenes but are unable to model any topological variations. Similar to cryoDRGN , _modulation-based_ approaches directly condition the radiance field of the scene on some latent vectors encoding temporal or dynamic information [13; 27; 65; 12]. These techniques are capable of modeling arbitrary deformations, topological changes, and other complex phenomena, but require additional regularization strategiesto avoid trivial, non-plausible solutions. HyperNeRF  was introduced as a combination of both approaches and enabled photo-realistic reconstruction of dynamic scenes with topological changes.

Large-Scale Scenes.Due to their limited capacity, neural networks have essentially been used to represent single objects or small-scale scenes. Several methods [46; 47] have looked into the possibility of using an ensemble of neural fields to represent large scenes such as a neighborhood in the city of San Francisco . Another approach is to provide extra capacity with a coarse 3D grid of latent codes [27; 55; 40] or a block-coordinate multi-scale decomposition . These works focus on static reconstruction, and if dynamic objects are present in the scene, these are simply masked out . Ost et al.  enabled the representation of complex, dynamic multi-object scenes by decomposing them into their static and dynamic parts and learning one neural radiance field per dynamic object.

Here, we use the _modulation-based_ approach to handle the continuous motion of proteins and an ensemble of neural fields to increase the representational capacity of our model, allowing it to reconstruct compositional mixtures of proteins. In contrast with the works cited above, we need to estimate which compositional state each image belongs to - which is done using a variational approach - while simultaneously optimizing the ensemble of neural networks and individual image poses.

### Adaptive Mixtures of Experts

A mixture of experts (MoE) model uses an ensemble of neural networks to process a given input . Doing so, the input space can be partitioned into subspaces on which only one of the neural networks needs to become "expert". The mechanism with which the input space gets partitioned is usually referred to as the _gating_ mechanism. Masoudnia and Ebrahimpour  partitions MoE approaches into two groups, depending on the gating mechanism and both how and when this mechanism is involved: (1) mixtures of explicitly localized experts (MELE) cluster the input data before the experts' training phase starts while (2) mixtures of implicitly localized experts (MILE) jointly optimize the expert networks and the gating mechanism. In cryo-EM, clustering methods operating directly on images are usually ineffective because of the high level of noise and because of the presence of other nuisance variables (orientation and conformation), making the MELE approach irrelevant.

Jacobs et al.  examined the use of different error functions (or loss functions) to optimize the expert networks and the gating mechanism, and the best performance was obtained using the negative log-probability of a Gaussian mixture model . Several architectures have been explored, and one of the most applied is the mixture of MLP-experts (MME) [63; 9], where multi-layer perceptrons (MLPs) are used for both the experts and the gating networks. Our approach can be viewed as an application of the MILE method where, as in Jacobs et al. , the error function corresponds to the negative log-probability of a Gaussian mixture model. Due to the high level of noise, the gating mechanism ignores the content of input images and relies on an autodecoding framework.

## 3 Methods

In this section, we first describe the image formation model in single particle cryo-EM (3.1). We then define a 3D variability model that models both compositional and conformational heterogeneity (3.2). Based on these two first sections, we describe our system with a latent variable model (3.3) and explain our optimization method (3.4). The method is schematically described in Figure 1.

### Image Formation Model

In cryo-EM, a purified solution of macromolecules is flash-frozen inside a thin layer of vitreous ice. Each molecule gets trapped in a random orientation with respect to the microscope and in a random conformational state, approximately following the Boltzmann distribution at ambient temperature . The sample is exposed to an electron beam and individual 2D projections are extracted from micrographs via a step known as "particle picking". The reconstruction task therefore starts with a given set of \(N\) images (or particles). Each image \(I_{i}\) can be modeled as [60; 50]

\[I_{i}=C_{i}*_{_{i}}V_{i}+_{i},\] (1)where \(C_{i}\) models the the Contrast Transfer Function (CTF), \(V_{i}\) is a scalar 3D field (\(^{3}\)) known as the "electron scattering potential" or the "density map", \(_{i}=(_{i},_{i})\) is a "pose" (\(_{i}(3)\), \(_{i}^{2}\)) and \(\) projects \(V_{i}\) on a 2D grid:

\[_{(,)}V_{i}=_{t}V( [x_{m,n}-t_{x},y_{m,n}-t_{y},t]^{T}),(m,n)\{1,...,D\} ^{2}}.\] (2)

\(_{i}\) models isotropic Gaussian noise (\(_{i}(0,^{2})\)). In a typical experiment, \(N\) can vary between \(10^{5}\) and \(10^{7}\); The signal-to-noise ratio can vary between \(10^{-1}\) and \(10^{-2}\).

### Heterogeneity Model

Structural heterogeneity among the macromolecules can originate (1) from continuous motion along a small number of _degrees of freedom_, or (2) from discrete compositional changes. We refer to the first kind of heterogeneity as "conformational heterogeneity" and to the second one as "compositional heterogeneity".

To model this mathematically, we make the assumption that all the density maps \(V_{i}\) belong to a finite union of low-dimensional manifolds:

\[ i\{1,,N\},V_{i}\{(z;_{k}),z ^{d},k\{1,,K\}\},\] (3)

where \(K\), \(d\) and, for all \(k\), \(_{k}\) is an unknown parameter. In other words, we assume that there exist \(K\) compositional states and that the conformational motion of state \(k\) can essentially be described with \(d\) degrees of freedom.

### Latent Variable Model

We statistically describe the set of observed images with a latent variable model. Here, the _latent variables_ are the poses \(_{i}\), the conformations \(z_{i}\) and the class identities \(k_{i}\), while \(\{_{k}\}_{k=1}^{K}\) is a set of _shared parameters_.

Given the image formation model described by Eq. 1 and the heterogeneity model described by Eq. 3, each observed image can be seen as a sample from a multivariate mixture model:

\[p(I_{i})=_{k=1}^{K}p(k_{i}=k) p(|k_{i}=k)p(z|k_{i}=k)( C_{i}*_{}(z;_{k}),^{2}) z.\] (4)

We parameterize a probability distribution over the class identity, such that:

\[ i\{1,,N\}, k\{1,,K\}, p(k_{i}=k)=(_{i})_{k})}{_{j}(s_{i,j})},\] (5)

Figure 1: **Overview of Hydra.****(a)** Schematic representation of the space of energetically plausible density maps in a heterogeneous cryo-EM dataset. We approximate this space with a finite union of low-dimensional manifolds. The compositional states (or classes) are labeled by \(k\). The “conformation” within class \(k\) refers to intrinsic coordinates within the \(k\)-th manifold. **(b)** Optimization pipeline. The conformations, poses, class probabilities and neural fields are optimized such as to maximize the likelihood of the observed images (“picked particles”) under the model described in Section 3.3.

where \(_{i}^{K}\) is a free parameter called the "score". For each \(k\), we parameterize point estimates of the continuous latent variables:

\[ p(|k_{i}=k)&=(-_{i, k}),_{i,k}(3)^{2}\\ p(z|k_{i}=k)&=(z-z_{i,k}), z_{i,k} ^{d}.\] (6)

Under the model in Equation (4) and the variational parameterization described above, the negative log-likelihood of an image is given by

\[_{i}(\{_{i,k}\}_{k=1}^{K},\{z_{i,k}\}_{k=1}^{K},_{i};\{_{k}\}_{k=1}^{K})\\ =-_{k=1}^{K}(-}\|I_{i}-C_{i} _{_{i,k}}(z_{i,k};_{k})\|_{2}^{2}+( (_{i})_{k}))\] (7)

In our implementation, each low-dimensional manifold \((:,_{k})\) is implemented with a residual MLP. We provide further details on the architecture of the neural networks in the supplementary materials.

### Hybrid Optimization Strategy

We aim at minimizing the negative log-likelihood of the set of observed images,

\[=_{i=1}^{N}_{i}(\{_{i,k}\}_{k=1}^{K},\{z_{i,k}\}_{k=1} ^{K},_{i};\{_{k}\}_{k=1}^{K}),\] (8)

over \((\{_{i,k}\},\{z_{i,k}\},\{_{i}\},\{_{k}\})\). All the parameters are optimized using a combination of gradient-based optimization and exhaustive search. Here, we use an autodecoding framework and do not _amortize_ the inference of latent variables with an encoder, following the observation in Levy et al.  that encoders tend to memorize images in highly-noisy setups.

We handle the minimization over \(\{z_{i,k}\}\), \(\{_{i}\}\) and \(\{_{k}\}\) with stochastic gradient descent. The minimization over the poses \(\{_{i,k}\}\) is more challenging, due to the existence of local minima. We take inspiration from the two-step pose estimation strategy introduced in DRGN-AI  and adapt it to cope with the simultaneous representation of multiple maps. First, optimization over poses is done with hierarchical pose search (HPS) in alternation with stochastic gradient descent on the other variables. On a given random _minibatch_ of indices \(\{1,,N\}\),

\[ i, k\{1,,K\},_{i,k} *{argmin}_{}\|I_{i}-C_{i}_{} (z_{i,k};_{k})\|_{2}^{2},\] (9)

where \(\) is a predefined grid in the space of poses (\((3)^{2}\)). See  and the supplementary for more details on how the minimization can be done efficiently with a hierarchical strategy. This robust but computationally-expensive strategy is used for a predefined number of steps, usually between \(5 10^{5}\) and \(2 10^{6}\). After that, most poses are located in the basin of attraction of their global optimum and switching to stochastic gradient descent (SGD) makes computation more efficient while improving pose accuracy (poses are not constrained to belong to a predefined grid of fixed resolution during SGD).

At the end of optimization, the estimated class of image \(I_{i}\) is simply given by the index \(k_{i}\) of the largest entry in \(_{i}^{K}\).

## 4 Experiments

We run three experiments to evaluate Hydra. In Section 4.1, we show that our method improves the expressiveness of neural-based methods and can reveal strong compositional heterogeneity fully _ab initio_. In Section 4.2, we use Hydra to reveal compositional heterogeneity in an experimental dataset containing protein complexes of diverse sizes, in a single run. In Section 4.3, we demonstrate the simultaneous reconstruction of compositional and conformational heterogeneity.

### _Ab initio_ reconstruction of compositional heterogeneity

We evaluate Hydra on tomotwin3, a synthetic dataset of 3,000 images emulating a protein sample containing multiple species with static structures. We selected the 6th, 7th, and 8th largest proteins by atomic weight from the TomoTwin training dataset , which correspond to entries 6up6, 6id1, and 4cr2 in the RCSB PDB (Protein Data Bank) . We rendered 1,000 synthetic images of each specimen following the cryo-EM image formation model. For each protein structure, we simulated density maps with the ChimeraX molmap command [30; 58]. We padded the density maps to a box size of \(D=384\) pixels and centered them. We sampled 1,000 orientations per ground truth class uniformly from \((3)\). We projected the density maps using Eq. 1 and applied a translation vector uniformly chosen from a 30-pixel-wide box centered at the origin. We applied a CTF sampled from EMPIAR-11247  and added Gaussian noise (SNR = 0.01). We downsampled each image to a box size of \(D=128\), yielding 3,000 images in total (samples shown in Figure S1).

We compare the performance of Hydra to several state-of-the-art _ab initio_ methods for resolving compositional heterogeneity in cryo-EM datasets, including DRGN-AI , cryoDRGN2 , and cryoSPARC . Hydra only uses 2 dimensions for the conformational space, while DRGN-AI and CryoDRGN2 are evaluated with a more expressive 8-dimensional space. We test Hydra using the correct number of classes (\(K=3\), the true number of specimens present in the sample) and

    & **ARI \(\)** &  \\ 
**Model** & All & PDB 6up6 & PDB 6id1 & PDB 4cr2 \(\) \\  Hydra (\(K=3\)) & \(\) & \(0.25 0.03\) & \(0.394 0.001\) & \(\) \\ Hydra (\(K=5\)) & \(\) & \(0.25 0.03\) & \(\) & \(\) \\ DRG-AI (\(K=1\)) & \(0.59\) & \(0.0242 0.003\) & \(0.040 0.005\) & \(0.042 0.004\) \\ CryoDRGN2 & \(0.36\) & \(0.08 0.01\) & \(0.070 0.006\) & \(0.3 0.1\) \\ CryoSPARC & \(\) & \(\) & \(0.367\) & \(0.338\) \\   

Table 1: **Hydra captures compositional heterogeneity in a challenging synthetic dataset and outperforms other neural-based methods.** The classification accuracy is evaluated for each method using the adjusted Rand index (ARI) . To evaluate each method’s reconstruction quality, we use the mean area under the Fourier shell correlation (FSC) curve for 20 images per class (we report \( 1\) standard deviation). We **bold** the best result, and underline the second best result.

Figure 2: **Hydra captures strong compositional heterogeneity in the tomotwin3 dataset.****(a-c)** Reconstructed densities and estimated conformations with \(K\{1,3,5\}\). We report the number of particles in each class between parenthesis. We represent density maps using isosurfaces. **(a)** With \(K=1\) (DRGN-AI), the model fails to reconstruct the three density maps, in spite of using \(d=8\) dimensions to represent conformations. **(b)** With \(K=3\) (\(d=2\)), Hydra recovers the three density maps with perfect classification accuracy. **(c)** With \(K=5\) (\(d=2\)), the model is over-parameterized and 2 classes out of 5 end up empty at the end of optimization. **(d)** Ground truth density maps for the tomotwin3 dataset.

using an over-parameterized setup (\(K=5\) in Figure 2 and \(K=7\) in Figure S2). For DRGN-AI and CryoDRGN2, we classify each image using \(k\)-means clustering on the conformational space with 3 clusters. We evaluate per-image FSC for each class using the dataset's ground truth class labels.

In Table 1, we report results for each configuration of Hydra and other methods, (best of three replicas with distinct seeds for Hydra and DRGN-AI, full results in Table 3). We observe that other methods with implicit neural volume representations, including DRGN-AI and CryoDRGN2, fail to capture the compositional heterogeneity of the dataset. Hydra matches the classification quality of cryoSPARC, which models independent, discrete mixtures. Hydra also outperforms all methods on per-image FSC, a distributional volume reconstruction quality metric based on the Fourier Shell Correlation (FSC) . We provide additional results with a larger version of this dataset in Figure S3 and additional metrics (including roto-translation accuracy) in Table 4.

### _Ab initio_ reconstruction of an experimental cryo-EM mixture dataset

We evaluate our method on an experimental dataset of a protein mixture from red blood cell lysate subjected to density-gradient centrifugation followed by chemical cross-linking. Through an exhaustive, expert-driven data processing pipeline in cryoSPARC , we determined that the dataset consisted of substantial compositional heterogeneity from three main component protein complexes: the membrane proteins ryanodine receptor (RyR) and mitochondrial respiratory chain complex III (CIII), and a dimeric complex of the soluble valosin-containing protein (p97). A sweep of \(K\)-values from cryoSPARC ab-initio reveals that \(K 5\) is necessary in order for cryoSPARC to reconstitute distinct RyR, p97, CIII, and junk classes (Figure S4).

In Figure 3, we compare the performance of DRGN-AI  with Hydra. Figures 3d and S5 show that DRGN-AI successfully partitions the dataset into two clusters corresponding to the RyR and non-RyR particles; however, DRGN-AI is unable to learn distinct shapes for all three discrete structures and instead appears to learn structural artifacts from the non-RyR particles that match the overall RyR shape. By contrast, Hydra with \(K=4\) successfully separates the particles into the three component protein complexes and a fourth junk class (Figures 3 and S6). As a baseline for comparison, we also carried out the typical workflow of first generating poses from a consensus reconstruction in cryoSPARC, followed by fixed-pose DRGN-AI to separate the heterogeneity. As can be seen in Figure S7, DRGN-AI recovers a high resolution RyR density but fails to learn non-RyR protein structures when training from poses from homogeneous reconstruction. A multi-step reconstruction with DRGN-AI does not either reveal the CIII class (Figure S8).

Figure 3: Hydra captures compositional heterogeneity in a real dataset containing a mixture of membrane and soluble protein complexes. (a) Density maps obtained with Hydra (\(K=4\)) on the Ryanodine receptor dataset. (b) Confusion matrix between Hydra and cryoSPARC \(K=6\) heterogeneous refinement (three classes representing RyR were combined for analysis). (c) Fourier shell correlation (FSC) between the Hydra density maps and refined cryoSPARC density maps. (d) _Left_: latent space plot and _right_: representative density maps from each of the latent space clusters from DRGN-AI.

[MISSING_PAGE_FAIL:9]

Our method can be seen as an instance of a mixture of experts model, where the gating mechanism is handled by an autodecoding framework, due to the low signal-to-noise ratio in the input data. However, predicting classes with a neural network can be viewed a _classification_ task and may be easier than pose or conformation estimation. We view the possibility of using a (potentially pretrained) neural network for classification, thereby making use of amortized inference, as an exciting avenue for future work.

One important limitation of our approach is the need to specify the number of classes \(K\) prior to reconstruction. Other methods that cope with compositional heterogeneity, like RELION  and cryoSPARC , possess the same requirement, and this is solved in practice by running the algorithm several times with a sweep on the hyperparameter \(K\). As this process is time and energy-consuming (a single reconstruction can run for up to 4 GPU-days on high-end GPUs), more efficient methods for hyperparameter selection, for example, with an adaptive and/or hierarchical strategy, is an impactful direction for future work. We would also like to note that, in its current implementation, Hydra must give the same latent dimension (\(d\)) to all the classes, but this constraint could be relaxed with, for-example, a dictionary-based representation for the conformations.

With Hydra, we broaden the scope of datasets that cryo-EM reconstruction algorithms can process. Our method would be especially suitable for data collected _in situ_ (i.e., inside the cell), where mixtures of dynamic biomolecular complexes coexist. This data is usually acquired by cryogenic electron tomography (cryo-ET), where the sample is progressively tilted throughout the data collection process. Extending our method to enable subtomogram averaging of cryo-ET data is another potential future direction that we hope can enable future discoveries in structural biology and facilitate the design of new therapeutic compounds.

## 6 Acknowledgments

The author(s) are pleased to acknowledge that the work reported on in this paper was substantially performed using the Princeton Research Computing resources at Princeton University which is a consortium of groups led by the Princeton Institute for Computational Science and Engineering (PICSciE) and Office of Information Technology's Research Computing. The Zhong lab gratefully acknowledges support from the Princeton Catalysis Initiative, Princeton School of Engineering and Applied Sciences, and Generate Biomedicines. The funders had no role in study design, data collection and analysis, decision to publish or preparation of the manuscript.