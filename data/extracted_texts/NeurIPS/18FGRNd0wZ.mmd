# Invariant Tokenization of Crystalline Materials for Language Model Enabled Generation

Keqiang Yan\({}^{1}\), Xiner Li\({}^{1}\), Hongyi Ling\({}^{1}\), Kenna Ashen\({}^{1}\), Carl Edwards\({}^{2}\),

**Raymundo Arroyave\({}^{1}\), Marinka Zitnik\({}^{3}\), Heng Ji\({}^{2}\), Xiaofeng Qian\({}^{1}\), Xiaoning Qian\({}^{1}\), Shuiwang Ji\({}^{1}\)**

\({}^{1}\)Texas A&M University, College Station, TX 77843, USA

\({}^{2}\)University of Illinois Urbana-Champaign, Champaign, IL 61820, USA

\({}^{3}\)Harvard University, Boston, MA 02115, USA

{keqiangyan,lxe,hongyiling,kashen13,rarroyave,feng,xqian,sji}@tamu.edu

{cne2,hengji}@illinois.edu

marinka@hms.harvard.edu

###### Abstract

We consider the problem of crystal materials generation using language models (LMs). A key step is to convert 3D crystal structures into 1D sequences to be processed by LMs. Prior studies used the crystallographic information framework (CIF) file stream, which fails to ensure \(SE(3)\) and periodic invariance and may not lead to unique sequence representations for a given crystal structure. Here, we propose a novel method, known as Mat2Seq, to tackle this challenge. Mat2Seq converts 3D crystal structures into 1D sequences and ensures that different mathematical descriptions of the same crystal are represented in a single unique sequence, thereby provably achieving \(SE(3)\) and periodic invariance. Experimental results show that, with language models, Mat2Seq achieves promising performance in crystal structure generation as compared with prior methods.

## 1 Introduction

Discovering crystalline materials with desired properties is valuable for advancing a variety of technological sectors . However, current materials discovery relies on trial-and-error wet-lab experimental methods that are time-consuming and expensive. Computational methods based on advanced quantum mechanical approaches such as first-principles density functional theory (DFT) have sped up this process in the last two decades. Nevertheless, the high computational cost of these methods ranging from \(O(n^{3})\) to \(O(n^{7})\), where \(n\) is number of electrons in a material system, poses a significant challenge for high-throughput screening of the infinite materials space.

Recent advances in large language models (LLMs) have showcased substantial capabilities in real-time question answering and image generation. However, the application of these models to atomistic systems, including molecular and material structures, remains relatively underexplored. Specifically, while recent studies have attempted to represent molecules and crystals using XYZ and CIF structure file formats , they have not adequately addressed the critical issues of uniqueness and invariance in sequence representations of 3D crystal structures, which play key roles for successful LLM-based discovery of novel crystalline materials with discussions provided in Sec. 2.2.

The concept of uniqueness  in crystal sequences mandates a bijective relationship between crystal structures and their sequence representations. Current approaches using CIF files directly in crystal LLMs violate this uniqueness criterion, leading to significantly varied sequences for identical crystals, particularly in terms of atom ordering and fractional coordinates within the unit cell as illustrated in Figure 1. This lack of unique sequence representations means that an infinite number ofCIF files can describe the same crystal, necessitating extensive augmentation during LLM training to recognize these equivalences. Without such augmentation, previous CIF file based methods [10; 11] essentially train crystal LLMs using only a limited set of crystal structure snapshots.

In this work, we develop a framework for creating unique and complete crystal sequence representations, followed by the construction of a material LLM capable of generating novel crystal structures with desired properties of interest. To accomplish this, several challenges must be addressed. First, unlike molecular structures that contain a finite number of atoms, each crystal structure consists of an infinite number of atoms through a periodic translation of a finite set of atoms in a unit cell along the direction of three lattice vectors in three-dimensional (3D) space. Consequently, there are numerous different unit cells for the same crystal as shown in Figure 1. A unique and invariant unit cell must therefore be selected for each crystal. Second, it is crucial that this unit cell can be represented in a one-dimensional (1D) sequence that maintains invariance under arbitrary rotations and ensures completeness, allowing the full reconstruction of the crystal structure from its sequence representation. To tackle these complexities, we introduce Mat2Seq, a method that systematically transforms 3D crystal structures into 1D sequences. This is achieved by first identifying \(SO(3)\) equivariant unit cells and subsequently converting these into \(SE(3)\) invariant sequences. By integrating these unique and complete sequences into LLMs, we develop conditional generation capabilities for novel crystal structures. Our experimental results in crystal structure prediction and crystal discovery with desired properties validate the efficacy of Mat2Seq.

## 2 Preliminaries and related work

### Crystal structure generation

In this work, we study the problem of generating 3D crystals from scratch. Unlike small molecules, crystalline materials are defined by a unit cell which contains a set of atoms repeated infinitely across three-dimensional space along three periodic lattice vectors. Following notations of ComFormer , each crystal structure is represented by \(=(,,),\) where \(=[_{1},_{2},,_{n}] ^{d_{a} n}\) represents the \(d_{a}\)-dimensional feature vectors of \(n\) atoms within the unit cell, \(=[_{1},_{2},,_{n}] ^{3 n}\) represents the 3D Euclidean positions of these \(n\) atoms, and \(=[_{1},_{2},_{3}] ^{3 3}\) specifies three periodic lattice vectors, representing the repeating patterns of the unit cell in 3D space. The infinite structure of a given crystal \(=(,,)\) is formalized as \(}=\{}_{i}|}_{i}= _{i}+k_{1}_{1}+k_{2}_{2}+k_{3} _{3},\;k_{1},k_{2},k_{3},i,1 i  n\},}=\{}_{i}|}_{i}= _{i},i,1 i n\},\) where \(}\) denotes the positions of atoms and their infinite repeats in the 3D space, and \(}\) denotes the corresponding feature vectors. This work targets two primary tasks:

**Crystal structure generation**: Using a dataset of 3D crystals \(\{_{j}\}_{j=1}^{m}\), we aim to develop a structure generative model \(p_{}(|_{j})\) to synthesize valid and stable 3D crystal structures for input compositions.

**Conditional generation**: With a dataset \(\{(_{j},s_{j})\}_{j=1}^{m}\), where \(s_{j}\) denotes a specific property of \(_{j}\), we aim to establish a conditional generative model \(p_{}(|s)\) to generate 3D crystal structures possessing the property \(s\).

Generative models for crystal structures must address complex geometric requirements, such as ensuring periodic and unit cell \(SE(3)\) invariance [8; 15; 14; 16]. The ideal models should consider \(=(,,)\) and its equivalents under periodic transformations or rotations and translations as identically probable [15; 14]. CDVAE  achieves periodic and \(SE(3)\) invariance by encoding crystal structures into \(SE(3)\) invariant latent features but faces limitations in restricting the loss function to be periodic invariant. This limitation is later rectified in SyMat . Beyond this, DiffCSP  is specifically optimized for crystal structure prediction that generates stable crystal structures for given compositions. In contrast, MatterGen  models \((,,)\) in an equivariant manner by gradually corrupting them into known distributions.

While the generation of 3D crystal structures as 3D point clouds is well-established, applying powerful language models to this task is novel and nontrivial as discussed in Sec. 2.2. Our approach uniquely transforms infinite 3D crystal structures into \(SE(3)\) and periodic invariant sequences, demonstrating that language models can effectively generate crystal structures with high performance.

### Language model for 3D crystal structures

Enabling language models to generate 3D crystal structures necessitates transforming these structures into sequence representations. Several studies have employed CIF files as sequence inputs for this purpose [10; 11; 12]. These approaches convert a set of 3D crystals \(\{_{j}\}_{j=1}^{m}\) into a dataset of sequences, \(=\{C_{1},C_{2},,C_{m}\}\), where each \(C_{j}\) represents the CIF text of \(_{j}\). The sequence \(C_{j}=\{c_{1},c_{2},,c_{n_{j}}\}\) of length \(n_{j}\) are composed of tokens \(c_{i}\) from a predefined vocabulary \(V\). Autoregressive language models are either trained [10; 12] or fine-tuned  to encode these sequences by maximizing the conditional probabilities of each token given its predecessors, \(p(C_{i}|)=_{j=1}^{n_{i}}p(c_{j}|c_{1}:c_{j-1};)\), with the objective to maximize the probabilities of the dataset \(p(|)=_{i=1}^{m}p(C_{i};)\). During generation, novel crystal sequences are produced from \(p()\) in an autoregressive manner.

However, ideal crystal generative models should consider \(=(,,)\) and its equivalents under periodic transformations or rotations and translations as identically probable, a criterion unmet by current models due to the variability in CIF text descriptions for the same crystal. For example, there are different sequence representations \(C_{i}=\{c_{1},c_{2},,c_{n_{i}}\}\) and \(C^{}_{i}=\{c^{}_{1},c^{}_{2},,c^{}_{n^{}_{ i}}\}\) for the same crystal, yet ideally, \(_{j=1}^{n_{i}}p(c_{j}|c_{1}:c_{j-1};)=_{j=1}^{n^{}_{i}}p( c^{}_{j}|c^{}_{1}:c^{}_{j-1};)\) should hold. Despite being highly non-trivial, this is overlooked by previous studies. This issue is illustrated through the failure cases of CIF-based crystal language models [10; 11; 12] in Figure 1.

**Differences with previous works**. It is crucial to recognize that prior works [10; 11; 12] using CIF files as input violate invariance and generate a multitude of different sequence representations for the same crystal. Consequently, these models fail to consistently recognize \(=(,,)\) and its equivalents under periodic transformations including shifting periodic boundaries and changing lattice vectors as identically probable. While intensive data augmentation can mitigate this issue, it significantly burdens the training process of language models. In contrast, our Mat2Seq approach maps all equivalent crystals to a unique sequence, naturally ensuring that all equivalents are considered equally probable without the need for data augmentation.

## 3 Tokenization of 3D crystal materials

In this section, we demonstrate **Mat2Seq** for transforming 3D crystal structures into 1D sequences that adhere to the principles of \(SE(3)\) invariance, periodic invariance, and completeness. We first discuss requirements for ideal crystal sequence representations in Sec. 3.1 and provide formal definitions of unit cell \(SE(3)\) invariance, periodic invariance, and completeness. We then show how to design crystal sequence representations to achieve these requirements in Sec. 3.2 and 3.3, with the pipeline

Figure 1: Limitations of directly using CIF files in achieving unique crystal sequence representations. This figure demonstrates variations in CIF files, either with or without symmetry control command denoted as ”symprec”, for the same crystal structure subjected to periodic transformations. Changes in the CIF contents are highlighted in red. Periodic transformations can significantly alter the unit cell structures, resulting in distinct CIF files _differed by fractional coordinates, atom ordering, and lattice parameters_ for the same underlying crystal.

shown in Figure 2. We then provide property proofs of **Mat2Seq** in Sec. 3.4, and demonstrate the combination of **Mat2Seq** and language models for crystal structure generation in Sec. 3.5.

### Requirements for ideal crystal sequence representations

**Uniqueness**. Ideal crystal sequences need to satisfy uniqueness which ensures a deterministic mapping of a crystal structure \(=(,,)\) and its equivalents, as transformed by periodic and \(SE(3)\) operations, to a singular, unique sequence. However, to the best of our knowledge, none of previous studies [10; 11; 12] achieves uniqueness for crystal sequence representations.

When a sequence inherently satisfies this criterion, it guarantees that all structural equivalents are recognized as equally probable by language models, thus eliminating the need for any manual adjustments for language models or extensive augmentation during the training phase. Following ComFormer , we further define the necessary invariances for ideal sequence representations.

**Definition 1** (Unit Cell \(SE(3)\) Invariance).: _A function \(f:(,,)\) is unit cell \(SE(3)\) invariant if, for any rotation transformation \(^{3 3},||=1\) and translation transformation \(^{3}\), we have \(f(,,)=f(,+b, )\)._

**Definition 2** (Periodic Invariance).: _A function \(f:(,,)\) is periodic invariant if, for any possible minimum unit cell representations \(^{}=(^{},^{},^{ })\) representing a given infinite crystal structure \((},})\), we have \(f(,,)=f(^{},^{ },^{})\)._

This definition captures two periodic transformations that result in distinct minimum unit cell representations of the same crystal structure: (1) shifting periodic boundaries, and (2) altering periodic patterns while maintaining the same unit cell volume as shown in Figure 1.

**Completeness**. Ideal crystal sequences need to be complete, allowing the full reconstruction of 3D crystal structures from their 1D sequences.

### Determination of \(So(3)\) equivariant unit cells

We propose Mat2Seq that converts 3D crystal materials into 1D sequences by (1) determining the \(SO(3)\) equivariant unit cells and (2) converting \(SO(3)\) equivariant unit cells into \(SE(3)\) invariant sequences. In this section, we demonstrate how to determine the \(SO(3)\) equivariant unit cell of a given crystal structure \(=(,,)\).

**Determination of lattice vectors**. Let's start with an arbitrary minimum (primitive) cell with vectors \(_{1},_{2},_{3}\). A set of \(SO(3)\) equivariant lattice vectors can be determined by Niggli cell reduction  as follows. The three lattice vectors \(^{}_{1},^{}_{2},^{}_{3}\) of a new primitive cell can be represented in terms of the original ones as \(^{}_{i}=k_{i,1}_{1}+k_{i,2} {}_{2}+k_{i,3}_{3},\;k_{i,1},k_{i,2},k_{i,3}\). Then, a unique and \(SO(3)\) equivariant cell can be determined by choosing three shortest non-planar vectors \(^{}_{1},^{}_{2},^{}_{3}\) that form a right-hand system using three Euclidean vector lengths and three relative angles (_i.e._ six lattice parameters) [14; 19].

**Determination of primitive unit cells**. After lattice vectors \(_{u}=[^{}_{1},^{}_{2},^{}_{3}]\) have been determined, a unique unit cell is determined as follows. For different unit cells with the same lattice vectors \(^{}_{1},^{}_{2},^{}_{3}\), they differ by the origin of the cell. We determine the origin of unit cell by: **1.** smallest atomic number; **2.** local densities of atoms in the cell that are E(3) invariant measurements defined

Figure 2: The pipeline of Mat2Seq that converts 3D crystal structures into unique crystal sequences. Mat2Seq first determines \(SO(3)\) equivariant and periodic invariant lattice vectors using Niggli cell reduction , then determines the primitive unit cell. After that, Mat2Seq converts the determined \(SO(3)\) equivariant and periodic invariant primitive cells into \(SE(3)\) and periodic invariant sequences.

by \(_{i,r}=_{j(i,r)}Z_{j}\), where \((i,r)\) denotes the neighbors of atom \(i\) within the radius \(r\), and \(Z_{j}\) denotes the atomic number of neighboring atom \(j\); and **3.** densities along three lattice vectors \(_{1}^{},_{2}^{},_{3}^{}\) that are \(SE(3)\) invariant measurements defined as the following,

\[_{i,r}^{_{1}^{}}=_{j^{_{1}^{ }}(i,r)}Z_{j},_{i,r}^{_{2}^{}}=_{j^ {_{2}^{}}(i,r)}Z_{j},_{i,r}^{_{3}^{}}=_{j ^{_{3}^{}}(i,r)}Z_{j},\] (1)

where \(^{_{1}^{}}(i,r),^{_{2}^{ }}(i,r),^{_{3}^{}}(i,r)\) denote the neighbors of atom \(i\) within the radius \(r\) along \(_{1}^{},_{2}^{},_{3}^{}\) that satisfy \(_{,j}^{x}>_{,i}^{x},_{,j}^{ y}>_{,i}^{y}\), and \(_{,j}^{z}>_{,i}^{z}\), correspondingly. Here, \(_{,j}\) denotes the fractional coordinate of atom \(j\) as follows,

\[_{j}=_{,j}^{x}_{1}^{}+_{,j}^{y}_{2}^{}+_{,j}^{z}_{3}^{}.\] (2)

After the unique atom \(i\) is chosen by **1.**, **2.**, and **3.**, the primitive unit cell is determined by moving this atom to the origin through the following transformation applied to all other fractional coordinates,

\[_{,j}^{x} =(_{,j}^{x}-_{,i}^{x})\;1,\] (3) \[_{,j}^{y} =(_{,j}^{y}-_{,i}^{y})\;1,\] (4) \[_{,j}^{z} =(_{,j}^{z}-_{,i}^{z})\;1,\] (5)

where the resultant \(_{,u}=[_{,1}^{},_{,2}^{},,_{,n}^{}]^{n 3}\), and \(_{u}=_{u}_{,u}\).

**Remarks**. By determining lattice vectors and primitive unit cells, a \(SO(3)\) equivariant and periodic invariant unit cell \((_{u},_{u},_{u})\) is determined for a given crystal material, which means after applying arbitrary \(SO(3)\) transformations \(^{3 3},||=1\) with \(^{3}\) and periodic transformations, the resultant unit cell will transform to \((_{u},_{u},_{u})\). We then demonstrate how to construct the \(SE(3)\) invariant crystal sequence representation based on \((_{u},_{u},_{u})\) in the following section.

### \(Se(3)\) invariant crystal sequence representations

Given determined \(SO(3)\) equivariant and periodic invariant unit cells \(=(_{u},_{u},_{u})\), we aim to represent them by \(SE(3)\) and periodic invariant sequences that are complete to guarantee the full reconstruction of crystal structures. As discussed in Sec. 2.2, a fundamental requirement for crystal sequence representations is uniqueness which stipulates that (1) different crystal structures must correspond to distinct sequences and (2) a given crystal should yield the same sequence representation across all possible structural descriptions \(=(,,)\). Previous works [10; 11; 12] directly use CIF files that breaks the uniqueness as shown in Figure 1 as the input sequence for LMs. Therefore, these methods require tremendous augmentation effort during the training process to make LMs aware that these different sequences refer to the same crystal structure. Additionally, due to the \(O(n^{2})\) computational cost of decoder-only language models where \(n\) is the window length, the sequence representations of crystal structures need to be efficient to support shorter window length and ease the burden of training and inference processes.

Rather than relying on CIF files, our approach extracts complete geometric information from the uniquely determined \(SO(3)\) equivariant unit cells \(=(_{u},_{u},_{u})\). We first follow CIF files and use six invariant lattice parameters including \(a=||_{1}||_{2},b=||_{2}||_{2},c=||_{3}||_{2}\) and \(,,\) that are three bond angles between \(_{1},_{2},_{3}\) to represent \(_{u}\) as invariant sequences. Subsequently, we incorporate space group information of the crystal structures to reduce sequence length, documenting the **irreducible atom sets** alongside the corresponding symmetry transformations to facilitate the recovery of inner cell structures \((_{u},_{u})\). We then represent atom \(i\) in the **irreducible atom sets** by the atom type and fractional coordinates \([Z_{i},_{,i}^{x},_{,i}^{y},_{,i}^{z}]\). It is worth noting that fractional coordinates of atom bases are invariant instead of equivariant, due to that \(=_{}\) where \(\) denotes matrix product and \(=_{}\). The unique ordering of atoms within the irreducible set is determined by their atomic numbers, the number of duplicates recoverable from each atom, and their fractional coordinates, thereby ensuring consistency in the Mat2Seq sequence representations.

Figure 3: Converting determined unit cells into invariant crystal sequences.

### Properties and proofs

**Uniqueness**. Different from previous crystal sequence representations [10; 11; 12], Mat2Seq sequence representations guarantee that all possible mathematical descriptions \(=(,,)\) for a given crystal will have a unique sequence representation and the same probability in the follow-up generative modeling process. We prove the uniqueness of Mat2Seq sequences as follows.

**Lemma 1**.: _A sequence mapping function \(f:(,,)\) is unique, if function \(f\) is periodic invariant and unit cell \(SE(3)\) invariant._

Proof.: For a given crystal structure, a variety of structural descriptions \((,,)\) can be obtained by applying \(SO(3)\) rotations \((,+b,)\) and periodic transformations \((^{},^{},^{})\)[14; 15] including (1) shifting periodic boundaries, and (2) altering periodic patterns while maintaining the same unit cell volume.

For a sequence mapping function \(f:(,,)\) that satisfies periodic invariance and unit cell \(SE(3)\) invariance, we have \(f(,,)=f(,+b, )=f(^{},^{},^{ })\) according to the definition provided in Sec. 3.1. Hence, a periodic invariant and unit cell \(SE(3)\) invariant function is naturally unique for crystal structures. 

**Lemma 2**.: _Mat2Seq \(:(,,)\) is periodic invariant and unit cell \(SE(3)\) invariant._

Proof.: To prove that Mat2Seq is periodic invariant and unit cell \(SE(3)\) invariant, we first show that the unit cell \((_{u},_{u},_{u})\) determined in Sec. 3.2 is \(SO(3)\) equivariant and periodic invariant. In other words, after applying arbitrary \(SO(3)\) transformations \(^{3 3},||=1\) with \(^{3}\) and periodic transformations, the resultant unit cell should change from \((_{u},_{u},_{u})\) to \((_{u},_{u},_{u})\), with detailed proof provided in Appendix A.1. We then prove that the obtained sequence representation is \(SE(3)\) and periodic invariant in Appendix A.1. 

**Completeness**. Crystal sequence representations need to be complete to guarantee the full reconstruction of crystal structures from sequences.

**Lemma 3**.: _Crystal structure \((,,)\) can be fully recovered from Mat2Seq sequence \(\)._

Proof.: \(\) can be directly recovered from atom types in Mat2Seq sequences, and \(\) can be recovered by three lattice lengths \(a,b,c\) and three lattice angles \(,,\). Then, fractional coordinates of all atoms in the unit cell can be fully recovered by applying recorded space group transformations \([(_{1},_{1}),,(_{s},_{s})]\) to fractional coordinates of the irreducible atom set \(_{,}\) as follows,

\[_{}=(_{,}_{1 i  s}(_{i}_{}+_{i})1)_{},\] (6)

where \(\) represents concatenation and \(()_{}\) represents the operation of removing duplicate entries. \(=_{}\) can then be fully recovered. 

**Remarks**. Based on **Lemma 1**, 2**, and **3**, Mat2Seq sequences satisfy uniqueness for crystal structures and can fully reconstruct corresponding 3D crystal structures. We also provide experimental verification on the MP20  training set for the uniqueness of Mat2Seq and previous crystal language models [10; 11; 12] in Table 1 by applying periodic transformation that shifts the periodic boundaries. The evaluation is conducted as follows: (1) for each crystal structure in the MP20 dataset, we apply a transformation that shifts the periodic boundaries, generating a different unit cell representation while keeping the crystal structure unchanged; (2) we then encode both the original and transformed structures into 1D sequence representations using different methods and compare the resulting sequences. If there is a mismatch (e.g., differences in the coordinates or atom type for the first atom), it is considered a failure; (3) finally, we compute the success rate across the entire dataset.

   Uniqueness - MP20  & CIF [10; 11] & CIF with symmetry  & Mat2Seq \\  Success rate \(\) & 0\(\%\) & 30\(\%\) & **100\(\%\)** \\   

Table 1: Uniqueness verification compared with previous crystal language models [10; 11; 12].

### Language model enabled 3D crystal structure generation

**Discretization**. To train a language model, crystal sequence representations obtained in Sec. 3.3 need to be discretized. Compositional and space group information including atom types, number of atoms in the cell, and space group symbol are discrete. For lattice parameters and fractional coordinates, we round real numbers to four decimal places to ensure consistency and efficiency following CrystalLM . We also include keywords and symbols like space_group_symbol, formula, lattice_parameters and so on in our Mat2Seq dictionary, with the full list provided in Appendix A.2.

**Training and sampling**. We enable language models to generate novel crystals using the proposed unique and complete sequence representations for 3D crystal structures. Specifically, we follow the previous work  and train a GPT  model \(M\) with parameters \(\) to capture the distribution of Mat2Seq crystal sequences, \(U\), constructed from corresponding crystal datasets with a standard next-token prediction cross-entropy loss \(\) for all elements in the sequence:

\[_{}_{u U}_{i=1}^{|u|-1}(M_{}(u_{1},u_{2},,u_{i}),u_{i+1}),\] (7)

where \(u\) represents a crystal structure within the dataset. During the sampling phase, we initiate the sequence with predetermined starting patterns, applying an autoregressive sampling technique to iteratively predict the next sequence component from the conditional model distribution \(p_{}(u_{i+1}|u_{1},u_{2},,u_{i})\) until a stop pattern or a maximum length is achieved. Consistent with the referenced work , our sampling strategy incorporates top-\(k\) and temperature control  techniques. Importantly, the choice of language model \(M\) is flexible and can be seamlessly substituted with more advanced or alternative powerful language models.

**Conditional generation.** For conditional generation, we use conditional tokens to represent desired compositions and properties. Specifically, for Mat2Seq crystal sequence representations, the compositional information is placed ahead of crystal structure information. Hence, by simply initialize sequences with desired compositions, the language model \(M\) can generate corresponding crystal structures. To target specific properties, we introduce a property token to denote the desired attribute and place these tokens at the beginning of the Mat2Seq sequences. The training and sampling processes mirror those used in unconditional generation, with the initial input being the property token that corresponds to the desired attribute.

## 4 Experimental results

In this section, we evaluate the ability of Mat2Seq to discover stable crystal structure for interested crystal systems in Sec. 4.1 and 4.2 and generate novel crystal structures satisfying desired physical properties in Sec. 4.3. We also include experimental results for random crystal generation assessing validity, stability (measured by DFT), and the ratios of stability, unique, and novel (S.U.N.) crystals in Appendix A.3.

   Model &  &  &  &  \\  & Match & RMSE & Match & RMSE & Match & RMSE & Match & RMSE \\   &  \\  CrystalLM & 46.1\% & 0.095 & 20.3\% & 0.176 & 58.7\% & 0.041 & 19.2\% & 0.111 \\ CDVAE & 45.3\% & 0.114 & 17.1\% & 0.297 & 33.9\% & 0.105 & 5.34\% & 0.211 \\ DiffCSP & **52.0\%** & **0.076** & 17.5\% & 0.276 & 51.5\% & 0.063 & 12.2\% & 0.179 \\ Mat2Seq & 50.0\% & 0.099 & **23.7\%** & **0.169** & **61.3\%** & **0.040** & **23.1\%** & **0.109** \\   &  \\  CrystalLM & 97.6\% & 0.025 & 85.2\% & 0.151 & 74.0\% & **0.035** & 33.8\% & 0.106 \\ CDVAE & 88.5\% & 0.046 & 88.4\% & 0.229 & 67.0\% & 0.103 & 20.8\% & 0.209 \\ DiffCSP & **98.6\%** & **0.013** & **88.5\%** & 0.219 & **77.9\%** & 0.049 & 34.0\% & 0.175 \\ Mat2Seq & 98.5\% & 0.023 & 86.0\% & **0.148** & 75.3\% & 0.037 & **36.4\%** & **0.088** \\   

Table 2: Comparison of Match Rate (%) and RMSE across different models and crystal datasets.

### Generating stable crystal structures for given compositions

**Baselines**. We first evaluate the effectiveness of Mat2Seq on the widely used crystal structure prediction benchmark, comparing against diffusion-based methods including CDVAE  and DiffCSP , as well as a recent language model based CrystalLM .

**Datasets**. We conduct experiments on four datasets following DiffCSP  and CrystalLM , including Perov-5, Carbon-24, MP-20, and MPTS-52. **Perov-5**[23; 24] contains 18,928 perovskite materials with similar structures and 5 atoms in unit cells. **Carbon-24** contains 10,153 carbon materials with at most 24 atoms in the unit cell. **MP-20** includes 45,231 stable inorganic materials from the Materials Project, covering the majority of experimentally-generated materials with at most 20 atoms in the unit cell. **MPTS-52** is the most challenging one with 40,476 crystals and at most 52 atoms in the unit cell.

**Experimental setup**. For crystal structure prediction, machine learning methods are trained using crystal structures and corresponding compositions in the training set. During the inference phase, compositions of crystals in the test set are provided as input to methods, and the goal is to generate stable crystal structures that match the ground truth crystal structures. To assess the quality of generated crystal structures, two metrics are used, including match rate which measures the ratio of the generated structures that match with the ground truth structure determined by Pymatgen structure matcher , and RMSE  which measures the structural differences between the ground truth and matched generated structures. A single NVIDIA A100 GPU is used for computing for this task. We directly follow DiffCSP  to split corresponding datasets into training, evaluation, and test sets. We use the same language model settings following CrystalLM  to make sure the comparison is fair. Detailed training and inference parameters are provided in Appendix A.2. We also provide additional experimental evaluations in Appendix A.3 for random crystal generation on the MP20 dataset, assessing validity, stability (measured by DFT), and the ratios of stable, unique, and novel crystals, compared with state-of-the-art methods, including FlowMM , DiffCSP , and CDVAE .

**Results**. There are several observations from the experimental results shown in Table. 2. **(1)** Compared with CrystalLM  that directly uses CIF files to describe 3D crystal structures, Mat2Seq achieves better match rate for all eight tasks, demonstrating the effectiveness of Mat2Seq crystal sequence representations beyond CIF files. **(2)** Compared with DiffCSP  that is specifically designed for this task, Mat2Seq achieves comparable results, and achieves a significantly better match rate and smaller RMSE for the most challenging MPTS-52 dataset, with a **89%** improvement in match rate for one shot generation, and a **50%** decrease in RMSE for 20 shots generation. **(3)** Mat2Seq demonstrates excellent one shot generation performances across datasets with various difficulty levels and data scales.

**Results on experimentally observed crystal structures**. Comparing with experimentally observed crystal structures is essential to demonstrate the real-world applicability of the proposed method, beyond synthetic structures generated purely from DFT calculations. The MP20 dataset test set includes 3,819 crystal structures that have been experimentally observed (match entries in the ICSD ). To assess the accuracy of Mat2Seq on this data, we conducted additional evaluations on these 3,819 structures, with the results presented in Table 4. Notably, Mat2Seq achieved a 65.2% match rate with an RMSE of 0.042 for these experimentally observed structures.

   MP-20 & number of crystals & Match Rate (\%) & RMSE \\  Mat2Seq - exp observed & 3,819 & **65.2**\% & 0.042 \\ Mat2Seq - the whole test set & 9,046 & 61.3 \% & **0.040** \\   

Table 4: Mat2Seq match rate (%) and RMSE for experimentally observed crystal structures in MP-20 test set.

   MP-20 test set & number of parameters & RMSE & 20 shots generation speed (sec./crystal) \\  CDVAE & 4.5 M & 0.103 & 37.9 s \\ DiffCSP & Similar to CDVAE & 0.049 & 7.3 s \\ Mat2Seq-small & 25 M & 0.039 & **2.1 s** \\ Mat2Seq-large & 200 M & **0.037** & 5.7 s \\   

Table 3: Efficiency and model complexity comparisons.

**Efficiency**. It is well known that language models typically have higher parameter counts and greater computational demands. To address this, we provide a comparison of efficiency in terms of parameter count and generation speed, alongside specialized crystal models such as CDVAE and DiffCSP, in Table 3. While Mat2Seq, based on large language models, does have more parameters, using similar GPU resources (as done in DiffCSP ), Mat2Seq demonstrates significantly faster generation speed. Furthermore, we show that reducing the model size by a factor of eight does not significantly affect Mat2Seq's performance and improves efficiency. In this case, the smaller model achieved an RMSE of 0.039, which is notably better than DiffCSP's RMSE of 0.049, while also being more than three times faster in the generation process.

### Ability to generalize to recently discovered crystals from literature

The promising results in crystal structure prediction shown in Sec. 4.1 have demonstrated the effectiveness of Mat2Seq crystal sequence representations. We then examine the ability of Mat2Seq with language model to discover novel crystal structures that are obtained from recent literature and are not seen during training. Specifically, we randomly choose 10 crystals from the **challenge set** to evaluate Mat2Seq's ability to discover novel crystal structures that originate from recent literature, and compare with previous CrystalLTM .

**Dataset**. For this task, we follow CrystalLTM  and train the model using crystal structures from the Materials Project , OQMD  and NOMAD , which has been optimized using DFT calculations, containing 2,047,889 crystal structures for training in total. This dataset contains around 800K unique formulas and 94 chemical element types. The evaluation is conducted with 10 recently discovered crystal structures from literature, including \(_{2}()_{12}\), \(_{2}_{2}_{9}\), \(_{2}_{3}_{8}\), \(_{6}_{23}\), \(_{8}_{3}_{14}_{35}\), \(_{4}_{2}_{6}\), \(_{2}_{2}_{6}\), \(_{2}_{4}(_{3})_{10}\), \(_{4}_{2}_{8}_{3}\), and \(_{9}_{4}_{5}\).

**Experimental setup**. We first train our model using around 2M crystal structures in the training set following CrystalLTM with broken files removed. After training, we evaluate the model's ability to generate valid crystal structures for 10 recently discovered crystal structures from literature by taking the compositional information as conditions and generating 20 structures for each composition. To compare with CrystalLTM, we directly use their pre-trained model for the same training set and generate 20 structures for each composition. We follow CrystalLTM and evaluate the validity of generated structures by whether the generated formula is consistent with the given composition, whether the space group is consistent with the structure, and whether the generated crystal has reasonable bond lengths. 4 A100 GPUs are used for computing for this task. We also provide additional experimental results in Appendix A.3, evaluating the Hit rate (i.e., whether the generated structure matches recently observed experimental crystals from the literature) and RMSE across 10 challenge crystal systems, in comparison with the previous state-of-the-art method, CrystalLTM.

Figure 4: Mat2Seq can generate recently discovered novel crystals from literature. \(_{2}_{2}_{6}\) on the left, and \(_{6}_{23}\) on the right. The structure generated by Mat2Seq for \(_{2}_{2}_{6}\) is the reflected version of the ground truth.

    & CrystalLTM & Ours \\  Validity \(\) std & 23.7\(\%\) 2.5\(\%\) & **27.3\(\%\)**1.4\(\%\) \\   

Table 5: Ability to generalize to recently discovered crystals from literature, measured by three seperate generation runs.

**Results**. As shown in Table 5, for the 20\(\)10 generated crystals, our method achieved **27.3%** validity rate for novel crystal structures from recent literature, better than CrystaLLM with 23.7%. We visualize the generation results for Eu\({}_{2}\)FeGe\({}_{2}\)OS\({}_{6}\) and Ce\({}_{6}\)Cd\({}_{23}\)Te in Figure 4 which shows Mat2Seq actually can discover novel crystals reported in recent literature with nearly identical 3D structures. It is worth noting that the structure generated by Mat2Seq for Eu\({}_{2}\)FeGe\({}_{2}\)OS\({}_{6}\) is the reflected version of the founded one, and reflected crystal structure will have the identical energy, which on the other hand demonstrating the reflection sensitivity of Mat2Seq.

### Discovering crystal structures with desired properties

**Experimental details**. We further evaluate Mat2Seq's ability to discover crystals with desired properties. Specifically, we have put 10 placeholders marked as unknown_prop before Mat2Seq crystal sequences when training our model on around 2M crystal structures. After pre-training, we fine-tune the model on JARVIS-DFT dataset  with 61,541 crystal structures and corresponding band gap values in the training set. We use intervals to tokenize band gap values, where values from 0 to 0.5 are marked as 0, values from 0.5 to 1 are marked as 1, and so on, and replace one unknown_prop token in the sequence. For future users, this design can enable the discovery of physical properties of their interest by simply replacing the unknown_prop token with corresponding properties and fine-tuning the pre-trained model from Sec. 4.2. A single A100 GPU is used for this task.

**Evaluation metrics**. We evaluate our model in two settings, including (1) generating crystals with low band gap (\(<0.5\) eV) that could potentially be used for thermoelectrics, thermophotovoltaics, infrared sensing and vision, cryogenic cooling, as well as discovering novel catalysts and topological quantum materials, and (2) generating crystals with high band gap (\(>3.0\) eV) that could potentially be used for solid-state LEDs and lasers, nonlinear optics, ferroelectrics, multiferroics, power electronics, and high-temperature applications. We measure the success rate of 500 randomly generated crystals that satisfy (1) and (2) when our model is conditioned towards generating crystals with small band gap values and large band gap values. We measure the band gap value of generated crystals using the state-of-the-art method ComFormer  for band gap prediction with mean absolute error of 0.122 eV. We also provide measurements of validity, uniqueness, and novelty for the generated crystals.

**Results**. Table 6 demonstrates Mat2Seq's ability to significantly alter the original property distribution and discover crystals towards large or small band gap values. Specifically, when conditioned towards small band gap values with interval 0 to 0.5 eV, **83.6%** generated crystals have band gap values \(<0.5\) eV, and when conditioned towards large band gap values with interval 3.5 to 4.0 eV, **90.7%** generated crystals have band gap values \(>3.0\) eV.

## 5 Conclusion, limitation, and discussion

In this work, we propose Mat2Seq, which converts 3D crystals into unique and complete 1D sequences for language model-enabled crystal generation, naturally ensuring that all equivalent crystals are considered identically probable without the need for data augmentation. Mat2Seq demonstrates promising performance in crystal structure generation and discovery, and the trained model can be used to discover crystal structures with desired properties of interest to users. The limitations of the current Mat2Seq include: (1) it cannot be directly used for other atomic systems, like molecules and proteins; (2) the extension to model disordered materials remains a challenging frontier; and (3) large-scale training with more stable crystal structures can potentially enhance the robustness and performance when more computational resources are available. Positive and negative societal impacts of discovering novel materials with desired properties may apply to this work.

   Generation Codition & band gap  0.5 eV & band gap  3.0 eV & Validity & Uniqueness & Novelty \\  Towards band gap \(\) & **83.6\(\%\)** & 12.0\(\%\) & 88.0\(\%\) & **98.0\(\%\)** & 86.2\(\%\) \\ Towards band gap \(\) & 6.4\(\%\) & **90.7\(\%\)** & **89.8\(\%\)** & 92.2\(\%\) & **98.6\(\%\)** \\   

Table 6: Ability to generate crystal structures with desired band gap properties. We measure the success rate of generating crystal structures with band gap value  0.5 eV and band gap value  3.0 eV, measured by the state-of-the-art band gap predictor ComFormer . We also evaluate the validity, uniqueness, and novelty of the generated crystals.