# LinkerNet: Fragment Poses and Linker Co-Design

with 3D Equivariant Diffusion

 Jiaqi Guan

University of Illinois Urbana-Champaign

jiaqi@illinois.edu

&Xingang Peng

Peking University

xingang.peng@gmail.com

&Peqi Jiang

Tsinghua University

jpq20@mails.tsinghua.edu.cn &Yunan Luo

Georgia Institute of Technology

yuan@gatech.edu &Jian Peng

University of Illinois Urbana-Champaign

jianpeng@illinois.edu &Jianzhu Ma

Tsinghua University

majianzhu@tsinghua.edu.cn

###### Abstract

Targeted protein degradation techniques, such as PROteolysis TArgeting Chimeras (PROTACs), have emerged as powerful tools for selectively removing disease-causing proteins. One challenging problem in this field is designing a linker to connect different molecular fragments to form a stable drug-candidate molecule. Existing models for linker design assume that the relative positions of the fragments are known, which may not be the case in real scenarios. In this work, we address a more general problem where the poses of the fragments are _unknown_ in 3D space. We develop a 3D equivariant diffusion model that jointly learns the generative process of both fragment poses and the 3D structure of the linker. By viewing fragments as rigid bodies, we design a fragment pose prediction module inspired by the Newton-Euler equations in rigid body mechanics. Empirical studies on ZINC and PROTAC-DB datasets demonstrate that our model can generate chemically valid, synthetically-accessible, and low-energy molecules under both unconstrained and constrained generation settings.

## 1 Introduction

Targeted Protein Degradation (TPD) techniques , including PROteolysis TArgeting Chimeras (PROTACs) , molecular glues , etc., are emerging powerful tools for selectively removing disease-causing proteins. These techniques typically involve multiple molecular fragments connected by a linker, with each fragment binding to a specific protein. For instance, a PROTAC consists of three components: a ligand (warhead) that targets the protein of interest, another ligand that recruits an E3 ubiquitin ligase, and a linker that connects two ligands . PROTACs induce the ubiquitination of target proteins, which is a fundamental biological process where small proteins called ubiquitins are attached to target proteins, marking them for degradation by the proteasome. Unlike traditional small molecule inhibitors that temporarily inhibit protein function by binding to their active sites, PROTAC techniques result in complete protein elimination and offer several advantages, including increased selectivity, reduced off-target effects, and the potential to target previously undruggable proteins . However, designing effective PROTACs remains a significant challenge, particularly in optimizing the linker, which is crucial in maintaining the conformational stability and other important biological properties of the entire molecule.

In recent years, computational approaches, particularly deep learning methods, have been employed for linker design to accelerate the drug discovery process . Many of these approaches utilize 3D structural information to enhance their performance. For example, Delinker  incorporates the distance and angle between anchor atoms as additional structural information to generate the 2D linker given the fragment molecular graphs. Going a step further, 3DLinker  and DiffLinker  operate directly in 3D space to process fragments and generate linkers with a conditional VAE and diffusion model, respectively. These models commonly assume that the relative position between fragments is fixed. This assumption is reasonable in traditional fragment-based drug design, where fragments are designed to bind to the same protein pocket and the binding poses are largely deterministic . However, in scenarios involving two proteins (drug target and E3 ligase in the PROTAC case), the relative position between fragments may not be readily available due to the flexibility of protein-protein binding pose, as shown in Figure 1. As a result, it becomes necessary to adjust the fragment poses dynamically during the linker design process. One potential solution is to randomly sample multiple fragment poses and design a 3D linker for each pose. The drawback of this approach is that it limits the design space for the linker by immobilizing the relative positions of the two molecular fragments. It may not be possible to find a stable linker that can connect the two molecular fragments with fixed positions due to the narrow range in which a bond can form. To the best of our knowledge, there is currently no existing computational approach that addresses this challenging 3D linker design problem in the absence of fragment relative positions.

In this work, we first address the problem of co-designing fragment poses and the 3D linker. We represent each fragment as a rigid body and its pose as the position of its center and the rotation. The linker is represented as a 3D graph, consisting of atom positions, atom types, and bond types. To

Figure 1: An example showing that the fragment poses are _not_ fixed in PROTAC design. The above sub-figures show two PROTACs, both of which have one fragment binding with the BRD4 target and the other fragment binding with the CRBN E3 ligase. The linkers differ with a ‘COC’ motif.

Figure 2: An overview of different linker design settings. (a)/(b): Previous work focuses on 2D/3D linker design with fixed fragment poses. (c): We focus on co-designing fragment poses and linker.

tackle this co-designing problem, we propose LinkerNet, a 3D equivariant diffusion model, leveraging recent advancements in equivariant diffusion models  and diffusion models on Riemann manifolds . Our proposed model can jointly learn the generative process of both fragment poses and the linker, which enables the model to find a stable linker and connect the fragments to form a low-energy conformation of the whole molecule. Moreover, we design a fragment pose prediction module inspired by the Newton-Euler equations in rigid body mechanics. This module employs neural networks to predict atomic forces, which are then used to update the fragment center positions and rotations through the aggregation of neural forces and torques. We introduce two guidance terms that restrict fragment distances and potential anchors to incorporate real-world constraints into our model. To evaluate our method, we perform comprehensive experiments on ZINC  and PROTAC-DB  datasets and demonstrate that our model can generate chemically valid, synthetically-accessible, and low-energy molecules under both unconstrained and constrained generation settings.

To summarize, our main contributions are:

* Our work presents the first computational model that abandons the unrealistic assumptions in PROTAC drug design.
* We propose a 3D equivariant diffusion model which enables the co-design of fragment poses and the 3D linker structure in a unified framework.
* We develop an effective fragment pose prediction module inspired by the Newton-Euler equations in rigid body mechanics, allowing for the accurate adjustment of fragment center positions and rotations.
* We conduct comprehensive experiments on ZINC and PROTAC-DB datasets, showcasing the superiority of our proposed model over other baseline methods in both unconstrained and constrained generation settings.

## 2 Related Work

Molecular Linker DesignMolecular linker design is a critical step in the rational compound design. SyntaLinker  operates on the SMILES representation of molecules and formulates the linker design as a sentence completion problem. The lack of 3D structural information and the drawbacks of the SMILES representation itself limits the performance of this method. DeLinker  and Develop  overcome this limitation by operating on graphs and utilizing the distance and angle between anchor atoms as the additional structural information. However, only limited structural information is used and the generation is still in 2D space. More recently, 3DLinker , DiffLinker are proposed to directly generate linkers in 3D space with conditional VAE and diffusion models, respectively. All of these models assume the fragment poses are known. However, this is not always the case, especially in the emerging Targeted Protein Degradation (TPD) techniques. Instead, our model focuses on a more general linker design problem where the fragment poses are unknown.

PROTAC Linker DesignPROteolysis TArgeting Chimeras (PROTAC) is a promising technique with many advantages over traditional small molecule inhibitors. The first proof of concept study of PROTAC was proposed in . Most PROTAC linker design strategies rely on empirical optimization of linker composition, which consists of only a few main chemical motifs [44; 32]. Currently, there are no generally accepted rules for _de novo_ PROTAC linker design.  uses deep reinforcement learning to facilitate rational PROTAC design, but it is still generating SMILES representation instead of molecules in 3D space.

Diffusion Generative ModelsDiffusion generative models [41; 42; 17] learn to denoise samples from a prior noise distribution and have achieved remarkable progress in generating images [36; 37], text [18; 2], etc. Recently, diffusion models are also applied in molecular data by considering the rotation-translation equivariance, such as molecular conformation generation , 3D molecule generation  and structure-based drug design [15; 39; 29]. In addition, diffusion models have also been extended to Riemann manifolds [8; 28], and many applications in molecular data have emerged, including conformation generation , molecular docking , antibody design  and protein-ligand binding affinity prediction . Leveraging these advances in equivariance diffusion models and diffusion models in Riemann manifolds, we propose a diffusion model for the fragment poses and linker co-design task. We inject task-specific network and sampling designs, including a physics-inspired fragment poses prediction module and the constrained linker sampling approach.

## 3 Fragment Poses and Linker Co-Design

In this section, we present LinkerNet, which co-designs fragment poses and the linker with 3D equivariant diffusion. We first define notations and this problem formally in Sec. 3.1. Then, we decompose the joint distribution as the product of positions, rotations and atom / bond types in Sec. 3.2 and show how the diffusion processes are constructed for them. In Sec. 3.3, we illustrate the equivariant network and physics-inspired prediction module for denoising fragment poses and the linker. Finally, in Sec. 3.4, we describe how our model can be applied with guided sampling in the constrained generation setting.

### Notations and Problem Definition

In our formulation, each molecular fragment is represented as a 3D graph \(_{F}=\{_{F},_{F},}_{F}\}\). We denote the number of atom features, the number of bond types and the number of fragment atoms as \(N_{a}\), \(N_{b}\) and \(N_{F}\), respectively, and then \(_{F}^{N_{F} N_{a}}\) represents one-hot atom types (including elements and atom charges), \(_{F}^{N_{F} N_{F} N_{b}}\) represents one-hot bond types (the absence of bond is treated as a special bond type), and \(}_{F}^{3N_{F}}\) is the atom coordinates in the local coordinate system (i.e., conformation). Since we assume fragments are _rigid_, \(}_{F}\) is unchanged in our setting. We use PCA to construct the local coordinate system  for robustness. However, we will see the equivariance of our model is independent of the choice of the local coordinate system (Sec. 3.3). The global pose of each fragment is determined by a rotation transformation \( SO(3)\) and a translation transformation \((3)^{3}\), i.e. \(_{F}=}_{F}+\). The linker is represented as a set of atom types, bond types and atom positions \(_{L}=\{_{L},_{L},_{L}\}\), where \(_{L}^{N_{L} N_{a}}\) denotes linker atom types, \(_{L}^{N_{L} N N_{b}}\) denotes linker bond types and \(_{L}^{3N_{L}}\) denotes linker atom coordinates in the global coordinate system. Here, \(N=N_{L}+N_{F_{1}}+N_{F_{2}}\) is the total number of atoms of two fragments and the linker.

Given two fragments \((_{F_{1}},_{F_{2}})\) whose global poses are _unknown_, our goal is to design the linker \(_{L}\) and recover the global poses of two fragments \((_{1},_{1})\) and \((_{2},_{2})\) to connect fragments with the linker to form a conformationally stable molecule \(_{M}\). Specifically, denoting the fragment rotations and translations as \(\) and \(\) separately, we aim to learn the distribution \(p_{}(,,_{L}|_{F_{1}},_{F_{2}})\) with a neural network parameterized by \(\).

### Diffusion Processes

A diffusion probabilistic model involves two Markov chains: a forward diffusion process and a reverse generative process. The diffusion process gradually injects noise into data, and the generative process

Figure 3: Overview of one denoising step of LinkerNet. An equivariant GNN is applied to update linker atom positions \(\), atom types \(\) and bond types \(\). The updated embedding and positions are then utilized by a pose prediction module to predict neural forces \(_{c}\) and torques \(_{c}\) to further update fragment poses \(\) and \(\).

learns to recover the data distribution from the noise distribution. According to the different types of variables, the joint distribution \(p_{}(,,_{L}|_{F_{1}},_ {F_{2}})\) can be further decomposed as a product of fragment / linker positions (\(_{L}\), \(\)), fragment rotations (\(\)) and linker atom / bond types (\(_{L}\), \(_{L}\)). Next, we will describe how these diffusion processes are constructed in detail.

Diffusion on PositionsDenote linker positions \(_{L}\) or fragment translations \(\) as a random variable \(\). The diffusion on \(\) involves standard Gaussian diffusion kernels and has been well-studied in . At each time step \(t\), a small Gaussian noise is added according to a Markov chain with fixed variance schedules \(_{1},,_{T}\):

\[q(_{t}|_{t-1})=(_{t};}_{t-1},_{t})\] (1)

Under this formulation, we can efficiently draw samples from the noisy data distribution \(q(_{t}|_{0})\) and compute the posterior distribution \(q(_{t-1}|_{t},_{0})\) in closed-form:

\[q(_{t}|_{0})=(_{t};_{t}}_{0},(1-_{t})), q(_{t-1} |_{t},_{0})=(_{t-1};} _{t}(_{t},_{0}),_{t}),\] (2)

where \(_{t}=1-_{t}\), \(_{t}=_{s=1}^{t}_{s}\) and \(}_{t}(_{t},_{0})= _{t-1}}_{t}}{1-_{t}}_{0}+_{ t}}(1-_{t-1})}{1-_{t}}_{t}\), \(_{t}=_{t-1}}{1-_{t}}_{t}\).

Diffusion on Fragment RotationsThe diffusion kernel on fragment rotation \(\) is \(_{SO(3)}(,^{2})\), i.e. the isotropic Gaussian on \(SO(3)\)[28; 34] parameterized by a mean rotation \(\) and scalar variance \(^{2}\). The standard \(_{SO(3)}(,^{2})\) can be sampled in an axis-angle form, with uniformly sampled axes \(}(3)\) and rotation angle \([0,]\) with density

\[f()=_{l=0}^{}(2l+1)e^{-l(l+1) ^{2}}\,.\] (3)

To sample from \(_{SO(3)}(,^{2})\), we can first sample a rotation \(=}\) and apply it to \(\) to obtain the desired sample. Similar to the Euclidean diffusion process, we can also draw samples and compute the posterior distribution at any time step in closed-form:

\[q(_{t}|_{0})=_{SO(3)}((_{t}},_{0}),1-_{t}) q(_{t-1}| _{t},_{0})=_{SO(3)}(}_{t}( _{t},_{0}),_{t}),\] (4)

where \(}_{t}(_{t},_{0})=(_{t-1}}_{t}}{1-_{t}},_{0})+ (_{t}}(1-_{t-1})}{1-_{t}},_{t})\) and \((,)=(())\) denotes the rotation scaling operation, which scales rotation matrices \(\) by converting them to values in \((3)\), multiplying by a scalar \(\), and converting them back to \(SO(3)\).

Diffusion on Atom and Bond TypesFollowing , we use categorical distributions to model discrete linker atom types \(_{L}\) and bond types \(_{L}\). Take atom types as an example (same for bond types), a uniform noise across all \(K\) categories is added according to a Markov chain during the diffusion process:

\[q(_{t}|_{t-1})=(_{t}|(1-_{t}) _{t-1}+_{t}/K).\] (5)

Similarly, we can compute \(q(_{t}|_{0})\) and \(q(_{t-1}|_{t},_{0})\) in closed-forms:

\[q(_{t}|_{0})=(_{t}|_{t} _{0}+(1-_{t})/K), q(_{t-1}| _{t},_{0})=(_{t-1}|}_{t}( _{t},_{0})),\] (6)

where \(}_{t}(_{t},_{0})=^{}/_{k=1}^{K }c_{k}^{}\) and \(^{}(_{t},_{0})=[_{t}_{t}+(1- _{t})/K][_{t-1}_{0}+(1-_{t-1})/K]\).

### Equivariant and Physics-Inspired Neural Network

The likelihood \(p_{}(,,_{L}|_{F_{1}}, _{F_{2}})\) should be invariant to the global SE(3)-transformation, which can be achieved by composing an invariant initial distribution and an equivariant transition [46; 19]. Thus, we define the distribution on the subspace \(_{i=1}^{2}_{i}=\), i.e., the center of fragment positions is zero. It is also consistent with the truth that the linker is around the center of fragments, and thus we can set the prior distribution of \(_{L}\) as a standard normal distribution. For the equivariant transition, we model the atomic interaction with a 3D Equivariant GNN \(_{}\):

\[[}_{L,0},}_{L,0},}_{L,0},}_{0},}_{0}]=_{}(_{M_{t}},t)= _{}([_{L,t},_{L,t},_{L,t},_{t}, _{t}],_{F_{1}},_{F_{2}},t).\] (7)

To obtain \(_{M_{t}}\) from \([_{t},_{t},_{t},_{t},_{t}]\) and \(\{_{F_{1}},_{F_{2}}\}\), we perform a local-to-global coordinate transformation first and compose the atoms together, i.e., \(_{F,t}=_{t}}_{F,t}+_{t}\) and \(_{M,t}=\{_{F,t},_{L,t}\}\). Next, we will elaborate on how the linker and fragment poses are denoised.

Equivariant Linker Denoising Process\(_{}\) is a \(\)-layer 3D equivariant GNN. The initial atom and bond embedding \(_{i}^{0}\) and \(_{ij}^{0}\) are obtained by two embedding layers that encode the atom and bond information. At the \(l\)-th layer, the atom embedding \(_{i}\), bond embedding \(_{ij}\) and linker atom positions \(_{i}\) are updated as follows:

\[}_{ij} =_{d}(_{ij}^{l},\|_{i}^{l}-_{j}^{l}\|)\] (8) \[_{i}^{l+1} =_{i}^{l}+_{j_{M}\{i\}}_{h} (_{i}^{l},_{j}^{l},}_{ij},t)\] (9) \[_{ij}^{l+1} =_{ij}^{l}+_{k_{M}\{i\}}_{h }(_{k}^{l},_{i}^{l},}_{ki},t)+_{k_ {M}\{j\}}_{h}(_{j}^{l},_{k}^{l},}_{jk},t)\] (10) \[_{i}^{l+1} =_{i}^{l}+_{j_{M}\{i\}}(_ {i}^{l}-_{j}^{l})_{x}(_{i}^{l+1},_{j}^{l+1},_{ij}^ {l+1},t)_{}\] (11)

where \(_{M}\) is the set of all atoms in the molecule and \(_{}\) is the linker atom mask. The final atom embedding \(_{i}^{}\) and bond embedding \(_{ij}^{}\) will be fed into two multi-layer perceptrons and softmax functions to obtain \([}_{L,0},}_{L,0}]\). In addition, they will also be used to predict the fragment poses \([},}]\) with a physics-inspired prediction module.

Physics-Inspired Fragment Pose PredictionA straightforward way to predict the global pose is by predicting an invariant pose change \((_{t 0},_{t 0})\) in the local coordinate system and applying it to the current pose \((_{t},_{t})\) in the global coordinate system, i.e. \((_{t},_{t})(_{t 0},_{t  0})=(_{t}_{t 0},_{t}+_{t} _{t 0})\). This trick has been commonly applied in protein structure prediction [26; 31]. By applying this trick in our setting, it will be applying the invariant pose change prediction from \(_{i},_{ij}\) to the current noisy rotation \(_{t}\) and translation \(_{t}\) to obtain the denoised ones \(}_{0}\) and \(}_{0}\), i.e.:

\[}_{0} =_{t}_{R}(_{i},_{j},_{ij}) }_{0} =_{t}+_{t}_{p}(_{i},_{j},_{ij})\] (12)

However, we argue that the invariant pose update limits the model's capacity since it is regardless of the geometric information of the system in the prediction phase. Considering we treat fragments as _rigid_ 3D graphs whose local coordinates will not be changed, it is natural to take inspiration from rigid body mechanics to predict their poses.

The Newton-Euler equations describe a rigid body's combined translational and rotational dynamics. In the Center of Mass (CoM) frame, it can be expressed as the following matrix form:

\[\\ =m&0\\ 0&_{c}d/dt\\ d/dt+0\\ _{c}\] (13)

where \(\) and \(\) are the total force and torque acting on CoM, v and \(\) are the velocity of CoM and the angular velocity around CoM, \(m\) and \(_{c}\) is the mass and inertia matrix of the rigid body, which are constant for a given rigid body.

In our fragment pose prediction module, the outputs of the neural network act as the forces \(_{i}\) on each fragment atom \(i\), with which we can compute the total force \(\) and torque \(\) for each fragment:

\[_{i} =_{j_{F_{c}}}(_{i}-_{j})_{f}( _{i},_{j},_{ij}\|_{i}-_{j}\|)\] (14) \[_{c} =_{i_{F_{c}}}_{i},_{c}=_ {i_{F_{c}}}(_{i}-_{c})_{i}\] (15)

where \(c=1\) or \(2\), corresponding to two fragments.

We assume the system is stationary at each discrete time step, i.e. \(=0\) and \(=0\). Thus, the Newton-Euler equations 13 can be simplified as \(=_{c}}{dt}\) and \(=m}{dt}\). For a short enough time period \( t\), we have the velocity and angular velocity of the fragment as \(=_{c}^{-1}_{c} t\) and \(= t\). Assuming each atom in the fragment has the unit mass and absorbing the time period \( t\) into \(_{c}\) and \(_{c}\), the fragment pose will be updated as follows:

\[}_{c,0} =_{t}+_{F_{c}}|}_{c} }_{c,0} =R_{}(_{c}^{-1}_{c})_{t}\] (16)where \(|_{F_{c}}|\) denotes the number of atoms in \(F_{c}\) and \(R_{}\) denotes the operation of converting a vector in \((3)\) to a rotation matrix in \(SO(3)\) (See Appendix for details).

It can be seen that the predicted force and torque take advantage of the geometric information and are equivariant to the global rigid transformation. Moreover, we also show that the predicted fragment poses are equivariant to the global rigid transformation and are independent of the choices of local coordinate systems. The final training loss is the weighted sum of MSE loss of linker atom positions and fragment center positions, a discrepancy loss of rotation matrix, and KL-divergence of linker atom types and bond types. Please see the proof, more training and modeling details, and the complete training/sampling algorithm in Appendix.

### Constrained Generation with Guided Sampling

The LinkerNet we introduced so far is applicable in the case where the fragment poses are fully unknown. However, in real scenarios, we have some prior knowledge, such as the fragment distance should be in a reasonable range, the anchors (the atom on the fragment to connect with the linker) should be selected from a candidate set, etc. To incorporate these constraints, we leverage the idea of classifier guidance  to perform guided sampling. In our formulated problem, for a condition \(y\), the diffusion score can be modified as:

\[ p(_{M_{t}}|y)= p(_{M_{t}})+  p(y|_{M_{t}}).\] (17)

For the fragment distance constraint, we assume the expected distance range is \([d_{},d_{}]\), then we have the following guidance term:

\[-_{}(\|_{1}-_{2}\|-d_{},0)+(d_{}- \|_{1}-_{2}\|,0).\] (18)

To generate a complete and valid molecule, at least one atom from the candidate anchor set should form a bond with one linker atom, and the atoms outside the anchor set should not form bonds with any linker atoms. These principles can be formulated as the following anchor proximity guidance:

\[-_{}(d_{a}-r_{},0)+(r_{}-d_{a},0)+(r_{ }-d_{na},0).\] (19)

where \(\) is the candidate anchor set, \(d_{a}=_{i_{_{L}},j}\|_{i}- {x}_{j}\|\) and \(d_{na}=_{i_{_{L}},j_{_{F }}}\|_{i}-_{j}\|\). \(r_{}\) and \(r_{}\) denote the minimum and maximum of a bond length, which are set to \(1.2\)A and \(1.9\)A in practice. Besides the soft constraint on anchor proximity, we can also set a hard constraint by applying a bond mask during the sampling phase, i.e. we adopt \(_{L}^{N_{L}|| N_{b}}\) instead of \(^{N_{L} N N_{b}}\)

## 4 Experiments

### Setup

We mainly conduct experiments in two settings: _unconstrained_ generation and _constrained_ generation. In the unconstrained generation setting, only 3D fragment graphs \(_{F_{1}},_{F_{2}}\) are known, and the goal is to validate whether the model can co-design linker and fragment poses to generate molecules \(_{M}\) with low-energy and other desired properties. In the constrained generation setting, the candidate anchor set \(\) on each fragment is also known besides \(_{F_{1}},_{F_{2}}\), and we set a fragment center distance constraint. The goal is to validate whether the model can perform well in a more realistic scenario. We describe the general setting about data, baselines, and evaluation metrics as follows and the detailed task-specific settings in the corresponding subsections.

DataWe use a subset of ZINC  for the unconstrained generation. Following [22; 20; 21], the reference conformation for each molecule is obtained by running 20 times MMFF  optimization using RDKit  and selecting the one with lowest energy. We use the same procedure as  to create fragments-linker pairs and randomly split the dataset, which results in a training/validation/test set with 438,610 / 400 / 400 examples. For the constrained generation, we use PROTAC-DB , a database collecting PROTACs from the literature or calculated by programs. The same procedure is applied to obtain reference conformations and create data pairs. We select 10 different warheads as the test set (43 examples) and the remaining as the training set (992 examples).

BaselinesFor benchmarking, we compare our model with three baselines: DeLinker , 3DLinker  and DiffLinker . DeLinker is a 2D graph generative model, while 3DLinker and DiffLinker are 3D generative models with VAE and diffusion models, respectively. Since there is no existing generative model to perform the fragment poses and linker co-design, we randomly sample fragment rotations and add noise to fragment center positions. Then, the noisy fragments are fed to these models to generate linkers.

Evaluation MetricsFor ZINC and PROTAC-DB dataset, we generate 250 and 100 samples per fragment pair respectively for further evaluation. We evaluate the generated molecules on both 2D graphs and 3D conformations. For 2D metrics, we report the standard ones including validity, uniqueness and novelty , the recovery rate (the percentage of generated molecules that can successfully recover the reference molecules), and property-related metrics drug-likeness (QED)  and synthetic accessibility (SA) . To evaluate 3D conformations, we first perform MMFF  optimization, and report the average minimum energy of generated molecules per fragment pair _before_ optimization as \(E_{}\), and the average Root Mean Square Deviation (RMSD) of the molecule coordinates before and after optimization as RMSD. \(E_{}\) indicates the best quality of the overall generated conformations and RMSD indicates the gap between generated conformations and the best possible ones. To further investigate the model's performance in generating linker and fragment poses respectively, we perform another constrained MMFF optimization by fixing the atoms in fragments. Then, we report the average median energy _after_ optimization as \(E_{L}\) and the average median energy difference before and after optimization as \( E_{L}\). Since fragment atoms are fixed, the optimization will fix the unrealistic conformation inside the linker and thus a lower \(E_{L}\) indicates the better fragment poses, and a lower \( E_{L}\) means less adjustment on linker atoms and thus indicates the better linker conformation.

### Unconstrained Generation Results

For baseline models, we randomly sample fragment rotations and add a Gaussian noise on the fragment distance (stddev = 0.1 distance). We filter out clashing initial fragments and feed each baseline with 250 valid initial fragment poses per fragment pair. We fix the number of linker atoms to be the same as the reference molecule. For DeLinker and 3DLinker baselines, anchor atoms are also provided to utilize their published models while they are unavailable for DiffLinker and our model.

From Table 1, we can first see that our model can generate much more valid molecules compared to other 3D linker generative models (3DLinker and DiffLinker). Although our model's uniqueness and novelty scores are lower than other baselines, we believe that is because the chemical linker design space to form a low-energy molecule is limited. Our model achieves a recovery rate of \(24.5\%\). In contrast, DiffLinker achieves zero recovery rate since it can not co-design fragment poses, while DeLinker / 3DLinker utilizes the anchor information and thus achieve a higher recovery rate. In terms of QED and SA, our model clearly outperforms other models, which indicates our generated linkers are more realistic. For 3D-related evaluation metrics, our model can achieve much lower energy and RMSD compared to other baselines, which justifies the effectiveness of our modeling approach.

Since we argue that our physics-inspired fragment pose prediction module is more effective in Sec. 3.3, we conduct an ablation study (See Table 2) on it to further investigate the role of each part. We take equation 12 as the counterpart of the Newton-Euler equations-based update formula (equation 16). Firstly, we find the fragment translation prediction based on Newton equation is more effective than predicting the change of translation in the local frame. The latter approach will result in severe drift (the fragments are far away from each other) during the sampling phase, as reflected in

  Method & Valid.\% & Unique.\% & Novel.\% & Rec.\% & QED (\(\)) & SA (\(\)) & \(E_{}\) (\(\)) & RMSD (\(\)) & \(E_{L}\) (\(\)) & \( E_{L}\) (\(\)) \\  DeLinker & \(\) & \(\) & \(\) & \(\) & \(\) & \(\) & - & - & - & - & - \\ 3DLinker & \(40.3\) & \(53.6\) & \(47.4\) & \(43.2\) & \(\) & \(30.8\) & ++ & 2.42 \(\) & 5178.2 \(\) & ++ \\ DiffLinker & \(48.7\) & \(\) & \(\) & 0.0 & 0.59 \(\) & 7.25 \(\) & 179.2 \(\) & 1.92 \(\) & 216.8 \(\) & 93.3 \(\) \\ Ours & \(83.1\) & \(14.8\) & \(11.4\) & \(24.4\) & \(\) & \(\) & \(\) & \(\) & \(\) & \(\) \\  

Table 1: Unconstrained generation results on ZINC. (*) denotes additional anchor information is utilized and thus scores are not directly comparable. (++) denotes a huge number (>100k in energy). The mean and standard deviation values are reported by running the sampling procedure 3 times with different random seeds.

the huge energy and RMSD in (a) and (c), even though the model can learn to connect one linker atom with each fragment to achieve reasonable scores in 2D metrics such as validity and recovery rate. Secondly, we can see the fragment rotation prediction based on Euler equation (d) can achieve lower energy and RMSD compared to its counterpart (b), indicating our design can boost the model's capacity and make more accurate rotation predictions. We further plot the rotation training loss in Fig. 4, which confirms our argument since the rotation loss decreases as expected with Euler-equation rotation prediction while it almost remains unchanged with the counterpart design.

### Constrained Generation Results

In the constrained generation setting, we mimic the real scenario in the PROTAC linker design. Since two fragments also need to bind the protein of interest and E3 ligase separately, the possible anchor can only be chosen from a subset of the fragment atoms. In addition, the linker length has a critical effect on the PROTAC's selectivity, and we usually need to restrict the range of fragment distance. To include these constraints, we take the atoms within two hops of the real anchor atom as the imaginary candidate anchor atom set for each fragment. We set the fragment center distance constraint as \([0.8d,1.2d]\), where \(d\) is the fragment distance in the reference molecule.

We generate samples with guided sampling and hard bond mask as described in 3.4. For baselines, the fragment distance is uniformly sampled within the constraint, and random anchors from candidate anchor sets are provided. The number of linker atoms is sampled according to the approach proposed in their original paper. Since the public pretrained 3DLinker model can not support the linker generation to large molecular graphs such as PROTACs, we do not include it for comparison.

Table 3 shows the constrained generation results on PROTAC-DB. Our model achieves a higher validity and recovery rate, and outperforms other baselines in three of 3D metrics (\(E_{}\), RMSD and \(E_{L}\)) with a clear margin. DiffLinker has a lower energy difference before and after linker force filed optimization than ours, which indicates molecules generated by DiffLinker has better geometry inside the linker. It makes sense since DiffLinker focuses on learning the linker distribution only, while our model is trained on a more complex fragment poses and linker co-design task.

    &  &  &  & \) (\(\))} &  & \) (\(\))} & \) (\(\))} \\  & & & & & & & & & \\  (a) & & & 81.1 & 47.3 & **++** & **++** & **++** & **++** \\ (b) & ✓ & & **97.2** & **70.8** & 180.4 & 2.22 & 2052.2 & **++** \\ (c) & & ✓ & 81.6 & 20.3 & **++** & **++** & **++** & **++** \\ (d) & ✓ & ✓ & 83.1 & 24.5 & **32.2** & **1.44** & **49.3** & **67.1** \\   

Table 2: Ablation study on the fragment pose prediction module.

Figure 4: Rotation loss.

Figure 5: Visualization of reference molecules and molecules generated by LinkerNet and DiffLinker.

To justify the effect of each guidance term, we conduct another ablation study as shown in Tab. 4. Without guided sampling, the model will generate unrealistic 3D linkers for some fragment pairs and result in a very large average energy \(E_{}\) and \( E_{L}\). Anchor proximity guidance (b) and fragment distance (c) are both of benefit for meeting the constraints and achieving lower energy and RMSD. The combination of them (d) achieves the best result.

## 5 Conclusion

We introduce LinkerNet for 3D fragment poses and linker co-design, the first work which addresses this more general and challenging linker design task. The limitation of our model is that it does not directly incorporate fragment rotation constraints or explicitly consider the protein context in modeling. These aspects could be valuable directions for future research.

Reproducibility StatementsThe model implementation, experimental data and model checkpoints can be found here: https://github.com/guanjq/LinkerNet

AcknowledgementWe thank all the reviewers for their feedbacks through out the review cycles of the manuscript. This work was supported by the National Key Research and Development Program of China grants 2022YFF1203100 and 2021YFF1201600

    &  &  & \) (\(\))} &  & \) (\(\))} & \) (\(\))} \\  & & & & & & & & \\  (a) & & & 45.9 & 25.2 & **++** & 1.66 & 124.3 & **++** \\ (b) & ✓ & & 53.2 & 25.4 & 1249.7 & 1.61 & 432.5 & 1495.0 \\ (c) & & ✓ & 49.3 & **53.7** & 208.4 & 1.56 & 45.4 & 4971.0 \\ (d) & ✓ & ✓ & **55.5** & 52.6 & **115.6** & **1.54** & **18.2** & **610.7** \\   

Table 4: Ablation study on the guided sampling.

   Method & Valid,\% & Unique,\% & Novel,\% & Rec,\% & \(E_{}\) (\(\)) & RMSD (\(\)) & \(E_{L}\) (\(\)) & \( E_{L}\) (\(\)) \\  DelLinker & \(42.8 0.4\) & \(89.9 2.8\) & \(99.0 0.1\) & \(0.0 0.0\) & - & - & - & - \\ DiffLinker & \(24.0 0.1\) & \(\) & \(\) & \(0.0 0.0\) & 416.2 \(\) 13.4 & 2.44 \(\) 0.05 & 501.0 \(\) 17.6 & \(\) \\ Ours & \(\) & \(47.9 11.6\) & \(41.4 4.9\) & \(\) & \(\) & \(\) & \(\) & 500.0 \(\) 99.1 \\   

Table 3: Constrained generation results on PROTAC-DB. The mean and standard deviation values are reported by running the sampling procedure 3 times with different random seeds.