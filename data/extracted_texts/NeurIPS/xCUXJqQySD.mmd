# Med-Real2Sim: Non-Invasive Medical Digital Twins using Physics-Informed Self-Supervised Learning

Keying Kuang

UC Berkeley

& Frances Dean

UC Berkeley & UCSF

& Jack B. Jedlicki

University of Barcelona

& David Ouyang

Cedars Sinai

& Anthony Philippakis

Google Ventures

& David Sontag

MIT

& Ahmed Alaa

UC Berkeley & UCSF

###### Abstract

A digital twin is a virtual replica of a real-world physical phenomena that uses mathematical modeling to characterize and simulate its defining features. By constructing digital twins for disease processes, we can perform in-silico simulations that mimic patients' health conditions and counterfactual outcomes under hypothetical interventions in a virtual setting. This eliminates the need for invasive procedures or uncertain treatment decisions. In this paper, we propose a method to identify digital twin model parameters using only noninvasive patient health data. We approach the digital twin modeling as a _composite inverse problem_, and observe that its structure resembles pretraining and finetuning in self-supervised learning (SSL). Leveraging this, we introduce a _physics-informed SSL_ algorithm that initially pretrains a neural network on the pretext task of learning a differentiable simulator of a physiological process. Subsequently, the model is trained to reconstruct physiological measurements from noninvasive modalities while being constrained by the physical equations learned in pretraining. We apply our method to identify digital twins of cardiac hemodynamics using noninvasive echocardiogram videos, and demonstrate its utility in unsupervised disease detection and in-silico clinical trials.

## 1 Introduction

With increasing health data availability, there is excitement about refining physics-based models of human body systems to be patient specific, as personalized physical models can provide the basis for in-silico experiments and timely diagnosis [27; 31; 55; 25]. This personalized vision of healthcare has given rise to virtual patients constructed with data-tuned models, known as _digital twins_. Originally an engineering concept, digital twins have recently been realized as a resource in healthcare [6; 4]. The concept combines data-driven approaches with mechanistic or simulation techniques, serving as a bidirectional map between real data and simulations. Medical digital twins have been applied and developed broadly in applications ranging from cellular mechanics  to the development of whole body and human digital twins [50; 76], with aims ranging from tailoring cardiovascular interventions  to agent-based trauma care management systems . Both academic and industry efforts are prolific with digital twins having been developed for various medical problems [9; 69; 74; 13; 22; 70].

In this paper, we propose a framework for identifying patient-level digital twins using noninvasive medical images. We focus on scenarios where identifying a patient's digital twin from noninvasive data allows us to simulate other physiological parameters that typically require invasive measurement, such as through catheterization. Such an approach assumes that there is a mapping from rich non-invasive imaging data to patient-specific mechanistic models of physiology; such a mapping is not known to scientists humans but can be learned from data. This hypothesis is supported by previous experimental work [2; 64; 43]. However, the challenge lies in the absence of datasets containing bothnoninvasive data and the corresponding parameters of the underlying physics-based physiological model, hence the problem cannot be solved using standard supervised learning. To this end, we propose a new class of physics-informed neural networks (PINNs) [(60)] to incorporate inductive biases informed by mechanistic models of patient physiology into neural network architectures.

**Summary of contributions.** We study obtaining latent parameters of a physics-based model from image measurements directly as an inverse problem. Learning patient specific parameters for a physics-based model from a complete description of patient physical states and a known forward model is an inverse problem. This task can be modeled using, for example, a PINN approach [(71; 39; 29)]. The process of obtaining patient physical states from non-invasive medical imaging is a second inverse problem with an _unknown_ forward model. Obtaining patient specific latent parameters from non-invasive medical imaging directly combines these two inverse problems and could be modeled by learning the unknown process components. Large numbers of labeled data pairs of images and parameters for the full inverse task would need to be obtained from invasive procedures to use supervised learning. Instead, we propose a training approach that structurally resembles self-supervised learning (SSL), and leverages labeled data pairs of images and non-invasively measurable patient physical states. We first train a neural network using supervised learning with _synthetic_ data to approximate the forward physics-based model as a pre-text task. We then freeze this network to fine-tune the learning of a solution to the composite inverse problem from the labeled measurable data pairs. Our methods are then extendable to include exogenous intervention parameters for the development of in-silico experiments. We call this framework "Med-Real2Sim" since it learns virtual simulators of patient physiology on the basis of real (noninvasive) data.

We apply our methodology in the setting of predicting patient specific cardiac pressure-volume loops from echocardiography. The relationship between left-ventricle pressure and volume is an important description of cardiac function [(36)]. Pressure-volume catheter measurements are highly invasive, challenging their routine clinical use [(8; 1; 77)]. Cardiac ejection fraction, the ratio between left-ventricular stroke volume and end-diastolic volume, while more routinely measured as a proxy for cardiac function, does not take into account cardiac pressure, preventing diagnosis of many severe cardiac conditions and providing motivation to develop digital twins for pressure-volume relations [(80; 45; 59)]. Cardiovascular pressure and volume are commonly modeled using hydraulic analogy models, representing the hydraulic system by electronic circuits, characterized by lumped parameters corresponding to system attributes. Systems of differential equations describe the relationships between circuit parameters and volume and pressure states. A model developed in [(66)] relates left-ventricular pressure and volume with and without the addition of a left-ventricular assistance device (LVAD). We train a neural network to learn to map between parameters and solution states of this model and use this learning to fine-tune a convolutional neural network that learns patient specific model parameters using echocardiography frames.

## 2 Method

### Problem Setup

We consider a physics-based model \(:\) of a physiological process which maps a set of parameters \(\) to a set of states \(\). The parameters \(\) describe the physiological process in an individual patient; each patient \(i\) is associated with a patient-specific parameter set \(_{i}\) and physical states \(_{i}\). We are interested in a setup where the complete set of parameters and states can only be measured _invasively_, e.g., through a catheterization procedure. We conceptualize the physics-based model \((_{i})\) as the "Digital Twin" of patient \(i\). That is, if we have oracle access to the parameters \(_{i}\) of patient \(i\), then we can simulate their physiological states through the following _forward_ process:

\[=().\] (1)

The model \(\) is assumed to be known and would typically be defined by a system of differential equations written \(f_{}()=0\) with a physically interpretable parameter set \(\). One can use numerical

Figure 1: **Digital twins for cardiac hemodynamics. Left: Illustration of the cardiovascular system. Right: Digital twin models of cardiac hemodynamics based on hydraulic or electric representations.**

methods to solve \(f_{}()=0\) for \(\) and construct the solution \((_{i})\) for each patient parameter set \(_{i}\) but a closed form solution to define the map \(\) may not exist even though the model is known, such as in the case where \(f_{}=0\) has no closed form solution. The level of granularity in simulating the (true) physiological process depends on the fidelity of the physics-based model \(\).

In addition to modeling the natural state of the physiological process, we also consider physics-based models of clinical interventions (e.g., medical devices). To model an interventional process, we consider an augmented version of the physics-based model \(}:\), which maps the _endogenous_ parameters \(\) of the patient and an _exogenous_ intervention \(u\) to a physiological state \(\). The augmented model describes how the intervention \(u\) alters the physiological states of a patient with parameters \(\)--in the causal inference literature, this class of models is known as structural causal models (SCMs) [(57)].

To identify the model \(()\) traditionally and simulate the states \(\), one would need to conduct a number of invasive procedures for each patient. Here, we assume that we have access to a measurement \(_{i}\) for each patient \(i\), which reflects some aspects of the underlying physiological process. We assume that \(\) is acquired through a _non-invasive_ procedure that might be conducted routinely in clinical practice (e.g., an electrocardiogram). The relationship between the physiological state \(\) and the non-invasive measurement \(\) is given by

\[=().\] (2)

Thus, by combining (1) and (2), we arrive at the following relation between the parameters of the physics-based model and the non-invasive measurements:

\[=}_{}}_{}()=().\] (3)

That is, the relation between the non-invasive measurements and the physical model parameters is a composition of two functions; an _unknown_ map \(\) that describes the relation between the physiological states and the observed measurements (e.g., the relation between pixels in an imaging modality and underlying health states), and a _known_ mathematical model \(\) that captures the relation between the physiological states and _unknown_ parameters \(\). **Our goal** is to develop a learning algorithm to identify the digital twin \((_{i})\) for patient \(i\) given their non-invasive measurement \(_{i}\).

**Digital Twin Modeling as an Inverse Problem.** Note that obtaining patient-specific parameters \(_{i}\) from physical states \(_{i}\) amounts to solving the following inverse problem:

\[=^{-1}().\] (4)

However, we do not directly observe the state \(\), but rather a measurement \(\) obtained by passing \(\) through the unknown forward model \(\). Thus, obtaining the physical parameters from \(\) entails solving the composite inverse problem given by:

\[=^{-1}()=^{-1}^{-1}( ).\] (5)

Solving this problem entails two challenges. First, we do not know the forward model \(\). Second, we cannot directly learn the inverse map \(^{-1}\) using supervised learning since this requires access to a labeled dataset \(\{(_{i},_{i})\}_{i}\). Obtaining such a dataset would require conducting a large number of invasive procedures, which we seek to avoid.

An alternative way to learn the inverse map \(^{-1}\) is to break down the composite inverse problem in (5) into separate inverse problems, and only learn the inverse of the unknown map \(^{-1}\) using examples of the form \(\{(_{i},_{i})\}_{i}\) by fixing the map \(\). If we can construct a mapping representative of \(\) from any patient parameter set \(\) to state \(\), then as we can write \(^{-1}\) as follows:

\[^{-1}:_{^{-1}}_{ }\] (6)

we can learn \(^{-1}\) using training samples which only train \(^{-1}\).

As we will ultimately use supervised methods and gradient descent to learn Eq. (6), we need a method for fixing \(\) that allows for mapping any arbitrary parameter set \(\) to corresponding state \(\). There are several methods in the literature for solving the forward dynamics of \(\) that we might think of to construct this mapping. These include physics-informed neural networks (PINNs) [(60)], which train a network to approximate the solution \(_{i}\) to \(f_{_{i}}(_{i})=0\) thereby solving \((_{i})\) for a fixed patient parameter set \(_{i}\). Traditional PINNs learn the function \(_{i}\) by incorporating the differential equation \(f_{_{i}}=0\) as a soft-constraint in the network's training loss alongside a data loss. In the setting of a ordinary differential equations, Neural ODEs (10) train a network to learn the differential equation operator \(f_{_{i}}\) on the states \(_{i}\) to solve for \(_{i}=(_{i})\) using differentiable ODE solvers. These methods can learn \((_{i})\) for a fixed patient parameter set \(_{i}\) and can be compared to the use of a numerical differential equation solvers.

These existent approaches for solving \(\), however, only give the states \(\) for a single patient at a time. To learn \(^{-1}\) by training a network _through_ the map \(\), we need a method that approximates the _map_ as otherwise, we would need to train infinitely many separate PINNs or Neural ODEs to cover the entirety of a plausible parameter range potentially traversed in supervised learning of (6).

**Non-Invasive Data Acquisition.** While we do not have direct access to the patient physiological state \(_{i}\) to train a model to learn \(^{-1}\), the noninvasive observation \(_{i}\) typically measures physiological quantities that can also be derived from the true state \(_{i}\). We assume that \(}\) is a physiological variable that can be derived from both \(\) and \(\), i.e.,

\[}=m()=g(),\] (7)

where \(m(.)\) is a known function and \(g(.)\) is a labeling procedure, typically conducted manually by a physician or automatically through a built-in algorithm in the data acquisition device. This physiological variable represents a quantity of interest assessed by the noninvasive modality (e.g., breast density in mammography, blood pumping efficiency in ultrasound). These variables establish a connection between the true state \(\) and the observation \(\), as they can be both simulated from the physical model and measured based on \(\).

Given the setup above, our digital twin modeling problem can be formulated as follows. Given a dataset of noninvasive measurements for \(n\) patients, \(=\{_{i}\}_{i=1}^{n}\), and a physiological variable of interest \(}_{i}=m(_{i})=g(_{i})\), our goal is to train a model that can identify the underlying physics-based twin \((_{n+1})\) for a new patient \(n+1\) based solely on their corresponding noninvasive measurement \(_{n+1}\). We seek to do this by fixing \(\) and learning \(^{-1}\) from the data \(=\{(_{i},}_{i})\}_{i=1}^{n}\).

### Physics-Informed Self-Supervised Learning

Given the training dataset \(=\{(_{i},}_{i})\}_{i=1}^{n}\), a typical supervised learning task is to train a model to predict the physiological variable \(}_{i}\) on the basis of the noninvasive observation \(_{i}\) via standard empirical risk minimization (ERM):

\[=_{}_{i=1}^{n}(f(_ {i}),}_{i}).\] (8)

The motivation for training the model \(\) is usually to automate the collection of physiological variables from medical images in a clinical workflow (68). These models follow a fully data-driven approach and do not incorporate our knowledge of how the physiological processes being measured function on the biological or physical levels. One could think of the supervised model \(\) as a data-driven model of the function \(g(.)\) in (7).

Recall that our goal is to recover the latent physical parameters \(\) that underlie the physiological processes that generated the observation \(\). If we had oracle access to a dataset of the form \(^{*}=\{(_{i},_{i})\}_{i=1}^{n}\), then a supervised solution to identifying the digital twin would be:

\[=_{}_{i=1}^{n}(f(_ {i}),_{i}).\] (9)

The solution to (9) provides an approximate solution to the inverse problem in (5). As we lack access to \(^{*}\), we can only learn the solution to (5) using the observed dataset \(\). To this end, we propose a two-step approach for learning the parameters \(\) from \(\), leveraging the structural similarity between the composite inverse problem in (5) and the pretraining/finetuning paradigm in self-supervised learning (SSL). An illustration of the two steps is provided in Figure 2(a).

**Step 1: Physics-Informed Pretext Task.** In this step, we pretrain a neural network to imitate the forward dynamics of the physics-based model, i.e., \(=()\). We do so by first sampling \(\) synthetic training examples from the physics-based forward dynamics as follows:

\[_{j}(),\,}_{j}= (_{j}),\,1 j.\] (10)We denote this synthetic dataset by \(}=\{(_{j},}_{j})\}_{j}\). Next, we use this dataset to train a feed forward neural network on the _pretext_ task of predicting the patient physiological states from the physical parameters using ERM as follows:

\[_{}=_{}_{j=1}^{n}( (_{j}),}_{j}).\] (11)

This training process distills the true physics-based model, \(()\), into the weights of a neural network \(_{}\). That is, the forward pass of the network will emulate the forward dynamics of the physiological process, i.e., \(_{}()\).

**Step 2: Physics-Guided Finetuning.** Given the observed dataset \(=\{(_{i},}_{i})\}_{i}\), we train another model to predict the physical parameters \(\) from the observed measurements \(\) using the loss function

\[_{}=_{}_{i=1}^{n}(m( _{}(_{i})),}_{i }).\] (12)

Here, the model pretrained on synthetic data from the physical simulator, \(_{}\), is frozen and only the model \(_{}\) is finetuned using real data on \(\) and \(}\). The neural network trained in Step 2, \(_{}\), represents an approximate solution to the composite inverse problem in (3), i.e., \(_{}(.)^{-1}(.)\). For a new patient \(n+1\), we discard the pretrained model \(_{}\), and use the model \(_{}\) to predict the patient's digital twin based on their noninvasive measurement \(_{n+1}\) as follows:

\[_{n+1}=_{}(_{n+1}),\ }_{n+1}=(_{n+1}).\] (13)

**Interpretation of Physics-Informed SSL.** Our proposed algorithm structurally resembles the SSL paradigm, where, akin to SSL, we decompose our model into a "backbone" architecture and a task-specific "head" (47). However, there are fundamental conceptual differences between standard SSL approaches and ours. In standard SSL, the backbone is a high-capacity model pretrained on a pretext task using unlabeled data to derive a general-purpose representation transferable to many downstream tasks, while the low-capacity head is finetuned for the specific task. In our physics-informed approach, SSL serves to constrain rather than enhance flexibility. We first pretrain the low-capacity head to distill the laws of physics, and then finetune the high-capacity backbone model to learn a mapping that aligns with the frozen head to produce the observed physiological variables \(\) while respecting the physical laws. In doing so, we force the backbone model to learn a mapping from the measurement \(\) to the physical parameters \(\).

The concept of distilling a physics-based dynamic model into a data-driven one draws from engineering methodologies that develop surrogate models to simplify computational complexity using simulated data (e.g., (58)). This data-driven approach mirrors other supervised learning generative strategies for solving inverse problems or system identification with known dynamics in control theory [(51; 78)]. Importantly, physics-informed SSL scales efficiently with increasingly complex and higher fidelity physical models, as its computational requirements involve one offline process (Eq. (10) and (11)) once the synthetic data is acquired.

## 3 Digital Twins for Cardiovascular Hemodynamics

We apply our physics-informed SSL method to perform patient-specific Pressure-Volume (PV) loop analysis in cardiology using echocardiography (cardiac ultrasound). Left ventricular (LV) PV loops illustrate the LV pressure against LV volume at multiple time points during a single cardiac cycle, providing a comprehensive view of a patient's cardiac function and encoding various hemodynamic parameters like stroke volume, cardiac output, ejection fraction, myocardial contractility, etc., which can be used to diagnose cardiovascular diseases [(7)]. Traditionally, a full characterization of a PV loop requires an invasive PV loop catheterization procedure [(35)]. Our objective is to utilize a noninvasive modality (i.e., echocardiography) to identify a digital twin for each patient, allowing us to simulate their individualized PV loops.

**Physics-based model.** We utilized a lumped-parameter circuit model of cardiac hemodynamics (i.e., blood flow), also known as the Windkessel model [(79)], as our underlying physical model \(()\). Lumped parameter models are based on the analogy between blood flow in arterial systems and the flow of electric current in a circuit (Figure 1). The model comprises interconnected compartments that are equivalent to elements of an electric circuit. Resistances represent the resistance of blood flow within the blood vessels, accounting for pressure energy losses in the system; capacitors represent the amount of stored stressed blood; diodes describe mitral and aortic valves, and inductances describe the inertial effects due to blood acceleration [(83)]. The blood flow within the system follows the standard Kirchoff's voltage and current laws. A patient's digital twin is represented by an electric circuit with a specific parameter instance \(\), where \(\) corresponds to the components of the electric circuit. The patient's physiological state \(\) corresponds to circuit currents and voltages (i.e., blood flow and pressures), which enables simulation of the patient's PV loop in any local heart structure. In this study, we adopt the five-state electric circuit model from [(66)], illustrated in Figure 2(b).

The cardiac LV pressure \(P_{LV}(t)\) and LV volume \(V_{LV}(t)\) are related by the elastance function, \(E(t)=P_{LV}(t)/(V_{LV}(t)-V_{d}),\) which is modeled using a closed form in Eq. (15) in the Appendix. Evolution of \(\) over time \(t\) is governed by a system of ODEs derived from current conservation laws (Appendix Eq. (20)). The model is parameterized by a vector \(\) corresponding to bounds on the elastance, circuit resistance, capacitance, inductance and initial states (see Appendix A.2). Given the patient-specific parameters \(_{i}\) for the ODE system and elastance function governing cardiac dynamics, we have a unique solution for \(_{i}\), i.e., \(\) is injective (Appendix B).

**Modeling interventions.** A left-ventricular assistance device (LVAD) is a blood pump that helps improve cardiac function in severely ill patients. The effect of implanting an LVAD is modeled in with the addition of one state variable describing blood flow through the device and a tuneable parameter. The impact of LVAD on blood flow can be modeled by attaching an exogenous electric circuit to \(()\) to form an augmented model \(}()\) (Figure 2(b)). Details on the mathematical model of LVAD are in Appendix A.

**Noninvasive data.** For each patient \(i\), we have access to an echocardiogram in the form of ultrasound video data \(_{i}\) and a physician labeled measurement of the LV ejection fraction \(}_{i}\). Echocardiography is a widely used noninvasive modality for diagnosing cardiovascular diseases; it can directly provide volumes but not pressure measurements. Our goal is to use the echocardiography clip for a patient to predict their entire PV loop through a fully noninvasive process.

## 4 Experiments

### Echocardiography Data

We test our physics-informed SSL (Med-Real2Sim) approach using two echocardiography datasets: EchoNet and CAMUS. The CAMUS dataset [(44)] consists of 500 fully annotated cardiac ultrasound videos in 2-chamber view, each with LV volume labels for end systole and diastole (\(V_{LV}(t_{ES})\) and \(V_{LV}(t_{ED})\)). The videos were processed by spatial and temporal padding, with standardized 30-frame videos with a resolution of 256\(\)256 pixels. The EchoNet dataset [(53)] comprises 10,030 apical-4-chamber echocardiography videos from routine clinical care at Stanford University Hospital

Figure 2: **Illustration of Med-Real2Sim digital twins for cardiovascular hemodynamics.** (a) Pictorial depiction of the two-step physics-informed SSL algorithm proposed in Section 2.2. (b) Five state lumped-parameter electric circuit model of cardiac hemodynamics from [(66)]. Here \((t)=[x_{1}(t),x_{2}(t),x_{3}(t),x_{4}(t),x_{5}(t)]=[P_{LV}(t),P_{ LA}(t),P_{A}(t),P_{A}(t),Q(t)]\) describes the voltages \(x_{1},x_{2},x_{3},x_{4}\) or pressures in the left-ventricle, left atrium, arteries, and aorta, respectively, and total flow \(x_{5}\). The LVAD is modeled through an electric circuit connected to the digital twin via a switch. An LVAD intervention is applied if the switch is closed.

also labeled with \(V_{LV}(t_{ES})\) and \(V_{LV}(t_{ED})\). These videos were cropped, masked, and down-sampled to a resolution of 112\(\)112 pixels using cubic interpolation. The CAMUS dataset was split into 450 training samples and 50 validation and testing samples. The EchoNet dataset was partitioned into 7,466 training, 1,288 validation, and 1,276 testing samples.

### Simulating individualized PV loops via digital twins

We train a 3D-CNN implemented using Pytorch to output a subset of the model parameters \(_{i}\). The network consists of four convolutional layers, each followed by max pooling and concluded by a convolutional layer with global average pooling and two fully connected layers. We choose seven of the model parameters listed in Table 3 to be learned in our model: mitral valve resistance \(R_{M}\), aortic valve resistance \(R_{A}\), maximum elastance \(E_{}\), minimum elastance \(E_{}\), theoretical LV volume at zero pressure \(V_{d}\), start LV volume \(V_{LV}(0)\), and heart cycle duration \(T_{C}\). The remainder of the parameters are fixed to literature values (see Table 3). We enforce restrictions on the parameters by normalizing values in our activation layer, which scales parameters using a sigmoid function to ensure parameters fall into realistic bounded ranges (as in Table 3). Parameters \(_{i}\) are then passed to a separately trained fixed-weight feed forward neural network \(_{}\) to output the labeled values of \(}_{i}\) from which we construct training loss as the mean square difference between predicted and physician-labeled \(V_{LV}(t_{ES})\) and \(V_{LV}(t_{ED})\).

The network \(_{}\) is pretrained by generating 3,840 synthetic data points linearly sampled from realistic parameter ranges mapping parameters \(_{i}\) to \(V_{LV}(t_{ED})\) and \(V_{LV}(t_{ES})\) using a numerical ODE solver (73). We use two fully connected layers trained to minimize mean square error between predicted and outputted \(V_{LV}(t_{ED})\) and \(V_{LV}(t_{ES})\).

Once predicting \(_{i}\), we can numerically solve for the complete state vector \(_{i}\) for each patient. The first state in \(_{i}\) is the patient's estimated LV volume \(V_{LV}\). The elastance function (Eq. (15)) allows us to obtain LV pressure \(P_{LV}(t)\) from volume. We plot the two functions \(P_{LV}\), \(V_{LV}\) against each other over time to obtain the PV loops. This process is deterministic, as the ODEs/elastance function are fixed by patient parameters \(_{i}\). We also use \(V_{LV}(t_{ED})\) and \(V_{LV}(t_{ES})\) to compute ejection fraction (EF) as EF \(=(V_{LV}(t_{ED})-V_{LV}(t_{ES}))/V_{LV}(t_{ED})\). We compare parameters and patient PV loops across EF, a routine indicator giving information on cardiac function.

Our model has good correlation between labeled and simulated end-systolic and end-diastolic volumes. Our approach, Med-Real2Sim, achieves a mean absolute error (MAE) of 6.81% for CAMUS and 5.40% for EchoNet in predicting EF (Table 1), comparable to a baseline that uses a 3D-CNN and fully connected layers to directly approximate \(^{-1}\) using supervised learning without passing the physics-constrained layers \(_{}\).

Our model predicts PV loops that vary by labeled EF demonstrating that the model learns variability in patient physical state from our labels (Figure 4(right)). Predicted parameters also vary across patient EF in our model, and the relative variation in high- and low-EF patient groups were replicated across EchoNet and CAMUS (Figure 3). Notably, the relationship between the parameters and patient groups by EF concur with intuited patterns. Increases in \(E_{}\) and \(E_{}\) give an increased differential between pressure and volume, which is more plausible at higher EF. \(R_{M}\) and \(R_{A}\) are the circuit resistances associated to the mitral valve and aortic valve, respectively. In the mathematical model, increases in these resistances must either increase pressure or decrease blood flow by Ohm's law. Decreases in either resistance clinical is considered a sign of increased hemodynamic burden, but its diagnostic value for indications including stenosis are controversial and a decrease in resistance is not necessarily predictive of reduce EF [(46; 32)]. In mitral regurgitation, valve resistance decreases, but EF is often increased in the beginning of the disease, which could contribute to the inverse pattern for predicted \(R_{M}\)[(52)].

### Unsupervised disease diagnosis

The PV loops simulated in patient digital twins can serve as indicators for certain diseases that may not be directly labeled in the dataset. Variations in PV loops clinically enables the diagnosis of diverse cardiac abnormalities, which cannot be predicted using EF and LV volumes alone [(65)]. We acquired physician labels for Mitral Stenosis (MS) for a subset of the patients in the EchoNet dataset. These

    &  \\   & _Supervised 3DCNN_ & _Med-Real2Sim_ \\  CAMUS & 6.58 & 6.81 \\ EchoNet & 5.62 & 5.40 \\   

Table 1: Mean Absolute Error (MAE) for true and predicted EF (in %) by supervised learning and simulated ejection fraction using Med-Real2Sim.

labels were not included in the training data, and are not correlated with the EF measurement used to train our model (i.e., AUC of EF in predicting MS was 0.5). A total of 263 of 10,024 patients were identified as having MS. We randomly sampled 100 patients with MS and 100 patients without MS from the available dataset of 10,024 patients. We computed an average PV-loop for both the MS and non-MS groups and compared their respective averages to analyze potential differences in Figure 3(b). The model trend captures a distinctive patterns associated with MS: MS reduces LV pre-load and increases pulmonary venous pressures as illustrated in the right plot of Figure 3(b) [3; 48], which aligns with the expected effect of MS on patients' PV loop patterns.

### In-silico clinical trials

Using a patient's digital twin, we can simulate their counterfactual PV loops under a hypothetical intervention in-silico to estimate its effect on the patient or to optimize the treatment parameters (e.g., dosage) [56; 72]. Here, we demonstrate the feasibility of in-silico trial simulations under baseline and intervention conditions with the patient-specific digital twin \((_{i})\) (Figures 4(a)). In our setting, the lumped-parameter model of (66) is extended by the inclusion of one new state variable and five new parameters to model the addition of an LVAD. Tuning these new parameters and utilizing our model output allows us to simulate the effect of LVAD on an individual patient in a fully non-invasive manner.

The LVAD intervention has been shown to increase EF in vivo. We demonstrate the same result in-silico using the (66) model (Figure 4). The average EF for the CAMUS and EchoNet populations increase by 17.6% and 18.9%, respectively, with the addition of an LVAD, consistent with reported findings [20; 18]), with patients having lower pre-LVAD ejection fractions experiencing more significant increases. Figures 4(c) illustrates the distributional change of EF before and after LVAD implantation, indicating a significant right shift in the EF distribution following the procedure.

Furthermore, the influence of rotation speed on the PV loop dynamics is a crucial factor in optimizing the therapeutic effects of LVADs. The rotation speed determines the rate at which blood is drawn from the left ventricle and ejected into the systemic circulation, directly affecting the pressure-volume relationship. Studies, such as those by Simaan et al. , have explored the dynamic behavior of LVADs under varying conditions, including different initial rotation speeds. It is essential to note that the choice of rotation speed should be tailored to individual patient needs for optimal therapeutic outcomes. The impact of initial rotation speed on the PV loop, such as changes in end-diastolic and end-systolic volumes, should be carefully considered in the calibration process (Figure 4(b)).

### Comparison of physics-informed approaches

Our physics-informed pretext task is a computationally efficient generative approximation of the dynamics of the map \(\). We created a second synthetic dataset of 1000 randomly sampled points to test the out of sample prediction of the physics-constrained layers \(_{}\) and achieve an MAE of 2.30 on EF. The distribution of the loss is uniform across plausible parameter sets suggesting that our network is not subject to poor approximations in extreme cases (Appendix Figure 9). In contrast, other approaches to learn the forward dynamics of differential equation models include PINNs and

Figure 3: (a) Learned parameters of the digital twin in high- and low-EF patient groups within the EchoNet an CAMUS datasets. (b) Comparison of average (simulated) PV loops in digital twins of non-Mitral Stenosis (MS) patients and MS patients. The plot illustrates differences in simulated hemodynamics in the two groups and agrees with theoretical PV loops for MS patients . Depicting of the theoretical PV loop for MS is courtesy of https://cvphysiology.com/heart-disease/hd009a.

Neural ODEs. As previously pointed out, these models are trained to learn the dynamics of a single patient, which is incompatible with our goal of learning Eq. (6) with supervised learning.

We compare the ability of our approach to learn the dynamics of the cardiac hemodynamics model for patients to PINN and Neural ODE methods and find it learns just as well on fewer data points (Table 2). Separate PINN and Neural ODE models are trained for each of \(N=50\) sets of patient parameters \(_{i}\). We generated using numerical methods a synthetic time series of 60 points for each of the five states in the cardiac model: \(=\{_{i}\}_{i=1}^{N}\). From these synthetic data, we trained both a PINN and Neural ODE approach to predict \(_{i}\) for each of the patients computing average MAE on the 20 best results (Table 2). Recall that our method \(_{}\) is trained with volume labels (one state) only. We found that only volume labels performed poorly in the Neural ODE settings (Appendix 12). PINNs were implemented in Tensorflow (16). Neural ODEs were implemented in Pytorch using torchdiffeq (11).

## 5 Conclusion

We present methodology, Med-Real2Sim, for non-invasive prediction of patient specific physics-based models directly from imaging that can form the basis for further development of medical digital twins. Our experiments showcase the ability of these methods to personalize a high fidelity physics-based model from video data. We demonstrate that information beyond labels is learned in the setting of echocardiography for cardiac pressure-volume loops. Our work may be extended to improve mathematical modeling for medical or non-medical applications. Latent parameters in our experimental setting are clinically informative, and our methodology gives a non-invasive process for estimating their value. Further development of our methods could contribute new non-invasive direct ways of computing such parameters and provide the basis for in-silico digital twin studies.

**Limitations** We highlight that our model experiments are limited in their clinical validation. In using only publicly available datasets with limited labels, we are not able to compare measurements of heart resistance or left-ventricular pressure, which would be necessary to fine-tune such a model for clinical use. While the ability to predict latent states and parameters is the core novelty of our research and

    &  &  &  & \) Epoch**} \\   & _Model_ & _Loss_ & _Avg._ & _Pt_ & _Pt_ & _Specific_ & _Population_ & _Memory_ & _Time_ \\  & & & _EF_ & _Model_ & _(Avg._ & _Model_ & & \\  & & & & _N=20)_ & & & & \\  PINN & \(_{i}\) & \(||f_{_{i}}||+||_{i}(t)-_{i}(t)||\) & 7.67 & 0.16s & NA & \((N L)\) & \((N L)\) \\  & & & (N=20) & & & & \\ Neural & \(f_{_{i}}\) & \(||_{i}(t)-_{i}(t)||\) & 3.39 (N = & 6.12s & NA & \((N)\) & \((N L)\) \\ ODE & & & 200 & & & & \\ \(_{}\) & \(\) & \(||_{i1}(t)-_{i1}^{*}(t)||\) & 2.30 & NA & 0.01s & \((L)\) & \((L)\) \\  & & & (N=1000) & & & & \\   

Table 2: **Comparison of physics informed learning. We show the Mean Absolute Error (MAE) on ejection fraction (EF). Here \(N\) is the number of patient parameter sets and \(L\) is the number of layers in the network (\(_{}\) or PINN) or the implicit layers i.e. function evaluations of a Neural ODE. Pt = patient.**

Figure 4: **Counterfactual simulations of the LVAD intervention (left): (a),(b),(c). PV loops for patients with normal, high, and low EF (right).**

approach, acquiring further data to on these latent states could improve the model substantially. This is a critical future direction for work in building digital twins with our methodology.