# Streaming PCA for Markovian Data

Syamantak Kumar\({}^{1}\) &Purnamrita Sarkar\({}^{2}\)

\({}^{1}\)Department of Computer Science, UT Austin

\({}^{2}\)Department of Statistics and Data Sciences, UT Austin

syamantak@utexas.edu, purna.sarkar@austin.utexas.edu

###### Abstract

Since its inception in 1982, Oja's algorithm has become an established method for streaming principle component analysis (PCA). We study the problem of streaming PCA, where the data-points are sampled from an irreducible, aperiodic, and reversible Markov chain starting in stationarity. Our goal is to estimate the top eigenvector of the unknown covariance matrix of the stationary distribution. This setting has implications in scenarios where data can solely be sampled from a Markov Chain Monte Carlo (MCMC) type algorithm, and the objective is to perform inference on parameters of the stationary distribution. Most convergence guarantees for Oja's algorithm in the literature assume that the data-points are sampled IID. For data streams with Markovian dependence, one typically downsamples the data to get a "nearly" independent data stream. In this paper, we obtain the first near-optimal rate for Oja's algorithm on the entire data, where we remove the logarithmic dependence on the sample size, \(n\), resulting from throwing data away in downsampling strategies.

## 1 Introduction

Streaming Principal Component Analysis (PCA) is an important and well studied problem where the principal eigenvector of the sample covariance matrix of a dataset is computed one data-point at a time. One of the most popular algorithms for streaming PCA was introduced by Erkki Oja in 1982 . Most existing analyses of Oja's algorithm are done when the data is sampled IID.

However, in many practical applications, the data-points are dependent and are sampled from an MCMC process converging to a target stationary distribution. This naturally arises in the context of token algorithms for Federated PCA settings  with multiple machines communicating via a fixed and connected graph topology. Each machine contains an arbitrary fraction of data-points and the goal is to design a streaming algorithm that respects this topology and returns the principal component of the whole dataset. This is typically achieved using a Metropolis-Hastings scheme that uses local information to design the transition matrix of a Markov chain with any desired stationary distribution. The stationary distribution, \(\), of the random walk is chosen so that the distribution of the samples under \(\) matches the uniform distribution over data-points. Governed by this Markov chain, a random walker then travels the network of machines and samples one data-point at a time from the current machine and computes the update. However, even under the stationary distribution, the data-points are dependent, which deviates from the IID setup. _Our goal is to obtain a near-optimal analysis of the \(^{2}\) error of the estimated vector with respect to the true top eigenvector of the unknown covariance matrix in the Markovian setting_.

Estimating the first principal component with streaming PCA:Let \(X_{t}\) be a mean zero \(d\) dimensional vector with covariance matrix \(\), and let \(_{t}\) be a decaying learning rate. The update rule of Oja's algorithm is given as -

\[w_{t}(I+_{t}X_{t}X_{t}^{T})w_{t-1},\ \ w_{t}}{ \|w_{t}\|_{2}}\] (1)

where \(w_{t}\) is the estimate of \(v_{1}\), the top eigenvector of \(\), and \(_{t}\) is the step-size at timestep \(t\). We aim to analyse the \(^{2}\) error of Oja's iterate at timestep \(t\), defined as \(1-{ w_{t},v_{1}}^{2}\).

**Streaming PCA in the IID setting:** For an IID data stream with \([X_{i}]=0\) and \([X_{i}X_{i}^{T}]=\), there has been a lot of work on determining the non-asymptotic convergence rates for Oja's algorithm and its various adaptations . Amongst these, ,  and  match the optimal offline sample complexity bound suggested by the independent and identically distributed (IID) version of Theorem 1 (See Theorem 1.1 in ).

We consider Oja's algorithm in the setting where the data is generated from a reversible, irreducible, and aperiodic Markov chain with stationary distribution \(\). We denote by \(_{}[.]\) the expectation under the stationary distribution. In this setting our goal is to estimate the principal eigenvector of \(_{}[X_{i}X_{i}^{T}]\). As in the IID setting, \(_{}[X_{i}]=0\). The challenge is that the data, even when it reaches stationarity, is dependent. Here the degree of dependence is captured by the second eigenvalue in the magnitude of the transition matrix \(P\) (denoted as \(|_{2}(P)|\)) of the Markov chain. This is closely related to the mixing time of a Markov chain , denoted as \(_{}\), which is the time after which the conditional distribution of a state is close in total variational distance to its stationary distribution, \(\) (See Section 2.1).

**Our contribution:** Using a series of approximations, we obtain an optimal error rate for the \(^{2}\) error, which is worse by a factor of \(1/(1-|_{2}(P)|)\) from the corresponding error rate of the IID case. Previous work  has established rates worse by a poly-logarithmic factor by using downsampling, i.e. applying the update on every \(k^{th}\) datapoint. In Figure 1, we compare Oja's algorithm with its downsampled and offline variants (see Section 6 for more details on setup). We see that Oja's algorithm performs significantly better than the downsampled variant, and similarly to the offline variant where for the \(i^{th}\) data point we compute the eigenvector of the sample covariance matrix of all data-points up-to \(i\). Our work provides a concrete and novel result that explains these observations. In Table 1, we compare our bounds with related analyses of Oja's algorithm. The last row shows that we are the first to obtain an error whose main term is _free of logarithmic dependence_ on \(n\) or \(d\) for _streaming_ PCA in the _Markovian_ case.

We _break the logarithmic barrier_ in previous work by considering a series of approximations of finer granularity which uses reversibility of the Markov chain and standard mixing conditions of irreducible and aperiodic Markov chains. Our rates are comparable to the recent work of  (Proposition 1) that establishes an offline error analysis for estimating the principal component of the empirical covariance matrix of Markovian data by using a Matrix Bernstein inequality. Therefore, our results are nearly optimal in terms of the dependence on sample size, \(n\), the dimension \(d\), and the model parameters \(\), \((_{1}-_{2})\) and \(1-|_{2}(P)|\) (See Section 2 for definitions). Our results also imply a linearly convergent decentralized algorithm for streaming PCA in a distributed setting. As a simple byproduct of our theoretical result, we also obtain a rate for Oja's algorithm applied on downsampled data, which is worse by a factor of \( n\), as shown in Figure 1. To our knowledge, this is the first work that analyzes the Markovian streaming PCA problem without any downsampling that matches the error of the offline algorithm.

  Paper & Markovian? & Online? & 
 \(\)-free \\ main-term \\  & \(^{2}\) error rate & Sample complexity \\  Jain et al.  & N & Y & Y & \(O(}{^{2}})\) & \(O(}{^{2}})\) \\ Jain et al.  & N & N & N & \(O((d)}{^{2}})\) & \(O((d)}{^{2}})\) \\  Chen et al.  & Y & Y & N & - & \(O(^{2}}^{2}(^{2}}))\) \\ Neeman et al.  & Y & N & N & \(O((d^{2-})}{(1-|_{2 }(P)|)^{2}})\) & \(O((d^{2-})}{(1-|_{2 }(P)|)^{2}})\) \\ 
**Theorem 1** & Y & Y & Y & \(O(}{(1-|_{2}(P)|)^{2}} )\) & \(O(}{(1-|_{2}(P)|)^{2}} )\) \\  

Table 1: Comparison of \(^{2}\) error rates and sample complexities. Here \(:=(_{1}-_{2})\), where \(_{1},_{2}\) are the top 2 eigenvalues of \(\) and \(\) represents a suitably defined variance parameter (see assumption 2). The sample complexity represents the number of samples required to achieve \(^{2}\) error at most \(\). We note that  and  also match the online sample complexity bound provided in . Further, for the offline algorithm with IID data,  removes the \((d)\) factor in exchange for a constant probability of success for large enough \(n\).

The crux of our analysis uses the mixing properties of the Markov chain. Strong mixing intuitively says that the conditional distribution of a state \(s\) in timestep \(k\) given the starting state is exponentially close to the stationary distribution of \(s\), the closeness being measured using the total variation distance. All previous work on Markovian data exploits this property by conditioning on states many time steps before. However, it is crucial to a) adaptively find how far to look back and b) bound the error of the sequence of matrices we ignore between the current state and the state we are conditioning on. Observe that these two components are related. Looking back too far makes the dependence very small but increases the error resulting from approximating a larger matrix product of intermediate matrices. We present a fine analysis that balances these two parts and then uses spectral theory to bound the second part within a factor of a variance parameter that characterizes the variability of the matrices and shows up in the analysis of [16; 28].

**Related work on streaming PCA and online matrix decomposition on Markovian data:** Amongst recent work,  is very relevant to our setting, since it analyzes Oja's algorithm with Markovian Data samples. Inspired by the ideas of , the authors propose a downsampled version of Oja's algorithm to reduce dependence amongst samples and provide a Stochastic Differential Equation (SDE) based analysis to achieve a sample complexity of \(O(-_{2})^{2}}^{2} (-_{2})^{2}}))\) for \(^{2}\) error smaller than \(\), where \(G\) is a variance parameter. We obtain a similar rate in Corollary 1 through our techniques. However, comparing with Theorem 1, we observe that downsampling leads to an extra \(O((n))\) factor. It is important to point out that  provides an analysis for estimating top \(k\) principal components, whereas this paper focuses on obtaining a \(\)-free error rate for the first principal component.

 consider the harder problem of online non-negative matrix factorization for Markovian data. Their analysis establishes asymptotic convergence of error, but does not provide a rate.

**Stochastic Optimization with Markovian Data** : Markovian models are often considered in Reinforcement Learning and Linear Dynamic Systems[2; 5; 9; 31; 4; 35; 18; 24]. There have been many notable nonsymptotic bounds for stochastic gradient descent (SGD) methods for general convex and nonconvex functions with Markovian data [8; 32; 6; 7; 10; 39; 34]. The convergence rates (sample complexities) obtained in these works apply to more general problems but do not exploit the matrix product structure inherent to Oja's algorithm. In this work, we develop novel techniques to show that a sharper analysis is possible for the PCA objective. The paper is organized as follows. Section 2 contains the problem setup and preliminaries about Markov Chains. Section 3 contains Theorem 1. We present a sketch of the main technical tools in Section 4, intermediate theorems needed for the main theorem in Section 5 and conclude with simulations in Section 6.

## 2 Problem Setup and Preliminaries

This section presents the problem setup and outlines important properties of the Markov chain that will be utilized subsequently. We assume that:

**Assumption 1**.: _The Markov chain is irreducible, aperiodic, reversible, and starts in stationarity, with state distribution \(\)1._

Figure 1: Comparison of Oja’s algorithm with downsampled and offline variants. The X-axis represents the sample size and the Y axis represents the \(^{2}\) error of each algorithm’s estimate of the leading eigenvector. The experimental setup is available in Section 6.

Such a Markov chain can arise in various situations, for e.g., while performing random walks on expander graphs which are used extensively in fields such as computer networks, error-correcting codes, and pseudorandom generators. Each state \(s\) of the Markov chain is associated with a distribution \(D(s)\) over \(d\)-dimensional vectors with mean \(_{s}^{d}\) and covariance matrix \(_{s}^{d d}\).

For a random walk \(s_{1},s_{2}, s_{t}\) on the Markov chain, we define the sequence of random variables \(X_{1},X_{2} X_{t}\), where conditioned on the state \(s_{i}\), \(X_{i} D(s_{i})\).We represent the mean as \(:=_{s}[_{s}]=_{s}_{s}_{s}\) and the covariance matrix as \(^{d d}\), which, for \(i[n]\) can be expressed as:

\[:=_{s_{i}}_{D(s_{i})}[( X_{i}-)(X_{i}-)^{T}]=_{s}[ _{s}]+_{s}[_{s}_{s}^{T}]- ^{T}\]

In this work, we assume \(=0\), which is a common assumption in the IID setting (see [16; 1]). While it may be possible to extend our analysis to the non-zero mean case, it is out of the scope of this paper. Therefore, \(=_{s_{i}}_{D(s_{i})}[X_{i}X_{ i}^{T}]\) for \(i[n]\)

Let the eigenvalues of \(\) be denoted as \(_{1}>_{2}_{3}_{d}\). Let \(v_{1}\) denote the leading eigenvector of \(\) and \(V_{}\) denote the \(^{d(d-1)}\) matrix with the remaining eigenvectors as columns. In this work, \(\|.\|_{2}\) denotes the Euclidean \(L_{2}\) norm for vectors and the operator norm for matrices unless otherwise specified and \(I\) denotes the identity matrix of the appropriate dimensionality. We proceed under the following standard assumptions for \(i[n]\), (see for eg. ).

**Assumption 2**.: \(\|_{s_{i}}_{D(s_{i})}[(X_{i}X_{i}^{T}- )^{2}]\|_{2}\)_._

**Assumption 3**.: \(\|X_{i}X_{i}^{T}-\|_{2}\) _with probability 1._

Assumption 3 also implies \(\|_{s}+_{s}_{s}^{T}-\|_{2}\) with probability 1. WLOG, we assume \(+_{1} 1\). We use \([.]:=_{s}_{D(s)} [.]\) to denote the expectation over state \(s\) and over the state-specific distributions \(D(.)\), unless otherwise specified. We observe that Assumption 3 can be relaxed to accommodate sub-gaussian data distributions with appropriate variance decay (see Proposition 1 in ) using standard truncation-based arguments. We do not pursue this here. Define the matrix product

\[B_{t}:=(I+_{t}X_{t}X_{t}^{T})(I+_{t}X_{t-1}X_{t-1}^{T })(I+_{1}X_{1}X_{1}^{T})\] (2)

Unrolling the recursion in Eq 1, the output of Oja's algorithm at timestep \(t\) is given as \(w_{t}=w_{0}}{\|B_{t}w_{0}\|_{2}}\).

### Markov chain mixing times

Now we will discuss some well-known properties of an irreducible, aperiodic, and reversible Markov chain (see  for details and derivations). Let \(|_{2}(P)|\) denote the second largest absolute eigenvalue of the Markov chain; let the state-distribution of the Markov chain at timestep \(t\) with \(s_{1}=x\) be \(P^{t}(x,.)\). For any two probability distributions \(_{1}\) and \(_{2}\), recall that the total variational distance is \(TV(_{1},_{2}):=\|_{1}-_{2}\|_{TV} _{x}|_{1}(x)-_{2}(x)|}\). The distance from \(\) at the \(t^{}\) timestep is defined as \(d_{}(t):=_{x}TV(P^{t}(x,.),)\). For irreducible and aperiodic Markov chains, by Theorem 4.9 in , we have \(d_{}(t) C(-ct)\) for some \(C,c>0\). The mixing time of the Markov chain is defined as:

\[_{}():=\{t:d_{}(t)\}\] (3)

As defined in Section 4.5 of , we will denote \(_{}:=_{}()\). Then, we have \(_{}()_{2}(1/)\,_{}\). It is worth mentioning the useful relationship between \(d_{}(.)\) and \(_{}\), given as \(d_{}(l_{}) 2^{-l}\)\( l_{0}\). These results about mixing time are valid for general irreducible and aperiodic Markov chains. A reversible Markov chain satisfies \(\ x,y\), \((x)P(x,y)=(y)P(y,x)\). For a reversible, irreducible, and aperiodic Markov chain, the gap \(1-|_{2}(P)|\), is inversely proportional to (Theorem 12.4, \(_{}\)).

## 3 Main Results

In this section, we present our main result, a near-optimal convergence rate for Oja's algorithm on Markovian data. As a corollary, we also establish a rate of convergence for Oja's algorithm applied on downsampled data, where every \(k^{}\) data-point is considered. Supplement Section S.5 contains comprehensive proofs of Theorem 1 and Corollary 1 while the proof of Proposition 1 can be found in Supplement Section S.2.

**Theorem 1**.: _Fix \((0,1)\) and let the step-sizes be \(_{i}:=-_{2})(+i)}\) with \(_{0},>2\). Under assumptions 1, 2 and 3, for sufficiently large number of samples \(n\) such that \(})}>})}\),_

\[:=\{_{}(})(+_{1})^{2},(P)|}+_{1}^{2})}{100}\}}{ (_{1}-_{2})^{2}(1+)}\] (4)

_the output \(w_{n}\) of Oja's algorithm (1) satisfies_

\[1-(w_{n}^{T}v_{1})^{2}) }{^{2}}[d()^{2}+ }{(_{1}-_{2})^{2}(1-|_{2 }(P)|)}+( +_{1})^{2}}{(_{1}-_{2})^{3}} }(_{n}^{2})^{2}}{n^{2}}]\]

_with probability atleast \((1-)\). Here \(C\) is an absolute constant and_

\[C_{1}:=(3+7|_{2}(P)|)}{2-1 },\ \ C_{2}:=}{-1}\]

**Remark 1**.: _(Interpreting the \(^{2}\) error) Theorem 1 simply establishes that, under suitable choices of \(,\), as long as assumptions 1, 2 and 3 hold, for decaying step sizes \(_{i}=-_{2})(+i)}\), with probability at least \(\), we have,_

\[1-(w_{n}^{T}v_{1})^{2}=O(}{(_{1} -_{2})^{2}(1-|_{2}(P)|)} ),\]

_for large enough \(n\). This can be seen by using \(=6\), setting \(\) as in Eq 4, and taking \(n=(d^{0.1}()^{1.2})\), where \(\) hides logarithmic factors in \(n\). These choices make the first and third terms of the upper bound on the \(^{2}\) error in Theorem 1 a smaller order than the second term, which is \(O()\). For the first term, we have \(d()^{2}=O(})\). The third term involves \(}(_{n}^{2})}{n^{2}}\), which is \(O((n)}{n^{2}})\), using the definition of \(_{}()\) in Eq 3._

**Remark 2**.: _(Knowledge of mixing times) We note that setting the step-sizes \(_{i}\) in Theorem 1 requires the knowledge of the mixing time of the Markov chain, \(_{}\). An offline algorithm for estimating the mixing time is provided in . They show that at least a constant \(}(|}{^{2}}\) samples are needed for estimating \(_{}\) within an absolute error \(\). Therefore, it is possible to use the first \(O(})\) samples to estimate the mixing time and then set the learning rate accordingly._

**Remark 3**.: _(Regarding non-reversible Markov chains) We assume the reversibility of Markov chains to simplify our analyses. Our techniques and results extend to the non-reversible case using reversibilization tools (see , ). Specifically, one can obtain bounds in terms of the second-largest eigenvalue, in magnitude, of the modified transition matrix \(P_{*}P\), the multiplicative reversibilization of \(P\). Here, \(P_{*}\) represents the probability transition matrix of the time-reversed chain, given as \( x,y,\ P_{*}(x,y)=P(y,x)\). We leave this extension for future work._

Next, we compare the rate of convergence proposed in Theorem 1 with the offline algorithm having access to the entire dataset \(\{X_{i}\}_{i=1}^{n}\) using a recent result from . Here, the authors extend the Matrix Bernstein inequality [36; 33], to Markovian random matrices. Their setup is much like ours except that the matrix at any state is fixed, i.e., there is no data distribution \(D(s)\) as in our setup. However, it is easy to extend their result to our setting by observing that conditioned on the state sequence, the matrices \(X_{i}X_{i}^{T},i[n]\) are independent under our model, and we can push in the expectation over the state-specific distributions, \(D(s)\), whenever required. Therefore, we have the following result -

**Proposition 1** (Theorem 2.2 of +Wedin's theorem).: _Fix \((0,1)\). Consider an irreducible and aperiodic Markov chain. Under assumptions 2 and 3, with probability \(1-\), the leading eigenvector \(\) of \(_{i=1}^{n}X_{i}X_{i}^{T}/n\) satisfies,_

\[1-(^{T}v_{1})^{2} C_{1}^{} (-}{})}{(_{1}- _{2})^{2}}((P)|}{ 1-|_{2}(P)|})+C_{2}^{ }((-}{} )}{(_{1}-_{2})(1-|_{2}(P )|)})^{2}}\]

_for absolute constants \(C_{1}^{}\) and \(C_{2}^{}\)._

Observe that Theorem 1 matches the leading term \(}{(_{1}-_{2})^{2}(1-| _{2}(P)|)}\) in Theorem 1 except the \((d)\) term. We believe, much like the IID case (also see footnote 1 in ), this logarithmic term in 's result is removable for large \(n\) and a constant probability of success.

**Remark 4**.: _(Comparison with IID algorithm) Fix a \((0,1)\). If the data-points \(\{X_{i}\}_{i=1}^{n}\) are sampled IID from the stationary distribution \(\), then under assumptions 2 and 3, using Theorem 4.1 from , we have that the output \(w_{n}\) of Oja's algorithm 1 satisfies,_

\[1-(w_{n}^{T}v_{1})^{2}) }{^{2}}[d(}{n})^{2}+^{}2}}{(2^{}-1)( _{1}-_{2})^{2}}]\] (5)

The leading term of Theorem 1 is worse by a factor of \((P)|}\). Further, it has an additive lower order term \(O((n)}{n^{2}})\) due to the covariance between data-points in the Markovian case.

**Corollary 1**.: _(Downsampled Oja's algorithm) Fix a \((0,1)\). If Oja's algorithm is applied on the downsampled data-stream with every \(k^{}\) data-point, where \(k:=_{}(_{n}^{2})\) then under the conditions of Theorem 1 with appropriately modified \(\) and \(\), the output \(w_{n}\) satisfies,_

\[1-(w_{n}^{T}v_{1})^{2}\] \[)}{^{2}}[d (}(n)}{n})^{2}+ _{}}{(_{1}-_{2}) ^{2}}+(+ _{1})^{2}}{(_{1}-_{2})^{3}}(n)_{}(_{n}^{2})^{2}}{n^{2}}]\]

_with probability atleast \((1-)\). Here \(C\) is an absolute constant and \(C_{1}:=}{2-1},\ \ C_{2}:=}{-1}\)._

**Remark 5**.: _Data downsampling to reduce dependence amongst samples has been suggested in recent work . In Corollary 1, we establish that the bound on the rate obtained is sub-optimal compared to Theorem 1 by a \((n)\) factor. We prove this by a simple yet elegant observation: the downsampled data stream can be considered to be drawn from a Markov chain with transition kernel \(P^{k}(.,.)\) since each data-point is \(k\) steps away from the previous one. For sufficiently large \(k\), this implies that the mixing time of this chain is \((1)\). These new parameters are used to select the modified values of \(,\) according to Lemma S.11 in the Supplement._

The proof of Theorem 1 follows the same general recipe as in  for obtaining a bound on the \(^{2}\) error. However, the original proof techniques heavily rely on the IID setting. We carry out a refined analysis for each step under the Markovian data model by a careful control of error terms arising out of dependence. The first step involves obtaining a high-probability bound on the \(^{2}\) error, by noting that Oja's algorithm on \(n\) data-points can be viewed as a single iteration of the power method on \(B_{n}\). Therefore, fixing a \((0,1)\) using Lemma 3.1 from , we have with probability at least \((1-)\),

\[^{2}(w_{n},v_{1})) }{}(V_{}^{T}B_{n}B_{n}^{T}V_{} )}{v_{1}^{T}B_{n}B_{n}^{T}v_{1}},\] (6)

where \(C\) is an absolute constant. The numerator is bounded by first bounding its expectation (see Theorem 3) and then using Markov's inequality. To bound the denominator, similar to , we will use Chebyshev's inequality. Theorem 4 provides a lower bound for the expectation \([v_{1}^{T}B_{n}B_{n}^{T}v_{1}]\). Chebyshev's inequality also requires upper-bounding the variance of \([v_{1}^{T}B_{n}B_{n}^{T}v_{1}]\), which requires us to bound \([(v_{1}^{T}B_{n}B_{n}^{T}v_{1})^{2}]\) (see Theorem 5).

Main Technical Tools

In this section, we provide a sketch of the main arguments used in our proof.

**Warm-up with downsampled Oja's algorithm:** We start with the simple downsampled Oja's algorithm to build intuition. Here, one applies Oja's update rule (Eq 1) to every \(k^{th}\) data-point, for a suitably chosen \(k\). For \(k= L_{} n\), the total variation distance between any consecutive data-points in the downsampled data stream is \(O(n^{-L})\). As we show in Corollary 1, the error of this algorithm is similar to the error of Oja's algorithm applied to \(n/k\) data-points in the IID setting, i.e., \(O(_{} n/n)\).

We will take \([v_{1}^{T}B_{n}B_{n}^{T}v_{1}]\) as an example. Let us introduce some notation.

\[B_{j,i}:=(I+_{j}X_{j}X_{j}^{T})(I+_{j-1}X_{j-1}X_{j-1} ^{T})(I+_{i}X_{i}X_{i}^{T})\] (7)

We peel this quantity one matrix at a time from the inside. Note that for a reversible Markov chain, standard results imply (see Lemma 1) that the mixing conditions apply to the conditional distribution of a state given another state \(k\) steps in the "future" (see Supplement Section S.3 for a proof). Recall \(d_{}(k)\) from Section 2.1.

**Lemma 1**.: _Under Assumption 1, \(_{t}_{s}|(Z_{t}=s|Z_{t+k}=t )-(s)|=d_{}(k)\)._

It will be helpful to explain our analysis by comparing it with the IID setting. For this reason, we will use \(_{}[.]\) to denote the expectation under the IID data model. Define \(_{n,i}:=[v_{1}^{T}B_{n,i}B_{n,i}^{T}v_{1}],i[n]\). Then we have,

\[_{n,1} =[v_{1}^{T}B_{n,2}(I+_{1}+_{1} (X_{1}X_{1}^{T}-))(I+_{1}+_{1}(X_{1}X_{1}^{T}- ))^{T}B_{n,2}^{T}v_{1}]\] \[=[v_{1}^{T}B_{n,2}(I+_{1})^{2 }B_{n,2}^{T}v_{1}]+2_{1}T_{1}+_{1}^{2}T_{2},\] (8)

where the first term is smaller than \((1+_{1}_{1})^{2}_{n,2}\). We define \(T_{1}\) and \(T_{2}\) as follows. \(T_{1}:=[v_{1}^{T}B_{n,2}(I+_{1})(X_{1 }X_{1}^{T}-)B_{n,2}^{T}v_{1}]\), and \(T_{2}:=[v_{1}^{T}B_{n,2}(X_{1}X_{1}^{T}-)^{2} B_{n,2}^{T}v_{1}]\).

For the IID setting, the _second term is zero_, and the third term can be bounded as follows:

\[_{}[v_{1}^{T}B_{n,2}(X_{1}X_{1}^{T} -)^{2}B_{n,2}^{T}v_{1}] =_{}[v_{1}^{T}B_{n,2}[ (X_{1}X_{1}^{T}-)^{2}]B_{n,2}^{T}v_{1}]\] \[_{}[v_{1}^{T}B_{n,2}B_{n, 2}^{T}v_{1}]\]

Let us denote the IID version of \(_{n,i}\) by \(_{n,i}^{}=_{}[v_{1}^{T}B_{n,i}B_{n,i}^{T}v _{1}]\). The final recursion for the IID case becomes: \(_{n,1}^{}(1+2_{1}_{1}+_{1}^{2}( _{1}^{2}+))_{n,1}^{}\). So, for our Markovian data model, the hope is that the cross term \(T_{1}\) (which has a multiplicative factor of \(_{1}\)) is \(O(_{1})\) and \(T_{2}\) is \(O(_{1}^{2})\). We will start with the \(T_{1}\) term, which is zero in the IID setting.

We will show that \(T_{1}\), while not zero like the IID case, is still sufficiently small. Intuitively, if we could replace the \(k\) matrices between \(X_{1}X_{1}^{T}-\) and \(B_{n,2+k}\) for some suitably large integer \(k\) by identity (see Figure 2), then using (reverse) mixing properties of the Markov chain, we could argue using Lemma 1 that \([X_{1}X_{1}^{T}-|s_{1+k},,s_{n}]\) is very close to zero (see Figure 2). The following lemma formally bounds the deviation of the length-\(k\) matrix product from identity.

**Lemma 2**.: _Let Assumption 3 hold. If \( i[n],_{i}k_{i}(+_{1}), (0,1)\) and \(_{i}\) forms a non-increasing sequence then \(\ m n-k_{n}\),_

\[\|B_{m+k_{m}-1,m}-I\|_{2}(1+)\,k_{m}_{ m}(+_{1})\] (9) \[\|B_{m+k_{m}-1,m}-I-_{t=m}^{m+k_{m}-1}_{t}X_{t}X_{t}^ {T}\|_{2} k_{m}^{2}_{m}^{2}(+_{1})^{2}\] (10)

Figure 2: If we could replace the intermediate products (white matrices) by \(I\), the conditional expectation of the noise matrix \(X_{1}X_{1}^{T}-\) conditioned on the gray matrices would be nearly zero.

Lemma 2 bounds the norm of the matrix product \(B_{t+k_{t}-1,t}\) at two levels. The first result provides a coarse bound, approximating linear and higher-order terms. The second result provides a finer bound, preserving the linear term and approximating quadratic and higher-order terms. The proofs involve a straightforward combinatorial expansion of \(B_{t+k_{t}-1,t}\) and are deferred to the Supplement Section S.3.

Approximating \(_{i=2}^{k+1}(I+_{i}X_{i}X_{i}^{T})\) requires \(_{1}k\) to be small. Since this is a recursive argument, we would need \(_{i}k\) to be small for \(i=1, n\), which is satisfied by the strong condition \(_{1}k\) is small. To obtain a tight analysis, we choose \(k\) adaptively. We set \(k_{i}=_{}(_{i}^{2})\) (see definition in Eq 3).

As we will show in detail in the Supplement, Lemma 2 Eq 10 along with the adaptive choice of \(k_{i}\) gives us a sharp error bound. Using it, we can bound \(T_{1}\) (see Eq 8) as:

\[T_{1} _{j=2}^{k+1}_{j}[v_{1}^{T}B_{n,k+2} [(X_{j}X_{j}^{T})(I+_{1} )(X_{1}X_{1}-)|X_{k+2},,X_{n}. ]}_{T_{1,j}}B_{n,k+2}^{T}v_{1}]\] \[+O(_{1}^{2}k_{1}^{2})_{n,k+2}\]

Naively bounding the \(T_{1,j}\) term by \(O(1)\) leads to the same rate as downsampled Oja's algorithm.

In the following lemma, we will establish that, indeed, \(T_{1,j}\) has a much smaller norm. The novelty of our bound is not just in using the mixing properties of the Markov chain but also in teasing out the variance parameter \(\). We will state the lemma, in a slightly more general form as -

**Lemma 3**.: _Under Assumptions 1, 2 and 3, for \(i<j i+k_{i}\),_

\[\|[(X_{i}X_{i}^{T}-)SX_{j}X_{j}^{T}|s_{i+ k_{i}}, s_{n}]\|_{2}(|_{2}(P) |^{j-i}+8_{i}^{2}(+_{1 }))\|S\|_{2}\]

_where \(k_{i}\) is as defined in Lemma S.11 and \(S\) is a constant symmetric positive semi-definite matrix._

Lemma 3 bounds the norm of the covariance between matrices \((X_{i}X_{i}^{T}-)S\) and \(X_{j}X_{j}^{T}\). In particular, this implies that the norm of \(T_{1,j}\) decays as \(|_{2}(P)|^{j-1}\). The proof uses a spectral argument that replaces a coarse approximation by a sum of \(k_{i}\)\(O(1)\) terms to sum of \(k\)_exponentially decaying_ terms, thereby removing the dependence on \(k_{i}\), which can be as large as \((n)\). The proof is deferred to the Supplement Section S.4.

Let \(\{c_{1},c_{2},c_{3},c_{4}\}\) be positive constants for ease of notation. Coming back to Eq 8, we can bound \(T_{1}\) as follows: \(T_{1}_{n,k+2}(_{1}|_{2}(P)|}{ 1-|_{2}(P)|}+c_{2}_{1}^{2}k_{1}^{2})\). A similar argument can be applied to bound \(T_{2}\) as: \(T_{2}_{n,k+2}(+c_{3}_{1}k_{1}^{2})\). Putting everything together in 8, we have

\[_{n,1}_{1} )^{2}+)_{n,2}}_{}\ +\ |_{2}(P)|}{1-|_{2} (P)|})_{1}^{2}_{n,k+2}}_{}\ +\ \ \ \ \ \ \ \ \ \ _{1}^{3}k_{1}^{2}_{n,k+2}}_{}\]

Recursing on this inequality gives us our bound on \([v_{1}^{T}B_{n}B_{n}^{T}v_{1}]\) (Theorem 2). We are now ready to present all our accompanying theorems.

## 5 Intermediate Theorems for Convergence Analysis

In this section, we present our accompanying theorems which are used to obtain the main result in Theorem 1. But before doing so, we will need to establish some notation. Let \(k_{i}:=_{}(_{i}^{2})\), and the step-sizes be set as \(_{i}:=-_{2})(+i )}\) with \(,\) as defined in Theorem 1. Let \(:=\). As shown in Lemma S.11 in Supplement Section S.3 our choice of step-sizes satisfy, \( i[n]\),

**C.1**: \(_{i}k_{i}(+_{1})\) **C.2**: (Slow decay)_\(_{i}_{i-k_{i}}(1+2)_{i} 2_{i}\)_

Further, we define scalar variables -

\[r :=2(1+)k_{n}_{n}(+_{1 }),_{k,t}:=40k_{t+1}(+_{1})^{2}\] \[_{k,t} :=6[1+3k_{t+1}^{2}(+_{1} )^{2}],^{}:=(P)|}{1-|_{2}(P) |}\] (11)and recall the definitions of \(B_{t}\) and \(B_{j,i}\) in Eqs 2 and 7, respectively. We are now ready to present the theoretical results needed to prove our main result. For simplicity of notation, we present versions of the results by using \(_{i}:=-_{2})(+i)}\) with \(,\) as defined in Theorem 1. However, these theorems are in fact valid under more general step-size schedules. We state and prove the more general versions in the Supplement Section S.4.

**Theorem 2**.: _Under Assumptions 1, 2 and 3, for all \(n>k_{n}\), and \(_{i}\) satisfying **C.1** and **C.2**, we have,_

\[[v_{1}^{T}B_{n}B_{n}^{T}v_{1}](1+r)^{2} (_{t=1}^{n-k_{n}}(2_{t}_{1}+_{t}^{2}( ^{}+_{1}^{2})+_{t}^{3}_{k,t}))\]

The three primary differences with the IID case are a) the \((1+r)^{2}\) term, which arises since the recursion sketched in Section 4 leaves out the last \(k_{n}\) terms which are bounded by \((1+r)^{2}\); (b) the new factor of \((P)|}\) with \(\) due to the Markovian dependence between terms; and c) the extra lower order term \(_{t}^{3}_{k,t}\) arising from the use of Lemmas 2 and 3.

**Theorem 3**.: _Let \(u:=\{t:t[n],t-k_{t} 0\}\). Under Assumptions 1, 2 and 3, for all \(n>u\), and \(_{i}\) satisfying **C.1** and **C.2**,_

\[[(V_{}^{T}B_{n}B_{n}^{T }V_{})](1+5)(_{t=u+1}^{n }2_{t}_{2}+_{t-k_{t}}^{2}(^{}+_{1 }^{2})+_{t-k_{t}}^{3}_{k,t})\] \[(d+_{t=u+1}^{ n}(^{}+_{t}_{k,t})C_{k,t}^{}_{t-k_{t }}^{2}(_{i=u+1}^{t}2_{i}(_{1}-_{2}) ))\]

_where \(C_{k,t}^{}:=(1+)(2_{1} _{i=1}^{u}_{j})\)._

Here, the difference is mainly in the new variable \(u\), arising since the recursion stops at \(u\), not \(1\). \((1+5)\) represents the approximation of the first \(u\) terms.

**Theorem 4**.: _Under Assumptions 1, 2 and 3, for all \(n>k_{n}\), \(_{i}\) satisfying **C.1** and **C.2**, and \(s:=2r+\), we have,_

\[[v_{1}^{T}B_{n}B_{n}^{T}v_{1}](1-s) (_{t=1}^{n-k_{n}}2_{t}_{1}-_{t=1}^{n-k_{n}}4_{t}^{ 2}_{1}^{2})\]

This differs from its IID counterpart by a multiplicative factor of \((1-s)\) for the same reason as before, which also makes the sums go up to \((n-k_{n})\) instead of \(n\). Note that for sufficiently large \(n\) (Lemma S.12), \(r=O()\) is very small and \((0,1)\). Therefore, \((1-s) 1\) as large \(n\).

**Theorem 5**.: _Under Assumptions 1, 2 and 3, for all \(n>k_{n}\), and \(_{i}\) satisfying **C.1** and **C.2**, we have,_

\[[(v_{1}^{T}B_{n}B_{n}^{T}v_{1})^{2}]( 1+r)^{4}(_{t=1}^{n-k_{n}}4_{t}_{1}+_{t=1}^{n- k_{n}}_{t}^{2}_{k,t})\]

The differences are similar to the last theorems involving \(v_{1}\). Surprisingly, for this, the coarse approximation suffices, leading to an absence of the \(\) term in the bound. Having established these results, the final step is to substitute them into Eq 6 and follow the proof recipe described earlier. This requires significant calculations and is deferred to the Supplement Section S.5.

## 6 Experimental Validation

In this section, we present some simple experiments to validate our theoretical results. For more detailed experiments, see the Supplement Section S.6. We design a Markov chain with \(||=10\) states, where the transition matrix entries \(P_{ij}\) equal \(/(||-1)\) for \(i j\) and \(1-\) for \(i=j\). Smaller values of \(\) lead to larger mixing times. It can be verified that the stationary distribution \(=()\) is uniform over the state-space and \(|_{2}(P)|(1-)\). We set \(=0.2\) for Figures 1 and 3a, and vary it in Figure 3b. Each point in the plot is averaged over 20 random runs over different Markov chains, datasets, and initialization.

Each state \(s\) is associated with \(D(s):=\) Bernoulli(\(p_{s}\)) distribution. We set \(d=1000\) and select \(p_{s}(0,0.05)\) at the start of each random run. The covariance matrix, \(_{s}\), for each state is set as \(_{s}(i,j)=(-|i-j|c_{s})_{i}_{j}\) where \(c_{s}:=1+9(),_{i}:=5i^{-}\). We start with the stationary distribution \(\), and for each state \(s_{i}\), we draw IID samples \(Z_{i} D(s_{i})\). We standardize \(Z_{i}\) such that all components have zero mean and unit variance under the state distribution, \(D(s_{i})\). We then generate the sample data-point for PCA as \(X_{i}=_{i}^{}Z_{i}\). By construction, \(_{D(s_{i})}[X_{i}X_{i}^{T}]=_{i}\) and \([X_{i}]=0^{d}\). The step sizes for Oja's algorithm are set as \(_{i}=-_{2} )}\) for \(=5,=(P)|}\). For the downsampled variant, every \(10^{th}\) data-point is considered, and \(\) is accordingly divided by 10. For the offline algorithm, we recompute the leading eigenvector of the sample covariance matrix of data-points seen so far.

Figure 1 compares the performance of different algorithms for the Bernoulli distribution. Here, we are checking if the results obtained in Theorem 1, Proposition 1, and Corollary 1 are reflected in the experiments. The experimental results demonstrate that Oja's algorithm performs significantly better than the downsampled version, consistent with the theoretical results. It also shows that Oja's algorithm performs similarly to the offline algorithm, which is also confirmed by our theoretical results and that of . Figure 2(a) compares the performance of Oja's algorithm for different covariance matrices. Smaller values of \(\) decrease the eigengap \(_{1}-_{2}\), and hence lead to a slower convergence. Figure 2(b) confirms that smaller values of \(\) (larger values of \(|_{2}(P)|\) also worsen the rate, which matches with our theoretical results.

## 7 Conclusion

We have considered the problem of streaming PCA for Markovian data, which has implications in various settings like decentralized optimization, reinforcement learning, etc. The analysis of streaming algorithms in such settings has seen a renewed surge of interest in recent years. However, the dependence between data-points makes it difficult to obtain sharp bounds. We provide, to our knowledge, the first near-optimal bound for obtaining the first principal component from a Markovian data stream that breaks the logarithmic barrier present in the analysis done for downsampled data. We believe that the theoretical tools that we have developed in this paper would enable one to obtain sharp bounds for other dependent data settings, learning top \(k\) principal components, and online inference algorithms with updates involving products of matrices.

## 8 Acknowledgements

We gratefully acknowledge NSF grants 2217069, 2019844, and DMS 2109155. We are also grateful to Rachel Ward, Bobby Shi, and Soumendu Sundar Mukherjee for useful discussions and to the anonymous reviewers for their valuable feedback.

Figure 3: X axis represents the sample size, and Y axis represents the \(^{2}\) error.