# Efficient Bayesian Additive Regression Models For Microbiome Studies

Tinghua Chen

Pennsylvania State University

tuc579@psu.edu

&Michelle Pistner Nixon

Pennsylvania State University

Geisinger

mpnixon@geisinger.edu

Justin D. Silverman

Pennsylvania State University

justinsilverman@psu.edu

###### Abstract

Bayesian multinomial logistic-normal (MLN) models have gained popularity due to their ability to account for the count compositional nature of microbiome data. Recently, we developed a computationally efficient and accurate approach to inferring MLN models with a Marginally Latent Matrix-T Process (MLTP) form: MLN-MLTPs. However, previous research on MLTPs has been restricted to linear models or a single non-linear process. This article addresses this deficiency by introducing a new class of MLN Additive Gaussian Process models (_MultiAddGPs_) for deconvolution of overlapping linear and non-linear processes. We show that MultiAddGPs are examples of MLN-MLTPs and derive an efficient Collapse-Uncollapse (CU) sampler for this model class. Through simulation studies, we show that MultiAddGPs accurately and efficiently decompose overlapping effects in microbiota data, which provides a powerful tool for analyzing complex count compositional datasets.

## 1 Introduction

Dysregulation of human-, animal-, and even plant-associated microbial communities (microbiota) are known to cause disease . In humans, alterations of microbiota play a causal role in obesity , inflammatory bowel disease , and even cancer . As a result, many researchers study how dietary, host physiologic, and environmental factors influence the relative abundance of different bacterial taxa in microbiota. These factors can have linear or non-linear effects on community structure . Overall, flexible statistical methods are needed to disentangle linear and non-linear effects on microbiota.

Beyond the biological complexity of microbiota, limitations of the measurement process further complicate analyses. These data are typically represented as a \(D N\) count table \(Y\) with elements \(Y_{dn}\) denoting the number of DNA molecules from taxon \(d\) observed (sequenced) in sample \(n\). The size of one sample (the sequencing depth; \(_{d=1}^{D}Y_{dn}\)) is typically arbitrary and unrelated to the total microbial load in the system . As a result, many authors call these data compositional, reflecting the idea that the data only provide information about the relative abundances of the different taxa within each community . Bayesian Multinomial Logistic Normal (MLN) models have gained popularity due to their ability to address challenges in the measurement process. . The multinomial is used to model uncertainty dueto random counting, while the logistic normal captures the extra-multinomial variability typically seen in these data . Unlike the more well-known Dirichlet distribution, the logistic-normal has a rich covariance structure which allows modeling both positive and negative covariation between taxa . The logistic-normal is also self-conjugate (as it is multivariate normal under a suitable log-ratio transformation), allowing for a wide variety of models to be built in the latent simplex space. However, the multinomial and the logistic-normal are not conjugate, making inference of these models computationally challenging or even intractable.

Recent advances have made Bayesian MLN models practical for microbiota analyses . Yet scalability limits those methods. For example, the sampler used in  took more than four hours on a high-performance cluster to analyze a dataset of approximately one thousand samples, yet only ten taxa. More recently, we proved that a wide variety of Bayesian MLN models, including generalized linear models and generalized Gaussian process regression models, share a common marginal form called a Latent Matrix-T Process (LTP) . We showed that a Laplace approximation to this marginal form was extremely accurate, leading to an efficient and accurate approximate inference procedure called the _Collapse-Uncollapse (CU)_ sampler. Our result demonstrated that this approach is often 4-5 orders of magnitude faster than HMC-based methods with minimal error in posterior calculations .

Despite these advances, there remains a dearth of tools for disentangling the effects of multiple measured factors on microbiota. Recently,  proposed an additive Gaussian process framework to address this need. Yet their approach assumed the data was transformed Gaussian, ignoring count compositional nature of these data. Moreover, our prior work with MLTPs was limited to factors that have a linear effect on microbial composition (generalized linear models) or a single factor that had a nonlinear effect (generalized Gaussian process regression models).

This article addresses the limitations of prior methods and develops a flexible, and computationally efficient approach to disentangling both linear and nonlinear effects on microbiota. As in , our approach is based on a class of additive Gaussian process regression models. Unlike , we do not assume that the data is transformed Gaussian and instead prove that Bayesian MLN Additive Gaussian Process Models are also MLTPs. Using those results, we extend the CU sampler to this class of models.

We organize this article as follows. Section 2 presents a multinomial logistic-normal generalized additive Gaussian process regression (MultiAddGP) model and proves that this model is part of the Marginally LTP class. Sections 3 demonstrate our approach through application to simulated microbiome data. Finally, we conclude with a discussion in Section 4.

## 2 Methods

To facilitate additive linear and nonlinear modeling within a Bayesian MLN framework, this article introduces Multinomial Logistic Normal Additive Gaussian Process Models (MultiAddGPs). In this section, we first present the model and demonstrate that MultiAddGPs are a specific type of MLTP model (a comprehensive review of MLTP models and Collapse-Uncollapsed (CU) sampler are provided in Appendix A). Following this, we outline the process for conducting posterior inference using an extended CU sampler in MultiAddGPs. Finally, we describe the identification problem in our model.

### Multinomial Logistic Normal Additive Gaussian Process Models (MultiAddGP)

Let \(_{ n}\) denote a \(D\)-vector of observed data, \(_{ n}\) denote a \(Q_{0}\)-vector of covariates to model linearly, and each \(_{ n}^{(k\{1,,K\})}\) denote a \(Q_{k}\)-vector of covariates to be modeled with distinct non-linear functions. The MultiAddGPs models have the following form:

\[_{ n} (_{ n})\] (1) \[_{ n} =^{-1}(_{ n})\] (2) \[_{ n}  N(_{ n},)\] (3) \[ =+_{k=1}^{K}^{(k)}(^ {(k)})\] (4)with priors \( N(^{(0)},,^{(0)})\), \(^{(k)}(^{(k)},,^{(k)})\), and \((,)\). As in the Appendix A, \(\) denotes any log-ratio transform from \(^{D}\) to \(^{D-1}\). \(\) is a \(D-1 D-1\) covariance matrix. For the matrix-normal prior on the linear term, \(^{(0)}\) is the mean matrix and \(^{(0)}\) is a \(Q_{0} Q_{0}\) covariance matrix representing covariance in the parameters of the \(Q_{0}\) covariates. The terms \(^{(k)}\) and \(^{(k)}\) in the \(K\) matrix-normal process priors echo their linear counterparts but are functions (e.g., mean and kernel functions) rather than fixed dimensional matrices. As we will show through simulated data analyses in Section 2.2, this is a very flexible form of model that can be used in a wide range of additive linear and non-linear modeling tasks.

### Posterior Estimation in MultiAddGPs

We use MLTP theory to sample from the posterior of MultiAddGPs: \(p(,,^{(1)},,^{(K)},)\). Appendix A provides a review of MLTP theory. In brief, we sample the posterior in two steps. First, we use a Laplace approximation to sample \(p()\). This is called the collapsed step of the CU sampler . In Appendix B we prove \(p()\) is a LTP and derive its parameters. We can then use results from  which provide efficient algorithms for obtaining MAP estimation and forming a Laplace approximation. For each sample of \(\) from the approximate posterior, we obtain a corresponding sample from the conditional posterior \(p(,^{(1)},,^{(K)}, )\). This is called the uncollapse step of the CU sampler . Before describing subtleties of our uncollapse algorithm, we must first clarify the definition of \(,_{1},,_{K}\).

Up to this point, we have not distinguished between the set of points \(n\{1,,N\}\) at which we have observed data \(\) and the potentially different set \(n^{*}\{1,,N^{*}\}\) at which we want to evaluate the functions \(,_{1},,_{K}\). In what follows, we use the symbols \(,_{1},,\) and \(_{K}\) to denote the evaluation of corresponding infinite-dimensional functions at the set of evaluation points \(\{1,,N^{*}\}\), i.e., they are each \(D N^{*}\)-dimensional random matrices. In contrast, all other random matrices (e.g., \(\)) represent their corresponding infinite-dimensional analogues evaluated at the set of observed points \((\{1,,N\})\).

Sampling from the uncollapsed form starts by obtaining samples from \(p(,)\). Conditioning on \(\) and marginalizing over \(^{(1)},,^{(K)}\) in the MultiAddGP model results in a Bayesian matrix-normal process model with likelihood \(_{.n} N(_{.n},)\) and priors:

\[ (^{(0)}+_{k=1}^ {K}^{(k)}(^{(k)}),\ ,\ ^{T}^{(0)}+_{k=1}^{K}^{ (k)}(^{(k)}))\] \[ (,).\]

This is the same model discussed in : samples from \(p(,)\) can be obtained via methods described in Appendix C of that article.

Finally, conditioned on samples of \(\) and \(\), we obtain samples of each \(^{(k)}\). Inspired by the backfitting algorithm used for estimation in generalized additive models , we developed a _backsampling_ algorithm for this task. The backsampling proceeds by iteratively sampling \(p()\), \(p(_{1},)\), \(p(_{2},,_{1})\), \(\), and then \(p(^{(K)},,_{1},,^{ (K-1)})\). For brevity, we leave a description of this algorithm to Appendix B and C.

### Model Identification

Identifiability is a well-known challenge in function decomposition models, such as generalized additive models . Common approaches to address this issue include imposing sum-to-zero constraints on the functions (e.g., \(^{(k)}d^{(k)}=\)) , or modifying kernel functions to enforce identifiability . For simplicity, in this work, we adopt the sum-to-zero constraint by centering posterior samples of each \(^{(k)}\) as \(^{(k)}-(^{(k)})\).

By leveraging the MultiAddGP model and the CU sampler, we provide a computationally efficient framework for disentangling linear and nonlinear effects in microbiota data while addressing the compositional nature of count data. In the section 3, we demonstrate the model's effectiveness through simulated studies, designed to capture the key challenges highlighted earlier.

## 3 Empirical Result

We simulated a suite of longitudinal studies of microbiota with varying numbers of taxa \(D\{3,,100\}\) and samples \(N\{20,,1000\}\). We simulated microbial composition influenced by batch effects, daily periodicity (e.g., circadian rhythm; ), and longer-term trends. Full simulation details are provided in Appendix D.

In Figure 1 we show a small simulation \(D=4\) and \(N=600\) for ease of visualization. We use \(t_{n}\) to denote the time at which sample \(n\) was obtained. For inference, we specify a MultiAddGP model \(_{n}=_{0}+_{1}x_{n}^{}+ ^{}(t_{n})+^{}(t_{n})\) as follows. For covariates, we set \(_{.n}=[1~{}x_{n}^{}]^{T}\), \(_{.n}^{}=t_{n}\), and \(_{.n}^{}=t_{n}\). For priors we set \(=[_{0}=2.7;_{1}=1]\). Both \(^{}\) and \(^{}\) were given matrix-normal process priors with mean function \(^{(k)}=\). A periodic kernel \(K_{}(t,t^{})=_{}(-(|}{p})}{_{}^{2}})\) was used in the prior for \(^{}\) and a squared exponential \(K_{}(t,t^{})=_{}^{2}(-)^{2}}{2_{}^{2}})\) was used for \(^{}\). Hyperparameters \(=\{_{},_{},p,_{}, _{}\}\) were selected using MML estimation.

For comparison, we created a nearly identical model that ignored uncertainty due to counting and assumed the data was transformed Gaussian. We implemented this model by setting \(_{.n}=(Y_{.n}+0.5)\) and proceeding with the uncollapse step of MultiAddGPs directly; skipping sampling the posterior of the collapsed form. We call this model the _Normal Additive GP (NAddGP)_ model.

We compared posterior estimates from the MultiAddGP and NAddGP models to emphasize the importance of modeling uncertainty due to counting. Figure 1 shows that the MultiAddGP almost perfectly recovered the true decomposition whereas the NAddGP substantially underestimated the amplitude of the periodic component and long-term trend.

Figure 2 shows these findings generalize as \(N\) and \(D\) increase. As the posterior of these high-dimensional models cannot be easily visualized, we quantified model performance based on the coverage of posterior 95% intervals with respect to the true function decomposition. Since both MultiAddGP and NAddGP are Bayesian models we do not expect that these intervals will cover

Figure 1: **MultiAddGPs successfully decompose simulated microbiome time-series.** The NAddGP model is identical to the MultiAddGP model but ignores uncertainty due to counting by modeling the observed data as transformed Gaussian. Panels A, B, and C represent individual decomposed components associated with each covariate. Panel D illustrates the cumulative effect of all components. Note: This figure is also included in an extended version of this work currently under review for journal publication .

the truth with 95% probability. As a result, we focus on the ratio of coverage between the MultiAddGP and the NAddGP. Positive values of this coverage ratio indicate that the MultiAddGP model covers the truth more often than the NAddGP model. In all simulations, at all sample sizes \(N\) and number of taxa \(D\), the MultiAddGP models covered the truth more frequently than the NAddGP models.

## 4 Conclusion & Future Work

We have introduced MultiAddGPs, a Bayesian Multinomial Logistic-Normal additive regression model designed to address the statistical challenges of analyzing microbiota data. By incorporating recent advancements in Marginally Latent Matrix-t Processes (MLTPs), we developed computationally efficient inference methods, now implemented in the _fido_ R package since version 1.1.0 . Our simulations demonstrate that MultiAddGPs effectively disentangle linear and nonlinear effects, which highlight their potential for real-world applications. Looking ahead, our ongoing work focuses on applying MultiAddGPs to large-scale microbiome datasets to extract biologically meaningful insights and developing robust methods for hyperparameter selection, such as optimizing kernel parameters.