# Reasoning Multi-Agent Behavioral Topology for

Interactive Autonomous Driving

 Haochen Liu\({}^{1,2}\) Li Chen\({}^{2,3}\) Yu Qiao\({}^{2}\) Chen Lv\({}^{1}\) Hongyang Li\({}^{2,3}\)

\({}^{1}\) Nanyang Technological University \({}^{2}\) Shanghai AI Lab \({}^{3}\) University of Hong Kong

###### Abstract

Autonomous driving system aims for safe and social-consistent driving through the behavioral integration among interactive agents. However, challenges remain due to multi-agent scene uncertainty and heterogeneous interaction. Current dense and sparse behavioral representations struggle with inefficiency and inconsistency in multi-agent modeling, leading to instability of collective behavioral patterns when integrating prediction and planning (IPP). To address this, we initiate a topological formation that serves as a compliant behavioral foreground to guide downstream trajectory generations. Specifically, we introduce **Behavioral Topology (BeTop)**, a pivotal topological formulation that explicitly represents the consensual behavioral pattern among multi-agent future. BeTop is derived from braid theory to distill compliant interactive topology from multi-agent future trajectories. A synergistic learning framework (BeTopNet) supervised by BeTop facilitates the consistency of behavior prediction and planning within the predicted topology priors. Through imitative contingency learning, BeTop also effectively manages behavioral uncertainty for prediction and planning. Extensive verification on large-scale real-world datasets, including nuPlan and WOMD, demonstrates that BeTop achieves state-of-the-art performance in both prediction and planning tasks. Further validations on the proposed interactive scenario benchmark showcase planning compliance in interactive cases. Code and model is available at https://github.com/OpenDriveLab/BeTop.

+
Footnote †: Work done while Haochen’s internship at Shanghai AI Lab. \({}^{}\) Equal co-advising.

## 1 Introduction

Autonomous driving system aspires to safe, humanoid, and socially compatible maneuvers . This drives for formulation, prediction, and negotiation of collective future behaviors among interactive agents and autonomous vehicles (AVs) . Remarkable accuracy is achieved by learning-based paradigms , including end-to-end modular design [4; 5; 6; 7], social modeling [8; 9], and trajectory-level integration [10; 11; 12; 13]. However, substantial challenges arise in real-world cases due to scene uncertainty and volatile interactive patterns for multi-agent future behaviors.

To embrace compliant patterns for multi-agent future behaviors, current formulations fall into two mainstreams, dense representation and sparse representation (Fig. 1). Dense representation quantizes agent behaviors under ego-centricization, forecasting bird's eye view (BEV) occupancy probabilities [14; 7; 15] or temporal flow [16; 17; 18]. It is easy to deduce interactions, perform scalable behaviors for agents , and align with BEV perceptions . Still, dense representation is hindered by frozen receptions. It causes safety-vulnerable intractability and occlusions potentially interacting with ego maneuvers [16; 21]. Contrary to pixel-wise behavioral probability, sparse representation forecasts agent-anchored set of trajectories [22; 23; 24; 25] or intention distributions [10; 26; 27]. Its multi-modal formulation for each agent marks the elasticity in diverse behavioral uncertainty and tractability under flexible spatial semantics. However, behavioral misalignment  and modality collapse impede compliant multi-agent modeling, requiring exponential computations with growth agent numbers . Issues particularly result in unstable and slow behavioral learning when exposed to predictions and planning (IPP) . Typical solutions by conditional prediction [31; 28; 32] or game-theoretic reasoning [8; 33] often lead to nonstrategic maneuvers  due to non-compliant rollouts in adjusting interactive behaviors. This calls for a re-formulation for multi-agent behaviors, which should stabilize collective behavioral patterns in a compliant manner for IPP objectives.

The decision-making process for human drivers provides valuable insights. Humans primarily determine the future behavior of interacted agents for decision-making without relying on their specific states [2; 36]. Thus, an effective strategy involves assessing agent-wise behavioral impact on planning maneuvers, and reasoning about compliant interactions. Our fundamental insight is that compliant multi-agent behaviors exhibit topological formations, which can be identified by distilling consensual interactions from future behaviors. Prior works have approached this challenge through structural design [37; 38] or implicit relational learning [39; 40; 41] using GNNs  or Transformers . Other studies quantify uncertainty by topological properties [44; 45]. Nevertheless, current literature is scarce in formulating explicit future supervision of compliant multi-agent behavioral patterns.

To this end, we launch the multi-agent behavior formulation termed as _Behavioral Topology_ (BeTop). At its core, BeTop explicitly forms the topological supervision of consensual multi-agent future interactions, and reasons to guide prediction and planning. BeTop stems from braid theory , which infers compliant interactions of multiple paths from the intertwining of their braids. This empowers BeTop to intuitively distill forward intertwines (occupancy) as joint topology from braided multi-agent future trajectories (Fig. 1), marrying dense and sparse representation. With the aid of BeTop, we introduce a synergistic Transformer-based learning stack, BeTopNet, for learning IPP objectives. To implement, an iterative decoding strategy simultaneously reasons about Behavioral Topology and generates trajectory sets. Then the topology-guided local attention, embedded in each decoder layer, selectively queries behavioral semantics from social-compliant agents within the predicted BeTop priors. To further alleviate multi-agent uncertainty through topological guidance, a contingency planning paradigm is fitfully deployed. We lay out the imitative contingency learning process, which regulates the safety-ensured short-term plan. It maintains the long-range uncertainty by reasoned joint predictions from BeTop. Experimental results exhibit enhanced consistency and accuracy for prediction and planning in real-world scenarios. Testing in proposed interactive cases further highlights the planning ability of BeTopNet. To sum up, our contributions are three-fold:

* We bring in the concept of Behavioral Topology, a multi-agent behavioral formulation for topological reasoning that explicitly supervises consensual future interactions jointly for the IPP system.
* A synergistic learning framework BeTopNet, offering joint planning and prediction guided by topology reasoning, is devised. Topology-guided local attention and imitative contingency planning could resolve scene compliance and multi-agent uncertainty.
* Benchmarking on nuPlan  and WOMD , our approach demonstrates strong performance in both planning strategy and prediction accuracy. BeTopNet witnesses evident improvement

Figure 1: **Multi-agent Behavioral Formulation. (a)** A typical driving scenario in Arizona, US ; **(b)** Dense representation conducts scalable occupancy prediction jointly, but restrained reception leads to unbounded collisions with planning; **(c)** Sparse supervision derives multi-agent trajectories with multi-modalities, while it struggles with conflicts among integrated prediction and planning; **(d)** BeTop reasons future topological behaviors for all scene-agents through braids theory, funneling interactive eventual agents (in highlighted colors) and guiding compliant joint prediction and planning.

over previous counterparts, _e.g._, \(+7.9\%\) in general planning score, \(+3.8\%\) under interactive cases, \(+4.1\%\) mAP for joint prediction, and \(+2.3\%\) mAP for marginal prediction.

## 2 Related work

**Multi-agent behavioral modeling.** Carving the collective future behavior of diverse agents is imperative for socially-consistent driving maneuver. Earlier approaches centered around occupancy prediction [14; 48; 5; 4]. Forecasting the spatial presence under dense BEV representation [49; 20] offers flexibility of arbitrary agents [17; 50; 19] and alignment with perception [7; 51]. However, rigidity in resolution induces scenario occlusion , rendering intractable occupancy . In parallel, sparse representation consolidates multi-agent behavior into cohesive modalities across future trajectories [52; 53; 54; 22] or intentions [27; 10; 26; 55]. Joint future behaviors are derived through goal-based sampling or recombination from marginal predictions [56; 57; 58]. However, the collection of joint modalities is susceptible to mode collapse and entails exponential complexity [29; 59]. Meanwhile, topological representation has garnered traction as motion primitives [60; 61] or tools [44; 45] for scenario quantification, yet topological properties delineating collective future behaviors remain largely unexplored. Our BeTop targets the issue, marrying dense behavior probabilities by topology with the sparse motion from joint predictions to present structured future behaviors.

On the other hand, inconsistent communal agent behaviors have motivated leveraging future interactions. Implicit approaches obtain tacit interactions with attention [62; 32; 63] or GNN [64; 37; 24; 37] from final motion regressions. Nonetheless, the implicit supervisions are found inefficient in dynamic scenarios . Contrarily, explicitly reasoning mutual behaviors by conditional factorization [31; 66], relation reasoning [41; 40], or entropy-based methods [67; 68] offer consistent behavioral priors. However, hefty variance across agent dynamics and scenario geometries yield unstable inference. Distinguished from them, BeTop crafts a compact topological supervision that stabilize future interactions among multi-agent behaviors. Derived from topological braids, BeTop offers a topological equivalent behavioral representation to guide compliant forecasting and planning.

**Integrated prediction and planning.** IPP system aims to harmonize trajectory-based learning of future interactive behaviors between the ego vehicle and social agents. Rule-based approaches [69; 70; 71] integrate handcrafted future interactions to evaluate candidate planning profiles, offering remarkable outcomes in rule-powered reactive simulation . Still, the absence of real-world behaviors exhibits significant gaps in interactive scenarios. Learning-based methods yield imitative planning by integrating predictions within holistic modeling [72; 73; 74]. However, history-based coalitions pose challenges in supervising future homology among agents. Recently, hybrid pipelines [75; 8] have utilized post-processing and optimization upon learning-based models to realize behavior interactions among predictions and planning. This can entail significant computational overhead, and imitative planning tends to overestimate hereditary uncertainty in behavior predictions. Tree-based [10; 27] and contingency-enabled [76; 11] works seek to balance planning preemption and aggression in the face of behavior uncertainty. Nonetheless, pipelines without holistic interactions fall into passive planning maneuvers and incur high exponential cost for predictions. In our work, BeTop provides an explicit prior for future interactive behaviors which enhances compliant trajectory generations. Moreover, the synergistic prediction and contingency planning networks with BeTop effectively manage behavioral uncertainty.

## 3 Behavioral Topology

Presenting BeTop, we commence the Behavioral Topology formulation and task statement of IPP for autonomous driving in Sec. 3.1. Then, we demonstrate the BeTopNet network architecture (Fig. 3) for topological reasoning and IPP generation in Sec. 3.2. Finally, in Sec. 3.3, we propose the imitative contingency learning process by topological guidance for the proposed network.

### Formulation

**Problem formulation.** We consider the driving scenario with \(N_{a}\) agents as \(A_{1:N_{a}}\) at presence \(t=0\), along with the scenario map \(\). The states over historical horizon \(T_{h}\) are denoted as \(_{1}\) for AV and as \(_{2:N_{a}}\) for scenario agents, respectively, where \(_{n}=\{^{-T_{h}:0}\}_{n}\), \(n[1,N_{a}]\). The objective for integrated prediction and planning is to jointly predict scene agents' trajectories \(_{2:N_{a}}\) as well as AV planning \(_{1}\) over a future horizon \(T_{f}\) as \(_{n}=\{^{1:T_{f}}\}_{n}\), \(n[1,N_{a}]\).

**Topological formulation.** We leverage the braid theory , which probes explicit formulations for compliant multi-agent interactions from future data \(_{1:N_{a}}\). Intuitively, it denotes a transform process for \(_{1:N_{a}}\) with respective agent coordinates, and then gathers each future forward intertwine (occupancy) as joint interactions. Formally, consider the braid group \(_{N_{a}}=\{_{n}\}\) by \(N_{a}\) primitive braids \(_{n}\), each of which \(_{n}=(f_{1}^{n},,f_{N_{a}}^{n})\) denotes a tuple of monotonically increased functions \(f:^{3}^{2} I\) mapping from Cartesian \(,,\) to lateral coordinate \(,\) for agent future \(\). Specifically, the function \(f_{i}^{n}\) in \(_{n}\) is defined as \(f_{i}^{n}(_{i}-_{n})_{n};1 i,n  N_{a}\), where \(_{n}\) and \(_{n}\) denote the left-hand transform matrix to local coordinate of agent \(A_{n}\). The joint interactive behaviors are identified as a set of braids having intertwines \(\{_{n}^{}\}_{N_{a}}\) over others , as shown in Fig. 2. Opposite to implicit methods [22; 67; 41] banking on future distance heuristic, each intertwine in the braid can signify an explicit behavioral response, distinguishing between assertive (\(_{n}^{+}\), elicit yielding from others) and passive (\(_{n}^{-}\), yield to others) maneuvers. To avert difficulties in dynamic braid set inference, we redraft multi-agent braids from a topology reasoning perspective.

Named by BeTop, the goal is to reason a topological graph \(=(,)\) for multi-agent future behaviors (Fig. 2). Expressly, node topology \(=\{_{n}\}\) is denoted by multi-agent future trajectories. We can then reformulate the braid set \(\{_{n}^{}\}\) as an edge topology \(e_{ij}^{N_{a} N_{a}};1 i,j N_{a}\) for future interactive behaviors. Each topology element \(e_{ij}\) can be defined by two braid functions \(f_{i}^{i},f_{j}^{i}_{i}\) assessing the future intertwines along with \(_{i},_{j}\) as: \(e_{ij}=_{t}(f_{i}^{i}(_{i}^{t}),f_{j}^{i}( _{j}^{t}))\). Here \(\) is an intertwine indicator by segment intersection  under lateral coordinates. With favorable properties proved in Appendix B, we can formulate the reasoning task as:

\[^{*}=(},}).\] (1)

Agent future \(}\) in node term \(}\) is defined by Gaussian mixtures (GMM) and optimized in Sec. 3.3. The edge topology reasoning \(}\) can be specified as a probabilistic inference problem by:

\[}=_{i}_{j}e_{ij}}+(1-e_{ij}) (1-}),\] (2)

where \(1 i,j N_{a}\). Synergistic reasoning structures are then established optimizing \(^{*}\).

**Comparative analysis.** To highlight BeTop's position among various formulations, we first conduct a preliminary analysis to assess behavioral similarity by retrieving future interactive agent pairs using human annotations . Human likeness is quantified by classification metrics, including accuracy and the area under the curve (AUC), with annotated interactive IDs. As depicted in Table 1, labeled BeTop achieves the closest behavioral similarity compared with other well-accepted formulations in the community. Compared with retrieving \(k\) nearest strategy (\(k=6\)) by ground-truth future states, we observe advanced differentiation in non-interactive behaviors (\(+16.1\%\) Acc., \(+4.13\%\) AUC) by BeTop. We then look into the generic learning-based structure by attention  or dynamic graph  for interactive behaviors. Despite high accuracy, their inferior AUC scores imply difficulties in retrieving precise interactivity compared with BeTop (\(+19.9\) AUC). We refer analytical content in Appendix B. This draft for a reasoning framework BeTop prompting joint behaviors.

### BeTopNet

As presented in Fig. 3, we introduce the synergistic learning framework reasoning BeTop in response to the series of challenges. It encompasses a Transformer backend encoder-decoder network. With

   Behavioral &  \\ Formulations & Acc. \(\) & AUC \(\) \\  _Expert_ & \(1.000\) & \(1.000\) \\  GT top-\(k\) & 0.833 & 0.702 \\ Local attention  & 0.951 & 0.522 \\ JFP graph  & 0.955 & 0.500 \\ 
**BeTop (Ours)** & **0.967** & **0.731** \\   

Table 1: **Analysis on different behavioral formulations.** BeTop labels behave most similarly to human annotations , excelling over other formulations like \(k\) nearest GT or local attention.

Figure 2: **BeTop formulation.** Joint future trajectories are transformed to braid sets, and then form joint topology through intertwine indicators.

encoded scene semantics \(;\), the proposed network features a synergistic decoder which reasons and guides BeTop. Reason heads for topology \(}\) and IPP for \(}\) comprise the behavioral graph \(\).

**Scene encoder.** We leverage a scene-centric coordinate system following planning-oriented principle . Scene attributes comprise historical agent states \(^{N_{n}\ T_{h} D_{n}}\) and map polyline inputs \(^{N_{m}\ L_{m} D_{m}}\), where we portion \(N_{m}\) map segments with length \(L_{m}\) from full scene map. Both attributes are encoded separately as \(_{A}^{N_{n} D}\) and \(_{M}^{N_{m} D}\) and concatenated as scene features \(=[_{A};_{M}]^{(N_{n}+N_{m}) D}\). A stack of Transformer encoders with local attention are directly employed in capturing regional interactions from encoded scene semantics \(_{A},_{M}\).

**Synergistic decoder.** Retaining encoded scene features \(_{A},_{M}\), we zoom in the decoding strategy that asks for: 1) interactively reason simultaneous BeTop formulations; 2) selectively decoding of compliant interactive semantics leveraging reasoned topology priors. To this end, we introduce the iterative process of \(N\) Transformer decoder layers contributed to all agents, pursuing the basis from . To iron out the scene uncertainties, a multi-modal set of \(M\) decoding queries \(_{A}^{0}^{M D}\) are initialized for multi-agent future trajectories. Meanwhile, relative attributes \(_{R}^{N_{n} N_{n} D_{R}}\) are deployed through MLPs as topology features \(_{R}^{0}^{N_{n} N_{n} D}\) for edge topology reasoning.

Next, we devise dual infostreams to the iterative decoding process for \(}\) of future trajectories and \(}\) of future topology. Given agent \(A_{n}\), the decoding process in layer \(l\) follows:

\[_{R}^{l,n}=(_{A}^{l-1,n},_{R}^{l-1,n},_{A}),_{n}^{l}=( _{R}^{l,n}),\] (3)

\[_{A}^{l,n}=(_{A}^{l-1,n}, _{A},_{M},}_{n}^{l-1},_{n}^{l}),}_{n}^{l}=(_{A}^{l,n}),\] (4)

where both future trajectories \(}_{n}}\) and interactive topology \(_{n}}\) in BeTop are decoded in synergistic manners. Reasoned edge topology \(_{n}^{l}^{M N_{n}}\) are garnered by topological decoder with query broadcasting \(_{A}^{l-1,n}\); Reasoning nodes for \(}_{n}\), a Transformer decoder with topology-guided local attention are drafted serving \(_{n}^{l}\) as priors. We provide further details in Appendix C.1.

**Topology-guided local attention.** Querying whole-scene agent semantics results in misaligned interactive agents and sparse attention. This motivates our design for local attention guided by the reasoned topology \(_{n}^{l}^{M N_{a}}\) as priors. Specifically, we retrieve the top-\(K\) index \(_{n}^{l}^{M K}\) priored from \(_{n}^{l}\) for eventual interactive agents behaviors with \(A_{n}\). Interactive indices are directly leveraged in gathering \(_{A}\) selectively for local cross-attention. This process is formed as:

\[_{A}^{l,n}=(_{A}^{l-1,n}, _{A},_{n}^{l})(q=_{A}^{l-1,n};k,v=_{A}^{i_{n}^{l}}),\] (5)

where \(_{n}^{l}=*{argmax}_{K}(_{n}^{l})\). Topology-guided agent features \(_{A}^{l,n}\) are then aggregated in each layer.

Figure 3: **The BeTopNet Architecture.** BeTop establishes an integrated network for topological behavior reasoning, comprising three fundamentals. Scene encoder generates scene-aware attributes for agent \(_{A}\) and map \(_{M}\). Initialized by \(_{R}\) and \(_{A}\), synergistic decoder reasons edge topology \(_{n}^{l}\) and trajectories \(}_{n}^{l}\) iteratively from topology-guided local attention. Branched planning \(}_{1}\) with predictions and topology are optimized jointly by imitative contingency learning.

**Reason heads.** Given respective decoding features \(_{R}^{l,n}\) and \(_{A}^{l,n}\) for each layer, we affix reason heads accustomed to corresponding formulations for \(_{n}\) and \(}_{n}\). Referred in Eq. (3), the topology head, planning head, and prediction head (IPP heads) are jointly devised by stacked MLPs in reasoning BeTop results. For agent \(A_{n}\) in each layer, reason heads decode GMM components of future states \(}_{n}^{M T_{f} 5}\) (referring to \((_{x},_{y},_{x},_{y},)\) per step) with mixture score \(}_{n}^{M}\),\(\{}_{n},}_{n}\}}_{n}\), as well as interactive edge topology \(_{n}^{l}^{M N_{a}}\) for BeTop.

### Imitative Contingency Learning

Pursuing the target in Eq. (1), BeTopNet learns end-to-end objectives imitating human-like multi-agent behaviors, integrating compliant behaviors by contingency planning under scenario uncertainties.

**Imitation learning.** Imitation objectives are firstly established in regulating multi-agent behavioral states \(\{}_{n}\}}\) while maximizing their interactive distributions \(}\). The imitative objective for \(}\) is defined by the negative log-likelihood (NLL) from best-reasoned components \(m^{*}\) closest to ground-truths, as denoted: \(_{}=_{t}^{T_{f}}_{}(}_{n}^{m^{*},t},}_{n}^{m^{*}},_{n})\). Followed Eq. (2), the behavioral distributions for edge topology are computed by binary cross-entropy (BCE) given gathered \(_{n}^{m^{*}}^{N_{a}}\), formulated as \(_{}=_{j}^{N_{a}}(_{n,j}^{m^{*}},e _{n,j})\) over \(N_{a}\) agents jointly.

**Integrated contingency planning.** To integrate compliant behavior learning for \(\) amidst multi-agent scenario uncertainties, contingency planning [79; 76] is turned out an apt solution. Bridging immediate safe maneuvers \(_{M}\) to branched planning sets \(\{_{J}\}\) with joint prediction, it adjourns uncertain decisions and ensures actual safety. While direct joint prediction may lose diversity , reasoned topology \(}\) serves as a suitable medium distilling future interactive agents for efficient joint combination. Given imitative AV planning outputs \(}_{1}\) with branching time \(t_{b}(1,T_{f})\), integrating contingency learning asks for a safe short-term plan \(_{M}_{M},_{M}^{M t_{b} 2}\) to full marginal predictions \(_{M}=}_{2:N_{a}}\), as well as \(M\) branched planning sets \(_{J}^{m}=\{_{J}^{1:M_{b}}\}_{m}\) guided by joint predictions \(_{J}^{m}\). This is defined by:

\[_{M}^{*}=*{argmin}_{}_{1}}_{ }C_{M}(_{M},_{M})+_{m}P(_{J}^{m})C_{J} (_{J}^{m},_{J}^{m}),\] (6)

where \(_{}C_{M}\) denotes worst-case cost fir \(_{M}\); Joint predictions \(_{J}\) with scene probabilities \(P(_{J})\) are recombined by \(K_{M}\) interactive agent subsets, indexing \(_{}^{K_{M}}\) from sorted AV topology: \(_{}=*{argmax}_{K_{M}}(_{M}_{1})\). It is described by joint costs \(C_{J}\) in guiding branched planning maneuvers. Specifically, both cost functions are defined by the repulsive potential field  discouraging planning proximity with respective prediction formulations.

**Training loss.** BeTopNet is trained end-to-end through imitative objectives and contingency planning costs by weighted integration for each layer, whenever applicable (for the datasets). Please refer to Appendix C.2 for additional details.

## 4 Experiment

With preliminary analysis in Sec. 3.1, this section further discovers the following questions: **1)** Can BeTop perform compliant planning via BeTopNet, especially in interactive scenarios? **2)** Can BeTop achieve accurate marginal and joint predictions of heterogeneous agents under diverse real-world cases? **3)** Can the formulated BeTop facilitate existing state-of-the-art prediction and planning methods? and **4)** How do the functionalities in BeTopNet affect the performance?

**Benchmark and metrics.** BeTop is verified on diverse benchmarks. We leverage two large-scale real-world datasets, _i.e._, nuPlan  and Waymo Open Motion Dataset (WOMD) , which are presently the most diverse motion datasets in manifesting planning and prediction performance. For planning tasks in nuPlan, there are in total 1M training cases with 8s horizons. 8,300 separated testing set are chosen by _Test14-Hard_ and _Test14-Random_ benchmarks  for hard-core and general driving scenes. With further demands verifying maneuvers under interactive cases, we build the _Test14-Inter_ benchmark filtering 1,340 scenes by testing set. Scenarios ranging 15 seconds are tested under three tasks: 1) open-loop (OL), 2) close-loop non-reactive (CL-NR) simulations, and 3) reactive(CL-R) ones by nuPlan simulator. We report the official Planning Scores  computed by each task. The motion prediction tasks in WOMD share 487k training scenarios, with 44k validation and 44k testing set separately partitioned under two challenges: 1) The _Marginal prediction challenge_ forecasting multiple scene agents independently; 2) The _Joint prediction challenge_ predicting joint trajectory collections by two interactive agents. Primary metrics of mAP and Soft mAP are ranked for official leaderboards [81; 82]. We leave experimental details in Appendix D.

### Main Result

**Performance for interactive planning.** Table 2 demonstrates the planning results under difficult and regular test cases. Notably, BeTopNet marks top average planning scores, achieving \(+7.9\%\) in hard cases and excels \(+6.2\%\) (CLS-NR) in closed-loop simulations. Specifically, it gains solid improvements against learning-based planners. This can be attributed to topological formulations learning stabilized joint behavioral patterns, boosting \(+6.2\%,+4.3\%\) non-reactive simulations by real-world logs and enhancing reactive simulation (\(+11.5\%,+6.3\%\)). Contingency objectives enhance uncertainty compliance, leading to expanded results in hard scenarios. Meanwhile, BeTopNet also outperforms rule-based and hybrid planning agents asking for post-optimizations  or hefty rules in coinciding with reactive simulation setups [69; 70]. We report \(+15.8\%\) and \(+18.4\%\) results of non-reactive simulation in hard cases and close performance in general scenes. Moreover, interactive planning compliance is also verified in the proposed _Test14-Inter_ benchmark centering on interactive scenarios. As in Table 3, BeTopNet fosters \(+3.8\%\) planning score over previous methods, marking \(+5.5\%\) driving progress and \(+2.9\%\) driving compliance closest to human performance. Qualitative results of interactive scenarios in Fig. 5(a-d) further corroborate planning compliance by BeTop.

**Performance for marginal and joint motion prediction.** Marginal prediction results are in Table 4. Without the aids of model ensembles or extra data [25; 59], BeTopNet outperforms existing approaches, manifesting \(+2.7\%\) and \(+3.4\%\) mAP metrics comparing concurrent methods [86; 53] for compliant predictions. Exhibited strong prediction displacement metric (\(-4.3\%\) minFDE) over methods using extra pretraining , it should be noted that displacement metric is less illustrative as it discounts uncertainty scoring. BeTopNet further outperforms \(+6.0\%\) and \(+26.1\%\) Soft mAP over multi-agent predictors solely leveraging scenario attention  or graph . N. Table 5 exhibits the

    &  &  &  \\  & & OLS \(\) & CLS-NR \(\) & CLS \(\) & Avg.\(\) & OLS \(\) & CLS-NR \(\) & CLS \(\) & Avg.\(\) \\  _Expert_ & _Log Replay_ & 1.000 & 0.860 & 0.688 & 0.849 & 1.000 & 0.940 & 0.759 & 0.900 \\   & IDM  & 0.201 & 0.562 & 0.623 & 0.462 & 0.342 & 0.704 & 0.724 & 0.590 \\  & PDM-Closed  & 0.264 & 0.651 & 0.752 & 0.556 & 0.463 & 0.901 & 0.916 & 0.760 \\   & GameFormer  & 0.753 & 0.666 & 0.688 & 0.702 & 0.794 & 0.808 & 0.793 & 0.798 \\  & PDM-Hybrid  & 0.738 & 0.660 & 0.758 & 0.719 & 0.822 & 0.902 & 0.916 & 0.880 \\   & UrbanDriver  & 0.769 & 0.515 & 0.491 & 0.592 & 0.824 & 0.633 & 0.610 & 0.689 \\  & PDM-Open  & 0.791 & 0.335 & 0.358 & 0.495 & 0.841 & 0.528 & 0.572 & 0.647 \\  & PlanCNN  & 0.524 & 0.494 & 0.522 & 0.513 & 0.629 & 0.697 & 0.675 & 0.667 \\  & GC-PGP  & 0.738 & 0.432 & 0.396 & 0.522 & 0.773 & 0.560 & 0.514 & 0.616 \\  & PlanTF  & 0.833 & 0.726 & 0.617 & 0.725 & 0.871 & 0.865 & 0.806 & 0.847 \\  & **BeTopNet (Ours)** & **0.840** & **0.771** & **0.688** & **0.766** & **0.876** & **0.902** & **0.857** & **0.878** \\   

Table 2: **Performance comparison of open- and closed-loop planning on nuPlan benchmarks.** BeTopNet positions top average planning score and non-reactive simulation amongst SOTA planning systems by all types (rule, learning, and hybrid), especially under difficult benchmarked scenarios.

    &  &  \\  & & Col. Avoid \(\) & Divable \(\) & Direction \(\) & Progress \(\) & TTC \(\) & Comfort \(\) & **PDMScore \(\)** \\  _Expert_ & _Log Replay_ & 1.000 & 1.000 & 1.000 & 0.881 & 1.000 & 0.999 & 0.950 \\  Rule & PDM-Closed  & 0.886 & 1.000 & 1.000 & 0.818 & 0.853 & 0.999 & 0.833 \\   & Constant Acc. & 0.449 & 0.509 & 0.651 & 0.048 & 0.419 & **1.000** & 0.108 \\  & UrbanDriver  & 0.970 & 0.955 & 0.992 & 0.798 & 0.932 & **1.000** & 0.854 \\  & PlanCNN  & 0.902 & 0.895 & 0.973 & 0.678 & 0.859 & 0.999 & 0.720 \\  & PlanTF  & 0.982 & 0.946 & 0.992 & 0.825 & **0.952** & 0.999 & 0.871 \\  & **BeTopNet (Ours)** & **0.983** & **0.960** & **0.999** & **0.859** & 0.950 & 0.999 & **0.894** \\   

Table 3: **nuPlan closed-loop planning results on the proposed interactive benchmark.** BeTopNet achieves desirable PDMScore, with planning safety, road compliance, and driving progress.

joint prediction results. BeTopNet outperforms all methods in both mAP metrics (\(+4.1\%,+3.7\%\) Soft mAP and mAP), presenting robust prediction compliance credit to BeTop formulations for stable future interaction patterns and aligned by local attention in BeTopNet. Particularly, BeTop shows interactive compliance, improving \(+5.1\%\) mAP over recent auto-regressive approaches , boosting \(+25.4\%\) mAP with game-theoretic methods  by a large margin. Fig. 5 (e-h) demonstrates the qualitative prediction performance by BeTopNet. At the time of submission, BeTopNet ranked \(1^{st}\) on both WOMD prediction leaderboards [82; 81].

### Ablation Study

Instructed by the last two motivating questions, we investigate the effect of BeTop formulations and components inside BeTopNet. For efficient study, we randomly partition \(20\%\) of WOMD train set for prediction, and directly report the planning results by _Test14-Random_ benchmark, which are both representative for the original datasets as verified by [22; 73].

**Synergy with existing state-of-the-art methods.** We first study the effect adjoining BeTop as synergistic objectives over existing SOTA methods in planning and prediction. Described in Table 6 and Table 7, BeTop augments \(+2.1\%\) and \(2.0\%\) planning score with learning-based and rule-based planners, respectively. Similar compliance effects are also witnessed in guiding strong motion predictors, bringing \(+1.1\%,+2.4\%\) improved mAP with \(-1.7\%\) prediction errors of minADE.

**Number of interactive agents for topology-guided local attention.** In determining the number \(K\) future interactive agents for BeTopNet in local attention, we validate the prediction mAP under an array of agent numbers. Shown in Fig. 4, we observe a converging effect, with maximum \(+3.7\%\) mAP by the growing number of interactive agents. A drop of \(-1.8\%\) mAP is captured after the peak performance of \(K=32\). It is due to falsely accepting non-interactive agent values by large \(K\).

**Different functionalities in BeTopNet.** We further investigate the effects of different functionalities for BeTopNet in Table 8. Compared to the full model, ablations in ID.1 and ID.2 underscore the imitative contingency learning process for costs (\(-2.9\%\) CLS) and contingency branching (\(-1\%\) CLS-NR). Sole imitative BeTopNet performs the best OLS (ID.2), while the stabilizing effects found in Sec. 4.1 are verified (\(-2.8\%\) CLS-NR) in comparing ID.3-ID.5 for joint interactive patterns.

   Set split & Method & minADE \(\) & minFDE \(\) & Miss Rate \(\) & mAP \(\) & **Soft mAP\(\)** \\   & ReCoAt  & 0.7703 & 1.6668 & 0.2437 & 0.2711 & - \\  & HDGT  & 0.5933 & 1.2055 & 0.1854 & 0.3577 & 0.3709 \\  & MTR  & 0.6050 & 1.2207 & 0.1351 & 0.4129 & 0.4216 \\  & MTR+ & 0.5906 & 1.1939 & 0.1298 & 0.4329 & 0.4414 \\  & MGTR\({}^{}\) & 0.5918 & 1.2135 & 0.1298 & 0.4505 & 0.4599 \\  & EDA  & **0.5718** & 1.1702 & **0.1169** & 0.4487 & 0.4596 \\  & ControlMTR  & 0.5897 & 1.1916 & 0.1282 & 0.4414 & 0.4572 \\  & **BeTopNet (Ours)** & 0.5723 & **1.1668** & 0.1176 & **0.4566** & **0.4678** \\   & MTR  & 0.6046 & 1.2251 & 0.1366 & 0.4129 & - \\  & EDA  & **0.5708** & 1.1730 & 0.1178 & 0.4353 & - \\  & **BeTopNet (Ours)** & 0.5716 & **1.1640** & **0.1177** & **0.4416** & - \\   

Table 4: **Performance of marginal prediction on WOMD Motion Leaderboard.** BeTopNet surpasses existing motion predictors without model ensemble or using extra data. \({}^{}\) extra LIDAR data and pretrained model. Primary metric.

   Set split & Method & minADE \(\) & minFDE \(\) & Miss Rate \(\) & **mAP \(\)** & Soft mAP \(\) \\   & HeatRm4  & 1.4197 & 3.2595 & 0.7224 & 0.0804 & - \\  & M2I  & 1.3506 & 2.8325 & 0.5538 & 0.1239 & - \\  & GameFner  & 0.9721 & 2.2146 & 0.4933 & 0.1923 & 0.1982 \\  & AMP  & 0.9073 & 2.0415 & 0.4212 & 0.2294 & 0.2365 \\  & MTR++  & **0.8795** & **1.9505** & **0.4143** & 0.2326 & 0.2368 \\  & **BeTopNet (Ours)** & 0.9744 & 2.2744 & 0.4355 & **0.2412** & **0.2466** \\   & MTR  & 0.9132 & 2.0536 & 0.4372 & 0.1992 & - \\  & AMP  & **0.8910** & **2.0133** & 0.4172 & 0.2344 & - \\  & **BeTopNet (Ours)** & 0.9304 & 2.1340 & **0.4154** & **0.2366** & - \\   

Table 5: **Performance of joint prediction on WOMD Interaction Leaderboard.** BeTopNet outperforms in both mAP metrics. Primary metric.

## 5 Conclusion

In this paper, we present BeTop, a topological new-look for multi-agent behavioral formulation. Derived by braid theory, the reasoning tasks for BeTop are drafted supervising joint interactive patterns with integrated prediction and planning. A synergistic network, BeTopNet, is established with an imitative contingency learning process to boost compliant BeTop reasoning. Experiments on nuPlan and WOMD verify BeTopNet's state-of-the-art performance in prediction and planning.

**Limitation and Future work.** Current BeTop considers one-step future topology alone, and focuses on prediction and planning. Future work would be centered on developing a recursive version of BeTop in multi-step, multi-agent reasoning and coordination. Another promising direction would be the connectivity of BeTop upon perceptions as tracking for the end-to-end paradigm, as well as an extension on reasoning behaviors under 3D scenarios for multiple autonomous agents.

    &  \\  & **OLS \(\)** & **CLS-N** \(\) & **CLS \(\)** & **Avg. \(\)** \\  PDM  & 0.463 & 0.898 & **0.918** & 0.760 \\
**PDM  +BeTop** & **0.488** & **0.916** & 0.902 & **0.770** \\  PlanTF  & 0.871 & 0.864 & 0.805 & 0.847 \\
**PlanTF  +BeTop** & **0.878** & **0.882** & **0.807** & **0.856** \\   

Table 6: **Results of integrating BeTop by strong planning baselines in nuPlan benchmark.**

    & Ablative &  \\  & Components & OLS \(\) & **CLS-N**\(\) & **CLS \(\)** \\ 
0 & BeTopNet & 0.876 & 0.902 & 0.857 \\ 
1 & No branched plan & 0.879 & **0.894** & **0.830** \\
2 & No cost learning & **0.882** & 0.888 & 0.807 \\
3 & BeTop only & 0.877 & 0.876 & 0.804 \\
4 & No local attention & 0.871 & 0.852 & 0.804 \\
5 & Encoders only & 0.867 & 0.827 & 0.784 \\   

Table 8: **Results of BeTopNet planning performance with different components.** Contingency is the key for closed-loop simulation.

Figure 4: **Results of different interactive agents number for local attention**. We observe a convergence effect for the selection of \(K\).

Figure 5: **Qualitative results of planning and prediction in nuPlan and WOMD.** BeTopNet performs compliant reaction simulations in a) yielding for pedestrians; b) cruising in dense traffic. Interactive scenarios (c,d) further present the consistency of contingency learning. BeTopNet predicts both compliant marginal (e,f) and joint (g,h) multi-agent predictions under diverse scenarios. Future interactive behavior patterns can also be consistently reasoned (rendered in light red) with BeTop.