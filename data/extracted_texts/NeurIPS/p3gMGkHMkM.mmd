# Particle Semi-Implicit Variational Inference

Jen Ning Lim

University of Warwick

Coventry, United Kingdom

Jen-Ning.Lim@warwick.ac.uk &Adam M. Johansen

University of Warwick

Coventry, United Kingdom

a.m.johansen@warwick.ac.uk

###### Abstract

Semi-implicit variational inference (SIVI) enriches the expressiveness of variational families by utilizing a kernel and a mixing distribution to hierarchically define the variational distribution. Existing SIVI methods parameterize the mixing distribution using implicit distributions, leading to intractable variational densities. As a result, directly maximizing the evidence lower bound (ELBO) is not possible, so they resort to one of the following: optimizing bounds on the ELBO, employing costly inner-loop Markov chain Monte Carlo runs, or solving minimax objectives. In this paper, we propose a novel method for SIVI called Particle Variational Inference (PVI) which employs empirical measures to approximate the optimal mixing distributions characterized as the minimizer of a free energy functional. PVI arises naturally as a particle approximation of a Euclidean-Wasserstein gradient flow and, unlike prior works, it directly optimizes the ELBO whilst making no parametric assumption about the mixing distribution. Our empirical results demonstrate that PVI performs favourably compared to other SIVI methods across various tasks. Moreover, we provide a theoretical analysis of the behaviour of the gradient flow of a related free energy functional: establishing the existence and uniqueness of solutions as well as propagation of chaos results.

## 1 Introduction

In Bayesian inference, a quantity of vital importance is the posterior \(p(x|y)=p(x,y)/ p(x,y)x\), where \(p(x,y)\) is a probabilistic model, \(y\) denotes the observed data, and \(x\) the latent variable. An ever-present issue in Bayesian inference is that the posterior is often intractable. This is because the normalizing constant is available only in the form of an integral, and approximation methods are required. One popular method is variational inference (VI) (Jordan, 1999; Wainwright and Jordan, 2007; Blei et al., 2017). The essence of VI is to approximate the posterior with a member from a variational family \(\) where each element of \(\) is a distribution \(q_{}\) (called "variational distribution") parameterized by \(\). These parameters \(\) are obtained via minimizing a distance or discrepancy (or an approximation of it) between the posterior \(p(|y)\) and the variational distribution \(q_{}\).

Here, we focus on semi-implicit variational inference (SIVI) (Yin and Zhou, 2018). It enables a rich variational family by utilizing variational distributions, which we refer to as semi-implicit distributions (SIDs), defined as

\[q_{k,r}(x):= k(x|z)r(z)\,z,\] (1)

where \(k:^{d_{x}}^{d_{z}}_{+}\) is a kernel satisfying \( k(x|z)x=1\); \(r(^{d_{z}})\) is the mixing distribution and \((^{d_{z}})\) denotes the space of distributions with support \(^{d_{z}}\), with its usual Borel \(\)-field, with finite second moments. Here, and throughout, we assume that the distributions and kernels of interest admit densities. SIDs are very flexible (Yin and Zhou, 2018) and can express complex properties, such as skewness, multimodality, and kurtosis. These properties might be presentin the posterior but typical variational families may fail to capture them. There are various approaches to parameterizing these variational distributions: current techniques utilize neural networks built on top of existing kernels (e.g., Gaussian kernels) to define more complex kernels (Titsias and Ruiz, 2019), and/or utilize pushforward distributions (a.k.a., implicit distributions (Huszar, 2017)) (Yin and Zhou, 2018). On choosing a parameterization, an approximation to the posterior is obtained by minimizing the exclusive Kullback-Leibler (KL) divergence. This optimization has the same solution as minimizing the free energy (or the negative evidence lower bound) defined as

\[(k,r):=(x)}{p(x,y)}q_{k,r}(x).\] (2)

However, since the integral in \(q_{k,r}\) is typically intractable, directly optimizing \(\) is not feasible. As a result, SIVI algorithms focus on designing tractable objectives by using upper bounds of \(\)(Yin and Zhou, 2018); expensive Markov Chain Monte Carlo (MCMC) chains to estimate the gradient of \(\)(Titsias and Ruiz, 2019); and optimizing different objectives such as score matching which results in min-max objectives (Yu and Zhang, 2023).

In our work, we propose an alternative parameterization for SIDs: kernels are constructed as before (with parameter space denoted by \(\)) whereas the mixing distribution \(r\) is obtained by optimizing over the whole space \((^{d_{s}})\). We motivate the case for minimizing a regularized version of the free energy \(\) denoted by \(_{}\) (see Eq. (4)); thus, SIVI can be posed as the following optimization problem: \(_{(,r)(^{d_{s}})}_{}(,r)\). As a means to solving the SIVI problem, we construct a gradient flow that minimizes \(_{}\) where the space \((^{d_{s}})\) is equipped with the Euclidean-Wasserstein geometry (Jordan et al., 1998; Kuntz et al., 2023). Via discretization, we obtain a practical algorithm for SIVI called _Particle Variational Inference_ (PVI) that does not rely upon upper bounds of \(\), MCMC chains, or solving minimax objectives.

Our main contributions are as follows: (1) we introduce a Euclidean-Wasserstein gradient flow minimizing \(_{}\) as means to perform SIVI; (2) we develop a practical algorithm, PVI, which arises as a discretization of the gradient flow that allows for general mixing distributions; (3) we empirically compare PVI compared with other SIVI approaches across toy and real-world experiments and find that it compares favourably; (4) we study the behaviour of the gradient flow of a related free energy functional to establish existence and uniqueness of solutions (Prop. 8) as well as propagation of chaos results (Prop. 9).

The structure of this paper is as follows: in Section 2, we begin with a discussion of previous approaches to parameterizing SIDs and their relationship with one another. Then, in Section 3, we show how PVI is developed: beginning with designing a well-defined loss functional, the construction of the gradient flow, and how to obtain a practical algorithm. In Section 4, we study properties of a related gradient flow; and, in Section 5, we conclude with experiments to demonstrate the efficacy of our proposal. For sake of brevity, we defer our discussion of related works to App. A.

## 2 On implicit mixing distributions in SIDs

This section outlines existing approaches to parameterizing SIDs with implicit distributions and how these choices affect the resulting variational family. Before we begin, we shall summarize the key assumptions of SIVI. The kernel \(k\) is assumed to be a reparametrized distribution in the sense of Salimans and Knowles (2013); Kingma and Welling (2014); Ruiz et al. (2016). In other words, the kernel \(k\) is defined by the pair \((,p_{k})\) where \(:^{d_{z}}^{d_{x}}^{d_{x}}\) and \(p_{k}(^{d_{x}})\) such that \(k(|z)=(z,)_{\#}p_{k}\) Furthermore, to ensure that it admits a tractable density, the map \((z,)\) is assumed to be a diffeomorphism for all \(z^{d_{z}}\) with its inverse map written as \(^{-1}(z,)\). From the change-of-variable formula, its density is given as \(k(|z)=p_{k}(^{-1}(z,))\,|_{x}^{-1}(z,)|\). We sometimes write \(k_{,p_{k}}\) to denote the underlying \(\) and \(p_{k}\) explicitly. Furthermore, the kernel \(k\) is assumed to be computable and differentiable with respect to both arguments.

Several approaches to the parameterization of SIDs have been explored in the literature. One can define the variational family by choosing the kernel and mixing distribution from sets \(\) and \(\) respectively, i.e., the variational family is \((,):=\{q_{k,r}:k,r\}\). Yin and Zhou (2018) focused on a fixed kernel \(k\) with \(r\) being a pushforward (or "implicit") distribution, i.e., \(r\{g_{\#}p_{r}:g\}=:_{;p_{r}}\), where \(\) is a subset of measurable mappings from the sample space of \(p_{r}\) to \(^{d_{z}}\). Thus, the \(_{}\)-variational family is \((\{k\},_{;p_{r}})\). On the other hand, Titsias and Ruiz(2019) considered a fixed mixing distribution \(r\) with \(k\) belonging to some parameterized class \(\). The typical example is one in which each kernel is defined by composing an existing kernel \(k_{,p_{k}}\) with a function \(f\), the result is \(k_{f;,p_{k}}(|z):=k_{(f(),),p_{k}}(|z)=(f(z), )_{\#}p_{k}\) which clearly satisfies the reparameterization assumption. We denoted this kernel class as \(_{;,p_{k}}:=\{k_{f;,p_{k}}:f\}\) and its respective \(_{}\)-variational family is \((_{;,p_{k}},\{r\})\). In Yu and Zhang (2023), they combine both parameterization for \(\) and \(\), i.e., the \(_{}\)-variational family is \((_{;,p_{k}},_{;p_{ r}})\). We note that this is how the variational family is presented in Yu and Zhang (2023, see Sec. 2) but the authors used \(_{}\)-variational family in experiments, i.e., \(r\) was fixed. While \(_{}\) might seem like it defines a larger variational family than the other approaches, under these common parameterization practices, we show that they define the same variational family.

**Proposition 1** (\(_{}=_{2}=_{}\)).: _Given a \(_{}\)-variational family of the form \(_{}:=(_{;,p_{k}}, _{;p_{r}})\), then there is a \(_{}\)-variational family and \(_{}\)-variational family (i.e., \(_{}:=(_{;, p_{k}},\{p_{r}\})\) and \(_{2}:=(\{k_{,p_{k}}\},_{;p_{r}})\)) such that \(_{}=_{2}=_{}\)._

The proof can be found in App. D. This proposition shows that \(_{}\)-parameterization defines the "same" variational family as \(_{}\) and \(_{}\) when we parametrize \(\) with push-forward distributions. In practice, \(\) and \(\) are parameterized by neural networks hence \(_{}\) can be viewed as \(_{}\) or \(_{}\) with a deeper neural networks \(\). This simplification is a direct result of using push-forward distributions. Although this parametrization has shown promise e.g., Goodfellow et al. (2020), they have issues with expressivity particularly when distributions are disconnected (Salmona et al., 2022). In our work, we follow in \(_{}\)-variational families, but, we avoid the use of push-forward distributions. Instead, we propose to directly optimize over \((^{d_{z}})\) and so, our variational family does not simply reduce to \(_{}\) or \(_{}\).

## 3 Particle Variational Inference

In this section, we present our proposed method for SIVI, called _particle variational inference_ (PVI). Similar to prior SIVI methods, the algorithm utilizes kernels (denoted by \(k_{}\)) with parameters \(\) which satisfy the assumptions listed in Section 2. One example is \(k_{}_{;,p_{k}}\) where \(\) is a function space induced by a neural network. We slightly abuse the notation \(\) to also indicate its corresponding weight space \(^{d_{}}\). The novelty of this algorithm is that, for the mixing distribution, we directly optimize over the space \((^{d_{z}})\) which loosens the requirement for the neural network in the kernel to learn complex mappings. The result is a "simpler" optimization procedure and increases expressivity over existing methods. Thus, the variational parameters of PVI are \((,r)(^{d_{z}})=:\) with its corresponding variational distribution defined as \(q_{,r}:= k_{}(|z)r(z)z\). PVI arises naturally as a discretization of a gradient flow minimizing a suitably defined free energy on \((^{d_{z}})\) endowed with the Euclidean-Wasserstein geometry (Jordan et al., 1998; Ambrosio et al., 2005; Kuntz et al., 2023). In Section 3.1, we begin by constructing a suitably defined free energy functional; then, in Section 3.2, we formulate its gradient flow; finally, in Section 3.3, we construct PVI from its gradient flow.

### Free energy functional

As with other VI algorithms, we are interested in finding variational parameters that minimize \((,r)(q_{,r},p(|y))\). This optimization problem can be cast equivalently as:

\[*{arg\,min}_{(,r)}(,r), \ \ ::(,r) q_{,r}(x) (x)}{p(x,y)}\,x.\] (3)

Before we can solve this problem, we must ensure that it is _well-posed_. In other words, it must admit minimizers in \(\). In the following proposition, we outline various properties of \(\):

**Proposition 2**.: _Assume that the evidence is bounded \( p(y)<\) and \(k\) is bounded; then we have that \(\) is (i) lower bounded, (ii) lower semi-continuous (l.s.c.), and (iii) non-coercive._

The proof can be found in App. E.1. Prop. 2 tells us that even though \(\) possesses many of the properties one looks for in a meaningful minimization functional, it lacks coercivity (in the sense of Dal Maso (2012, Definition 1.12)): a sufficient property to establish the existence of solutions. The key to showing non-coercivity is that we can construct a kernel \(k_{}(x|z)\) that does not depend on \(z\)At first glance, this issue might seem contrived but we note that this problem is closely related to the problem of posterior collapse (Lucas et al., 2019; Wang et al., 2021). To address non-coercivity, we propose to utilize regularization and define the regularized free energy as:

\[_{}(,r):=_{q_{,r}(x)}[(x)}{p(x,y)}]+_{}(,r),\] (4)

where \(_{}\) is a regularizer with parameters \(\). In Prop. 3, we show that if \(_{}\) is sufficiently regular, then the \(_{}\) enjoys better properties than its unregularized counterpart \(\).

**Proposition 3**.: _Under the assumptions of Prop. 2, if \(_{}\) is coercive and l.s.c., then the regularized free energy \(_{}\) is (i) lower bounded, (ii) l.s.c., (iii) coercive. Hence it admits at least one minimizer in \(\)._

The proof can be found in App. E.2. From here forward, we shall focus on regularizers of the form \(^{}_{}:(,r)_{r}(r,p _{0})+_{}_{}()\) where \(=\{_{r},_{}\}\) are the regularization parameters and \(p_{0}\) is a predefined reference distribution. As long as \(_{}\) is l.s.c., coercive and \(_{},_{r}>0\), the resulting regularizer \(^{}_{}\) will also be l.s.c. and coercive. There are many possible choices for \(p_{0}\) and \(_{}\). For \(p_{0}\), this regularizes solutions of the gradient flow toward it, as such, in settings where there is some knowledge or preference about \(r\) at hand, we can set \(p_{0}\) to reflect that. In our experiments, we utilize \(p_{0}=(0,M)\) where \(M\) is a positive definite (p.d.) matrix. As for \(_{}\), there are also many choices. In the context of neural networks, one natural choice is Tikhonov regularization \(\|\|^{2}\), resulting in weight decay (Hanson and Pratt, 1988) for gradient descent (Loshchilov and Hutter, 2019) which is a popular method for regularizing neural networks. In our experiments, we either use Tikhonov regularization or its simple variant \(\|\|_{M}^{2}:=,M\).

### Gradient flow

To solve the problem in Eq. (3), we construct a gradient flow that minimizes \(_{}\). To this end, we endow the space \(\) with a suitable notion of gradient \(_{}_{}(,r):=(_{} _{},_{r}_{})\) where \(_{}\) and \(_{r}\) denotes the Euclidean gradient and Wasserstein-\(2\) gradient (Jordan et al., 1998), respectively. The latter gradient is given by \(_{r}_{}(,r):=-_{z}(r_{z} _{r}_{}[,r])\), where \(_{z}\) denotes the standard divergence operator and \(_{r}\) denotes the first variation which is characterized in the following proposition.

**Proposition 4** (First Variation of \(_{}\) and \(^{}_{}\)).: _Assume that \(_{k_{}(X|)}|(X)}{p(X,y)}|<\) for all \((,r)\); then the first variation of \(_{}\) is \(_{r}_{}=_{r}+_{r}_{}\) where \(_{r}[,r](z)=_{k_{}(X|z)}[ (X)}{p(X,y)}],\) and \(_{r}^{}_{}[,r]=_{r} r/p_{0}\)._

The proof can be found in App. E.3. Thus, the (Euclidean-Wasserstein) gradient flow of \(_{}\) is

\[(_{t},_{t})=-_{}_{}( _{t},r_{t})_{t}=-_{} _{}(_{t},r_{t})\\ _{t}=-_{r}_{}(_{t},r_{t})=_{z} (r_{t}_{z}_{r}_{}[_{t},r_{t}])\,. \] (5)

We now establish that the above gradient flow dynamic is contractive and that if a log-Sobolev inequality Eq. (7) holds, one can also establish exponential convergence. The log-Sobolev inequality is closely related to Polyak-Lojasiewicz inequality (or gradient dominance condition) and is commonly assumed in gradient-based systems to obtain convergence (for instance, see Kim et al. (2024)). This is formally stated in the following proposition and proved in App. E.3.

**Proposition 5** (Contracting Gradient Dynamics).: _The free energy \(_{}\) along the flow Eq. (5) is non-increasing and satisfies_

\[}{t}_{}(_{t},r_{t})=-\| _{}_{}(_{t},r_{t})\|^{2} 0,\] (6)

_where \(\|_{}_{}(,r)\|^{2}:=\|_{} _{}(,r)\|^{2}+\|_{z}_{r}_{ }[,r]\|_{r}^{2}\). Moreover, if a log-Sobolev Inequality holds for a constant \(_{>0}\), i.e., for all \((,r)\), we have_

\[_{}(,r)-_{}^{*}\|_{ }_{}(,r)\|^{2},\] (7)

_where \(_{}^{*}:=_{(,r)}_{} (,r)\); then we have exponential convergence_

\[_{}(_{t},r_{t})-_{}^{*}(-t /)(_{}(_{0},r_{0})-_{}^{*}).\]Typically direct simulation of the gradient flow Eq. (5) is intractable as the derivative of the first variation of \(_{}^{E}\) involves \(_{z} r_{t}\); instead, it is useful to identify the gradient flow with a McKean-Vlasov SDE, for which they share the same Fokker-Planck equation. The key distinction is that the SDE can be simulated without access to \(_{z} r_{t}\). This SDE, which we term the PVI flow, is given by

\[_{t}=-_{}_{}(_{t},r_{t}) \,t,\ Z_{t}=b(_{t},r_{t},Z_{t})\,t+}\, W_{t},\] (8)

where \(r_{t}=(Z_{t})\), the drift is \(b(,r,):=-_{z}_{r}[,r]+_{r} _{z} p_{0}\) (with the first variation given in Prop. 4) and \(W_{t}\) is a \(d_{z}\)-dimensional Wiener process. A connection between the Langevin diffusion, i.e., \(Z_{t}=_{z} p(Z_{t},y)\,t+W_{t}\), and PVI flow can be observed with the fixed kernel \(k_{}(x|z)=_{z}(x)\) and \(_{r}=0\), namely, they both satisfy the same Fokker-Planck equation.

### A practical algorithm

``` Input: initialization \((_{0},\{Z_{0,m}\}_{m=1}^{M})\); regularization parameters \(\{_{},_{r}\}\); step-sizes \(h_{}\) and \(h_{r}\); number of Monte Carlo samples \(L\) (for Eqs. (11) and (12)); and preconditioner \(=(^{},^{r})\). for\(k=1\)to\(K\)do \(r_{k-1}^{M}_{m=1}^{M}_{Z_{k-1,m}}\) \(_{k}_{k-1}-h_{}^{}_{ }_{}(_{k-1},r_{k-1}^{M})\) \(\) See Eq. (11) \(_{k} Z-_{z}_{r}[ _{k},r_{k-1}^{M}](Z)+_{r}_{z} p_{0}(Z)\) \(\) See Eq. (12) for\(m=1\)to\(M\)do \(Z_{k,m} Z_{k-1,m}+h_{r}^{r}_{k}(Z_{k-1,m})+h_{r}^{r}}_{k,m}\) \(\)\(_{k,m}(0,I_{d_{z}})\) endfor endfor return\((_{K},\{Z_{K,m}\}_{m=1}^{M})\) ```

**Algorithm 1** Particle Variational Inference (PVI)

To produce a practical algorithm, we are faced with several practical issues. The first issue we tackle is the _computation of gradients_ of expectations for which using standard automatic differentiation is insufficient. The second problem is that these gradients are often ill-conditioned and have different scales in each dimension. This is tackled using preconditioning resulting in _adaptive stepsize_. Finally, to produce computationally feasible algorithms, we show how to _discretize_ the PVI flow in both _space_ and _time_. PVI is summarised in Algorithm 1.

_Computing the gradients_. In the PVI flow, both the drift of the ODE and SDE include a gradient of an expectation with respect to parameters that define the distribution that is being integrated. Specifically, the terms that contain these gradients are \(_{}_{}\) and \(_{z}_{r}_{}\). Fortunately, these gradients can be rewritten as an expectation (as described in Prop. 6) for which the parameters being differentiated w.r.t. is only found in the integrand (see derivation in App. G.1).

**Proposition 6**.: _If \(\) and \(k\) are differentiable, then we have_

\[_{}(,r)= _{p_{k}()r(z)}[(_{}_{ }[s_{,r}-s_{p}])(z,)],\] (9) \[_{z}_{r}[,r](z)= _{p_{k}()}[(_{z}_{}[ s_{,r}-s_{p}])(z,)],\] (10)

_where \(_{}^{d_{} d_{x}}\) denotes the Jacobian \((_{})_{ij}=_{_{i}}_{j}\) (and similarly for \(_{z}\)); scores are \(s_{,r}(z,):=_{x} q_{,r}(_{}(z,))\) (and similarly \(s_{p}(z,)\)) ; and \(\) denotes the usual matrix-vector multiplication in the sense of \(M v:(z,) M(z,)v(z,)\)._

From Eqs. (9) and (10), we can produce Monte Carlo estimators for the gradients, i.e.,

\[_{}(,r):=_{l=1}^{L} _{z r}[(_{z}_{}[s_{,r}-s_{p}])(z, _{l})],\] (11)

\[_{z}_{r}[,r]:=_{l=1}^{L} (_{z}_{}[s_{,r}-s_{p}])(,_{l}),\] (12)where \(\{_{l}\}_{l=1}^{L}}{{}}p_{k}\). This is an instance of a path-wise Monte-Carlo gradient estimator; a performant estimator that has been shown empirically to exhibit lower variance than other standard estimators (Kingma and Welling, 2014; Roeder et al., 2017; Mohamed et al., 2020).

_Adaptive Stepsizes._ One of the complexities of training neural networks is that their gradient is often poorly conditioned. As a result, for certain problems, the gradients computed from Eq. (9) and Eq. (10) can often produce unstable algorithms without careful tuning of the step sizes. When this occurs, we utilize preconditioners (Staib et al., 2019) to avoid this issue. Let \(^{}:^{d_{} d_{}}\) and \(^{r}:^{d_{z}}^{d_{z} d_{z}}\) be the precondition for components \(\) and \(r\) respectively, then the resulting preconditioned gradient flow is given by

\[_{t}=-^{}_{}_{ }(_{t},r_{t})\,t,\ \ _{t}r_{t}=_{z}(r_{t}^{r}_{z}_{r}_{ }[_{t},r_{t}]).\] (13)

If \(^{}\) and \(^{r}\) are positive definite, then \(_{}(_{t},r_{t})\) remains non-increasing, i.e., Eq. (6) holds. As before, this Fokker-Planck equation is satisfied by the following Mckean-Vlasov SDE:

\[_{t}=-^{}(_{t})_{} _{}(_{t},r_{t})\,t,\] (14) \[Z_{t}=[^{r}(Z_{t})b(_{t},r_{t},Z_{t})+_ {z}^{r}(Z_{t})]\,t+(Z_{t})}W_{t},\] (15)

where \((_{z}^{r})_{i}=_{j=1}^{d_{z}}_{z_{j}}[(^{r})_{ ij}]\) and \(r_{t}=(Z_{t})\). The equivalence between Eq. (13) and Eqs. (14) and (15) is shown in App. G.2. A simple example for the preconditioner allows the \(_{t}\) and \(Z_{t}\) to have different time scales; ultimately, this results in different step sizes. Another more complex example of preconditioner \(^{}\) is the RMSProp (Tieleman and Hinton, 2012), and \(^{r}\) we utilize a preconditioner inspired by RMSProp (see App. G.2). As with other related works (e.g., see Li et al. (2016)), we found that the additional term \(_{z}^{r}\) can be omitted in practice: it has little effect but incurs a large computational cost.

_Discretization in both space and time._ To obtain an actionable algorithm, we need to discretize the PVI flow in both space and time. For the space discretization, we propose to use a particle approximation for \(r_{t}\), i.e., for a set of particles \(\{Z_{t,m}\}_{m=1}^{M}\) with each satisfying \((Z_{t,m})=r_{t}\), we utilize the approximation \(r_{t}^{M}:=_{m=1}^{M}_{Z_{t,m}}\) which converges almost surely to \(r_{t}\) in the weak topology as \(M\) by the strong law of large numbers and a countable determining class argument (e.g., see Schumm et al. (2020, Theorem 1.1)). This approximation is key to making the intractable tractable, e.g., Eq. (1) is approximated by \(q_{_{r,M}}=_{m=1}^{M}k_{}(x|Z_{t,m})\). One obtains a particle approximation to the PVI flow from the following ODE-SDE:

\[_{t}^{M}=-_{}_{}( _{t}^{M},r_{t}^{M})\,t,\ \  m[M]:Z_{t,m}^{M}=b(_{t}^{M},r_{t}^{M},Z_{t,m}^{M})\, t+}\,W_{t,m},\]

where \([M]:=\{1,,M\}\). As for the time discretization, we employ Euler-Maruyama discretization with step-size \(h\) which (using an appropriately defined preconditioner) can be decoupled into different stepsizes for \(_{t}\) and \(Z_{t}\) denoted by \(h_{}\) and \(h_{r}\) respectively.

## 4 Theoretical analysis

We are interested in the behaviour of the PVI flow (8). However, a key issue in its study is that the drift in PVI flow might lack the necessary continuity properties to analyze using the existing theory. In this section, we instead analyze the related gradient flow of the more regular functional

\[_{}^{}(,r):=^{}( ,r)+_{}(,r),\ \ \ \ ^{}(,r)=_{q_{,r}(x)}[(x)+}{p(x,y)}]\] (16)

for \(>0\). A similar modified flow was also explored in Crucinio et al. (2024) for similar reasons; they found empirically that, at least when using a tamed Euler scheme, setting \(=0\) did not cause problems in practice. Similarly, our experimental results for PVI found \(=0\) did not have issues. To provide an additional measure of confidence in the reasonableness of this regularization and of the use of this functional as a proxy for \(_{}\), we establish that the minima of \(_{}^{}\) converge to those of \(_{}\) in the \( 0\) limit.

**Proposition 7** (\(\)-convergence and convergence of minima).: _Under the same assumptions as Prop. 3, we have that \(_{}^{}\)\(\)-converges to \(_{}\) as \( 0\) (in the sense of Def. B.1). Moreover, we have as an immediate corollary that_

\[_{(,r)}_{}(,r)= _{ 0}_{(,r)}_{}^{ }(,r).\]The proof uses techniques from \(\)-convergence theory (introduced by De Giorgi, see e.g. De Giorgi and Franzoni (1975); see Dal Maso (2012) for a good modern introduction) and can be found in App. F.1. The gradient flow of \(_{}^{}\), which we term \(\)-PVI, is given by

\[_{t}^{}=-_{}_{}^{}( _{t}^{},r_{t}^{})\,t,\ Z_{t}^{}=b^{}(_{t}^{},r_{t}^{},Z_{t}^{ })\,t+}\,W_{t},\] (17)

where \(r_{t}^{}=(Z_{t}^{})\) and \(b^{}(,r,)=-_{z}_{r}^{}[, r]+_{r}_{z} p_{0}\). The derivation follows similarly to that in Section 3.2, and is omitted for brevity. The use of \(>0\) is crucial for establishing key regularity conditions in our analysis. We proceed by stating our assumptions.

**Assumption 1** (Regularity of the target \(p\), reference distribution \(p_{0}\), and \(_{}\)).: We assume that \( p(y)\) is _bounded_; and \(p\), \(p_{0}\) and \(_{}\) have Lipschitz gradients with constants \(K_{p},K_{p_{0}},K_{_{}}\) respectively: there exists some \(B_{p}_{>0}\) such that \( p(y) B_{p}\); and for any given \(y\) there exists a \(K_{p}_{>0}\) such that \(\|_{x} p(x,y)-_{x} p(x^{},y)\| K_{p}\|x-x^{ }\|\) for all \(x,x^{}^{d_{x}}\) (similarly for \(p_{0}\) and \(_{}\)).

**Assumption 2** (Regularity of \(k\)).: We assume that the kernel \(k\) and its gradient is _bounded_ and has \(K_{k}\)-Lipschitz gradient; i.e., there exist constants \(B_{k},K_{k}_{>0}\) such that \(|k_{}(x|z)|+\|_{(,x,z)}k_{}(x|z)\| B_{k}\), and \(\|_{x}k_{}(x|z)-_{x}k_{^{}}(x^{}|z^{ })\| K_{k}(\|(,x,z)-(^{},x^{},z^{})\|)\) hold for all \(,^{}\), \(z,z^{}^{d_{z}}\), and \(x,x^{}^{d_{x}}\).

**Assumption 3** (Regularity of \(\) and \(p_{k}\).).: We assume that \(\) has Lipschitz gradient and bounded gradient. In other words, there is \(a_{}_{ 0},b_{}_{>0}\) such that \(\) satisfies \(\|_{(,z)}(z,)-_{(,z)}_{^{}} (z^{},)\|_{F}(a_{}\|\|+b_{})(\|(,z)-( ^{},z^{})\|)\) and \(\|_{(,z)}_{}(z,)\|_{F}(a_{}\|\| +b_{})\) for all \((,z),(^{},z^{})^{d_{x}}\), \(^{d_{x}}\), where \(\|\|_{F}\) denotes the Frobenius norm. We also assume that \(p_{k}\) has finite second moments.

Assumptions 2 and 3 are intimately connected; under some regularity conditions, one may imply the other but we shall abstain from this digression for the sake of clarity. Assumptions 2 and 3 are quite mild and hold for popular kernels such as \(k_{}(x|z)=(x;_{}(z),)\) under some regularity assumptions on \(_{}\) and \(\) (which we show in App. C). These assumptions are key to establishing that the drift in Eq. (17) is Lipschitz continuous (see Prop. 11 in the App.), from which, we establish the existence and uniqueness of the solutions of Eq. (17).

**Proposition 8** (Existence and Uniqueness).: _Under Assumptions 1 to 3, if \(>0\) and \(_{p_{k}()}\|s_{,r}^{}(z,)-s_{p}(z, )\|\) is bounded (with \(s_{,r}^{}:(z,)_{x}(q_{,r}_ {}(z,)+)\)); then, given \((_{0},r_{0})\), the solutions to Eq. (17) exists and is unique._

The proof can be found in App. F.2. Under the same assumptions, we can establish an asymptotic propagation of chaos result that justifies the usage of a particle approximation in place of \(r_{t}^{}\) in Eq. (17).

**Proposition 9** (Propagation of chaos).: _Under the same assumptions as Prop. 8; we have for any fixed \(T\):_

\[_{M}_{t[0,T]}\|_{t}^{}-_ {t}^{,M}\|^{2}+_{2}^{2}((r_{t}^{})^{ M },q_{t}^{,M})=0,\]

_where \((r_{t}^{})^{ M}=_{i=1}^{M}(r_{t}^{})\); \(q_{t}^{,M}=(\{Z_{t,m}^{,M}\}_{m=1}^{M})\); \(_{t}^{,M}\) and \(Z_{t,m}^{,M}\) are solutions to_

\[_{t}^{,M}=-_{}_{}^{}( _{t}^{,M},r_{t}^{,M})\,t,\ r_{t}^{,M}=_{m=1}^{M}_{Z_{t,m}^{,M}}\]

\[ m[M]:Z_{t,m}^{,M}=b^{}(_{t}^{,M},r_ {t}^{,M},Z_{t,m}^{,M})\,t+}\,W _{t,m}.\]

The proof can be found in App. F.3. Having established the existence and uniqueness of the \(\)-PVI flow, as well as an asymptotic justification for using particles, we now provide a numerical evaluation to demonstrate the efficacy of our proposal.

## 5 Experiments

In this section, we compare PVI against other semi-implicit VI methods. As described in the App. A, these include unbiased semi-implicit variational inference (UVI) of Titsias and Ruiz (2019), semi-implicit variational inference (SVI) of Yin and Zhou (2018), and the score matching approach (SM)of Yu and Zhang (2023). Through experiments, we show the benefits of optimizing the mixing distribution; we compare the effectiveness of PVI against other SIVI methods on a density estimation problem on toy examples; and, we compare against other SIVI methods on posterior estimation tasks for (Bayesian) logistic regression and (Bayesian) neural network. The details for reproducing experiments as well as computation information can be found in App. H. The code is available at https://github.com/jenninglim/pvi.

### Impact of the mixing distribution

From Prop. 1, it can be said that ultimately current SIVI methods utilize (directly or indirectly) a fixed mixing distribution whilst PVI does not. We are interested in establishing whether there is any benefit to optimizing the mixing distribution. Intuitively, the mixing distribution can be utilized to express complex properties, such as multimodality, which the neural network kernel \(k_{}\) can then exploit. If the mixing distribution is fixed, this means that the neural network must learn to express these complex properties directly--which can be difficult (Salmona et al., 2022). This intuition turns out to hold, but for the kernel to exploit an expressive mixing distribution, it must be designed well. We illustrate this using the distributions \((,I)+(-,I)\) for \(=\{1,2,4\}\) and following kernels: the "Constant" kernel \((z,I_{2})\); "Push" kernel \((f_{}(z),_{}^{2}I_{2})\); "Skip" kernel \((z+f_{}(z),_{}^{2}I_{2})\); and "LSkip" kernel \((Wz+f_{}(z),_{}^{2}I_{2})\) where \(W^{2 2}\):. We compare the results from PVI and PVIZero (PVI with \(h_{r}=0\) to result in a fixed \(r(0,I_{2})\)) to emulate PVI with a fixed mixing distribution. As \(\) gets larger, the complexity of the kernel (or the mixing distribution) must grow to express this (e.g., see (Salmona et al., 2022, Corollary 2)).

Fig. 1 shows the resulting densities and the learnt mixing distribution of PVI and PVIZero for different kernels and various \(\). For the constant kernel, PVI can solve this problem by learning a complex mixing distribution to express the multimodality. However, for the push kernel, it can be seen that as \(\) gets larger PVI and PVIZero suffer from mode collapse which we suspect is due to the mode-seeking behaviour of using reverse KL and why prior SIVI methods utilized annealing methods (see Yu and Zhang (2023, Section 4.1)). As a remedy, we utilize a Skip kernel which can be seen to improve both PVI and PVIZero. In particular, both PVI and PVIZero were able to successfully express the bimodality in \(=2\); however, PVIZero falls short when \(=4\) while PVI can express the multimodality by learning a bimodal mixing distribution. Since Skip requires \(d_{z}=d_{x}\), we show that LSkip (which removes the requirement) exhibits a similar behaviour to Skip.

### Density estimation

We follow prior works (e.g., Yin and Zhou (2018)) and consider three toy examples whose densities are shown in Fig. 2 (they are given explicitly in App. H.2). In this setting, we use the kernel \(k_{}(x|z)=(x;z+f_{}(z),_{}^{2}I)\) with \(d_{z}=d_{x}=2\) where \(f_{}(z)\) is a neural network whose architecture can be found in App. H.2. As a qualitative measure of performance, Fig. 2 shows the resulting approximating distribution of PVI which can be seen to be a close match to the desired distribution. To compare methods quantitatively, we report the (sliced) Wasserstein distance

Figure 1: Comparison of PVI and PVIZero on a bimodal mixture of Gaussians for various kernels. The plot shows the density \(q_{,r}\) from PVI and PVIZero as well as the KDE plot of \(r\) from PVI described by \(100\) particles.

(computed by POT (Flamary et al., 2021)) and the rejection power of a state-of-the-art two-sample kernel test (Biggs et al., 2023) between the approximating and true distribution in Table 1. The results reported are the average and standard deviation (from ten independent trials of the respective SIVI algorithms). In each trial, the rejection rate \(p\) is computed from \(100\) tests and the sliced Wasserstein distance is computed from \(10000\) samples with \(100\) projections. If the variational approximation matches the distribution, the rejection rate will be at the nominal level of \(0.05\). It can be seen that PVI consistently performs better than SIVI across all problems. PVI can achieve a rejection rate near nominal levels across all problems whilst other algorithms can achieve good performances on one but not the other. The details regarding how the Wasserstein distance is calculated and the hyperparameters used can be found in App. H.2.

### Bayesian logistic regression

As with others (Yin and Zhou, 2018), we consider a Bayesian logistic regression problem on the _waveform_ dataset (Breiman and Stone, 1984). The model is expressed as \(y\,|\,x,(( x,} ))\) with prior \(x(0,0.01^{-1} I_{22})\) where \((y,)\{0,1\}^{21}\) is the response and covariates, and \(}:=[1,]\) is the covariates with appended one for the intercept. The "ground truth" is composed of posterior samples generated from running Markov chain Monte Carlo (MCMC) samples in Yin and Zhou (2018). We use the kernel \(k_{}(x|z)=(Wz+f_{}(z),([M_{}+M_{ }^{}]))\) where \(\) denotes the matrix exponential which ensures positive definiteness. In Fig. 3, we visually compare certain statistics of the distribution obtained from MCMC and distribution obtained from SIVI methods. Fig. 3a shows the pair-wise marginal posterior distributions for three weights \(x_{1},x_{2},x_{3}\) chosen at random from MCMC and SIVI approximations; and in Fig. 3b we compare the correlation coefficients obtained from MCMC against SIVI methods. It can be seen that PVI obtains an approximation close to MCMC with most other SIVI methods obtaining similar performance levels (with the exception of SM). See App. H.3 for all the implementation details.

### Bayesian neural networks

Following prior works (e.g., Yu and Zhang (2023)), we compare our methods with other baselines on sampling the posterior of the Bayesian neural network for regression problems on a range of real-world datasets. We utilize the LSkip kernel \(k_{}(x|z)=(x;Wz+f_{}(z),_{}^{2}(z)I_{d_{x}})\). In Table 2,

   Problem & PVI & UVI & SIVI & SM \\  Banana & \(_{0.02}/0.17_{0.01}\) & \(_{0.02}/_{0.03}\) & \(0.13_{0.05}/0.31_{0.02}\) & \(0.39_{0.24}/0.24_{0.12}\) \\ Multimodal & \(_{0.01}/_{0.01}\) & \(0.65_{0.23}/0.16_{0.07}\) & \(0.13_{0.06}/0.08_{0.02}\) & \(0.14_{0.05}/0.10_{0.02}\) \\ X-Shape & \(_{0.03}/_{0.01}\) & \(0.23_{0.16}/0.10_{0.04}\) & \(0.11_{0.04}/0.12_{0.01}\) & \(0.15_{0.11}/0.11_{0.03}\) \\   

Table 1: This table shows the rejection rate \(p\) and average (sliced) Wasserstein distance \(w\) for toy density estimation problems. It is written in the format \(p/w\) (_lower_ is better) with the subscripts showing the standard deviation estimated from \(10\) independent runs. We indicate in **bold** when the rejection rate minus the standard deviation is lower than the nominal level \(0.05\), and the algorithm that achieves the lowest Wasserstein score.

Figure 2: Contour plots of the densities \(q_{,r}\) (in blue) against the true densities (in black) for various toy density estimation problems. We also plot the absolute difference in the density of \(q_{,r}\) and the true density, i.e., \(|q_{,r}-p|\).

we show the root mean squared error on the test set. It can be seen that PVI performs well, or at least comparable, with other SIVI methods across all datasets. The details regarding the model and other parameters can be found App. H.4.

## 6 Conclusion, Limitations, and Future Work

In this work, we frame SIVI as a minimization problem of \(_{}\), and then, as a solution, we study its gradient flow. Through discretization, we propose a novel algorithm called Particle Variational Inference (PVI). Our experiments found that PVI can outperform current SIVI methods. At a marginal increase in computation cost (see App. H) compared with prior methods, PVI can consistently perform better (or at least comparably in the worst cases considered) which we attribute to not imposing a particular form on the mixing distribution. This is a key advantage of PVI compared to prior methods: by not relying upon push-forward mixing distributions and instead using particles, the mixing distribution can express arbitrary distributions when the number of particles is sufficiently large. Furthermore, it is not necessary to tune the family of mixing distributions to obtain good results in particular problems. Theoretically, we study a related gradient flow of \(_{}^{}\) and establish desirable properties such as the existence and uniqueness of solutions and propagation of chaos results.

The main limitation of our work is that the theoretical results only apply to the case where \(>0\); yet, our experiments were performed with \(=0\) as this is when \(_{}\) corresponds to the (regularized) evidence lower bound. In future work, one can address these limitations by reducing this gap. Furthermore, we found that certain kernels were more amenable than others when exploiting an expressive mixing distribution (e.g., the skip kernel). The question of designing these kernels for PVI (or SIVI more generally) is important for future work.

   Dataset & PVI & UVI & SVI & SM \\  Concrete (Yeh, 2007) & \(_{0.03}\) & \(0.50_{0.03}\) & \(0.50_{0.04}\) & \(0.92_{0.06}\) \\ Protein (Rana, 2013) & \(_{0.05}\) & \(0.92_{0.04}\) & \(0.92_{0.04}\) & \(1.02_{0.03}\) \\ Yacht (Gerritsma et al., 2013) & \(_{0.02}\) & \(0.18_{0.02}\) & \(0.17_{0.02}\) & \(0.98_{0.16}\) \\   

Table 2: Root mean square error (_lower_ is better) for Bayesian neural networks on the test set for various datasets. Here, we write the results in the form \(_{}\) where \(\) is the average RMS and \(\) is its standard error computed over \(10\) independent trials. We indicate in **bold** the lowest score.

Figure 3: Comparison between SIVI methods and MCMC on Bayesian logistic regression problem. (a) shows the marginal and pairwise approximations of posterior of the weights \(x_{1},x_{2},x_{3}\), and (b) shows the scatter plot of the correlation coefficient of MCMC (\(y\)-axis) vs PVI (\(x\)-axis).

[MISSING_PAGE_FAIL:11]

Gallouet, T. O. and Monsaingeon, L. (2017). A JKO Splitting Scheme for Kantorovich-Fisher-Rao Gradient Flows. _SIAM Journal on Mathematical Analysis_, 49(2):1100-1130.
* Gerritsma et al. (2013) Gerritsma, J., Onnik, R., and Versluis, A. (2013). Yacht Hydrodynamics. UCI Machine Learning Repository. DOI: https://doi.org/10.24432/C5XG7R.
* Goodfellow et al. (2020) Goodfellow, I., Pouget-Abadie, J., Mirza, M., Xu, B., Warde-Farley, D., Ozair, S., Courville, A., and Bengio, Y. (2020). Generative adversarial networks. _Communications of the ACM_, 63(11):139-144.
* Graves (2016) Graves, A. (2016). Stochastic Backpropagation through Mixture Density Distributions. _arXiv_.
* Hanson and Pratt (1988) Hanson, S. and Pratt, L. (1988). Comparing biases for minimal network construction with back-propagation. In _Advances in Neural Information Processing Systems_, volume 1.
* Horn and Johnson (2012) Horn, R. A. and Johnson, C. R. (2012). _Matrix Analysis_. Cambridge University Press.
* Huszar (2017) Huszar, F. (2017). Variational Inference using Implicit Distributions. _arXiv_.
* Jordan (1999) Jordan, M. I. (1999). _Learning in Graphical Models_. MIT press.
* Jordan et al. (1998) Jordan, R., Kinderlehrer, D., and Otto, F. (1998). The variational formulation of the Fokker-Planck equation. _SIAM Journal on Mathematical Analysis_, 29(1):1-17.
* Kim et al. (2024) Kim, J., Yamamoto, K., Oko, K., Yang, Z., and Suzuki, T. (2024). Symmetric Mean-field Langevin Dynamics for Distributional Minimax Problems. In _Proceedings of The Twelfth International Conference on Learning Representations_.
* Kingma and Welling (2014) Kingma, D. P. and Welling, M. (2014). Auto-Encoding Variational Bayes. In Bengio, Y. and LeCun, Y., editors, _2nd International Conference on Learning Representations, ICLR 2014, Banff, AB, Canada, April 14-16, 2014, Conference Track Proceedings_.
* Kondratyev et al. (2016) Kondratyev, S., Monsaingeon, L., and Vorotnikov, D. (2016). A new optimal transport distance on the space of finite Radon measures. _Advances in Differential Equations_, 21(11/12).
* Korba et al. (2021) Korba, A., Aubin-Frankowski, P.-C., Majewski, S., and Ablin, P. (2021). Kernel Stein discrepancy descent. In Meila, M. and Zhang, T., editors, _Proceedings of the 38th International Conference on Machine Learning_, volume 139 of _Proceedings of Machine Learning Research_, pages 5719-5730. PMLR.
* Kucukelbir et al. (2017) Kucukelbir, A., Tran, D., Ranganath, R., Gelman, A., and Blei, D. M. (2017). Automatic differentiation variational inference. _Journal of Machine Learning Research_, 18(14):1-45.
* Kuntz et al. (2023) Kuntz, J., Lim, J. N., and Johansen, A. M. (2023). Particle algorithms for maximum likelihood training of latent variable models. In Ruiz, F., Dy, J., and van de Meent, J.-W., editors, _Proceedings of The 26th International Conference on Artificial Intelligence and Statistics_, volume 206 of _Proceedings of Machine Learning Research_, pages 5134-5180. PMLR.
* Lambert et al. (2022) Lambert, M., Chewi, S., Bach, F., Bonnabel, S., and Rigollet, P. (2022). Variational inference via Wasserstein gradient flows. In _Advances in Neural Information Processing Systems_, volume 35, pages 14434-14447.
* Li et al. (2016) Li, C., Chen, C., Carlson, D., and Carin, L. (2016). Preconditioned stochastic gradient Langevin dynamics for deep neural networks. In _Proceedings of the AAAI conference on artificial intelligence_, volume 30.
* Li et al. (2023) Li, L., Liu, Q., Korba, A., Yurochkin, M., and Solomon, J. (2023). Sampling with Mollified Interaction Energy Descent. In _The Eleventh International Conference on Learning Representations_.
* Liero et al. (2018) Liero, M., Mielke, A., and Savare, G. (2018). Optimal Entropy-Transport problems and a new Hellinger-Kantorovich distance between positive measures. _Inventiones mathematicae_, 211(3):969-1117.
* Lim et al. (2024) Lim, J. N., Kuntz, J., Power, S., and Johansen, A. M. (2024). Momentum particle maximum likelihood. In Salakhutdinov, R., Kolter, Z., Heller, K., Weller, A., Oliver, N., Scarlett, J., and Berkenkamp, F., editors, _Proceedings of the 41st International Conference on Machine Learning_, volume 235 of _Proceedings of Machine Learning Research_, pages 29816-29871. PMLR.

Loshchilov, I. and Hutter, F. (2019). Decoupled weight decay regularization. In _International Conference on Learning Representations_.
* Lucas et al. (2019) Lucas, J., Tucker, G., Grosse, R., and Norouzi, M. (2019). Understanding posterior collapse in generative latent variable models.
* Mohamed et al. (2020) Mohamed, S., Rosca, M., Figurnov, M., and Mnih, A. (2020). Monte Carlo Gradient Estimation in Machine Learning. _Journal of Machine Learning Research_, 21(132):1-62.
* Morningstar et al. (2021) Morningstar, W., Vikram, S., Ham, C., Gallagher, A., and Dillon, J. (2021). Automatic differentiation variational inference with mixtures. In _International Conference on Artificial Intelligence and Statistics_, pages 3250-3258. PMLR.
* Rana (2013) Rana, P. (2013). Physicochemical Properties of Protein Tertiary Structure. UCI Machine Learning Repository. DOI: https://doi.org/10.24432/C5QW3H.
* Roeder et al. (2017) Roeder, G., Wu, Y., and Duvenaud, D. K. (2017). Sticking the landing: Simple, lower-variance gradient estimators for variational inference. In _Advances in Neural Information Processing Systems_, volume 30.
* Ruiz et al. (2016) Ruiz, F. J. R., Titsias, M. K., and Blei, D. M. (2016). The Generalized Reparameterization Gradient. In _Advances in Neural Information Processing Systems_, volume 29.

* Salmona et al. (2022) Salmona, A., De Bortoli, V., Delon, J., and Desolneux, A. (2022). Can push-forward generative models fit multimodal distributions? In _Advances in Neural Information Processing Systems_, volume 35, pages 10766-10779.
* Santambrogio (2015) Santambrogio, F. (2015). Optimal transport for applied mathematicians. _Birkauser, NY_, 55(58-63):94.
* Schmon et al. (2020) Schmon, S. M., Deligiannidis, G., Doucet, A., and Pitt, M. K. (2020). Large-sample asymptotics of the pseudo-marginal method. _Biometrika_, 108(1):37-51.
* Shiryaev (1996) Shiryaev, A. N. (1996). _Probability_. Number 95 in Graduate Texts in Mathematics. Springer, New York, second edition.
* Staib et al. (2019) Staib, M., Reddi, S., Kale, S., Kumar, S., and Sra, S. (2019). Escaping saddle points with adaptive gradient methods. In Chaudhuri, K. and Salakhutdinov, R., editors, _Proceedings of the 36th International Conference on Machine Learning_, volume 97 of _Proceedings of Machine Learning Research_, pages 5956-5965. PMLR.
* Tieleman and Hinton (2012) Tieleman, T. and Hinton, G. (2012). Lecture 6.5-rmsprop, coursera: Neural networks for machine learning. _University of Toronto, Technical Report_, 6.
* Titsias and Ruiz (2019) Titsias, M. K. and Ruiz, F. (2019). Unbiased implicit variational inference. In Chaudhuri, K. and Sugiyama, M., editors, _Proceedings of the Twenty-Second International Conference on Artificial Intelligence and Statistics_, volume 89 of _Proceedings of Machine Learning Research_, pages 167-176. PMLR.
* Wainwright and Jordan (2007) Wainwright, M. J. and Jordan, M. I. (2007). Graphical Models, Exponential Families, and Variational Inference. _Foundations and Trends(r) in Machine Learning_, 1(1-2):1-305.
* Wang et al. (2021) Wang, Y., Blei, D., and Cunningham, J. P. (2021). Posterior collapse and latent variable non-identifiability. In _Advances in Neural Information Processing Systems_, volume 34, pages 5443-5455.
* Yan et al. (2024) Yan, Y., Wang, K., and Rigollet, P. (2024). Learning Gaussian mixtures using the Wasserstein-Fisher-Rao gradient flow. _The Annals of Statistics_, 52(4).
* Yeh (2007) Yeh, I.-C. (2007). Concrete Compressive Strength. UCI Machine Learning Repository. DOI: https://doi.org/10.24432/C5PK67.
* Yeh et al. (2019)Yin, M. and Zhou, M. (2018). Semi-implicit variational inference. In Dy, J. and Krause, A., editors, _Proceedings of the 35th International Conference on Machine Learning_, volume 80 of _Proceedings of Machine Learning Research_, pages 5660-5669. PMLR.
* Yu and Zhang (2023) Yu, L. and Zhang, C. (2023). Semi-implicit variational inference via score matching. In _The Eleventh International Conference on Learning Representations_.

Related work

In this section, we outline four areas of related work: semi-implicit variational inference; Euclidean-Wasserstein gradient flows and Wasserstein-gradient flows in VI; mixture models in VI; and finally, the link between SIVI and solving Fredholm equations of the first kind.

At the time of writing, there are three algorithms for SIVI proposed: SVI Yin and Zhou (2018), UVI Titsias and Ruiz (2019), SM Yu and Zhang (2023). Concurrently, Cheng et al. (2024) extended the SM variant by solving the inner minimax objective and simplified the optimization problem. Each had their parameterization of SID (as discussed in Section 2), and their proposed optimization method. SIVI relies on optimizing a bound of the ELBO which is asymptotically tight. UVI, like our approach, optimizes the ELBO by using gradients-based approaches. However, one of its terms is the score \(_{x} q_{,r}(x)\) which is intractable. The authors proposed using expensive MCMC chains to estimate it; in contrast to PVI, this term is readily available to us. For SM, they propose to optimize the Fisher divergence, however, to deal with the intractabilities the resulting objective is a minimax optimization problem which is difficult to optimize compared to standard minimization problems.

PVI utilizes the Euclidean-Wasserstein geometry. This geometry and associated gradient flows are initially explored in the context of (marginal) maximum likelihood estimation by Kuntz et al. (2023) and their convergence properties are investigated by Caprio et al. (2024). In Lim et al. (2024), the authors investigated accelerated gradient variants of the aforementioned gradient flow in Euclidean-Wasserstein geometry. The Wasserstein geometry for gradient flows on probability space has received much attention with many works exploring different functionals (for examples, see Arbel et al. (2019); Korba et al. (2021); Li et al. (2023)). In the context of variational inference Lambert et al. (2022) analyzed VI as a Bures-Wasserstein Gradient flow on the space of Gaussian measures.

PVI is reminiscent of mixture distributions which is a consequence of the particle discretization. Mixture models have been studied in prior works as variational distributions (Graves, 2016; Morningstar et al., 2021). In Graves (2016), the authors extended the parameterization trick to mixture distributions; and Morningstar et al. (2021) proposed to utilize mixture models as variational distributions in the framework of Kucukelbir et al. (2017). Although similar, the mixing distribution assists the kernel in expressing complex properties of the true distribution at hand (see Section 5.1) which is an interpretation that mixture distribution lacks.

There is an obvious similarity between SIVI and solving Fredholm equations of the first kind. There is considerable literature on solving such problems; see Crucinio et al. (2024), which is closest in spirit to the approach of the present paper, and references therein. In fact, writing \(p(|y)=(|z,)r(z)z\). with \((|z,) k_{}(|z)\) makes the connection more explicit: essentially, one seeks to solve a nonstandard Fredholm equation, with the LHS known only up to a normalizing constant, constraining the solution to be in \(()\{_{}:\}\). While Crucinio et al. (2024) develop and analyse a simple Wasserstein gradient flow to address a regularised Fredholm equation, neither the method nor analysis can be applied to the SIVI problem because of this non-trivial constraint. In Yan et al. (2024), the authors also solve a Fredholm-type equation but instead using the Wasserstein-Fisher-Rao geometry (Kondratyev et al., 2016; Gallouet and Monsaingeon, 2017; Chizat et al., 2018; Liero et al., 2018).

## Appendix B \(\)-convergence

The following is one of many essentially equivalent definitions of \(\)-convergence (see Dal Maso (2012); Braides (2002) for comprehensive summaries of \(\)-convergence). We take as definition the following (see Dal Maso (2012, Proposition 8.1), Braides (2002, Definition 1.5)):

**Definition B.1** (\(\)-convergence).: Assume that \(\) is a topological space that satisfies the first axiom of countability. Then a sequence \(_{}:\) is said to \(\)-converge to \(\) if:

* (lim-inf inequality) for every sequence \((_{},r_{})\) converging to \((,r)\), we have \[_{ 0}_{}(_{},r_{}) (,r).\]
* (lim-sup inequality) for any \((,r)\), there exists a sequence \((_{},r_{})\), known as a recovery sequence, converging to \((,r)\) which satisfies \[_{ 0}_{}(_{},r_{}) (,r).\]\(\)-convergence corresponds, roughly speaking, to the convergence of the lower semicontinuous envelope of a sequence of functionals and, under mild further regularity conditions such as equicoercivity, is sufficient to ensure the convergence of the sets of minimisers of those functionals to the set of minimisers of the limit functional.

## Appendix C On Assumptions 2 and 3

We consider the Gaussian kernel \(k_{}(x|z)=(x;_{}(z),)\), i.e.,

\[k_{}(x|z)=(2)^{-d_{x}/2}{()}^{-0.5}(-(x -_{}(z))^{T}^{-1}(x-_{}(z))),\]

where \(_{}:^{d_{z}}^{d_{z}}\); and \(^{d_{x} d_{x}}\) and is positive definite. In this section, we show that Assumptions 2 and 3 are implied by Assumptions 4 and 5.

**Assumption 4**.: \(_{}\) is bounded and \(\) is positive definite: there exists \(B_{}_{>0}\) such that the following holds for all \((,z)^{d_{z}}\):

\[\|_{(,z)}_{}(z)\|_{F} B_{},\]

and for any \(x^{d_{x}} 0\), \(x^{T} x>0\).

**Assumption 5**.: \(_{}\) is Lipschitz and has Lipschitz gradient, i.e., there exist constants \(K_{}_{>0}\) such that for all \((,z),(^{},z^{})^{d_{z}}\) the following hold:

\[\|_{}(z)-_{^{}}(z^{})\|  K_{}\|(,z)-(^{},z^{})\|,\] \[\|_{(,z)}_{}(z)-_{(,z)}_{ ^{}}(z^{})\|_{F}  K_{}\|(,z)-(^{},z^{})\|.\]

### \(k_{}\) satisfies Assumption 2

In this section, we show that \(k_{}\) satisfies Assumption 2. We first show the boundedness property then the Lipschitz property.

Boundedness.First, we shall show that \(k_{}\) is bounded. Clearly, we have \(k_{}(x|z)[0,(2)^{-d_{x}/2}{()}^{-0.5}]\) hence \(|k_{}|\) is bounded as a consequence of Assumption 4. Now to show that \(\|_{(,x,z)}k_{}(x|z)\|\) is bounded, we have the following

\[_{x}k_{}(x|z) =-k_{}(x|z)^{-1}(x-_{}(z)),\] \[_{z}k_{}(x|z) =\,_{z}_{}(z)_{}(x;, ^{2}I_{d_{x}})_{_{}(z)},\] \[_{}k_{}(x|z) =\,_{}_{}(z)_{}(x;, ^{2}I_{d_{x}})_{_{}(z)}.\]

Hence, we have \(\|_{(x,,)}(x;_{}(z),^{2}I_{d_{x}}) \|<\), from Assumption 4 and using the fact the gradient of a Gaussian density of given covariance w.r.t. \(\) is uniformly bounded. Thus, we have shown that \(k_{}\) satisfies the boundedness property in Assumption 2.

Lipschitz.For \(k_{}\), one choice of coupling function and noise distribution is \(_{}(z,)=^{}+_{}(z)\) and \(p_{k}=(0,I_{d_{x}})\) where \(^{}\) be the unique symmetric and positive definite matrix with \((^{})^{2}=\)(Horn and Johnson, 2012, Theorem 7.2.6); and the inverse map is \(_{}^{-1}(z,x)=^{-}(x-_{}(z))\). Thus, from the change-of-variables formula, we have

\[_{x}k_{}(x|z) =_{x}[p_{k}(_{}^{-1}(z,x)){(_{x}_{ }^{-1}(z,x))}]\] \[={(_{x}_{}^{-1}(z,x))_{x}[p_{k}( _{}^{-1}(z,x))}]\] \[=(^{-1/2})^{-1/2}_{x}p_{k}(_{}^{- 1}(z,x))\] \[=^{-}_{x}p_{k}(_{}^{-1}( z,x))\]

where \(^{-}:=(^{-1/2})^{-1/2}\). Thus, we have

\[\|_{x}k_{}(x|z)-_{x}k_{^{}}(x^{ }|z^{})\|\] \[\|^{-}_{x}p_{k}(_{}^ {-1}(z,x))-^{-}_{x}p_{k}(_{^{}}^ {-1}(z^{},x^{}))\|\] \[\|^{-}\|_{F}\|_{x}p_{k}(_ {}^{-1}(z,x))-_{x}p_{k}(_{^{}}^{-1}(z^{},x^{ }))\|\] \[ C\|_{}^{-1}(z,x)-_{^{}}^{-1}(z^{ },x^{})\|,\]where \(C\) is a constant and we use the following facts: \(\|^{-}\|_{F}|(^{-1/2})||^{-1/2}\|_{F}<\) following from the fact \(^{-1/2}\) is positive definite; \(p_{k}\) is a standard Gaussian density function with Lipschitz gradients; and that the inverse map \(^{-1}\) is Lipschitz from Assumptions 4 and 5:

\[\|_{}^{-1}(z,x)-_{^{}}^{-1}(z^{},x^{})\| \|^{-}\|_{F}\|(x,_{}(z))-(x^{},_{ ^{}}(z^{}))\| C^{}\|(x,,z)-(x^{}, ^{},z^{})\|.\]

Hence, we have shown that \(k_{}\) satisfies the Lipschitz property of Assumption 2, and so Assumption 2 holds for \(k_{}\).

### \(k_{}\) satisfies Assumption 3

One can compute the gradient as

\[_{(,z)}_{}(z,)=_{(,z)}_{} (z),\]

and hence \(\|_{(,z)}_{}(z,)\|_{F}\) is bounded from Assumption 4. The Lipschitz gradient property is immediate from Assumption 5.

\(p_{k}\) has finite second moments since it is a Gaussian with positive definite covariance matrix.

## Appendix D Proofs in Section 2

Proof of Prop. 1.: We start by showing \(_{}=_{}\). To this end, we begin by showing the inclusion \(_{}_{}\), i.e., \((_{;,p_{k}},_{,p_{r }})(_{;,p_{k}}, \{p_{r}\})\). Let \(q(_{;,p_{k}},_{,p _{r}})\), then there is some \(f\) and \(g\) such that \(q=q_{k_{f,,p_{k}},g_{\#}p_{r}}\). From straight-forward computation, we have

\[q_{k_{f,,p_{k}},g_{\#}p_{r}}=_{z q_{\#}p_{r}}[k_{f;,p_{k} }(|z)]}{{=}}_{z p_{r}}[k_{f; ,p_{k}}(|g(z))](_{;,p_{k}},\{p_{r}\}),\]

where (a) follows the law of the unconscious statistician, and the last element-of follows from the fact that \(k_{f;,p_{k}}(|g()))=(f g(),)_{\#}p_{k} _{;,p_{k}}\). We can follow the argument above in reverse to obtain the reverse inclusion. Hence, we have obtained as desired.

That \(_{}=_{}\), follows in a similar manner, which we shall outline for completeness: let \(q(_{;,p_{k}},_{, p_{r}})\), then

\[q=q_{k_{f,,p_{k}},g_{\#}p_{r}}=_{z q_{\#}p_{r}}[k_{f;,p_{k}}( |z)]=_{z f g_{\#}p_{r}}[k_{,p_{k}}(|z)] _{}.\]

One can conclude by applying the same logic in the reverse direction. 

## Appendix E Proofs in Section 3

### Proof of Prop. 2

Proof of Prop. 2.: (\(\) is lower bounded). Clearly, we have

\[(,r)=(q_{,r},p(|y))- p(y)- p (y),\]

Hence, we have \((,r)[- p(y),)\) which is lower bounded by our assumption.

(\(\) is lower semi-continuous). Let \((_{n},r_{n})_{n}\) be such that \(_{n}r_{n}=r\) and \(_{n}_{n}=\).

We can split the domain of integration, and write \(\) equivalently as

\[(,r) =_{[1,)}((x)})((x)}{p(x,y)})}_{ 0}q_{ ,r}(x)\,x\] (18) \[+_{[0,1)}((x)})((x)}{p(x,y)})}_{ 0}q_{ ,r}(x)\,x\] (19)

We shall focus on the RHS of (18).

Note that we have the following bound

\[|-_{[1,)}(,r_{n} }(x)})(,r_{n}}(x)}{p(x,y)})q_{_{n},r_{n}}(x)|\] \[ \{0,(,r_{n}}(x)} )q_{_{n},r_{n}}(x)\}\{0,C\},\]

where \(C\) is some constant. The last inequality follows from the fact that the evidence is bounded from above and the kernel is bounded. We can apply Reverse Fatou's Lemma to obtain

\[_{n}-_{[1,)}(,r_{n}}(x)})(,r_{n}}(x)}{p(x,y )})q_{_{n},r_{n}}(x)\,x\] \[ _{n}(-_{[1,)}( ,r_{n}}(x)})(,r_ {n}}(x)}{p(x,y)})q_{_{n},r_{n}}(x))\,x.\]

Since we have the following relationships

\[_{n}_{[1,)}(,r_{n}}(x)}) _{[1,)}((x)} ),\] \[_{n}-(,r_{n}}(x)}) =-((x)}),\] \[_{n}q_{_{n},r_{n}} =q_{,r},\]

where the first line is from u.s.c. of \(_{[1,)}\); the second line from the continuity of \(\); the final line follows from the bounded kernel \(k\) assumption and dominated convergence theorem.

Thus, we have that

\[_{n}-_{[1,)}(,r_{n}}(x)})(,r_{n}}(x)}{p(x,y )})q_{_{n},r_{n}}(x)\,x\] \[ -_{[1,)}((x)} )((x)}{p(x,y)})q_{,r}(x)\, x,\]

Using the fact that \(_{n}-x_{n}=-_{n}x_{n}\), we have shown that

\[-_{n}_{[1,)}(,r_{n}}(x)})(,r_{n}}(x)}{p(x,y )})q_{_{n},r_{n}}(x)\,x\] \[ -_{[1,)}((x)} )((x)}{p(x,y)})q_{,r}(x)\, x.\] (20)

Similarly, for the RHS of (19), using Fatou's Lemma (with varying measure and the set-wise convergence of \(q_{_{n},r_{n}}\)) and using the l.s.c. of \(_{[0,1)}\), we obtain that

\[_{n}_{[0,1)}(,r_{n}}(x)})(,r_{n}}(x)}{p(x,y)} )q_{_{n},r_{n}}(x)\,x\] \[ _{[0,1)}((x)}) ((x)}{p(x,y)})q_{,r}(x)\,x.\] (21)

Hence, combining the bounds (20) and (21), we have that shown that

\[_{n}(_{n},r_{n})=_{n }(,r_{n}}(x)}{p(x,y)})q_{_{n },r_{n}}(x)\,x\] \[ ((x)}{p(x,y)})q_{,r}(x )\,x(,r).\]

In other words, \(\) is lower semi-continuous.

(Non-Coercivity) To show non-coercivity, we will show that there exists some level set \(\{(,r):(,r)\}\) that is not compact. We do this by finding a sequence contained in the level set that does not contain a (weakly) converging subsequence.

Consider the sequence \(:=(_{n},r_{n})_{n}\) where \(_{n}=_{0}\); \(\|_{0}\|<\); \(r_{n}=_{n}\); \(k_{}(x|z)=(x;,I_{d_{x}})\); and \(p(x|y)=(x;0,I_{d_{x}})\). Clearly, we have \(q_{,r}(x)=(x;,I_{d_{x}})\) and so \((q_{,r},p(|y))=\|\|^{2}\). Hence, there is a \(<\) such that

\[(_{n},r_{n})=(q_{_{n},r_{n}},p(|y))-  p(y)\|_{0}\|^{2}- p(y).\]

Thus, we have shown that \(\{(,r):(,r)\}\). However, since the support of the elements of \(\{r_{n}(^{d_{x}})\}_{n}\) eventually lies outside a ball of radius \(R\) for any \(R<\) and hence of any compact set, \(\) is not tight. Hence, Prokhorov's theorem (Shiryaev, 1996, p. 318) tells us that, as \(\) is not tight, it is not relatively compact. We conclude that, as the level set is not relatively compact, the functional is not-coercive. 

### Proof of Prop. 3

Proof of Prop. 3.: (Coercivity) Consider the level set \(\{(,r):_{}(,r)\}\), which is contained in a relatively compact set. To see this, first note that

\[\{(,r):_{}(,r)\} \{(,r):- p(y)+_{}(,r) \}\] \[\{(,r):_{}(,r)+  p(y)\}\]

By coercivity of \(_{}\), i.e., the above level set is relatively compact hence \(_{}\) is coercive.

(Lower semi-continuity) Lower semi-continuity (l.s.c.) follows immediately from the l.s.c. of \(\) and \(_{}\).

(Existence of a minimizer) The existence of a minimizer follows from Dal Maso (2012, Theorem 1.15) utilizing coercivity and l.s.c. of \(_{}\). 

### Proof of Prop. 4

Recall from Santambrogio (2015, Definition 7.12),

**Definition E.1** (First Variation).: If \(p\) is regular for \(F\), the first variation of \(F:(^{d_{z}})\), if it exists, is the element that satisfies

\[_{ 0}=_{r}F[r](z )(z),\]

for any perturbation \(=-p\) with \((^{d_{z}}) L_{c}^{}(^{d_{ z}})\) (see Santambrogio (2015, Notation)).

One can decompose the first variation of \(_{}^{}\) as:

\[_{r}_{}^{}[,r]=_{r}^{ }[,r]+_{r}_{}^{}[,r].\]

where \(^{}:(,r)((x)+ }{p(x,y)})q_{,r}(x)\). Since \(_{r}_{}^{}[,r]=_{r}_{r} (r|p_{0})\), its first variation follows immediately from standard calculations (Ambrosio et al., 2005; Santambrogio, 2015). As for \(_{r}^{}\), we have the following proposition:

**Proposition 10** (First Variation of \(^{}\)).: _Assume that for all \((,r,z)^{d_{z}}\),_

\[_{k_{}(X|z)}|((X)+}{p(X, y)})|<,\]

_then we obtain_

\[_{r}^{}[,r](z)=_{k_{}(X|z)}[ ((X)+}{p(X,y)})+(X)}{ q_{,r}(X)+}].\]

Proof.: Since \(q_{,r+}= k_{}(|z)(r+)(z)\, z=q_{,r}+ q_{,}\), we have

\[^{}(,r+)= _{}q_{,r+}(x)((x)+}{p(y,x)})\,x\] \[= _{}[q_{,r}+ q_{,}](x)([q _{,r}+ q_{,}](x)+)\,x\] \[-_{}[q_{,r}+ q_{,}](x) p (y,x)\,x.\]

[MISSING_PAGE_FAIL:20]

### Proof of Prop. 8

Proof of Prop. 8.: We can equivalently write the \(\)-PVI flow in Eq. (17) as follows

\[(_{t},Z_{t})=^{}(_{t},(Z_{t}),Z _{t})\,t+\,W_{t},\] (23)

where \(=0&0\\ 0&}I_{d_{z}}\), and

\[^{}:^{d_{}}() ^{d_{z}}^{d_{}+d_{z}}:(,r,Z) -_{}_{}^{}(,r)\\ b^{}(,r,Z).\]

In App. F.4, we show that under our assumptions the drift \(^{}\) is Lipschitz. And under Lipschitz regularity conditions, the proof follows similarly to Lim et al. (2024) which we shall outline for completeness.

We begin endowing the space \((^{d_{z}})\) with the metric

\[((,r),(^{},r^{}))=\|^{2}+_{2}^{2}(q,q^{})}.\]

Let \( C([0,T],(^{d_{z}}))\) and denote \(_{t}=(_{t}^{},_{t}^{})\) for it's respective components. Consider the process that substitutes \(\) into (23), in place of the \((Z_{t})\) and \(_{t}\),

\[(_{t}^{},Z_{t}^{})=^{}( _{t}^{},_{t}^{},Z_{t}^{})\,t+ \,W_{t}.\]

whose existence and uniqueness of strong solutions are given by Carmona (2016)[Theorem 1.2].

Define the operator

\[F_{T}:C([0,T],(^{d_{z}})) C([0,T], (^{d_{z}})):(t(_{t}^{ },(Z_{t}^{})).\]

Let \((_{t},Z_{t})\) denote a process that is a solution to (23) then the function \(t(_{t},(Z_{t}))\) is a fixed point of the operator \(F_{T}\). The converse also holds. Thus, it is sufficient to establish the existence and uniqueness of the fixed point of the operator \(F_{T}\). For \(=(,)\) and \(^{}=(^{},^{})\)

\[\|_{t}^{}-_{t}^{^{}}\|^{2}+ [\|Z_{t}^{}-Z_{t}^{^{}}\|]^{2} =\|_{0}^{t}^{}(_{s}, _{s},Z_{s}^{})-^{}(_{s}^{},_{s}^{ },Z_{s}^{^{}})\,s\|^{2}\] \[ tC_{0}^{t}[\|Z_{s}^{}-Z_{s}^{ ^{}}\|^{2}+\|_{s}-_{s}^{}\|^{2}+_{1}^{2}(_{s},_{s}^{})]\,s\] \[ C(t)_{0}^{t}[_{2}^{2}(_{s},_{s}^{ })+\|_{s}-_{s}^{}\|^{2}]\,s,\]

where we apply Jensen's inequality; \(C_{r}\)-inequality; Lipschitz drift of \(^{}\); and Gronwall's inequality. The constant \(C:=3K_{b}^{2}\) and \(C(t):=tC(t^{2}C)\). Thus, we have

\[^{2}(F_{T}()_{t},F_{T}(^{})_{t}) C(t)_ {0}^{t}^{2}(_{s},_{s}^{})\,s.\]

Then, for \(F_{T}^{k}\) denoting \(k\) successive composition of \(F_{T}\), one can inductively show that it satisfies

\[^{2}(F_{T}^{k}()_{t},F_{T}^{k}(^{})_{t}) }{k!}_{s[0,T]}^{2}(_{s},_{s}^ {}).\]

Taking the supremum, we have

\[_{s[0,T]}^{2}(F_{T}^{k}()_{s},F_{T}^{k}(^{ })_{s})}{k!}_{s[0,T]}^{2}( _{s},_{s}^{}).\]

Thus, for a large enough \(k\), we have shown that \(F_{T}^{k}\) is a contraction and from Banach Fixed Point Theorem and the completeness of the space \((C([0,T],(^{d_{z}})),)\), we have existence and uniqueness.

[MISSING_PAGE_FAIL:22]

where \(C_{z}:=3K_{b}^{2}\),and, as before, we apply Cauchy-Schwarz, Lipschitz and \(C_{r}\) inequalities. Then from Eqs. (26) to (28), we obtain

\[(b) C_{0}^{T}_{s[0,T]}\|_{s}^{,M}-_{s }^{}\|^{2}+_{s[0,T]}_{m=1}^{M}\|Z_{s,m}^{}-Z_ {s,m}^{,M}\|^{2}\,+o(1)s.\] (30)

Combining Eqs. (29) and (30) and applying Gronwall's inequality, we obtain

\[_{t[0,T]}\|_{t}^{}-_{t}^{,M}\|^{2}+ _{t[0,T]}\{_{m=1}^{M}\|Z_{t,m}^{}-Z _{t,m}^{,M}\|^{2}\}=o(1).\]

Taking the limit, we have the desired result. 

### The drift in Eq. (17) is Lipschitz

In this section, we show that the drift in the \(\)-PVI flow in Eq. (17) is Lipschitz.

**Proposition 11**.: _Under the same assumptions as Prop. 8; the drift \((A,r)\) is Lipschitz, i.e., there exists a constant \(K_{}_{>0}\) such that:_

\[\|^{}(,r,z)-^{}(^{},r^{ },z^{})\| K_{}(\|(,z)-(^{},z^{})\| +_{2}(r,r^{})),\ \ ,^{},z,z^{} ,r,r^{}().\]

Proof.: From the definition and using the concavity of \(\) (which ensures that for any \(a,b 0\), \(+\)), we obtain

\[\|^{}(,r,z)-^{}(^{},r^{ },z^{})\|\|_{}_{}^{}(,r)- _{}_{}^{}(^{},r^{})\|+ \|b^{}(,r,z)-b^{}(^{},r^{},z^{})\|.\]

It is established below in Prop. 12 that \(_{}_{}^{}\) satisfies a Lipschitz inequality, i.e., there is some \(K_{_{}^{}}_{>0}\) such that

\[\|_{}_{}^{}(,r)-_{} _{}^{}(^{},r^{})\| K_{_{}^{}}(\|-^{}\|+_{2}(r,r^{})).\]

It is established below in Prop. 13 that \(b^{}\) satisfies a Lipschitz inequality, i.e., there is some \(K_{b^{}}_{>0}\) such that

\[\|b^{}(,r,z)-b^{}(^{},r^{},z^{})\|  K_{b^{}}(\|(,z)-(^{},z^{})\|+_{2 }(r,r^{})).\]

Hence, we have obtained as desired with \(K_{}=K_{_{}^{}}+K_{b^{}}\). 

**Proposition 12**.: _Under the same assumptions as Prop. 8, the function \((,r)_{}_{}^{}(,r)\) is Lipschitz, i.e., there exist some constant \(K_{_{}^{}}_{>0}\) such that_

\[\|_{}_{}^{}(,r)-_{} _{}^{}(^{},r^{})\| K_{_{}^{}}(\|-^{}\|+_{2}(r,r^{})),\ \ (,r),(^{},r^{}).\]

Proof.: From the definition, we have

\[_{}_{}^{}(,r)=_{} ^{}(,r)+_{}_{}(,r).\]

Thus, if both \(_{}^{}\) and \(_{}_{}\) are Lipschitz, then so is \(_{}_{}^{}\). Since \(_{}\) has Lipschitz gradient (by Assumption 1), it remains to be shown that \(_{}^{}\) is Lipschitz. From Prop. 6, we have

\[_{}^{}(,r)=_{p_{k}()r(z)} [(_{}_{}[s_{,r}^{}-s_{p}])(z, )]=_{}_{} d_{,r}^{p,}(z,)\,p_{k}()r(z),\]

where \(d_{,r}^{p,}(z,):=s_{,r}^{}(z,)-s_{p}(z,)\). Then, applying Jensen's inequality, we obtain

\[\|_{}^{}(,r)-_{} ^{}(^{},r^{})\|\] \[=\| p()[_{}_{}  d_{,r}^{p,}(z,)r(z)-_{}_{^{ }} d_{^{},r^{}}^{p,}(z,)r^{}(z )]z\|\] \[ p()\|[_{}_{}  d_{,r}^{p,}(z,)r(z)-_{}_{^{ }} d_{^{},r^{}}^{p,}(z,)r^{}(z )]z\|.\] (31)

[MISSING_PAGE_FAIL:24]

inequality. Then, from the fact that

\[_{p_{k}()}[(a_{}\|\|+b_{})(a_{d}\| \|+b_{d})]<,\ \ _{p_{k}()}[(a_{}\|\|+b_{})^{2}+\|d_{ ,r}^{p,}(z^{},)\|^{2}]<,\] (36)

which holds from the assumption that \(p_{k}\) has finite second moments Assumption 3, and from our assumption that \(_{p_{k}()}\|d_{,r}^{p,}(z^{},)\|\) is bounded. Hence, the map is Lipschitz and so Eq. (34) holds.

As for Eq. (35), we focus on the integrand in Eq. (33)

\[_{p_{k}()}\|_{}_{}  d_{,r}^{p,}(z,)-_{}_{^{ }} d_{^{},r^{}}^{p,}(z,)\|\] \[ _{p_{k}()}[\|_{}_{ }(d_{,r}^{p,}-d_{^{},r^{}}^{p, })(z,)\|+\|(_{}_{}-_{} _{^{}}) d_{^{},r^{}}^{p}(z,) \|]\] \[ _{p_{k}()}[\|_{}_{ }(z,)\|_{F}\|(d_{,r}^{p,}-d_{^{},r^{ }}^{p,})(z,)\|+\|(_{}_{}- _{}_{^{}})(z,)\|_{F}\|d_{ ^{},r^{}}^{p,}(z,)\|]\] \[ _{p_{k}()}((a_{}\|\|+b_{} )(a_{d}\|\|+b_{d}))(\|-^{}\|+_ {1}(r,r^{}))\] \[+ _{p_{k}()}[(a_{}\|\|+b_{} )\|d_{^{},r^{}}^{p,}(z,)\|] \|-^{}\|,\]

where, for the last line, we apply Prop. 15 and Assumption 3. Applying Young's inequality and (36), we have the desired result. 

**Proposition 13** (\(b^{}\) is Lipschitz).: _Under the same assumptions as Prop. 8, the map \(b^{}\) is \(K_{b^{}}\)-Lipschitz, i.e., there exists a constant \(K_{b^{}}_{>0}\) such that the following inequality holds for all \((,z,r),(^{},z^{},r^{}) ^{d_{z}}(^{d_{z}})\):_

\[\|b^{}(,r,z)-b^{}(^{},r^{},z^{})\|  K_{b^{}}(\|(,z)-(^{},z^{})\|+_{1} (r,r^{})).\]

Proof.: One can write the drift \(b^{}\) as follows (can be found in Eq. (43) similarly to Prop. 6), we have

\[b^{}(,r,z)=-_{p_{k}()}[(_{z}_{ }[s_{,r}^{}-s_{p}+_{,r}^{}])(z, )]+_{x} p_{0}(z),\]

where \(_{,r}^{}(z,):=q_{,r}( _{}(z,))}{(q_{,r}(_{}(z,))+)^ {2}}\). Hence,

\[\|b^{}(,r,z)-b^{}(^{},r^{},z^{ })\| \|_{p_{k}()}[(_{z}_{}[d_{ ,r}^{p,}+_{,r}^{}])(z,)-(_{z}_ {^{}}[d_{^{},r^{}}^{p}+_{^{ },r^{}}^{}])(z^{},)]\|\] \[+\|_{z} p_{0}(z)-_{z} p_{0}(z^{})\|\] \[_{p_{k}()}\|(_{z}_{} d _{,r}^{p,}+_{,r}^{})(z,)-(_{z}_ {^{}}[d_{^{},r^{}}^{p,}+_{ ^{},r^{}}^{}])(z^{},)\|\] \[+K_{P_{0}}\|z-z^{}\|,\]

where for the last inequality we use Jensen's inequality and Assumption 1. Since we have

\[_{p_{k}()}\|(_{z}_{}[d_{ ,r}^{p,}+_{,r}^{}])(z,)-(_{z}_ {^{}}[d_{^{},r^{}}^{p,}+_{ ^{},r^{}}^{}])(z^{},)\|\] \[ _{p_{k}()}\|(_{z}_{}[d_{ ,r}^{p,}+_{^{},r}^{}])(z,)-_{z }_{}(z,)[d_{^{},r^{}}^{p,}+ _{^{},r^{}}^{}](z^{},)\|\] \[+ _{p_{k}()}\|_{z}_{}(z,) [d_{^{},r^{}}^{p,}+_{^{},r^{}}^{ }](z^{},)-(_{z}_{^{}}[d_{^{ },r^{}}^{p,}+_{^{},r^{}}^{}])(z^ {},)\|\] \[ _{p_{k}()}\|_{z}_{}(z,) \|_{F}\|(d_{,r}^{p,}+_{,r}^{})(z,)-(d_{ ^{},r^{}}^{p,}+_{^{},r^{}}^{ })(z^{},)\|\] \[+ _{p_{k}()}\|_{z}_{}(z,) -_{z}_{^{}}(z^{},)\|_{F}\|(d_{^{ },r^{}}^{p,}+_{^{},r^{}}^{})(z^ {},)\|\] \[ _{p_{k}()}(a_{}\|\|+b_{})(\|d _{,r}^{p,}(z,)-d_{^{},r^{}}^{p,}(z ^{},)\|+\|_{,r}^{}(z,)-_{^{ },r^{}}^{}(z^{},)\|)\] (37) \[+ _{p_{k}()}(a_{}\|\|+b_{})\|(d_{ ^{},r^{}}^{p,}+_{^{},r^{}}^{} (z^{},))\|\|(,z)-(^{},z^{})\|\] (38)

where, for (a), we add and subtract the relevant terms and invoke the triangle inequality, in (b) we use properties of the matrix norm, and in (c) we use the bounded gradient and Lipschitz gradient in Assumption 3. For Eq. (37); upon using Props. 14 and 15, which are established below, we obtain

\[_{p_{k}()}(a_{}\|\|+b_{})(\|d_{ ,r}^{p,}(z,)-d_{^{},r^{}}^{p,}(z^{ },)\|+\|_As for the second term, Eq. (38),

\[_{p_{k}()}(a_{}\|\|+b_{})\|(d^{p, }_{^{},r^{}}+^{}_{^{},r^{} })(z^{},)\|\] \[}{{}} _{p_{k}()}(a_{}\|\|+b_{})\|d^{p, }_{^{},r^{}}(z^{},)\|+\|^{} _{^{},r^{}}(z^{},)\|]\] \[}{{}} _{p_{k}()}(a_{}\|\|+b_{})\|d^{p, }_{^{},r^{}}(z^{},)\|+B_{}]\] \[}{{}} _{p_{k}()}(a_{}\|\|+b_{ })^{2}+\|d^{p,}_{^{},r^{}}(z^{}, )\|^{2}+B_{}(a_{}\|\|+b_{})\] (40)

where (a) follows from the triangle inequality, (b) we use Prop. 14 boundedness of \(\), (c) we apply Young's inequality to the first term. Similarly to Eq. (36), from our Assumption 3 and our boundness assumption of the score, we have as desired. Combining Eq. (39) with the result of plugging Eq. (40) into Eq. (38), we obtain the result. 

**Proposition 14** (\(\) is Lipschitz and bounded).: _Under Assumption 2, the map \((,r,z)^{}_{,r}(z,)\) is Lipschitz and bounded. (Lipschitz) there are constants \(a_{},b_{}_{>0}\) such that following hold:_

\[\|^{}_{,r}(z,)-^{}_{,r}(z, )\|(a_{}\|\|+b_{})(\|(,z)-(^{ },z^{})\|+_{1}(r,r^{})).\]

_Furthermore, it is bounded_

Proof.: Since \(^{}_{,r}=(q_{,r}(x)+)} {q_{,r}(x)+}\), where \(x:=_{}(z,)\), and \(x^{}:=_{^{}}(z^{},)\), we have:

\[\|^{}_{,r}(z,)-^{}_{ ^{},r^{}}(z^{},)\|\] \[\|,r^{}}(x^{ })+)_{x}(q_{,r}(x)+)-(q_{,r}(x)+) _{x}(q_{^{},r^{}}(x^{})+)}{(q_{,r}(x)+)(q_{^{},r^{}}(x^{})+)}\|\] \[|q_{^{},r^{}}(x^{})-q _{,r}(x)|\|_{x}(q_{,r}(x)+)\|\] \[+(q_{,r}(x)+)\|_{x}(q_{ ,r}(x)+)-_{x}(q_{^{},r^{}}(x^{ })+)\|\] \[}{^{2}}|q_{^{},r^{}}(x^{ })-q_{,r}(x)|++)}{}\|s^{}_{,r }(z,)-s^{}_{^{},r^{}}(z^{},)\|\] \[}{^{2}}(1+a_{}\|\|+b_{})(\|( ,z)-(^{},z^{})\|+_{1}(r,r^{}))\] \[++}{^{2}}(a_{s}\|\|+b_{s})(\|( ,z)-(^{},z^{})\|+_{1}(r,r^{})),\]

where the last inequality follows from applying Prop. 18 and Assumption 3 to the first term and Prop. 16 to the last term. Hence, we have as desired. 

Boundedness follows from the fact that \(\|q_{,r}(_{}(z,))}{(q_{ ,r}(_{}(z,))+^{2})}\| \|_{x}q_{,r}(_{}(z,))\|}{}\). 

**Proposition 15**.: _Under Assumptions 1 to 3, the map \((,r,z) s^{}_{,r}(z,)-s_{p}(z,)=:d^{p, }_{,r}(z,)\) satisfies the following: there exist \(a_{d},b_{d}_{>0}\) such that for all \((,r),(^{},r^{})\), and \(z,z^{}^{d_{z}}\), we have_

\[\|d^{p,}_{,r}(z,)-d^{p,}_{^{},r^{}}(z ^{},)\|(a_{d}\|\|+b_{d})(\|(,z)-(^{ },z^{})\|+_{1}(r,r^{})).\]

Proof.: Let \(x:=_{}(z,)\), and \(x^{}:=_{^{}}(z^{},)\). Then, we have

\[\|d^{p,}_{,r}(z,)-d^{p,}_{^{ },r^{}}(z^{},)\| \|_{x} p(x,y)-_{x} p(x^{},y)\|\] \[+\|_{x}(q_{,r}(x)+)-_{x}(q_{^{ },r^{}}(x^{})+)\|\] \[ K_{p}\|x-x^{}\|+\|_{x}(q_{,r}(x)+)- _{x}(q_{^{},r^{}}(x^{})+)\|\] \[ K_{p}(a_{}\|\|+b_{})\|(,z)-(^{ },z^{})\|\] \[+(a_{s}\|\|+b_{s})(\|(,z)-(^{},z^{}) \|+_{1}(r,r^{})),\]

where Prop. 16 and Assumptions 1 and 3 are used.

**Proposition 16** (\(s\) is Lipschitz).: _Under Assumptions 2 and 3 and \(>0\), the map \((,r,z) s_{,r}^{}(z,)\) satisfies the following: there exist constants \(a_{s},b_{s}_{>0}\) such that the following inequality holds for all \((,r),(^{},r^{})\), and \(z,z^{}^{d_{z}}\):_

\[\|s_{,r}^{}(z,)-s_{^{},r^{}}^{}(z ^{},)\|(a_{s}\|\|+b_{s})(\|(,z)-(^{ },z^{})\|+_{1}(r,r^{})),\]

Proof.: For brevity, we write \(x=_{}(z,)\) and \(x^{}=_{^{}}(z^{},)\); from the definition, we have

\[\|s_{,r}^{}(z,)-s_{^{},r^{} }^{}(z^{},)\| =\|q_{,r}(x)}{q_{,r} (x)+}-q_{^{},r^{}}(x ^{})}{q_{^{},r}(x^{})+}\|\] \[\|q_{,r}(x )}{q_{,r}(x)+}-q_{^{ },r^{}}(x^{})}{q_{,r}(x)+} \|+\|q_{^{},r^{}}(x^{} )}{q_{,r}(x)+}-q_{^{ },r^{}}(x^{})}{q_{^{},r^{}}(x^{ })+}\|\] \[(x)+}\|_{x}q _{,r}(x)-_{x}q_{^{},r^{}}(x^{ })\|\] \[+\|_{x}q_{^{},r^{}}(x^{} )\|\|(x)+}-,r^{}}(x^{})+}|\] \[\|_{x}q_{,r }(x)-_{x}q_{^{},r^{}}(x^{} )\|+}{^{2}}|q_{,r}(x)-q_{^{},r^ {}}(x^{})|,\] (41)

where (a) we add and subtract the relevant terms and the triangle inequality; (b) we use the fact that \(\|_{x}q_{^{},r^{}}(x^{})\|=\| _{x}k_{^{}}(x^{}|z)r^{}(z)\| B_{k}\) (from Cauchy-Schwartz and the boundedness part of Assumption 2). Now, we deal with the terms individually. For the first term in Eq. (41), we use the fact that the map \((,r,z)_{x}q_{,r}(_{}(z,))\) is \(K_{q}\)-Lipschitz from Prop. 17. As for the second term in Eq. (41), we apply Prop. 18.

Hence, we obtain

\[\|s_{,r}^{}(z,)-s_{^{},r^{} }^{}(z^{},)\| (}{}+K_{q}}{^{2}} )(\|(,x)-(^{},x^{})\|+_{1}(r,r^{ }))\] \[(}{}+K_{q}}{^{2}} )(1+a_{}\|\|+b_{})(\|(,z)-(^{},z^{ })\|+_{1}(r,r^{})),\]

where we use Assumption 3 for the last line. 

**Proposition 17**.: _Under Assumption 2, the map \((,r,x)_{x}q_{,r}(x)\) is Lipschitz, i.e., for all \(\), there exists a \(K_{gq}_{>0}\) such that the following inequality holds for all \((,r),(^{},r^{})\) and \(z,z^{}^{d_{z}}\),_

\[\|_{x}q_{,r}(x)-_{x}q_{^{},r^{}}(x^{} )\| K_{gq}(\|(,x)-(^{},x^{})\|+_{1}(r,r^ {})).\]

Proof.: From direct computation,

\[\|_{x}q_{,r}(x)-_{x}q_{^{ },r^{}}(x^{})\| =\|[_{x}k_{}(x|z)r(z)-_{x}k _{^{}}(x^{}|z)r^{}(z)]z\|\] \[\|_{x}[k_{}(x|z)-k_{^{ }}(x^{}|z)]\|\,r(z)z\] \[+\|_{x}k_{^{}}(x^{}|z)\|\,|r-r^{ }|(z)z\] \[K_{gq}(\|(,x)-(^{},x^{} )\|+_{1}(r,r^{})),\]

where (a) we add and subtract the appropriate terms, apply the triangle inequality and the Cauchy-Schwarz inequality; (b) for the first term, we use the Lipschitz gradient Assumption 2; and for the second term, we use the dual representation of \(_{1}\) with the fact map \(z\|_{x} k_{}(x|z)\|\) is \(K_{k}\)-Lipschitz from the reverse triangle inequality and the Lipschitz Assumption 2. 

**Proposition 18**.: _Under Assumption 2, the map \((,r,x) q_{,r}(x)\) is Lipschitz, i.e., there exists some \(K_{q}_{>0}\) such that for all \((,r,x),(^{},r^{},x^{})( ^{d_{z}})^{d_{x}}\), we have_

\[|q_{,r}(x)-q_{^{},r^{}}(x^{})|<K_{q}(\|(,x)-( ^{},x^{})\|+_{1}(r,r^{})).\]Proof.: From direct computation, we have

\[|q_{,r}(x)-q_{^{},r^{}}(x^{})| |q_{,r}(x)-q_{,r^{}}(x)|+|q_{,r^{ }}(x)-q_{^{},r^{}}(x^{})|\] \[|k_{}(x|z)||r-r^{}|(z)z+|k_{ }(x|z)-k_{^{}}(x^{}|z)|r(z)z\] \[}{{}}K_{q}(_{1}(r,r^{ })+||(,x)-(,x^{})|)\] (42)

where (a) for the first term, we use the fact that the map \(z|k_{}(x|z)|\) is \(B_{k}\)-Lipschitz (from the bounded gradient of Assumption 2), and again the Lipschitz property of \(k\) from the same assumption. 

## Appendix G Algorithmic details

### Gradient estimator

Proof of Prop. 6.: We show the derivation of the estimators in Eq. (10). Eq. (9) will follow similarly. We have

\[_{z}_{r}[,r](z) =_{z}_{k_{}(x|z)}[(x)}{p(y,x)}]\] \[=_{z}_{ p_{k}}[(_{}(z,))}{p(y,_{}(z,))}].\]

Assuming that \(_{}\) and \(p_{k}\) are sufficiently regular to justify the interchange of differentiation and integration, we obtain

\[_{z}_{r}[,r](z)=_{ p_{k}} [_{z}((z,))}{p(y,(z,) )}].\]

To obtain as desired, one can apply the chain rule. 

Similarly, one can derive a Monte Carlo gradient estimator for \(_{z}_{r}^{}\) as follows:

\[_{z}_{r}^{}[,r](z) =_{z}_{k_{}(x|z)}[(x)+}{p(y,x)}+(x)}{q_{,r}(x)+}]\] \[=_{z}_{ p_{k}}[(_{}(z,))+}{p(y,_{}(z,))}+ (_{}(z,))}{q_{,r}(_{}(z, ))+}].\]

As before, if \(_{}\) and \(p_{k}\) are sufficiently regular, we obtain

\[_{z}_{r}^{}[,r](z)=_{ p _{k}}[_{z}((z,))+}{p(y, (z,))}+(_{}(z,)) }{(q_{,r}(_{}(z,))+)^{2}}].\] (43)

To obtain as desired, one can apply chain rule.

### Preconditioners

Recall that the preconditioned gradient flow is given by

\[_{t}=-_{t}^{}_{}_{}( _{t},r_{t})\,t,\;\;_{t}r_{t}=_{z}(r_{t} _{t}^{r}_{z}_{r}_{}[_{t},r_{t}]),\]

where \(_{r}_{}[,r]=_{r}[,r]+ r /p_{0}\) We can rewrite the dynamics of \(r_{t}\) as

\[_{t}r_{t} =_{z}(r_{t}_{t}^{r}_{z}[_{r}[_{t},r_{t}]- p_{0}+ r_{t}]),\] \[=_{z}(r_{t}_{t}^{r}_{z}[_{r}[_{t},r_{t}]- p_{0}])+_{z}(r_{t}_{t}^{r}_{z}  r_{t}).\]

The second term can be written as

\[_{z}(r_{t}_{t}^{r}_{z} r_{t})=_{z}(_{t} ^{r}_{z}r_{t})=_{z}(_{z}[_{t}^{r}r_{t}])- _{z}(r_{t}_{z}_{t}^{r})\]where \((_{t}^{r})_{i}=_{j=1}^{d_{z}}_{z_{j}}[(_{t}^{r})_{ ij}]\), and last equality holds since

\[_{i=1}^{d_{z}}_{z_{i}}\{_{j=1}^{d_{z}}(_{t}^{r})_{ij} _{z_{j}}r_{t}\}=_{i=1}^{d_{z}}_{z_{i}}\{_{j =1}^{d_{z}}(_{z_{j}}[(_{t}^{r})_{ij}r_{t}]-r_{t} _{z_{j}}[(_{t}^{r})_{ij}])\}.\]

Hence, we have the following dynamics of \(r_{t}\):

\[_{t}r_{t}=_{z}(r_{t}(_{t}^{r}_{z}[_{ r}[_{t},r_{t}]- p_{0}]-_{z}_{t}^{r}))+_{z} (_{z}[_{t}^{r}r_{t}]))\]

**Examples.** Following in the essence of RMSProp (Tieleman and Hinton, 2012), we utilize the preconditioner defined as follows:

\[B_{k} = B_{k-1}+(1-)(A(\{_{z}_{r} [_{k},r_{k}](Z_{m})^{2}\}_{m=1}^{M}))\] \[_{k}^{r}(Z) =(B_{k})^{-0.5}\]

where \(B_{k}^{d_{z} d_{z}}\) and \(A\) is some aggregation function such as the mean or max. The idea is to normalize by the aggregated gradient of the first variation across all the particles since this is the dominant component in the drift of PVI. Similarly to RMSProp, it keeps an exponential moving average of the squared gradient which can then be used in the preconditioner.

## Appendix H Experimental details

In this section, we highlight additional details for reproducibility and computation. The code was written in JAX (Bradbury et al., 2018) and executed on a NVIDIA GeForce RTX 4090.

### Section 5.1

**Hyperparameters**. For the neural network, we use \(f_{}=(2,128,2)\) defined in Table 3, the number of particles \(M=100\), \(d_{z}=2\), \(K=1000\), \(h_{}=10^{-4}\), \(h_{z}=10^{-2}\), \(_{r}=10^{-8}\), for \(^{}\) we use RMSProp and we set \(^{r}=I_{2}\).

**Computation Time**. Each run took \(8\) seconds using JIT compilation.

### Section 5.2

In this section, we outline all the experimental details regarding Section 5.2.

**Densities.** Table 4 shows the densities used in the toy experiments.

**Hyperparameters.** We set the number of parameter updates and particle steps to be \(K=15000\), and \(d_{z}=2\).

   Name & Density \\  Banana & \((x_{2};x_{1}^{2}/4,1)(x_{1};0,2)\) \\ X-Shape & \((0,(2&1.8\\ 1.8.&2))+(0,( 2&-1.8\\ -1.8&2))\) \\ Multimodal & \(((2\\ 2),I)+(( -2\\ -2),I)+(( 2\\ -2),I)+(( -2\\ 2),I)\) \\   

Table 4: Densities used in toy experiments (see Section 5.2).

   Layers & Size \\  Input & \(d_{in}\) \\ Linear(\(d_{in}\), \(d_{h}\)), LReLU & \(d_{h}\) \\ Linear(\(d_{h}\),\(d_{h}\)), LReLU & \(d_{h}\) \\ Linear(\(d_{h}\),\(d_{out}\)), & \(d_{out}\) \\   

Table 3: Neural network architecture defined by \((d_{in},d_{h},d_{out})\).

* \(f_{}\). We use \(f_{}=(2,512,2)\).
* **PVI**. We use \(M=100\), \(_{}=0\), \(_{r}=10^{-8}\), \(h_{x}=10^{-2}\), \(h_{}=10^{-4}\), \(^{}\) we use the RMSProp preconditoner, \(^{r}=I_{d_{x}}\), and \(L=250\).
* **SVI**. We use \(K=50\) to estimate the objective (Yin and Zhou, 2018, see Eq. (5)) which are around the values used in Yin and Zhou (2018). We utilize RMSProp with step size \(10^{-4}\), and \(r=(0,I_{d_{x}})\). The implicit distribution is set to \(r=(0,I_{d_{x}})\).
* **UVI**. For the HMC sampler, we follow in (Titsias and Ruiz, 2019) and use \(50\) burn-in steps, with step-size \(10^{-1}\) and \(5\) leap-frog steps. We use the RMSProp optimizer with stepsize \(10^{-4}\) for \(k_{}\). The implicit distribution is set to \(r=(0,I_{d_{x}})\).
* **SM**. For the "dual" function written as \(f\) in the original paper (Yu and Zhang, 2023, see Algorithm 1) we use \((2,512,2)\). We utilize RMSProp with decaying learning rate from \(10^{-4}\) to \(10^{-5}\) to optimize the kernel \(k_{}\), and RMSProp with \(10^{-3}\) to \(10^{-4}\) for the dual function \(f\). The implicit distribution is set to \(r=(0,I_{d_{x}})\).

**Sliced Wasserstein Distance.** We report the average sliced Wasserstein distance using \(100\) projections computed from \(10000\) samples from the target and the variational distribution.

**Two-Sample Test.** We use the MMD-Fuse implementation found in https://github.com/antoninschrab/mmdfuse.git.

**Computation Time.** An example run on Banana with JIT compilation, PVI took \(42\) seconds, UVI took \(10\) minutes \(36\) seconds, SM took \(45\) seconds, and SVI took \(38\) seconds.

### Section 5.3

In this section, we outline all the hyperparameters for each method used.

**Hyperparameters.** We use \(K=20000\) set \(d_{z}=10\). For all kernel parameters, we use RMSProp preconditioner with step size \(h_{}=10^{-3}\).

* \(f_{}\). We use \(f_{}=(d_{z},512,22)\).
* **PVI**. We use \(M=100\), \(_{}=0\), \(_{r}=10^{-8}\), \(h_{x}=10^{-2}\), and for \(^{r}\) we use the one described in App. G.2 with mean as the aggregate function.
* **SVI**. We use \(K=50\) to estimate the objective (Yin and Zhou, 2018, see Eq. (5)) which are around the values used in Yin and Zhou (2018).
* **UVI**. For the HMC sampler, we follow in (Titsias and Ruiz, 2019) and use \(50\) burn-in steps, with step-size \(10^{-1}\) and \(5\) leap-frog steps.
* **SM**. We were unable to improve the performance of SM with our chosen kernel and instead used the implementation in https://github.com/longinYu/SIVISM?utm_source=catalyzer.com to obtain posterior samples with implementation details found in the code repository and in the paper (Yu and Zhang, 2023).

### Section 5.4

In this section, we outline all the experimental details regarding Section 5.4.

**Model.** We consider the neural network \((d_{in}^{},d_{h}^{})\) defined as \(f_{x}(o)=W_{2}^{}(W_{1}^{}o+b_{1})+b_{2}\) where \(o^{d_{in}^{}}\), \(x=[(W_{2}),b_{2},(W_{1}),b_{1}]^{}\), \(W_{2}^{d_{h}^{} 1}\), \(b_{2}\), \(W_{1}^{d_{in}^{} d_{h}^{}}\), \(b_{1}^{d_{h}^{}}\). Given an input-output pair \(:=\{(O_{i},Y_{i})\}_{i=1}^{B}\), the model can be defined as \(p(,x)=p(|x)p(x)\) where the likelihood is \(p(|x)=_{i=1}^{B}(Y_{i};f_{x}(O_{i}),0.01^{2})\) and the prior is \((x;0,25I)\).

**Datasets.** For all the datasets, we standardize by removing the mean and dividing by the standard deviation.

* **Protein**. For the model, we use \((9,30)\) which results in the problem having dimension \(d_{x}=331\). The dataset is composed of \(1600\) train examples, \(401\) test examples.

* **Yacht**. For the model, we use \((6,10)\) which results in the problem having dimension \(d_{x}=81\). The dataset is composed of \(246\) train examples and \(62\) test examples.
* **Concrete** For the model, we use \((8,10)\) which results in the problem having dimension \(d_{x}=101\). The dataset comprises of \(824\) training examples and \(206\) test examples.

**Hyperparameters.** We use \(K=1500\) set \(d_{z}=10\). For all kernel parameters, we use RMSProp preconditioner with step size \(h_{}=10^{-3}\) that decays to \(10^{-5}\) following a constant schedule that transitions every \(100\) parameters steps.

* \(f_{},_{}\). We use \(f_{}=(d_{z},512,d_{x})\) and \(_{}=((d_{z},512,d_{x}))+10^{-8}\) and they share parameters except for the last layers.
* **PVI**. We use \(M=100\), \(_{}=0\), \(_{r}=10^{-3}\), \(h_{x}=10^{-3}\), and for \(^{r}\) we use the one described in App. G.2 with mean as the aggregate function.
* **SVI**. We use \(K=50\) to estimate the objective (Yin and Zhou, 2018, see Eq. (5)) which are around the values used in Yin and Zhou (2018). The implicit distribution is set to \(r=(0,I_{d_{z}})\).
* **UVI**. For the HMC sampler, we follow in (Titsias and Ruiz, 2019) and use \(50\) burn-in steps, with step-size \(10^{-1}\) and \(5\) leap-frog steps. The implicit distribution is set to \(r=(0,I_{d_{z}})\).
* **SM**. For the "dual" function written as \(f\) in the original paper (Yu and Zhang, 2023, see Algorithm 1) we use \((d_{x},512,d_{x})\) and trained with RMSProp with stepsize \(10^{-2}\). We tried a decaying learning schedule to \(10-4\) but found that this degraded the performance. We used ReLU activations instead as we found that using leaky ReLUs harmed performance. The implicit distribution is set to \(r=(0,I_{d_{z}})\).

**Computation Time.** For each run in the Concrete dataset with JIT compilation, PVI took \(37\) seconds, UVI took approximately \(1\) minute \(40\) seconds, SVI took \(30\) seconds, and SM took \(27\) seconds.

### NeurIPS Paper Checklist

1. **Claims** Question: Do the main claims made in the abstract and introduction accurately reflect the paper's contributions and scope? Answer: [Yes] Justification: We clearly define our paper scope and contributions at the end of the introduction with references to why they are accurate. Guidelines: * The answer NA means that the abstract and introduction do not include the claims made in the paper. * The abstract and/or introduction should clearly state the claims made, including the contributions made in the paper and important assumptions and limitations. A No or NA answer to this question will not be perceived well by the reviewers. * The claims made should match theoretical and experimental results, and reflect how much the results can be expected to generalize to other settings. * It is fine to include aspirational goals as motivation as long as it is clear that these goals are not attained by the paper.
2. **Limitations** Question: Does the paper discuss the limitations of the work performed by the authors? Answer: [Yes] Justification: We highlight the limitations in Section 6. Guidelines: * The answer NA means that the paper has no limitation while the answer No means that the paper has limitations, but those are not discussed in the paper. * The authors are encouraged to create a separate "Limitations" section in their paper. * The paper should point out any strong assumptions and how robust the results are to violations of these assumptions (e.g., independence assumptions, noiseless settings, model well-specification, asymptotic approximations only holding locally). The authors should reflect on how these assumptions might be violated in practice and what the implications would be. * The authors should reflect on the scope of the claims made, e.g., if the approach was only tested on a few datasets or with a few runs. In general, empirical results often depend on implicit assumptions, which should be articulated. * The authors should reflect on the factors that influence the performance of the approach. For example, a facial recognition algorithm may perform poorly when image resolution is low or images are taken in low lighting. Or a speech-to-text system might not be used reliably to provide closed captions for online lectures because it fails to handle technical jargon. * The authors should discuss the computational efficiency of the proposed algorithms and how they scale with dataset size. * If applicable, the authors should discuss possible limitations of their approach to address problems of privacy and fairness. * While the authors might fear that complete honesty about limitations might be used by reviewers as grounds for rejection, a worse outcome might be that reviewers discover limitations that aren't acknowledged in the paper. The authors should use their best judgment and recognize that individual actions in favor of transparency play an important role in developing norms that preserve the integrity of the community. Reviewers will be specifically instructed to not penalize honesty concerning limitations.
3. **Theory Assumptions and Proofs** Question: For each theoretical result, does the paper provide the full set of assumptions and a complete (and correct) proof? Answer: [Yes]Justification: For each result, we outline relevant assumptions which can be found in the appendix. Guidelines: * The answer NA means that the paper does not include theoretical results. * All the theorems, formulas, and proofs in the paper should be numbered and cross-referenced. * All assumptions should be clearly stated or referenced in the statement of any theorems. * The proofs can either appear in the main paper or the supplemental material, but if they appear in the supplemental material, the authors are encouraged to provide a short proof sketch to provide intuition. * Inversely, any informal proof provided in the core of the paper should be complemented by formal proofs provided in appendix or supplemental material. * Theorems and Lemmas that the proof relies upon should be properly referenced.
4. **Experimental Result Reproducibility** Question: Does the paper fully disclose all the information needed to reproduce the main experimental results of the paper to the extent that it affects the main claims and/or conclusions of the paper (regardless of whether the code and data are provided or not)? Answer: [Yes] Justification: These can be found in App. H. Guidelines: * The answer NA means that the paper does not include experiments. * If the paper includes experiments, a No answer to this question will not be perceived well by the reviewers: Making the paper reproducible is important, regardless of whether the code and data are provided or not. * If the contribution is a dataset and/or model, the authors should describe the steps taken to make their results reproducible or verifiable. * Depending on the contribution, reproducibility can be accomplished in various ways. For example, if the contribution is a novel architecture, describing the architecture fully might suffice, or if the contribution is a specific model and empirical evaluation, it may be necessary to either make it possible for others to replicate the model with the same dataset, or provide access to the model. In general. releasing code and data is often one good way to accomplish this, but reproducibility can also be provided via detailed instructions for how to replicate the results, access to a hosted model (e.g., in the case of a large language model), releasing of a model checkpoint, or other means that are appropriate to the research performed. * While NeurIPS does not require releasing code, the conference does require all submissions to provide some reasonable avenue for reproducibility, which may depend on the nature of the contribution. For example 1. If the contribution is primarily a new algorithm, the paper should make it clear how to reproduce that algorithm. 2. If the contribution is primarily a new model architecture, the paper should describe the architecture clearly and fully. 3. If the contribution is a new model (e.g., a large language model), then there should either be a way to access this model for reproducing the results or a way to reproduce the model (e.g., with an open-source dataset or instructions for how to construct the dataset). 4. We recognize that reproducibility may be tricky in some cases, in which case authors are welcome to describe the particular way they provide for reproducibility. In the case of closed-source models, it may be that access to the model is limited in some way (e.g., to registered users), but it should be possible for other researchers to have some path to reproducing or verifying the results.
5. **Open access to data and code** Question: Does the paper provide open access to the data and code, with sufficient instructions to faithfully reproduce the main experimental results, as described in supplemental material?Answer: [Yes] Justification: We provide code for reproducibility. Guidelines:

* The answer NA means that paper does not include experiments requiring code.
* Please see the NeurIPS code and data submission guidelines (https://nips.cc/public/guides/CodeSubmissionPolicy) for more details.
* While we encourage the release of code and data, we understand that this might not be possible, so "No" is an acceptable answer. Papers cannot be rejected simply for not including code, unless this is central to the contribution (e.g., for a new open-source benchmark).
* The instructions should contain the exact command and environment needed to run to reproduce the results. See the NeurIPS code and data submission guidelines (https://nips.cc/public/guides/CodeSubmissionPolicy) for more details.
* The authors should provide instructions on data access and preparation, including how to access the raw data, preprocessed data, intermediate data, and generated data, etc.
* The authors should provide scripts to reproduce all experimental results for the new proposed method and baselines. If only a subset of experiments are reproducible, they should state which ones are omitted from the script and why.
* At submission time, to preserve anonymity, the authors should release anonymized versions (if applicable).
* Providing as much information as possible in supplemental material (appended to the paper) is recommended, but including URLs to data and code is permitted.
6. **Experimental Setting/Details** Question: Does the paper specify all the training and test details (e.g., data splits, hyperparameters, how they were chosen, type of optimizer, etc.) necessary to understand the results? Answer: [Yes] Justification: These can be found in App. H and explanations can be found in Section 5. Guidelines: * The answer NA means that the paper does not include experiments. * The experimental setting should be presented in the core of the paper to a level of detail that is necessary to appreciate the results and make sense of them. * The full details can be provided either with the code, in appendix, or as supplemental material.
7. **Experiment Statistical Significance** Question: Does the paper report error bars suitably and correctly defined or other appropriate information about the statistical significance of the experiments? Answer: [Yes] Justification: In our results, we report the mean and standard deviations from independent trials which can be found in Tables 1 and 2. Guidelines: * The answer NA means that the paper does not include experiments. * The authors should answer "Yes" if the results are accompanied by error bars, confidence intervals, or statistical significance tests, at least for the experiments that support the main claims of the paper. * The factors of variability that the error bars are capturing should be clearly stated (for example, train/test split, initialization, random drawing of some parameter, or overall run with given experimental conditions). * The method for calculating the error bars should be explained (closed form formula, call to a library function, bootstrap, etc.) * The assumptions made should be given (e.g., Normally distributed errors).

* It should be clear whether the error bar is the standard deviation or the standard error of the mean.
* It is OK to report 1-sigma error bars, but one should state it. The authors should preferably report a 2-sigma error bar than state that they have a 96% CI, if the hypothesis of Normality of errors is not verified.
* For asymmetric distributions, the authors should be careful not to show in tables or figures symmetric error bars that would yield results that are out of range (e.g. negative error rates).
* If error bars are reported in tables or plots, The authors should explain in the text how they were calculated and reference the corresponding figures or tables in the text.
8. **Experiments Compute Resources** Question: For each experiment, does the paper provide sufficient information on the computer resources (type of compute workers, memory, time of execution) needed to reproduce the experiments? Answer: [Yes] Justification: We outline the computational resource in App. H. Guidelines: * The answer NA means that the paper does not include experiments. * The paper should indicate the type of compute workers CPU or GPU, internal cluster, or cloud provider, including relevant memory and storage. * The paper should provide the amount of compute required for each of the individual experimental runs as well as estimate the total compute. * The paper should disclose whether the full research project required more compute than the experiments reported in the paper (e.g., preliminary or failed experiments that didn't make it into the paper).
9. **Code Of Ethics** Question: Does the research conducted in the paper conform, in every respect, with the NeurIPS Code of Ethics https://neurips.cc/public/EthicsGuidelines? Answer: [Yes] Justification: We conform. Guidelines: * The answer NA means that the authors have not reviewed the NeurIPS Code of Ethics. * If the authors answer No, they should explain the special circumstances that require a deviation from the Code of Ethics. * The authors should make sure to preserve anonymity (e.g., if there is a special consideration due to laws or regulations in their jurisdiction).
10. **Broader Impacts** Question: Does the paper discuss both potential positive societal impacts and negative societal impacts of the work performed? Answer: [NA] Justification: This paper presents work whose goal is to advance the field of Machine Learning. There are many potential societal consequences of our work, none which we feel must be specifically highlighted here. Guidelines: * The answer NA means that there is no societal impact of the work performed. * If the authors answer NA or No, they should explain why their work has no societal impact or why the paper does not address societal impact. * Examples of negative societal impacts include potential malicious or unintended uses (e.g., disinformation, generating fake profiles, surveillance), fairness considerations (e.g., deployment of technologies that could make decisions that unfairly impact specific groups), privacy considerations, and security considerations.

* The conference expects that many papers will be foundational research and not tied to particular applications, let alone deployments. However, if there is a direct path to any negative applications, the authors should point it out. For example, it is legitimate to point out that an improvement in the quality of generative models could be used to generate deepfakes for disinformation. On the other hand, it is not needed to point out that a generic algorithm for optimizing neural networks could enable people to train models that generate Deepfakes faster.
* The authors should consider possible harms that could arise when the technology is being used as intended and functioning correctly, harms that could arise when the technology is being used as intended but gives incorrect results, and harms following from (intentional or unintentional) misuse of the technology.
* If there are negative societal impacts, the authors could also discuss possible mitigation strategies (e.g., gated release of models, providing defenses in addition to attacks, mechanisms for monitoring misuse, mechanisms to monitor how a system learns from feedback over time, improving the efficiency and accessibility of ML).
11. **Safeguards** Question: Does the paper describe safeguards that have been put in place for responsible release of data or models that have a high risk for misuse (e.g., pretrained language models, image generators, or scraped datasets)? Answer: [NA] Justification: We do not release data or models that have a high risk of misuse. Guidelines: * The answer NA means that the paper poses no such risks. * Released models that have a high risk for misuse or dual-use should be released with necessary safeguards to allow for controlled use of the model, for example by requiring that users adhere to usage guidelines or restrictions to access the model or implementing safety filters. * Datasets that have been scraped from the Internet could pose safety risks. The authors should describe how they avoided releasing unsafe images. * We recognize that providing effective safeguards is challenging, and many papers do not require this, but we encourage authors to take this into account and make a best faith effort.
12. **Licensees for existing assets** Question: Are the creators or original owners of assets (e.g., code, data, models), used in the paper, properly credited and are the license and terms of use explicitly mentioned and properly respected? Answer: [Yes] Justification: Yes, we reference the dataset used. Guidelines: * The answer NA means that the paper does not use existing assets. * The authors should cite the original paper that produced the code package or dataset. * The authors should state which version of the asset is used and, if possible, include a URL. * The name of the license (e.g., CC-BY 4.0) should be included for each asset. * For scraped data from a particular source (e.g., website), the copyright and terms of service of that source should be provided. * If assets are released, the license, copyright information, and terms of use in the package should be provided. For popular datasets, paperswithcode.com/datasets has curated licenses for some datasets. Their licensing guide can help determine the license of a dataset. * For existing datasets that are re-packaged, both the original license and the license of the derived asset (if it has changed) should be provided.

* If this information is not available online, the authors are encouraged to reach out to the asset's creators.
* **New Assets*
* Question: Are new assets introduced in the paper well documented and is the documentation provided alongside the assets? Answer: [NA] Justification: We do not release new assets. Guidelines:
* The answer NA means that the paper does not release new assets.
* Researchers should communicate the details of the dataset/code/model as part of their submissions via structured templates. This includes details about training, license, limitations, etc.
* The paper should discuss whether and how consent was obtained from people whose asset is used.
* At submission time, remember to anonymize your assets (if applicable). You can either create an anonymized URL or include an anonymized zip file.
* **Crowdsourcing and Research with Human Subjects*
* Question: For crowdsourcing experiments and research with human subjects, does the paper include the full text of instructions given to participants and screenshots, if applicable, as well as details about compensation (if any)? Answer: [NA] Justification: No human subjects were used. Guidelines:
* The answer NA means that the paper does not involve crowdsourcing nor research with human subjects.
* Including this information in the supplemental material is fine, but if the main contribution of the paper involves human subjects, then as much detail as possible should be included in the main paper.
* According to the NeurIPS Code of Ethics, workers involved in data collection, curation, or other labor should be paid at least the minimum wage in the country of the data collector.
* **Institutional Review Board (IRB) Approvals or Equivalent for Research with Human Subjects*
* Question: Does the paper describe potential risks incurred by study participants, whether such risks were disclosed to the subjects, and whether Institutional Review Board (IRB) approvals (or an equivalent approval/review based on the requirements of your country or institution) were obtained? Answer: [NA] Justification: We did not have human participants. Guidelines:
* The answer NA means that the paper does not involve crowdsourcing nor research with human subjects.
* Depending on the country in which research is conducted, IRB approval (or equivalent) may be required for any human subjects research. If you obtained IRB approval, you should clearly state this in the paper.
* We recognize that the procedures for this may vary significantly between institutions and locations, and we expect authors to adhere to the NeurIPS Code of Ethics and the guidelines for their institution.
* For initial submissions, do not include any information that would break anonymity (if applicable), such as the institution conducting the review.