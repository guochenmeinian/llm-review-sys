# Equivariant Blurring Diffusion

for Hierarchical Molecular Conformer Generation

 Jiwoong Park, Yang Shen

Department of Electrical and Computer Engineering

Texas A&M University

ptywoong@gmail.com, yshen@tamu.edu

###### Abstract

How can diffusion models process 3D geometries in a coarse-to-fine manner, akin to our multiscale view of the world? In this paper, we address the question by focusing on a fundamental biochemical problem of generating 3D molecular conformers conditioned on molecular graphs in a multiscale manner. Our approach consists of two hierarchical stages: i) generation of coarse-grained fragment-level 3D structure from the molecular graph, and ii) generation of fine atomic details from the coarse-grained approximated structure while allowing the latter to be adjusted simultaneously. For the challenging second stage, which demands preserving coarse-grained information while ensuring SE(3) equivariance, we introduce a novel generative model termed _Equivariant Blurring Diffusion_ (EBD), which defines a forward process that moves towards the fragment-level coarse-grained structure by blurring the fine atomic details of conformers, and a reverse process that performs the opposite operation using equivariant networks. We demonstrate the effectiveness of EBD by geometric and chemical comparison to state-of-the-art denoising diffusion models on a benchmark of drug-like molecules. Ablation studies draw insights on the design of EBD by thoroughly analyzing its architecture, which includes the design of the loss function and the data corruption process. Codes are released at https://github.com/Shen-Lab/EBD.

## 1 Introduction

The advancement of generative models to understand the multiscale properties of objects facilitates their application across a range of granularity levels, transcending individual scales. To enable generative models in processing multiscale structures, there has been a surge in hierarchical design methodologies across multiple domains, spanning from images  to speech . These methods initially capture coarse-grained structures and subsequently generate finer details.

In the field of computer vision, recent efforts  have yielded successful designs of coarse-to-fine generative frameworks for 2D pixels of images, leveraging denoising diffusion models that corrupt and restore the data by adding and removing noises . Notably,  generates images from blurred prior distributions (average of pixel intensities) motivated from the heat equation of partial differential equations as Fig. 1.

Figure 1: Blurring diffusion generative processes on image  and molecular conformer.

In the field of biochemistry and drug discovery, however, denoising diffusion models for 3D conformers of stable molecular structures have not yet taken advantage of coarse-to-fine multiscale frameworks. Current methods either disregard the scale hierarchy [46; 59; 19; 23; 60] or consider that in very limited ways [38; 41]. For instance, within the recent hierarchical method of unconditional conformer generation , a denoising diffusion model  is solely applied to generation of coarse-grained structure, without extending to coarse-to-fine generation.

The primary bottleneck in extending denoising diffusion models for molecular conformers to hierarchical designs is that random noise corrupts not only fine atomic details but also structural information of coarse-grained structures indiscriminately. To tackle this challenging problem, we exploit _fragments_ that are frequently occurring substructures or functional groups in 2D molecular graphs. These fragments can be a promising candidate for the coarse-grained structural information in 3D geometry. Introducing fragments divides the generation process into two stages: i) generating coarse-grained structures represented by fragments, and ii) restoring fine atomic details from fragment structures. In the first stage of generating fragment coordinates from molecular graphs, we efficiently generate approximations of fragment structures comprising the center of mass and attributes of each fragment from a cheminformatics tool.

For the challenging second step of coarse-to-fine generation, we propose a novel diffusion model, _Equivariant Blurring Diffusion_ (EBD) detailed as follows. Motivated from the blurring corruption of the heat equation , we design EBD to generate 3D molecular conformers from coarse-grained fragment approximated structures as Fig. 1, rather than from random noise. In our design of EBD, the forward process moves atom positions of conformers towards the center of mass of their respective fragments, while the reverse process restores full-atom details from the prior distribution of the 3D fragment structure. The blurring schedule we designed for EBD allows the diffusion model to focus on restoring fine atomic details while retaining coarse-grained information throughout the entire generative process. We validated our coarse-to-fine EBD model using a benchmark of drug-like molecules. We obtained superior results in conformer generation compared to the denoising diffusion model, even with 100 times fewer diffusion time steps.

The major contribution of this paper can be summarized as follows:

* We design EBD which generates atomic details from coarse-grained estimation of fragment structures using equivariant networks, motivated by the blurring corruption of heat equation.
* We propose a novel blurring scheduler and a revised loss function that significantly impacts performance, instead of directly applying those of existing image blurring diffusion model.
* We conduct a thorough analysis of the effects of fragment granularity, data corruption methods, and loss reformulation. We obtained geometrically and chemically more plausible conformers compared to state-of-the-art denoising diffusion models.

## 2 Background

### Blurring diffusion

The denoising diffusion models [49; 50; 52; 15; 27], which corrupt data by adding random noise and generate data through denoising, have significantly advanced across diverse domains [55; 54; 44]. Recently, a few works [2; 42; 7; 18] have introduced data corruption into the design space of diffusion models , going beyond random noise corruption in the vision domain.

Inverse Heat Dissipation Model (IHDM)  proposed a coarse-to-fine generation in the pixel space. Their forward process follows a partial differential equation of heat dissipation on grids:

\[(i,j,t)=(i,j,t),\] (1)

where \(\) represents the data on the grid and \(\) is the Laplacian operator. IHDM derived the solution of this equation at time step \(t\), \(_{t}\), using eigendecomposition of \(\) as:

\[_{t}=_{t}_{0}=(-t )^{T}_{0},\] (2)

where \(^{T}\) and \(\) are discrete cosine transform and a diagonal matrix whose elements are eigenvalues of \(\), respectively. As \(t T\), the eigenbasis of eigenvalue \(0\) only remains and this leads to the convergence of pixel intensities to their average value. Based upon this blurring process, IHDM defined a forward process as:

\[q(_{t}|_{0})=(_{t}|_{t} _{0},^{2}),\] (3)

which means that the state at \(t\) is equal to the data blurred until \(t\) with small amount of noise. Note that the function of data corruption \(_{t}\) was defined at a spectral space of eigenvalues \(\). Then, the reverse generative process was defined to deblur each state:

\[p_{}(_{t-1}|_{t})=(_{t-1}| _{}(_{t},t),^{2}),\] (4)

where the mean at \(t-1\) is the result of a deblurring network \(_{}\) and \(\) is the small amount of standard deviation for noise. As \(t\) approaches \(0\), \(_{}\) gradually restores fine details from coarse-grained information about pixel intensities by effectively deblurring state values. The loss was defined to minimize the distance between the result of deblurring network and less blurred state at randomly sampled \(t\) as:

\[L_{t-1}=_{t,_{0},_{t}}[\|_{t-1} _{0}-_{}(_{t},t)\|^{2}].\] (5)

IHDM was evaluated on image generation task using FID score , but its performance lagged behind that of denoising diffusion models. For instance, IHDM achieves an FID score of \(18.96\) while DDPM  have \(3.17\) on CIFAR-10 .

### Equivariance

In this work, we consider the SE(3) group to address the roto-translational equivariance of molecular conformers [28; 19; 59]. A function \(f\) is equivariant to a group \(\) if \(T_{g}(f())=f(S_{g}())\) holds for all \(g\), where \(T_{g},S_{g}\) are transformations of the group element \(g\). In our coarse-to-fine generative framework, the invariant prior distribution of coarse-grained structure represents the coordinates of fragments. Therefore, the design of the transition distribution and the loss function in our diffusion model need to ensure that the generated likelihood is invariant, so that the generated conformers are not affected by rotation or translation.

## 3 Methods

### Problem definition

Suppose that we have a molecular graph \(G\) whose nodes \(\) are \(n\) atoms with SE(3)-invariant features \(^{}^{n d}\) and edges \(\) are inter-atomic bonds. Our objective is to generate an ensemble of 3D molecular conformers \(^{}^{n 3}\) given \(G\). Our hierarchical approach is in two stages. i) \(p(^{}|G)\): generating a coarse-grained 3D structure of fragment coordinates \(^{}^{m 3}\) from \(G\) which was decomposed into \(m\) fragments, and ii) \(p(^{}|^{},G)\): the diffusion model generating fine atomic details \(^{}^{n 3}\) conditioned on the generated fragment structure \(^{}\). To map between atoms and their respective fragments, we defined a mapping matrix \(^{n m}\) with \(_{}=1\) if the \(i\)-th atom belongs to the \(k\)-th fragment and \(0\) otherwise. \(^{}\) makes each atom located at its respective fragment. On the other hand, \(^{}^{}\) results in fragment coordinates being the average of the coordinates of its constituent atoms, where \(^{}\) is a pseudoinverse matrix of \(\) (\(^{}=\)).

### Fragmentation and 3D fragment structures

We decompose a molecule \(G=(,)\) into \(m\) non-overlapping fragments \(\{S_{k}\}_{k=1}^{m}\), where \(S_{k}=(_{k},_{k})\) and \(=_{k=1}^{m}_{k},=_{k=1}^{m} _{k}\) using Principal Subgraph (PS) . Starting from all unique atoms in the fragment vocabulary \(\), PS iteratively merges neighboring fragments. The most frequent fragment among the newly merged fragments was added to the vocabulary at each iteration, which was repeated until the desired size of the vocabulary was reached. The smaller the size of fragment vocabulary, the finer fragments and detailed coarse-grained structures can be obtained. After fragmentation was finished, from the relation between \(\{_{k}\}_{k=1}^{m}\) and \(\), the mapping matrix \(\) can be constructed.

To generate the initial coordinates of fragments, we utilize RDKit distance geometry [5; 31], an efficient cheminformatics tool, instead of training an additional deep generative model. After generating initial atom coordinates \(}^{} p_{}(^{})\), we define the initial fragment coordinates \(^{}\) as averages of their constituent atom coordinates, \(^{}}^{}\). Since the atom coordinates generated by RDKit are approximations of the ground truth conformer, the resulting fragment coordinates are also an approximation (thus need to be adjusted in the next stage in Sec. 3.3), which we denote as \(}^{} p_{}(^{})\). For fragment features \(^{}^{m 3}\), we define a \(3\)-dimensional vector as a frequency histogram of its constituent atom types based on their chemical properties, including hydrophobicity, hydrogen bond center, and negative charge center following .

The processes of fragment structure generation are illustrated in the step 1 of Fig. 2. Note that every step in this subsection does not harm the efficiency of our framework, as they can be completed before training our diffusion model and the process itself is efficient. To generate \(5\) distinct fragment coordinates \(}^{}\) for each of the \(45,000\) molecules in the training and validation set of the GEOM-Drug benchmark , it took \(38\) hours, averaging \(3.04\) seconds per molecule. The details of fragmentation and fragment vocabulary are demonstrated in Appendix C.1.

### Equivariant blurring diffusion

In this subsection, we elaborate on the design of our diffusion model, _Equivariant Blurring Diffusion_ (EBD), drawing inspiration from the principles of the heat equation. This model is designed to generate fine details of conformers \(^{}\), starting from a coarse-grained, approximate structure \(}^{}\) and a molecular graph \(G\). We introduce a forward process and a data corruption function of blurring process in Sec. 3.3.1, a reverse process and a deblurring network to reach an SE(3)-invariant likelihood in Sec. 3.3.2, and a definition and reparameterization of an SE(3)-invariant loss function in Sec. 3.3.3. The overall scheme of EBD is illustrated in the step 2 of Fig. 2.

#### 3.3.1 Forward process and blurring schedule

We define the data corruption of the forward process as a blurring operation that gradually shifts ground truth atom positions \(^{}_{0} q(^{}_{0})\) to their corresponding fragment coordinates:

\[q(^{}_{t}|^{}_{0},}^{ })=(^{}_{t}|f_{}(^{}_{0},}^{},t),^{2}),\] (6)

where \(f_{}\) is a deterministic blurring operator. Consequently, every atom will be positioned according to its fragment coordinates \(}^{}\) in the prior fragment structure distribution.

When defining \(f_{}\) for the forward process, we cannot directly adopt the spectral blurring operator \(_{t}=(-t)^{T}\) of IHMM  in Eq. (2) for the two reasons: i) For a single molecule, we need to calculate and decompose the fragment graph Laplacian \(\{_{k}_{k}_{k}^{T}\}_{k=1}^{m}\) for each fragment \(S_{k}=(_{k},_{k})\), unlike a single Laplacian operator per image in IHDM. Given the varying sizes and structures across fragments, it becomes challenging to uniformly adjust the movement of atoms across all fragments using a function of \(\{_{k}\}_{k=1}^{m}\) in spectral space. ii) As \(t T\), the ground truth atom coordinates \(^{}_{0}\) will converge to the ground truth scaffold structure \(^{}=_{T}^{}_{0}\) by spectral

Figure 2: Our hierarchical molecular conformer generation framework. We first decompose a molecular graph \(G\) into fragments and generate fragment coordinates \(}^{f}\). Then, conditioned on \(}^{f}\) and \(G\), Equivariant Blurring Diffusion generates atom-level fine details using the blurring schedule.

graph theory . However, there exists a mismatch between the ground truth coordinates \(^{}\) and the approximation coordinates \(}^{}\) from RDKit in the generative processes. This distributional shift of the fragment structure can potentially harm the performance during the inference.

To circumvent these issues, we transition the space of the blurring operator from spectral domain to spatial domain while retaining the essence of the blurring process. We define \(f_{}\) as a linear interpolation between \(}^{}\) and \(_{0}^{}\) in Euclidean space:

\[f_{}(_{0}^{},}^{},t)=( 1-)_{0}^{}+} ^{}.\] (7)

As \(t\) progresses from \(0\) to \(T\), the atom coordinates \(_{t}^{}\) will gradually converge to the fragment structure \(}^{}\), allowing for uniform adjustment of atom movement. Additionally, we can mitigate the need for excessive eigendecomposition of the fragment graph Laplacian. The example of our blurring schedule on a single fragment is depicted in the step 2 of Fig. 2.

#### 3.3.2 Reverse process and deblurring networks

The aim of the reverse process is to generate fine details at the atom-level from a prior distribution of 3D fragment structure \(p(_{T}^{})=(_{T}^{}| }^{},^{2})\) that is roto-translational invariant to the group. Drawing upon proofs regarding the conditions for an invariant likelihood , we develop the deblurring process on the zero center-of-mass subspace using equivariant transition distributions:

\[p_{}(_{t-1}^{}|_{t}^{},}^{},G)=(_{t-1}^{}|_{ }(_{t}^{},}^{},G,t), ^{2}),\] (8)

where \(_{}\) is a parameterized mean function consisting of a deblurring network. To ensure equivariance in the transition distribution, we devise \(_{}\) inspired by equivariant networks . Our equivariant deblurring network updates invariant features of fragments and atoms \(^{},^{}\), (Eqs. (9, 10)), and the equivariant coordinates of atoms \(^{}\) (Eq. (11)) by leveraging the hierarchical relationship between atoms and fragments. Let the \(i\)-th atom \(_{i}^{}\) belongs to the \(k\)-th fragment \(_{k}^{}\), then the \(l\)-th layer of equivariant deblurring networks for fragment- and atom-level message passing and feature updates is defined as follows:

\[_{_{}}^{} =_{m}^{}(_{}^{,l}, _{}^{,l},\|_{}^{ }-_{}^{}\|), _{}^{,l+1} =_{h}^{}(_{}^{,l}, _{ N(_{1}^{})}_{ _{}}^{},^{,l}),\] (9) \[_{_{}}^{} =_{m}^{,l}(_{}^{,l}, _{}^{,l},\|_{}^{,l}-_{}^{}\|,e_{_{}}^{ }), _{}^{,l+1} =_{h}^{}(_{}^{,l}, _{ N(_{1}^{})}_{ _{}}^{},_{}^{,l+1}),\] (10) \[_{}^{,l+1} =_{}^{,l}+_{ N (_{1}^{})}_{}^{,l}- _{}^{,l}}{d_{_{}}^{,l}+1}_{x}^{}(_{}^{,l+1}, _{}^{,l+1},_{_{}} ^{,e_{_{}}^{})}\] (11) \[+_{}^{,l}-_{k}^{}}{\|_{}^{,l}-_{k}^{}\|+1} _{x}^{}(_{}^{,l+1},_{ }^{,l+1},\|_{}^{,l}-_{k}^{}\|),\]

where \(_{k}^{}\) is the \(k\)-th row of \(^{}_{k}^{}\), \(\) are multilayer perceptrons, \(e_{_{}}^{}\) are inter-atomic bond types, and \(d_{_{}}^{,l}=\|_{}^{,l}-_{}^{,l}\|\) are inter-atomic distances. We consider a complete graph for fragment-level interactions and expand the edge set by incorporating multi-hop and radius neighbors for atom-level interactions. The details of the deblurring networks are provided in the Appendix A.

#### 3.3.3 Training

Following Eq. (5) of IHDM , our loss of previous deblurred state estimation can be defined as:

\[L_{t-1}=_{t,_{0}^{},_{1}^{}, }^{}}[\|f_{}(_{0}^{}, }^{},t-1)-_{}(_{t}^{ },}^{},G,t))\|^{2}],\] (12)

where \(\) is the Kabsch algorithm  to obtain the optimal rotation matrix for alignment. Through alignment \(\) between the prediction from \(_{}\) and less blurred state \(f_{}(_{0}^{},}^{},t-1)\) after translating both terms to the zero center-of-mass subspace, the loss function becomes invariant to the SE(3)-transformation of the prediction.

However, we empirically observed that this previous state estimator generates unsatisfactory conformers, similar to the unsatisfactory FID scores observed in image generation of IHDM . We conjectured the reason as the model limited to learn the locally small steps towards the ground truth distribution at each time step . Thus, we reparameterize \(_{}(_{}^{},}^{},G,t)\) as \((1-)f_{}(_{t}^{},G,t)+}^{}\) to make the deblurring network estimates the ground truth state \(_{0}^{}\) instead of the previous less blurred state via neural networks \(f_{}\):

\[L_{t-1} =_{t,_{0}^{},_{t}^{ },^{}}[\|f_{}(_{0}^{ },}^{},t-1)-(1-)f_{ }(_{t}^{},G,t)+}^{})\|^{2}]\] (13) \[_{t,_{0}^{},_{1}^ {},^{}}[\|_{0}^{}- f_{}(_{t}^{},G,t)\|^{2}].\] (14)

The derivation of the new loss is detailed in Appendix B. By loss reparameterization, \(\) aligns the prediction to the ground truth state. At time step \(t\) of the sampling process, after estimating ground truth \(}_{0}^{}\) from \(_{t}^{}\), the next state \(_{t-1}^{}\) is computed from a deterministic blurring function \(f_{}\) using \(}_{0}^{}\). The training and sampling processes are provided in Algorithms 1, 2.

```  Sample \(}^{} p_{}(^{})\) \(_{T}^{}}^{}\) for\(t\) in \(\{T,,1\}\)do  Sample \((,^{2})\) \(}_{0}^{} f_{}(_{t}^{ }+,}^{},G,t)\) \(_{t-1}^{} f_{}(}_{0}^ {},}^{},t-1)\) endfor ```

**Algorithm 2** Generation

## 4 Related work

**Hierarchical generation.** A hierarchical design of generative models is evident across multiple domains, including image generation [35; 40; 16; 42] and speech synthesis [20; 17], aimed at enhancing the interpretability and quality of samples derived from coarse-grained information. In the field of computational biology, recent studies on molecular graph generation [21; 22; 12], backmapping of protein structure  and conformer generation  conditioned on the given ground truth coarse-grained information have reported the effectiveness of the hierarchical design. In recent unconditional conformer generation , a denoising diffusion model  was exclusively used in the fragment structure generation step and not designed for coarse-to-fine generation.

**Data corruption in diffusion models.** The choice of data corruption can be considered a crucial aspect of the design space of diffusion models , depending on the characteristics of the data domain and the specific problem definition. Recently, several studies on diffusion models have revealed that the choice of data corruption can be extended beyond random noise [49; 15; 50; 36; 43] to methods such as masking [2; 7; 8], blurring [42; 2; 7; 18], and varying data dimension . We designed the data corruption process as a blurring operation in Euclidean space, transitioning from atom-level fine details to fragment-level coarse structures. This approach is more effective for multi-scale frameworks compared to random noise, which corrupts both fragment and atom geometries.

## 5 Experiments

In this section, we evaluate our hierarchical molecular conformer generation framework via Equivariant Blurring Diffusion (EBD) on molecular conformer generation task. We conducted experiments to answer the following questions: i) **Ablation studies** (Sec. 5.2): What are the effects of granularity of the fragment vocabulary, loss reparameterization, and data corruption processes of diffusion models? ii) **Geometric evaluation** (Sec. 5.3): Can EBD generate more diverse and accurate molecular conformers in Euclidean space than previous deep generative approaches? iii) **Property prediction** (Sec. 5.4): Can EBD generate low-energy, stable conformers?

### Experiment setup

**Dataset.** We use GEOM-QM9 (QM9)  and GEOM-Drugs (Drugs)  which are small molecules and drug-like molecules, respectively. Each dataset comprises 40,000 molecules for the training set and 5,000 molecules for the validation set, with each molecule containing 5 conformers following data split of . For the test set, we selected 200 molecules for each dataset, resulting in 22,408 and 14,324 conformers existing in QM9 and Drugs, respectively. The details of dataset were demonstrated in Appendix C.1.

**Metrics.** To measure the accuracy and diversity of the generated conformer set \(\), we adopted metrics proposed by . The metrics are based on root-mean-square deviation (RMSD), which is a normalized Frobenius norm between two atomic coordinate matrices aligned using the Kabsch algorithm . Given the ground truth conformer set \(^{*}\) and the generated sample set \(\), four metrics that follow precision and recall are defined as:

\[() =^{*}|}|\{C^{*}^{*}|(C^{*},C),C\}|,\] (15) \[() =^{*}|}_{C^{*}}_{C^{ *}}(C^{*},C),\] (16)

where COV and MAT are coverage metric and matching metric , respectively. COV quantifies the proportion of one set covered by another, with "covered" indicating RMSD values are within a threshold \(\). MAT measures the average of RMSD values of one conformer set with its closest conformer in another set. If \(\) and \(^{*}\) are exchanged in Eqs. (15, 16), then metrics become COV-P (Precision) and MAT-P (Precision). The recall metric is focused on the diversity, while the precision metric measures the quality. The threshold \(\) is set to \(0.5\)A for QM9 and \(1.25\)A for Drugs. For each molecule, we generated conformers \(C\) that are twice the size of the ground truth conformers \(C^{*}\).

**Baselines.** We compare EBD to existing deep generative models for molecular conformer generation. The performance of RDKit  that was used to generate the fragment structure of our model was measured as a baseline. Besides RDKit, machine learning models including CVGAE , GraphDG , CGCF , ConfVAE , GeoMol , ConfGF , and GeoDiff  were compared to our model. Among these, GeoDiff is the denoising diffusion model restoring the target distribution from random noise in atom coordinates. We adhered to their settings by configuring the maximum time step \(T\) to 5,000. For EBD, we use the \(T=50\), a noise scale of \(0.01\) for the forward process (\(\) in Eq. 6) and \(0.0125\) for the reverse process (\(\) in Eq. 8) in every experiments. The implementation details were reported in Appendix C.2.

### Ablation studies

We conducted ablation studies to validate our model design, encompassing the size of the fragment vocabulary, the reparameterization of loss, and the blurring data corruption. For each ablation study, we calculated the mean and median of matching scores MAT-R and MAT-P on Drugs test set. Note that lower values of MAT-R and MAT-P indicate better results.

**Effects of fragment granularity.** We assessed the performance variation as fragment structure became more detailed and informative by measuring the generation performances across different fragment vocabulary sizes \(||\{50,200,1000\}\). Since PS , the fragmentation method we used, initializes the vocabulary from unique single atoms, reducing the size \(||\) results in obtaining finer fragments \(}^{f}\). We reported the statistics of the average number of fragments per graph (\(\#/G\)) and atoms per fragment (\(\#/\)) in Table 1 and the generation results in Fig. 3 (a).

   \(||\) & \(\#/G\) & \(\#/\) \\ 
50 & 11.77 & 4.02 \\
200 & 7.60 & 6.34 \\
1000 & 5.26 & 9.25 \\   

Table 1: Statistics of fragment vocabulary \(\) in Drugs.

Figure 3: Ablation studies on the motivation and design choice of EBD. (a) Fragment vocabulary granularity; (b) Target of state estimator; (c) Choice of data corruption processes.

Thanks to the increased level of detail in fragments, \(||=50\) can obtain better performance compared to other vocabulary sizes. This is because more specific fragment structures decrease the amount of atomic-level detail that needs to be generated. From this observation, we use \(||=50\) in all subsequent experiments. We also conducted fine-to-fine generation to observe the ability of EBD. We measured the performance when the prior is \(}^{} p_{}(^{})\). Table 2 presents coarse-to-fine (C2F) result when \(||=50\) and fine-to-fine (F2F) result. As expected, F2F shows more accurate results compared to C2F as it includes more detail in the prior distribution.

**Effects of loss reparameterization.** We presented the performance comparison between the less blurred previous state estimator in Eq. (12) and ground truth estimator in Eq. (14) after loss reparameterization in Fig. 3 (b). From the previous state estimator, we acquired degenerated conformers with relatively high matching scores, which align with low FID score of IHDM  in image generation. On the other hand, we observed distinct advantages in introducing the ground truth estimator across all metrics. We speculate that the ground truth estimator facilitates the diffusion model in learning beyond locally blurring distributions towards the target distribution.

**Effects of data corruptions.** We provide the same initial fragment structures \(}^{}\) to both EBD and DecompDiff  so that the data corruption method becomes the primary distinction to examine. DecompDiff is a better candidate than GeoDiff  to compare for this purpose because, unlike GeoDiff that generates conformers from a single prior distribution, DecompDiff de-noises multiple prior distributions, where each mean corresponds to the coordinates of each fragment \(}^{}\). The generation results and sampling trajectories are compared between the two models (\(T=50\) for both) in Fig. 3 (c) and Fig. 4. At first, we observed that the conformers generated from DecompDiff exhibit lower diversity scores compared to EBD. This is because the results of DecompDiff tend to adhere closely to the approximate fragment structure \(}^{}\), whereas EBD attempts to transition towards the ground truth fragment structure \(^{}\). We speculate that our blurring schedule, which entails a linear interpolation between \(}^{}\) and \(^{}_{0}\), facilitates the learning process for the diffusion model compared to a stochastic trajectory between prior and target distributions. As empirical evidence, we observed that DecompDiff primarily focuses on denoising the fragment structure throughout most of the sampling process in Fig. 4. On the other hand, EBD focuses on the entirety of the sampling process to generate fine details, resulting in better quality.

We conducted further analysis to observe how accurately the fragment coordinates generated by RDKit were corrected toward the ground truth by EBD. For 200 molecules in Drugs test set, we measured \((^{}_{},^{}_{ })\) and \((^{}_{},^{}_{ })\). If \((^{}_{},^{}_{ })\) is lower than \((^{}_{},^{}_{ })\) for a molecule, then it indicates that the model has corrected the fragment coordinates. In Fig. 5, the points below the red line represent cases where the model corrected the coordinates accurately. We observed that the greater the \((^{}_{},^{}_{ })\) (points further to the right on the x-axis), the larger the reduction in \((^{}_{},^{}_{ })\). In other words, the lower the quality of the coarse-grained prior, the more accurately the model tends to make corrections.

    &  &  &  &  \\  & Mean & Med & Mean & Med & Mean & Med & Mean & Med \\  C2F & **92.60** & **98.73** & 0.5216 & 0.8279 & 66.24 & 68.39 & 11.237 & 1.0916 \\ F2F & 89.44 & **98.73** & **0.7586** & **0.7710** & **76.62** & **88.64** & **1.0099** & **0.9397** \\   

Table 2: Fine-to-fine generation on Drugs.

Figure 4: Sampling processes of two conformers depending on data corruptions.

Figure 5: Correction on fragment coordinates

Additional visualizations of sampling results on Drugs and QM9, as well as the sampling processes, are illustrated in the Appendix E.

### Geometric evaluation

We compared our hierarchical framework to the baseline RDKit and machine learning models for molecular conformer generation on Drugs, and the results are reported in Table 3. EBD achieves superior performance across all metrics by generating diverse and accurate molecular conformers. In comparison to RDKit, which was used to generate fragment structures \(}^{}\), EBD achieved a significant improvement in the generation of diverse fine atomic details, as evidenced by higher COV-R and MAT-R scores. We also observed that, due to the informative fragment structure prior distribution and the proposed blurring schedule, EBD produces more diverse and higher-quality conformers with statistical significance (see Appendix D), even with 100 times fewer \(T\) compared to GeoDiff. We also reported EBD's better performance on QM9 with statistical significance in Appendix D.

We take an additional step to delve into the rationale behind the ability of EBD to achieve better performance with smaller \(T\) by analyzing the spectral domain in Fig 6. Motivated from the analysis of , we calculated the power spectral density, \((_{t}^{})_{i}=_{c\{x,y,z\}}| _{}}^{T}_{t}^{,c}|^{2}\), where \(_{}}\) is the \(i\)-th smallest eigenvector of graph Laplacian \(\) of the molecular graph \(G\), and \(_{t}^{,c}\) is one of the \(\{x,y,z\}\) coordinate vectors of atomic coordinate matrix \(_{t}^{}\). The smaller eigenvalues correspond to coarser-grained structures, while higher eigenvalues correspond to finer details . Therefore, by measuring \((_{t}^{})_{}}\) during the forward processes \(\{_{t}^{}\}_{t=0}^{T}\) of EBD and GeoDiff, we can ascertain which structural components are corrupted during the forward process and will be restored during the reverse process, respectively. For EBD, there is less significant perturbation across lower frequency parts of the PSD that corresponds to the coarser-grained discrepancy between ground truth \(^{}\) and approximate \(}^{}\) fragment positions. Thus, EBD primarily focuses on restoring perturbed fine-grained structures in the higher frequency parts throughout the entire generative process. This explains why EBD does not require excessive \(T\). In contrast, GeoDiff requires relatively more \(T\) because random noise corrupts the overall structural information, and the amount of perturbations is also significant.

Figure 6: Power spectral density analysis on forward processes of GeoDiff and EBD. The darkest line is the PSD coefficient of \(_{0}^{}\) and the lines become lighter as \(t T\).

    &  & \)) \(\)} &  & \)) \(\)} \\ Models & Mean & Med & Mean & Med & Mean & Med & Mean & Med \\  RDKit & 45.74 & 31.75 & 1.5376 & 1.4004 & 54.78 & 59.48 & 1.3341 & 1.1996 \\ CVGAE & 0.00 & 0.00 & 3.0702 & 2.9937 & - & - & - & - \\ GraphDG & 8.27 & 0.00 & 1.9722 & 1.9845 & 2.08 & 0.00 & 2.4340 & 2.4100 \\ CGCF & 53.96 & 57.06 & 1.2487 & 1.2247 & 21.68 & 13.72 & 1.8571 & 1.8066 \\ ConfVAE & 55.20 & 59.43 & 1.2380 & 1.1417 & 22.96 & 14.05 & 1.8287 & 1.8159 \\ GeoMol & 67.16 & 71.71 & 1.0875 & 1.0586 & - & - & - & - \\ ConfGF & 62.15 & 70.93 & 1.1629 & 1.1596 & 23.42 & 15.52 & 1.7219 & 1.6863 \\ GeoDiff (\(T=5000\)) & 89.40 & 96.86 & 0.8571 & 0.8495 & 61.28 & 65.00 & 1.1642 & 1.1272 \\  EBD (\(T=50\)) & **92.60** & **98.73** & **0.8216** & **0.8279** & **66.24** & **68.39** & **1.1237** & **1.0916** \\   

Table 3: Geometric evaluation on Drugs (\(=1.25\)Å).

### Chemical evaluation

In addition to geometric evaluation, we assessed the quality of generated conformers by their chemical properties. After training EBD on QM9, following , we generated 50 samples for each of the 30 molecules, which constitute a subset of QM9. Using PSI4 , we calculated properties of each conformer including the energy \(\), the lowest energy \(E_{}\), HOMO-LUMO gap \(\), the average gap \(\), the minimum gap \(_{}\) and the maximum gap \(_{}\). Then, we measured the mean absolute errors between the properties of generated and ground truth (Table. 4). We observed that EBD can generate the most stable conformers compared to other methods, as evidenced by lower energy and HOMO-LUMO gap.

## 6 Conclusion

We introduced a novel hierarchical generative model for molecular conformers via Equivariant Blurring Diffusion (EBD), a diffusion model designed for coarse-to-fine generative scheme. After generating the initial distribution of fragment coordinates from a cheminformatics tool, EBD generated fine atomic details from coarse-grained structures through equivariant networks. We also proposed a simple and effective linear blurring scheduler and ground truth state estimator to enhance the model's ability to produce diverse and accurate conformers. Through extensive analysis of the proposed model and comparison between competitive denoising diffusion models, we substantiated the validity of the model design.

As a coarse-to-fine generative scheme, EBD can be extended for larger and more complex molecular structures, because hierarchical systems similar to those utilized in EBD exists widely across molecular systems (ranging from proteins as linear polymers of amino acids to materials as lattices of molecules). We discussed a few limitations of our model in the Appendix F.