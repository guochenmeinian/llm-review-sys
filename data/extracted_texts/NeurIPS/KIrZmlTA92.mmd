# Data-Driven Discovery of Dynamical Systems in Pharmacology using Large Language Models

Samuel Holt

University of Cambridge

sih31@cam.ac.uk

&Zhaozhi Qian

Elm UK

zqian@elm.sa

&Tennison Liu

University of Cambridge

tl522@cam.ac.uk

&James Weatherall

AstraZeneca

&Mihaela van der Schaar

University of Cambridge

mv472@cam.ac.uk

Equal Contribution.Work done as a Postdoc at the University of Cambridge.

###### Abstract

The discovery of dynamical systems is crucial across a range of fields, including pharmacology, epidemiology, and physical sciences. _Accurate_ and _interpretable_ modeling of these systems is essential for understanding complex temporal processes, optimizing interventions, and minimizing adverse effects. In pharmacology, for example, precise modeling of drug dynamics is vital to maximize therapeutic efficacy while minimizing patient harm, as in chemotherapy. However, current models, often developed by human experts, are limited by high cost, lack of scalability, and restriction to existing human knowledge. In this paper, we present the _Data-Driven Discovery (D3)_ framework, a novel approach leveraging Large Language Models (LLMs) to iteratively discover and refine interpretable models of dynamical systems, demonstrated here with pharmacological applications. Unlike traditional methods, D3 enables the LLM to propose, acquire, and integrate new features, validate, and compare dynamical systems models, uncovering new insights into pharmacokinetics. Experiments on a pharmacokinetic Warfarin dataset reveal that D3 identifies a new plausible model that is well-fitting, highlighting its potential for precision dosing in clinical applications.

## 1 Introduction

The discovery of dynamical systems models plays a fundamental role across various domains, including pharmacology, epidemiology, and physical systems. In pharmacology, pharmacokinetic (PK) models are essential for understanding and predicting the time course of drug absorption, distribution, metabolism, and excretion in the body, which is crucial for optimizing therapeutic efficacy, minimizing toxicity, and personalized treatment regimens in diseases such as cancer, cardiovascular disorders, and infectious diseases . For example, cardiovascular disorders requiring Warfarin therapy affect tens of millions of individuals globally , highlighting the critical need for superior models to understand the dynamic impact of drugs and precision dosing, thereby assisting both doctors and patients.

The goal of PK modeling is to discover an underlying closed-form ordinary differential equation (ODE) \(f\) from a dataset of observed patient trajectories. This problem is of significant interest to the machine learning (ML) community, as evidenced by previous non-interpretable ML modeling approaches aimed at developing better PK models . Such datasets are collected from expensive human clinical trials, necessitating the careful selection of which featuresto acquire and analyze during these trials (Guidance, 2010). Pharmacometricians then leverage this data, using their existing knowledge to select appropriate pharmacokinetic models and employ standard statistical tools to infer the parameters of these models. For instance, they often fit a single compartmental PK model, a closed-form ODE model with 3-5 parameters, to the data (Chen and Abuassba, 2021). This process is iterative, refining the models until the most accurate one that generalizes well to new patient trajectories is identified. However, this traditional model discovery approach is often ad-hoc and fundamentally limited by the human expert's time, experience, and implicit assumptions about the underlying pharmacokinetic processes.

Discovering interpretable pharmacokinetic models is traditionally performed by human experts through a scientific process of proposing, collecting, and validating models. Recently, there has been a growing call for artificial intelligence-driven methods to enhance pharmacological modeling (Ryan et al., 2024; Singh et al., 2023; Cheng et al., 2022). This established process involves iterative steps, each presenting distinct challenges in constructing accurate pharmacokinetic dynamics models.

Selecting appropriate temporal models involves complex decisions on model class, state and feature variables, parameters, and their relationships, far exceeding the simplicity of standard pharmacometrics models like single, double, or triple compartmental models (Chen and Abuassba, 2021). This complexity demands aligning model intricacy with data availability, where simple models suit small datasets and complex models fit larger ones. Acquiring the right features is crucial, as it must be done with limited prior information, unlike feature selection, which evaluates pre-existing features (Li et al., 2017). The evaluation must identify inadequate models and explain why, requiring diverse and time-intensive tools beyond a single metric like validation MSE. These challenges are interrelated: strategic data acquisition and thorough evaluation are essential for effective modeling. Despite advancements in tackling these challenges independently, temporal modeling remains manual, limiting speed and scalability, underscoring the need for integrated and automated systems to enhance efficiency.

To address these challenges, we develop the _Data-Driven Discovery (D3)_ framework, leveraging Large Language Models (LLMs) to iteratively discover and refine interpretable dynamics models, directly relevant to pharmacology, epidemiology and ecology applications. D3 features three agents: Modeling, Feature Acquisition, and Evaluation, which collaborate iteratively. The Modeling Agent uses LLMs' code generation and natural language understanding to explore the model space by generating hypothetical models. The Data Acquisition Agent utilizes LLMs' zero-shot and few-shot learning to optimize data acquisition based on summary statistics, text descriptions, and prior knowledge. The Evaluation Agent conducts comprehensive evaluations by computing refined validation MSE metrics, and alignment with prior process understanding, providing precise feedback to improve the other agents' performance.

**Contributions:**1 We propose the _Data-Driven Discovery (D3)_ framework, a novel approach leveraging Large Language Models (LLMs) to iteratively discover and refine interpretable dynamics models, advancing pharmacokinetic modeling (Section 3). 2 D3 overcomes the challenges of uncovering interpretable dynamical systems by using LLMs to explore vast model spaces and integrate unstructured data, producing models with few parameters that rival black box neural networks. D3 accurately discovers dynamics models across pharmacology, epidemiology, and ecology, matching the accuracy of existing methods while enhancing interpretability. It discovers a new, more accurate PK model for Warfarin, validated by expert pharmacometricians. We also gain insight into D3's ability to iteratively improve its models, selectively acquire features, and discover precise dynamics models.

## 2 The vast model space for temporal modeling

In this section, we introduce the model space that D3 searches through, which contains a diverse range of temporal models with varying degrees of refinement. Our focus is on Ordinary Differential Equation (ODE) models, which is one of the most widely used methods for modeling temporal dynamics, which include pharmacokinetic, physiological and epidemiological dynamics (Auger et al., 2008). We are interested in modeling the evolution of a set of _state_ variables \(_{n}(t)^{D}\) for individuals \(n=1,,N\) over the time horizon \(t[0,T]\). The state variables represent the target variables that the human experts are interested in modeling; and there may exist other feature variables that _can_ help predict the evolution of state variables. We assume we are provided with a dataset of individuals trajectories such that \(=\{(_{n}(t),_{n}(t)) n=1,,N,\ t[0,T]\}\), where \(_{n}(t)^{K}\) denotes the observed individual-level features for individual. We can categorize ODE models into three levels (R1 - R3) based on their capacity for refinement.

**R1: Refinement through initial conditions \(_{n}(0)\)**. This level involves the simplest form of ODEs, commonly referenced in scientific literature (Schiesser, 2014). These equations are defined over state variables \((t)^{D}\), incorporate global parameters \(\), and involve a function \(f:^{D+1}^{D}\). The time \(t\) spans the interval \([0,T]\):

\[}_{n}(t)=f(_{n}(t),t,), n[N]\] (1)

Considering \(N\) individuals, each represented by the trajectory \(_{n}(t)\) for \(n=1,,N\), all follow the equation above. According to the uniqueness theorem for initial value problems in ODEs (Lindelof, 1894), any differences among individuals' trajectories can be attributed solely to variations in the initial conditions \(_{n}(0)\), under common regularity conditions on \(f\).

**R2: Refinement through observed features \(_{n}\)**. Suppose we have access to a set of individual-level feature variables \(_{n}\). We can enhance the model's refinement by incorporating these features into the ODE to enable unique dynamics for different individuals:

\[}_{n}(t)=f(_{n}(t),t,_{n}(t),)\] (2)

**R3: Refinement through acquired features \(_{n}\)**. Often, not all relevant variables are initially measured and available for analysis. In such cases, one may consider _acquiring_ additional features \(_{n}(t)^{J}\) to be integrated into the ODE. Here \(_{n}(t)\) is a collection of \(J\) features from the set of all _acquirable_ features \(\), where \(J||\). This third level of refinement reflects one data acquisition challenge, i.e., identifying and collecting informative features \(_{n}(t)\):

\[}_{n}(t)=f(_{n}(t),t,_{n}(t),_{n }(t),)\] (3)

After selecting the level of refinement (R1-R3), it is necessary to determine the functional form of the ODE \(f\), which defines the interactions among various variables and parameters that govern the dynamics. There are two dominant approaches to parameterize \(f\): using a concise closed-form white-box equation \(f_{C}\) or employing a neural network \(f_{N}\). The former approach is prevalent in the field of symbolic regression (Billard and Diday, 2002), while the latter is utilized in Neural ODEs (Chen et al., 2018). Additionally, \(f\) can incorporate both a closed-form component and a neural component, resulting in a hybrid ODE model. Nevertheless, all three approaches involve searching within large combinatorial spaces--closed-form equations, neural architectures, and both--presenting significant computational challenges.

## 3 Data-Driven Discovery (D3)

We aim to uncover the true underlying pharmacokinetic dynamical system, denoted as \(f^{*}\). Our goal is to continually approximate \(f^{*}\) as accurately as possible using proposed models \(f_{}\), with parameters \(\). For simplicity, we will refer to these models as \(f\) in all subsequent references, omitting the \(\) term. To appropriately identify the refinement model level needed from the vast model space discussed above, we now introduce the _Data-Driven Discovery (D3)_ framework, as depicted in Figure 1. This consists of three LLM agents: the Modeling Agent \(G\), the Feature Acquisition Agent \(A\), and the Evaluation Agent \(E\). These three agents work together to form the model improvement loop and the data acquisition loop. The implementation details of the Agents are provided in Appendix F.

### Inputs to Data-Driven Discovery (D3)

To begin the process, D3 requires a clearly defined description of the system in natural language, that details the modeling task, of creating a well-fitting model of _either_ a white-box model or a hybrid model; that is a white-box model with a black-box neural network fitted to the residuals of the white-box model. D3 supports both discovering only white-box models and hybrid models, and we leave this choice up to the end user to decide for their application. Specifically, a user must provide a dataset of individual's trajectories \(\), and a _system description_ and the names and descriptions of any features that exist within the dataset, which can include the ranges of those features. Prior information can be added here by the practitioner into the system description if it is available. We now discuss how the three agents of Modeling, Feature Acquisition and Evaluation interact to discover iteratively better-fitting \(f\) models. We provide full implementation details for the framework in Appendix F.

### Modeling Agent \(G\)

D3's Modeling Agent \(G\) is tasked to iteratively propose and refine the temporal model \(f_{i}\), where \(i=1,,I\) indicates the iteration. We design \(G\) following the three principles below.

**Representening the model \(f_{i}\) as code.** As we discussed in Section 1, one key challenge in evidence-based refinement is the vast space of possible ODE models, ranging from closed-form ODEs to complex neural Neural ODEs and hybrid models. As a prerequisite to finding the most suitable model, we need a consistent and flexible way to represent these diverse models such that they can be trained and validated on data. As such, D3 represents the model \(f_{i}\) as code in Python language. Specifically, each model is defined as a class derived from 'nn.Module' in PyTorch (Paszke et al., 2017) that specifies the free parameters and the computation logic. The Modeling Agent \(G\) leverages an LLM to generate the model code \(f_{i}\) in each step.

**Informing generation with context \(c\)**. Effectively searching through the vast model space presents another challenge. Thankfully, in many applications there exists rich context \(c\) about prior works and domain knowledge. However, this rich source of information was previously locked in unstructured documents and texts, making it hard for automated algorithms to make use of it. By leveraging the LLM's capability to understand unstructured documents, the Modeling Agent \(G\) can now access and leverage this information, therefore proposing more informed models and searching more effectively. In this work, we consider the provision of the following categories of problem context of {system description} and {feature description} (Appendix F).

**Iterative model improvements based on rich verbal feedback \(r_{i-1}\) and memory \(s_{i-1}\)**. To enhance the quality of the generated model \(f_{i}\), we have designed the agent \(G\) to iteratively improve the model based on the presence of any evaluation verbal feedback and its knowledge of the previously generated models and how they performed on a validation subset of given dataset \(\) of trajectories. At each iteration \(i\), the Evaluation Agent \(E\) evaluates the previous model \(f_{i-1}\) using the validation data subset of \(_{i}\) and provides rich verbal feedback \(r_{i-1}\) (c.f. Figure 1), which forms the foundation for the next generated model \(f_{i}\). The Modelling Agent \(G\) utilizes memory \(s_{i-1}\) to track the top-k best-performing models so far, along with their associated evaluation feedback, here their respective losses. Further details on evaluation and data acquisition are discussed in the following section. This iterative process allows for continuous refinement and optimization of models based on their past performance and targeted feedback.

Figure 1: **Data-Driven Discovery (D3) Overview.** Given a dataset of trajectories of individuals \(\), D3 can discover a well-fitting model \(f\), that is either a white-box model or a hybrid model, combining a white-box model with a neural network component fit to the residuals. First, a user provides a system description \(c\) for the model, which includes the feature names, their units and ranges. The Modeling agent uses the textual description and generates a model, represented as code. Next, the Evaluator agent evaluates the generated model on a held-out validation dataset and provides a loss metric. Next, the Feature Acquisition agent decides if it wants to acquire a new feature, that could aid in generating better models. This iterative process repeats, when there exists one or more previously generated models, the Evaluator agent provides a verbal reflection on how the model can be improved, which is used by the Modeling agent at subsequent iterations. This process repeats, discovering better fitting models, and after a set number of iterations, the best fitting model is returned, as code with its parameters optimized to the given training subset of the given dataset \(\).

In summary, the Modeling Agent \(G\) encapsulates a comprehensive range of model structures through computer code \(f_{i}\) and efficiently explores the vast model space by integrating unstructured prior knowledge \(c\), and utilizing data-informed feedback \(r_{i-1}\) along with memory \(s_{i-1}\). The operation of \(G\) can be mathematically represented as follows:

\[f_{i}=G(c,f_{i-1},_{i},r_{i-1},s_{i-1})\] (4)

### Feature Acquisition Agent \(A\)

D3's Feature Acquisition Agent \(A\) is tasked with iteratively proposing new features for acquisition. These features are selected based on their potential to improve the next model's performance in modeling the target state \(_{n}(t)\).

\[h_{i}=A(c,f_{i},_{i},r_{i-1},s_{i-1})\] (5)

Where \(h_{i}\) is the next feature to acquire. Specifically, when a feature is acquired we make the assumption, that it is acquired for all individuals, therefore at the next iteration the dimension of the individual-level features \(_{n}(t)^{K},n=1,,N\) increases by one, to \(_{n}(t)^{K+1},n=1,,N\). It is possible to do this in clinical trials, where pharmacokinetic datasets of patients are collected (Dziura et al., 2013), for example acquiring the individual's ages, or other lab biomarker measurements or tests (Derraik et al., 2021).

**Estimating the value of the feature**. We leverage the value of information (Feltham, 1968) framework to provide a principled way to determine which feature, if any to acquire next. This follows as:

\[V(h_{i})=[L(f_{i},h_{i},_{i-1})]-[L(f_{i}, _{i-1})]-l(h_{i}),\] (6)

where the first two terms capture the improvements in validation loss \(L\) when model \(f_{i}\) is trained on the new dataset that includes the new feature, that is \(=\{(_{n}(t),_{n}(t),_{n}(t))| n [N]\}\) and \(l(h_{i})\) represents the cost for acquiring \(h_{i}\). Estimating \(V(h_{i})\) presents a statistical challenge and a computational challenge. Firstly, in practice, we often do not have access to \(h_{i}\) to begin with (as the goal is to acquire _new_ features)--hence we need a way to estimate \([L(f_{i},h_{i},_{i-1})]\) without fully accessing \(h_{i}\). Secondly, even when \(h_{i}\) is available, computing the two loss terms involves fitting models twice which can be computationally challenging.

To address these challenges, the Feature Acquisition Agent \(A\)_predicts_ the value of feature \(V(h_{i})\) from the available information about \(h_{i}\), as follows:

\[(h_{i})=g(c_{h_{i}},T(h_{i}),_{i}),\] (7)

where \(c_{h_{i}}\) represents the unstructured prior information about the feature \(h_{i}\) (e.g. data descriptions and metadata), \(T(h_{i})\) represents the available summary statistics (e.g. range and type of values from a small subset of data \(h_{i}\)), \(_{i-1}\) represents the existing data, and \(g\) is the prediction function.

The prediction challenge above corresponds to zero-shot or few-shot learning in ML. In the zero-shot case, we need to predict \((h_{i})\) without having access to any "label" \(V(h)\), for some feature \(h\). In the few-shot case, we have access to a small number of feature-label pairs, \(\{c_{h_{i}},T(h_{i}),h_{i-1},V(h_{i-1})\}\) to learn the prediction function \(g\). The Feature Acquisition Agent \(A\) leverages LLM's capability in zero-shot and few-shot learning to address this estimation challenge. Specifically, we inform the LLM by providing high-level statistics \(T(h_{i})\) and a description of the feature \(c_{h_{i}}\) in the form of the feature name to warm-start the zero-shot learning. When the \(h_{i}\) has been included in the data, we inform the LLM about the validation loss associated with those data \(v(h_{i})\) and add it to the few-shot examples to guide the estimation.

**Context, feedback and memory**. Similar to \(G\), \(A\) is also able to leverage unstructured problem context \(c\), evaluation feedback \(r_{i-1}\), and memory \(s_{i-1}\) to guide the data acquisition proposal.

### The Evaluation Agent \(E\)

The Evaluation Agent \(E\) is vital for iteratively improving the Modeling Agent \(G\) and Feature Acquisition Agent \(A\). It provides feedback \(r_{i}\):

\[r_{i}=E(c,f_{i},_{i})\] (8)

Feedback \(r_{i}\) can be numeric, such as validation loss or mean squared error (MSE) of the model \(f_{i}\) on the validation subset \(_{i}\), or more refined metrics like validation loss per target dimension in \(D\). It can also be textual, offering detailed suggestions for model improvements, including clinically plausible modifications generated by an LLM (Shinn et al., 2024).

Evaluating dynamical systems is complex due to intricate interactions and temporal dependencies. The Evaluation Agent dynamically assesses both model _performance_ and _plausibility_, ensuring models are both accurate and interpretable. This comprehensive evaluation is crucial for developing sophisticated, clinically relevant pharmacokinetic models that address real-world complexities.

## 4 Related Works

Our work focuses on autonomously learning temporal models while acquiring data, with several relevant research strands, as summarized in Table 1, which is expanded in Appendix A.

**ODE learning methods.** Symbolic regression methods like SINDy and D-CODE (Koza, 1994; Brunton et al., 2016; Qian et al., 2022) can discover closed-form ODEs \(f_{C}\) using genetic algorithms. They can incorporate features \(_{n}\) (R2 refinement) but struggle with many variables (e.g., >20) due to computational complexity. Neural ODEs use neural networks \(f_{N}\) to handle many variables (Chen et al., 2018; Dupont et al., 2019; Zaytar and El Amrani, 2016; Devlin et al., 2018; Sehovac and Grolinger, 2020), but have numerous free parameters, risking overfitting with insufficient data. D3 captures \(f_{C}_{N}\) and supports R1 - R3 refinement, adapting based on data availability. Both Symbolic regression and Neural ODEs require manual context incorporation \(c\) via hyperparameters and do not address Data Acquisition Challenges.

**AI for automated modeling.** AI Feynman (Udrescu and Tegmark, 2020) enhances symbolic regression by using the physical units of variables, which provide additional constraints to narrow the search space. However, its utility outside physics is limited, as units in other fields carry less information. Eureqa (Ma et al., 2023) applies LLMs to model the reward function in reinforcement learning, integrating unstructured context and representing models as code. Unlike D3, Eureqa cannot automatically refine models, acquire new data, or easily apply to learning temporal dynamics like ODEs.

**Data Acquisition.** Methods like Active Feature Acquisition (AFA) (Ma et al., 2018; Gong et al., 2019) measure additional features on existing samples to improve performance. Active Learning (Sebastiani and Wynn, 2000; Settles, 2009; Sener and Savarese, 2017; Imberg et al., 2020) and Active Testing (Lowell et al., 2018; Kossen et al., 2021) acquire new samples to increase training or evaluation data size while keeping features constant. These methods do not address the zero-shot setting, where data acquisition decisions must be made before observing any target data (Equation 7). Additionally, most Active Learning methods focus on acquiring labels for supervised learning, which is not directly applicable to temporal modeling tasks.

## 5 Experiments and Evaluation

In this section, we demonstrate that D3 can discover well-fitting pharmacokinetic dynamical system models for a range of diverse PK datasets, including an epidemiological and ecological dataset.

**Benchmark Datasets.** Our evaluation encompasses six real-world datasets with clinical relevance, each originating from either real-world data or highly accurate simulators developed by human experts.

    &  \\ Method & Refinement Level & Class of \(f\) & Context \(c\) & Zeroshot & Feature \(\) & Goal \\  Symbolic Reg. & R1, R2 & \(_{C}\) & \(\) & & & \\ Neural ODE & R1, R2 & \(_{N}\) & \(\) & & & \\ AI Feynman & R1 & \(_{C}\) & ✓ & & & \\ Eureka & R1, R2 & \(_{C}\) & ✓ & & & \\ AFA & & & & \(\) & ✓ & Train \\ Active Learning & & & & \(\) & \(\) & Train \\ Active Testing & & & & \(\) & \(\) & Eval \\ D3 & R1 - R3 & \(_{C}_{N}\) & ✓ & ✓ & ✓ & Both \\   

Table 1: Comparison with related works in addressing the Modeling and Data Acquisition Challenges. An empty field means not applicable. _Refinement Level_: the level of refinement (R1 - R3) the method can capture. _Class of \(f\)_: the class of ODE model \(f\) (closed-form \(_{C}\), neural networks \(_{N}\)). _Context \(c\)_: whether the method leverages unstructured contextual information to guide search. _Sample \(N\)_: whether the method is able to acquire new samples. _Feature \(\)_: whether the method can acquire new feature variables. _Goal_: whether the goal of data acquisition is to improve training, evaluation, or both.

Three datasets are based on a state-of-the-art biomedical Pharmacokine-Pharmacodynamic (PKPD) model of lung cancer tumor growth, which simulates the combined effects of chemotherapy and radiotherapy in lung cancer (Geng et al., 2017) (Equation (11)). This model has been widely utilized in previous research (Bica et al., 2020; Seedat et al., 2022; Melmychuk et al., 2022). Specifically, we employ this bio-mathematical model to generate three variations: lung cancer without treatment (**Lung Cancer**), lung cancer treated with chemotherapy (**Lung Cancer (with Chemo.)**), and lung cancer treated with both chemotherapy and radiotherapy (**Lung Cancer (with Chemo. & Radio.)**). Additionally, we utilize an intricate COVID-19 epidemic agent-based simulator (**COVID-19**) (Kerr et al., 2021), to provide an epidemiological dataset. Another dataset comes from an ecological model simulating a microcosm of algae, flagellate, and rotifer populations (**Plankton Microcosm**), replicating a three-species prey-predator experimental system (Hiltunen et al., 2013). Finally, we include a real Pharmacokine (PK) dataset of Warfarin patients (**Warfarin**) (Janssen et al., 2022). Detailed information about all benchmark datasets is provided in Appendix B.

**Benchmark Methods**. To evaluate the performance of D3 and establish its competitive performance, we conduct comparisons with leading modeling methods for ODEs. Specifically, we benchmark against advanced black-box models that have many parameters, such as neural ODEs with action inputs, known as **DyNODE**(Chen et al., 2018; Alvarez et al., 2020). Also in this class are recurrent neural networks (**RNN**) and a state-of-the-art transformer model (**Transformer**). In addition, we include white-box transparent dynamical systems models identified through equation discovery techniques, such as Sparse Identification of Nonlinear Dynamics (**SINDy**) (Brunton et al., 2016). Moreover, D3 supports two discovery modes, of which we compare against both, discovering only white-box models (**D3-white-box**) and discovering hybrid models (**D3-hybrid**)3. We also perform ablations of D3, of zero-shot generated model from D3 as (**ZeroShot**) and the same model with optimized parameters (**ZeroOptim**). Detailed descriptions of the implementations, hyperparameters, and experimental procedures for these benchmarks can be found in Appendix E.

**Evaluation Metrics**. To assess the performance of our benchmark methods, we use the mean squared error (MSE) on a held-out test dataset of state-action trajectories. This evaluation is conducted over ten runs, each initialized with different random seeds. We report the average MSE from these runs along with their 95% confidence intervals. Further details can be found in Appendix C.

## 6 Main Results

We conducted a comprehensive evaluation of our benchmark methods across all datasets, as tabulated in Table 2. We observe that D3 can discover well-fitting dynamical system models, achieving low mean squared error in test predictions on the held-out test dataset of individual trajectories. Crucially, it can discover concise closed-form equation white-box models, of 5-15 parameters that can outperform some of the standard white-box and black-box modeling methods, indicating it is discovering well-fitting underlying equations for the respective systems of interest.

### Case Study: Discovering Novel PK Models for Warfarin

PK models of warfarin, a widely used anticoagulant, are crucial due to its extensive use in treating deep vein thrombosis, pulmonary embolism, and stroke prevention in atrial fibrillation and patients with mechanical heart valves, with millions of prescriptions globally (Lee and Klein, 2013). We applied D3 to a public dataset of 33 patient trajectories (Janssen et al., 2022), discovering a novel PK model for warfarin that outperforms existing literature (Table 3). We compare the test MSE of the

   & Lung Cancer & Lung Cancer (with Chemo.) & Lung Cancer (with Chemo. \& Radio.) & Finalbox Mercoscos & COVID-19 & Warfarin PK \\  & MSE \(\) & MSE \(\) & MSE \(\) & MSE \(\) & MSE \(\) & MSE \(\) \\  D\_NODE & 3254.596 & 55.75.258 & 16.24.635 & 0.0009.007.0083 & 324.62 & 0.726.417 \\ SIND & 3254.95 & 118.642 & 13.736.65 & 0.0013.40 & 935.0599 & 6.86.146 \\ ZeroShot & 5.7860.4764 & 30.846.1 & 6.4460.4276 & 0.033.027.02 & 2.4750.5264 & 31.185.53 \\ ZeroShot & 7.255.496 & 33.85.08 & 6.843.89 & 0.0131.034 & 3.854.086 & 395.65804 \\ RNN & 1.1666.046.3216 & 77.929.43 & 137.58 & 0.0306.0459 & 1.3964.014.276 & **0.0495.0406** \\ Transformer & 7.670.1658 & 0.346.00701 & 0.027.0318 & 3.426.015.796 & **0.0234.6095** & 1.333.041 \\
**D3-white-box** & 59.491.01 & 4.811.8 & 2.424.02 & 0.00024.540.4022 & 5.921.17 & 19.66.403 \\
**D3-hybrid** & **47.29.16** & **0.0978.0463** & **0.138.025** & **1.866.061.876** & 1.882.57 & 0.667.0167 \\  

Table 2: **Evaluating Method Performance. We report the test prediction mean squared error (MSE) on held-out datasets across benchmarks. D3 consistently has the lowest error. Results are averaged over ten random seeds with 95% confidence intervals.**discovered model against existing models and provide pharmacologist feedback. Full model details and results from running D3-hybrid on the same dataset are in Appendix G.

**Existing Wafarin PK Model**. The standard pharmacokinetic (PK) warfarin model from the literature Lv et al. (2017); Hamberg (2013) is the following:

\[ =k_{a} D-k_{e} C,\] (9) \[k_{e} =k_{e,}+k_{e,} A+k_{e,} S\]

where \(C\) is the concentration of warfarin, \(D\) is the dosage administered, \(A\) represents the age of the patient, \(S\) denotes the sex of the patient (1 for male, 0 for female), \(k_{a}\) is the absorption rate, \(k_{e,}\) is the base elimination rate, \(k_{e,}\) represents the decrease in elimination rate per year increase in age, and \(k_{e,}\) is the difference in elimination rate between sexes. This standard model achieves a test loss of 0.646. Whereas D3 can discover both a white-box model with a test loss of 0.39 and a hybrid model with a test loss of 0.271, which both outperform the standard model. Of particular relevance is the white-box model as it is fully interpretable by pharmacometricians, whilst still being a precise model.

**New Discovered PK Warfarin Model**. D3-white-box discovered a new warfarin PK white-box model with a test loss of 0.39, of the following:

\[ =-k_{}+C},\] (10) \[k_{} =k_{e,}+k_{e,}(A-)+k_{e, }(S-)\] \[+k_{} C+k_{ds} D(S-)\] \[+k_{as}(A-)(S-)+k_{ad}  D(A-)\]

where the additional parameters \(k_{}\) represent the natural decay rate of warfarin concentration and \(K_{m}\) is the Michaelis constant indicating the warfarin concentration at which the metabolism rate is half its maximum. The parameters \(k_{}\), \(k_{}\), and \(k_{}\) are the interaction terms for dosage-sex, age-sex, and dosage-age, respectively, and \(\) and \(\) are the sample population means for the covariates of age and sex. This new PK model includes the original parameters along with additional interaction terms and transformations, enhancing the model's complexity and accuracy.

The model discovered by D3 introduces key innovations in warfarin pharmacokinetics. _Square Root Transformation for Dosage Effect_: This non-linear transformation moderates high doses, enhancing sensitivity to dosage variations, unlike standard models. _Natural Decay Term_: Proportional to the current warfarin concentration, it better reflects elimination kinetics and improves time-based predictions. _Michaelis-Menten Saturation Kinetics_: Addresses metabolic pathway saturation at higher concentrations, crucial for warfarin. _Interaction Terms (dosage-sex, age-sex, dosage-age)_: Capture complex interactions between patient-specific factors, providing a nuanced understanding of drug dynamics. These advancements make D3 a powerful tool for enhancing pharmacokinetic predictions in clinical settings. The discovered hybrid model is detailed in Appendix G.

**Expert Clinical Commentary.** We sought feedback from expert pharmacologists on the discovered model4: _Prof. Eoin McKinney, Clinician._ "This model is significant, as consortiums are dedicated to improving Warfarin modeling Consortium (2009). The model adds novel components, such as the Michaelis component for time-varying changes and novel interaction terms like age-sex." _Jean-Baptiste Wohillard, Pharmacologist._ "The model is promising and pharmacokineticsity plausible. The next step is to apply D3 to other clinically relevant PK drug datasets." _Richard Peck, Clinical Pharmacologist_. "This model is reasonable and potentially superior. It represents a significant advance in clinical pharmacology by automatically identifying robust PK models."

### Insight Experiments

This section provides an in-depth analysis of D3's effectiveness related to its benchmark counterparts.

**Can D3 perform feature acquisition and leverage the LLM prior information to perform this better?** To explore the feature acquisition performance of D3, we showcase this component working

   Method & Warfarin Best Model Test MSE \\  Existing Warfarin PK & 0.646 \\ 
**D3-white-box** & **0.39** \\
**D3-hybrid** & **0.271** \\   

Table 3: Warfarin Modeling Comparisonin full, by comparing it against the baseline of a random feature acquirer policy, a null policy that just uses the existing features and our approach of D3 that leverages the LLM to quantify the value of information for features, where no training data exists for them in the dataset. We observe, as in Figure 2, that D3 converges the fastest, and achieves the overall highest performance, whereas the other feature acquisition methods fall short. Experimental details are in Appendix G.2.

**Can D3 evolve its modular model to fit the system best?** We analyze this from an empirical point of view to determine if D3 can correctly evolve the generated model and reduce its prediction error over subsequent generations. We observe that D3 can indeed understand, reason, and iterate the generated code representation of the model to incorporate a better fitting model, as observed in Figure 3.

## 7 Conclusion

**Summary**. In this paper, we proposed _Data-Driven Discovery (D3)_ framework, to iteratively discover and refine interpretable models of pharmacological dynamics, where it has the ability to acquire and integrate new features, validate, and compare pharmacological dynamical systems models, thereby uncovering new insights into pharmacokinetic and physiological processes. Specifically, applied to a real Warfarin PK dataset we were able to discover a better performing Warfarin PK model and provide new insights into what an optimal PK model for Warfarin may need to possess, such as additional Michaelis components.

**Limitations & Future work**. There exist limitations to the current approach. First, the LLM discovery framework is an initial framework, and the utility of the LLM to generate better models could be enhanced, tree-based generation strategies such as the tree of thought (Yao et al., 2024), or graph of thought (Besta et al., 2024). Specifically, it relies on a capable enough LLM, that can use tools, where we specifically used GPT4 as the underlying LLM. Moreover, we make the assumption that when D3 acquires a new feature it acquires that feature for all the individuals within the existing dataset, we leave for future work to consider applications where this assumption may not always be true. Furthermore, we provide to the LLM a system description from a user, future works could explore avoiding the user to provide this, and instead leveraging a form of automatic retrieval augmented generation (Lewis et al., 2020).

**Broader Impact and Ethical Considerations**. Principally D3 aims to discover interpretable models of pharmacological dynamics. However, the final discovered models should always be checked

Figure 3: **D3 iteratively discovers better models \(f_{i}\). Validation MSE of the model generated in each iteration, showing the best-generated model (Top-1 model)—addditionally with a few of the models labeled with their model descriptions, and features acquired at the generation. D3 can effectively acquire and integrate new features, validate, and compare models to achieve a better-fitting model.**

Figure 2: **Feature Acquisition. D3 performing adaptive feature acquisition in the Lung Cancer (with Chemo. & Radio.) dataset. We observe that D3 still achieves the lowest test prediction error.**

by appropriate human experts and validated in additional held-out datasets before any clinical use. Furthermore, D3 is a tool, which could be misused by a malicious user with unethical system descriptions as input to discover a potentially biased model. Moreover, D3 leverages LLMs and their feedback as an integral component, however, LLMs are prone to hallucinations, thereby motivating any LLM-generated outputs that are shown to the user should have a content filter applied to them.