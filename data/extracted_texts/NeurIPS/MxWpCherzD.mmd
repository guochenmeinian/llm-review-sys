# Equivariant spatio-hemispherical networks for

diffusion MRI deconvolution

 Axel Elaldi

New York University

axel.elaldi@nyu.edu &Guido Gerig

New York University

gerig@nyu.edu &Neel Dey

MIT CSAIL

dey@csail.mit.edu

###### Abstract

Each voxel in a diffusion MRI (dMRI) image contains a spherical signal corresponding to the direction and strength of water diffusion in the brain. This paper advances the analysis of such spatio-spherical data by developing convolutional network layers that are equivariant to the \(()()\) group and account for the physical symmetries of dMRI including rotations, translations, and reflections of space alongside voxel-wise rotations. Further, neuronal fibers are typically antipodally symmetric, a fact we leverage to construct highly efficient spatio-_hemispherical_ graph convolutions to accelerate the analysis of high-dimensional dMRI data. In the context of sparse spherical fiber deconvolution to recover white matter microstructure, our proposed equivariant network layers yield substantial performance and efficiency gains, leading to better and more practical resolution of crossing neuronal fibers and fiber tractography. These gains are experimentally consistent across both simulation and in vivo human datasets.

## 1 Introduction

Instead of scalar intensities, each voxel of a diffusion MR image (dMRI) contains spatio-angular measurements of local water diffusion . As in Fig. 1, this yields _spatio-spherical_ images living on \(^{3}^{2}\) that are used to map neuronal organization _in vivo_ alongside several other biomedical use cases . Despite its potential, deriving neuronal fiber pathways using dMRI is hampered by significant partial voluming in both spatial and spherical domains due to limited clinical scanner resolutions and low SNR . This paper presents a state-of-the-art dMRI deconvolution method to recover neuronal pathways in practical timeframes by developing highly efficient equivariant neural networks that account for dMRI's spatio-spherical data geometry and the voxel-level antipodal symmetry of neuronal fibers, all while demonstrating robustness to clinical dMRI resolutions.

**Need for deconvolution.** The diffusivity at a voxel reflects the underlying local tissue microstructure . As multiple neuronal fibers can cross within a given resolution-limited voxel, recovering these fibers necessitates solving a blind fiber deconvolution problem at each voxel. Several voxel-level fiber models have been proposed  and this work focuses on the widely used fiber Orientation Distribution Function (fODF) model, which represents the fiber configuration at a voxel as a sparse non-negative spherical function . fODFs are the first step of common dMRI applications such as fiber tractography . However, due to noise, subject motion, and clinically viable sampling resolutions (e.g., \( 30\) spherical samples per voxel), fODF recovery is highly ill-posed and requires significant regularization.

**Iterative solutions.** Constrained spherical deconvolution (CSD)  is the workhorse algorithm for dMRI deconvolution, solving the per-voxel fODF deconvolution problem iteratively, subject to non-negativity constraints. Several extensions of CSD further regularize fODFs to be sparse and/or spatially smooth . Further, as fODFs can be assumed to be antipodally symmetric , many iterative algorithms optimize only over the hemisphere to accelerateper-voxel optimization. For example, CSD only optimizes for the even-order spherical harmonics of the fODF and RUMBA  uses approximately hemispherical sampling to represent the fODF. Despite significant progress using iterative solutions, these methods still require high angular sampling resolutions that are not clinically feasible to resolve crossing fibers within a voxel.

**Deep deconvolution networks.** Recent deep learning frameworks for dMRI deconvolution incorporate supervision and/or additional inductive biases to improve results. Supervised approaches train U-Nets to regress the solutions of iterative models or regress ground-truth fODFs estimated from ex vivo animal histology. These methods are consequently upper-bounded by the quality of iterative solutions and the generalizability limitations of small animal datasets. Further extensions incorporate the underlying spherical geometry of the per-voxel estimation by using \(()\)-equivariant network layers but retain the supervised strategy of previous models . ESD  instead proposes to use \(()\)-equivariant network layers and _unsupervised_ and regularized reconstruction-based deconvolution losses to surpass supervised solutions.

However, the above methods operate entirely at the voxel level and do not model the strong correlation between neighboring fODFs. To this end, RT-ESD  proposed \(()()\)-equivariant network layers for dMRI that are equivariant to spatial rotations, translations, and reflections alongside voxel-wise spherical rotations to achieve high-quality deconvolution due to the joint spatio-spherical modeling. However, its high computational requirements limit its use in clinical or large-scale deployment. For instance, while subject-specific iterative fits with CSD require 3-5 minutes for the whole brain, RT-ESD requires about a day on an A100 GPU to converge when trained on a single subject.

**Contributions.** We present an efficient equivariant neural network framework for dMRI deconvolution that respects the data geometry of dMRI while ensuring computational practicality. Our spatio-hemispherical deconvolution (SHD) method addresses key redundancies and weaknesses of previous deep networks for dMRI deconvolution in three ways: (1) As fODFs are approximately antipodally symmetric at clinical resolutions, we replace RT-ESD's full spherical sampling with hemispherical sampling and find substantial efficiency gains by reducing the graph Laplacian of the voxel-wise SO(3) convolutions used in RT-ESD; (2) We then exploit the dense structure of dMRI data to further introduce optimized implementations and pre-computations, achieving a cumulative 65% reduction in processing time for an E(3) \(\) SO(3)-equivariant U-Net; (3) Finally, we use explicit smoothness-promoting spatial regularization, leading to further improved fODF recovery.

Experimentally, we achieve state-of-the-art deconvolution results on two widely used simulated dMRI benchmarks with known ground truth. On real _in vivo_ human dMRI, our method yields more spatially coherent fODF fields and higher robustness to changes in resolution from research-grade to clinical standards of single-shell low-angular protocols. Lastly, as the achieved efficiency gains enable training on a large set of human datasets, we can now train a single network for amortized inference on new human dMRI, as opposed to the subject-specific optimization of RT-ESD. Our code is available at https://github.com/AxelElaldi/fast-equivariant-deconv.

## 2 Related work

**Deep learning for dMRI.** Learned networks operating on dMRI have been extensively used to improve fiber tractography [46; 63], super-resolve diffusion signals or fODFs [48; 58; 78], regress

Figure 1: A diffusion MRI (columns 1–3) and a T1w MRI (column 5) derived from a subject in the HCP Young Adult dataset . The inset (column 4) visualizes a region’s spatio-spherical diffusion signal (\(b-1000mm/s^{2}\)), highlighting crossing-fiber patterns and the grey/white matter interface.

microstructural indices in undersampled settings [13; 14; 27; 30; 31; 61], denoise artifacts [22; 23; 76], segment lesions , and more. Of these, most employ supervision via training on high-angular resolution research datasets to generalize to low-resolution clinical datasets. Our work is most related to networks that directly operate on \(^{3}^{2}\) images either through spherical networks applied voxel-wise or approximate parameterizations of the spatio-spherical space [6; 9; 10; 20; 19; 47; 50; 62].

For spherical data, \(\)-equivariant convolutions are often achieved via spherical harmonics-parameterized convolutions [16; 21; 42] or isotropic convolutions on spherical graphs . These models have been extended to voxel-wise fODF estimation [19; 62] but do not use the spatial correlation between fODFs. [6; 10] develop convolutions for dMRI classification and super-resolution that exhibit voxel-wise \(\)-equivariance and incorporate manifold-valued spatial averaging. To model spatio-spherical dependence explicitly, \(\)-equivariance for improved dMRI segmentation has been achieved via tensor field networks  and separable kernels [9; 47] at the cost of high-memory usage. In contrast, RT-ESD  uses isotropic spatio-spherical kernels and focuses on deconvolution with equivariance to both joint and independent voxel and grid rotations. More recently, PONITA proposes efficient \(\)-equivariant convolutions for spatio-spherical molecular graphs, but as yet, does not scale to high-angular resolutions needed for dMRI deconvolution.

**Spherical deconvolution methods.** Constrained spherical deconvolution (CSD) [38; 66] and its sparse  and/or spatially regularized extensions [11; 29; 57; 59; 74] are established but rely on lengthy and data-dependent iterative optimization and struggle to resolve small-angle crossing fibers in the low-resolution setting (see Fig. 2). More recently, several trainable models have been proposed for direct fODF estimation including pattern matching methods  that use a dictionary to match diffusion signal to known tissue microstructure and deep neural networks [19; 20; 39; 43; 46; 51; 52; 61; 62; 78] that learn a mapping from diffusion signals to fODFs. Trainable models have the advantage of potentially decreasing the need for high-angular resolution dMRI input. ESD  further introduced an unsupervised learning framework using only a diffusion signal reconstruction loss and additional fODF regularization, removing the need for ground-truth fODFs for training.

**Spatially informed deconvolution.** Traditionally, spherical deconvolution is optimized voxel-wise. However, the underlying tissue microstructure has long-range spatial correlations. Iterative methods account for this through spatial regularization such as total-variation  or fiber continuity [29; 57; 59; 74], at the cost of increased optimization complexity. Current neural network frameworks

Figure 2: **A deconvolution visualization** comparing recovered fiber orientation distribution functions (fODFs) produced by the widely-used iterative CSD model (**top row**) and our proposed SHD-TV model (**bottom row**) with high-resolution / clinically-infeasible (**left**) and low-resolution / clinically-feasible (**right**) spherical sampling. At high-resolutions (**left**), SHD-TV demonstrates enhanced localization of fiber orientations, heightened sensitivity to small-angle crossing fibers, and improved spatial consistency in the recovered fibers. At clinical low-resolutions (**right**), CSD struggles with the loss of input information, whereas our approach exhibits greater robustness to resolution losses and single-shell imaging protocols, yielding higher fidelity and spatially coherent fODFs. Appendix Fig. 9 visualizes comparisons with additional baselines.

have overlooked explicit fODF spatial regularization and rely solely on high-quality fODF training data and implicit spatial regularization by mean of spatial-weight sharing, either employing grid-wise 3D convolution [20; 46; 78], or channel-wise concatenation of neighboring voxels [19; 61; 62].

## 3 Methods

### Background

**dMRI deconvolution.** A dMRI image is a spatio-spherical function \(S:^{3}^{2}^{B}\) with \(B\) features, called shells in the dMRI literature. The fODF model describes the tissue microstructure as a non-negative spatio-spherical function \(F\), providing information on the local tissue composition and orientations, and links the dMRI and the fODFs \(S=(F)\). dMRI deconvolution is interested in recovering the fODF from the dMRI by minimizing a constrained reconstruction loss \(F^{*}=*{argmin}_{F 0}||S-(F)||_{2}^{2}\). We focus our study on learnable spatio-spherical deconvolution operators trained to reconstruct high-angular resolution fODFs from sparse dMRI measurements \(_{}(S)=F\).

**Spatio-spherical convolutions.**\(()()\) is the group of independent \(()\) and \(()\) transformations, where \(()\) acts on the spatial grid \(^{3}\) and \(()\) acts on the voxel sphere \(^{2}\). Let \(_{}:^{3}^{2}\) be a learnable filter, such that convolving \(f\) and \(_{}\) yields \(f_{}(T,R)=_{y^{3}}_{p S^{2}}_{}(T ^{-1}y,R^{-1}p)f(y,p)\,dp\,dy\) where \((T,R)()()\). RT-ESD  implements these convolutions by only considering isotropic filters to limit computational complexity. In addition, the filter \(_{}\) is expressed as a separable kernel \(_{}(z_{1},z_{2})=_{_{1}}(z_{1})_{_{2}}(z_{2})\), turning the convolution into a two-step spherical-spatial convolution:

\[f_{}(x,q)=_{y^{3}}_{_{1}}(||x-y||)_{p ^{2}}_{_{2}}(qp^{T})f(y,p)\,dp\,dy.\] (1)

We build on RT-ESD , presented in Fig. 12, which uses DeepSphere 's graph filtering based \(()\)-equivariant spherical convolution. At every spatial location \(y^{3}\), \(f(y,.)\) is discretized on a set of spherical vertices \(=\{q_{i}^{2}\}_{i[1..,N_{}]}\), \((y)^{N_{}}\). The graph \(=(,)\) and its normalized Laplacian \(\) are constructed from the set \(\), where \(^{N_{} N_{}}\) is the spherical adjacency matrix. The voxel-wise spherical filtering output is then used to construct a spatio-spherical graph \(}(y)=[T^{0}()(y),...,T^{K-1}() (y)]^{N_{} K}\) with \(K\) features, where \(K\) is the polynomial degree of the filtering and \(T^{k}()\) is the Chebyshev polynomial of degree \(k\). A learnable isotropic spatial filter \(_{k}:^{+}\) is then defined for each spherical filtered map \(}_{k}\), resulting in the overall \(()()\)-convolutional operation expressed as:

\[_{out}(x)=_{y(x)}_{k=0}^{K-1}_{k}(||x-y ||)T^{k}()(y),\] (2)

where \((x)\) is a spatial neighborhood around the position \(x^{3}\). Spherical \(()\)-equivariance is achieved by using a uniform and symmetric \(\) sampling such as the HEALPix  grid, providing a uniform coverage of the spherical domain at different levels of resolution, and graph weight \(p,q\), \((p,q)=e^{-||p-q||/}\) with \(\)'s value selected to minimize empirical equivariance error.

### _Efficient_ dMRI spatio-hemispherical convolutions

**Spatio-Hemispherical Equivariant convolution.** fODFs and dMRIs are approximately antipodally symmetric, which makes fully spherical convolutions redundant. We therefore improve the time and space efficiency of the RT-ESD convolution by reducing the spherical graph \(\) to a hemispherical graph \(\). Because \(f\) is antipodal symmetric, we assume, without loss of generality, that \(\) is a symmetric sampling, i.e. \( p\), \(( p)\). We construct the hemispherical sampling \(^{+}=\{pp_{z} 0\}\) from the spherical sampling \(\), with \(p_{z}\) chosen to be the 3rd spatial coordinate of \(p\). We compute the hemispherical Laplacian weight as,

\[p,q^{+},\;^{+}(p,q)=(p,q)+(p,-q).\] (3)

Thus, the spherical operation \(f\) is entirely explained by the hemisphere graph Laplacian \(^{+}f^{+}\), i.e. \( p\), \((p^{+})^{+}\) s.t. \((^{+}f)(p^{+})=(f)(p)\), where \(f^{+}\) is the \(f\) sampling on \(^{+}\) (proofin appendix A.1). For spherical samplings \(\) such as HEALPix, our proposed sampling reduces the number of vertices sampled to \(||\) and the hemispherical Laplacian size to \(||^{2}\). Our reduction is both theoretically and empirically equivariant to \(()()\), see appendix A.2 for more details.

**Dense Matrix Multiplication.** DeepSphere's  used sparse matrix multiplication to compute \(T^{k}()(x)\). However, for dMRI, our Laplacians are dense and sparse matrix multiplication adds significant computational overhead on dense matrices. To address this, we substitute the sparse matrix multiplication used in  with standard matrix multiplications and find substantial efficiency improvements when applied to dMRI data.

**Pre-computed Chebyshev Polynomials.** DeepSphere  assumes the spherical sampling \(\), and thus the Laplacian \(\), to be dependent on the input spherical signal \(\). Thus, for efficiency, the Chebyshev polynomials are computed iteratively as \(T^{k+1}()(x)=(2T^{k}()-T^{k+1}( ))(x)\) for each new \(\) and \(\). In our setting, we use the same spherical sampling \(\) for every spherical signal \(\), making the Laplacian \(\) of every convolutional layer fixed. We therefore precompute and store these polynomials before training to further eliminate redundancy.

### Spatial Hemispherical Deconvolution (SHD) Network

Fig.3 presents an overview of our proposed spatial-hemispherical deconvolution (SHD) framework. Below, we first describe how our inputs are preprocessed and then detail our network and the losses used to train it.

**Data normalization.** The dMRI signal acquisition yields a raw spatio-spherical signal \(_{}\) sampled on a set of spherical coordinates \(\), called shell sampling. The signal intensity range and shell sampling are scan-dependent and need to be normalized before being fed to our proposed neural network. Following , we normalize the dMRI scans such that the white matter \(B0\)-diffusion signal is comparable between scans. Then, following , the normalized data is interpolated onto a hemispherical HEALPix sampling \(^{+}\). We provide details in appendix C.2.

\(()()\)-Unet.The interpolated diffusion signal is then deconvolved to recover the spatio-spherical fODFs \(_{^{+}}\) on the same input HEALPix sampling \(^{+}\). We use a U-Net, with \(4\) depth levels, with layers acting on a spatial grid of hemispherical samples. We use our proposed layers in the U-Net architecture presented in Fig. 3. Besides the last, every block comprises a convolution, batch-norm, and a ReLU activation. The last block consists of a convolution and a Softplus activation function. The up/downsampling layers first involve mean spatial upsampling/pooling on \(^{3}\), followed by mean spherical upsampling/pooling on \(^{2}\), both introducing minor numerical equivariance error. Following DeepSphere , to minimize the equivariance error from the spherical upsampling/pooling, we use the hierarchical structure of the HEALPix grid.

**Network training.** Our proposed deconvolution network \(_{}\) takes as input the shell-sampled dMRI signal \(_{}\) to produce fODFs \(_{^{+}}^{}=_{}(_{ })\). We train the network in an unsupervised manner by reconstructing the dMRI signal \(_{}^{}=(_{^{+}}^{ })\) from the estimated fODFs, with details on the

Figure 3: **Contribution overview.****A.** We reduce the spherical graph \((,)\) to an hemispherical graph \((,^{+})\). **B.** The SHD deconvolution framework operates on a grid of spherical signals and reduces computation complexity while improving neuronal fiber deconvolution.

reconstruction function \(\) in appendix C.2. We note that the input and reconstruction shell samplings \(\) and \(\) need not be the same, allowing for angular super-resolution reconstruction during training if required. The parameters \(\) are estimated by minimizing a reconstruction loss subject to non-negativity [19; 66] and sparsity-promoting regularization [12; 19]:

\[=||_{}-_{}^{g}||_{2}^{2}+ _{}||._{^{+}}^{}||_{2}^{ 2}+_{.}||(1+_{^{+}}^{ }}{^{2}})||_{2}^{2}+_{}_{},\] (4)

where the terms correspond to reconstruction, non-negativity, sparsity, and smoothness, respectively. We define \(\) as a vector setting any positive component of \(_{^{+}}^{}\) to 0. We set \(=10^{-5}\) following . \(_{TV}\) is described below.

**Spatial regularization.** To add _explicit_ spatial regularization, we propose to extend the spatial total-variation regularization from  to the trainable model framework \(_{}=||_{x}_{^{+}}^{}||_{2} ^{2}\) where \(_{x}\) is the spatial gradient operator. The spatial regularizer \(_{}\) seeks to promote smoother reconstructions in ill-posed settings, especially at clinical angular resolutions used later in our experiments.

## 4 Experiments

We first quantify the runtime and memory efficiency gains produced by our contributions. We then analyze their use across a diversity of dMRI deconvolution settings on both real and synthetic datasets.

### Runtime and memory efficiency improvements

**Experimental details.** We first compare the efficiency of our proposed convolution against two spatio-spherical equivariant convolutions: RT-ESD  and PONITA , as measured by inference runtime and memory consumption. We then conduct an ablation analysis of our three proposed improvements. All analyses are conducted for both a single spatio-spherical layer applied to increasing spherical graph resolution and also for an entire spatio-spherical U-Net architecture detailed in Fig. 3. As input, we use a random \(8 8 8 V\) spatio-spherical volume, with \(V\) depending on the spherical HEALPix grid resolution. We fix the U-Net input HEALPix resolution to \(8\) (\(V=754\)) and we vary the single layer HEALPix resolution from \(1\) (\(V=12\)) to \(8\). We take the RT-ESD convolutions as a reference baseline and present runtime and memory usage results as a percentage of the baseline averaged across \(50\) inference steps. All comparisons are performed using an Nvidia RTX-8000 GPU.

Figure 4: **Efficiency analysis. Runtime (A & C) and GPU memory usage (B & D) expressed as the percentage of the baseline , for both: (line plots) a convolutional layer applied to increasing angular resolution samplings and (bar plots) a U-Net applied to high-angular resolution. The proposed convolution is more efficient than existing equivariant spatio-spherical convolutions.**

**Results.** Fig. 4 presents the results of the efficiency analysis. For a single layer, our convolutions are \(2\) to \(5\) times faster than the RT-ESD baseline while decreasing memory footprint by \(2.5\) times on large spherical sampling. PONITA has a similar runtime and memory footprint as SHD on sparse spherical sampling but underperforms on large spherical graphs (that are common in dMRI deconvolution ), being \(10\) times slower and more memory intensive. Consequently, a U-Net designed for high-angular resolution sampling is \(2.5\) and \(3.5\) faster using our proposed convolutions over RT-ESD and PONITA, while using \(4\) and \(20\) times less memory, respectively. Our ablations indicate that using our hemispherical convolutions over the spherical convolutions, as well as using precomputed Laplacian polynomials, brings the most improvement for both runtime and memory on large spherical sampling while leveraging dense matrix multiplication reduces runtime on low-angular resolutions.

### Diffusion MRI deconvolution experiments

**Experimental details.** Validation of fODF estimation methods is confounded by the absence of known and unbiased ground truth fODFs in _in vivo_ human dMRI. To address this limitation, the literature commonly benchmarks methods on synthetic datasets with known ground truth tissue microstructure. We conduct both a quantitative (synthetic dataset) and qualitative (_in vivo_ human dMRI) analysis of our deconvolution framework (Section 4.2.1). We then perform a quantitative analysis on the tractography downstream task on a benchmark synthetic dataset (Section 4.2.2). For quantitative evaluation, we first estimate fODFs, then detect fiber peaks, and report the peak angular error and false positive rate (FPR) following . The angular error is the average angle between the ground truth peaks and their closest predicted peaks and the FPR is the number of predicted peaks that do not match any ground-truth peaks divided by the number of ground-truth peaks. See Appendix A.3 for more details. All deep network experiments were performed using a single RTX8000 GPU and used less than \(16\)GB of system RAM.

**Baselines.** We compare the proposed SHD method against conventional iterative methods including CSD , RUMBA and RUMBA-TV , and state-of-the-art learning based methods leveraging different convolutional layer, such as the non-equivariant voxel-wise MLP in  and the volume-wise CNN in , that we also extend to have spatial regularization (CNN-TV). We also compare against equivariant voxel-wise spherical convolutions ESD , and more recent equivariant spatio-spherical convolutions RT-ESD  and PONITA . To focus on the inductive bias introduced by each method's convolution layer, we adopt a standardized network architecture and training framework, presented in section 3.3. We provide details about these different baselines in appendix C.3.

**Data.** We leverage three public dMRI datasets for validation. DiSCo  is a synthetic dMRI dataset with three volumes, split into training, validation, and testing volumes, with high-angular resolution sampling (\(4\) shells each with \(90\) gradients) provided with ground truth fODF. We then use \(100\) in-vivo unrelated dMRI scans from the HCP young adult dataset , split into \(65\) training, \(15\) validation, and \(20\) testing volumes, with high-angular resolution (\(3\) shells, each with \(90\) gradients), without any ground truth. As we aim to benchmark performance on both high-angular resolution data and more commonly acquired low-angular resolution data, we further simulate low-angular

Figure 5: **Overview of the diffusion MRI experiments in Section 4.2. [A] We perform super-resolved fODF estimation experiments on two datasets, DiSCo and HCP, respectively. Here, we study the impact of using either high-angular or low-angular resolution as input. [B] We perform quantitative fODF and tractography estimation experiments on Tractometer. We extract fODFs and tractograms from the dMRI with both input and output having low-angular resolution.**resolution acquisitions on DiSCo and HCP by randomly selecting \(29\) gradients from only the lowest shell. The last dataset is Tractometer , a single-volume simulation of a real human brain with a low-angular resolution protocol (1 shell, \(32\) gradients), provided with ground truth tractography alongside a tractography scoring algorithm .

#### 4.2.1 Super-resolved fODF estimation: synthetic DiSCo and real human HCP datasets

We perform two experiments, depicted in Fig.5A). First, we measure performance when all baselines are trained and tested on high-angular resolution data. Second, we give all methods high-angular resolution data only during training and test them on low-angular resolution data. In this setting, the networks are trained to regress the high-angular resolution data from low-angular resolution input. For quantitative evaluation, we extract fiber directions from the estimated fODF and we report the peak angular error and false positive rate as described in the previous section. All results are averaged over five random training seeds. Finally, as HCP lacks fODF and tractogram ground truth, we perform a qualitative analysis. Further validation details are in appendix A.3 and A.4.

**Results.** Fig. 6 presents DiSCo deconvolution results for both the low and high-angular resolution settings. We visualize qualitative results on a random HCP test subject in Fig.2, focusing on two areas with diverse tissue microstructures, such as crossing fibers, fiber bending, and multi-tissue compartments. Our proposed efficiency contributions retain all of the performance of previous methods as our proposed SHD model (without spatial regularization) achieves similar results to the much slower and more memory-intensive RT-ESD and PONITA methods. Moreover, non-equivariant methods, while having competitive angular errors, are negatively impacted by a high false positive rate and qualitatively high number of spurious fibers.

Finally, on research-grade high-angular resolution data, incorporating spatial information in the network input does not improve results. However, adding total-variation regularization on the output of the model as in our proposed SHD-TV model shows significantly improved results. Further, in a clinical low-angular setting, our spatially informed models (SHD and SHD-TV) widely outperform voxel-wise methods, showcasing the importance of contextual information for clinical dMRI.

#### 4.2.2 Unsupervised fODF estimation and tractography w/ known ground truth: Tractometer

A high-level overview of this experiment is described in Fig.5B). As Tractometer consists of a single volume with a low-angular resolution protocol with no held-out testing data, we benchmark methods on unsupervised fODF estimation similarly to previous work . We first train the models in an

Figure 6: **DiSCo fiber detection performances on high (left col.) and low (right col.) angular resolutions. We first present fODF estimation results on high-angular [A] and low-angular resolution [B] input (closer to bottom-left is better). [C-D] then present a qualitative example of a two-crossing fiber estimation. Our faster implementation SHD does not negatively impact results in comparison to RT-ESD, while our improved model SHD-TV outperforms other methods by providing higher angular precision and less spurious fibers, especially at clinically-viable low-angular resolution.**

unsupervised manner to estimate fODFs and then use them to investigate the effect of improved local fODF estimation on white matter tractography accuracy. Validation of the unsupervised estimated fODFs involves using the same local fiber detection evaluation as for the DiSCo experiments. Subsequently, the validation of the estimated tractographs is conducted by comparing them against 21 ground truth fiber bundles provided by the dataset . The white matter streamlines of the tractograph are initially segmented into \(21\) target fiber bundles. The correctly identified bundles are counted as Valid Bundles and the streamlines belonging to one of the ground truth bundles are counted as Valid Streamlines. Further, the volume of each estimated bundle is compared against the volume of its corresponding ground truth bundle, leading to the computation of the Overlap score (analogous to a True Positive value) and the Overreach Score (similar to a False Positive value).

**Results.** We present Tractometer results in Fig.7. In this setting where all methods are trained and tested on the same volume, non-equivariant methods (CNN and CNN-TV) outperform most unregularized equivariant deconvolution methods. We speculate that when generalization is not required, non-equivariant models enjoy a higher overfitting capability in this problem, thereby diminishing the advantage of employing inductive priors in neural networks.

However, the proposed SHD-TV, which incorporates both spatio-spherical inductive biases and spatial regularization, significantly outperforms all other methods, regardless of whether they are equivariant or spatially regularized. This finding supports the compounding benefits of both our architectural modifications and our proposed regularization strategy. In turn, these enhanced fODF recovery performances positively impact tractography accuracy, reflected in a quantitatively higher number of valid streamlines and bundle overlap (albeit with an increase in bundle overreach) and more qualitatively coherent streamlines.

## 5 Discussion

**Limitations and future work.** Our work has certain limitations. First, while we focus on the key dMRI task of fiber deconvolution, our proposed layers are task-agnostic and can also be deployed to other tasks such as denoising and segmentation in future studies. Second, while our layers can be used in many fields with spatio-spherical data outside of neuroimaging, such as robotics , neural rendering , and molecular dynamics , our assumption of antipodal symmetry (widespread in dMRI) may need to be relaxed for many applications within these fields. Third, angularly

Figure 7: **Tractometer fODF estimation and tractography performance. Top:** Unsupervised fODF estimation (**A**, closer to bottom left is better) and tractography (**B**, closer to top right is better) results. **Bottom:** In [**C**], we visualize ground-truth and estimated fibers projecting out from the brainstem into the right hemisphere. Overall, SHD and SHD-TV demonstrate more faithful fiber and streamline recovery as compared to the voxel-wise RUMBA and ESD methods. In particular, SHD-TV yields fewer invalid streamlines and increases spatial coherence.

undersampled reconstruction results have an inherent risk of missing fibers or fiber hallucination. While our work partially mitigates these unrealistic reconstructions by adding geometric and spatial priors to the reconstruction, future validation studies could analyze cohorts with paired scans on clinical low-resolution and research-grade high-resolution dMRI protocols. Finally, our methods need further testing on additional clinical challenges such as subject motion, imaging artifacts, and abnormal structures. However, as our work is entirely self-supervised and only based on regularized reconstruction of input data, we anticipate robustness to such imaging variation. Preliminary results on a pathological brain sample are provided in appendix A.5.

**Conclusions.** The analysis of _in vivo_ white matter neuronal organization within the brain depends on the key task of dMRI deconvolution and current methods are either not accurate or too slow. To that end, we developed highly time and memory-efficient equivariant convolutional network layers that respect the physical symmetries of dMRI. Our contributions led to \(3.5\) faster runtimes and up to \(20\) lower memory consumption as compared to existing spatio-spherical layers, while exceeding or maintaining their performance on dMRI studies. These layers were then used to construct networks that achieved strong dMRI deconvolution performance in practical timeframes across multiple commonly used synthetic benchmark datasets and real _in vivo_ human datasets. Finally, our methods are robust to the dMRI angular resolutions typically used in clinical practice outside of research settings, potentially enabling robust analyses of large-scale retrospective dMRI studies and direct application to the clinic.