# Using Imperfect Surrogates for Downstream Inference: Design-based Supervised Learning for Social Science Applications of Large Language Models

Using Imperfect Surrogates for Downstream Inference: Design-based Supervised Learning for Social Science Applications of Large Language Models

 Naoki Egami\({}^{*}\)

\({}^{1}\)

\({}^{1}\)Columbia University

\({}^{2}\)Princeton University

 Musashi Hinck\({}^{2}\)

\({}^{2}\)Princeton University

 Brandon M. Stewart\({}^{*}\)\({}^{2}\)

\({}^{1}\)Columbia University

\({}^{2}\)Princeton University

 Hanying Wei\({}^{1}\)

\({}^{1}\)Columbia University

\({}^{2}\)Princeton University

###### Abstract

In computational social science (CSS), researchers analyze documents to explain social and political phenomena. In most scenarios, CSS researchers first obtain labels for documents and then explain labels using interpretable regression analyses in the second step. One increasingly common way to annotate documents cheaply at scale is through large language models (LLMs). However, like other scalable ways of producing annotations, such surrogate labels are often imperfect and biased. We present a new algorithm for using imperfect annotation surrogates for downstream statistical analyses while guaranteeing statistical properties--like asymptotic unbiasedness and proper uncertainty quantification--which are _fundamental_ to CSS research. We show that direct use of surrogate labels in downstream statistical analyses leads to substantial bias and invalid confidence intervals, even with high surrogate accuracy of 80-90%. To address this, we build on debiased machine learning to propose the _design-based supervised learning_ (DSL) estimator. DSL employs a doubly-robust procedure to combine surrogate labels with a smaller number of high-quality, gold-standard labels. Our approach guarantees valid inference for downstream statistical analyses, even when surrogates are arbitrarily biased and without requiring stringent assumptions, by controlling the probability of sampling documents for gold-standard labeling. Both our theoretical analysis and experimental results show that DSL provides valid statistical inference while achieving root mean squared errors comparable to existing alternatives that focus only on prediction without inferential guarantees.

## 1 Introduction

Text as data--the application of natural language processing to study document collections in the social sciences and humanities--is increasingly popular. Supervised classifiers have long been used to amortize human effort by scaling a hand-annotated training set to a larger unannotated corpus. Now large language models (LLMs) are drastically lowering the amount of labeled data necessary to achieve reasonable performance which in turn sets the stage for an increase in supervised text as data work. Recent papers have shown that GPT models can (for some tasks) classify documents at levels comparable to non-expert human annotators with few or even no labeled examples (Brown et al., 2020; Gilardi et al., 2023; Ziems et al., 2023).

In social science, such text classification tasks are only the first step. Scholars often use labeled documents in downstream analyses for _explanation_ of corpus level properties (Hopkins and King, 2010; Egami et al., 2022; Feder et al., 2022; Grimmer et al., 2022), for example, using a logistic regression to model a binary outcome \(Y\{0,1\}\) by regressing this outcome on some explanatory variables \(X^{d_{X}}\). In political science, \(Y\) could represent whether a social media post contains hate speech, and \(X\) could include posters' characteristics, such as gender, education, and partisanship. Regression estimates the share of hate speech posts within levels of explanatory variables. Importantly, this task of explanation in CSS is distinct from unit-level prediction--classifying whether each post contains hate speech. Because of this social science goal of explanation, simple regression models, like logistic regression, are often preferred as low dimensional summaries (Chernozhukov et al., 2018; Vansteelandt and Dukes, 2022). Ideally, all documents would be labeled by experts to achieve a gold-standard \(Y\) but this is costly and so researchers turn to more scalable approaches such as LLMs. We call these more scalable--but error-prone--labels, _surrogate labels_.

When using surrogates in downstream statistical analyses, researchers often ignore measurement error--the unknown and heterogeneous mismatch between the gold-standard label and the surrogate (Knox et al., 2022). Measurement error is ubiquitous in CSS research due to the inherent difficulty of the task (Ziems et al., 2023), unknown social and racial biases in LLMs (Zhao et al., 2018; Bender et al., 2021), and performance sensitivity to classifiers or prompt engineering (Perez et al., 2021; Zhao et al., 2021). Ignoring measurement error leads to estimator bias and invalid confidence intervals in downstream statistical analyses even when the surrogate labels are extremely accurate. In a simulated example (shown in Figure 1-(a)), even with surrogate accuracy of 90%, the bias is substantial and the coverage of a 95% confidence interval is only 40% in downstream regression. This is a fatal flaw in the

Figure 1: **Overview of the Problem and Design-based Supervised Learning (DSL)**

social sciences, where estimated effects are generally small--such that even low measurement error can overturn scientific conclusions--and valid uncertainty quantification is _essential_ to distinguish signal from noise.

We propose a method to use surrogate labels as outcomes for common statistical analyses in the social sciences while guaranteeing consistency, asymptotic normality and valid confidence intervals. We assume a setting where the analyst has a large collection of documents and is interested in a regression of some text-based outcome on some known document-level characteristics. We observe imperfect surrogate labels for all documents and can choose to sample a small number of documents with known probability for an expert to annotate yielding gold-standard labels. Our proposed estimator, _design-based supervised learning_ (DSL), combines the surrogate and gold-standard labels to create _a bias-corrected pseudo-outcome_, which we use in downstream statistical analyses (see Figure 1-(b)). The proposed DSL estimator is consistent and asymptotically normal, and its corresponding confidence interval is valid, _without any further modeling assumptions even when the surrogates are arbitrarily biased_. While we do not require accurate surrogates, as their accuracy improves, the efficiency of the DSL increases. These strong theoretical guarantees only require that the sampling probability of the documents selected for gold-standard be known and be bounded away from zero. Both conditions are straightforward to guarantee by design in many social science applications where the whole corpus is available in advance, which gives the name, _design-based_ supervised learning.

After describing our contributions and related work, we formally characterize the problem setting (Section 2). In Section 3, we describe existing approaches including (i) using the surrogates ignoring the measurement error, (ii) using only gold-standard labels and ignoring the surrogates, and (iii) the conventional supervised approaches which use both. In Section 4, we describe our proposed method and prove its theoretical properties. Section 5 benchmarks our method against existing approaches in 18 diverse datasets, demonstrating that DSL is competitive in root mean squared errors while consistently delivering low bias and proper coverage. See Table 1 for a summary. Section 6 concludes with a discussion of limitations.

Contributions.We propose a unified framework for using imperfect surrogate labels in downstream statistical analyses which maintains the CSS priority for unbiasedness and proper coverage. We exploit three features of text-labeling tasks in social science: researchers often control the probability of sampling documents for gold-standard labeling, the accuracy of surrogate labels will likely keep increasing, and most quantities of interest can be written as a regression (i.e. not requiring individual labels). We (1) provide a new estimator, (2) prove strong theoretical guarantees, including consistency and proper asymptotic coverage, without requiring the accuracy of the surrogate or the correct specification of the underlying supervised machine learning estimator, (3) offer extensions to a broad range of moment-based estimators, and (4) demonstrate finite sample performance across 18 datasets which leverage LLMs for surrogate annotation. Our framework provides a theoretically-sound, design-based strategy for downstream analyses.

Related Work.In the text as data literature, there is limited work on addressing measurement error in regressions with predicted outcomes (although see, Bella et al., 2014; Wang et al., 2020; Zhang, 2021). Existing approaches use a separate gold-standard sample to estimate the error rate and perform a post-hoc correction to the regression. This is related to approaches for calibrating a classifier (Platt, 1999; Zhang, 2021). The related literature on _quantification_ seeks to characterize

    &  &  \\  Method & No Gold-Standard & Consistency & Coverage & Low RMSE \\  Surrogate Only (SO) & \(\) & ✗ & ✗ &? \\ Gold-Standard Only (GSO) & ✗ & \(\) & \(\) & ✗ \\ Supervised Learning (SL) & ✗ & ✗ & ✗ &? \\
**Design-Based SL (DSL)** & ✗ & \(\) & \(\) &? \\   

Table 1: **Design-based Supervised Learning (DSL) compared with existing approaches.** The statistical properties are compared under settings where researchers control the probability of sampling documents for gold-standard labeling, while no additional assumptions about fitted supervised machine learning models are made. RMSE is marked as indeterminate (?) since the relative order between SO, SL, and DSL depends on the amount of bias specific to applications.

the share of documents in each class and thus corresponds to the intercept-only regression model with a categorical outcome [Forman, 2005, Gonzalez et al., 2017]. The quantification literature has historically combined this task with domain shift since otherwise the mean of the training data is an extremely strong baseline [Hopkins and King, 2010, Keith and O'Connor, 2018, Card and Smith, 2018, Jerzak et al., 2023]. Our approach encompasses the quantification problem without domain shift (an intercept-only regression) and can handle cases where quantification is used to model different subgroups of the data that are available at training time (using regression).

Our proposed method also draws upon the large literature on double/debiased machine learning and doubly-robust estimation for missing data and causal inference [Robins et al., 1994, Laan and Robins, 2003, Chernozhukov et al., 2018a, Kennedy, 2022]. In particular, our use of bias-corrected pseudo-outcomes builds on foundational results on semiparametric inference with missing data [Robins and Rotnitzky, 1995, Tsiatis, 2006, Rotnitzky and Vansteelandt, 2014, Davidian, 2022] and the growing literature on doubly robust estimators for surrogate outcomes [Kallus and Mao, 2020] and semi-supervised learning [Chakraborty and Cai, 2018, Chakraborty et al., 2022]. A similar framework of using doubly robust estimation to debias measurement errors has also been recently used in other application areas [Angelopoulos et al., 2023, Mozer and Miratrix, 2023]. Like these papers, we exploit the efficient influence function to produce estimators with reduced bias.

Finally, we join an increasing number of papers that explore a variety of different uses of large language models for social science questions [Ornstein et al., 2022, Gilardi et al., 2023, Velez and Liu, 2023, Wu et al., 2023, Ziems et al., 2023]. Our work, in particular, focuses on how to correct biases and measurement errors in outputs from large language models in order to perform valid downstream statistical analyses. We also contribute to the growing literature on using predicted variables in downstream statistical analyses in the social sciences [Fong and Tyler, 2021, Knox et al., 2022, Katsumata and Yamauchi, 2023].

## 2 The Problem Setting and Design-based Sampling

Consider the case where a researcher wants to classify documents into a binary outcome \(Y\{0,1\}\) and then regress this outcome on some explanatory variables \(X^{dx}\) using a logistic regression (we consider extensions to non-binary outcomes and more general moment-based estimators below).

Suppose we have \(n\) independent and identically distributed samples of documents. For all documents, we observe surrogate labels \(Q^{d_{Q}}\), optional additional meta-data about the documents, \(W^{d_{}}\), which might be predictive of \(Y\), and explanatory variables \(X\) to be included in our regression. We assume the outcome is costly to measure and we can choose to have an expert annotate a subset of the documents to provide the gold-standard \(Y\). We use a missing indicator \(R_{i}\{0,1\}\) to denote whether document \(i\) is labeled by experts (\(R_{i}=1\)) or not (\(R_{i}=0\)). Therefore, we observe the data \(\{R_{i},R_{i}Y_{i},Q_{i},W_{i},X_{i}\}_{i=1}^{n}\), and the total number of gold-standard documents is given by \(n_{R}=_{i=1}^{n}R_{i}\). We use \((Q_{i},W_{i},X_{i}):=(R_{i}=1 Q_{i},W_{i},X_{i})\) to denote the probability of sampling document \(i\) for gold-standard labeling. Formally, we assume that the sampling probability for gold-standard labeling is _known_ and bounded away from zero.

**Assumption 1** (**Design-based Sampling for Gold-Standard Labeling**):

_For all \(i\), \((Q_{i},W_{i},X_{i})\) is known to researchers, and \((Q_{i},W_{i},X_{i})>0\)._

The assumption holds when the researcher directly controls the sampling design. For example, if a researcher has 10000 documents and samples 100 of them to expert-annotate at random, \(==.01\) for all documents. We also allow more complex stratified sampling schemes (shown later in our applications) and can cover any case where the sampling depends on the surrogates, optional covariates or, explanatory variables such that \((Q_{i},W_{i},X_{i})\) is known. Restricting ourselves to this sampling mechanism allows us to guarantee, \(Y\!\!\! R Q,W,X\). This assumption does rule out some applications--such as instances of domain shift where documents from the target population are not available at annotation time--but captures most social science research applications where researchers need to annotate a corpus of documents which is available in total from the outset.

Our estimand of interest is the coefficients of the oracle logistic regression \(^{*}^{dx}\), which is a solution to the following moment equations.

\[\{(Y-(X^{}))X\}=0, \]where \(()\) is the inverse of the logit function. \(^{*}\) is defined as the solution to the moment equations above. Here, \(^{*}\) is seen as a low-dimensional summary, and thus, this paper does not assume the underlying data-generating process follows the logistic regression.

## 3 Existing Approaches: Their Methodological Challenges

Because we do not observe \(Y\) for all documents, we cannot directly solve equation (1) to estimate \(^{*}\). This motivates the three existing strategies that researchers use in practice: using only the surrogate, using only the subset of documents that have gold-standard annotations, and using a conventional supervised learning approach. None of these approaches attain asymptotically unbiased estimation with proper coverage under minimal assumptions while also using surrogate labels to increase efficiency.

Surrogate Only Estimation (SO)The most common approach in practice is to replace \(Y\) with one of the surrogate labels ignoring any error. While we have motivated this with LLM-generated labels, this can be generated by any previously trained classifier, an average of labels produced from multiple LLMs/prompts, or any other strategy not using the gold-standard data. For example, researchers can construct LLM-based text label \(Q_{i}\) as a surrogate for the outcome \(Y_{i}\) in each document \(i\), and then they can run a logistic regression regressing \(Q_{i}\) on \(X_{i}\).

The appeal of this approach is that it uses all documents \(n\) for downstream analyses. This method is consistent with valid confidence intervals only when measurement errors are random and mean-zero conditional on \(X\), which is rarely the case in practice. Recent papers have evaluated LLMs and concluded that the predictions are 'accurate enough' to use without correction in at least some settings (Omstein et al., 2022; Ziems et al., 2023; Tornberg, 2023; Gilardi et al., 2023). However as we saw in Figure 1-(a) even substantially more accurate LLM predictions can lead to non-trivial error.

Gold-Standard Only Estimation (GSO)Even if the researcher wants to use a surrogate, they presumably produce gold-standard annotations for a subset of documents to evaluate accuracy. The simplest approach of obtaining valid statistical inference is to use only this gold-standard data, ignoring documents that only have a surrogate label. Regressing \(Y_{i}\) on \(X_{i}\) only using gold-standard data with weights \(1/(Q_{i},W_{i},X_{i})\) is equivalent to solving the following moment equations,

\[_{i:R_{i}=1},W_{i},X_{i})}(Y_{i}-(X_{i}^{ }))X_{i}=0, \]

where the summation is taken only over documents with \(R_{i}=1\). Regular M-estimation theory shows that the estimated coefficients are consistent and their corresponding confidence intervals are valid (van der Vaart, 2000). The key limitation of this approach is that it ignores the surrogate labels which, while biased, can help improve efficiency.

Supervised Learning (SL)Some researchers combine gold-standard data and LLMs-based surrogate outcomes in supervised learning (e.g., Wang et al., 2020; Zhang, 2021). While the exact implementation varies, we consider a most common version of this strategy where researchers fit a black-box supervised machine learning model to predict \(Y\) with \((Q,W,X)\) using the gold-standard data. Then, using the fitted supervised machine learning model, \((Q_{i},W_{i},X_{i})\), researchers predict labels for the entire documents and use the predicted label as the outcome in downstream logistic

   \(Y_{i}\) & Outcome, which is observed for documents labeled by experts. \\ \(X_{i}\) & Explanatory variables we include in downstream regression analysis. \\ \(\) & Coefficients of the downstream regression analysis. Our main estimand of interest. \\ \(Q_{i}\) & Surrogate outcome (e.g., LLM annotation). \\ \(W_{i}\) & Optional covariates that are predictive of \(Y\). \\ \(R_{i}\) & Missing indicator, indicates whether we sample document \(i\) for gold-standard labeling. \\ \((Q_{i},W_{i},X_{i})\) & Prob. of sampling document \(i\) for gold-standard labeling depending on \((Q_{i},W_{i},X_{i})\). \\ \((Q_{i},W_{i},X_{i})\) & Estimated supervised machine learning model predicting \(Y\) as a function of \((Q_{i},W_{i},X_{i})\). \\   

Table 2: **Summary of Our Notation.**regression. This is equivalent to solving the moment equation,

\[_{i=1}^{n}((Q_{i},W_{i},X_{i})-(X_{i}^{}))X_{i }=0. \]

Researchers can combine this with sample-splitting or cross-fitting to avoid overfitting bias. This estimation method is consistent only when \(g(Q_{i},W_{i},X_{i})\) is correctly specified and consistent to the true conditional expectation \((Y Q,W,X)\) in \(L_{2}\) norm, i.e., \(||(Q,W,X)-(Y Q,W,X)||_{2}=o_{p}(1)\) as sample size \(n\) goes to infinity. This assumption is trivial when the surrogate is binary and there are no covariates, but implausible in more general settings. More problematically, in general, this estimator cannot provide valid confidence intervals due to regularization bias, even when the underlying machine learning model is correctly specified (Chernozhukov et al., 2018).

What we call SL here is a broad class of methods. It includes as special cases the surrogate only estimator (\((Q_{i},W_{i},X_{i})=Q_{i}\)) and classical supervised learning with crossfitting (here there is no \(Q_{i}\) and we predict using other document features \(W_{i}\) and \(X_{i}\)). With appropriate modification, it also includes post-hoc corrections using a gold-standard set as in Levy and Kass (1970); Hausman et al. (1998); Wang et al. (2020); Zhang (2021). All of these strategies are expected to perform well in terms of RMSE. However, for these methods to be consistent, they need to assume the correct specification of the estimator for \(g\), which is often implausible in social science applications. Even under such an assumption, they do not provide valid confidence intervals or p-values, unless other additional stringent assumptions are imposed.

## 4 Our Proposed Estimator: Design-based Supervised Learning

No existing strategy meets our requirements of asymptotically unbiased estimation with proper coverage while also efficiently using the surrogate labels. Design-based supervised learning (DSL) improves upon the conventional supervised learning procedure (which is not generally consistent and does not provide valid confidence intervals) by using a bias-corrected pseudo-outcome in downstream statistical analyses (summarized in Definition 1 and Algorithm 1).

For the proposed DSL estimator, we employ a \(K\)-fold cross-fitting procedure (Chernozhukov et al., 2018). We first partition the observation indices \(i=1,,n\) into \(K\) groups \(_{k}\) where \(k=1,,K\). We then learn the supervised machine learning model \(_{k}\) by predicting \(Y\) using \((Q,W,X)\) using all expert-coded documents _not_ in \(_{k}\). We then define a bias-corrected pseudo-outcome \(_{i}^{k}\) for observations in \(_{k}\) as follows.

\[_{i}^{k}_{k}(Q_{i},W_{i},X_{i})+} {(Q_{i},W_{i},X_{i})}(Y_{i}-_{k}(Q_{i},W_{i},X_{i})). \]

This pseudo-outcome can be seen as the sum of the predicted labels \(_{k}(Q_{i},W_{i},X_{i})\) (the same as in the conventional supervised learning) and the bias-correction term \(}{(Q_{i},W_{i},X_{i})}(Y_{i}-_{k}(Q_{i},W_{i},X_{i}))\). Our use of the pseudo-outcome builds on a long history of the doubly robust methods (e.g., Robins et al., 1994; Rotnitzky and Vansteelandt, 2014; Chakraborty et al., 2022).

This bias-correction step guarantees that the conditional expectation \(_{k}(^{k} Q,W,X)\) is equal to the true conditional expectation \(_{k}(Y Q,W,X)\) under Assumption 1, even when the supervised machine learning estimator \(\) is misspecified. Here we use \(_{k}\) to denote the expectation over \(_{k}\), which is independent of data used to learn \(_{k}\) in cross-fitting.

\[_{k}(^{k} Q,W,X)  _{k}(_{k}(Q,W,X)+ (Y-_{k}(Q,W,X))\,Q,W,X)\] \[= _{k}(RY Q,W,X)}{(Q,W,X)}+( 1-_{k}(R Q,W,X)}{(Q,W,X)})_{k}(Q,W,X)\] \[= _{k}(Y Q,W,X)\]

where the first line follows from the definition of the pseudo-outcome and the second from the rearrangement of terms. The final line follows because \(_{k}(RY Q,W,X)=_{k}(R Q,W,X) _{k}(Y Q,W,X)\) based on Assumption 1, and \(_{k}(R Q,W,X)=(Q,W,X)\) by definition. Importantly, this equality does not require any assumption about the supervised machine learning method \(_{k}(Q,W,X)\) or about measurement errors. The proposed DSL estimator exploits this robustness of the bias-corrected pseudo-outcome to the misspecification of \((Q,W,X)\).

**Definition 1** (Design-based Supervised Learning Estimator): _We first construct the bias-corrected pseudo-outcome \(_{i}^{k}\) as in equation (4) using K-fold cross-fitting. Then, we define the design-based supervised (DSL) estimator for logistic regression coefficient \(\) to be a solution to the following moment equations._

\[_{k=1}^{K}_{i_{k}}(_{i}^{k}-(X_ {i}^{}))X_{i}=0. \]

```
Inputs: Data \(\{R_{i},R_{i}Y_{i},Q_{i},W_{i},X_{i}\}_{i=1}^{n}\), Known gold-standard probability \((Q_{i},W_{i},X_{i})\) for all \(i\). Step 1: Randomly partition the observation indices into \(K\) groups \(_{k}\) where \(k=1,,K\). Step 2: Learn \(_{k}\) from gold-standard documents not in \(_{k}\) by predicting \(Y\) with \((Q,W,X)\) Step 3: For documents \(i_{k}\), construct the bias-corrected pseudo-outcome \(_{i}^{k}\) (see equation (4)) Step 4: Solving the logistic regression moment equation by replacing \(Y_{i}\) with \(_{i}^{k}\) (see equation (5)) Outputs: Estimated coefficients \(\) and Estimated variance-covariance matrix \(\)
```

**Algorithm 1** Design-based Supervised Learning

Proposition 1 (proof in supplement) shows that the DSL estimator is consistent and provides valid confidence intervals when the gold-standard probability is known to researchers, without requiring the correct specification of the supervised machine learning method.

**Proposition 1**: _Under Assumption 1, when the DSL estimator is fitted with the cross-fitting approach (Algorithm 1), estimated coefficients \(\) are consistent and asymptotically normal._

\[(-^{*})(0,V) \]

_In addition, the following variance estimator \(\)is consistent to \(V\), that is, \(V\), where_

\[  }^{-1}}^{- 1},\ \ }_{i=1}^{n}(X_ {i}^{})(1-(X_{i}^{})))X_{i}X _{i}^{},\] \[  _{k=1}^{K}_{i_{k}}( _{i}^{k}-(X_{i}^{}))^{2}X_{i}X_{i}^{}.\]

This proposition highlights the desirable theoretical properties of DSL relative to alternatives. First, the estimators of coefficients are consistent, and asymptotic confidence intervals are valid. These results hold even when \(g\) is arbitrarily misspecified as long as it does not diverge to infinity. This is unlike the SL approach which requires that \(g\) is correctly specified and is consistent to the true conditional expectation \((Y|Q,W,X)\). Second, even when LLMs-based labels are arbitrarily biased, such biased measures do not asymptotically bias final estimates of coefficients \(\). Therefore, unlike the SO approach, researchers can use LLMs-based labels and retain theoretical guarantees even when there is a concern of differential measurement errors. Finally, the asymptotic variance \(V\) decreases with the accuracy of the surrogate labels, allowing for use of non-gold-standard data unlike GSO.

These powerful theoretical guarantees mainly come from the _research design_ where researchers know and control the expert-coding probability \((Q,W,X)\). The well known double/debiased machine learning framework mostly focuses on settings where the expert-coding probability \(\) is unknown and needs to be estimated from data. In such settings, researchers typically need to assume (i) estimation of nuisance functions, such as \(g\) and \(\), is correctly specified and consistent to the true conditional expectations, and (ii) they satisfy particular convergence rates, e.g., \(o_{p}(n^{-0.25})\). We do not require either assumption because we exploit the research design where the expert-coding probability \((Q,W,X)\) is known.

Extension: Method of Moment EstimatorOur proposed DSL estimator can accommodate any number of surrogate labels and a wide range of outcome models that can be written as a class of moment estimators with what we will call _design-based moments_. Importantly, many common estimators in the social sciences, including measurement, linear regression, and logistic regression, can be written as the method of moment estimator. In general, suppose researchers are interested in a method of moment estimator with a moment function \(m(Y,Q,W,X;,g)\) where \((Y,Q,W,X)\)are the data, \(\) are parameters of interest, and \(g\) is the supervised machine learning function. Then, the estimand of interest \(_{M}^{*}\) can be written as the solution to the following moment equations. \((m(Y,Q,W,X;,g^{*}))=0\), where \(g^{*}\) is the true conditional expectation \((Y Q,W,X)\). We define the moment function to be _design-based_ when the moment function is insensitive to the first step machine learning function.

**Definition 2** (Design-based Moments): _A moment is design-based when \((m(Y,Q,W,X;,g))=(m(Y,Q,W,X;,g^{}))\) for any \(\) and any machine learning functions \(g\) and \(g^{}\) that do not diverge._

Note that the design-based moment is most often a doubly robust moment, and Chernozhukov et al. (2022) provide a comprehensive theory about doubly robust moments. In this general setup, the DSL estimator \(_{M}\) is a solution to the following moment equation.

\[_{k=1}^{K}_{i_{k}}m(Y_{i},Q_{i},W_{i},X_{i};, _{k})=0. \]

**Proposition 2**: _Under Assumption 1, when the DSL estimator with a design-based moment is fitted with the cross-fitting approach, \(_{M}\) is consistent and asymptotically normal._

We provide the proof and the corresponding variance estimator in the appendix.

## 5 Experiments

In this section, we verify that our theoretical expectations hold in 18 real-world datasets. We compare DSL and all three existing approaches, demonstrating that only DSL and GSO meet the standard for bias and coverage, while DSL improves efficiency. We use generalized random forests via grf package in R to estimate \(g\) function (Tibshirani et al., 2022) and all cross-fitting procedures use five splits. A comparison to Wang et al. (2020) is included in the supplement.

Logistic Regression in Congressional Bills DataWe use data from the Congressional Bills Project (CBP, Adler and Wilkerson, 2006) to construct a benchmark regression task. CBP is a database of 400K public and private bills introduced in the U.S. House and Senate since 1947. Each bill is hand-coded by trained human coders with one of 20 legislative topics. Our downstream analysis is a logistic regression to examine the association between whether a bill is labeled Macroeconomy (\(Y\)) and three traits of the legislator proposing the bill (\(X\))--whether the person is a senator, whether they are a Democrat, and the DW-Nominate measure of ideology (Lewis et al., 2023). For our simulations, we use 10K documents randomly drawn from documents labeled with the Macroeconomy (the positive class), or the Law and Crime, Defense and International Affairs topics (reflecting that the negative class is often diverse). We consider two scenarios: in the balanced condition, there are 5K documents in each class. In the imbalanced condition, there are 1K documents in the positive class and 9K documents in the negative class. For surrogate labels (\(Q\)), we include zero-shot predictions using GPT-3 (Brown et al., 2020) which achieves accuracy of 68% (balanced) and 90% (imbalanced). As an additional document-covariate (\(W\)), we include the cosine distance between embeddings of the document and the class description using MPnet (Reimers and Gurevych, 2019; Song et al., 2020). Additional details and experiments using five-shot predictions are included in the appendix.

Figure 2 compares the performance of our four estimators on bias, coverage and RMSE. As expected, only GSO and DSL perform well on bias and achieve nominal coverage. While SL is able to achieve better RMSE at these sample sizes, DSL achieves a 14% gain in RMSE over GSO (balanced condition) as shown in Figure 3. This increases to 31% in the five-shot results. The empirical result accords with the theory: only DSL and SO provide a low-bias estimator achieving nominal coverage and DSL is notably more efficient.

Class Prevalence EstimationZiems et al. (2023) evaluate zero-shot performance of a variety of LLMs on 24 diverse CSS benchmark tasks including detection tasks for emotion, hate-speech, ideology and misinformation. They, like others (e.g. Ornstein et al., 2022; Gilardi et al., 2023) make a qualified recommendation for zero-shot classification only (our SO estimator) in research-grade settings noting that "In some lower-stakes or aggregate population analyses, 70% [accuracy] may be a sufficient threshold for direct use in downstream analyses" (Ziems et al., 2023, p. 13). We evaluate on the 17 datasets in their Table 3 using flan-ul2 (Chung et al., 2022) as the surrogate which is one of the highest performing LLMs in their study. Because there are no consistent covariates for these studies, we focus on class prevalence estimation--the simplest case of our regression setting.

Figure 3: **Improvement of DSL over GSO.** Both DSL and GSO attain asymptotic unbiasedness and proper coverage. Here we show the gain in efficiency for DSL over GSO in the balanced condition. As the quality of the surrogate rises (here as we move from the 0-shot to 5-shot setting) the efficiency gain from DSL grows.

Figure 2: **Logistic regression estimation with Congressional Bills Project Data.** Results for a three variable logistic regression model of a binary outcome indicating whether a bill is about Macroeconomy. Bias shows the standardized root mean squared bias (averaged over the three coefficients). Coverage shows proportion of \(95\%\) confidence intervals covering the truth. RMSE plots the average RMSE of the coefficients on a log scale. Each sampled dataset contains 10K datapoints with the X-axis providing gold-standard sample size. We average over 500 simulations at each point. Only DSL and GSO are able to achieve proper coverage, but DSL is more efficient.

Table 3 shows the results for \(n=100\) gold-standard labels (analyses at different \(n\) in the supplement) ordered by the accuracy of the LLM surrogate. As with the logistic regression our theoretical expectations hold. Even for surrogate labels above \(70\%\) accuracy, the SO estimator has high bias and consequentially poor coverage for this aggregate quantity. Using only 100 gold-standard annotations, DSL is able to achieve very low bias and nominal (or near nominal) coverage with consistent gains in RMSE compared to GSO (the only other estimator to attain acceptable bias and nominal coverage). Importantly, the RMSE of DSL is also comparable to SL.

## 6 Discussion

We have introduced a design-based supervised learning estimator which provides a principled framework for using surrogate labels in downstream social science tasks. We showed competitive performance across 18 diverse CSS classification tasks with LLM surrogates, providing low bias and approximately nominal coverage, while achieving RMSE comparable to existing alternatives that focus only on prediction without inferential guarantees. Our approach works for any predicted outcome used in a downstream task [see e.g. Wang et al., 2020, for several examples across fields].

Limitations.We briefly describe three limitations of our work. First, DSL is focused on a very specific setting: outcome variables used in a regression where researchers need to annotate a corpus of documents _available from the outset_. This is a common setting in social science, but not a universal one: we might use text as a predictor [Fong and Tyler, 2021, Katsumata and Yamauchi, 2023], require individual document classifications, or have domain shift in the target population. Second, you need a way to construct gold-standard labels. This will often be naturally accessible using data that might otherwise be used to evaluate accuracy of the classifier. Like any method using gold-standard labels, DSL can be sensitive to the gold-standard being accurate--something which is not always true even in competition test sets and might not even be feasible in some settings. Finally, our method focuses on social science research settings where the researcher's priority is bias and coverage rather than RMSE. As SL explicitly targets RMSE, it may be the better option if that is the primary consideration. We often find that the RMSE tradeoff is small in order to have low bias and nominal coverage.

Future Work.In future work we plan to explore the entire analysis pipeline including improvements to prompt engineering and the implications of conditioning prompt engineering on preliminary assessments of performance. This paper assumed the probability of gold-standard labeling is given, but a natural future extension is to consider optimal sampling regimes for the gold-standard data.

   &  &  &  &  \\  &  &  &  &  &  &  &  &  &  &  &  &  &  &  &  &  &  &  \\  Misinfo. (2) & 500 & 77.6 & 77.4 & 9.0 & 0.0 & 0.2 & 0.0 & 0.6 & 94.8 & 95.2 & 96.2 & 9.2 & 5.0 & 4.3 & 4.3 \\ Emotion (6) & 498 & 70.3 & 70.1 & 2.0 & 0.1 & 0.6 & 0.1 & 67.2 & 94.2 & 91.3 & 94.0 & 2.9 & 3.7 & 3.2 & 3.2 \\ Figur. (4) &AcknowledgmentsWe are very grateful to Amir Feder for excellent feedback on an earlier draft. Research reported in this publication was supported by the Department of Political Science at Columbia University, the Data-Driven Social Science Initiative at Princeton University, and Princeton Research Computing.