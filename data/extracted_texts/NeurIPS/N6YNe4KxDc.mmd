# Online Learning under

Adversarial Nonlinear Constraints

Pavel Kolev\({}^{1}\)

Georg Martius\({}^{1,2}\)

Michael Muehlebach\({}^{1}\)

\({}^{1}\)Max Planck Institute for Intelligent Systems, Tubingen, Germany

\({}^{2}\)University of Tubingen, Tubingen, Germany

{pavel.kolev, georg.martius, michael.muehlebach}@tuebingen.mpg.de

###### Abstract

In many applications, learning systems are required to process continuous non-stationary data streams. We study this problem in an online learning framework and propose an algorithm that can deal with adversarial time-varying and nonlinear constraints. As we show in our work, the algorithm called Constraint Violation Velocity Projection (CVV-Pro) achieves \(\) regret and converges to the feasible set at a rate of \(1/\), despite the fact that the feasible set is slowly time-varying and a priori unknown to the learner. CVV-Pro only relies on local sparse linear approximations of the feasible set and therefore avoids optimizing over the entire set at each iteration, which is in sharp contrast to projected gradients or Frank-Wolfe methods. We also empirically evaluate our algorithm on two-player games, where the players are subjected to a shared constraint.

## 1 Introduction

Today's machine learning systems are able to combine computation, data, and algorithms at unprecedented scales, which opens up new and exciting avenues in many domains, such as computer vision, computer graphics, speech and text recognition, and robotics (Jordan and Mitchell, 2015). One of the leading principles that has enabled this progress is the focus on relatively simple pattern recognition and empirical risk minimization approaches, which mostly rely on offline gradient-based optimization and stipulate that the training, validation, and test data are independent and identically distributed.

Somewhat overlooked in these developments is the role of non-stationarity and constraints (Jordan, 2019). Indeed, emerging machine learning problems involve decision-making in the real world, which typically includes interactions with physical, social, or biological systems. These systems are not only time varying and affected by past interactions, but their behavior is often characterized via fundamental constraints. Examples include cyber-physical systems where constraints are imposed by the laws of physics, multi-agent systems that are subjected to a shared resource constraint, or a reinforcement learning agent that is subjected to safety and reliability constraints. In particular, in their seminal work Auer et al. (2002) gave a reduction for the multi-arm bandit setting to the full information online optimization setting, by employing the multiplicative weights framework (Littlestone and Warmuth, 1994). This classical reduction was recently extended by Sun et al. (2017) to the contextual bandit setting with sequential (time-varying) risk constraints.

This motivates our work, which is in line with a recent trend in the machine learning community towards online learning, adaptive decision-making, and online optimization. More precisely, we study an online problem with slowly time-varying constraints, governed by the following interaction protocol (see Assumption 1.2). In each time step \(t\), the learner commits a decision \(x_{t}\) and then in addition to a loss value \(f_{t}(x_{t})\) with its gradient \( f_{t}(x_{t})\) receives partial information about the current feasible set \(_{t}:=\{x^{n} g_{t}(x) 0\}\), where the constraint function \(g_{t}(x)\) is defined as\([g_{t,1}(x),,g_{t,m}(x)]\). The quality of the learner's decision making is measured, for every \(T 1\), by comparing to the best decision in hindsight \(x_{T}^{}*{arg\,min}_{x_{T}}_{t=1}^{T}f_{t }(x)\), that is,

\[_{t=1}^{T}f_{t}(x_{t})-_{t=1}^{T}f_{t}(x_{T}^{}) g_{T}(x_{T})-},\] (1)

which will be shown to be bounded by \(()\) for our algorithm. The functions \(f_{t}\) and \(g_{t}\) are restricted to \(f_{t}\) and \(g_{t}\) (as defined in Assumption 1.1) and \(c>0\) is an explicit constant.

It is important to note that our performance objective (1) is symmetric in the sense that the constraint \(x_{T}\) applies to both the learner's decision \(x_{T}\) and the benchmark \(x_{T}^{}\). This contrasts prior work by Neely and Yu (2017); Yu et al. (2017); Sun et al. (2017); Chen et al. (2017); Cao and Liu (2019) and Liu et al. (2022), where a different notion of constraint violation \(_{t=1}^{T}g_{t}(x_{t})-c_{0}\) is used for the learner, while either a single benchmark \(x_{1:T}^{}\) satisfies \(g_{t}(x_{1:T}^{}) 0\) for all \(t\{1,,T\}\) or multiple benchmarks \(\{x_{t}^{}\}_{t=1}^{T}\) satisfy \(x_{t}^{}*{arg\,min}_{x_{t}}f_{t}(x)\). Unlike (1), different requirements are imposed on the learner and the benchmark(s), which leads to asymmetric regret formulations: \(_{t=1}^{T}f_{t}(x_{t})-_{t=1}^{T}f_{t}(x_{1:T}^{})\) and \(_{t=1}^{T}f_{t}(x_{t})-_{t=1}^{T}f_{t}(x_{t}^{})\), respectively. Furthermore, as our bound \(g_{T}(x_{T})-c/\) applies for all \(T 1\), it implies the cumulative constraint violation bound in Neely and Yu (2017) up to a constant factor \(_{t=1}^{T}g_{t}(x_{t})-c_{t=1}^{T}1/-2c\).

Even more intriguing is the fact that our algorithm is unaware of the feasible sets a-priori, and obtains, at each iteration, only a local sparse approximation of \(_{t}\) based on the first-order information of the _violated_ constraints. The indices of all violated constraints at \(x_{t}\) will be captured by the index set \(I(x_{t}):=\{i\{1,,m\} g_{t,i}(x_{t}) 0\}\), while \(G(x_{t}):=[ g_{t,i}(x_{t})]_{i I(x_{t})}\) denotes the matrix whose columns store the corresponding gradients. In order to guarantee a regret of \(()\) in (1) we require the following assumptions.

**Assumption 1.1**.: There exist \(R,L_{F},L_{}>0\): **1)**\(\) is a class of convex functions, where every \(f\) satisfies \(|| f(x)|| L_{F}, x_{4R}\), with \(||||\) the \(_{2}\) norm and \(_{R}\) the hypersphere of radius \(R\) centered at the origin; **2)**\(\) is a class of concave \(_{}\)-smooth functions, where every \(g\) satisfies \(|| g(x)|| L_{}, x_{4R}\); **3)** The feasible set \(_{t}\) is non-empty and contained in \(_{R}\) for all \(t\).

We note that these assumptions are standard in online optimization (Hazan, 2016, Ch. 3). The learner's task is nontrivial even in the case where the feasible set is time invariant. If the feasible set is time varying, additional assumptions are required that restrict the amount that the feasible set is allowed to change. These two assumptions, see Part 2 i) and ii) below, are described by the following interaction protocol between the learner and the environment:

**Assumption 1.2**.: (Interaction protocol) At each time step \(t\{1,,T\}\):

**1)** the learner chooses \(x_{t}\);

**2)** the environment chooses \(f_{t}\) and \(g_{t}\) such that i) \(||g_{t}(x)-g_{t-1}(x)||_{}=(1/t)\), uniformly for all \(x_{4R}\), with \(||||_{}\) the \(_{}\) norm, and ii) \(_{t}\) is contained in \(_{t}:=_{=0}^{t-1}_{}\), where \(_{t}:=\{x^{n} G(x_{t})^{}(x-x_{t}) 0\}\) is a cone centered at \(x_{t}\) for \(t 1\) and \(_{0}=^{n}\) (the situation is illustrated in Figure 1, more details are presented in Appendix A);

**3)** the environment reveals to the learner partial information on cost \(f_{t}(x_{t})\), \( f_{t}(x_{t})\) and all violated constraints \(g_{t,i}(x_{t})\), \( g_{t,i}(x_{t})\) for \(i I(x_{t})\).

The requirements i) \(||g_{t}-g_{t-1}||_{}=(1/t)\); and ii) \(_{t}_{t}\) restrict the feasible sets that the environment can choose. We note that despite the fact that \(||g_{t}-g_{t-1}||_{}=(1/t)\), \(||g_{1}-g_{t}||_{}=((t))\), which means that the sequence of functions \(g_{t}\) that defines \(_{t}\) does _not_ converge in general. As a result, \(C_{t}\) may evolve in such a way that the initial iterates \(x_{1},x_{2},,x_{t_{0}}\) achieve a large cost compared to \(_{x_{T}}_{t=1}^{T}f_{t}(x)\), as these are constrained by the sets \(_{1},_{2},,_{t_{0}}\), which may be far away from \(_{T}\). The second requirement ii) \(_{t}_{t}\) avoids this situation and is therefore key for obtaining an \(()\) regret.

Our setup differs from traditional online convex optimization (Zinkevich, 2003) in the following two important ways:

Figure 1: At each time step, the feasible set \(_{t}\) contained in a polyhedral intersection \(_{t}\) changes slightly and is only partially revealed.

i) The environment chooses not only the functions \(f_{t}\) but also the nonlinear constraint functions \(g_{t}\), ii) even if \(g_{t}\) is time-invariant, i.e., \(g_{t}=g\) for all \(t\) the learner has only access to local information about the feasible set.

That is, the information about the feasible set is only revealed piece-by-piece and needs to be acquired by the agent through repeated queries of a constraint violation oracle.

We propose an online algorithm that despite the lack of information about the feasible set, achieves \(()\) regret, and will derive explicit non-asymptotic bounds for the regret and the convergence to \(_{T}\). We thus conclude that our algorithm matches the performance of traditional online projected gradients or Frank-Wolfe schemes, while requiring substantially less information about the feasible set and allowing it to be time-varying. Perhaps equally important is the fact that instead of performing projections onto the full feasible set at each iteration, our algorithm only optimizes over a local sparse linear approximation. If constraints are nonlinear, which includes norm-constraints or constraints on the eigenvalues of a matrix, optimizing over the full feasible set at each iteration can be computationally challenging.

### Related Work

Online learning has its roots in online or recursive implementations of algorithms, where due to the piece-by-piece availability of data, algorithms are often analyzed in a non i.i.d. setting. A central algorithm is the multiplicative weights scheme (Freud and Schapire, 1997), where a decider repeatedly chooses between a finite or countable number of options with the aim of minimizing regret. This online learning model not only offers a unifying framework for many classical algorithms (Blum, 1998), but represents a starting point for online convex optimization Hazan (2016), and adversarial bandits (Lattimore and Szepesvari, 2020). Our approach extends this line of work by allowing the environment to not only choose the objective functions \(f_{t}\), but also the constraints \(g_{t}\). Due to the fact that our learner only obtains local information about the feasible set, our work is somewhat related to Levy and Krause (2019); Lu et al. (2023); Garber and Kretzu (2022); Mhammedi (2022), where the aim is to reduce the computational effort of performing online projected gradient steps or Frank-Wolfe updates. More precisely, Levy and Krause (2019) propose an algorithm that directly approximates projections, while requiring multiple queries of the constraint functions and their gradients. A slightly different constraint violation oracle is assumed in Garber and Kretzu (2022), where the learner can query separating hyperplanes between a given infeasible point and the feasible set. Algorithmically, both Garber and Kretzu (2022) and Levy and Krause (2019) depart from online gradient descent, where the latter computes projections via an approximate Frank-Wolf-type scheme. An alternative is provided by Mhammedi (2022) and Lu et al. (2023), where optimizations over the entire feasible set are simplified by querying only a set membership oracle based on the Minkowski functional. While our approach also avoids projections or optimizations over the entire feasible set, we introduce a different constraint violation oracle that returns a local sparse linear approximation of the feasible set. We call the constraint violation oracle only once every iteration and do not require a two-step procedure that involves multiple oracle calls. In addition, we also allow for adversarial time-varying constraints.

In addition, there has been important recent work that developed online optimization algorithms with constraints. In contrast to the primal formulation of our algorithm, these works are based on primal-dual formulations, where the algorithm is required to satisfy constraints on average, so called long-term constraints. The research can be divided into two lines of work Mahdavi et al. (2012); Jenatton et al. (2016); Yu and Neely (2020) and Yuan and Lamerski (2018); Yi et al. (2021) that use a set of weaker and stricter definitions for constraint violations and investigate time-invariant constraints, which contrasts our formulation that includes time-varying constraints. A third line of work by Mannor et al. (2009); Chen et al. (2017); Neely and Yu (2017); Yu et al. (2017); Sun et al. (2017); Cao and Liu (2019); Liu et al. (2022) focuses on time-varying constraints, where, however, the following weaker notion of constraint violation is used: \(_{t=1}^{T}g_{t}(x_{t})-c\), where \(t\) refers to time and \(x_{t}\) to the learner's decision. This metric allows constraint violations for many iterations, as long as these are compensated by strictly feasible constraints (in the worst case even with a single feasible constraint with a large margin). In contrast, our algorithm satisfies \(g_{t}(x_{t})-c/\) for all iterations \(t\{1,,T\}\), where \(c\) is an explicit constant independent of the dimension of the decision variable and the number of constraints. This means that we can explicitly bound the constraint violation at every iteration, whereas infeasible and strictly feasible iterates cannot compensate each other.

An important distinction to Neely and Yu (2017) is given by our performance metric (see also the discussion in Neely and Yu (2017) and Liu et al. (2022)). On the one hand, the work by Chen et al. (2017); Cao and Liu (2019); Liu et al. (2022) use \(_{t=1}^{T}f_{t}(x_{t})-_{t=1}^{T}f_{t}(x_{t}^{})\) as a performance measure, where the iterates \(x_{t}\) are required to satisfy \(_{t=1}^{T}g_{t}(x_{t})-c\) and the optimal solutions \(x_{t}^{}\) satisfy \(x_{t}^{}*{arg\,min}_{x_{t}}f_{t}(x)\). On the other hand, the work by Neely and Yu (2017); Yu et al. (2017); Sun et al. (2017) use \(_{t=1}^{T}f_{t}(x_{t})-_{t=1}^{T}f_{t}(x_{1:T}^{*})\) as a performance measure, where the iterates \(x_{t}\) are required to satisfy \(_{t=1}^{T}g_{t}(x_{t})-c\) and the optimal solution \(x_{1:T}^{*}\) satisfies \(g_{t}(x_{1:T}^{*}) 0\)_for all \(t\{1,,T\}\)_. This leads to a major asymmetry in the way regret is measured: while the iterates of the online algorithm only need to satisfy a cumulative measure of constraint violation, the benchmark \(x_{1:T}^{*}\), which represents the best fixed decision in hindsight, is required to satisfy _all_ constraints \(g_{t}(x_{1:T}^{*}) 0\) for \(t=\{1,,T\}\). In contrast, the performance metric introduced in (1) is symmetric and imposes the same constraint \(x_{T}\) (approximately) on the learner's decision \(x_{T}\) and (exactly) on the benchmark \(x_{T}^{*}\). These features make our algorithm a valuable addition to the algorithmic toolkit of online constrained optimization.

Castiglioni et al. (2022) studied the following asymmetric setting with adversarial environment, benchmark \(x_{T}^{*}\) belonging to \(*{arg\,min}_{x}_{t=1}^{T}f_{t}(x)\) subject to \(_{t=1}^{T}g_{t}(x) 0\), online iterates \(x_{t}\) satisfying \(_{t=1}^{T}g_{t}(x_{t})-(1/)\), and regret \(_{t=1}^{T}f_{t}(x_{t})-_{t=1}^{T}f_{t}(x_{T}^{*})( )\). Their benchmark and regret formulation can be obtained as a special case of our formulation with time-averaged constraints, that is, when our \(g_{T}(x)\) is chosen as \(_{t=1}^{T}g_{t}(x)\). In contrast, our iterate \(x_{T}\) satisfies \(_{t=1}^{T}g_{t}(x_{T})-(1/)\), a constraint that is asymptotically the same as the one satisfied by the benchmark \(x_{T}^{*}\). We further note that they introduced a parameter \(=_{x}_{t[T]}_{i[m]}g_{t,i}(x)\), which is required to be positive and _known_ to the algorithm for achieving \(()\) regret. Notably \(>0\) implies that the intersection of all feasible sets is non-empty, which is a strong assumption (as is knowledge about the parameter \(\)). In our formulation with _time-averaged_ constraints, Assumption 1.2 reduces to the requirement that the feasible set \(_{t}\) belongs to a polyhedral intersection \(_{t}\), which does not require a non-emtpy intersection of all \(_{t}\) (has a geometrical interpretation and the assumption \(||g_{t}-g_{t-1}||_{}=(1/t)\) is automatically satisfied). Thus, there are situations, where the regret bound from Castiglioni et al. (2022) becomes vacuous (for \(=0\)), while our method still provably achieves \(()\) regret. Additional differences are that Castiglioni et al. (2022) considers primal-dual methods and assumes that all constraints are revealed after every iteration, whereas our method is primal-only and has only partial information about all violated constraints. The latter point reduces computation and simplifies projections onto the velocity polyhedron, but requires a nontrivial inductive argument for establishing \(()\) regret.

Other relevant related studies have investigated online learning problems with supply/budget constraints. In these settings, the decision maker must choose a sequence of actions that maximizes their expected reward while ensuring that a set of resource constraints are not violated. The process terminates either after a pre-specified time horizon has been reached or when the total consumption of some resource exceeds its budget. Badanidiyuru et al. (2018) introduced the bandits with knapsacks framework, which considers bandit feedback, stochastic objective and constraint functions. They proposed an optimal algorithm for this problem, which was later improved by Agrawal and Devanur (2014, 2019) and Immorlica et al. (2022). Immorlica et al. (2022) introduced the adversarial bandits with knapsacks setting and showed that an appropriate benchmark for this setting is the best fixed distribution over arms. Since no-regret is no longer possible under this benchmark, they provide no-\(\)-regret guarantees for their algorithm.

An important special case of our online learning model arises when the environment is represented by an adversarial player that competes with the learner. This corresponds to a repeated generalized Nash game due to the constraint that couples the decisions of the learner and its adversary. If the adversary plays best response, the resulting equilibria are characterized by quasi-variational inequalities (Facchinei and Kanzow, 2007) and there has been important recent work, for example by Jordan et al. (2023); Kim (2021); Facchinei and Kanzow (2010) that proposes different gradient and penalty methods for solving these inequalities. Our approach adopts a different perspective, rooted in online learning, which allows us to derive non-asymptotic convergence results for a first-order gradient-based algorithm that can be implemented in a straightforward manner. Our approach is also inspired by the recent work of Muehlebach and Jordan (2022), who propose a similar algorithm for the offline setting.

### Main Contributions

We give an online optimization scheme under _unknown_ non-linear constraints that achieves an optimal \(()\) regret and converges to the latest feasible set at a rate of \((1/)\). There are two variants of our problem formulation: The first deals with situations where constraints are unknown but fixed, the second allows constraints to be chosen in a time-varying and adversarial manner.

Our algorithm, named Constraint Violation Velocity Projection (CVV-Pro), has the following features:

1. It assumes access to a new type of oracle, which on input \(x_{t}\), returns partial information on all currently violated constraints. Namely, the value \(g_{t,i}(x_{t})\) and the gradient \( g_{t,i}(x_{t})\) for _all_\(i I(x_{t})\).

2. It projects an adversarially generated negative cost gradient \(- f_{t}(x_{t})\) onto a velocity polyhedron \(V_{}(x_{t}):=v^{n}[ g_{i}(x_{t})]^{}v - g_{i}(x_{t}),\; i I(x_{t})}\). Due to the linear and local structure of \(V_{}(x_{t})\), the projection can be computed efficiently.

3. In contrast to standard online methods that project in each round a candidate decision onto the feasible set, our method trades off feasibility for efficiency. In particular, it produces a sequence of decisions that converges at a rate of \((1/)\) to the latest feasible set.

4. Our method handles time-varying adversarial constraints \(g_{t}\), provided a decreasing rate of change \(||g_{t+1}-g_{t}||_{}(1/t)\) and that each feasible set \(_{t}\) belongs to \(_{t}\) (see Assumption 1.2). As we show in Section 3.1, an important special case where the assumption of decreasing rate of change is satisfied is given by \(g_{t}=_{j=1}^{t}_{j}\), i.e., when \(g_{t}\) represents an average of constraints \(_{t}\) over time.

### Outline

Section 2 describes our algorithm and considers the situation where \(g_{t}\) is time invariant. This sets the stage for our main results in Section 3 that provide regret guarantees for our new online convex optimization setting with non-stationary, nonlinear, and unknown constraints. An important and interesting application of our algorithm are generalized Nash equilibrium problems, as will be illustrated with a numerical experiment in Section 4. The experiment will also highlight that the numerical results agree with the theoretical predictions.

## 2 Online learning under unknown, time-invariant, and nonlinear constraints

### Online Gradient Descent

Online gradient descent (Hazan, 2016, Ch. 3.1) is a classical and perhaps the simplest algorithm that achieves optimal \(()\) regret for the setting of a compact, convex, time-invariant, and a priori known feasible set. It consists of the following two operations: i) \(y_{t+1}=x_{t}-_{t} f_{t}(x_{t})\) takes a step from the previous point in the direction of the previous cost gradient; and ii) \(x_{t+1}=_{}(y_{t+1})\) projects \(y_{t+1}\) back to the feasible set \(\), as \(y_{t+1}\) may be infeasible.

In this section, we generalize the online gradient descent algorithm to the setting where the feasible set is unknown a priori and has to be learned through repeated queries of a constraint violation oracle that only reveals local information.

### Overview

In Section 2.3, we present the pseudo code of our algorithm. In Section 2.4, we give a structural result showing that Algorithm 1 under Assumption 1.1 and a bounded iterate assumption guarantees an optimal \(()\) regret and converges to the feasible set at a rate of \((1/)\). In Appendix E, we show that the bounded iterate assumption can be enforced algorithmically, by introducing an additional hypersphere constraint that attracts the sequence \(\{x_{t}\}_{t 1}\) to a fixed compact set.

### Constraint Violation Velocity Projection (CVV-Pro)

We present below the pseudocode of Algorithm 1 for a fixed horizon length \(T\), as it is standard in the literature (Hazan, 2016). However, we note that our algorithm is oblivious to the horizon length \(T\), i.e., it can run for any number of iterations without knowing \(T\) a priori.

Let \(x\) be an arbitrary decision. We show in Claim 2.2 that \((x-x_{t}) V_{}(x_{t})\). Hence, the velocity polyhedron \(V_{}(x_{t})\) is always non-empty and well defined.

### Structural Result

Here, we show that Algorithm 1 under Assumption 1 and a bounded iterate assumption, guarantees an optimal \(()\) regret and converges to the feasible set at a rate \((1/)\). The bounded iterate assumption will be removed subsequently, which however, will require a more complex analysis.

**Theorem 2.1** (Structural).: _Suppose Assumption 1 holds and in addition \(x_{t}_{R}\) for all \(t\{1,,T\}\). Then, on input \(=L_{F}/R\), Algorithm 1 with step sizes \(_{t}=}\) guarantees the following for all \(T 1\):_

_(regret)_ \(_{t=1}^{T}f_{t}(x_{t})-_{x}_{t=1}^{T}f_{t}(x) 18 L_{}R\)_;_

_(feasibility)_ \(g_{i}(x_{t})-8}}{R}+2_{} }{}\)_, for all_ \(t\{1,,T\}\) _and_ \(i\{1,,m\}\)_._

### Proof Sketch of Theorem 2.1

Our analysis establishes, in two steps, an important geometric property that connects the convex costs and the concave constraints via the velocity polyhedron \(V_{}(x_{t})\). More precisely, we show that the inner product \(-r_{t}^{}(x_{T}^{}-x_{t}) 0\) for all \(t\{1,,T\}\). This property will be crucial for deriving the regret and feasibility bounds.

In the first step, we leverage the constraints' concavity and show that the vector \((x_{T}^{}-x_{t})\) belongs to the velocity polyhedron \(V_{}(x_{t})\).

**Claim 2.2**.: _Suppose \(g_{i}\) is concave for every \(i\{1,,m\}\). Then \((x-x_{t}) V_{}(x_{t})\) for all \(x\). In addition, \(x_{t}()\) implies \([ g_{i}(x_{t})]^{}[x-x_{t}] 0\) for all \(x\)._

Figure 2: Illustration of the proposed (CVV-Pro) algorithm. **Left:** the constraint \(g_{t,j}\) is violated by the current solution \(x_{t}\). The cost gradient \(- f_{i}(x_{t})\) is projected onto the hyperplane (moved by \(- g_{i,j}(x_{t})\)) with normal vector \( g_{t,j}(x_{t})\). This yields \(r_{t}\) (see Section 2.5), and results in the velocity projection \(v_{t}\) (\(=1\) for clarity). **Right:** next iteration with updated \(x\), where both \(f\) and \(g\) are changed. Then the procedure is applied recursively.

Proof.: Let \(x\) be an arbitrary feasible decision, satisfying \(g_{i}(x) 0\) for all \(i\{1,,m\}\). Since \(g_{i}\) is concave, we have \(g_{i}(x_{t})+[ g_{i}(x_{t})]^{}[x-x_{t}] g_{i}(x) 0\) and thus \([ g_{i}(x_{t})]^{}[x-x_{t}]-g_{i}(x_{t})\). The second conclusion follows by \(x_{t}()\), which implies \(g_{i}(x_{t}) 0\). 

In the second step, we show that \(r_{t}^{}(x_{t}-x^{}) 0\), where \(r_{t}=v_{t}+ f_{t}(x_{t})\) is such that \(-r_{t}\) belongs to the normal cone \(N_{V_{}(x_{t})}(v_{t})\) of the velocity polyhedron \(V_{}(x_{t})\) evaluated at the projection \(v_{t}\).

**Lemma 2.3** (Main).: _Let \(v_{t}\) be the projection of \(- f_{t}(x_{t})\) onto the polyhedron \(V_{}(x_{t})\) such that \(v_{t}=r_{t}- f_{t}(x_{t}) V_{}(x_{t})\), where \(-r_{t} N_{V_{}(x_{t})}(v_{t})\). Then, \(-r_{t}^{}(x-x_{t}) 0\) for all \(x\)._

Proof.: By definition, the normal cone \(N_{V_{}(x_{t})}(v_{t})\) is given by \(\{u^{n} u^{}(v-v_{t}) 0,\  v V_{}(x_{t})\}\). Then, by construction \(-r_{t} N_{V_{}(x_{t})}(v_{t})\) and thus it holds for every \(v V_{}(x_{t})\) that \(-r_{t}^{}[v-v_{t}] 0\). The proof proceeds by case distinction:

**Case 1.** Suppose \(x_{t}\) is in the interior of \(\). Then, \(I(x_{t})=\), which implies \(- f_{t}(x_{t}) V_{}(x_{t})=^{n}\) and thus \(r_{t}=0\).

**Case 2.** Suppose \(x_{t}\) is on the boundary or outside of \(\), i.e., \(I(x_{t})\). By Claim 2.2, we have \([ g_{i}(x_{t})]^{}[x-x_{t}] 0\) for all \(x\). By construction, \(v_{t} V_{}(x_{t})\) and thus \(v(x)=v_{t}+x-x_{t} V_{}(x_{t})\). The statement follows by applying \(v=v(x)\) to \(-r_{t}^{}[v-v_{t}] 0\). 

Regret.To establish the first conclusion of Theorem 2.1 (regret), we combine the preceding geometric property with the analysis of online gradient descent. Since \(f_{t}\) is convex, we upper bound the regret in terms of the gradient of \(f_{t}\), namely \(_{t=1}^{T}f_{t}(x_{t})-f_{t}(x_{T}^{})_{t=1}^{T}[ f_{t} (x_{t})]^{}(x_{t}-x_{T}^{})\) and then we show that the following inequality holds

\[[ f_{t}(x_{t})]^{}(x_{t}-x_{T}^{})-} {2}\|v_{t}\|^{2} = r_{t}^{}(x_{t}-x_{T}^{})+-x_{T}^{}\|^{ 2}-\|x_{t+1}-x_{T}^{}\|^{2}}{2_{t}}\] (2) \[ -x_{T}^{}\|^{2}-\|x_{t+1}-x_{T}^{}\|^{2}} {2_{t}}.\]

Moreover, in Appendix D (see Lemma D.2), we upper bound the velocity \(\|v_{t}\|\|x_{T}^{}-x_{t}\|+2\| f_{t}(x_{t})\|\). Combining Assumption 1.1 and \(x_{t}_{R}\) yields a uniform bound \(\|v_{t}\|_{}\), where for \(=L_{}/R\) we set \(_{}:=4L_{}\). The desired regret follows by a telescoping argument and by convexity of the cost functions \(f_{t}\).

Feasibility.For the second conclusion of Theorem 2.1 (convergence to the feasible set at a rate of \(1/\)), we develop a non-trivial inductive argument that proceeds in two steps. In Appendix D (see Claim D.6), we give a structural result that bounds the constraint functions from below. In particular, for every \(i I(x_{t})\) we have \(g_{i}(x_{t+1})(1-_{t})g_{i}(x_{t})-_{t}^{2}_{ }^{2}_{}\) and for every \(i I(x_{t})\) it holds that \(g_{i}(x_{t+1})-_{t+1}_{}[2L_{}+ _{}_{}/]\).

Using an inductive argument, we establish in Appendix D (see Lemma D.5) the following lower bound: \(g_{i}(x_{t})-c_{t}\) where \(c=2_{}(L_{}+_{}_{ }/)\). Choosing \(=L_{}/R\) implies that \(_{}=4L_{}\). Then, the desired convergence rate to the feasible set follows for the step size \(_{t}=}\), since

\[-c_{t}=-_{}}{}L_{ }+}_{}}{}=-8 {L_{}}{R}+4_{}}{}.\]

## 3 Online Learning under Adversarial Nonlinear Constraints

### Problem Formulation

In this section, we consider an online optimization problem with adversarially generated time-varying constraints. More precisely, at each time step \(t\), the learner receives partial information on the current cost \(f_{t}\) and feasible set \(_{t}\), and seeks to minimize (1). To make this problem well posed, we restrict the environment such that each feasible set \(_{t}\) is contained in \(_{t}\) (see Section 1) and the rate of change between consecutive time-varying constraints _decreases_ over time. We quantify a sufficient rate of decay with the following assumption.

**Assumption 3.1** (TVC Decay Rate).: We assume that the adversarially generated sequence \(\{g_{t}\}_{t 1}\) of time-varying constraints is such that for every \(x_{4R}\) and all \(t 1\), the following holds \(\|g_{t+1}(x)-g_{t}(x)\|_{}} }{R}+3_{} R^{2}\).

We note that Assumption 3.1 essentially only requires \(\|g_{t+1}(x)-g_{t}(x)\|_{}(1/t)\), as \(R\) can be chosen large enough such that the bound is satisfied. Of course, \(R\) will appear in our regret and feasibility bounds, but it will not affect the dependence on \(t\) or \(T\) (up to constant factors).

An important special case where Assumption 3.1 is satisfied, is summarized in the following Lemma. The proof is included in Appendix F (see Lemma F.7 and Lemma F.8).

**Lemma 3.2**.: _Suppose the functions \(_{t,i}\) satisfy Assumption 1.1 and in addition there is a decision \(x_{t,i}_{R}\) such that \(_{t,i}(x_{t,i})=0\) for every \(t 1\) and \(i\{1,,m\}\). Then the time-averaged constraints \(g_{t,i}(x):=_{=1}^{t}_{,i}(x)\) satisfy Assumption 1.1 and Assumption 3.1._

### Velocity Projection with Attractive Hypersphere Constraint

We show in Appendix E that the second assumption in Theorem 2.1, namely, "\(x_{t}_{R}\) for all \(t 1\)" can be enforced algorithmically. We achieve this in two steps.

1) Algorithmically, we introduce an additional hypersphere constraint \(g_{m+1}(x_{t})=[R^{2}-\|x_{t}\|^{2}]\) that attracts the decision sequence \(\{x_{t}\}_{t 1}\) to a hypersphere \(_{R}\) and guarantees that it always stays inside a hypersphere \(_{4R}\) with a slightly larger radius.

More precisely, we augment the velocity polyhedron in Step 3 of Algorithm 1 as follows: \(V^{}_{}(x_{t})=V_{}(x_{t})\) if \(\|x\| R\), otherwise

\[V^{}_{}(x_{t})=\{v V_{}(x_{t})[ g_{m+1}(x_{t}) ]^{}v- g_{m+1}(x_{t})\}.\]

2) Analytically, we give a refined inductive argument in Appendix F (see Lemma E.5), showing that \(g_{m+1}(x_{t})-27R^{2}/\), \(\|x_{t}\| 4R\) and \(\|v_{t}\| 7L_{}\), for all \(t 1\).

### Main Contribution

Our main contribution is to show that Algorithm 1 with the augmented velocity polyhedron \(V^{}_{}(x_{t})\), achieves optimal \(()\) regret and satisfies \(g_{T}(x_{T})-(1/)\) convergence feasibility rate. Due to space limitations, we defer the proof to Appendix F.

**Theorem 3.3** (Time-Varying Constraints).: _Suppose the functions \(\{f_{t},g_{t}\}_{t 1}\) satisfy Assumptions 1.1, 1.2 and 3.1. Then, on input \(R,L_{}>0\) and \(x_{1}_{R}\), Algorithm 1 applied with \(=L_{}/R\), augmented velocity polyhedron \(V^{}_{}()\) and step sizes \(_{t}=}\) guarantees the following for all \(T 1\):_

 _(regret)_ & \(_{t=1}^{T}f_{t}(x_{t})-_{x_{T}}_{t=1}^{T}f_{t}(x)  246L_{}R\)_;_ \\ _(feasibility)_ & \(g_{t,i}(x_{t})-265}}{R}+4_{}}{}\)_, for all_ \(t\{1,,T\}\) _and_ \(i\{1,,m\}\)_;_ \\ _(attraction)_ & \(g_{m+1}(x_{t})-27}{}\)_, for all_ \(t\{1,,T\}\)_._ \\ 

Our regret analysis in Theorem 3.3 builds upon the following key structural result that generalizes Lemma 2.3 to time-varying constraints. In particular, in Appendix F (see Lemma F.3), we show that given the feasible set \(_{T}_{T}\), it holds for every \(x_{T}\) that \(-r_{t}^{}(x-x_{t}) 0\) for all \(t\{1,,T\}\). As a result, a similar argument as in (2) shows that the regret is bounded by \(()\).

Moreover, we note that the linear and quadratic dependence on \(R\) in Theorem 3.3 is consistent in length units. Let the radius \(R\) be of length units \(\), then the Lipschitz constant \(L_{}\), which can be viewed as the supremum over the \(_{2}\) norm of the gradient is of \(1/\) units, and the \(_{}\) smoothness constant (associated with Hessian) is of \(1/^{2}\) units. This means that the regret bound in Theorem 3.3 has the same units as \(f_{t}\), while the feasibility bound has the same units as \(g_{t}\).

## 4 Simulation examples

Two-player games with shared resources are an excellent example for demonstrating the effectiveness and importance of our online learning framework. We apply our algorithm and show numerical experiments that support our theoretical findings.

We choose random instances of a two player game with linear utility and constraints. In particular, we consider the following optimization problem

\[_{x_{n}}_{y_{n}}x^{}Ay C_{x}x+C_{y}y 1,\] (3)

where \(_{n}=\{x^{n}_{i=1}^{n}x_{i}=1,x 0\}\) is the probability simplex. Each component of the utility matrix \(A^{n n}\) is sampled from the normal distribution and the constraint matrices \(C_{x},C_{y}^{m n}\) have each of their components sampled uniformly at random from \(\).

### Online Formulation

The problem in (3) can be modeled with our online learning framework (1) by choosing costs \(f_{t}(x):=x^{}Ay_{t}\) and time-averaged resource constraints \(g_{T}(x):=_{t=1}^{T}_{t}(x)\), where the function \(_{t}(x):=1-C_{x}x-C_{y}y_{t}\). Thus, the constraint in (3) is included as an average over the past iterations of \(y_{t}\). The strategy for choosing \(y_{t}\) will be described below and, as we will see, the average of \(y_{t}\) over the past iterations converges. This ensures that the feasible set \(_{t}\) (defined in (1)) is slowly time-varying, while the averages of \(x_{t}\) and \(y_{t}\) over past iterates converge to equilibria in (3). Further, by a refined version of Lemma 3.2 (see Lemma F.6 in Appendix F), the time-averaged constraints \(g_{T}(x)\) satisfy Assumption 3.1.

In each iteration, Algorithm 1 seeks to minimize the online problem and commits to a decision \(x_{t}\). The adversary computes the best response \(_{t}\) with respect to the decision \(x_{t}\) by solving \(_{y_{n}}x_{t}^{}Ay\). To make the dynamics more interesting, the adversary then commits with probability 0.8 to \(_{t}\) and with probability 0.2 to a random decision \(_{t}\), i.e., \(y_{t}=0.8_{t}+0.2_{t}\) where the random variable \(_{t}\) is sampled uniformly at random from the probability simplex \(_{n}\).

As both players optimize over the probability simplex (\(x,y_{n}\)), the sequence of decisions \(\{x_{t}\}_{t 1}\) is automatically bounded. Thus, we can apply Theorem 3.3 with the original velocity polyhedron, as discussed in Appendix E. We implemented our algorithm with \(_{t}=1/()\) and \(=100\).

Figure 3: **(Setup)** The CVV-Pro algorithm is executed on five random instances of the two-player game with shared resources (Section 4.1). The thick line is the mean and the thin lines indicate the minimum and the maximum over the five runs. **(a)** The regret follows the predicted \(()\) slope. **(b)** The CVV-Pro algorithm achieves a convergence rate of \((1/)\) for the averaged decisions \(_{t}:=_{t=1}^{t}x_{t}\) towards \(_{}\). In our experiment, we set \(_{}:=_{10000}\). Similar behavior is reported for the averaged decisions \(_{t}\) of the adversary. **(c)** The maximal constraint violation expressed by \(-_{i I\{x_{t}\}}g_{t,i}(x_{t})\) converges at a rate of \((1/)\), as predicted by our theoretical results. **(Compute)** For the implementation of CVV-Pro we have used the MATLAB R2019a numerical computing software. The computation of the experiment takes about 4 hours on a machine with CPU: Intel(R) i7-6800K 3.40 GHz with 6 cores, GPU: NVIDIA GeForce GTX 1080, and RAM: 32 GB.

### Experimental Results

We report results from numerical simulations with decision dimension \(n=100\), \(m=10\) shared resource constraints, \(T=4000\) iterations, and five independently sampled instances of the two-player game. The learner's regret, depicted in Figure 2(a), shows a clear correspondence with the theoretical prediction of \(()\). Figure 2(b) presents the maximal constraint violation \(-_{i I(x_{T})}_{t=1}^{T}_{t,i}(x_{T})\), which follows the predicted \((1/)\) convergence rate. We also conclude from Figure 2(c) that the learner's averaged decisions \(_{T}=_{t=1}^{T}x_{t}\) converge at a rate of \((1/)\). Similarly, the averaged decisions \(_{T}\) of the adversary also converge at a rate of \((1/)\). We note that there is little variability in the results despite the different realizations of the matrices \(A,C_{x},C_{y}\).

Contrasting CVV-Pro and Online Gradient DescentIn Appendix C, we show that our (CVV-Pro) algorithm outperforms the standard Online Gradient Descent algorithm in the two-player game from above. In particular, our algorithm achieves a lower regret and a runtime improvement of about \(60\%\). Further, the percentage of violated constraints decreases rapidly and plateaus at \(20\%\).

The amount of improvement in execution time is likely to be greater for higher-dimensional problems, where fewer constraints tend to be active at each iteration. Moreover, when the constraints are nonlinear, which includes \(_{p}\) norm or spectral constraints, optimizing over the full feasible set can be computationally challenging. In contrast, the velocity projection step in CCV-Pro is always a convex quadratic program with linear constraints, regardless of the underlying feasible set.

## 5 Broader Impact

It is important to emphasize that our work is theoretical, and the main contribution is to design and analyze a novel algorithm that combines techniques from the seemingly distant fields of online convex optimization (online gradient descent) and non-smooth mechanics (velocity space, see Muehlebach and Jordan (2022)). Nevertheless, the list of potential applications includes, but is not limited to: adversarial contextual bandits with sequential risk constraints Sun et al. (2017), network resource allocation Chen et al. (2017), logistic regression Cao and Liu (2019), Liu et al. (2022), ridge regression and job scheduling Liu et al. (2022), two-player games with resource constraints (Section 4), system identification and optimal control (Appendix B).

## 6 Conclusion

We propose an online algorithm that, despite the lack of information about the feasible set, achieves \(()\) regret. We further ensure convergence of violated constraint \(-\{g_{T}(x_{T}),0\}\) at a rate of \((1/)\) and derive explicit constants for all our bounds that hold for all \(T 1\). We thus conclude that our algorithm matches the performance of traditional online projected gradients or Frank-Wolfe schemes, while requiring substantially less information about the feasible set and allowing the feasible set to be time-varying. Perhaps equally important is the fact that instead of performing projections onto the full feasible set at each iteration, our algorithm only optimizes over a local sparse linear approximation. We show the applicability of our algorithm in numeric simulations of random two-player games with shared resources.