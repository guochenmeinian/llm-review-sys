# Sharp Bounds for Generalized Causal Sensitivity Analysis

Dennis Frauen, Valentyn Melnychuk & Stefan Feuerriegel

LMU Munich

Munich Center for Machine Learning

{frauen,melnychuk,feuerriegel}@lmu.de

###### Abstract

Causal inference from observational data is crucial for many disciplines such as medicine and economics. However, sharp bounds for causal effects under relaxations of the unconfoundedness assumption (causal sensitivity analysis) are subject to ongoing research. So far, works with sharp bounds are restricted to fairly simple settings (e.g., a single binary treatment). In this paper, we propose a unified framework for causal sensitivity analysis under unobserved confounding in various settings. For this, we propose a flexible generalization of the marginal sensitivity model (MSM) and then derive sharp bounds for a large class of causal effects. This includes (conditional) average treatment effects, effects for mediation analysis and path analysis, and distributional effects. Furthermore, our sensitivity model is applicable to discrete, continuous, and time-varying treatments. It allows us to interpret the partial identification problem under unobserved confounding as a distribution shift in the latent confounders while evaluating the causal effect of interest. In the special case of a single binary treatment, our bounds for (conditional) average treatment effects coincide with recent optimality results for causal sensitivity analysis. Finally, we propose a scalable algorithm to estimate our sharp bounds from observational data.

## 1 Introduction

Causal effects are crucial for decision-making in many disciplines, such as marketing , medicine , and economics . For example, physicians need to know the treatment effects to personalize medical care, and governments are interested in the causal effects of policies on infection rates during a pandemic. In many such applications, randomized experiments are costly or infeasible, because of which causal effects must be estimated from observational data .

Estimating causal effects from observational data may lead to bias due to the existence of confounders, i.e., variables that affect both treatment and outcome . A remedy is to observe all confounders and thus to assume unconfoundedness (e.g., as in ). However, in many practical applications, the assumption of unconfoundedness is violated. For example, electronic health records do not capture a patient's ethnic background, which is a known confounder in medicine . In such cases, the causal effect is not identified from observational data, and unbiased estimation is thus impossible .

A popular way to perform causal inference in the presence of unobserved confounders is _causal sensitivity analysis_. Causal sensitivity analysis aims to derive bounds on the causal effect of interest under relaxations of the unconfoundedness assumption. Here, the strength of unobserved confounding is typically controlled by some sensitivity parameter \(\), which also determines the tightness of the bounds. In practice, one chooses \(\) through domain knowledge  or data-driven heuristics . Then, one derives that the causal effect of interest lies in some informative region. For example,a suitable \(\) may enable - despite unobserved confounding - to infer the sign of the treatment effect, which is often sufficient for consequential decision-making .

A common model for causal sensitivity analysis is the marginal sensitivity model (MSM) [31; 35; 36; 67]. A benefit of the MSM is that it does not impose any kind of parametric assumptions on the data-generating process. However, the standard MSM is only applicable in settings where the treatment is a single binary variable. Different extensions have been proposed for continuous treatments [10; 32; 45] and for time-varying treatments and confounders . However, these works are restricted to specific settings, while a unified framework for causal sensitivity analysis is still missing.

**Contributions:1** In this paper, we propose a _generalized marginal sensitivity model (GMSM)_. Our GMSM provides a unified framework for causal sensitivity analysis under unobserved confounding in various settings with multiple discrete, continuous, and time-varying treatments. Crucially, our GMSM includes existing models, such as those in  and , as special cases. As a result, our GMSM enables a unified approach to deriving sharp bounds for a large class of causal effects. To do so, we bound a distribution shift in the unobserved confounders while performing an intervention on the treatments. As a result, we obtain sharp bounds for various causal effects, including (conditional) average treatment effects but also effects for mediation analysis and path analysis (see Fig. 1) and for distributional effects, which have not been studied under an MSM-type sensitivity analysis previously. We also show that, for binary treatments, our bounds coincide with recent optimality results for (conditional) average treatment effects under the MSM. Finally, we propose a scalable algorithm to estimate our sharp bounds from observational data and perform extensive computational experiments to show the validity of our bounds empirically.

## 2 Related work

In the following, we review related work on causal sensitivity analysis. For a more general review of partial identification and treatment effect estimation under unconfoundedness, we refer to Appendix A.

**Causal sensitivity analysis:** Causal sensitivity analysis dates back to a study from 1959 showing that unobserved confounders cannot explain away the causal effect of smoking on cancer . This was formalized by introducing _sensitivity models_ that yield bounds on the causal effect of interest under some restriction on the amount of confounding. Previous works introduced a variety of sensitivity models that make different assumptions about the data-generating process and the confounding mechanism. Examples include sensitivity models based on parametric assumptions [30; 62], difference between potential outcome distributions [60; 70], and Rosenbaum's sensitivity model that uses randomization tests .

**Marginal sensitivity model (MSM):** The _marginal sensitivity model (MSM)_ is a common model for sensitivity analysis aimed at settings with binary treatments. Many methods were proposed to estimate bounds from observational data under the MSM. Examples of such methods include linear fractional programs  and machine learning such as including kernel-based methods  and deep neural networks . Recently, Dorn et al.  and Jin et al.  showed that estimates from the previous methods are too conservative bounds and, as a remedy, derived closed-form solutions for sharp bounds under the MSM. This was also extended to semiparametric inference [19; 53]. However, all previous methods are limited to binary treatments and (conditional) average treatment effects.

Different extensions for the MSM have been proposed. Jesson et al. , Bonvini et al. , and Marmarelis et al.  developed extensions for continuous treatments. Furthermore, Bonvini et al.  also extended the MSM to time-varying treatments and confounders. However, both works are _not_ applicable to settings beyond the estimation of (conditional) average treatment effects, such as

Figure 1: Three examples of causal inference settings where our GMSM and bounds are applicable. \(M_{1}\), \(M_{2}\) are mediators, \(Y\) is the outcome, and \(\) and \(\) are (multiple) discrete, continuous, or time-varying covariates and treatments. Variables \(_{W}\) are unobserved confounders between \(\) and \(W\{M_{1},M_{2},Y\}\).

mediation analysis and path analysis or distributional effects. In contrast, we propose a generalized marginal sensitivity model that is compatible with binary, continuous, and time-varying treatments for a variety of causal effects.

**Research gap:** To the best of our knowledge, no existing causal sensitivity analysis based on the MSM provides a unified framework for deriving bounds for binary, continuous, and time-varying treatments. Furthermore, MSM-based causal sensitivity analysis is restricted to (conditional) average treatment effects and is thus _not_ applicable for complex settings such as effects for mediation analysis and path analysis or distributional effects.

## 3 Generalized marginal sensitivity model (GMSM)

We first formally define a general setting for causal sensitivity analysis that includes mediation and path analysis (Sec. 3.1 and Sec. 3.2). We then propose our generalized marginal sensitivity model (GMSM) in Sec. 3.3 and compare it with existing sensitivity models from the literature.

**Notation:** We write random variables as capital letters \(X\) and their realizations in lowercase \(x\). Bold letters \(\) or \(\) represent (random) vectors. If \(=(X_{1},,X_{})\) is a sequence of random variables of length \(\), we denote \(}_{k}=(X_{1},,X_{k})\) for \(1 k\). We denote probability distributions over \(X\) as \(^{X}\) where required. The probability mass function for a discrete \(X\) is denoted as \((x)=(X=x)\). If \(X\) is continuous, \((x)\) is the probability density function. We denote \(()\) as the corresponding probability mass/density function not evaluated at a specific \(x\). Similarly, we write conditional probability mass functions/density functions as \((y x)=(Y=y X=x)\) and conditional expectations as \([Y x]=[Y X=x]= y\,(y x)\, y\). We denote \((y do(X=x))\) as the probability mass function/density function of \(Y\) after performing the do-intervention \(do(X=x)\). Finally, we define \(_{Y}=pa(Y)\), where \(pa(Y)\) denotes the parents of \(Y\) in a given causal graph.

### Problem setup for generalized causal sensitivity analysis

We formalize causal sensitivity analysis based on Pearl's structural causal model framework .

**Definition 1**.: A _structural causal model (SCM)_\(\) is a tuple \(,,,^{}\), where \(=(V_{1},,V_{k})\) are observed endogenous variables, \(\) are unobserved exogenous variables determined outside of the model, \(=\{f_{V_{1}},,f_{V_{k}}\}\) is a set of functions so that each \(f_{V_{i}}\) maps a set of parents \(pa(V_{i})\) to \(V_{i}\), and \(^{}\) is a probability distribution on \(\).

Every SCM \(\) induces unique directed graph2\(_{}\) on \(\) by drawing a directed edge from \(V_{1}\) to \(V_{2}\) if \(V_{1} pa(V_{2})\). In this paper, we assume that \(_{}\) is acyclic, i.e., does not contain any directed cycle. Then, \(\) induces a unique joint probability distribution \(^{}\) on \(\). Furthermore, \(\) induces unique interventional distributions \(^{}_{do(=)}\) when performing the do-intervention \(do(=)\) for some observed treatments \(\)[4; 55].

We consider settings where we observe four distinct types of endogenous variables \(=\{,,}_{}Y\}\): observed confounders \(^{d_{x}}\), treatments \(^{d_{a}}\), discrete mediators \(}_{}=(M_{1},,M_{})\) with \(M_{i}\) for \(1 i\), and an outcome \(Y\). In a medical setting, \(\) might be patient characteristics (gender, age, medical history, etc.), \(\) a medical treatment, \(}_{}\) a change in diet, and \(Y\) a variable indicating a health outcome. Possible causal graphs are shown in Fig. 1. We assume w.l.o.g. that \((M_{1},,M_{})\) are ordered causally, i.e., \(}_{i-1}\) are parents of \(M_{i}\) for each \(i\{2,,\}\). Given treatment interventions \(}_{+1}=(_{1},,_{+1})\), we are interested in causal effects of the form

\[Q(,}_{+1},)=_{}_{ }^{}}(^{Y}(, }_{},do(=_{+1}))_{i=1}^{} (m_{i},}_{i-1},do(=_ {i})),\] (1)

where \(\) is some functional that maps the density \(^{Y}(,,do(=_{+ 1}))\) to a scalar value and we sum over all possible realizations \(}_{}\) of \(}_{}\). We are also interested in averaged causal effects \(_{}Q(,}_{+1},)\,( )\,\) or differences (Appendix D). The effect \(Q(,}_{+1},)\) generalizes many common effects across different causal inference settings.

**Example 1** (CATE, \(=0\)).: If \(=[]\) is the expectation functional, Eq. (1) reduces to \(Q(,,)=\,[Y,do(=)]\). When \(\) is continuous, this is known as the conditional dose-response function . For binary treatments \(\{0,1\}\), the query \(Q(,1,)-Q(,0,)\) is known as the conditional average treatment effect (CATE) , and its averaged version as the average treatment effect (ATE) .

**Example 2** (Mediation analysis, \(=1\)).: If \(=[]\) and \(}_{1}=M\) is a single mediator, Eq. (1) reduces to \(Q(,}_{1},)=_{m}\,[Y ,m,do(=_{2})]\,(m,do( =_{1}))\). If \(A\{0,1\}\) is binary and the \(M\)-\(Y\) relationship is unconfounded, we obtain the following causal effects studied in mediation analysis : \(Q(,(_{1}=0,_{2}=1),)-Q(,( _{1}=0,_{2}=0),)\) is the (conditional) natural direct effect (NDE), and \(Q(,(_{1}=1,_{2}=0),)-Q(,( _{1}=0,_{2}=0),)\) is the (conditional) natural indirect effect (NIE).

In general, Eq. (1) includes so-called _path-specific effects_ if the relationship between mediators and outcome is unconfounded . For example, by setting \(_{1}=1\) and \(_{k}=0\) for all \(2 k+1\), we obtain the indirect effect that is passed through the mediator sequence \((M_{1},,M_{})\). Path-specific effects are important in various applications, including algorithmic fairness, where the aim is to mitigate effects through paths that are considered unfair . Furthermore, we can set \(\) to a quantile instead of using the mean in all the examples above. This results in _distributional_ versions of CATE, NDE, NIE, and path-specific effects. For example, if the outcome distribution is skewed or contains outliers, practitioners might prefer the median or other quantiles over the mean due to their robustness properties .

If all confounders between treatment and mediators and outcome were observed, we could (under additional assumptions) identify the causal effect \(Q(,}_{+1},)\) from the observational distribution \(^{}\) on \(\) by replacing all \(do\)-operations with conditional probabilities according to the backdoor criterion . However, under unobserved confounding, identifiability is not possible because SCMs \(\) and \(^{}\) exist, which induce the same observational distribution \(^{}\), but which result in different causal effects \(Q(,}_{+1},) Q(,}_{+1},^{})\).

### Causal sensitivity analysis

In the following, we formalize causal sensitivity analysis as maximizing/minimizing the causal effect \(Q(,}_{+1},)\) over all SCMs \(\) that are compatible with a predefined _sensitivity model_. Similar approaches have been used for partial identification with instrumental variables  and testing identifiability of counterfactuals , where all SCMs are considered that are compatible with the observational data. However, a sensitivity model must additionally restrict the joint distribution of both observed and unobserved variables in order to allow for informative bounds on the causal effect.

**Definition 2** (Sensitivity model).: Let \(^{}\) denote the distribution of the observed variables \(=(,,}_{},Y)\). A _sensitivity model_\(\) is a tuple \((,)\), where \(=(_{W})_{W}\) are unobserved confounders between \(\) and \(W\{M_{1},,M_{},Y\}\), respectively (see Fig. 1) and a family \(\) of joint probability distributions on \(\), such that, for all \(\), it holds that \((,)\,=^{ }()\). We denote the set of all SCMs \(\)_compatible_ with \(\) (i.e., that respect the causal graph, induce a distribution \(\), and do not contain additional confounders) as \(()\) (see Appendix E).

Our definition of sensitivity models excludes unobserved confounding between mediators and the outcome. This ensures that the causal effect from Eq. (1) can be interpreted as a path-specific effect . We refer to Sec. 6 for a detailed discussion.

Using the definitions above, we can define _causal sensitivity analysis_ as the following partial identification problem: we aim to obtain bounds \(Q^{-}(,}_{+1},) Q^{+}(, }_{+1},)\) so that

\[Q^{+}(,}_{+1},)=_{ ()}Q(,}_{+1},) Q^{-}(,}_{+1},)=_{ ()}Q(,}_{+1},).\] (2)

\(Q^{+}(,}_{+1},)\) is the maximal causal effect that can be achieved by any SCM that is compatible with the sensitivity mode \(\) (and vice versa for \(Q^{-}(,}_{+1},)\)). Hence, if the sensitivity model is valid, i.e., contains the ground-truth distribution over observed variables and unobserved confounders, we know that the ground-truth causal effect must be contained in the interval \([Q^{-}(,}_{+1},),Q^{+}(,}_{+1},)]\). Bounds for average causal effects and effect differences follow immediately (see Appendix D).

### Generalized marginal sensitivity model (GMSM)

We introduce now the GMSM. We begin by providing the general definition and then show that this extends various marginal sensitivity models from existing literature.

**Definition 3** (GMSM).: The _generalized marginal sensitivity model (GMSM)_ is a sensitivity model \((,)\), where \(\) contains all \(\) that satisfy the following sensitivity constraint: For each \(W\{M_{1},,M_{},Y\}\), there exist bounds \(s_{W}^{-}(,) 1 s_{W}^{+}(,)\), so that, for all \(_{W}\), \(\), and \(\)

\[s_{W}^{-}(,)(_{W}= _{W},)}{(_{W}=_{W} ,do(=))} s_{W}^{+}(,).\] (3)

The GMSM bounds the distribution shift in the unobserved confounders \(_{W}\) when performing the intervention \(do(=)\) instead of conditioning on \(=\). This is a restriction on the strength of the effect the unobserved confounders \(_{W}\) can have on the treatment \(\). If \(_{W}\) has no effect on \(\), Eq. (3) holds with \(s_{W}^{-}(,)=s_{W}^{+}(,)=1\). Hence, the further \(s_{W}^{-}(,)\) and \(s_{W}^{+}(,)\) deviate from \(1\), the larger is the effect from \(_{W}\) on \(\) that the GMSM allows for. We will often use a _weighted_ GMSM, which expresses the bounds in terms of a sensitivity parameter.

**Definition 4** (Weighted GMSM).: A _weighted GMSM_ is a GMSM where \(s_{W}^{-}(,)\) and \(s_{W}^{+}(,)\) can be written as \(s_{W}^{-}(,)=)q_{W}(, )+_{W}}\) and \(s_{W}^{+}(,)=^{-1})q_{W}(,)+_{W}^{-1}}\) for a sensitivity parameter \(_{W} 1\) and a weight function \(q_{W}(,)\) for all \(\) and \(\).

In a weighted GMSM, the sensitivity parameter \(_{W}\) captures the overall restriction on the unobserved confounding strength across individuals. If \(_{W}=1\), no unobserved confounding is allowed, and unconfoundedness holds. For \(_{W}\), the restriction is relaxed completely, and arbitrary confounding strength is allowed. The weight function \(q_{W}(,)\) offers several advantages. It allows to further restrict confounding for individuals with treatments \(\) and covariates \(\). As \(q_{W}(,) 1\), confounding is more strongly restricted until unconfoundedness is reached. This is helpful in applications where prior knowledge about the confounding structure is available. As an example, consider a medical setting where we want to estimate the effect of new drug treatments on the risk of developing a certain disease, but we suspect that the data is confounded by the individual's genetic risk for the disease, which is not measured in the observational data. However, we also might know that genetic risk for the disease is not relevant for a specific combination of age and gender.

**Comparison with the MSM and its extensions:** In the following, we show that the weighted GMSM extends popular sensitivity models from the literature. Proofs are in Appendix C. Note that existing sensitivity models do not consider settings with mediators (i.e., \(=0\)), we thus can write \(=_{Y}\) for the sensitivity parameter, \(q(,)=q_{Y}(,)\) for the weight function, and \(=_{Y}\) for the unobserved confounders. For binary treatments \(=A\{0,1\}\), the marginal sensitivity model (MSM)  is defined via \()}{1-()},)}{(,)}\), where \(()=(A=1)\) denotes the observed propensity score and \((,)=(A=1,)\) denotes the full propensity score. For continuous treatments \(\), the continuous marginal sensitivity model (CMSM)  is defined via \((|,)}{ (|)}\). For longitudinal settings with time-varying observed confounders \(=(_{1},,_{T})\), unobserved confounders \(=(_{1},,_{T})\), treatments \(=(_{1},,_{T})\), we define the longitudinal marginal sensitivity model (LMSM) via \(_{t=1}^{T}(_{t} _{T},_{t},_{t-1})}{(_{t} _{T},_{t-1})}\).

**Lemma 1**.: _The MSM, CMSM and LMSM are special cases of the weighted GMSM by choosing the weight functions \(q(,)=()\) (MSM) and \(q(,)=0\) (CMSM, LMSM)._

Lemma 1 provides a _new interpretation of the MSM_: If the probability \(()\) is large, the MSM restricts the confounding strength because most of the randomness in the treatment is already explained by the observed confounders \(\). We can extend this approach to arbitrary discrete treatments within the weighted GMSM framework. The CMSM and LMSM apply the same confounding restriction for all \(\) and \(\).

## 4 Bounding causal effects under the GMSM

In this section, we derive sharp bounds under our GMSM. We first quantify the maximal shift in conditional distributions (Sec. 4.1). This allows us to derive an algorithm to compute explicit bounds (Sec. 4.2). Finally, we show how these bounds can be estimated from finite data (Sec. 4.3).

### Shifting interventional distributions

In the following, we provide some intuition before stating the main result. Let us consider a simple setting with treatment \(\), a single unobserved confounder \(_{Y}=U\), outcome \(Y\), and GMSM bounds \(s_{Y}^{-}()\) and \(s_{Y}^{+}()\) (see Fig. 2, left). Any SCM \(\) that is compatible with \(\) describes the relationship between \(\), \(U\), and \(Y\) via a functional assignment \(Y=f_{Y}(,U)\). For a fixed treatment \(\), we denote \(f_{Y}(,)\) as \(f_{}\). We are interested in the _interventional density_\((y do(=))=(y ,u)(u)\,u=f_{\#}^{ U}(y)\), where \(f_{\#}^{U}\) denotes the push-forward distribution induced by \(f_{}\) on \(^{U}\). However, we only have access to the _observational density_\((y,u)(u)\,u=f_{\#}^{U|}(y)\). Hence, for a fixed functional assignment \(f_{}\), we can quantify the discrepancy between \((y do(=))\) and \((y)\) via the distribution shift between \(^{U}\) and \(^{U|}\).

Fig. 2 shows a toy example where \(^{U|}\) is the uniform distribution on \(\), and the functional assignment \(f_{}\) is the inverse standard normal CDF \(^{-1}\), so that \((y)\) is the standard normal probability density. We now want to "right-shift" the interventional density \((y do(=))\) as much as possible, so that \(F(y a) F(y do(=))\) for the CDFs. To achieve this, the distribution \(^{U}\) must put more probability mass on the right-hand side of the unit interval \(\) as compared to \(^{U|}\) (see Fig. 2, left).

Then, the functional assignment will also push more probability mass to the right of \((y do(=))\) as compared to \(^{U|}\) (see Fig. 2, right). However, the GMSM bounds the distribution shift between \(^{U}\) and \(^{U|}\) via \(1/s_{Y}^{+}()(u) 1/s_{Y}^{-}()\) (Eq. (3) using that \((u)=(u do(=))\). Intuitively, the maximal possible right shift under the GMSM should occur by choosing \((u)\) so that the bounds are attained, i.e., \((u)=(u c_{Y}^{+})(1/s_{Y}^{+})+(u>c_{Y}^{+})( 1/s_{Y}^{-})\) for some \(c_{Y}^{+}\) that can be obtained via the normalization constraint \((u)\,u=1\). The corresponding "right-shifted" interventional density \(_{+}(y do(=))\) is defined via the push-forward (see Fig. 2).

It turns out that the density \(_{+}(y do(=))\) is the _maximally right-shifted_ interventional distribution that can be obtained under any SCM that is compatible with the GMSM. Furthermore, the above arguments can be generalized beyond the toy example from Fig. 2.

**Theorem 1**.: _Let \(\) be a GMSM with bounds \(s_{W}^{-}=s_{W}^{-}(,)\) and \(s_{W}^{+}=s_{W}^{+}(,)\) for \(W\{M_{1},,M_{},Y\}\). We define \(c_{W}^{+}=^{-})s_{W}^{+}}{s_{W}^{-}-s_{W}}\). If \(W\) is continuous, we define the probability density function_

\[_{+}(w,_{W},)=\{ []{ll}(1/s_{W}^{+})\,(w,_{W},),& F(w) c_{W}^{+},\\ (1/s_{W}^{-})\,(w,_{W},),&F(w)>c_{W}^{+},.\] (4)

_where \(F()\) is the CDF corresponding to \((,_{W},)\). If \(W\) is discrete, we define the probability mass function_

\[_{+}(w,_{W},)=\{ []{ll}(1/s_{W}^{+})\,(w,_{W},),& F(w)<c_{W}^{+},\\ (1/s_{W}^{-})\,(w,_{W},),&F(w -1)>c_{W}^{+},\\ (1/s_{W}^{+})(c_{W}^{+}-F(w-1))+(1/s_{W}^{-})(F(w)-c_{W}^{+} ),.\] (5)

_Let \(F_{+}()\) denote the conditional CDF corresponding to \(_{+}(,_{W},)\) and let \(F_{-}()\) be the conditional CDF of \(_{-}(,_{W},)\), which is defined by swapping signs (in \(c_{W}\) and \(s_{W}\)). For any SCM \(\), denote the CDF corresponding to \(_{}(,_{W},do(= ))\) as \(F_{}()\). Then, for all \(w\),_

\[F_{+}(w)_{()}F_{}(w)  F_{-}(w)_{()}F_{ }(w).\] (6)

_Assume now that \((_{W},do(=))=( _{W})\). Then, the bounds are sharp (i.e., equality holds in Eq. (6)) whenever \(\) is discrete and it holds that \(1/s_{W}^{+}()\), or \(\) is continuous._

Figure 2: Intuition for bounding interventional distributions under our GMSM.

Proof.: See Appendix B. 

The result in Theorem 1 does not depend on the distribution or dimensionality of unobserved confounders, and it does not depend on any specific SCM. As such, our sharp bounds are applicable to a wide class of causal effects, without restricting assumptions on the confounding structure beyond the sensitivity constraint of the GMSM.

In case \(\) is a weighted GMSM with sensitivity parameters \(_{W}\) for all \(W\{M_{1},,M_{},Y\}\), the quantiles \(c_{W}^{+}\) and \(c_{W}^{-}\) are of the particular simple form \(c_{W}^{+}=_{W}/(1+_{W})\) and \(c_{W}^{-}=1/(1+_{W})\). Furthermore, the discrete sharpness condition simplifies to \((1-_{W}^{-1})q_{W}(,)+_{W}^{-1}( )\). In particular, the bounds are sharp whenever we choose a weighting function that satisfies \(q_{W}(,)()\). The assumption \((_{W},do(=))= (_{W})\) excludes the time-varying case (LMSM). Deriving sharp bounds for the LMSM is an interesting direction for future research.

### Bounding causal effects

We now leverage Theorem 1 to obtain explicit solutions for the partial identification problem from Eq. (2) with _monotone_\(\) (see Appendix B). This includes expectation and distributional effects.

**Corollary 1** (Bounds without mediators).: _If \(=0\) and \(\) is monotone, we obtain sharp bounds_

\[Q^{+}(,,)(_{+}^{Y }(,)) Q^{-}(,,)(_{-}^{Y}( ,)),\] (7)

_and sharpness holds under the same conditions as in Theorem 1._

Proof.: See Appendix B.

``` Input : Causal query \(Q(,}_{+1},)\), GMSM \(\) with \(s_{W}^{+}\) and \(s_{W}^{-}\). Output : Upper bound \(Q^{+}(,}_{+1},)\) // Outcome bound \(c_{W}^{+}^{-})s_{W}^{-}}{s_{W}^{-}-s_{W}^{+}}\) for \(W\{M_{1},,M_{},Y\}\) \(Q_{+1}^{+}(}_{})(_ {+}^{Y}(,}_{},_{+1}))\) for \(}_{} supp(}_{})\) // Adjusting rate for confounding in mediators for\(i\{,,1\}\)do for\(}_{i-1} supp(}_{i-1})\)do \(\) = Termination map in ascending order of \((Q_{i+1}^{+}(}_{i-1},(m_{i})))_{m_{i} supp(M_{ i})}\) \((m_{i})_{m:(m) m_{i}}(M_{i}=m ,}_{i-1},_{i})\) \((m_{i})(1/s_{M_{}}^{-})(m_{i },}_{i-1},_{i}),\\ ((m_{i}))<c_{M_{i}}^{+},\\ (1/s_{M_{}}^{-})(m_{i},}_{i-1}, _{i}),\\ ((m_{i})-1)>c_{M_{i}}^{+},\\ (1/s_{M_{i}}^{+})(c_{M_{i}}^{+}-((m_{i})-1))\\ +(1/s_{M_{i}}^{-})(((m_{i})-c_{M_{}}^{+})),\\ .\) \(Q_{i}^{+}(}_{i-1})_{m_{i}}Q_{i+1}^{+}(}_{i-1},m_{i})_{+}(m_{i})\)  end for  end for \(Q^{+}(,}_{+1},) Q_{i}^{+}\) ```

**Algorithm 1**Causal sensitivity analysis with mediators

If \(\) is the expectation functional, \(\) is binary, and \(Y\) is continuous, this coincides with the optimality result from Dorn and Guo . Hence, Corollary 1 generalizes the result from Dorn and Guo  to distributional effects and arbitrary treatments (e.g., categorical, continuous, or time-varying). In their paper, Dorn and Guo proved the sharpness of the bounds by using the Neyman-Pearson Lemma. In contrast, we take the more principled approach outlined in Sec. 4.1, which is applicable to more general settings.

In the following, we consider settings with mediators, i.e., we aim to derive bounds for the causal effect in Eq. (1). The idea is to first obtain outcome bounds conditioned on all possible values \(}_{} supp(}_{})\) in the support of the mediators \(}_{}\). Without unobserved confounding between treatments and mediators, we can obtain the upper bound \(Q^{+}(,}_{+1},)\) from Eq. (1) by replacing \((^{Y}(,}_{},do (=_{+1}))\) with unobserved confounding, we need to additionally take the distribution shift in the mediators into account. To maximize the causal effect, the shifted mediator distribution should put more probability mass on values \(}_{}\) for which \((_{+}^{Y}(,}_{},_{+1}))\) is large. Hence, we can apply the maximal right-shift from Theorem 1 to the mediator distributions in Eq. (1), but where the values \(}_{}\) are permuted to order \((_{+}^{Y}(,}_{},_{+1}))\) in ascending order. We provide the details on our iterative procedure to compute the upper bound \(Q^{+}(,}_{+1},)\) in Algorithm 1. The lower bound \(Q^{-}(,}_{+1},)\) can be computed analogously by swapping signs in \(c_{W}\) and \(s_{W}\).

**Corollary 2**.: _Under the Assumptions of Theorem 1, Algorithm 1 returns the sharp bounds from Eq. (2)._

Proof.: See Appendix B. 

### Empirical bounds via importance sampling

In practice, we only have access to an empirical distribution \(_{n}^{}\) of sample size \(n\) instead of the full observational distribution \(^{}\). We thus obtain estimates \(}(w,_{W},)\) of the conditional density or probability mass functions \((w,_{W},)\) for all \(W\{M_{1},,M_{},Y\}\). If \(W\) is discrete, this reduces to a standard (multi-class) classification problem, and the estimated class probabilities can be plugged into Algorithm 1. If \(W=Y\) is continuous, we can use arbitrary conditional density estimators to obtain \(}(y,}_{},)\). We propose an importance sampling approach to estimate \((_{+}^{Y}(,}_{ },))\) assuming that we can sample from from our estimated density \(}^{Y}(,}_{},)\) (see Appendix F for details and derivations). If \(\) is the expectation functional, our estimator is

\[(_{+}^{Y}(,}_{ },))=^{2}}_{k=1}^{ k _{}^{2}}y_{k}+^{3}}_{k=  k_{}^{3}+1}^{_{k= k_{ }^{3}+1}^{4}y_{k}}, y_{k}_{k=1}^ {k}^{Y}(,}_{},) .\] (8)

We also provide importance sampling estimators for distributional effects in Appendix F. We can also obtain empirical confidence intervals by using the same bootstrap procedure as described in .

**Implementation:** We use feed-forward neural networks with softmax activation function to estimate discrete probability mass functions. For densities, we use conditional normalizing flows  (neural spline flows ), which are universal density approximators and allow for sampling. We perform training using the Adam optimizer . We also perform extensive hyperparameter tuning in our experiments. Implementation and hyperparameter tuning details are in Appendix G.

## 5 Experiments

**Baselines:** Most existing methods focus on sensitivity analysis for binary treatments under the MSM [18; 19; 31; 35; 53]. In this setting, our bounds coincide with existing optimality results . For mediation analysis, we are to the best of our knowledge the first to propose bounds for MSM-based sensitivity analysis. This is why we refrain from benchmarking against baselines in our experiments and only show the validity of our bounds.

**Synthetic data:** We perform extensive experiments using synthetic data from various causal inference settings to evaluate the validity of our bounds. Synthetic data are commonly used to evaluate causal inference methods as they ensure that the causal ground truth is available [6; 16; 76]. Here, we generate six different synthetic datasets with \(n=50,000\) samples in the following manner: We first construct three SCMs with binary treatments for the causal graphs in Fig. 1, that is, (i) no mediators, (ii) a single mediator \(M\), and (iii) two mediators \(M_{1}\) and \(M_{2}\). We then construct three more SCMs for settings (i)-(iii) with continuous treatments. Details are in Appendix H.

To demonstrate the validity of our bounds, we aim to show that they contain the oracle causal effect whenever the sensitivity constraints are satisfied. We evaluate two versions of our GMSM: the MSM for binary treatments and the CMSM for continuous treatments (see Sec. 3.3). Using oracle knowledge from the SCMs, we estimate the respective density ratio from Eq. (3) and obtain the oracle sensitivity parameter \(_{W}^{*}\) (details are in Appendix H).

Figure 3: Results for the binary treatment setting. Settings (i)–(iii) are ordered from left to right. The top row shows the oracle sensitivity parameter \(_{W}^{*}\) (depending on \(x\)), and the bottom row shows the bounds.

We thus demonstrate that our bounds contain the oracle causal effect whenever \(_{W}_{W}^{*}\), i.e., whenever we choose sensitivity parameters \(_{W}\) at least as large as the oracle \(_{W}^{*}\).

The results for binary treatments are shown in Fig. 3 and for continuous treatments in Fig. 4. For binary treatments, we evaluate the causal effect \(Q(,}_{+1},)\) for over \(x[-1,1]\) with three (arbitrary) treatment combinations corresponding to the three different settings: (i) \(}_{1}=1\), (ii) \(}_{2}=(1,0)\), and (iii) \(}_{3}=(1,0,0)\). For continuous treatments, we also use three (arbitrary) treatment combinations: (i) \(}_{1}=0.6\), (ii) \(}_{2}=(0.9,0.5)\), and (iii) \(}_{3}=(0.2,0.4,0.5)\). Results for additional treatment combinations are in Appendix J. Evidently, the oracle causal effect is contained within our bounds. Hence, the results confirm the validity of our bounds.

We also compare the bounds from Jesson et al. (using \(5,000\) samples). The latter is because we derived closed-form solutions for our bounds, while the method proposed by Jesson et al. is an approximation that uses grid search.

**Real-world data:** We demonstrate our bounds using an example with real-world data. We consider a setting from the COVID-19 pandemic where mobility (captured through telephone movement) was monitored to obtain a leading predictor of case growth . Details regarding the data (publicly available) and our analysis are in Appendix I. Here, mobility is the mediator, case growth is the outcome, and stay-home order (ban of gatherings with more than 5 people) is the treatment. We are interested in the natural directed effect (NDE, see Example 2) of a stay-home order on the case growth. We suspect that unobserved confounders between treatment and mediator might exist (e.g., adherence, etc. of the population). Hence we perform a causal sensitivity analysis where we vary \(_{M}\) and plot the bounds in Fig. 5. We observe that the estimated effect under unconfoundedness (\(_{M}=1\)) is negative, i.e., the stay-home order decreases case growth. For \(_{M}>1\), we obtain bounds around this estimand. For \(_{M}<6\) the bounds are negative, which means that under moderate unobserved confounding, it seems likely that the NDE is nonzero, in line with prior evidence .

## 6 Discussion

**Assumptions:** As common in the causal inference literature, our results rely on assumptions on the data-generating process that must be justified by domain knowledge. Our main assumption is that we exclude confounders between mediators and the outcome in our analysis (see Def. 2). The reason

    & \)} &  &  &  \\   & & \(1.2\) & \(1.5\) & \(2\) & \(1.2\) & \(1.5\) & \(2\) & \\  Jesson et al.  (CMSM) & \(0.33 0.00\) & \(0.74 0.01\) & \(1.27 0.01\) & \(1\) & \(1\) & \(1\) & \(137.48 2.02\) \\ Our bounds (CMSM) & \(0.33 0.00\) & \(0.74 0.01\) & \(1.25 0.01\) & \(1\) & \(1\) & \(1\) & \(0.39 0.02\) \\ Our bounds weighted (CMSM) & \(\) & \(\) & \(\) & \(0.6\) & \(1\) & \(1\) & \(0.42 0.05\) \\   

Table 1: Experiment with weighted CMSM

Figure 4: Results for continuous treatment setting. Settings (i)–(iii) are ordered from left to right. The top row shows the oracle sensitivity parameter \(_{W}^{*}\) (depending on \(x\)), and the bottom row shows the bounds.

for this assumption is that it allows us to interpret the causal query from Eq. (1) as a path-specific effect. Path-specific effects are defined as so-called nested counterfactuals that lie in the third layer of Pearl's causal hierarchy  Using the assumption from Theorem 1, they can be reduced to the query from Eq. (1), which lies in layer 2 of Pearl's hierarchy, i.e., only depends on interventions . Our sensitivity analysis then bridges the gap from layer 2 to layer 1 (observational data). Approaches for relaxing this assumption, e.g., by combining our results with a sensitivity analysis from layer 3 to layer 2, are left for future work.

**Sensitivity parameter and weighting function:** Both the sensitivity parameter \(_{W}\) and the weighting function \(q(,)\) incorporate domain knowledge about the unobserved confounding and need to be chosen by the practitioner accordingly.

The sensitivity parameter \(_{W}\) controls the strength of unobserved confounding. In practice, one typically chooses \(\) by domain knowledge or data-driven heuristics . One approach is to obtain the smallest \(\) so that the corresponding partially identified interval includes \(0\). Then, \(\) can be interpreted as a level of "causal uncertainty", quantifying the smallest violation of unconfoundedness that would explain away the causal effect .

The weight function \(q(,)\) offers additional opportunities to incorporate domain knowledge about the confounding structure to obtain tighter bounds. Consider an observational study on the effect of smoking on cancer risk, confounded by certain unobserved genes. For example, it may be known that genes that act as unobserved confounders do not affect the cancer risk for a certain population with certain covariates \(\), which allows us to set \(q(,)=1\). Note that we can always set \(q(,)=()\) (discrete treatments) or \(q(,)=0\) (continuous treatments) if no domain knowledge is available, leading to established sensitivity models from the literature. For example, practitioners may use our bounds for the MSM in a mediation analysis setting without ever explicitly using the GMSM formulation via a weighting function.

**Other sensitivity models:** In this paper, we provide bounds for MSM-type sensitivity models. Recently, other types of sensitivity models have been proposed in the literature, which may provide less conservative bounds in situations where the data-generating process does not follow an MSM. Examples include \(f\)-sensitivity models , \(L_{2}\)-sensitivity models , curvature sensitivity models  and the \(\)-MSM . Extending our results to these sensitivity models may be another possible direction for future work.

**Efficient estimation:** Our main results (Theorem 1, Corollary 1, 2) are _identifiability results_, i.e., hold in the limit of infinite data. We did not provide results on efficient estimation. Therefore, future work may consider extending our approach to incorporate semiparametric efficiency theory .

**Conclusion:** We proposed a flexible generalization of the MSM and derived sharp bounds for a variety of different causal inference settings and data types (e.g., continuous, categorical). Our work provides practitioners with a unified framework for causal sensitivity analysis. This enables reliable causal inferences from observational data in the presence of unobserved confounders, thus promoting safe decision-making.

Figure 5: Estimated upper/lower bound for the NDE on real-world data. Reported: mean and standard deviation over \(10\) runs.