# Towards out-of-distribution generalizable predictions

of chemical kinetic properties

 Zihao Wang

CSE, HKUST

zwanggc@cse.ust.hk

&Yongqiang Chen

CSE, CUHK

yqchen@cse.cuhk.edu.hk

&Yang Duan, Weijiang Li

CS, UIUC

{yangd4,w113}@illinois.edu

&Bo Han

CS, HKBU

bhanml@comp.hkbu.edu.hk

&James Cheng

CSE, CUHK

jcheng@cse.cuhk.edu.hk

&Hanghang Tong

CS, UIUC

htong@illinois.edu

Equal contribution.

###### Abstract

Machine Learning (ML) techniques have found applications in estimating chemical kinetic properties. With the accumulated drug molecules identified through "AI4drug discovery", the next imperative lies in AI-driven design for high-throughput chemical synthesis processes, with the estimation of properties of unseen reactions with unexplored molecules. To this end, the existing ML approaches for kinetics property prediction are required to be Out-Of-Distribution (OOD) generalizable. In this paper, we categorize the OOD kinetic property prediction into three levels (structure, condition, and mechanism), revealing unique aspects of such problems. Under this framework, we create comprehensive datasets to benchmark (1) the state-of-the-art ML approaches for reaction prediction in the OOD setting and (2) the state-of-the-art graph OOD methods in kinetics property prediction problems. Our results demonstrated the challenges and opportunities in OOD kinetics property prediction. Our datasets and benchmarks can further support research in this direction. The github repository for code and data can be found in https://github.com/zihao-wang/ReactionOOD.

## 1 Introduction

In recent years, graph machine learning has been widely used in scientific discovery (Wang et al., 2023; Zhang et al., 2023) and gained particular success in chemistry (Gilmer et al., 2017; Jumper et al., 2021; Mullowney et al., 2023). The underlying rationale is the long-standing structure-property relationship (Mihalic and Trinajstic, 1992) in chemistry. For example, Graph Neural Networks (GNNs) can efficiently encode information at both the molecular structure level and the atom level within a molecule, which reveal compelling properties of the molecule (Gilmer et al., 2017). Such methods yield efficient, cheap, but still effective predictions of the properties of _unseen molecules_ before expensive experiments or computations, which can serve as valuable reference information for drug discovery (Mullowney et al., 2023).

One of the _next_ questions to be answered after the discovery of a proper but unseen molecule is _How to efficiently obtain unseen molecules through chemical synthesis_. In contrast to the molecule property estimation problem that concerns a _single_ molecule, chemical synthesis processes involve the proper arrangement of various reactions that encompass _multiple_ molecules under optimal conditions. Therefore, the very first step of achieving a high-throughput synthesis of unseen molecules is to estimate the properties of chemical reactions (Warr, 2014), especially kinetics properties thatdescribe the "rate" of reactions. This prediction task is expected to be Out-Of-Distribution (OOD) generalizable so that the kinetic properties of OOD reactions with unseen molecules can be well predicted.

Recently, machine learning methods have been applied to predict the kinetic properties of reactions [Heid and Green, 2021]. In existing studies, chemical reactions are assumed to be Independently and Identically Distributed (IID), and models are trained and tested within random splits [Heid and Green, 2021, Stuyver and Coley, 2022, Heid et al., 2023]. However, results from such IID assumptions provide little credible insight into the performances of existing ML methods in OOD reaction property prediction. Meanwhile, existing theoretical and empirical studies for OOD generalization on graphs [Ji et al., 2022, Gui et al., 2022], are restricted to problems with a single graph. How OOD methods perform reaction properties prediction with multiple molecules is still unknown.

To fill this gap, this paper discusses the out-of-distribution generalization issue when applying machine learning methods to the prediction of chemical reaction properties. We propose three levels of OOD shifts for ML-based reaction prediction: Structure OOD, Mechanism OOD, and Conditional OOD. Then, we reorganize recent reaction kinetic databases [Johnson et al., 2022] and create a comprehensive dataset in three levels of OOD. Furthermore, we empirically justify the performance of state-of-the-art kinetic property prediction produced by state-of-the-art OOD methods for general and graph inputs. Our results demonstrated that there remain huge ID-OOD performance gaps under different distribution shifts in chemical reactions for existing OOD methods.

## 2 Related works

Increasing efforts have been made to devise machine learning approaches for various aspects of chemical reaction systems [Davies, 2019, Stocker et al., 2020, Meuwly, 2021, Strieth-Kalthoff et al., 2022], such as reaction classification [Schwaller et al., 2021, Bures and Larrosa, 2023], reaction optimization [Felton et al., 2021], atom mapping [Schwaller et al., 2021], and the most fundamentally, reaction property prediction [Heid and Green, 2021]. With the burst of chemical reaction data [von Rudorff et al., 2020, Spiekermann et al., 2022, Johnson et al., 2022, Choi, 2023, Stuyver et al., 2023, Zhao et al., 2023], the Graph Neural Network (GNN) based methods [Heid and Green, 2021, Stuyver and Coley, 2022, Heid et al., 2023] are demonstrated its clear advantage over traditional methods by leveraging the structure of reactants and products.

Out-of-distribution shift is one of the long-standing problems in machine learning [Vapnik, 1991, Quinonero-Candela et al., 2008, Shen et al., 2021]. Recently, OOD generalizable graph neural networks have been discussed extensively [Bevilacqua et al., 2021, Zhu et al., 2021, Wu et al., 2022b, a, Chen et al., 2022]. When it comes to scientific discovery, out-of-distribution generalization capabilities enable machine learning methods to find more reliable discoveries from existing observations. A thorough investigation of the intersection of OOD and drug discovery can be found at Ji et al.  and Gui et al. . However, as we will identify in the incoming parts, the out-of-distribution shifts for chemical reactions are radically different from those with existing graph OOD settings [Gui et al., 2022], and existing OOD methods do not perform well.

## 3 Preliminary

### Chemical reactions and kinetic property prediction

A chemical reaction \(\) is described by the reactants \(r_{1},,r_{m}\), products \(p_{1},,p_{n}\), and the conditions \(c_{1},,c_{l}\).2

\[r_{1}++r_{m}[]{c_{1},,c_{l}}p_{1}++p_{n}.\] (1)

Multiple molecules (including atoms, ions, and other species) are involved in one reaction, which differs from molecule property prediction tasks where only one molecule structure is considered.3Each molecule \(r_{i}\), \(p_{j}\) is considered as a molecule graph, with atoms as attributed nodes and bonds as attributed edges. For a chemical reaction \(\), \(R[]\)\((P[])\) denotes the graph of reactants (products) as the union of the reactant (product) molecule graphs. \(C[]\) denotes the set of conditions. \(_{R}\) (\(_{P}\)) and \(\) denote the space of graphs for reactants (products) and the space of conditions, respectively.

Kinetics properties investigated in existing literature include _reaction barrier_ (activation energy) [von Rudorff et al., 2020, Spiekermann et al., 2022, Stuyver et al., 2023, Zhao et al., 2023] and _rate constants_[Heid and Green, 2021]. As one of the simplest mathematical descriptions of the rate constant, the Arrhenius equation reads

\[k=A(}{RT}),\] (2)

where \(k\) is the rate constant, which is modeled by a function of the Arrhenius factor \(A\), the reaction barrier (activation energy) \(E_{a}\), the universal gas constant \(R\), and the absolute temperate \(T\). Though Equation (2) only holds under mild conditions for some reactions, we could still summarize that, the rate constant \(k\) is jointly described from three aspects: (1) the inherent property of the reaction, such as the barrier \(E_{a}\)[Donahue, 2003], (2) the conditions, such as the temperature \(T\), and (3) other parameters \(A\) to fit the empirical data.

In this paper, we also consider the reaction barrier \(E_{a}\) and the rate constant \(k\) as the target of prediction. Let \(\) be the space of the target property. The target \(Y\) of reaction \(\) is computed by the learnable function \(f_{}:\), where \(=_{R}_{P}\) is the input space.

### OOD shifts

Out-of-distribution generalization is one of the key topics in machine learning research. It considers the shifts of the joint distribution \(P(X,Y)\) over \(\) during training and testing phase, \(P^{}(X,Y) P^{}(X,Y)\)[Gui et al., 2022]. Applying the conditional probability formula,

\[}(Y|X)}_{}}(X)}_{}}(Y| X)}_{}}(X)}_{}.\] (3)

This decomposition introduces two basic types of OOD shifts: covariate shift and concept shift, where one part of the distribution is changed while the other part is fixed.

One common way to characterize distribution shifts in high-dimensional input space is to properly separate the spaces into domains. Let \(\) be the set of domains and \(\) be the input space. For each input \(X\), we define its domain index \([X]\). Table 1 summarizes the covariate shift and concept shift with the domain index.

Throughout this paper, the domain index \([X]\) is equivalent to an equivalent relation \(\). Specifically, for \(X^{},X\), \([X^{}]=[X]\) if and only if \(X^{} X\). Then, it suffices to define **the equivalent relation** over the input space, which will naturally lead to the definition of the domain index and then two kinds of OOD shifts.

## 4 Three levels of OOD shifts in kinetic property prediction

This section defines three levels of OOD settings and details the OOD domains by constructing the **equivalent relations** in the input space \(=_{R}_{P}\). The definition of equivalent classes, so as the OOD shifts, can be decomposed into the subspaces of \(\). Structure OOD (S-OOD) establishes the equivalent relation in the subspace \(_{R}_{P}\) while Condition OOD (C-OOD) concerns the equivalent relation in the subspace \(\). Mechanism OOD (M-OOD) considers the shifts in general chemical reaction space \(\) with the expertise of chemists. Figure 1 indicates the different levels of out-of-distribution generalization.

  Distribution shifts & \(P([X])\) & \(P(Y|[X])\) \\  Covariate shift & \(P^{}([X]) P^{}([X])\) & \(P^{}(Y|[X])=P^{}(Y|[X])\) \\ Concept shift & \(P^{}([X])=P^{}([X])\) & \(P^{}(Y|[X]) P^{}(Y|[X])\) \\  

Table 1: Two types of distribution shifts. \([X]\) denotes the domain index of the input \(X\).

### Structure OOD (S-OOD)

The first level of OOD settings is about the graphs for reactants and products, which are directly related to the graph machine learning methods such as graph neural networks.

**Definition 1** (Structure OOD).: _Let \(\) be an equivalent relation in \(_{R}_{P}\) and \([X]\) be the equivalent class containing \(X\) induced by \(\). We say \(\) defines a structure OOD setting._

By instantiating the equivalent relation \(\), we can easily define several OOD settings. We begin with the basic cardinality \(|G|\) of graph \(G\).

**Example 1** (S-OOD by total atom number).: _Consider the equivalent relation \(\), such that \(R_{1} P_{1} R_{2} P_{2}\) if and only if \(|R_{1}|=|R_{2}|\), i.e., the total number of atoms in two reactions are equal. Then the induced S-OOD setting is about the atom number of the largest reactant._

Besides, the size of each reactant molecule also plays an important role. For example, the number of carbon atoms in an organic compound is related to its phase status in the ambient temperature and pressure, thus affecting the chemical reactions. Inspired by this, we can also define another type of S-OOD.

**Example 2** (S-OOD by the atom number of the largest reactant).: _Consider the equivalent relation \(\), such that \(R_{1} P_{1} R_{2} P_{2}\) if and only if \(_{r_{i} R_{1}}|r_{i}|=_{r_{j} R_{2}}|r_{j}|\), i.e., the total number of atoms in two reactions are equal. Then the induced S-OOD setting is about the total atom number._

Furthermore, it is also possible to define the S-OOD by considering the scaffold of molecules.

**Example 3** (Structure OOD by the scaffold of the first reactant).: _Let \(_{S}\) be the equivalent relation for two molecular graphs with the same scaffold. Consider the equivalent relation \(\) such that \(R_{1} P_{1} R_{2} P_{2}\) if and only if \(r_{11}_{S}r_{21}\) for \(r_{11} R_{1}\) and \(r_{21} R_{2}\). Then the induced OOD setting is about the first reactant scaffold._

One can easily induce a more complex S-OOD setting by using the scaffold equivalence.

**Example 4** (Structure OOD by the mutual scaffold of all reactants).: _Let \(_{S}\) be the equivalent relation for two molecular graphs with the same scaffold. Consider the equivalent relation \(\) such that \(R_{1} P_{1} R_{2} P_{2}\) if and only if \( r_{i} R_{1},r_{j} R_{2},r_{i}_{S}r_{j}\). Then the induced OOD setting is about the reactant scaffold._

We could see that basic properties of molecules such as atom number and scaffold can define various types of S-OOD for chemical reactions, which is more complex than the situation for single molecule property predictions (Ji et al., 2022).

### Condition OOD (C-OOD)

Focusing on the subspace \(\) of \(\), C-OOD investigates the generalization problem of the same reaction with respect to the reaction condition. Typical examples of C-OOD include rate-temperature dependency and rate-temperature-pressure dependency.

It should be stressed that Equation (2) is not always sufficient to describe how the rate constant \(k\) changes with temperature. It turns out that the reaction rate cannot be summarized by a uni

Figure 1: Illustration of different levels of reaction OOD. S-OOD and C-OOD focus on the distribution shifts in the subspace of the input. M-OOD focuses on the distribution shifts in the entire reaction space.

fied formulation. Chemists employ various forms of formulas to describe the dependency between the rate constant and conditions through data-driven approaches such as Chebyshev polynomial fitting (Heal, 1999) or analytical approaches like the Lindemann mechanism (Lindemann et al., 1922). Other types of rate constant formulas can be found in Johnson et al. (2022).

Due to the complex nature of the dependency between the rate constant and conditions, C-OOD generalizability is particularly important if one wants to obtain the optimal condition of a reaction from machine learning models. Meanwhile, the equivalent relation \(\) for C-OOD is easier to construct since the most common conditions are temperature and pressure, which are all real-valued.

### Mechanism OOD (M-OOD)

Another important intuition for characterizing chemical reaction systems, in particular for organic reactions, is the reaction mechanism. Reaction mechanisms are expert knowledge about how reactions happen and are examined in long-standing chemistry research. Typical examples include the E2 and S\({}_{N}\)2 mechanisms (von Rudorff et al., 2020) that are usually considered as widely existing competing mechanisms.

Similar to the definition of S-OOD, M-OOD is also defined by the equivalent relationship, but in the general chemical reaction space \(\) with an expert-defined relationship \(_{M}\).4

**Definition 2** (Mechanism OOD).: _Let \(_{M}\) be the mechanism equivalence relationship in \(\), such that \(_{1}_{M}_{2}\) if and only if \(_{1}\) and \(_{2}\) follow the same established mechanism. We say \(_{M}\) defines a M-OOD setting._

Reaction mechanisms also heavily rely on the molecular structure of reactants and products. However, M-OOD is motivated very differently from S-OOD by size equivalence or scaffold equivalence. M-OOD follows the well-established understanding and explanations in chemistry research. In this work, we define the M-OOD dataset by the kinetic database built by Johnson et al. (2022). Detailed introduction can be found in Section 5.

## 5 Datasets and benchmarks

This section presents the details of constructing the benchmark to evaluate OOD generalizability of machine learning methods. We introduce how to create the datasets in different settings and the methods to benchmark. The derived collections of datasets is termed as ReactionOOD, which will be updated following to the growing of reaction kinetic databases.5

### Dataset construction

Table 2 summarizes the information about the OOD datasets at three levels, with detailed target, domain, database, and statistics. For each database, we reorganize it into one or more domains to form multiple OOD datasets at different OOD levels. It worth mentioning that databases of E2

   OOD level & Target & Domain & Database & \# RXN & \# Smp & Reference \\   &  & Total atom number (Eq. 1) & E2 \& S\({}_{N}\)2\({}^{}\) & 3625 & 3625 & von Rudorff et al. (2020) \\  & & Total atom number (Eq. 1) & RDB7\({}^{}\) & 23852 & 23852 & Spiekermann et al. (2022) \\  & & Cycloaddition\({}^{}\) & 5269 & 5269 & Stuyver et al. (2023) \\   & & First reactant scaffold (Eq. 3) & RDB7\({}^{}\) & 23852 & 23852 & Spiekermann et al. (2022) \\  & & & Cycloaddition\({}^{}\) & 5269 & 5269 & Stuyver et al. (2023) \\   & Rate constant & \(T\) & RMG Lib. T & 29161 & 87340 & \\  & & \((T,P)\) & RMG Lib. TP & 3444 & 113695 & Johnson et al. (2022) \\  M-OOD & Barrier & Mechanism & RMG Family & 12129 & 12129 & \\   

Table 2: Summary of datasets. \(\) indicates the database processed by Heid et al. (2023).

& S\({}_{N}\)2 [von Rudorff et al., 2020], RDB7 [Spiekermann et al., 2022], and Cycloaddition [Stuyver et al., 2023] has been processed by Heid et al. . However, the databases provided by Heid et al.  only contain the reaction information (with atoms mapped to SMILES strings6) and the target properties. Thus, they can be only used for S-OOD but not C-OOD and M-OOD. We note that the E2 & S\({}_{N}\)2 dataset contains reactions with molecules whose scaffold cannot be properly defined, which prevents the scaffold from being an applicable domain index for this dataset.

The well-established and open-sourced RMG kinetic databases [Johnson et al., 2022] are curated for further discussion about the C-OOD and M-OOD7. There are two major parts in RMG kinetic databases, i.e., reaction family and reaction library. The reaction family database contains 74 reaction mechanism families so that it can be used for the M-OOD level. The reaction library database contains 3,956 non-Arrhenius reactions and 3,444 pressure-dependent reactions out of 32,645 reactions in total, providing a data source for the investigation in the C-OOD level.

We use internal tools provided in the RMG databases to fetch the SMILES strings of reactants and products respectively, and integrate them to form the SMILES representation of reactions. Then, the atom mapping is extracted by RXNNMapper8 [Schwaller et al., 2021a]. For reaction family database, we only choose the reactions with Arrhenius kinetics and set the target as the activation energy with standard units. This forms the "RMG Family" dataset at the M-OOD level in Table 2. For reaction library database, we further split them into two categories: reactions that depend solely on temperatures and reactions that depend on both temperature and pressure. We also filter out reactions whose valid temperature range does not contain 300K to avoid the effect of singular reactions. Then the "RMG Lib. T" and "RMG Lib. TP" datasets at C-OOD level in Table 2 are obtained by enumerating temperature in \([300K,1,300K,2,300K]\) and pressure in \([10^{7},2 10^{7},,10^{8}]\). Rate constants at specific conditions are obtained by tools in RMG [Johnson et al., 2022] and conditions that are out of valid ranges are discarded.

For each dataset in Table 2, we follow the scheme of Gui et al.  and Ji et al.  to create In-Distribution (ID) and OOD splits for a comprehensive examination of the generalization abilities of existing approaches.

### Methods

**Feature engineering.** To handle multi-molecule inputs of the kinetic property prediction task, we follow the established practice of condensed graph representation [Heid and Green, 2021] and use the graph feature extractor in a recent pipeline9[Heid et al., 2023]. For C-OOD settings, the temperature and pressure value is concatenated into the feature vector.

**Backbone GNN for kinetic property prediction.** All methods use the identical backbone GIN [Xu et al., 2019] with the virtual node trick. Noted that the backbone network in this paper is different from the one used in Heid et al. . However, our evaluation shows that the GIN backbone reaches similar MAE performances as [Heid et al., 2023] in the random split setting. Therefore, the vanilla Empirical Risk Minimization (ERM) [Vapnik, 1991] training is the baseline non-OOD method for comparing to other OOD methods

**OOD methods.** In addition to the ERM, we consider OOD methods developed for both Euclidean and graph data: (1) **Euclidean OOD methods** include IRM [Arjovsky et al., 2019], VREx [Krueger et al., 2021], GroupDro [Sagawa* et al., 2020], DANN [Ganin et al., 2016], Coral [Sun and Saenko, 2016], and (2) **graph OOD methods** include CIGA [Chen et al., 2022], GSAT [Miao et al., 2022] and DIR [Wu et al., 2022b]. We follow the same evaluation protocol and hyperparameter settings as in Gui et al. . Though the hyperparameters are tuned for single graph problems, they are still applicable to kinetic property prediction because the CGR feature extraction conceptually reformulates the graphs for reactants and products as one graph. We report the ID and OOD RMSE results of models selected according to the best ID and OOD validation performance. Each score is averaged by 10 runs with different random seeds.

## 6 Results and findings

Table 5.2 and the left half of Table 5.2 present the RMSE results for S-OOD settings, including graph size shifts on E2 & S\({}_{N}\)2, Cycloaddition, and RDB7 datasets and scaffold shifts on Cycloaddition, and RDB7 datasets. The right half of Table 5.2 presents the M-OOD results of the mechanism shift on the RMG Family dataset. Table 5.2 presents the C-OOD results for T and TP shifts on the RMG Lib. dataset. For Table 5.2 and Table 5.2, the kinetic property to be predicted is the reaction barrier. For Table 5.2, the kinetic property to be predicted is the rate constant. For all tables, the best performance is boldfaced. If there are ties between ERM and any OOD methods, the ERM performance is boldfaced. Then we discuss two findings and other observations.

**Finding 1: OOD kinetic property prediction is a challenging OOD problem.** At first glance, it can be found that there remain huge ID-OOD performance gaps across different levels and types of OOD shifts and datasets. Neither OOD methods developed for Euclidean data nor OOD methods developed for graph data can outperform the vanilla ERM approaches consistently and significantly. The results also align with existing observations in realistic data and distribution shifts (Gulrajani and Lopez-Paz, 2021; Ji et al., 2022; Gui et al., 2022). The performances of IRM are quite bad possibly due to the high requirements of IRM in learning invariant features under non-linear data (Chen et al., 2022).

**Finding 2: M-OOD shift is significantly harder than the S-OOD shift.** Moreover, it can be found that the ID-OOD performance gap is largely signified under mechanism OOD shifts (M-OOD), especially compared to the widely studied S-OOD shifts. The RMSE performances of M-OOD are An order of magnitude larger than those for S-OOD. Table 5.2 directly demonstrated this absolute

    &  &  \\  Methods &  &  &  &  \\ ID & OOD & ID & OOD & ID & OOD & ID & OOD \\  ERM & \(3.37 0.05\) & \(5.80 0.14\) & \(4.40 0.14\) & \(\) & \(29.13 0.39\) & \(118.44 0.16\) & \(32.30 0.08\) & \(\) \\ IRM & \(19.5 0.53\) & \(20.6 1.40\) & \(27.9 0.04\) & \(20.7 0.05\) & \(101.60 0.31\) & \(137.54 0.63\) & \(93.38 0.06\) & \(116.44 0.60\) \\ VREx & \(3.65 0.06\) & \(5.11 0.20\) & \(20.2 1.11\) & \(18.3 1.46\) & \(36.77 0.62\) & \(115.78 0.64\) & \(61.57 1.38\) & \(82.38 1.69\) \\ GroupDRO & \(3.41 0.03\) & \(4.90 1.09\) & \(\) & \(24.1 0.06\) & \(\) & \(\) & \(\) & \(53.47 0.68\) \\ DANN & \(3.38 0.03\) & \(4.90 1.06\) & \(3.430 0.07\) & \(4.22 0.05\) & \(29.05 0.39\) & \(116.41 2.78\) & \(32.03 0.39\) & \(52.91 0.61\) \\ Coral & \(\) & \(\) & \(4.33 0.09\) & \(4.21 0.09\) & \(29.09 0.39\) & \(116.09 18.87\) & \(31.91 0.59\) & \(52.85 0.66\) \\ CIGA & \(3.69 0.34\) & \(4.94 0.36\) & \(4.59 0.47\) & \(4.39 0.31\) & \(43.83 0.87\) & \(134.81 1.99\) & \(38.22 1.70\) & \(64.93 1.57\) \\ DIR & \(3.72 0.20\) & \(5.02 0.23\) & \(4.52 0.16\) & \(4.38 0.19\) & \(44.15 0.56\) & \(131.66 11.57\) & \(39.40 12.96\) & \(65.01 2.38\) \\ GSAT & \(3.39 0.06\) & \(5.07 1.05\) & \(4.34 0.06\) & \(4.22 0.06\) & \(30.97 0.99\) & \(117.06 13.34\) & \(32.56 0.85\) & \(53.31 0.68\) \\   

Table 4: OOD generalization performance on E2 & S\({}_{N}\)2 and RMG with S-OOD and M-OOD shifts.

    &  &  \\   &  &  &  &  \\ ID & OOD & ID & OOD & ID & OOD & ID & OOD \\  ERM & \(4.78 0.07\) & \(5.80 0.30\) & \(5.04 0.06\) & \(5.57 0.08\) & \(4.12 0.07\) & \(5.23 0.29\) & \(4.30 0.11\) & \(6.00 0.13\) \\ IRM & \(13.73 0.59\) & \(16.60 0.15\) & \(17.09 0.26\) & \(18.43 0.41\) & \(17.64 0.10\) & \(17.06 0.30\) & \(23.04 0.22\) & \(22.46 0.22\) \\ VREx & \(5.50 0.06\) & \(6.41 0.86\) & \(5.17 0.05\)gap by a huge contrast, where the E2 & S\({}_{N}\)2 dataset has only two reaction mechanisms but the RMG Family dataset contains 74 reaction mechanisms.

**Miscellaneous observations.** We can also observe an exception for graph size concept shifts in E2 & S\({}_{N}\)2, that OOD performances of various methods are generically better than ID performances. One conjecture is that the distribution of molecule sizes could limit the strength of the potential concept shifts. This distinct size distribution aligns with our earlier finding that scaffolds are not always identifiable for certain molecules. For concept shifts, the ID-OOD performance gaps are mainly caused by spurious correlations across different environments or domains. For images, such spurious correlations mainly lie between the background and the object in the images. For molecules, such spurious correlations are widely observed between scaffolds and the critical functional groups (Hu et al., 2020; Koh et al., 2021). However, for small molecules that even do not have scaffolds, we suspect there is limited room for the existence of spurious correlations. Nevertheless, it remains challenging for the OOD generalization across different graph sizes, as demonstrated by the graph size covariate shifts.

## 7 Conclusion and future works

In this work, we identified various distribution shifts exist in chemical reactions and curated a new benchmark to examine the performance of multiple OOD generalization approaches. The results show that there remain huge ID-OOD performance gaps across different distribution shifts. Therefore, it calls for better graph machine learning approaches to tackle the OOD regression challenge for facilitating the chemical proper prediction.