# Ppi: Pretraining Brain Signal Model for Patient-independent Seizure Detection

Zhizhang Yuan

Zhejiang University

zhizhangyuan@zju.edu.cn

&Daoze Zhang

Zhejiang University

zhangdz@zju.edu.cn

&Yang Yang

Zhejiang University

yangya@zju.edu.cn

&Junru Chen

Zhejiang University

jrchen_cali@zju.edu.cn

&Yafeng Li

Nuozhu Technology Co., Ltd.

yafeng.li@neurox.cn

Equal contribution.Corresponding author.

###### Abstract

Automated seizure detection is of great importance to epilepsy diagnosis and treatment. An emerging method used in seizure detection, stereoelectroencephalography (SEEG), can provide detailed and stereoscopic brainwave information. However, modeling SEEG in clinical scenarios will face challenges like huge domain shift between different patients and dramatic pattern evolution among different brain areas. In this study, we propose a **P**retraining-based model for **P**atient-**i**ndependent seizure detection (PPi) to address these challenges. Firstly, we design two novel self-supervised tasks which can extract rich information from abundant SEEG data while preserving the unique characteristics between brain signals recorded from different brain areas. Then two techniques, _channel background subtraction_ and _brain region enhancement_, are proposed to effectively tackle the domain shift problem. Extensive experiments show that PPi outperforms the SOTA baselines on two public datasets and a real-world clinical dataset collected by us, which demonstrates the effectiveness and practicability of PPi. Finally, visualization analysis illustrates the rationality of the two domain generalization techniques.

## 1 Introduction

Epilepsy is a chronic disease of brain that affects more than 50 million people worldwide, and a large proportion of patients have drug resistant epilepsy (DRE) which cannot be controlled by medication. Actually 70% of them can live seizure-free only if the _seizure onset zone_ (SOZ) can be located and surgically removed .

To diagnose epilepsy, the most direct quantitive data to reflect brain function is the electrical activity of the patient's brain. One of the methods to monitor the brain activity is EEG, in which small sensors are attached to the scalp to pick up the electrical signals produced by the brain. Although EEG is widely adopted in brain activity recordings due to its simplicity and relatively low cost, as a non-invasive method, EEG fails to pinpoint the exact seizure focus when the SOZ is located in the deep structure of the brain. In view of the importance of SOZ localization in the treatment of patients with DRE , an emerging method called SEEG  is applied to locate foci by implanting electrodes in the deep brain. The contacts (also called _channels_) on the electrodes distribute around the suspected lesion across several brain areas, which provide stereoscopic recordings of the brain from both cortical and subcortical structures simultaneously .

After collecting the SEEG recordings of patients, the process of epilepsy detection and diagnosis is traditionally treated as a manual task that highly depends on a few experienced neuroscientists, requiring considerable time and human resources . Thus, automating this process could greatly improve the efficiency of clinical seizure detection. As shown in Fig. 1, firstly the model is trained using the labeled data from existing patients, and then the trained model will automatically detect seizures of the SEEG recordings of any new patient. Doctors can view SEEG waveforms and model predictions at the same time (shown on the right side of Fig. 1), and refer to the prediction results for more efficient diagnosis and further treatment. However, existing works for SEEG-based seizure detection mainly focus on the patient-specific setting [6; 7], which can only be trained and directly applied on the same patient due to the substantial differences of SEEG data between patients, resulting in hours even days of training for each new patient. Although a few studies follow the patient-independent setting, these works require manual sampling and denoising by a small number of experienced neurosurgeons, leading to a substantial data bias from real clinical data, which is also time consuming and inapplicable in clinical scenarios.

In fact, designing a model for patient-independent seizure detection on SEEG data under clinical requirements is quite an arduous task due to several unique challenges. Owing to the structural and functional differences of brain neural activities and the variation of invasive electrode numbers and locations (see Fig. 2) caused by individual differences in epileptogenic foci, the seizure patterns of SEEG data are quite different among individuals [8; 9]. Therefore, it is very difficult to perform patient-independent seizure detection on SEEG data. In addition, for epilepsy diagnosis, we have to detect seizures for each monitored brain areas to assist localization of SOZ. Meanwhile, for the fact that the cerebral is composed of multiple brain regions that exert a wide variety of functions , the seizure patterns may greatly change across brain areas. Thus, to detect seizures for patients with different lesions, we should preserve the unique characteristics of brain areas. However, this is usually overlooked by existing works and is quite a challenging task under patient-independent setting.

To address the aforementioned challenges above, we propose a novel patient-independent seizure detection model called PPi, which can be successfully applied to clinical SEEG data. PPi adopts a self-supervised learning approach considering significant discrimination of brain areas and contextual coherence of SEEG signals to preserve the patterns of different channels and pretrain on large amount SEEG data. To handle the huge domain shift between patients, we propose channel background subtraction to align the distribution of the same brain region across different patients and brain region enhancement to mitigate the distribution shift brought by different brain regions. In the experimental phase, unlike existing works, we test our model on the real-world clinical data to verify the application value of our method. In summary, our key contributions comprise:

* To the best of our knowledge, we are the first to conduct patient-independent seizure detection on a large-scale real-world clinical SEEG dataset under clinical requirements.

Figure 1: Overview of the automated seizure detection pipeline. Firstly, the model is trained utilizing the SEEG data from existing patients. Then for real-world application, the doctors can upload the SEEG data of new patients and obtain the results of seizure detection predicted by the model, to easily enjoy the diagnostic assistance which is helpful for further treatment.

Figure 2: Different SEEG electrode numbers and locations of two patients.

* We propose two novel self-supervised pretraining tasks to preserve the unique patterns of different channels, and two techniques including channel background subtraction and brain region enhancement to handle the domain shift between different patients.
* Extensive experiments show that PPi greatly outperforms the SOTA seizure detection methods (especially on the real-world clinical dataset), demonstrating the application value of our work.

## 2 Related Work

SEEG-based seizure detection.SEEG is an emerging method applied in seizure detection, which can localize the SOZ more precisely than those noninvasive recording methods. However, due to the low-quality, large-amount, high-dimensionality characteristics of SEEG data, it is still challenging to develop an automatic approach in SEEG-based seizure detection. Ganti et al.  improve seizure detection by temporal Generative Adversarial Networks (TGAN). Chen et al.  adopt a graph structure to detect epileptic wave. Xiao et al.  propose an SOZ localization method via analyzing the long-term SEEG monitoring for preoperative planning of epilepsy surgery. Although researchers have explored some possible approaches for SEEG-based seizure detection, almost all of these works focus on a patient-specific setting, none of which can be applied in actual clinical scenarios.

Domain generalization on brain signals.Our goal is to predict epileptic seizures of SEEG from unseen patients, which can be abstracted as a domain generalization (DG) problem on brain signals. Yang et al.  develop a new DG method named ManyDG, that can scale to such many-domain problems for seizure detection task on EEG. Ayodele et al.  use transfer component analysis and LSTM to detect epilepsy on EEG data. Jeon et al.  propose a mutual information-driven method to conduct subject-invariant and class-relevant deep representation learning of EEG. For these current DG works on brain signals, most of them are conducted on EEG data rather than more informative SEEG. Although Wang et al.  study SEEG-based seizure detection on the patient-independent setting, they conduct experiments on datasets which are not only much smaller in size than practical records. The datasets are also manually denoised and sampled to a balanced positive-negative sample ratio which brings about a huge data bias from the real clinical data, indicating that their work is still far from clinical requirements.

Self-supervised learning on brain signals.Self-supervised learning is an effective approach when the labeled data is limited. In the field of neural signal (e.g. SEEG, EEG), the label is often hard to obtain. Thus, researchers have developed some SSL methods for this field. Banville et al.  utilize relative positioning, temporal shuffling and contrastive predictive coding as the pretext tasks for EEG. Mohsenvand et al.  and Kostas et al.  model EEG signal using contrastive learning. Cai et al.  propose a self-supervised learning framework for brain signals that can be applied to pretrain either SEEG or EEG data. However, these works do not explicitly align the distribution gaps between different domains, which is crucial under the DG setting, especially for data with large domain differences such as SEEG.

## 3 Problem Formulation

Seizure detection on SEEG data can be viewed as a time series classification (TSC) task. The SEEG recording of a patient is a multivariate time series \(^{N C}\), where \(N\) is the length of series, and \(C\) is the number of channels. According to the existing works on TSC task [21; 22; 23], given an SEEG recording \(_{c}=(x_{1},x_{2},,x_{N})\) from channel \(c\) of a patient, we divide the contiguous data into small segments to construct data set \(_{c}=\{_{c,0},_{c,1},,_{c,K-1}\}\) and the corresponding label set \(_{c}=\{y_{c,0},y_{c,1},,y_{c,K-1}\}\), where \(_{c,k}=\{x_{l k+1},,x_{l(k+1)}\}\) is the \(k\)-th segment data on channel \(c\) from \(\) (\(l\) is the length of each segment, \(K= N/l\) is the total number of segments on channel \(c\)), and \(y_{c,k}\{0,1\}\) is the label of \(_{c,k}\), which indicates whether the segment contains a seizure event (\(y_{c,k}=1\)) or not (\(y_{c,k}=0\)).

The problem is a DG study in epileptic diagnosis scenario, in which each patient is regarded as a _domain_. Conceptually, DG deals with a challenging setting where one or several different but related domain(s) are given, and the goal is to learn a model that can generalize to an unseen test domain.

Our goal is to utilize the data of labeled patients (_source domains_) to train a model which can be directly adopted to the data unseen patients (_target domains_).

## 4 Methodology

In this section, we introduce the technical details of PPi. As shown in Fig. 3, under the patient-independent setting, we first pretrain an encoder by performing two self-supervised tasks (Sec. 4.1.1) to capture rich information from time domain while preserving unique patterns for each channel, which is consistent with the physiological mechanism of seizures. The pretrained encoder is then applied to the seizure detection task (shown in Fig. 4). To further extract information of SEEG data from a more comprehensive perspective, we also introduce the features from frequency domain by computing the spectral powers in different frequency bands  of each segment (Sec. 4.1.2). Finally, based on the learned representations, from time and frequency domains, we adopt channel background subtraction and brain region enhancement techniques to handle the challenge of domain shift (Sec. 4.2).

### SEEG Representation Learning

#### 4.1.1 Self-supervised Learning Framework

Self-supervised learning is effective in extracting features for time series [6; 25; 26] and robust to data imbalance [6; 27]. Considering that the SOZ localization is critical for epilepsy diagnosis and treatment, the seizures should be detected on each channel located in different brain areas. However, different brain regions exert a great variety of brain functions  and often exhibit different seizure patterns . Therefore, learning representations that preserve the unique patterns of each channel is more consistent with the physiological mechanism of seizures. Thus we design _channel discrimination_ and _context swapping_ tasks (shown in Fig. 3) considering significant discrimination of channels and contextual coherence of SEEG data, respectively.

Figure 3: Self-supervised pretraining of PPi. The pretraining is mainly performed by the two self-supervised tasks shown in the figure. In each task, the pairs sampled by contextual pairwise sampling will be properly processed according to the task and a discriminator is employed to discriminate the postive and negative samples (Sec. 4.1.1). The pretrained encoder will be used for the seizure detection (shown in Fig. 4).

Contextual pairwise sampling.It is unreasonable to predict whether a short segment is onset or not without contextual data because seizure patterns may vary greatly between different patients and even between different channels of the same patient. To overcome the limitation, we are inspired by the empirical criteria of neurosurgeons in judging seizures that the waveform characteristics of the seizure segment are significantly different from those of nearby normal signals, which is also quantified by Smith  as more spikes and sharp waves. Therefore, we introduce the nearby contextual information of a segment in our self-supervised tasks to enhance the discrimination ability of segment representations for detecting seizures. Specifically, the input covers not only the target segment \(_{c,k}\) which will be predicted (defined in Sec. 3), but also the \(h\) nearby segments on the left and right, which are called the _context above_ and _context below_ of \(_{c,k}\) respectively (See Fig. 3). The whole sequence we sample for the target segments \(_{c,k}\) is denoted as \(_{c,k}\). Contextual pairwise sampling is then defined as the operation of randomly sampling two sequences \(_{c_{1},k_{1}}^{m},_{c_{2},k_{2}}^{m}\) from channel \(c_{1}\) and \(c_{2}\) respectively, where \(m\) is the index for the sample set.

Channel discrimination.In order to preserve the unique characteristics of each channel, the model should identify how channels are different from each other. Motivated by this, we design a task guiding the model to differentiate whether the given two sequences are from the same channel or not. Specifically, we first sample a sequence pair \(_{c_{1},k_{1}}^{m_{1}},_{c_{2},k_{2}}^{m_{1}}\) by contextual pairwise sampling, where the two sequences are sampled from the same or different channels with equal probability. Then \(_{c_{1},k_{1}}^{m_{1}},_{c_{2},k_{2}}^{m_{1}}\) will be encoded to feature vectors \(_{c_{1},k_{1}}^{m_{1}},_{c_{2},k_{2}}^{m_{1}}\). We next obtain the difference vectors by computing an element-wise absolute difference:

\[_{cd}^{m_{1}}=(_{c_{1},k_{1}}^{m_{1}}-_{c_{2},k_{2 }}^{m_{1}}).\] (1)

After that, we utilize a discriminator to predict whether the sampled sequence pair comes from the same channel or not. We apply the binary cross-entropy, denoted as \(_{cd}\), as the loss function of the channel discrimination task. Meanwhile, to avoid representation collapse and exploit the information from time domain, we apply a decoder to reconstruct the original sequences, denoted as \(}_{c_{1},k_{1}}^{m_{1}},}_{c_{2},k_{2}}^{m_{1}}\). Based on \(M_{1}\) sequence pairs sampled in the channel discrimination task, the objective function for the reconstruction task is defined as:

\[_{rec}=_{m_{1}=1}^{M_{1}}(\|_{c_{1},k_{1}}^{m_{1}}-}_{c_{1},k_{1}}^{m_{1}}\|^{2}+\|_{c_{2},k_{2}}^{m_{1}}- }_{c_{2},k_{2}}^{m_{1}}\|^{2}).\] (2)

Context swapping.Given that the model leverages contextual information to detect seizures, we also need to enhance the coherence semantic uniqueness of SEEG data. We then propose a task leading the model to identify whether the context has been replaced by that of other channels. First, we also adopt contextual pairwise sampling to sample two sequences from different channels. For the sampled sequence pair, we perform the swapping operation according to the following rules: (1) swap their context above with a probability of \(0.25\); (2) swap their context below with a probability of \(0.25\); (3) do not swap, otherwise. We do not perform reconstruction task here by reason of possibly corrupted sequences. After the processed data is fed into the encoder, we concatenate the encoded representations of the sequence pair to obtain the joint vectors. Finally, an MLP-based discriminator is utilized to discriminate whether the joint vectors are from swapped sequence pair or not. The binary cross-entropy, denoted as \(_{cs}\), is also employed as the objective function of the context swapping.

Putting the objective functions all together, the overall self-supervised model will be jointly trained according to the objective function given by \(_{ssl}=_{rec}+_{cd}+_{cs}\).

#### 4.1.2 Frequency Domain Features

The proposed self-supervised learning tasks have a good capability of extracting features from time domain. To exploit SEEG data from a more comprehensive view, we adopt PSD (power spectral density), which has the ability to track the transient changes before and during seizure , to extract features from frequency domain. The PSD of a signal describes the distribution of the signal's total average power over frequency. Specifically, we first split the frequency domain into several bands according to the standard description for rhythmic activity : (1) \(\) (4-8Hz), (2) \(\) (8-13Hz), (3) \(\) (13-30Hz), (4) \( 1\) (30-50Hz), (5) \( 2\) (50-70Hz), (6) \( 3\) (70-90Hz), (7) \( 4\) (90-110Hz), (8) \( 5\) (110-128Hz). The absolute spectral power of a signal in a frequency band is then computed as the logarithm of the sum of PSD coefficients within that frequency band. Mathematically, for segment \(_{c,k}\), the absolute spectral power in the \(i\)-th frequency band is computed as:

\[P^{i}_{c,k}=_{(i)}PSD_{_{c,k}}(),\ \ \ i\{1,2,,8\}.\] (3)

In order to capture underlying correlations between different frequency bands and local patterns of contextual segments, the spectral powers will be encoded by a CNN-based encoder to obtain the representations from frequency domain of SEEG signals.

After obtaining the time domain representations from self-supervised learning tasks and frequency domain representations from spectral powers, a self-attention strategy is used to adaptively aggregate them to obtain the segment representations \(_{c,k}\).

### Patient-independent Seizure Detection

In order to solve the domain shift problem, we propose an assumption from a higher-order perspective that the differential distribution of normal and seizure segments of channels located in the same brain region would be similar in different patients. The assumption is reasonable because of the similarity in structure and function of the same brain region among patients, and the case study in Sec. 5.6 further supports it. Therefore, based on the assumption, we design two techniques called channel background subtraction and brain region enhancement, which fully consider the characteristics of SEEG, to align the data distribution between patients.

Channel background subtraction.

``` for\(c=0,1,,C-1\)do\(_{c,0}_{c,0}\) \(n_{c} 1\) \(_{c,0} 0\)1 for\(k=1,2,,K-1\)do\(_{c,k}_{c,k-1}\) if\(_{c,k-1}<0.5\)then\(_{c,k}_{c,k} n_{c}+_{c,k-1}}{n_{c}+1}\) \(n_{c} n_{c}+1\)  endif \(^{}_{c,k}_{c,k}-_{c,k}\)  Predict the seizure probability \(_{c,k}\) using \(^{}_{c,k}\) endfor endfor ```

**Algorithm 1** Background Representation Calculation

Channel background subtraction enables the model to exclusively focus on the differences between seizure and normal segments of each channel, which aligns the distribution of channels within the same brain region across patients. In the field of neuroscience, Staba and Worrell  prove that the background brain activity, which refers to the brain activity when individuals are at rest or during sleep, contains important information about brain function and dysfunction in epilepsy. In our scenario, given the patient's limited mobility while monitored by SEEG, background is regarded as the SEEG signal in the absence of epileptic seizures. Therefore, we calculate the background representation \(_{c,k}\) for the segment representation \(_{c,k}\) as the average of all the segment representations _currently_ (before index \(k\)) predicted to be normal in channel \(c\). We show the details of the iterative updating method in Algo. 1. In channel background subtraction, \(_{c,k}\) will subtract \(_{c,k}\) to obtain the difference representation \(^{}_{c,k}\). The operation aligns the distribution of channels located in the same brain region between patients, which is supported by the case study in Sec. 5.6.

Figure 4: Overall architecture of PPi. The representations encoded from the pretrained encoder and spectral powers (Sec. 4.1.2) are aggregated by a self-attention strategy to obtain the aggregated representation \(_{c,k}\). \(_{c,k}\) is then be processed by channel background subtraction and brain region enhancement to obtain the difference representation \(^{}_{c,k}\) for seizure detection (Sec. 4.2).

Brain region enhancement.Channel background subtraction has aligned channel representations with similar latent differential distributions. However, with prior information of brain regions, explicit supervised learning can further constrain the differential distribution of channels in the same brain region between different patients, thus enhancing the generalization of PPi. Therefore, we extend the classification task from binary to multi-class, so that the classifier not only predicts whether the seizure occurs, but also determines which brain region the seizure locates in2. Specifically, taking \(^{}_{c,k}\) as input, the classifier outputs a tuple \((i_{c,k},y_{c,k})\), where \(i_{c,k}\) is the index of the brain region that \(s_{c,k}\) locates in and \(y_{c,k}\{0,1\}\) is the prediction of whether \(s_{c,k}\) is seizure or not. For the implementation, we construct integer multi-class labels by converting the tuple \((i_{c,k},y_{c,k})\) to an integer \(y^{}_{c,k}\): \(y^{}_{c,k}=i_{c,k}*2+y_{c,k}\). Therefore, the parity of \(y^{}_{c,k}\) reflects whether the prediction result corresponds to a normal state or a seizure. We use a cross-entropy loss as the objective function of brain region enhancement.

## 5 Experiments

### Dataset

Public datasets.The public datasets used in our paper, MAYO and FNUSA , are collected from two institutions: the Mayo Clinic (Rochester, Minnesota, United States of America) and St. Anne's University Hospital (Brno, Czech Republic), respectively. The MAYO dataset has 18 patients in total, including 56730 normal samples and 15227 seizure samples, respectively. The FNUSA dataset has 13 patients in total, including 94560 normal samples and 52470 seizure samples, respectively. For each dataset, we first remove the power line noise and down sample the dataset to 500Hz. Then we divide the patients into 6 groups without overlapping (details in App. B). We randomly choose 5 groups as the source domains (4 of which are used for training and 1 for validation) and the remaining group serves as the target domain. The experiments are repeated on all groups to test the average performance.

Clinical dataset.The clinical SEEG dataset we collect is from a first-class hospital. For the patients, 4 to 10 invasive electrodes with 52 to 126 channels are implanted in the brain to obtain 1000Hz SEEG signals. Since the clinical data are recorded with a high frequency on multiple channels, the dataset has more than 738 hours of recording and contains 123 patient files with an average size of 7.1 GB each. As for the annotation, professional neurosorgeons participate in seizure labeling. The positive sample ratio of a single patient in the dataset is around 0.004 on average, which is extremely imbalanced. We remove the power line noise and down sample the dataset to 250Hz. For the 7 patients in the clinical dataset, we split the patients into training, validation and test set with 5, 1 and 1 patients, respectively. We also repeat the experiments on all patients to obtain an overall results.

### Experimental Setup

To evaluate the performance of the models, we conduct adequate experiments on two public datasets (MAYO and FNUSA) and the real-world clinical dataset. All experiments run on a Linux system with 2 CPUs (AMD EPYC 7H12 64-Core Processor) and 4 GPUs (NVIDIA GeForce RTX 3090). Our code is available at https://github.com/yzz673/PPi_public.

Evaluation Metrics.To comprehensively evaluate the experimental results, we use precision, recall, F1 and F2 as evaluation metrics. Here the F-score can be calculated by \(F_{}=) precision recall}{^{2} precision +recall}\). Usually, F2 is adopted in critical applications that value information retrieval more than accuracy (i.e., accepting a relatively large number of false positives but virtually guaranteeing that all the true positives are found). In our medical scenario, F2 is more valued than F1, since ignoring any seizure is costly in diagnosis.

Baselines.We compare our model with some DG methods for brain signals (SICR , SEEGNet ). Also, we compare with other DG algorithms designed for more general fields(CDANN , CORAL , GroupDRO , MLDG , MMD , MTL , SANDMask , SD , SelfReg , TRM , VREx , IB-ERM , IB-IRM  ) and adopt two different feature extractors (TCN , MiniRocket ) to evaluate their performance based on different kinds of features. Furthermore, we select some self-supervised learning approaches for brain signals (BENDR ) and time series (Franceschi et al. ). More details of the baselines are shown in App. A.

### Experimental Result

Tab. 1 summarizes the main results of our model and baselines on the two public datasets and the clinical dataset. Overall, our model outperforms all baselines on every metric on the three datasets, which demonstrates the excellent performance of PPi in the patient-independent seizure detection on SEEG data.

On the public datasets, PPi improves the performance3 by _38.10%_ and _24.98%_ over the best-performing baseline model in terms of F2-score respectively, showing that PPi has stronger generalization ability in seizure detection than other baselines. On our clinical dataset, PPi improves the performance by _54.93%_ on F2-score. Compared with other baselines that treat all channels equally, our designed self-supervised tasks can preserve more unique characteristics of each channel. These tasks help our model to learn more informative representations from SEEG data, leading to a much better performance on channel-level seizure detection. For SEEG-Net  which also focuses on patient-independent seizure detection on SEEG, it can maintain a more balanced precision and recall than other baselines, and achieves almost the second/third highest F1-score in all datasets. The possible reason for its good performance is that SEEG-Net also considers the contextual information of SEEG data like our model. However, PPi still outperforms SEEG-Net by a large margin, as PPi

   } &  &  &  \\   &  &  & F1 & F2 & Pre. & Rec. & F1 & F2 & Pre. & Rec. & F1 & F2 \\    } & CDANN & 16.13 & 468.14 & 24.74 & 37.84 & 32.71 & 69.62 & 43.09 & 54.88 & 1.42 & 44.20 & 2.72 & 6.08 \\  & CORAL & 17.01 & 64.08 & 25.73 & 38.30 & 33.87 & 65.46 & 43.63 & 53.84 & 1.59 & 47.24 & 3.03 & 6.64 \\  & GroupDRO & 17.26 & 64.25 & 26.02 & 38.68 & 33.24 & 62.14 & 41.90 & 51.27 & 1.53 & 47.13 & 2.91 & 6.35 \\  & MLDG & 18.88 & 61.38 & 27.96 & *40.39 & 32.81 & 56.81 & 40.41 & 48.24 & 28.85 & 6.68 & 2.55 & 2.58 \\  & MMD & 15.79 & 67.41 & 24.45 & 37.68 & 32.87 & 69.38 & 43.51 & 55.30 & 1.90 & 46.84 & 3.26 & 6.59 \\  & MTL & 16.13 & 51.87 & 22.56 & 17.47 & 32.70 & 53.10 & 38.48 & 44.78 & 1.43 & 9.19 & 2.30 & 3.73 \\  & SANDMask & 16.47 & 68.66 & 25.00 & 38.15 & 32.16 & 59.46 & 39.62 & 48.59 & 1.34 & 47.22 & 2.60 & 5.95 \\  & SD & 15.29 & 60.70 & 23.10 & 34.67 & 34.30 & 65.54 & 43.77 & 53.88 & 1.52 & 46.46 & 2.91 & 6.38 \\  & SelfReg & 9.42 & 58.65 & 15.06 & 22.95 & 25.35 & 66.75 & 35.87 & 48.79 & 0.92 & 44.48 & 1.76 & 3.94 \\  & TRM & 16.94 & 59.60 & 24.47 & 35.67 & 34.32 & 62.26 & 43.39 & 51.93 & 1.53 & 47.34 & 2.91 & 6.35 \\  & VREx & 16.74 & 60.41 & 25.06 & 36.87 & 33.17 & 61.75 & 41.84 & 51.11 & 10.98 & 42.17 & 2.78 & 5.33 \\  & IB-ERM & 17.27 & 64.29 & 26.04 & 38.71 & 34.34 & 62.94 & 24.93 & 52.22 & 1.53 & 47.34 & 2.91 & 6.35 \\  & IB-IRM & 16.75 & 60.45 & 25.08 & 36.90 & 34.26 & 63.06 & 43.10 & 52.44 & 1.52 & 45.65 & 2.89 & 6.31 \\    } & CDANN & 16.22 & 15.44 & 15.14 & 15.20 & 48.73 & 36.97 & 38.26 & 37.02 & 2.09 & 45.27 & 3.98 & 8.68 \\  & CORAL & 47.61 & 25.30 & 27.57 & 25.46 & 68.46 & 46.55 & 25.00 & 48.36 & 1.68 & 42.54 & 3.20 & 7.08 \\  & GroupDRO & 41.99 & 34.02 & 35.98 & 34.49 & 69.79 & 48.74 & 55.31 & 50.83 & 1.37 & 46.95 & 2.64 & 6.03 \\  & MLDG & 10.32 & 50.04 & 15.35 & 24.70 & 34.67 & 63.56 & 37.88 & 46.75 & 0.52 & 15.58 & 1.01 & 2.29 \\  & MMD & 22.34 & 21.82 & 19.58 & 20.33 & 69.33 & 46.63 & 50.04 & 47.06 & 5.10 & 39.97 & 3.95 & 7.55 \\  & MTL & 21.67 & 46.11 & 27.72 & 35.03 & 56.85 & 79.56 & 59.82 & 12.57 & 45.79 & 4.02 & 5.15 \\  & SANDMask & 4.32 & 33.33 & 7.40 & 13.14 & 12.56 & 33.33 & 18.14 & 24.88 & 1.49 & 44.87 & 2.59 & 4.73 \\  & SD & 37.57 & 30.90 & 32.46 & 31.10 & 68.74 & 50.59 & 53.26 & 50.92 & 6.40 & 39.73 & 9.43 & 15.29 \\  & SelfReg & 31.09 & 14.46 & 18.02 & 15.65 & 61.18 & 33.26 & 39.29 & 34.99 & 16.33 & 42.06 & *14.51 & 16.61 \\  & TRM & 35.97 & 40.34 & 35.51 & 37.15 & 66.32 & 53.63 & 53.50 & 52.68 & 50.00 & 33.31 & 7.81 & 12.51 \\  & VREx & 38.63 & 33.92 & 33.37 & 32.88 & 65.23 & 55.20 & 54.34 & 53.91 & 7.44 & 44.50 & 11.37 & *17.11 \\  & IB-ERM & 35.02 & 43.92 & 36.79 & 39.62 & 66.34 & 53.41 & 53.17 & 52.40 & 4.94 & 43.01 & 8.12 & 13.79 \\  & IB-IRM & 3not only preserve unique characteristics of each channel, but also introduces the extra information of brain regions to enhance the generalization ability. In particular, we achieve better improvement on clinical dataset (_54.93%_ on F2-score) compared with the public datasets (_38.10%_ and _24.98%_ on F2-score) mainly because the self-supervised pretraining on unlabeled data reduces reliance on labels, which makes PPi more adaptive to extremely imbalanced dataset than other supervised methods.

### Ablation Study

To evaluate the effectiveness of each component in our model, we first conduct ablation experiments on four model variants to verify the effectiveness of the proposed self-supervised framework, including: (1) PPi-\(SSL_{1}\): PPi without the channel discrimination task; (2) PPi-\(SSL_{2}\): PPi without the context swapping task; (3) PPi-\(SSL\): PPi without all self-supervised tasks; (4) PPi-reconstruction: PPi without reconstruction loss. Then we use PPi-power: PPi without features of spectral powers, to demonstrate the benefits of introducing PSD based features. For the aggregation strategy, we replace the self-attention with mean pooling (denoted as PPi-self attention). Another two experiments are conducted to verify the significant generalization ability of our two techniques respectively, which are denoted as PPi-background and PPi-brain region. Due to the requirement of brain region labeling in brain region enhancement, the lack of such labels makes brain region enhancement inapplicable to the two public datasets.

The comparison results of the ablation experiments on all the three datasets are presented in Tab. 2. It shows that PPi beats other model variants on all metrics, proving the contribution of each component in our model. The performances of the variants that remove the self-supervised tasks drop greatly, which shows that our designed self-supervised tasks are capable of extracting informative representations from large amount imbalanced SEEG data. PPi-background and PPi-brain region cannot achieve performances that are competitive with the full model, validating the strong generalization ability of PPi to handle the huge domain shift across different patients. The improvement is empowered by the channel background subtraction and brain region enhancement techniques, which will be explored further in Sec. 5.6.

### Hyperparameter Analysis

The contexts half length \(h\) (i.e. the length of context above or context below) is an important hyperparameter in PPi. Thus we evaluate the performance on the clinical dataset under different contexts half length (shown in Fig. 5). The results exhibits an increase of performance as \(h\) becomes larger, which illustrate that introducing the contexts of the target segment to increase the receptive field allows the model to compare the target segment with its nearby waveforms, resulting in better performance. However, the increase of contexts half length is also accompanied by a higher computational overhead, necessitating consideration of trade-offs when selecting the value of \(h\).

   ModelDataset &  &  &  \\   & Pre. & Rec. & F1 & F2 & Pre. & Rec. & F1 & F2 & Pre. & Rec. & F1 & F2 \\  PPi-\(SSL_{1}\) & 43.69 & 48.01 & 31.22 & 35.37 & 58.46 & 59.39 & 56.05 & 57.27 & 20.68 & 44.23 & 19.13 & 24.63 \\ PPi-\(SSL_{2}\) & 40.69 & 38.32 & 34.72 & 35.74 & 47.69 & 50.53 & 46.79 & 48.42 & 20.75 & 42.82 & 18.72 & 23.73 \\ PPi-\(SSL\) & 35.65 & 22.89 & 25.92 & 23.77 & 69.00 & 44.29 & 53.04 & 47.29 & 7.53 & 30.75 & 10.94 & 16.08 \\ PPi-reconstruction & 44.01 & 50.29 & 34.15 & 36.89 & 7.88 & 62.31 & 59.48 & 60.02 & 20.44 & 38.44 & 21.23 & 25.01 \\ PPi-power & 48.60 & 31.43 & 29.01 & 28.31 & 62.89 & 54.48 & 56.77 & 55.13 & 28.13 & 30.48 & 19.75 & 20.87 \\ PPi-self attention & 48.82 & 60.20 & 51.15 & 55.41 & 65.14 & 66.91 & 62.17 & 63.98 & 28.67 & 46.98 & 29.56 & 32.59 \\ PPi-background & 46.80 & 31.31 & 31.08 & 30.05 & 57.83 & 50.20 & 51.68 & 50.28 & 20.42 & 35.40 & 21.83 & 26.74 \\ PPi-brain region & - & - & - & - & - & - & - & - & 18.01 & 46.86 & 21.53 & 28.33 \\  PPi & **49.85** & **69.67** & **54.35** & **61.07** & **71.73** & **70.81** & **70.61** & **70.55** & **29.76** & **47.59** & **30.92** & **35.51** \\   

Table 2: Results of ablation experiments on two public datasets and the clinical dataset.

Figure 5: Performance on clinical dataset under different contexts half length \(h\).

### Case Study

Visual analysis of channel background subtraction.To handle domain shift, PPi adopts channel background subtraction which has the ability to align the distribution of the same brain region from different patients. In the visual analysis, we visualize such ability by comparing the aggregated representation \(_{c,k}\) (before subtraction) and the difference representation \(^{}_{c,k}\) (after subtraction) using t-SNE  plots. Specifically, we select two channels which locate in the same brain region from two different patients (denoted as \(p_{i}\), \(p_{j}\)) (results for more patients are shown in App. D.1). The t-SNE plots of their aggregated representations and difference representations are shown in Fig 6. The aggregated representations of \(p_{i}\) and \(p_{j}\) obviously exhibit different distributions. After channel background subtraction, the distributions of the samples from \(p_{i}\) and \(p_{j}\) are very close, which illustrates that channel background subtraction successfully aligns the distribution space of the channels located in the same brain region between patients.

Confusion matrix of brain region enhancement.In order to demonstrate the effectiveness of brain region enhancement, we calculate the confusion matrix of the multi-classification. Fig. 7 shows the confution matrix from one of the patients (the confusion matrix of all the patients are shown in App. D.2), in which the vertical axis represents the multi-class label and the horizontal axis represents the multi-class prediction results. In the confusion matrix, most samples are distributed on the main diagonal, which reflects the good performance of the multi-classification task, illustrating the effectiveness of brain region enhancement.

## 6 Conclusion

In this paper, we propose PPi to conduct patient-independent seizure detection on SEEG in the clinical scenario. To detect seizures more accurately, PPi adopts a self-supervised pretraining strategy to extract information from SEEG signals while preserving the unique characteristics of each channel. Furthermore, we propose channel background subtraction and brain region enhancement to improve the generalization ability of PPi. Extensive experiments demonstrate the superior performance of PPi in the patient-independent seizure detection on two public and a clinical SEEG datasets (Sec. 5.3). The case study (Sec. 5.6) further illustrate the effectiveness of our proposed two techniques to reduce the huge domain shift between different patients.

Limitations and future works.Compared with EEG, SEEG is an emerging technique and the related research is limited. Although our work outperforms other methods by a large margin on the clinical dataset, in applications, the predicted results of PPi are mainly serve as a reference to assist doctors to achieve more efficient clinical diagnosis and treatment, rather than completely replace doctors in seizure detection. For the application, we have reached a cooperation with a first-class hospital and a related institution that is responsible for the development of an application software. In the future, our model will be integrated into the software to assist doctors in seizure diagnosis.