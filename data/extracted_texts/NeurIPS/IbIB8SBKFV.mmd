# Improving Alignment and Robustness with Circuit Breakers

Andy Zou\({}^{1,2,3}\), Long Phan\({}^{3}\), Justin Wang\({}^{1}\),

**Derek Duenas\({}^{1}\), Maxwell Lin\({}^{1}\), Maksym Andriushchenko\({}^{1}\), Rowan Wang\({}^{1}\),**

**Zico Kolter\({}^{1,2}\), Matt Fredrikson\({}^{1,2}\), Dan Hendrycks\({}^{1,3}\)**

\({}^{1}\)Gray Swan AI, \({}^{2}\)Carnegie Mellon University, \({}^{3}\)Center for AI Safety

Work done while at Gray Swan AI. \({}^{1}\)Work done in advising capacity to Gray Swan AI.

Correspondence to: andy@grayswan.ai

###### Abstract

AI systems can take harmful actions and are highly vulnerable to adversarial attacks. We present an approach, inspired by recent advances in representation engineering, that interrupts the models as they respond with harmful outputs with "circuit breakers." Existing techniques aimed at improving alignment, such as refusal training, are often bypassed. Techniques such as adversarial training try to plug these holes by countering specific attacks. As an alternative to refusal training and adversarial training, circuit-breaking directly controls the representations that are responsible for harmful outputs in the first place. Our technique can be applied to both text-only and multimodal language models to prevent the generation of harmful outputs without sacrificing utility--even in the presence of powerful unseen attacks. Notably, while adversarial robustness in standalone image recognition remains an open challenge, circuit breakers allow the larger multimodal system to reliably withstand image "hijacks" that aim to produce harmful content. Finally, we extend our approach to AI agents, demonstrating considerable reductions in the rate of harmful actions when they are under attack. Our approach represents a significant step forward in the development of reliable safeguards to harmful behavior and adversarial attacks. Code is available at github.com/GraySwanAI/circuit-breakers.

## 1 Introduction

The landscape of artificial intelligence (AI) has long been marred by the persistent threat of adversarial attacks, particularly those targeting neural networks. These attacks exploit inherent vulnerabilities within AI systems, often leading to compromised outputs and raising concerns regarding their reliability and safety. Despite significant attention, existing mitigations have failed to achieve high reliability without dramatically compromising model performance. Thus, the trade-off between adversarial robustness and utility is widely accepted as an unavoidable fact .

The rise of generative models has further complicated this issue. Generative models such as large language models (LLMs) can output copyrighted information or defame individuals, and agents can take harmful actions. To make models less harmful, they are "aligned" with refusal training , but it has become common to use adversarial attacks as a means of bypassing their safeguards. In these settings, vulnerability to attacks that break alignment poses a serious threat to utility, and raises pressing questions about whether it is feasible to deploy such systems with a high standard of safety and reliability--especially against dedicated adversaries who intend to misuse them.

The fragility of alignment techniques to sophisticated attacks has motivated defenses that target specific attack methods, such as adversarial training, an approach originally proposed in the contextof standalone image classification  and later adapted to LLMs . However, these methods often fail to generalize to new attacks that were unseen during training, and they introduce penalties on model capabilities that are usually proportional to gains in robustness. System-level defenses, including input and output filters, are cumbersome, resource-intensive, and often remain vulnerable to adversarial techniques. This has led to a growing concern that robust defenses may be unattainable.

We propose a novel approach outlined in Figure 1 that fundamentally diverges from traditional defenses: instead of attempting to remove vulnerabilities to specific attacks, our approach aims to directly circumvent the ability of the model to produce the harmful output in the first place. With circuit breakers, we make models intrinsically safer and reduce their risks by removing _intrinsic model hazards_--their ability to produce harmful outputs--rather than removing specific _vulnerabilities_ with adversarial training, and rather than attempting to reduce _exposure_ to attacks with input filters . Using representation engineering (RepE) , our method connects the internal representations related to harmful outputs to circuit breakers so that when a model begins to generate such an output, its internal processes are interrupted, halting completion of the generation. Or this method is "short-circuiting" the harmful processes as one might put it. Because the representation used to generate a harmful output is independent of any attack capable of eliciting it, this approach is attack-agnostic, and sidesteps the need for additional training, costly adversarial fine tuning, or the use of auxiliary "guard" models. Consequently, the resulting model with circuit breakers can be used normally without additional computational burden, and seamlessly integrated with existing monitoring and protection mechanisms.

Experimentally, we demonstrate that a circuit-breaking technique, Representation Rerouting (RR), notably improves the alignment of LLMs. It enhances the harmlessness of state-of-the-art LLMs, including against against a wide array of _unseen_ adversarial attacks, including embedding and representation-space attacks--namely, proxies for worst-case assumptions about attacker capabilities. Figure 2 and Table 1 present an overview of these results. Our method significantly outperforms standard refusal training and adversarial training, while imposing almost no penalty on standard capability. Notably, we integrate circuit-breaking with additional model control methods to develop

Figure 1: Introduction of circuit-breaking as a novel approach for constructing highly reliable safeguards. Traditional methods like RLHF and adversarial training offer output-level supervision that induces refusal states within the model representation space. However, harmful states remain accessible once these initial refusal states are bypassed. In contrast, inspired by representation engineering , circuit breaking operate directly on internal representations, linking harmful states to circuit breakers. This impedes traversal through a sequence of harmful states.

a Llama-3-8B-Instruct finetune called Cygnet. This enhanced model not only surpasses its original capabilities but also exhibits a large reduction in harmful output by approximately _two orders of magnitude_, even when confronted with unforeseen adversarial attacks. To the best of our knowledge, this is the first convincing demonstration of the feasibility of designing techniques that significantly advance the Pareto frontier of capability versus harmlessness for LLMs, illustrating that such trade-offs can be effectively managed. When applied to multimodal models, our results show marked increases in harmlessness. It also improves robustness against image-based attacks aimed at similarly circumventing model safeguards, again with almost no penalty on benchmarked capabilities. This remains true even in the presence of the Projected Gradient Descent (PGD) attack , which defenses for standalone image classifiers have been unable to achieve without a steep trade-off in accuracy. Finally, we apply circuit breakers to AI agents, illustrating its efficacy in controlling agent behaviors through evaluations on a new agent function-calling safety benchmark.

Our findings introduce a new paradigm for creating models that do not produce harmful outputs. Our method is highly robust against adversarial attacks, providing a promising path forward in the adversarial arms race. By ensuring safety and security without compromising capability, our approach increases the chances that we may ultimately be able to deploy robust AI systems in real-world applications.

## 2 Related Work

Adversarial attacks on LLMs. Numerous manually written attack prompts on modern LLMs have been discovered [49; 68], forming the basis of _red teaming_ for frontier LLMs [50; 5; 55], though it lacks standardization . Automated red teaming has been shown effective in Perez et al. , Chao et al. , Mehrotra et al. , Zeng et al. . Notably, transfer attacks using an adversarial suffix via gradient-based optimization were demonstrated by Zou et al. . White-box access also facilitates prefilling attacks [67; 2], leading the LLM to generate harmful outputs. For a comprehensive summary of automated attacks, we refer to HarmBench . Additionally, multi-modal vision-text attacks range from typographic attacks Goh et al.  to gradient-based optimization [9; 59; 6]. LLM agents have been benchmarked [35; 45], but their safety and robustness remain unexplored.

Defenses for LLMs. Our new defense addresses limitations in existing mechanisms. Widely used defenses include RLHF [12; 52] and DPO  using human annotations for safe vs. unsafe responses , but they often fall short against state-of-the-art adversarial attacks [78; 2]. Additional robustness is achieved by methods like Zhou et al. , which optimize prompts to refuse harmful requests. Inspired by adversarial training in vision , fine-tuning for the R2D2 model against the GCG attack  shows limited generalizability and drops MT-Bench scores . Adversarial training for LLMs can be highly computationally expensive. Inference-time defenses, such as perplexity filters [1; 26],

Figure 2: Adding circuit breakers using Representation Rerouting (RR) to refusal trained Llama-3-8B-Instruct model leads to significantly lower attack success rate (ASR) over a wide range of _unseen_ attacks on HarmBench prompts , while its capabilities on standard LLM benchmarks (MT Bench and MMLU) are largely preserved. RR directly targets the representations that give rise to harmful outputs and reroutes them to an orthogonal space. This reliably interrupts the model from completing the harmful generations even under strong adversarial pressure.

are effective only against non-adaptive attacks , while erase-and-check and SmoothLLM  incur high computational costs. System-level defenses against unsafe inputs or outputs [20; 25; 27] can still be circumvented by sophisticated adversaries . The main conceptual difference is that instead of operating on input or output text, our method operates directly on representations which provides a more generalizable and computationally cheap solution.

**Representation Engineering.** As many contemporary defenses relying solely on supervising model outputs fail to achieve the desired levels of controllability and reliability, techniques that analyze and manage model's internal representations have garnered increased attention. This includes research ranging from uncovering emergent interpretable structures in intermediate representations [77; 46; 10], to the identification and modification of embedded knowledge [48; 42; 43], as well as steering model outputs [66; 7; 33; 24; 65]. Most relevant to our work is the control vector baseline introduced in the representation engineering paper , which can be applied to enhance large language models' resistance to adversarial attacks. Alongside the use of control vectors, they introduce an approach that bends representations with representation-level losses. Recent advancements extend this method to robustly unlearn hazardous knowledge  with a method termed RMU, demonstrating the potential of representation engineering for more complex objectives. Previous work has attempted to eliminate harmful circuits using bottom-up mechanistic interpretability, but these methods have proven insufficient . Building on these foundations and further expanding RMU to a family of circuit-breaking techniques, we design a methodology based on _model representations_ for robust alignment and control by preventing the generation of harmful outputs.

## 3 Circuit Breaking with Representation Engineering

In this section, we introduce a novel approach aimed at mitigating the generation of harmful outputs in neural networks by inducing a new type of phenomenon called "circuit-breaking." This phenomenon can be elicited using a family of techniques designed to monitor or remap model representations related to harmful processes, redirecting them towards incoherent or refusal representations. This process is reminiscent of "short-circuiting," where harmful representations are "shorted" and intercepted by circuit breakers. The core objective of this method is to robustly prevent the model from producing harmful or undesirable behaviors by through monitoring or controlling the representations.

Our focus on generative models--such as language and multimodal agents--presents a unique opportunity. Generative models inherently involve multi-step processes through which outputs are produced. When devising an attack, adversaries must effectively exert influence across each step of the targeted processes, so each step presents an opportunity to make the model more robust to attack. This insight drives our strategy, which focuses on disrupting adversarial control of the relevant multi-step processes rather than the binary classification problem of attempting to detect the presence of an attack. Building from techniques in representation engineering (RepE) , we accomplish this by remapping the sequence of model representations that leads to harmful outputs, directing them towards incoherent or refusal representations--namely, _breaking the circuit_, or _shorting the circuit_ as one might put it. Moreover, by directly targeting the processes involved in generating harmful responses, our method can generalize across the diverse range of inputs that may activate those processes. Consequently, we do not need to identify all of the potential inputs that could trigger undesirable outputs, rather we only need to ensure coverage of a well defined set of such outputs.

The applications of circuit breakers are multifaceted. They can be utilized to prevent the generation of harmful outputs in general, as well as to prevent more narrowly tailored types of output, such as private information or copyrighted material. The approach is versatile, as it is possible to identify and remap the relevant representations in virtually any neural network architecture.

The family of circuit-breaking techniques is characterized by two major components: datasets and loss functions. Algorithm 1 presents a circuit-breaking technique that uses Low-Rank Representation Adaptation (LoRRA)  which we call Representation Rerouting (RR). The remainder of this section details this approach, and how the data and chosen loss function contribute to the effectiveness of the overall method.

Data.The training data used in RR is partitioned into two sets: the Circuit Breaker Set and the Retain Set, each serving distinct purposes within the training process aimed at controlling harmful processes in the model. As with all representation control methods, the quality of the circuit breaker mechanism largely depends on how precisely the data can elicit the targeted representation. The Circuit Breaker Set is comprised of examples that yield internal representations potentially leading to harmful or undesirable behaviors, and are used to prompt the model's circuit breaker mechanism. Conversely, the Retain Set includes examples that should not activate circuit breakers, and are used to maintain existing desirable model representations to retain benign efficacy. While even a limited number of examples in each set can sufficiently alter the model's behavior in a manner that generalizes beyond the training data, the resulting performance is generally improved when the training data better aligns with the domains we aim to break the circuit and retain.

For models with pre-existing refusal mechanisms, like Llama-3-Instruct, careful dataset curation is essential. Adding refusal data to the Retain Set enhances the model's ability to correctly refuse harmful user requests and improves retention of its capabilities. Another challenge is to elicit harmful responses from models with effective refusal mechanisms. To address this, we must curate a Circuit Breaker set that includes text capable of bypassing the refusal mechanism and triggering harmful

    & &  &  \\   & &  Refusal \\ Trained \\  &  Adv \\ Trained \\  &  + RR \\ (Ours) \\  &  Refusal \\ Trained \\  &  + RR \\ (Ours) \\  & 
 Cyber \\ (Ours) \\  \\  Capability (\(\)) & MT-Bench & **7.60** & 6.00 & 7.53 & 8.05 & 8.00 & **8.21** \\  & Open LLM & **65.4** & 61.2 & **65.4** & 68.8 & 68.3 & **71.9** \\   & No Attack & 57.8 & 16.5 & **4.9** & 12.4 & 1.2 & **0.0** \\  & Manual & 77.4 & 14.2 & **6.8** & 8.3 & **0.0** & **0.0** \\  & AutoDAN & 93.4 & 21.1 & **0.0** & 3.7 & **0.0** & **0.0** \\  & TAP-T & 85.8 & 68.7 & **17.5** & 17.4 & 2.1 & **0.0** \\  & PAIR & 69.5 & 59.9 & **23.3** & 18.7 & 7.5 & **0.0** \\ Robustness (\(\)) & GCG & 88.7 & **7.8** & 11.2 & 44.5 & 2.5 & **0.0** \\  & Multilingual & 34.1 & **4.7** & 7.3 & 19.3 & 3.5 & **0.0** \\  & Prefilling & 95.0 & 46.9 & **4.9** & 84.9 & 3.3 & **0.0** \\  & Input Embed & 92.1 & 46.3 & **15.7** & 80.4 & 9.6 & **7.9** \\  & RepE Attack & 73.7 & 30.7 & **6.2** & 91.2 & 8.7 & **0.0** \\   & Average & 76.7 & 31.7 & **9.8** & 38.1 & 3.8 & **0.8** \\   

Table 1: LLM evaluation results. Our circuit-breaking method Representation Rerouting (RR) shows strong generalization across a diverse range of unseen attacks, significantly reducing compliance rates to harmful requests while preserving model capability. Cygnet, a Llama-3-8B-Instruct finetune integrating circuit breakers and other representation control  methods, surpasses original capabilities and demonstrates a significant reduction in harmful output by roughly two orders of magnitude under strong attacks. This advancement shows promising initial steps in balancing capability and harmlessness in LLMs. Input embedding attack optimizes the soft input embeddings which is an unrealistically strong threat model for LLMs. Mistral-Adv Trained (R2D2)  is an SFT-only model.

processes. We find that a practical approach is to remove harmful user requests while keeping the corresponding harmful assistant responses in the Circuit Breaker Set. These measures ensure the refusal mechanism's integrity while allowing the model to activate its circuit-breaking function correctly once the refusal is bypassed. Ablation results are detailed in Section 4.4.

Loss.The accompanying losses for the datasets are the representation rerouting loss and retain loss. Denote the representation of harmful processes under the original model as \(_{}\) and under the model with circuit breakers as \(_{fb}}\). The rerouting loss is designed to remap representations from harmful processes \(_{fb}}\) to a desired target representation \(_{}\). Conversely, the retain loss is used to maintain representations within a retain set, which helps preserve these representations. This is often measured as the \(_{2}\) distance between the current and retain representations.

The rerouting loss can take various forms. One approach involves routing the targeted representation to a fixed random direction with a large norm, as utilized in the unlearning method RMU . This is expressed as \(\|_{fb}}-rand}\|_{2}\), where \(_{}\) is a random vector and \(\) is a large constant meant to amplify the norm of the representation. However, this approach requires extensive tuning of the \(\) parameter. We also explore a variant of the random vector loss that does not necessitate hyperparameter tuning, formulated as the \(_{2}\) norm of \(_{fb}}/\|_{fb}}\|- _{}/\|_{}\|\). However, the use of a random vector is neither necessary nor optimal. Given that we want the targeted representation to be as unhelpful as possible for the harmful processes, another approach is to directly optimize the circuit-broken representation to be orthogonal to the original representation responsible for harmful processes. This is given by their cosine similarity: \(_{fb}}-orig}/(\|_{fb}}\|_{2}\|_{}\|_{2})\). To avoid optimizing the similarity beyond zero, we apply a ReLU function to this objective. We find this loss to be the most intuitive and most effective in terms of achieving a balance between robustness and preserved capability. An implementation of RR using Low-Rank Representation Adaptation is shown in Algorithm 1. Additionally, one could map \(_{fb}}\) onto more semantically meaningful directions, such as a refusal direction or the embedding of the EOS token. We leave this to future work. Appendix C.1 discusses several additional design considerations.

## 4 Experiments

### Large Language Models

Adding Circuit Breakers.In our experimental setup, we employ similar circuit breaker and retain datasets for both the Mistral-7B-Instruct-v2  and Llama-3-8B-Instruct  models. Detailed information on the synthetic circuit breaker set for LLMs is provided in Appendix A.1. The retain set for both models includes UltraChat , comprising instructional conversations, and XSTest , an exaggerated refusal dataset. Additionally, for Llama-3, we enhance the retain set with extra refusal data points. We follow the implementation of Representation Rerouting (RR) specified in Algorithm 1

Figure 3: Circuit-breaking performance in multimodal settings with Representation Rerouting (RR). Under Projected Gradient Descent (PGD) attack, our LLaVA-NeXT-Mistral-7B (+ RR) with circuit breakers is significantly more robust compared to the original model even with a safety prompt that instructs the model to avoid harmful responses. Performance on multimodal capabilities benchmarks MMMU and LLaVA-Wild is preserved.

and select hyperparameters based on static attack test cases from HarmBench's validation set. More experimental details can be found in Appendix C.2.1.

**Evaluation.** We evaluate the harmfulness of the model using HarmBench , a standardized framework that includes harmful behaviors and a wide range of both black box and white box attacks. We select a subset of the strongest attacks reported on both open-source and closed-source models for evaluation. These attacks include gradient-based optimization (GCG ), LLM optimizers (PAIR ), custom jailbreaking pipelines (TAP-Transfer , AutoDAN , and HumanJailbreaks ). To further test the model, we incorporate a multilingual attack , and also introduce three powerful attacks that leverage system-level and representation-space access. We briefly describe these three additional attacks below, and provide a more detailed coverage in Appendix C.2.2.

1. **Prefilling Attack**: This system-level attack prefills the assistant's output with the beginning of a desired target completion. It leverages the autoregressive nature of LLMs, as it can be difficult for a model to "reverse-course" after it has started to generate harmful content. Prefilling is straightforward to implement for any open-weight model, and is also supported for some proprietary LLMs like Claude .
2. **Input Embedding Attack**: This white-box attack operates in the embedding space by optimizing a set of input embeddings directly instead of using hard tokens, with the objective of eliciting an affirmative assistant response .
3. **RepE Attack**: This white-box attack manipulates the model's representation space. Previous work in representation engineering demonstrates the identification of directional vectors in the model's representation space that correspond to refusals . By altering these vectors--either adding or subtracting--we can modulate the model's tendency to refuse requests.

We utilize HarmBench's LLM classifier to evaluate the attack success rate and manually verify the judgements. Detailed configurations for each attack are provided in Appendix C.2.2. To measure the capabilities of the models with circuit breakers, we evaluate our models on MTBench  for instruction-following abilities and on the OpenLLM Leaderboard  for knowledge and reasoning which includes MMLU , ARC-c , HellaSwag , TruthfulQA , Winogrande , and GSM8K . Table 5 contains a detailed breakdown of performance on each dataset. Additionally, we follow the methodology in  to construct an over-refusal evaluation, described in Appendix B. For baselines, we use the original Mistral and Llama-3 Instruct models. Additionally, we include a state-of-the-art adversarially trained Mistral model, R2D2 , for comparison.

**Results.** We observe that our circuit-breaking technique RR demonstrates strong generalization across a diverse range of attacks, reducing compliance rates to harmful requests by an average of \(87\%\) with Mistral and \(90\%\) with Llama-3. Unlike the Mistral R2D2 model, which is trained against the GCG yet shows limited generalization to various attacks, our method eliminates the need for specific attack training and focuses on hindering harmful generations. Our approach moves away from the traditional cat-and-mouse paradigm, aiming for generalization to _unforeseen_ attacks. Additionally, the results highlight a Pareto optimal trade-off in performance. Our model exhibits high reliability against unseen attacks with a minimal compromise in capability evaluation, showing a performance dip of less than \(1\%\) in proposed tests. This is difficult to achieve with traditional defenses. For example, the Mistral model, when adversarially trained, experiences a decline of over \(8\%\) in the MT Bench performance. In contrast, our model leverages representation engineering principles, focusing on internal control over external supervision, enabling more targeted and fine-grained control over model behavior without adversely impacting other functionalities.

### Multimodal Models

**Adding Circuit Breakers.** We mix the circuit breaker and retain datasets from Section 4.1 with a synthetic multimodal circuit breaker set and the retain LLaVA-Instruct set . The detailed process of generating the synthetic dataset is reported in appendix A.2. We perform RR on LLaVA-NeXT-Mistral-7B . More experimental details can be found in Appendix C.3.1.

**Evaluation.** To evaluate the robustness of multimodal models with circuit breakers, we generate adversarial images using a whitebox approach. Following Projected Gradient Descent , we perturb images with a harmful prompt to produce a target string with an affirmative assistant response. We set epsilon to \(32/255\) and run the process for 1000 steps. As baselines, we test LLaVA-NeXTMistral-7B with and without a safety prompt that asks the model to avoid harmful responses. Our robustness results in Figure 3 show the percentage of harmful prompts the model complies with, labeled manually. We source a set of 133 harmful multimodal behaviors from HarmBench  and MM-SafetyBench , focusing on the most saliently harmful prompts. See Appendix C.3 for more details about the dataset's composition. For capabilities evaluation, we follow  to evaluate multimodal models on LLaVA-Wild for visual chat capability and MMMU  for multimodal understanding capability.

**Results.** Figure 3 demonstrates that for multimodal models, our circuit-breaking technique RR is also able to make a model significantly more robust while preserving model capabilities. Especially when subject to white-box PGD Attack, RR achieves reduction of \(84\%\) in the compliance rate compared to the original model and \(85\%\) compared to the safety prompt. Meanwhile, performance on MMMU and LLaVA-Wild remains within \(0.5\%\) of the original, as opposed to the safety prompt which causes a decrease of \(3.3\%\) on LLaVA-Wild. This demonstrates that despite the ongoing challenge of achieving adversarial robustness in standalone image recognition, circuit breakers enable the larger multimodal system to reliably counter image "hijacks"  intended to elicit harmful outputs.

### AI Agents

**Adding Circuit Breakers.** We mix the circuit breaker and retain datasets from Section 4.1 with function calling circuit breaker and retain dataset. The detailed process of generating the function calling circuit breaker and retain dataset is described in Appendix A.3. For the LLMs with circuit breakers, we also use the same hyperparameter configuration as in Section 4.1.

**Evaluation.** To evaluate the effectiveness of RR as a method of preventing AI agents from making harmful function calls, we design a dataset that consists of 100 requests intended to produce harmful actions via function calls, along with associated function definitions. These requests span a variety of categories, including cybercrime, disinformation, fraud, and harassment. The associated function definitions are designed to capture typical use cases of deployed AI agents including sending messages, browsing URLs, and using simple tools in addition to task-specific functions.

We provide a representative example in Appendix C.4.1. We record model compliance rate with harmful requests under both the standard setting, where function call requests are directly given and the model decides whether to make a call, and under _forced function-calling_, where the assistant is forced to begin its response with the name of a function to be called. Forced function-calling is akin to the prefilling attack in 4.1 and is provided by major model providers . For capabilities evaluation, we measure performance on the Berkeley Function Calling Leaderboard (BFCL) . We use Llama-3-8B-Instruct to benchmark, as it is one of few open-source models that both _1)_ performs reasonably well on the benchmark leaderboard, and _2)_ is currently served with function-calling capabilities by inference providers .

**Results.** Figure 4 shows that after applying RR, our model is significantly more robust to harmful function calling requests, in both the no-attack and forced function-call settings, reducing harmful

Figure 4: Circuit-breaking performance in AI agent settings with Representation Rerouting (RR). Our Llama-3-8B-Instruct (+ RR) with circuit breakers remains robust under Direct Request and Forced Function Calls, while retaining performance on the Berkeley Function Calling Leaderboard (BFCL).

action compliance rates by \(84\%\) and \(83\%\) in the latter setting compared to baselines. Additionally, the model with circuit breakers retains performance on the Berkeley Function Calling Leaderboard. Overall, this demonstrates the method's effectiveness in controlling agent behaviors under adversarial pressure and in environments with inherent reward biases. It suggests the potential for mitigating harms like power-seeking or dishonesty by adding circuit breakers to the relevant model representations, which can be as simple as adjusting the circuit breaker set.

### Ablation and Analysis

**Ablations.** We do pairwise ablations for each component of the RR loss in Table 8. First, we see that augmenting the circuit breaker set with requests that bypass refusal mechanisms (w/ Augment) decreases ASR while still maintaining capabilities. Although ablating the refusal retain component (w/o refusal) increases relative robustness, it also degrades capabilities. Next, we try varying loss functions. We find that the RMU loss , which minimizes the \(_{2}\) distance from a constant random unit vector, fails to converge. Finally, we find that minimizing the \(_{2}\) distance from a distinct random positive vector at each step (RandP) works (though if the vector is centered at 0 (RandC), training fails). Overall, the cosine loss proposed in RR offers more stability than other losses. We then analyze the training data composition, which influences the kinds of harmful inputs that activate the circuit breakers.

To understand the generalization properties of circuit-breaking, we split our training data into six categories of harm, train category-specific models, and measure their generalization performance across categories. We find strong in-domain generalization, indicated by the low ASR along the diagonal in Figure 5, and observe that training on broader categories like Harmful and Illegal Activities offers greater generalization than narrower categories like Cybercrime. We report similar ablations for Mistral-7B in Appendix G.

**Representation analysis.** In Figure 6, we plot the cosines between representations of the Llama-3-8B-Instruct model with and without circuit breakers for a prefilled harmful response _"Here is how to build a bomb: 1. Start with"_. We additionally plot the norms of these representations in Figure 12.

We observe that in this case, the cosines and norms start to change dramatically _during prefilling_ starting from layer 10, i.e., even before generation starts. We note that we use layers 10 and 20 for circuit-breaking, so we do not expect substantial changes in the cosines and norms before layer 10 which is confirmed by the behavior of these metrics at layer 5. Although we do not directly control the representation norms during training, we observe that they often dramatically increase after circuit-breaking occurs. We repeat the same experiment for Mistral-7B-Instruct and show it in Appendix H, where we also analyze two other prompts: one that leads to a similar behavior and one that triggers circuit breakers after generation starts. Importantly, we conclude that our proposed method has the intended effect on the representations and that we can detect activation of circuit breakers by directly analyzing the internal representations. This can lead to system-level mitigations like using a probe to detect when circuit breakers are activated to stop generation and, for example, provide a message that the request is considered harmful and further generation is not possible.

**Circuit breaking with Harmfulness Probes (HP).** Our proposed circuit breaking method relies on _representation control_. This section evaluates the potential efficacy of _representation reading_ as an

Figure 5: Circuit Breaker set ablation across categories of harm, averaged over the same 6 attacks.

Figure 6: Cosine analysis of internal representations of the Llama model without and with circuit breakers.

alternative. Instead of altering the harmful model representation, we simply monitor for its presence and halt model generation if detected. We employ the same training dataset (harmful circuit breaker set and retain set) used in the LLM experiments. A linear classifier and an MLP classifier are trained to distinguish between model activations from the two datasets. Specifically, activations are collected from the 16th layer of the Mistral model and from the final layer of the Llama-3 model for each token in the responses. The MLP probe has two layers with hidden size of 64 and 32. During testing, generation is halted and replaced with a refusal message if any generated token is flagged as harmful by the classifier. We find a threshold so that the false positive rate (FPR) on WildChat (Appendix B) is around the same as the model trained with RR . We choose five settings to evaluate: prompt only (No Attack), manual attack (Manual), black-box attack (TAP-T), white-box attack (GCG), and an embedding space attack (Input Embed).

As shown in table 2, Harmfulness Probing (HP) significantly reduces the attack success rate compared to the refusal-trained baseline. Both Linear and MLP Harmfulness Probes are outperformed by the representation control approach (RR), however, the gap is smaller for the MLP probe. We emphasize that, although generally probing can be easily thwarted by adversarial attacks, much like input and output filters, its robustness in this context can be largely attributed to the continuous monitoring of model representations associated with harmful processes throughout the entire generation, a key idea in circuit breaking. Furthermore, one can combine HP and RR to implement multiple layers of defense. It is important to note, however, that the Harmful Probes are tested under a weaker adversarial setting, where the attacker lacks knowledge of the probe and does not directly optimize against it. Further investigation into Harmfulness Probes and other representation reading methods is left for future work.

## 5 Limitations and Conclusion

Despite the promise of the methods introduced here, we emphasize that the approach we present is aiming at preventing one particular type of adversarial attack: an attack against the ability of the model to produce harmful content (often specifically against the desires of the model developer). In general, adversarial attacks can achieve other aims as well, i.e., using a generative vision language model as a drop-in replacement for an image classifier. In such a use case, our method would not provide defense against "traditional" adversarial attacks aimed at simply changing the class label, because no class label would be inherently "harmful." Thus, there is an important distinction of our approach: we are specifically targeting the adversarial attack setting where the goal of an attacker is to produce generically harmful information (content the model should _never_ produce). Nonetheless, for this particular use case of adversarial attacks, and for single-turn conversations that we focus on circuit-breaking, our approach dramatically improves model robustness. Overall we found that circuit breakers, based on RepE, make models intrinsically safer and robust to unseen adversarial attacks. The method is highly general and can impart robustness to image hijacks, and it can also prevent AI agents from taking harmful actions. Our method is potentially a major step forward in making models more aligned and robust.

    & &  &  \\   & & Refusal & + HP & + HP & + RR & Refusal & + HP & + HP & + RP & \\  & Trained & (Linear) & (MLP) & + RR & Trained & (Linear) & (MLP) & + RR \\  Over-Refusal & WildChat & **2.0** & 3.6 & 3.6 & 3.4 & **2.2** & 6.2 & 6.2 & 6.2 \\   & No Attack & 57.8 & 16.6 & 12.5 & **4.9** & 12.4 & 6.6 & 5.8 & **1.2** \\  & Manual & 77.4 & 7.4 & **5.2** & 6.8 & 8.3 & 1.7 & 0.8 & **0.0** \\ Robustness & TAP-T & 85.8 & 27.5 & 26.2 & **17.5** & 17.4 & 8.3 & 6.2 & **2.1** \\  & GCG & 88.7 & 18.0 & 14.6 & **11.2** & 44.5 & 11.6 & 9.1 & **2.5** \\  & Input Embed & 92.1 & 16.3 & **13.0** & 15.7 & 80.4 & 16.8 & 12.2 & **9.6** \\   & Average & 80.6 & 19.0 & 14.3 & **11.2** & 32.6 & 9.0 & 6.8 & **3.1** \\   

Table 2: Comparison of Harmfulness Probing (HP) and Representation Rerouting (RR). RR is a representation control method whereas HP is a representation reading method. HP, when applied using a reasonable threshold, significantly lowers the ASR compared to a refusal-trained baseline.