# Reprogramming Pretrained Target-Specific Diffusion Models for Dual-Target Drug Design

Xiangxin Zhou\({}^{1,2}\)

Jiaqi Guan\({}^{3}\)

Yijia Zhang\({}^{4}\)

Xingang Peng\({}^{5}\)

Liang Wang\({}^{1,2}\)

Jianzhu Ma\({}^{4,6,}\)

Correspondence to: Jianzhu Ma <majianzhu@tsinghua.edu.cn>.

\({}^{1}\)School of Artificial Intelligence, University of Chinese Academy of Sciences

\({}^{2}\)New Laboratory of Pattern Recognition (NLPR),

State Key Laboratory of Multimodal Artificial Intelligence Systems (MAIS),

Institute of Automation, Chinese Academy of Sciences (CASIA)

\({}^{3}\)Department of Computer Science, University of Illinois Urbana-Champaign

\({}^{4}\)Department of Electronic Engineering, Tsinghua University

\({}^{5}\)Institute for Artificial Intelligence, Peking University

\({}^{6}\)Institute for AI Industry Research, Tsinghua University

&Yijia Zhang\({}^{4}\)

Xingang Peng\({}^{5}\)

Liang Wang\({}^{1,2}\)
increase in the FDA's approval of dual-target drugs [32; 34]. Please refer to Appendix A for a more comprehensive understanding of motivation, significance, and current practices of dual-target drug design.

Deep learning, particularly deep generative models  and geometric deep learning , has been introduced to SBDD and achieved promising results. Peng et al. , Zhang et al.  proposed to sequentially generate atoms or fragments using auto-regressive generative models conditioned on a specific protein binding site. Guan et al. , Lin et al. , Schneuing et al.  proposed to generate ligand molecules with diffusion models and achieved high binding affinity. However, due to the scarcity of data resources and high computational complexity, there is limited progress on introducing powerful generative models into dual-target drug design. Besides, there also lacks a comprehensive benchmark and dataset for evaluating the dual-target drug design, which also hinders the community from developing AI-powered computational tools for dual-target drug design.

To overcome the aforementioned challenges, we first propose a dataset for dual-target drug design. The design of dual-target drugs for arbitrary target pairs lacks substantive purpose. Inspired by the concept of drug synergism , where the combined effect of two drugs surpasses the effects of each drug when used individually, we carefully select pairs of targets from combinations of drugs that demonstrate significant synergistic interactions. The effectiveness of such combination therapy [39; 50; 44] has demonstrate significant efficacy in tumor eradication at both cellular level and in vivo study. Designing dual-target drugs for the paired targets may further improve the efficacy and reduce side effects. Additionally, we also provide a reference ligand for each target and the 3D structure of each protein-ligand complex in our dataset. Besides, we formulate the dual-target drug design as a generative task, based on which we further propose to reprogram pretrained target-specific diffusion models as introduced by Guan et al.  for the dual-target setting in zero-shot manner. More specifically, we first align dual pockets in 3D space with protein-ligand interaction priors that encapsulate the intricate features of the pockets. We compose the predicted drift terms in both 3D and categorical probability space in the reverse generative process of the diffusion model to generate dual-target drugs. We name this method as CompDiff. We further improve this method by building two complex graphs with shared ligand nodes for SE(3)-equivariant composed message passing. In this method, we compose the SE(3)-equivariant message at each layer of the equivariant neural network instead of only on the output level. We name this method as DualDiff. Our approach effectively transfers the knowledge acquired from pretraining on single-target datasets, circumventing the challenging demand for extensive training data required for dual-target drug design. We also repurpose linker design methods [22; 17] as a strong baseline for this task. We outline strategies to identify potential fragments from the synergistic drug combinations, serving as input for these linker design methods. We highlight our main contributions as follows:

* We present a meticulously curated dataset derived from synergistic drug combinations for dual-target drug design, offering new opportunities for AI-driven drug discovery.
* We propose SE(3)-equivariant composed message for compositional generative sampling to reprogram pretrained single-target diffusion models for dual-target drug design in a zero-shot way.
* We propose fragment selection methods from synergistic drug combinations for repurposing linker design methods as strong baselines for dual-target drug design.
* Our method can be viewed as a general framework where any pretrained generative models for SBDD can be applied to dual-target drug design without any fine-tuning. We select TargetDiff as a demonstrative demo in our work.

## 2 Related Work

Structure-based Drug DesignStructure-based drug design (SBDD) aims to design ligand molecules that can bind to specific protein targets. The introduction of deep generative models has marked a paradigm shift, yielding noteworthy outcomes. Ragoza et al.  utilized a variational autoencoder to generate 3D molecules within atomic density grids. Luo et al. , Peng et al. , Liu et al.  employed an autoregressive model to sequentially construct 3D molecules atom by atom, while Zhang et al.  introduced a method for generating 3D molecules by successively predicting molecular fragments in an auto-regressive way. Guan et al. , Schneuing et al. , Lin et al.  introduced diffusion models  to SBDD, which first generate the types and positions of atoms by iteratively denoising with an SE(3)-equivariant neural network [18; 52] and then determine bond types by post-processing. Some recent studies have endeavored to further improve the aforementioned methods through the integration of biochemical prior knowledge. Guan et al.  proposed decomposed priors, bond diffusion and validity guidance to improve the quality of ligand molecules generated by diffusion models. Zhang and Liu  augmented molecule generation through global interaction between subpocket prototypes and molecular motifs. Huang et al.  incorporated protein-ligand interaction prior into both forward and reverse processes to improve the diffusion models. Zhou et al.  integrated conditional diffusion models with iterative optimization to optimize properties of generated molecules. The above works focus on structure-based single-target drug design, while our work aims at dual-target drug design.

Molecular Linker DesignMolecular linker design, which enables the connection of molecular fragments to form potent compounds, is an effective approach in rational drug discovery. Approaches like DeLinker  and Develop  design linkers by utilizing molecular graphs with distance and angle information between anchor atoms, but they lack 3D structural information of molecules. More recent techniques, such as 3DLinker  and DiffLinker , generate linkers directly in 3D space using conditional VAEs and diffusion models, respectively, but they assume known fragment poses. LinkerNet  relaxes this assumption by co-designing molecular fragment poses and the linker, making it applicable in cases where fragment poses are unknown, such as in the linker design of PROTACs (PROteolysis TArgeting Chimeras). Since pharmacophore combination is a traditional strategy to design dual-target drugs, we repurpose linker design methods as strong baselines for dual-target drug design. Please refer to Appendix B for extended related works.

## 3 Method

In this section, we will present the pipeline of our work, from dataset curation to method. In Section 3.1, we will introduce how we curate the dual-target dataset based on synergistic drug combinations and how we derived the protein-ligand complex structures. In Section 3.2, we will show how we reprogram the pretrained target-specific diffusion models for dual-target drug design and introduce two methods, CompDiff and DualDiff. In Section 3.3, we will show how we repurpose linker design methods for dual-target drug design.

Figure 1: Overview of our method for dual-target drug design. (a) Illustration of CompDiff and DualDiff. We first align two pockets in 3D space with protein-ligand binding prior and build two complex graph with shared ligand nodes. We then compose the SE(3)-equivariant message to derive the drift on output level (CompDiff) or at each layer of the equivariant neural network (DualDiff). Based on the composed drift, we can generate dual-target ligand molecules by compositional reverse sampling. (b) Illustration of repurposing linker design methods for dual-target drug design. We first identity binding-related fragments from the reference molecules for each of the dual targets and then apply linker design methods to link the fragments and derive a complete molecule that can bind to the dual targets separately.

### Data Curation

Designing dual-target drugs for random pairs of targets lacks significant intent. However, by taking cues from drug synergy, where two drugs together deliver an impact greater than the sum of their separate effects , we carefully select target pairs to ensure the dataset holds practical significance for drug discovery.

Drug SynergyTo collect drug combination pairs, we start from DrugCombDB2. DrugCombDB is a comprehensive database devoted to the curation of drug combinations from various data sources including high-throughput screening (HTS) assays, manual curations from the literature, FDA Orange Book and external databases. DrugCombDB comprises a total of 448,555 combinations of drugs, encompassing 2,887 unique drugs and 124 human cancer cell lines. Particularly, DrugCombDB has more than 6,000,000 quantitative dose responses, from which we determine whether a drug combination is synergistic or not. Specifically, a drug combination with positive zero interaction potency (ZIP), Bliss, Loewe and the highest single agent (HSA) scores simultaneously in at least one cell line is supposed to be a synergistic one. Please refer to Appendix C for a comprehensive understanding of these scores.

Drug InformationAfter collecting synergistic drug combinations, we need to collect other necessary information (e.g., SMILES and targets) according to their drug names provided by DrugCombDB. Before this procedure, we collect synonyms and cross-matching ID (e.g., CAS Number and ChEBI ID) mainly from DrugBank3 and Therapeutic Target Database (TTD)4. This step facilitates comprehensive literature reviews, ensuring that all relevant data sources that may use alternate names for a drug is considered. We then collect SMILES or structures (if possible) also mainly from DrugBank and TTD. To identify drug targets, we also utilize DrugBank and TTD as the primary data sources, and supplement these with manual curation from the literature (e.g., ). For drugs for which we cannot find either SMILES or targets, we exclude them from our previously collected dataset of positive drug combinations.

Complex StructuresFor certain drug-target pairs, we incorporate their complex structures directly into our dataset if they are available in PDBBind , a repository of protein-ligand binding structures sourced from the Protein Data Bank (PDB) . For drug-target pairs not present in PDBBind, we initially attempt to retrieve the target structures from PDB; if the structures are unavailable, we then source them from the AlphaFold Protein Structure Database (AlphaFold DB)  and exclude those whose confidence scores, referred to as pLDDT which provide an assessment of the structures predicted by AlphaFold 2 , are less than 70. For these protein targets with structures from PDB or AlphaFold DB, we first utilize P2Rank , a program that precisely predicts ligand-binding pockets from a protein structure, to find the most possible pocket given the target structure, and use AutoDock Vina  to obtain the protein-ligand complex structures. For each drug, there may exist more than one targets, in which case we use AutoDock Vina to measure the binding affinity and selected the target with the best binding affinity. Finally, we obtain 12,917 positive drug combinations with protein-ligand complex structures, among which there are 438 unique drugs. The 12,917 pairs of targets can be used to evaluate the ability of methods for dual-target drug design. And the binding ligands can be used for reference molecules.

### Reprogramming Target-Specific Diffusion Models for Dual-Target Drug Design

Diffusion models [21; 56; 54; 21] have been introduced to structure-based drug design and achieved promising results [19; 53; 33; 20]. We will first revisit the background of diffusion models for SBDD  and then introduce how we apply diffusion models trained on single-target protein-ligand datasets to dual-target drug design in a zero-shot manner. Our method is illustrated in Figure 1 (a).

Diffusion Models for single-target SBDDIn this following, we denote the type of an atom as \(^{K}\) and the coordinate of an atom as \(^{3}\), where \(K\) is the number of atom types of our interest. For single-target drug design, given a protein binding site denoted as a set of atoms\(=\{(_{P}^{(i)},_{P}^{(i)})\}_{i=1}^{N_{P}}\), where \(N_{P}\) is the number of protein atoms, our goal is to generate binding molecules \(=\{(_{L}^{(i)},_{L}^{(i)})\}_{i=1}^{N_{M}}\). For brevity, we denote the molecule as \(M=[,]\), where \([,]\) denotes the concatenation operator and \(^{N_{M} 3},^{N_{M} K}\) denote the coordinates in 3D space and one-hot atom types, respectively. So we can use generative models to model the conditional distribution \(p(M|)\).

In the forward _diffusion_ process of the diffusion model, noises are gradually injected into the data sample (i.e., small molecule \(M_{0} p(M|)\)) and lead to a sequence of latent variable \(M_{1},M_{2},,M_{T}\). The final distribution \(p(M_{T}|)\), also known as prior distribution, is approximately standard normal distribution for atom positions and uniform distribution for atom types. The reverse _generative_ process learns to recover data distribution from the noise distribution with a neural network parameterized by \(\). The forward and reverse processes are both Markov chains defined as follows:

\[q(M_{1:T}|M_{0},)=_{t=1}^{T}q(M_{t}|M_{t-1},)  p_{}(M_{0:T-1}|M_{T},)=_{t=1}^{T}p_ {}(M_{t-1}|M_{t},).\] (1)

More specifically, the forward transition kernel in Guan et al.  are defined as follows:

\[q(M_{t}|M_{t-1},)=(_{t};} _{t-1},_{t})(_{t}|(1-_{t} )_{t-1}+_{t}/K),\] (2)

where \(\{_{t}\}_{t=1}^{T}\) are fixed noise schedule. The above diffusion process can be efficiently sampled directly from time step \(0\) to \(t\) as follows:

\[q(_{t}|_{0})=(_{t};} _{0},(1-_{t})) q(_{ t}|_{0})=(_{t}|_{t}_{0}+(1- _{t}/K),\] (3)

where \(_{t}:=1-_{t}\) and \(_{t}:=_{s=1}^{t}_{s}\). The posterior can be easily computed via Bayes theorem as:

\[q(_{t-1}|_{t},_{0})=(_{t-1 };}_{t}(_{t},_{0}),_{t})  q(_{t}|_{0})=(_ {t}|_{t}_{0}+(1-_{t})/K),\] (4)

where \(_{t}=_{t-1}}{1-_{t}}_{t}\), \(_{t}(_{t},_{0})=_{t}- _{t}}{1-_{t}}}\), \(}_{t}(_{t},_{0})=^{*}/_{k=1}^{K}c_ {k}^{*}\) and \(^{*}(_{t},_{0})=[_{t}_{t}+(1- _{t})/K][_{t-1}_{0}+(1-_{t-1})/K]\).

Accordingly, the reverse transition kernel are defined as follows:

\[p_{}(M_{t-1}|M_{t},)=(_{t-1};_{}([_{t},_{t}],t,),_{t}^ {2})(_{t-1}|_{}([_{t},_{t}],t,)).\] (5)

Guan et al.  use SE(3)-equivariant neural networks  to parameterize \(_{}([_{t},_{t}],t,)\) and \(_{}([_{t},_{t}],t,)\). More specifically, the \([_{0},_{0}]\) are first predicted using neural network \(_{}\), i.e., \([}_{0},}_{0}]=f_{}([_{t}, _{t}],t,)\) and then substitute in the posterior as in Equation (4). At the \(l\)-th layer of \(f_{}\), the hidden embedding \(\) and coordinates \(\) of each atom are updated alternately as follows:

\[_{i}^{l+1} =_{i}^{l}+_{j,i j}f_{_ {n}}(_{i}^{l},_{j}^{l},d_{ij}^{l},_{ij}),\] (6) \[_{i}^{l+1} =_{i}^{l}+_{j,i j}(_{i}^ {l}-_{j}^{l})f_{_{x}}(_{i}^{l+1},_{j}^{ l+1},d_{ij}^{l},_{ij})_{},\] (7)

where \(\) is a k-nearest neighbors (knn) graph, \(d_{ij}=\|_{i}-_{j}\|\) is the Euclidean distance between two atoms \(i\) and \(j\), \(_{ij}\) is an additional feature that indicates the connection is between protein atoms, ligand atoms or protein atom and ligand atom, and \(_{}\) is a mask for ligand nodes since only coordinates of ligand atoms are supposed to be updated.

The diffusion model is trained to minimize the KL-divergence between the ground-truth posterior \(q(M_{t-1}|M_{0},M_{t},)\) and the estimated posterior \(p_{}(M_{t-1}|M_{t},)\). After being trained, given a specific pocket, the ligand molecule can be generated by first sampling from prior distribution and sequentially applying the reverse generative process defined above.

Problem Definition of Dual-Target Drug DesignThe goal of dual-target drug design is to design a ligand molecule \(M\) that can bind to both given pocket \(_{1}\) and pocket \(_{2}\). The problem can be also formulated as a generative task which models the conditional distribution \(p(M|_{1},_{2})\). Notebly, we introduce a transformation operator \(\) here. This is because protein pockets exhibit a wide variety of shapes and chemical characteristics and it is necessary to achieve spatial alignment of the dual pockets when modeling the conditional distribution with both of them as conditions. To maintain a neat but significant setting, we restrict the transformation \(\) to encompass solely translations \(_{T}\) and rotations \(_{R}\), i.e., \(=_{T}_{R}\). To be more precise, \((_{T}_{R})_{2}=\{(_{P_{2}}^{(i) }+),_{P_{2}}^{(i)}\}_{i=1}^{N_{P_{2}}}\), where \((3)\) represents the rotation and \(^{3}\) represents the translation.

Aligning Dual Targets with Protein-Ligand Binding PriorsProtein pockets can have intricate 3D structures with varying depths, widths, and surface contours, and distinct chemical properties, including differences in surface electron potentials, hydrophobicity, and the distribution of functional groups. The complex nature of pocket characteristics hinder us from directly aligning two pockets. Nevertheless, the binding mode is determined by the complex nature of pocket information, thus the protein-binding priors can effectively summarize the essential information needed for aligning the two pockets. This motivate us to propose to use a ligand molecule as a proper to implicitly reflect the spatial arrangement of the two pockets and then align them with the protein-ligand binding priors. More specifically, we first dock a ligand molecule to pocket \(1\) and pocket \(2\) separately. We can then compute \(\) and \(\) by aligning the two docked poses of the ligand molecule. Experiments have demonstrated that even ligand molecules capable of approximate binding to the two pockets can effectively indicate a specific spatial alignment between them. Further details are provided in Section 4.

SE(3)-Equivariant Composed Message and Compositional Generative SamplingInspired by compositional visual generation [9; 37], we can model the dual-target drug design with the following composed distribution:

\[p(M|_{1},_{2}) p_{}(M| _{1})p_{}(M|_{2}).\] (8)

Following Liu et al. , for the atom position prediction, we can reparameterize \(}([_{t},_{t}],t,)\) with \(_{t}-}([_{t},_{t}],t, )\), so that we can rewrite the transition kernel of the reverse generative process as follows:

\[p_{}(_{t-1}|_{t},)=(_{ t-1};}([_{t},_{t}],t,),_{t}^{2} )=(_{t-1};_{t}-}([ _{t},_{t}],t,),_{t}^{2}).\] (9)

The reversed transition kernel corresponds to a step as follow:

\[_{t-1}=_{t}-}([_{t}, _{t}],t,)+(,_{t}^{2}).\] (10)

where \(}([_{t},_{t}],t,)\) can be viewed as a drift term and \((,_{t}^{2})\) can be viewed as a diffusion term. As Liu et al.  points out, this is analogous to the Langevin dynamics  that used to sample from Energy-Based Models (EBMs) [55; 10], which can be formulated as follows:

\[_{t-1}=_{t}-_{}E_{}([_{t},_{t}],t,)+(,_{t}^{2}).\] (11)

The sampling procedure produces samples from the probability density \(p_{}(|)}(|))}\) where \(E_{}(|)\) is a energy function parameterized by model \(\). Thus, accordingly, the composed distribution of atom positions can be written as:

\[p(|_{1},_{2}) p_{}(|_{1})p_{}(| _{2})-E_{}([_{t}, _{t}],t,_{1})+E_{}([_{t},_ {t}],t,_{2})}.\]

This composed distribution corresponds to Langevin dynamics as follows:

\[_{t-1}=_{t}-_{}- E_{}([_{t},_{t}],t,_{1})+E_{ }([_{t},_{t}],t,_{2}) .\] (12)

Accordingly, each step in the compositional reverse generative sampling process can be defined as:

\[_{t-1}=_{t}-}([ _{t},_{t}],t,_{1})+_{}([ _{t},_{t}],t,_{2}),\] (13)

where we additionally introduce a hyperparameter \(\) here to control the strength of the drift. In theory, this is equivalent to making a more flexible assumption that \(p(|_{1},_{2})[p_{} (|_{1})p_{}(| _{2})]^{}\). In this case the transition kernel is defined as \(p_{}(_{t-1}|_{t},_{1}, _{2})=[p_{}(_{t-1}|_{t}, _{1})p_{}(_{t-1}|_{t},_{2} )]^{}\). In practice, we set \(=1/2\) by default. This composition operation is equivalent to averaging two \(}_{0}\) predicted on two complex graphs, i.e. \(_{1}\) and \(_{2}\). Similarly, for the atom types which are discrete variables, we can also compose the transition kernel as follows: \(p_{}(_{t-1}|_{t},_{1}, _{2}) p_{}(_{t-1}|_{t}, _{1})p_{}(_{t-1}|_{t}, _{2})\). Note that \(p_{}(_{t-1}|_{t},_{1})\) is categorical distribution and its dimension (i.e., the number of atom types of our interest) is \(K\), which is small in practice. So \(p_{}(_{t-1}|_{t},_{1}, _{2})\) can be computed analytically. We name the compositional reverse sampling with composed transition kernel (i.e., composed drift) as CompDiff.

We further improve the compositional reverse sampling by introducing the composition into each layer of the equivariant neural network in the pretrained diffusion model. For brevity, we denote the SE(3)-equivariant message at the \(l\)-th layer for the \(i\)-th atom of the complex graph \(_{v}\) (\(v=1,2\)) as introduced in Equation (7) as follows:

\[_{i}^{l}(_{v}) :=_{j_{v},i j}f_{_{h}}( _{i}^{l},_{j}^{l},d_{ij}^{l},_{ij}),\] (14) \[_{i}^{l}(_{v}) :=_{j_{v},i j}(_{i}^{l}-_{j}^{l})f_{_{a}}(_{i}^{l+1},_{j}^{l+ 1},d_{ij}^{l},_{ij})_{}.\] (15)

The above SE(3)-equivariant message can also be interpreted as drift in 3D and latent space. Thus we can also compose them as follows:

\[_{i}^{l+1}=_{i}^{l}+_{i}^{l}( _{1})+_{i}^{l}(_{2})/2 _{i}^{l+1}=_{i}^{l}+(_{i}^ {l}(_{1})+_{i}^{l}(_{2}))/2.\] (16)

We name the compositional reverse sampling with the above SE(3)-equivariant message at each layer as DualDiff. The proof of SE(3)-equivariance can be found in Appendix G. This more meticulous composition is supposed to lead to higher-quality samples.

### Repurposing Linker Design Methods for Dual-Target Drug Design

Pharmacophore combination is a prevalent strategy in traditional dual-target drug design, requiring the specialized knowledge of chemists. To automate this procedure, We design a strategy to identity crucial fragments from reference molecules of dual targets in our dataset and apply linker design methods [25; 17] to link the fragments and obtain complete molecules. Please refer to Appendix D for a more detailed justification for the choice of baselines.

Specifically, we break all rotatable bonds of reference molecule \(_{1}\) (resp. \(_{2}\)) of target \(_{1}\) (resp. \(_{2}\)) to obtain fragments. Since DiffLinker  requires relative positions of fragments as input, we dock all fragments derived from \(_{1}\) and \(_{2}\) to \(_{2}\) (or \(_{1}\)) and select the pair of fragments which has the best sum of binding affinity and no physical conflicts (i.e., the minimum between atoms from the two fragments is large than 1.4A). We then apply DiffLinker to link the two fragments, considering the existence of the pocket \(_{2}\) (or \(_{1}\)). Since LinkerNet  models the translation and rotation of fragments by neural networks and does not require relative position of fragments as input, we directly dock all fragments derived from \(_{1}\) (resp. \(_{2}\)) to \(_{1}\) (resp. \(_{2}\)) and select their respective fragment with the best binding affinity. And we then link them using LinkerNet to obtain complete molecules.

## 4 Experiment

### Experimental Setup

DatasetWe use our dataset introduced in Section 3.1. All 12,917 pairs of targets (including 438 unique targets) are used for evaluation. For each target, there is an associated reference molecule that can be considered a benchmark for high-quality ligand molecules and utilized in linker design methods.

BaselinesWe compare our method with various baselines: **Pocket2Mol** generates 3D molecules atom by atom in an autoregressive manner given a specific protein binding site. **TargetDiff** is a diffusion-based method which generates atom coordinates and atom types in a non-autoregressive way. Note that Pocket2Mol and TargetDiff are both proposed for structure-based single-target drug design. **DiffLinker** is a diffusion-based model for linker design with given fragment poses. **LinkerNet** is a diffusion-based model for co-designing molecular fragment poses and the linker. DiffLinker and LinkerNet are repurposed for dual-target drug design as we introduced in Section 3.3. The code is available at https://github.com/zhouxiangxin1998/DualDiff.

EvaluationWe evaluate generated ligand molecules from the perspectives of target binding affinity and molecular properties. We employ AutoDock Vina  to estimate the target binding affinity, following Peng et al. , Guan et al. . We first evaluate Pocket2Mol and TargetDiff under the single-target setting as a preliminary verification (see Appendix E). For dual-target drug design, we use each method to design 10 molecules for each pair of targets, denoted as \(_{1}\) and \(_{2}\). (For reference molecule, Pocet2Mol and TargetDiff, the ligand molecule is generated for \(_{1}\) but the target binding affinity is evaluated on both \(_{1}\) and \(_{2}\).) We then collect all generated molecules across 12,917 pairs of targets and report the mean and median (denoted as "Avg." and "Med." respectively) of affinity-related metrics (P-1 Vina Dock, P-2 Vina Dock, Max Vina Dock, and Dual High Affinity) and property-related metrics (drug-likeness QED , synthesizing SA , and diversity). Vina Dock incorporates a re-docking step to assess the highest binding affinity achievable. Here we introduce P-1 Vina Dock and P-2 Vina Dock to represent the Vina Dock score evaluated on \(_{1}\) and \(_{2}\), respectively. Besides, we introduce Max Vina Dock, which represents the maximum Vina Dock of a given molecule towards \(_{1}\) and \(_{2}\). The Vina Dock will be low if and only if the molecule can bind to both targets simultaneously, which is the goal of dual-target drug design. Additionally, we report Dual High Affinity (abbreviated as Dual High Aff.) which represents the proportion of generated molecules that exhibit binding affinity that exceeds that of the reference molecules on both the respective targets. This reflects the success rate in achieving higher binding affinities simultaneously on both targets in dual-target drug design. We also evaluate the RMSD between docked poses towards dual targets.

### Main Results

We compare all methods under the dual-target setting. The results are reported in Table 1. Our methods, CompDiff and DualDiff, significantly outperforms other methods, especially in terms of binding affinity. Notably, DualDiff achieves the highest Dual High Affinity among all methods. In line with our expectations, for the single-target drug design methods (e.g., Pocket2Mol and TargetDiff), we observe a significant decline in performance according to P-2 Vina Dock compared to P-1 Vina Dock, which shows their inability in dual-target drug design. LinkerNet also achieves promising results except diversity. Note that DiffLinker and LinkerNet are provided with reference molecules while CompDiff and DualDiff are not. This indicates the strong generative abilities of our methods. Finally, DualDiff outperforms CompDiff, which shows that composition of SE(3)-equivariant message at each layer is more effective than only at the output level.

As shown in Figure 2, DualDiff performs better than LinkerNet the RMSD between docked poses towards dual targets. This indicates that the molecules generated by DualDiff can bind to dual targets with smaller conformation change. We also benchmark the inference time of baslines and our methods in Appendix H. Additionally, we provide visualization of examples of generated molecules in Figure 3. See more examples in Appendix F.

    & P-1 & Vina Dock (\(\)) & P-2 & Vina Dock (\(\)) & Max Vina Dock (\(\)) & Dual High Aff (\(\)) &  &  &  \\  & Avg. & Med & Avg. & Med & Avg. & Med & Avg. & Med & Avg. & Med. & Avg. & Med. & Avg. & Med. \\  Reference & -7.60 & -7.80 & -6.02 & -7.30 & -5.46 & -7.09 & - & - & - & 0.53 & 0.54 & 0.74 & 0.77 & - & - \\  Pocket2Mol & -4.82 & -4.76 & -4.63 & -4.64 & -4.40 & -4.42 & 0.2\% & 0.0\% & 0.49 & 0.48 & **0.88** & **0.90** & **0.82** & **0.83** \\ TargetDiff & **-8.62** & **-8.61** & -6.89 & -7.67 & -6.57 & -7.39 & 29.0\% & 20.0\% & 0.50 & 0.51 & 0.58 & 0.58 & 0.70 & 0.71 \\ DiffLinker & -7.05 & -7.87 & -7.27 & -7.92 & -5.87 & -7.18 & 24.6\% & 0.0\% & 0.43 & 0.42 & 0.30 & 0.29 & 0.52 & 0.54 \\ LinkerNet & -8.20 & -8.37 & 8.13 & -8.38 & -7.17 & -7.72 & 35.7\% & 0.0\% & **6.51** & **0.63** & 0.72 & 0.23 & 0.37 & 0.34 \\ CompDiff & -8.32 & -8.42 & 8.37 & -8.47 & -7.50 & -7.78 & 35.9\% & 30.0\% & 0.55 & 0.57 & 0.59 & 0.72 & 0.72 \\ DualDiff & -8.41 & -8.51 & **-8.48** & **-8.55** & **-7.66** & **-7.88** & **36.3\%** & **30.2\%** & 0.56 & 0.58 & 0.59 & 0.59 & 0.67 & 0.67 \\   

Table 1: Summary of different properties of reference molecules and molecules generated by baselines and our methods under the **dual-target** setting. (\(\)) / (\(\)) denotes a larger / smaller number is better. Top 2 results are highlighted with **bold text** and underlined text, respectively.

Figure 2: RMSD between docked poses towards dual targets of different methods.

### Ablation Studies

Effects of Alignment of Dual TargetsWe perform different methods to align the pockets of dual targets for CompDiff and DualDiff. See the results in Table 2. Naively, we can align two pockets by their geometric centers (denoted as "-Center"). In our method, we propose to align pockets with protein-ligand binding priors. We select the ligand with minimum RMSD between docked poses (resp. minimum sum of Vina Dock scores) towards dual targets as the anchor to align the dual targets, which is denoted as "-RMSD" (resp. "-Score"). DualDiff-Score achieved the best performance among all variants, demonstrating the effectiveness of the alignment method.

Different Strategies of Identifying Fragments for Linker Design MethodsWe conduct ablation on different strategies of identifying fragments for DiffLinker and LinkerNet for dual-target drug design. Since we use Vina Dock to select fragments, we have tried different box sizes for docking, i.e., 5A and 8A. For DiffLinker, since the relative poses of fragments are required as input, we dock fragments derived from \(_{1}\) and \(_{2}\) to target \(_{1}\) (or \(_{2}\)). We then apply DiffLinker both with and without considering the pocket. The corresponding methods are denoted as "DiffLinker-5/-8/-pocket-5/-pocket-8". For LinkerNet, the relative poses of fragments are not required. So we try two setting: dock fragments from \(_{1}\) and \(_{2}\) to target \(_{1}\) (or \(_{2}\)); dock fragments from \(_{1}\) (resp. \(_{2}\)) to target \(_{1}\) (resp. \(_{2}\)). The difference is that all fragments are docked to the same pocket in the former setting while the fragments from two ligand molecules are docked to their respective pockets. The

    &  &  &  &  &  &  &  \\  & Avg. & Med. & Avg. & Med. & Avg. & Med. & Avg. & Med. & Avg. & Med. & Avg. & Med. & Avg. & Med. \\  CompDiff-Center & 8.10 & 8.26 & -8.08 & -8.26 & 7.23 & -7.60 & 30.8\% & 22.0\% & 0.52 & 0.60 & 0.59 & 0.73 & 0.73 \\ CompDiff-RMSD & 8.29 & -8.44 & -8.35 & -8.46 & 7.47 & -7.78 & 35.6\% & 30.0\% & 0.55 & 0.56 & 0.59 & 0.59 & 0.72 & 0.72 \\ CompDiff-Score & 8.32 & -8.42 & -8.37 & -8.47 & -7.50 & -7.78 & 35.9\% & 30.0\% & 0.55 & 0.57 & 0.59 & 0.59 & 0.72 & 0.72 \\  DualDiff-Center & -8.12 & -8.29 & -8.12 & -8.28 & -7.32 & -7.66 & 30.0\% & 22.2\% & 0.52 & 0.54 & 0.59 & 0.59 & 0.69 & 0.69 \\ DualDiff-RMSD & -8.40 & -8.51 & -8.45 & -8.53 & -7.63 & -7.87 & 35.8\% & 30.0\% & 0.55 & 0.57 & 0.59 & 0.59 & 0.67 & 0.67 \\ DualDiff-Score & -8.41 & -8.51 & -8.48 & -8.55 & -7.66 & -7.88 & 36.3\% & 30.2\% & 0.56 & 0.58 & 0.59 & 0.59 & 0.67 & 0.67 \\   

Table 2: Ablation on different ways of aligning dual targets.

    &  &  &  &  &  &  &  \\  & Avg. & Med. & Avg. & Med. & Avg. & Med. & Avg. & Med. & Avg. & Med. & Avg. & Med. & Avg. & Med. \\  DiffLinker-5 & -6.74 & -6.74 & -6.85 & -6.81 & -6.21 & -6.32 & 9.4\% & 0.08 & 0.58 & 0.60 & 0.32 & 0.31 & 0.57 & 0.62 \\ DiffLinker-5 & -7.35 & -7.74 & -7.20 & -7.75 & -6.25 & -7.14 & 20.2\% & 0.08 & 0.45 & 0.45 & 0.31 & 0.30 & 0.58 & 0.62 \\ DiffLinker-8 & -7.22 & -7.32 & -7.49 & -7.49 & -6.65 & -6.86 & 15.7\% & 0.06 & 0.61 & 0.63 & 0.32 & 0.32 & 0.49 & 0.51 \\ DiffLinker-pocket-8 & -7.05 & -7.87 & -7.27 & -7.92 & -5.87 & -7.18 & 24.6\% & 0.00 & 0.43 & 0.42 & 0.30 & 0.29 & 0.52 & 0.54 \\  LinkerNet-5 & -7.54 & -7.54 & -7.56 & -7.58 & -6.98 & -7.05 & 19.9\% & 0.06 & 0.69 & 0.72 & 0.77 & 0.79 & 0.46 & 0.46 \\ LinkerNet-self-5 & -7.54 & -7.55 & -7.55 & -7.56 & -6.98 & -7.05 & 20.0\% & 0.08 & 0.69 & 0.72 & 0.77 & 0.79 & 0.46 & 0.46 \\ LinkerNet-8 & -8.09 & -8.23 & -8.23 & -8.31 & -7.29 & -7.63 & 34.0\% & 0.09 & 0.62 & 0.65 & 0.72 & 0.74 & 0.38 & 0.35 \\ LinkerNet-self-8 & -8.20 & -8.37 & -8.13 & -8.88 & -7.17 & -7.72 & 35.7\% & 0.00 & 0.61 & 0.63 & 0.72 & 0.73 & 0.37 & 0.34 \\   

Table 3: Ablation on different strategies of identifying fragments for linker design methods.

Figure 3: Reference molecules and examples of ligand molecules by different methods generated for the dual targets (UniProt ID: P18507 (top) and Q9UBS5 (bottom)).

corresponding methods are denoted as "LinkerNet-5/-8/-self-5/-self-8". The results are reported in Table 3. The results show that a larger docking box size allows for better selection of fragments. As we expected, DiffLinker with consideration of pockets achieves better performance. Among all variants, "LinkerNet-self-8" achieves best performance, which implies that adjusting relative poses of fragments may play a crutial role in linker deisgn. This feature of LinkerNet allows for selecting the most important fragments for each pockets of the dual targets.

## 5 Conclusion

In this work, we introduced a novel dataset for dual-target drug design. We formulate this problem as a generative task and propose compositional reverse sampling to reprogram pretrained target-specific model for dual-target drug design, which can successfully generate dual-target ligands and outperform all baselines, including repurposed linker design methods. Our research lays the groundwork for dual-target drug design using generative methods, with future progress expected.