# Identification and Estimation of the Bi-Directional MR with Some Invalid Instruments

Feng Xie\({}^{1}\), Zhen Yao\({}^{1}\), Lin Xie\({}^{1}\), Yan Zeng\({}^{1,*}\); Zhi Geng\({}^{1}\)

\({}^{1}\)Beijing Technology and Business University

Corresponding author

###### Abstract

We consider the challenging problem of estimating causal effects from purely observational data in the bi-directional Mendelian randomization (MR), where some invalid instruments, as well as unmeasured confounding, usually exist. To address this problem, most existing methods attempt to find proper valid instrumental variables (IVs) for the target causal effect by expert knowledge or by assuming that the causal model is a one-directional MR model. As such, in this paper, we first theoretically investigate the identification of the bi-directional MR from observational data. In particular, we provide necessary and sufficient conditions under which valid IV sets are correctly identified such that the bi-directional MR model is identifiable, including the causal directions of a pair of phenotypes (i.e., the treatment and outcome). Moreover, based on the identification theory, we develop a cluster fusion-like method to discover valid IV sets and estimate the causal effects of interest. We theoretically demonstrate the correctness of the proposed algorithm. Experimental results show the effectiveness of our method for estimating causal effects in both one-directional and bi-directional MR models.

## 1 Introduction

Mendelian randomization (MR) is a powerful method for estimating the causal effect of a potentially modifiable risk factor (treatment) on disease (outcome) in observational studies, which has been used across a wide variety of contexts, such as clinic (Mokry et al., 2015; Carreras-Torres et al., 2017), socioeconomics (Cuellar-Partida et al., 2016; Brumpton et al., 2020), and drug targets (Ference et al., 2015; Li et al., 2020). Most existing MR methods assume a one-directional causal relationship. However, bi-directional relationships are ubiquitous in real-life scenarios, for example, obesity and vitamin D status (Vimaleswaran et al., 2013), body mass index (BMI) and type 2 diabetes (T2D), etc. Understanding and analyzing bi-directional relationships can provide deeper insights into complex systems, leading to more effective interventions and solutions.

Within a causal inference framework, MR can be implemented as a form of instrumental variables (IVs) analysis in which genetic variants2 serve as IVs for the modifiable risk factor. Specifically, as shown in Figure 1, suppose obesity \((X)\) and Vitamin D status \((Y)\) are the treatment and outcome of interest, respectively, and lifestyle factors \(()\) are the unmeasured confounders between them. One can use genetic variants \(\) as IVs to explore the causal effect of \(X\) on \(Y\) in observational data (Vimaleswaran et al., 2013) if \(\) are valid IVs, i.e., \(\) satisfy the following three assumptions (Wright, 1928; Goldberger, 1972; Bowden and Turkington, 1990; Hernan and Robins, 2006):

**A1.**: [_Relevance_] The genetic variants \(\) are associated with the exposure \(X\);
**A2.**: [_Exclusion Restriction_] The genetic variants \(\) have no direct pathway to the outcome \(Y\);

**A3.**: [_Randomness_] The genetic variants \(\) are uncorrelated with unmeasured confounders \(\).

Figure 1 illustrates these three assumptions for a genetic variant \(G\) that is a valid IV relative to the causal relationship \(X Y\). Given a valid IV \(G\) in the linear model, one can estimate the causal effect of risk factor \(X\) on the outcome \(Y\) of interest consistently by using Two-Stage Least Squares (TSLS) [Burges et al., 2017]. However, in most MR studies, the genetic variants may include some invalid IVs due to horizontal pleiotropy\(-\) where some genetic variants may have pleiotropic effects on both the treatment \(X\) and the outcome \(Y\) via different biological pathways [Davey Smith and Ebrahim, 2003, Lawlor et al., 2008]. How to select valid IVs from such genetic variants becomes the major issue in the MR study. In general, valid IVs need to be chosen based on domain knowledge or expert experience [Richmond et al., 2017, Martens et al., 2006, Zhao et al., 2023]. However, it is usually difficult to select appropriate valid IVs without precise prior knowledge of genetic variants, and an invalid IV may cause biased estimation of the effect of \(X\) on \(Y\)[Sanderson et al., 2022, Richmond and Smith, 2022]. Therefore, it is desirable to investigate ways of selecting genetic variants as valid IVs solely from observed variables.

Many contributions have been made to handle MR studies with some invalid IVs under specific assumptions. Existing methods can be roughly divided into four strategies. The first strategy assumes the _InSIDE assumption_, which states that the genetic variants' pleiotropic effects on the outcome \(Y\) are uncorrelated with their effects on the exposure \(X\), and requires that the number of IVs increases with the sample size [Bowden et al., 2015]. The second strategy is based on the _Majority rule assumption_, which assumes that over \(50\%\) of the candidate IVs are valid [Kang et al., 2016, Bowden et al., 2016, Windmeijer et al., 2019, Hartford et al., 2021]. The third strategy assumes the _Plurality rule assumption_, which means that the number of valid IVs is larger than any number of invalid IVs with the same ratio estimator limit [Guo et al., 2018, Windmeijer et al., 2021]. The last strategy assumes the _Two-Valid IVs assumption_, which requires that the number of valid IVs is greater than or equal to \(2\), and the _Rank-faithfulness assumption_, which states that the probability distribution \(P\) is rank-faithful to a directed acyclic graph \(\) if every rank constraint on a sub-covariance matrix that holds in \(P\) is entailed by every linear structural model with respect to \(\)[Silva and Shimizu, 2017, Xie et al., 2022, Cheng et al., 2023]. Although these methods have been used in various fields, they assumed that the one-directional causal relationship between \(X\) and \(Y\) is known and may fail to handle scenarios where bi-directional relationships are present.

Recently, Darrous et al.  proposed a latent heritable confounder MR method to estimate bi-directional causal effects with a hierarchical prior on the true parameters. However, their method is sensitive to prior misspecification. Later, Li and Ye  introduced a focusing framework to test bi-directional causal effects under the _noise distribution of the effect estimates assumption_, which is exciting. However, this assumption is strictly parameterized (See Condition 1 in [Li and Ye, 2022] for more details). Moreover, they focus on the two-sample MR model that assumes homogeneity across samples, whereas we consider the one-sample MR model. See Appendix A for more details.

In this paper, we aim to investigate the identifiability of the one-sample bi-directional MR model and to provide an estimation method. Specifically, we make the following contributions:

1. We present sufficient and necessary conditions for the identifiability of the bi-directional MR model, enabling both valid IV sets for each direction and the causal effects of interests to be correctly identified.
2. We propose a practical and effective cluster fusion-like algorithm for unbiased estimation. This algorithm correctly identifies which IVs are valid, determines the causal directions to which the valid IV sets belong, and estimates the bi-directional causal effects.
3. Extensive experiments demonstrate the efficacy of the proposed algorithms in MR models.

## 2 Model Definition and IV Estimator

### Bi-Directional MR Causal Models

Suppose we have \(n\) independent samples \((X_{i},Y_{i},_{i})\) from the distribution of \((X,Y,)\), where \(X\) and \(Y\) is a pair of phenotypes of interest, and \(=(G_{1},G_{2},,G_{g})^{}^{g}\) denotes

Figure 1: Graphical illustration of a valid IV model, where dashed lines indicate the absence of arrows. \(G\) is a valid IV relative to the causal relationship \(X Y\).

measured genetic variants, which may include invalid IVs. Analogous to Li and Ye (2022), for each sample, indexed by \(i\), the phenotype \(X_{i}\) is taken as a linear function of the phenotype \(Y_{i}\), genetic variants \(_{i}\), and an error term \(_{X_{i}}\), while phenotype \(Y_{i}\) is modeled as a linear function of the phenotype \(X_{i}\), genetic variants \(_{i}\), and an error term \(_{Y_{i}}\). Without loss of generality, we assume that all variables have a zero mean (otherwise can be centered). Specifically, the generating process of the data is given below:

\[X=Y_{Y X}+^{}_{X}+_{X},\\ Y=X_{X Y}+^{}_{Y}+ _{Y},\] (1)

where \(_{Y X}\) is the causal effect of \(Y\) on \(X\) and \(_{X Y}\) is that of \(X\) on \(Y\). \(_{X}=(_{X,1},...,_{X,g})^{}\) and \(_{Y}=(_{Y,1},...,_{Y,g})^{}\) are the direct effects of genetic variants \(\) on \(X\) and \(Y\), respectively. Note that \(_{X}\) and \(_{Y}\) are error terms that are correlated due to unmeasured confounders \(\) between \(X\) and \(Y\). Besides, there may exist a single genetic variant \(G_{i}\) with both \(_{X,i} 0\) and \(_{Y,i} 0\), which implies that \(G_{i}\) also has a direct pathway to the outcome, violating Assumption A2 (_Exclusion Restriction_). Like Li and Ye (2022), we here restrict the independence between any two genetic variants in \(\) (i.e., genetic variants are randomized). In Section 5, we discuss the situation where this restriction is violated. Unlike Li and Ye (2022), we allow genetic variants to cause unmeasured confounders (partially violating Assumption A3 (_Randomness_)).

Following Hausman (1983), we assume that \(_{X Y}_{Y X} 1\). Then let \(=1/(1-_{X Y}_{Y X})\), Eq.(1) can be reorganized to avoid recursive formulations as follows:

\[X=(^{}_{X}+^{}_{Y}_{Y X}+_{X}+ _{Y}_{Y X}),\\ Y=(^{}_{X}_{X Y}+^{ }_{Y}+_{X}_{X Y}+ _{Y}).\] (2)

If \(_{X Y}_{Y X}=1\), the causal effects \(_{X Y}\) and \(_{Y X}\) are not identifiable, even in the presence of a valid IV.

_Goal._ In this paper, we aim to address whether the bi-directional MR model in Eq.(1) is identifiable; that is, whether we can estimate the causal effects \(_{X Y}\) and \(_{Y X}\) given infinite data, even without prior knowledge about which candidate IVs are valid or invalid.

### IV Estimator

In this section, we briefly describe the classical IV estimator, the two-stage least squares (TSLS) estimator, which is capable of consistently estimating the causal effects \(_{X Y}\) and \(_{Y X}\) of interest in the above bi-directional MR causal model of Eq.(1) when the valid IVs are known (Woolridge, 2010). We denote by \(_{}^{X Y}\) the set consisting of all valid IVs in \(\) relative to \(X Y\), and \(_{}^{X Y}\) the set that consists of at least one invalid IV in \(\) relative to \(X Y\). Similar notations are applied to the inverse causal relationship \(Y X\), i.e., \(_{}^{Y X}\) and \(_{}^{Y X}\).

**Proposition 1** (Two Stage Least Square (TSLS) Estimator).: _Assume the system is a linear bi-directional causal model 1. For a given causal relationship \(X Y\) in the system, the causal effect of \(X\) on \(Y\) can be identified by_

\[_{X Y}=[X^{}X]^{-1}X^{ }Y=_{X Y},\] (3)

_where \(=(_{}^{X Y})^{}[_{ }^{X Y}(_{}^{X Y})^{}]^{- 1}_{}^{X Y}\) is the projection matrix._

**Remark 1**.: _Note that, when utilizing the TSLS estimator, the causal effect is biased if the candidate set \(\) includes invalid IVs. For instance, consider the causal relationship \(X Y\), given an invalid IV set \(_{}^{X Y}\), the causal effect of \(X\) on \(Y\) is given by_

\[_{X Y}=[X^{}}X]^{-1}X^{ }}Y =_{X Y}+}X ]^{-1}X^{}}(^{} _{Y}+_{Y})}_{_{bias}},\]

_where \(}=(_{}^{X Y})^{}[ _{}^{X Y}(_{}^{X Y})^{ }]^{-1}_{}^{X Y}\)._

In the remaining of the paper, we denote such a procedure by \(_{X Y}=(X,Y,^{X Y})\). Similarly, for causal relationship \(Y X\), one can also have the corresponding causal effect of \(Y\) on \(X\) given the set of IVs, i.e., \(_{Y X}=(Y,X,^{Y X})\). For details about the proof of Proposition 1 and Remark 1, please refer to Appendix G.1 and G.2.

Identifiability of Bi-Directional MR Model

In this section, we first show by a simple example that the valid and invalid IV sets can impose different constraints. Then, we formulate these constraints and present the necessary and sufficient conditions that render the model identifiable.

### A Motivating Example

Figure 2 gives an illustration of our basic idea. Suppose there are 2 valid IVs, i.e., \(G_{1}\) and \(G_{3}\), and 3 invalid IVs, i.e., \(G_{2}\), \(G_{4}\) and \(G_{5}\), relative to the causal relationship \(X Y\). For the inverse \(Y X\), identical conclusions can be derived. Assume the generating process of \(X\) and \(Y\) follows Eq.(1), where specifically we set all variables to have a zero mean and unit variance and \(X=Y_{Y X}+G_{1}_{X,1}+G_{2}_{X,2}+G_{3}_{X,3}+G_{4} _{X,4}+G_{5}_{X,5}+_{X}\), and \(Y=X_{X Y}+G_{2}_{Y,2}+G_{4}_{Y,4}+G_{5}_{Y,5}+ _{Y}\), where \(_{X Y}=_{Y X}=0.6,_{X,1}=_{X,2}=_{X,3}=1, _{X,4}=1.8,_{X,5}=1.2,_{Y,2}=0.5,_{Y,4}=0.6,_{Y,5 }=0.3\).

Interestingly, we have the following observations:

Observation 1.Given a valid IV set where there are at least two IVs, e.g., \(_{}^{X Y}=(G_{1},G_{3})^{}\), we have:

\[(Y-X_{\{G_{3}\}},G_{1})=0,(Y-X_{\{ G_{1}\}},G_{3})=0,\]

where \(()\) denotes the Pearson's correlation coefficient between two random variables, and \(_{\{G_{i}\}}=(X,Y,\{G_{i}\})\) with \(i\{1,3\}\).

Observation 2.However, given an invalid IV set, e.g., \(_{}^{X Y}=(G_{2},G_{4},G_{5})^{}\), we have:

\[(Y-X_{\{G_{4},G_{5}\}},G_{2}) 0,(Y-X_{ \{G_{2},G_{5}\}},G_{4}) 0,(Y-X_{\{G_{2},G_{4}\}},G_{5})  0,\]

where \(_{\{G_{i},G_{j}\}}=(X,Y,\{G_{i},G_{j}\})\) with \(i j\) and \(i,j\{2,4,5\}\).

Based on these two observations, we can see that the valid and invalid IV sets entail clearly different constraints regarding the correlation coefficients3, which inspires us to further derive our identification analysis. For details about the observations, please refer to Appendix C.

### Main Identification Results

We begin with the following definition and the main assumptions.

**Definition 1**.: _(Pseudo-Residual) Let \(\) be a subset of candidate genetic variants. A pseudo-residual of \(\{X,Y\}\) relative to \(\) is defined as_

\[_{\{X,Y\,|\,\}}:=Y-X_{},\] (4)

_where \(_{}=(X,Y,)\)._

This "pseudo-residual" is applied to measure the uncorrelated relationship with some genetic variants. Note that concepts to "pseudo-residual" have been developed to address different tasks (Dtron and Richardson, 2004; Chen et al., 2017; Cai et al., 2019; Xie et al., 2020), but our formalization is different from theirs in terms of the parameter \(_{}\). To the best of our knowledge, it has not been realized that the uncorrelated property involving such pseudo-residuals reflects the validity of the IVs in the bi-directional MR causal model (see Propositions 2 \(\) 3).

As analyzed by Chu et al. (2001), within the framework of linear models, a variable being a valid IV imposes no constraints on the joint marginal distribution of the observed variables. In other words, there is no available test to determine whether a variable is a valid IV without making further assumptions. Therefore, we introduce the following assumption.

**Assumption 1** (Valid IV Set).: _For a given causal relationship (if the relationship exists), there exists a valid IV set that consists of at least two valid IVs. For example, for the causal relationship \(X Y\), \(|_{}^{X Y}| 2\)._

Figure 2: An illustrative example where valid and invalid IV sets induce distinct constraints, where \(_{}^{X Y}=(G_{1},G_{3})^{}\) is a valid IV set, while \(_{}^{X Y}=(G_{2},G_{4},G_{5})^{}\) is invalid due to pathways \(G_{2} Y\), \(G_{4} Y\) and \(G_{5} Y\).

Assumption 1 is the same as in (Silva and Shimizu, 2017; Cheng et al., 2023) if the model is a one-directional MR model. Notice that this assumption is much milder than the _Majority rule_ assumption (Kang et al., 2016; Bowden et al., 2016; Windmeijer et al., 2019; Hartford et al., 2021) and _Plurality rule_ assumption (Guo et al., 2018; Windmeijer et al., 2021): Assumption 1 does not rely on the total number of genetic variants, while _Majority rule_ and _Plurality rule_ assumptions do.

We now show that under Assumption 1, one can identify the class of invalid IV sets.

**Proposition 2** (Identifying Invalid IV Sets).: _Let \(=\{G_{1},,G_{p}\},p 2\) be a subset of candidate genetic variants \(\). Suppose that Assumption 1 and the size of participants \(n\) hold. If there exists a \(G_{j}\) such that,_

\[(_{ X,Y\,|\,\{G_{j}\}},G_{j }) 0,\] (5)

_then \(\) is an invalid IV set for any one of the causal relationships._

Proposition 2 is valuable when given a set of genetic variants but lack prior knowledge of the validity of IV sets. By testing specific correlations in Eq.(5), we can conclude that the current IV set is invalid.

**Example 1**.: _Consider the example in Figure 2. Suppose \(=\{G_{1},G_{2}\}\), according to Proposition 2 we have \((_{ X,Y\,|\,\{G_{2}\}},G_{1}) 0\). Thus \(\) is an invalid IV set._

One may naturally raise the following question: Can all the invalid IV sets be identified by Proposition 2? In other words, can we identify all the valid IV sets? Unfortunately, Assumption 1 is an insufficient condition for identifying the sets of valid IVs. See an illustrative example below.

**Example 2** (Counterexample).: _Consider the example in Figure 3. Suppose \(=\{G_{1},G_{2}\}\). In subgraph (a), for \(G_{1}\), according to Proposition 2 we obtain_

\[(_{ X,Y\,|\,\{G_{2}\}},G_{1 })=0\] (6)

_Similarly, for \(G_{2}\), we have_

\[(_{ X,Y\,|\,\{G_{1}\}},G_{2 })=0\] (7)

_In subgraph (b), for \(G_{1}\), we check the condition of Proposition 2 and obtain_

\[(_{ X,Y\,|\,\{G_{2}\}},G_{1 })=_{X,2}-_{Y,2}_{X,1}}{_{Y X }_{Y,2}+_{X,2}}.\] (8)

_Similarly, for \(G_{2}\), we have_

\[(_{ X,Y\,|\,\{G_{1}\}},G_{2 })=_{X,1}-_{Y,1}_{X,2}}{_{Y X }_{Y,1}+_{X,1}}.\] (9)

_We know that \(\{G_{1},G_{2}\}\) is an invalid IV set in this case. However, if the proportion of effects of \(G_{1}\) on \(X\) and \(Y\) is equal to the proportion of the effects of \(G_{2}\) on \(X\) and \(Y\), i.e., \(_{X,1}_{Y,2}=_{Y,1}_{X,2}\), we have_

\[(_{ X,Y\,|\,\{G_{2}\}},G_{1 })=0,(_{ X,Y\,|\,\{G_{1}\} },G_{2})=0,\]

_which is consistent with the conclusion of subgraph (a). These observations imply that one can not identify valid IV sets under only Assumption 1._

To give sufficient conditions for identifying valid IV sets, we first introduce the following assumption.

**Assumption 2** (Generic Identifiability).: _For a given MR causal model, parameters \(\) and \(\) live in a set of Lebesgue measure non-zero._

Figure 3: An illustrative example that valid and invalid IV sets may induce the same constraints in Eq.(5) of Proposition 2, where \(\{G_{1},G_{2}\}\) is the set of valid IVs in (a), while invalid in (b). It implies Assumption 1 is not sufficient to find valid IV sets.

In other words, Assumption 2 specifically implies that given a general subset of candidate genetic variants \(\), there exists a \(G_{j}\) that satisfies \(|_{G_{i}/G_{j}}_{i}cov(G_{i},G_{i})[(_{X,i}+ _{X,U}_{U,i})(_{Y,j}+_{Y,U}_{U,j})-(_{Y,i}+ _{Y,U}_{U,i})(_{X,j}+_{X,U}_{U,j})]| 0\), where \(_{i} 0\) is the estimated coefficient between \(G_{i}\) and \(X\). For instance, in Example 2, such an assumption simplifies to \(_{X,1}_{Y,2}_{Y,1}_{X,2}\). Whenever \(_{X,1}_{Y,2}=_{Y,1}_{X,2}\), parameters \(\) and \(\) would fall into a set of Lebesgue measure zero, rendering non-identifiable of the model. It is worth noting that in real life, although we cannot obtain the ground truths of causal effects between variables, especially when latent confounders are involved, Assumption 2 is generally satisfied. This is because the set of conditions to violate it occupies a very small portion of the entire space.

With Assumption 2, we now derive sufficient conditions for generic identifiability in Proposition 3.

**Proposition 3** (Identifying Valid IV Sets).: _Let \(=\{G_{1},,G_{p}\},p 2\) be a subset of candidate genetic variants \(\). Suppose that Assumptions 1 and 2, and the size of participants \(n\) hold. If each \(G_{j}\) satisfies_

\[(_{(X,Y\,|\, G_{j})},G_{j})=0,\] (10)

_then \(\) is a proper valid IV set for one of the causal relationships, i.e., \(_{}^{X Y}\) or \(_{}^{Y X}\)._

Proposition 3 indicates that, under Assumptions 1 and 2, we are able to identify a subset that consists of valid IVs for one of the relationships, from the candidate genetic variants \(\). Here, it should be noted that in a bi-directional MR model (with both \(_{X Y} 0\) and \(_{Y X} 0\)), one cannot determine whether the identified IV set \(\) is related to the causal relationship \(X Y\) or \(Y X\). To address this, we here introduce the following conditions that allow the estimated valid IV sets to determine the direction.

**Assumption 3**.: _In a bi-directional MR model, for a given causal relationship \(X Y\), \(_{X Y}^{2}(X)<(Y)\). Similarly, for a given causal relationship \(Y X\), \(_{Y X}^{2}(Y)(X)\)._

Assumption 3 is a very natural condition that one expects to hold for the unique identifiability of valid IVs for the bi-directional model. This assumption is often reasonable in MR models as discussed in Xue and Pan (2020). One may refer to Pages 4\(\)5 in Xue and Pan (2020) for more details.

**Proposition 4** (Identifying Direction of Causal Influences).: _Suppose Assumption 3 holds. Given a valid IV set denoted as \(\), if each \(G_{j}\) satisfies the condition \(|(G_{j},Y)/(G_{j},X)|<1\), then \(\) is a valid IV set for the causal relationship \(X Y\), i.e., \(_{}^{X Y}\). Conversely, if this condition is not satisfied, \(\) is a valid IV set for the causal relationship \(Y X\), i.e., \(_{}^{Y X}\)._

Proposition 4 indicates that, under Assumption 3, it is possible to ascertain the directional orientation of the identified IV sets. Thus, with Propositions 2\(\)4, we have sufficient and necessary conditions under which the bi-directional MR model is fully identifiable, formalized as follows:

**Theorem 1** (Identifiability of Bi-directional MR model).: _Suppose that Assumptions 1\(\) 3, and the size of participants \(n\) hold, the Bi-directional MR model is fully identifiable, which includes the identification of valid IV sets, the causal relationships the identified sets relate to, the causal directions between \(X\) and \(Y\), and the causal effects of \(X\) on \(Y\) as well as of \(Y\) on \(X\)._

## 4 PReBiM Algorithm

In this section, we leverage the above theoretical results and propose a data-driven algorithm, PReBiM (**P**seudo-**R**esidual-based **Bi**-directional **MR**), for estimating the causal effects of interest. It contains two key steps, finding valid IV sets (Step I), and inferring causal direction and estimating the causal effects given the identified valid IV sets (Step II). The algorithm is designed with the following rules, which are proved correct: (1) valid IV sets can be correctly discovered given the measured genetic variants (Section 4.1), and (2) the causal direction and causal effects can be uniquely identified (Section 4.2). The entire process is summarized in Algorithm 1.

```
1:A dataset of measured genetic variants \(=(G_{1},...,G_{g})^{}\), two phenotypes \(X\) and \(Y\), significance level \(\), and parameter \(W\), maximum number of IVs to consider.
2:Valid IV sets \(\) FindValidIVSets(\(\), \(X\), \(Y\), \(\), \(W\)); \(\)Step I
3:\((_{X Y},_{Y X})\) InferCausalDirectionEffects(\(X\), \(Y\), \(\)); \(\)Step II
4:\(_{X Y}\) and \(_{Y X}\), the causal effects of \(X\) on \(Y\) and \(Y\) on \(X\), respectively. ```

**Algorithm 1** PReBiM

**Input:** A dataset of measured genetic variants \(=(G_{1},...,G_{g})^{}\), two phenotypes \(X\) and \(Y\), significance level \(\), and parameter \(W\), maximum number of IVs to consider.

```
1:Valid IV sets \(\) FindValidIVSets(\(\), \(X\), \(Y\), \(\), \(W\)); \(\)Step I
2:\((_{X Y},_{Y X})\) InferCausalDirectionEffects(\(X\), \(Y\), \(\)); \(\)Step II
3:\(_{X Y}\) and \(_{Y X}\), the causal effects of \(X\) on \(Y\) and \(Y\) on \(X\), respectively. ```

**Algorithm 2** PReBiM

**Input:** A dataset of measured genetic variants \(=(G_{1},...,G_{g})^{}\), two phenotypes \(X\) and \(Y\), significance level \(\), and parameter \(W\), maximum number of IVs to consider.

```
1:Valid IV sets \(\) FindValidIVSets(\(\), \(X\), \(Y\), \(\), \(W\)); \(\)Step I
2:\((_{X Y},_{Y X})\) InferCausalDirectionEffects(\(X\), \(Y\), \(\)); \(\)Step II
3:\(_{X Y}\) and \(_{Y X}\), the causal effects of \(X\) on \(Y\) and \(Y\) on \(X\), respectively. ```

**Algorithm 3** PReBiM

**Input:** A dataset of measured genetic variants \(=(G_{1},...,G_{g})^{}\), two phenotypes \(X\) and \(Y\), significance level \(\), and parameter \(W\), maximum number of IVs to consider.

1:Valid IV sets \(\) FindValidIVSets(\(\), \(X\), \(Y\), \(\), \(W\)); \(\)Step I
2:\((_{X Y},_{Y X})\) InferCausalDirectionEffects(\(X\), \(Y\), \(\)); \(\)Step II
3:\(_{X Y}\) and \(_{Y X}\), the causal effects of \(X\) on \(Y\) and \(Y\) on \(X\), respectively. ```

**Algorithm 3** PReBiM

**Input:** A dataset of measured genetic variants \(=(G_{1},...,G_{g})^{}\), two phenotypes \(X\) and \(Y\), significance level \(\), and parameter \(W\), maximum number of IVs to consider.

1:Valid IV sets \(\) FindValidIVSets(\(\), \(X\), \(Y\), \(\), \(W\)); \(\)Step I
2:\((_{X Y},_{Y X})\) InferCausalDirectionEffects(\(X\), \(Y\), \(\)); \(\)Step II
4:\(_{X Y}\) and \(_{Y X}\), the causal effects of \(X\) on \(Y\) and \(Y\) on \(X\), respectively. ```

**Algorithm 4** PReBiM

**Input:** A dataset of measured genetic variants \(=(G_{1},...,G_{g})^{}\), two phenotypes \(X\) and \(Y\), significance level \(\), and parameter \(W\), maximum number of IVs to 

### Step I: Finding Valid IV Sets

Propositions 2 and 3 have paved the way to distinguish the invalid and valid IV sets, respectively. This enables us to use a cluster fusion-like method to discover the valid IV sets4. To improve the algorithm's effectiveness with a finite sample size, especially when the pool of candidate genetic variants \(\) is substantial, we introduce a parameter \(W\), representing the maximum number of instrumental variables (IVs) to consider. This approach aims to circumvent the necessity of identifying the largest IV set within the collection, thereby minimizing the need for IV validity testing.

The basic process is provided in Algorithm 2. Due to limited space, the specific details of algorithm execution are provided in Appendix E. In practice, we check for the valid IV test, i.e., Eq.(10), with the Pearson Correlation Test using the Fisher transformation (Anderson, 2003), denoted by PCT.

```
0: A dataset of measured genetic variants \(=(G_{1},...,G_{g})^{}\), two phenotypes \(X\) and \(Y\), significance level \(\), and parameter \(W\), maximum number of IVs to consider.
1. Initialize valid IV sets \(=\) and \(}=\).
2. Find \(_{new}\) with \(||=2\) according to minimize the sum of correlation between pseudo-residual \(_{(X,Y G G_{i})}\) and \(G_{i}\), where \(G_{i}\) and \(}\).
3. Update \(_{new}\) by incrementally adding genetic variant \(G_{k}\) until it is impossible to add variables without passing PCT or the length of the set \(_{new}\) reaches our predetermined threshold \(W\).
4. Repeat Step 1 and Step 2 to find another \(_{new}^{}\). If \(\) is empty, add \(_{new}^{}\) to \(\). If not, and the combined set \(\{_{new}^{}\}\) passes the PCT, merge them; otherwise, discard \(_{new}^{}\). Stop the iteration when \(\) contains two sets of IVs or when there is one or fewer genetic variants left in \(}\).
5:\(\), a set that collects the valid IV sets. ```

**Algorithm 2** FindValidIVSets

### Step II: Inferring Causal Direction and Estimating the Causal Effects

In this section, we infer the causal direction and estimate the causal effects given the identified valid IV sets. The basic process is provided in Algorithm 3. Due to limited space, the specific details of algorithm execution are provided in Appendix F.

```
0: Two phenotypes \(X\) and \(Y\), Valid IV sets \(\).
1. Infer the causal direction corresponding to the valid IV set \(\) based on Proposition 4.
2. Calculate the final causal effects \(_{X Y}\) and \(_{Y X}\) by \(()\).
3:\(_{X Y}\) and \(_{Y X}\) ```

**Algorithm 3** InferCausalDirectionEffects

### Correctness of PReBiM Algorithm

In this section, we show that, in the large sample limit, for the causal relationships of interest \(X Y\), the causal effects \(_{X Y}\) and \(_{Y X}\) obtained through the proposed method are unbiased.

**Theorem 2** (Correctness).: _Assume that the data \(\{X,Y\}\) and \(\) strictly follow Eq.(1) and Assumptions 1 \(\) 3 hold. Given infinite samples, the PReBiM algorithm outputs the true causal effects \(_{X Y}\) and \(_{Y X}\) correctly._

### Complexity of PReBiM Algorithm

We give the computational complexity analysis as follows. First, the complexity of finding a valid IV set \(_{new}\) of length 2 is \((2)\), where \(g\) is the number of IVs. Then, the complexity of expanding \(_{new}\) to the length \(W\) is \(()\), where \(W\) is the maximum length of the IV set. For finding additional valid IV sets, the number of loops, \(t\), must satisfy \(t\). The complexity of finding the second valid IV set of length \(W\) is given by \((_{k=1}^{t}(2+)+2W(t-1)+1)\).

Therefore, the total computational complexity of the PReBiM algorithm is \((_{k=0}^{t}(2^{}+ {2})+2W(t-1)+1)\).

## 5 Discussion

The preceding sections demonstrate that a valid IV set can be identified when any two genetic variants in \(\) are independent. In this section, we explore whether the main results of Propositions 2 and 3 remain applicable when some genetic variants in \(\) are dependent. As shown in Figure 4 (b), we evaluate the condition of Proposition 2 and find that \((_{(X,Y,|G_{2})},G_{1}) 0\) and \((_{(X,Y,|G_{1})},G_{2}) 0\). This indicates that \(\{G_{1},G_{2}\}\) is an invalid IV set. Conversely, in Figure 4 (a), when assessing the condition of Proposition 3, we observe that \((_{(X,Y,|G_{2})},G_{1})=0\) and \((_{(X,Y,|G_{1})},G_{2})=0\), suggesting that \(\{G_{1},G_{2}\}\) is a valid IV set. Consequently, it is interesting to note that even with such dependence between genetic variants, our main results may still be effective in identifying valid IV sets. In Appendix H.1 \(\) H.2, we further demonstrate the practicality of our method for this example. As for the complex scenarios where there is confounding among genetic variants or between the genetic variants and some phenotype, or where there exist genetic variants that are associated with another phenotype while this phenotype causes \(X\) and \(Y\), we leave them into our future work.

## 6 Experimental Results

In this section, we conduct various simulation studies to evaluate the performance of the proposed PReBiM method. The methods we compare against are: 1) NAIVE, the least-squares regression method; 2) MR-Egger [Bowden et al., 2015]; 3) sisVIVE algorithm [Kang et al., 2016]5; 4) IV-TETRAD algorithm[Silva and Shimizu, 2017]6; 5) TSHT algorithm [Guo et al., 2018]7; and 6) PReBiM, our method. The second method, MR-Egger, is specifically for MR studies with invalid IVs. The last four methods are capable of handling the one-sample MR model in the presence of unmeasured confounders. Our source code can be found in the Supplementary Materials.

**Experimental setup.** To compare the performance of these methods in a realistic setting, analogous to Slob and Burgess (2020), the genetic variants are modeled as Single Nucleotide Polymorphisms (SNPs), with a varying minor allele frequency \(_{j}\), and take values 0, 1, or 2. The minor allele frequencies are drawn from a uniform distribution. Specifically, the data generation process for the bi-directional model is as follows:

\[U =^{}_{U}+_{1},\] (11) \[X =Y_{Y X}+^{}_{X}+U_{X,U}+ _{2},\] (12) \[Y =X_{X Y}+^{}_{Y}+U_{Y,U}+ _{3},\] (13) \[G_{ij} (2,_{j}),_{j} (0.1,0.5),\] (14)

where the error terms \(_{1}\), \(_{2}\), \(_{3}\) each follow an independent normal distribution with mean \(0\) and unit variance. The causal effects \(_{Y X}\) and \(_{X Y}\) are generated from a uniform distribution between \([-1,-0.5][0.5,1]\). Note that by setting \(_{Y X}=0\) in Eq.(12), the data generation process for the one directional model can be obtained.

We here conducted experiments with the following tasks.

* **T1: Sensitivity to Sample Size.** We evaluated the impact of different sample sizes: \(n=2k,5k\), and \(10k\), where \(k\) equals \(1,000\).

Figure 4: Simple examples, where \(\{G_{1},G_{2}\}\) is a valid IV set in (a), whereas invalid in (b).

* **T2: Sensitivity to the Number of Valid IVs.** We explored three distinct IV combination scenarios: \((2,2,6)\), \((3,3,8)\), and \((4,4,10)\). The first two elements in the parentheses represent the number of valid instrumental variables for causal relationships \(X Y\) and \(Y X\), respectively. The last element in the parentheses represents the total number of genetic variants.

For a comprehensive analysis, we examined the data from the Bi-directional MR model and the One-directional MR model, as detailed in Section 6.1 and 6.2, respectively. For each experimental setting, we repeated the simulation 500 times and averaged the results.

**Metrics:** We adopted the following evaluation metrics to evaluate the results of all methods.

* **(i) Correct-Selecting Rate (CSR)**: the number of correctly identified valid IVs divided by the total number of genetic variants, for the direction \(X Y\) or \(Y X\).
* **(ii) Mean Squared Error (MSE)**: The squared difference between the estimated causal effect and the true causal effect.

To further validate the effectiveness and practicality of our algorithm, we have expanded our experimental settings to include additional scenarios such as small sample sizes, different numbers of valid IVs, large-scale datasets, and cases where all IVs are valid. Within these settings, we compare our algorithm with the five aforementioned methods to assess algorithm performance. Detailed experimental results are provided in Appendix H.3\(\) H.6.

### Evaluation on Bi-Directional MR Model

In this section, we evaluate the performance of six methods on bi-directional MR data, i.e., \(_{X Y} 0\) and \(_{Y X} 0\). Table 1 summarizes the results of metrics CSR and MSE in a bi-directional MR model with various sample sizes. It is noted that sisVIVE, IV-TERRAD, and TSHT are not specifically designed for the bi-directional model, so we run them in both forward and reverse directions to obtain the corresponding results. As expected, our proposed PReBiM method gives the best results in all three scenarios, with all sample sizes, indicating that it can identify valid IVs and derive consistent causal effects from purely observational data, even without knowledge of the causal direction between \(X\) and \(Y\). Furthermore, the performance of the other three comparison methods of selecting IVs was poor, indicating that they are not suitable for bi-directional MR models. The MSE of the NAIVE method does not tend toward 0, indicating that if unobserved confounding is not considered, the estimated causal effect is certainly biased. Similarly, the MSE of MR-Egger is poor if estimated with all instrumental variables.

### Evaluation on One-Directional MR Model

In this section, we evaluate the performance of six methods on one-directional MR data, e.g., \(_{X Y} 0\) and \(_{Y X}=0\). For fairness, we assume that the causal direction \(X Y\) is known for all methods. Figure 5 summarizes the results of metrics CSR (solid lines) and MSE (dashed

    & & & (2,2,6)\)} & (3,3,8)\)} & (4,4,10)\)} \\   & & \(X Y\) & \(Y X\) & \(X Y\) & \(Y X\) & \(X Y\) & \(Y X\) & \(Y X\) & \(Y X\) \\   & Algorithm & **CSR** & **MSE\({}_{}\)** & **CSR** & **MSE\({}_{}\)** & **CSR** & **MSE\({}_{}\)** & **CSR** & **MSE\({}_{}\)** & **CSR** & **MSE\({}_{}\)** & **CSR** & **MSE\({}_{}\)** \\   & NAIVE & - & 0.354 & - & 0.349 & - & 0.351 & - & 0.320 & - & 0.335 & - & 0.304 \\  & MR-Egger & - & 0.800 & - & 0.734 & - & 0.571 & - & 0.569 & - & 0.457 & - & 0.494 \\  & sisVIVE & 0.30 & 0.398 & 0.25 & 0.447 & 0.34 & 0.379 & 0.32 & 0.379 & 0.37 & 0.346 & 0.38 & 0.330 \\  & IV-TERRAD & 0.60 & 0.859 & 0.30 & 0.867 & 0.60 & 0.773 & 0.28 & 0.782 & 0.67 & 0.688 & 0.23 & 0.622 \\  & TSHT & 0.07 & 0.606 & 0.06 & 0.660 & 0.07 & 0.549 & 0.07 & 0.613 & 0.12 & 0.653 & 0.11 & 0.689 \\  & PReBiM & **0.85** & **0.046** & **0.85** & **0.070** & **0.89** & **0.083** & **0.87** & **0.075** & **0.88** & **0.039** & **0.89** & **0.857** \\   & NAIVE & - & 0.350 & - & 0.339 & - & 0.347 & - & 0.319 & - & 0.337 & - & 0.306 \\  & MR-Egger & - & 0.737 & - & 0.836 & - & 0.604 & - & 0.508 & - & 0.515 & - & 0.520 \\  & sisVIVE & 0.32 & 0.421 & 0.30 & 0.407 & 0.33 & 0.378 & 0.35 & 0.384 & 0.393 & 0.38 & 0.365 \\  & IV-TERRAD & 0.62 & 0.804 & 0.31 & 0.844 & 0.63 & 0.836 & 0.29 & 0.659 & 0.67 & 0.686 & 0.25 & 0.640 \\  & TSHT & 0.04 & 0.544 & 0.06 & 0.565 & 0.08 & 0.528 & 0.06 & 0.570 & 0.10 & 0.549 & 0.07 & 0.541 \\  & PreBiM & **0.93** & **0.020** & **0.91** & **0.027** & **0.90** & **0.019** & **0.92** & **0.020** & **0.90** & **0.009** & **0.91** & **0.010** \\   & NAIVE & - & 0.366 & - & 0.348 & - & 0.319 & - & 0.342 & - & 0.349 & - & 0.300 \\  & MR-Egger & - & 0.800 & - & 0.763 & - & 0.524 & - & 0.620 & - & 0.487 & - & 0.424 \\  & sisVIVE & 0.31 & 0.457 & 0.29 & 0.503 & 0.37 & 0.383 & 0.31 & 0.394 & 0.41 & 0.399 & 0.41 & 0.328 \\  & IV-TERRAD & 0.84 & 0.811 & 0.31 & 0.804 & 0.64 & 0.748 & 0.29 & 0.696 & 0.71 & 0.635 & 0.24 & 0.577 \\  & TSHT & 0.04 & 0.449 & 0.02 & 0.475 & 0.05 & 0.525 & 0.05 & 0.466 & 0.05 & 0.479 & 0.07 & 0.498 \\  & PreBiM & **0.95** & **0.044** & **0.93** & **0.018** & **0.93** & **0.026** & **0.93** & **0.039** & **0.93** & **0.027** & **0.94** & **0.011** \\    Note: The symbol "\(-\)" means methods have no output. "\(\)" means a higher value is better, and vice versa.

Table 1: Performance comparison of NAIVE, MR-Egger, sisVIVE, IV-TERRAD, TSHT, and PReBiM in estimating bi-directional MR models across various sample sizes and three scenarios.

lines) for all methods in a one-directional MR model with different scenarios. As expected, the metrics CSR and MSE of our method approach the expected value as the sample size increases. The overall results are comparable to the IV-TETRAD algorithm and superior to the sisVIVE algorithm and TSHT algorithm. This is because our method, similar to the IV-TETRAD method, requires fewer valid IVs in the system (at least 2), whereas the other two methods require the number of valid IVs that are related to the overall genetic variants, namely the majority rule assumption (over \(50\%\) of the candidate IVs are valid) and plurality rule assumption (the number of valid IVs is larger than any number of invalid IVs). It has been noted that under the IV-TETRAD method for scenario \((2,0,6)\), the metrics CSR and MSE outperform our method. This is because the IV-TETRAD method requires a predetermined number of IV sets to be specified in advance, and in this case, we have predetermined the number of valid IVs for it. However, our method does not have this prior information.

### Evaluation on Real-World Data

We first apply our method to analyze the bi-directional causal relationships between obesity and vitamin D status using the GWAS data from Vimaleswaran et al. (2013). Note that the original data only consists of summary data, and thus we generate individual-level data based on the data generation mechanism described in Eq.(1). The data we used comprises 16 related SNPs as candidate IVs, including seven SNPs associated with obesity (BMI): rs9939609 (FTO), rs2867125 (TMEM18), rs4074134 (BDNF), rs7647305 (ETV5), rs7138803 (FAIM2), rs3101336 (NEGR1), and rs10938397 (GNPDA2); four SNPs related to 25-hydroxyvitamin D (25(OHD)): rs12785878 (DHCR7), rs10741657 (CYP2R1), rs2282679 (GC), and rs6013897 (CYP2A41); and five SNPs associated with BMI and 25(OHD): rs4498364, rs1381660, rs4549702, rs12760109, and rs77913838. We observed that FTO and FAIM2 serve as valid IVs for the \(X Y\), while DHCR7 and CYP24A1 are valid IVs for the \(Y X\), with estimated causal effects of -1.15 and -0.05, respectively. These findings are consistent with those findings in (Vimaleswaran et al., 2013).

Next, we apply our method to analyze the causal effect of institutions on economic development using the Colonial Origins dataset from (Acemoglu et al., 2001). The data includes eight candidate IVs: absolute latitude (lat_abst), the density of European settlements in 1900 (euro1900), the level of democracy in 1900 (democ1), constitutional constraints in 1900 (cons1), the timing of industrialization (indtime), democracy in 2000 (democ00a), constitutional constraints in 2000 (cons00a), and log-transformed European settler mortality rates (logem4). Our method identifies euro1900 and logem4 as valid IVs, with an estimated causal effect of 0.861, which is consistent with the findings reported in Acemoglu et al. (2001).

## 7 Conclusion

We investigated the identifiability conditions for the bi-directional MR model using purely observational data. First, we proposed a testable constraint for identifying valid IV sets, and we demonstrated that, under appropriate conditions, these valid IV sets can be partially or even fully identified by checking the proposed constraints. Experimental results on both datasets further verified the effectiveness of our algorithm. Currently, we assume that genetic variants are randomized. Allowing for general dependent genetic variants is a direction for future work. Additionally, while we focus on a linear bi-directional MR model, in future research, we will generalize to address nonlinear or even more complex data.

Figure 5: Performance comparison of sisVIVE, IV-TETRAD, TSHT, and PReBiM in estimating one-directional MR models across various sample sizes and three scenarios.