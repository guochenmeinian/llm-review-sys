# [MISSING_PAGE_EMPTY:1]

[MISSING_PAGE_EMPTY:1]

Chen et al., 2024) or natural language inference (NLI) (Jullien et al., 2023). Putting more attention on interpretability, they use relatively simple tasks as testbeds, taking short text as input. Nevertheless, real-world clinical tasks are often more complex (Gao et al., 2023), as illustrated in Figure 1, a typical diagnosis requires comprehending and combining various information, such as health records, physical examinations, and laboratory tests, for further reasoning of possible diseases in a step-by-step manner following the established guidelines. This observation suggests that both _perception_, or reading (e.g., finding necessary information in the medical record) and _reasoning_ (determining the disease based on the observations) should be counted when evaluating interpretability in LLM-based medical NLP tasks.

For a more comprehensive evaluation of LLMs for supporting diagnosis in a more realistic setting, we propose a **D**iagnostic **R**easoning dataset for **C**linical no**T**es (DiReCT). The task basically is predicting the diagnosis from a _clinical note_ of a patient, which is a collection of various medical records, written in natural language. Our dataset contains 511 clinical notes spanning 25 disease categories, sampled from a publicly available database, MIMIC-IV (Johnson et al., 2023). Each clinical note undergoes fine-grained annotation by professional physicians. The annotators (i.e., the physicians) are responsible for identifying the text, or the _observation_, in the note that leads to a certain diagnosis, as well as the explanation. The dataset also provides a diagnostic knowledge graph based on existing diagnostic guidelines to facilitate more consistent annotations and to supply a model with essential knowledge for reasoning that might not be encompassed in its training data.

To underscore the challenge offered by our dataset, we propose a simple AI-agent based baseline (Xi et al., 2023; Tang et al., 2023) that utilizes the knowledge graph to decompose the diagnosis into a sequence of diagnoses from a smaller number of observations. Our experimental findings indicate that current state-of-the-art LLMs still fall short of aligning well with human doctors.

**Contribution**. DiReCT offers a new challenge in diagnosis from a complex clinical note with explicit knowledge of established guidelines. This challenge aligns with a realistic medical scenario that doctors are experiencing. In the application aspect, the dataset facilitates the development of a model to support doctors in diagnosis, which is error-prone (Middleton et al., 2013; Liu et al., 2022). From the technical aspect, the dataset can benchmark models' ability to read long text and find necessary observations for _multi-evidence entailment tree_ reasoning, an extension of the original entailment tree explanation (Dalvi et al., 2021) for complex scenarios in medical NLP tasks. As shown in Figure 3, this is not trivial because of the variations in writing; superficial matching does not help, and medical knowledge is vital. Meanwhile, reasoning itself is facilitated by the knowledge graph. The model does not necessarily have the knowledge of diagnostic guidelines. With this choice, the knowledge graph explains the reasoning process, which is also beneficial when deploying such a diagnosis assistant system in practical uses.

## 2 Related Works

**Natural language explanation**. Recent advancements in NLP have led to significant achievements (Min et al., 2023). However, existing models often lack explainability, posing potential risks (Danilevsky et al., 2020; Gurrapu et al., 2023). Numerous efforts have been made to address this challenge. One effective approach is to provide a human-understandable _plain text_ explanation alongside the model's output (Camburu et al., 2018; Rajani et al., 2019). Another strategy involves identifying _evidence_ within the input that serves as a rationale for the model's decisions, aligning with

Figure 1: When a patient is admitted, an initial consultation takes place to collect subjective information. Subsequent observations may then require further examination to confirm the diagnosis.

human reasoning (DeYoung et al., 2020). Expanding on this concept, (Jhantani and Clark, 2020) introduces chain-structured explanations, given that a diagnosis can demand multi-hop reasoning. This idea is further refined by ProofWriter (Tafjord et al., 2021) through a proof stage for explanations, and by (Zhao et al., 2021) through retrieval from a corpus. (Dalvi et al., 2021) proposes the _entailment tree_, offering more detailed explanations and facilitating inspection of the model's reasoning. More recently, (Zhang et al., 2024) employed cumulative reasoning to tap into the potential of LLMs to provide explanation via a _directed acyclic graph_. Although substantial progress has been made, interpreting NLP tasks in medical domains remains an ongoing challenge (Lievin et al., 2024).

**Benchmarks of interpretability in the medical domain** Several datasets are designed to assess a model's reasoning together with its interpretability in medical NLP (Table 1). MedMCQA (Pal et al., 2022) and other medical QA datasets (Li et al., 2023; Chen et al., 2024) provide plain text as explanations for QA tasks. NLI4CT (Jullien et al., 2023) uses clinical trial reports, focusing on NLI supported by multi-hop reasoning. N2N2 (Gao et al., 2022) proposes a summarization (Sum) task for a diagnosis based on multiple pieces of evidence in the input clinical note. NEJM CPC (Zack et al., 2023) interprets clinicians' diagnostic reasoning as plain text for reasoning clinical diagnosis (CD). DR.BENCH (Gao et al., 2023) aggregates publicly available datasets to assess the diagnostic reasoning of LLMs. Utilizing an multi-evidence entailment tree explanation, DiReCT introduces a more rigorous task to assess whether LLMs can align with doctors' reasoning in real clinical settings.

## 3 A benchmark for Clinical Notes Diagnosis

This section first detail clinical notes (Section 3.1). We also describes the knowledge graph that encodes existing guidelines (Section 3.2). Our task definition, which tasks a clinical note and the knowledge graph as input is given in Section 3.4. We then present our annotation process for clinical notes (Section 3.3) and the evaluation metrics (Section 3.5).

### Clinical Notes

Clinical notes used in DiReCT are stored in the SOAP format (Weed, 1970). A clinical note comprises four components: In the _subjective_ section, the physician records the patient's chief complaint, the history of present illness, and other subjective experiences reported by the patient. The _objective_ section contains structural data obtained through examinations (inspection, auscultation, etc.) and other measurable means. The _assessment_ section involves the physician's analysis and evaluation of the patient's condition. This may include a summary of current status, _etc_. Finally, the _plan_ section outlines the physician's proposed treatment and management plan. This may include prescribed medications, recommended therapies, and further investigations. A clinical note also includes a primary discharge diagnosis (PDD) in the assessment section.

DiReCT's clinical notes are sourced from the MIMIC-IV dataset (Johnson et al., 2023) (PhysioNet Credentialed Health Data License 1.5.0), which encompasses over 40,000 patients admitted to the intensive care units. Each note contains clinical data for a patient. To construct DiReCT, we curated a subset of 511 notes whose PDDs fell within one of 25 disease categories \(i\) in 5 medical domains.

In our task, a note \(R=\{r\}\) is an excerpt of 6 clinical data in the subjective and objective sections (i.e., \(|R|=6\)): chief complaint, history of present illness, past medical history, family history, physical

  
**Dataset** & **Task** & **Data Source** & **Length** & **Explanation** & **\# Cases** \\  MedMCQA (Pal et al., 2022) & QA & Examination & 9.93 t & Plain Text & 194,000 \\ ExplainCPE (Li et al., 2023) & QA & Examination & 37.79 w & Plain Text & 7,000 \\ JAMA Challenge (Chen et al., 2024) & QA & Clinical Cases & 371 w & Plain Text & 1,524 \\ Medbullets (Chen et al., 2024) & QA & Online Questions & 163 w & Plain Text & 308 \\ N2N2 (Gao et al., 2022) & Sum & Clinical Notes & 785.46 t & Evidences & 768 \\ NLI4CT (Jullien et al., 2023) & NLI & Clinical Trial Reports & 10-35 t & Multi-hop & 2,400 \\ NEJM CPC (Zack et al., 2023) & CD & Clinical Cases & - & Plain Text & 2,525 \\ DiReCT (Ours) & CD & Clinical Notes & 1074.6 t & Entailment Tree & 511 \\   

Table 1: Comparison of existing datasets for medical reasoning tasks and ours. “t” and “w” mean tokens and words for the length of input, respectively.

exam, and pertinent results.1 We also identified the PDD \(d^{}\) associated with \(R\).2 The set of \(d^{}\)'s for all \(R\)'s collectively forms \(^{}\). We manually removed any descriptions that disclose the PDD in \(R\).

### Diagnostic Knowledge Graph

Existing knowledge graphs for the medical domain, e.g., UMLS KG (Bodenreider, 2004), lack the ability to provide specific clinical decision support (e.g., diagnostic threshold, context-specific data, dosage information, etc.), which are critical for accurate diagnosis.

Our knowledge graphs \(=\{k_{i}\}\) is a collection of graph \(k_{i}\) for disease category \(i\). \(k_{i}\) is based on the diagnosis criteria in existing guidelines (refer to supplementary material for details). \(k_{i}\)'s nodes are either premise \(p_{i}\) (medical statement, e.g., Headache is a symptom of) and diagnoses \(d_{i}\) (e.g., Suspected Stroke). \(k_{i}\) consists of two different types of edges. One is _premise-to-diagnosis_ edges \(_{i}=\{(p,d)\}\); an edge is from \(p\) to \(d\). This edge represents the necessary premise \(p\) to make a diagnosis \(d\). We refer to them as _supporting_ edges. The other is _diagnosis-to-diagnosis_ edges \(_{i}=\{(d,d^{})\}\), where \(d,d^{}_{i}\) and the edge is from \(d\) to \(d^{}\), which represents the diagnostic flow. These edges are referred to as _procedural_ edges.

A disease category is defined according to an existing guideline, which starts from a certain diagnosis; therefore, a procedural graph \(g_{i}=(_{i},_{i})\) (\(=\{g_{i}\}\)) has only one root node and arbitrarily branches toward multiple leaf nodes that represent PDDs (i.e., the clinical notes in DiReCT are chosen to cover all leaf nodes of \(g_{i}\)). Thus, \(g_{i}\) is a _tree_. We denote the set of the leaf nodes (or PDDs) as \(_{i}^{}_{i}\). The knowledge graph is denoted by \(k_{i}=(_{i},_{i},_{i},_{i})\).

Figure 2 shows a part of \(k_{i}\), where \(i\) is Acute Coronary Syndromes (ACS). Premises in \(_{i}\) and diagnoses in \(_{i}\) are given in the blue and gray boxes, while PDDs in \(_{i}^{}\) are ones without outgoing edges (i.e., STEMI-ACS and NSTEMI-ACS, and UA). The black and red arrows are edges in \(\) and \(\), respectively, where the black arrows indicate the supporting edges.

\(\) serves two essential functions: (1) They serve as the gold standard for annotation, guiding doctors in the precise and uniform interpretation of clinical notes. (2) Our task also allows a model to use them to ensure the output from an LLM can be closely aligned with the reasoning processes of medical professionals.

### Data Annotation

Let \(d^{}_{i}^{}\) denote the PDD of disease category \(i\) associated with \(R\). We can find a subgraph \(k_{i}(d^{})\) of \(k_{i}\) that contains all ancestors of \(d^{}\), including premises in \(_{i}\). We also denote the set of supporting edges in \(k_{i}(d^{})\) as \(_{i}(d^{})\). Our annotation process is, for each supporting edge \((p,d)_{i}(d^{})\), to extract observation \(o\) in \(R\) (highlighted text in the clinical note in Figure 3) and provide rationalization \(z\) of this _deduction_ why \(o\) is a support for \(d\) or corresponds to \(p\).3 They form the explanation \(=\{(o,z,d)\}\) for \((R,d^{})\). This annotation process was carried out by 9 clinical physicians and subsequently verified for accuracy and completeness by three senior medical experts.

Table 2 summarizes statistics of our dataset. The second and third columns ("# cats." and "# samples") show the numbers of disease categories and samples in the respective medical domains. \(|_{i}|\) and \(|_{i}^{}|\) are the total numbers of diagnoses (diseases) and PDDs, summed over all diagnostic categories

Figure 2: A part of \(k_{i}\) for \(i\) being Acute Coronary Syndromes.

in the medical domain, respectively. \(||\) is the average number of annotated observations. "Length" is the average number of tokens in \(R\).

### Task Definition

We propose two tasks with different levels of supplied external knowledge. The first task is, given \(R\) and \(\), to predict the associated PDD \(d^{}\) and generate an explanation \(\) that explains the model's diagnostic procedure from \(R\) to \(d^{}\), i.e., letting \(M\) denote a model:

\[^{},}=M(R,),\] (1)

where \(^{}_{i}^{}_{i}\) and \(}\) are predictions for the PDD and explanation, respectively. With this task, the knowledge of specific diagnostic procedures in existing guidelines can be used for prediction, facilitating interpretability. The second task takes \(\) as input instead of \(\), i.e.,:

\[^{},}=M(R,).\] (2)

This task allows for the use of broader knowledge of premises for prediction. One may also try a task without any external knowledge.

### Evaluation Metrics

We designed three metrics to quantify the predictive performance over our benchmark.

(1) _Accuracy of diagnosis Acc\({}^{}\)_ evaluates if a model can correctly identify the diagnosis. \(Acc^{}=1\) if \(d^{}=\), and \(Acc^{}=0\) otherwise. The average is reported.

(2) _Completeness of observations Obs\({}^{}\)_ evaluates whether a model extracts all and only necessary observations for the prediction. Let \(\) and \(}\) denote the sets of observations in \(\) and \(}\), respectively. The metric is defined as \(Obs^{}=|}|/|}|\), where the numerator is the number of observations that are common in both \(\) and \(}\).4 This metric simultaneously evaluates the correctness of each observation and the coverage. To supplement it, we also report the precision \(Obs^{}\) and recall \(Obs^{}\), given by \(Obs^{}=|}|/|}|\) and \(Obs^{}=|}|/||\).

(3) _Faithfulness of explanations_ evaluates if the diagnostic flow toward the PDD is fully supported by observations with faithful rationalizations. This involves establishing a one-to-one correspondence between deductions in the prediction and the ground truth. We use the correspondences established for computing \(Obs^{}\). Let \(o\) and \(}\) denote corresponding observations. This correspondence

  Medical domain & \# cat. & \# samples & \(|_{i}|\) & \(|_{i}|\) & \(||\) & Length \\  Cardiology & 7 & 184 & 27 & 16 & 8.7 & 1156.6 t \\ Gastroenterology & 4 & 103 & 11 & 7 & 4.3 & 1026.0 t \\ Neurology & 5 & 77 & 17 & 11 & 11.9 & 1186.3 t \\ Philosophy & 5 & 92 & 26 & 17 & 10.7 & 940.7 t \\ Endontology & 4 & 55 & 20 & 14 & 6.9 & 1063.5 t \\  Overall & 25 & 511 & 101 & 65 & 8.5 & 1074.6 t \\  

Table 2: Statistics of DiReCT.

Figure 3: An annotation sample of Heart Failure (HF). The left part is the clinical note alongside extracted observations by a doctor. The middle part outlines the steps of the rationale for the premise corresponding to each diagnostic node shown in the right part.

is considered successful if \(z\) and \(\) as well as \(d\) and \(\) associated with \(o\) and \(\) matches. Let \(m(,})\) denote the number of successful matches. We use the ratio of \(m(,})\) to \(|}|\) and \(|}|\) as evaluation metrics \(^{}\) and \(^{}\), respectively, to see failures come from observations or explanations and diagnosis.

## 4 Baseline

Figure 4 provides an overview of our baseline, which comprises three LLM-based modules: narrowing-down (\(U\)), perception (\(W\)), and reasoning (\(V\)). In our experiments, each module utilizes the same type of LLM with different prompts (refer to the supplementary material for more details). \(U\) analyze the entire note \(R\) to determine the possible disease type \(\). \(W\) extracts observations that may lead to diseases from each \(r\), producing a list of original disease descriptions. \(V\) iteratively derives possible diseases from observations based on the diagnosis knowledge graph, providing rationales for each deduction \((o,z,d)\).

The narrowing-down module \(U\) takes \(R\) as input to make a prediction \(\) of the disease category, i.e., \(=U(R)\). Let \(d_{t}_{}\) be the diagnosis that has been reached with \(t\) iterations over \(k_{}\), where \(t\) corresponds to the depth of node \(d_{t}\) and so is less than or equal to the depth of \(k_{}\). \(d_{0}\) is the root node of \(k_{}\). For \(d_{0}\), we apply the perception module to extract all observations in \(R\) and explanation \(_{0}\) to support \(d_{0}\) as

\[},_{0}}=W(d_{0},k_{}).\] (3)

\(k_{}\) is supplied to facilitate the model to extract all observations for the following reasoning process.5 After the perception module \(W\) (iteration \(t=0\)), we obtain all observations \(}\), the root node of the diagnosis \(d_{0}\), and an explanation \(}_{0}\) for the initial iteration. Assuming that by iteration \(t\), we already know the diagnosis for iteration \(t\) as \(d_{t}\). \(\{d_{n}\}\) is the set of \(d_{t}\)'s children, and \(_{}(\{d_{n}\})\) represents the corresponding premises that support each \(d_{n}\). \(V\) identifies the diagnosis for the next step, \(d_{t+1}\), and provides a justification \(_{t+1}\). \(V\) will verify if there is any \(\) in \(}\) that supports a \(d_{n}\). If fully supported, \(d_{n}\) is identified as \(d_{t+1}\) for the \((t+1)\)-th iteration, i.e.,

\[d_{t+1},}_{t+1}=V(},\{d_{n}\}, _{}(\{d_{n}\})),\] (4)

\(V\) continues until \(d_{t+1}\) in \(^{*}\) is identified. If no observation supports a \(d_{n}\), the reasoning process will be stopped.

In our annotation, an observation \(o\) is associated with only one \(d\). However, our method employs an iterative reasoning pipeline. Initially, the perception module \(W\) generates an explanation set \(}_{0}\), linking all \(\) to \(d_{0}\). During the \(t\)-th iteration of \(V\), the explanation set is \(}_{t}\), where at least one \(\) is

Figure 4: Pipeline of our baseline. The dotted line in the right-most boxes means deductions from an observation to a diagnosis.

linked to \(d_{t}\). The final diagnosis explanation is the combination of \(}_{0},,}_{T}\) and \(d_{0},,d_{T}\), where \(T\) represents the final iteration. In this combination, if an \(\) is eventually processed in the iteration for \(}_{t}\), the corresponding \((o,z,d)\) in all preceding \(}_{0},,}_{t-1}\) will be removed. That is, \(\) will always be possessed by the \(d_{t}\) closest to the leaf PDD node.

## 5 Experiments

### Experimental Setup

We assess the reasoning capabilities of 7 recent LLMs from diverse families and model sizes, including 5 instruction-tuned models that are openly accessible: LLama3 8B and 70B , Zephyr 7B , Mistral 7B , and Mistral 8\(\)7B . We have also obtained access to private versions of the GPT-3.5 turbo  and GPT-4 turbo 6, which are high-performance closed-source models. Each LLM is utilized to implement our baseline's narrowing-down, perception, and reasoning modules. The temperature is set to 0. For computing evaluation metrics, we use LLama3 8B with few-shot prompts to make correspondences between \(\) and \(}\) as well as to verify a match between predicted and ground-truth explanations (refer to the supplementary material for more details).

### Results

**Comparison among LLMs.** Table 3 shows the performance of our baseline built on top of various LLMs. We first evaluate a variant of our task that takes graph \(=\{_{i}\}\) consisting of only procedural flow as external knowledge instead of \(\). Comparison between \(\) and \(\) demonstrates the importance of supplying premises with the model and LLMs' capability to make use of extensive external knowledge that may be supercritically different from statements in \(R\). Subsequently, some models are evaluated with our task using \(\). In addition to the metrics in Section 3.5, we also adopt the _accuracy of disease category Acc\({}^{}\)_, which gives 1 when \(=i\), as our baseline's performance depends on it.

With \(\), we can see that GPT-4 achieves the best performance in most metrics, especially related to observations and explanations, surpassing LLama3 70B by a large margin. In terms of accuracy (in both category and diagnosis levels), LLama3 70B is comparable to GPT-4. LLama3 70B also has a higher \(Obs^{}\) but low \(Obs^{}\) and \(Obs^{}\), which means that this model tends to extract many observations. Models with high diagnostic accuracy are not necessarily excel in finding essential information in long text (i.e., observations) and generating reasons (i.e., explanations).

When \(\) is given, all models show better diagnostic accuracy (in LLama3 70B) and explanations, while observations are slightly degraded (this may related to the instruction following ability due to the input length when giving \(\) as input). GPT-4 with \(\) enhances _Acc\({}^{}\)_, _Exp\({}^{}\)_, and _Exp\({}^{}\)_ scores. This suggests that premises and supporting edges are beneficial for diagnosis and explanation. Lower

    &  &  &  \\  Task & Models & \(Acc^{}\) & \(Acc^{}\) & \(Obs^{}\) & \(Obs^{}\) & \(Obs^{}\) & \(Exp^{}\) & \(Exp^{}\) \\  \)} & Zephyr 7B & 0.274 & 0.151 & 0.123\({}_{ 0.1020}\) & 0.115\({}_{ 0.166}\) & 0.092\({}_{ 0.108}\) & 0.071\({}_{ 0.19}\) & 0.014\({}_{ 0.037}\) \\  & Mistral 7B & 0.507 & 0.306 & 0.211\({}_{ 0.190}\) & 0.317\({}_{ 0.253}\) & 0.173\({}_{ 0.157}\) & 0.230\({}_{ 0.312}\) & 0.062\({}_{ 0.088}\) \\  & Mistral 8\(\)7B & 0.413 & 0.237 & 0.147\({}_{ 0.165}\) & 0.266\({}_{ 0.261}\) & 0.124\({}_{ 0.138}\) & 0.144\({}_{ 0.268}\) & 0.029\({}_{ 0.056}\) \\  & LLama3 8B & 0.569 & 0.364 & 0.248\({}_{ 0.157}\) & 0.410\({}_{ 0.128}\) & 0.211\({}_{ 0.138}\) & 0.325\({}_{ 0.375}\) & 0.087\({}_{ 0.118}\) \\  & LLama3 70B & 0.822 & 0.606 & 0.306\({}_{ 0.151}\) & **0.543\({}_{ 0.183}\)** & 0.279\({}_{ 0.146}\) & 0.409\({}_{ 0.323}\) & 0.124\({}_{ 0.120}\) \\  & GPT-3.5 turbo & 0.679 & 0.455 & 0.389\({}_{ 0.122}\) & 0.351\({}_{ 0.192}\) & 0.275\({}_{ 0.167}\) & 0.331\({}_{ 0.366}\) & 0.103\({}_{ 0.127}\) \\  & GPT-4 turbo & **0.804** & **0.610** & **0.486\({}_{ 0.207}\)** & 0.481\({}_{ 0.180}\) & **0.391\({}_{ 0.189}\)** & **0.481\({}_{ 0.362}\)** & **0.210\({}_{ 0.188}\)** \\  \)} & LLama3 8B & 0.576 & 0.344 & 0.235\({}_{ 0.162}\) & 0.394\({}_{ 0.227}\) & 0.199\({}_{ 0.142}\) & 0.327\({}_{ 0.375}\) & 0.087\({}_{ 0.114}\) \\  & LLama3 70B & 0.786 & 0.652 & 0.268\({}_{ 0.147}\) & **0.524\({}_{ 0.211}\)** & 0.258\({}_{ 0.142}\) & 0.549\({}_{ 0.372}\) & 0.152\({}_{ 0.130}\) \\   & GPT-3.5 turbo & 0.652 & 0.413 & 0.347\({}_{ 0.241}\) & 0.279\({}_{ 0.203}\) & 0.232\({}_{ 0.184}\) & 0.374\({}_{ 0.408}\) & 0.121\({}_{ 0.152}\) \\   & GPT-4 turbo & **0.808** & **0.611** & **0.470\({}_{ 0.209}\)** & 0.459\({}_{ 0.190}\) & **0.371\({}_{ 0.192}\)** & **0.645\({}_{ 0.385}\)** & **0.273\({}_{ 0.216}\)** \\   

Table 3: Evaluation of diagnostic reasoning ability using \(\) or \(\) as input.

observational performance may indicate that the models lack the ability to associate premises and text in \(R\), which are often superficially different though semantically consistent.

LLMs may undergo inherent challenges for evaluation when no external knowledge is supplied. They may have the knowledge to diagnose but cannot make consistent observations and explanations that our task expects through \(\). To explore this, we evaluate two settings: (1) giving \(D^{}\) and (2) no knowledge is supplied to a model (shown in Table 4). The prompts used for this setup are detailed in the supplementary material. We do not evaluate the accuracy of disease category prediction as it is basically the same as Table 3. We can clearly see that with \(^{}\), GPT-4's diagnostic and observational scores are comparable to those of the task with \(\), though explanatory performance is much worse. Without any external knowledge, the diagnostic accuracy is also inferior.7 The deteriorated performance can be attributed to inconsistent wording of diagnosis names, which makes evaluation tough. High observational scores imply that observations in \(R\) can be identified without relying on external knowledge. There can be some cues to spot them.

**Performance in individual domains.** Figure 5 summarizes the performance of LLama3 70B, GPT-3.5, and GPT-4 across different medical domains, evaluated using _Acc_\({}^{}\), _Obs_\({}^{}\) (Comp), and _Exp_\({}^{}\) (Faith). Neurology gives the best diagnostic accuracy, where LLama3 achieved an accuracy of 0.779. GPT-4 also performed well (0.753). In terms of _Obs_\({}^{}\) and _Exp_\({}^{}\), GPT-4's results were 0.437 and 0.280, respectively. However, GPT-4 yields a higher diagnostic accuracy score while a lower explanatory score, suggesting that the observations captured by the model or their rationalizations differ from human doctors.

**Diagnostic reasoning under conditions of incomplete observation.** In real-world scenarios, doctors often have to make diagnoses based on incomplete information. To explore this, we conducted experiments on the 73 amended cases which originally lack observation to the final diagnosis (refer to supplementary for detailed introduction of amended data point). One set of experiments used the unmodified original notes, labeled as "Original," while the other set used notes with added observations labeled as "Amended." We tested three models--Llama3 70B, GPT-3.5-turbo, and GPT-4 turbo--under two settings: one with only the procedural graph \(\) and the other with the complete knowledge graph \(\). The results are presented in Tables 5 and 6. We can observe that in both \(\) and \(\) settings, the performance on the Amended data was consistently better across all metrics compared to the Original data. This suggests that even a single added observation can significantly impact the model's diagnostic reasoning.

    & & &  &  \\  Task & Models & Acc\({}^{}\) & _Obs_\({}^{}\) & _Obs_\({}^{}\) & _Obs_\({}^{}\) & _Exp_\({}^{}\) & _Exp_\({}^{}\) \\  ^{}\)} & LLama3 8B & 0.070 & 0.154\({}_{ 0.139}\) & 0.330\({}_{ 0.244}\) & 0.135\({}_{ 0.122}\) & 0.020\({}_{ 0.100}\) & 0.004\({}_{ 0.016}\) \\  & LLama3 70B & 0.502 & 0.257\({}_{ 0.150}\) & **0.509\({}_{ 0.213}\)** & 0.237\({}_{ 0.145}\) & 0.138\({}_{ 0.209}\) & 0.034\({}_{ 0.054}\) \\  & GPT-3.5 turbo & 0.223 & 0.164\({}_{ 0.242}\) & 0.149\({}_{ 0.212}\) & 0.116\({}_{ 0.174}\) & 0.091\({}_{ 0.231}\) & 0.025\({}_{ 0.095}\) \\  & GPT-4 turbo & **0.636** & **0.461\({}_{ 0.206}\)** & 0.482\({}_{ 0.160}\) & **0.378\({}_{ 0.174}\)** & **0.186\({}_{ 0.221}\)** & **0.074\({}_{ 0.090}\)** \\   & LLama3 8B & 0.023 & 0.137\({}_{ 0.159}\) & 0.258\({}_{ 0.274}\) & 0.119\({}_{ 0.141}\) & 0.018\({}_{ 0.083}\) & 0.006\({}_{ 0.026}\) \\  & LLama3 70B & 0.037 & 0.246\({}_{ 0.148}\) & **0.504\({}_{ 0.222}\)** & 0.227\({}_{ 0.148}\) & 0.022\({}_{ 0.093}\) & 0.007\({}_{ 0.030}\) \\   & GPT-3.5 turbo & 0.059 & 0.161\({}_{ 0.238}\) & 0.148\({}_{ 0.215}\) & 0.113\({}_{ 0.171}\) & 0.036\({}_{ 0.131}\) & 0.011\({}_{ 0.039}\) \\   & GPT-4 turbo & **0.074** & **0.410\({}_{ 0.208}\)** & 0.443\({}_{ 0.191}\)** & **0.324\({}_{ 0.182}\)** & **0.047\({}_{ 0.143}\)** & **0.019\({}_{ 0.058}\)** \\   

Table 4: Evaluation of diagnostic reasoning ability without external knowledge.

Figure 5: Performance of LLama3 70B, GPT-3.5, and GPT-4 under different medical domains. We use the task with \(\).

For Cardiology and Endocrinology, the diagnostic accuracy of the models is relatively low (GPT-4 achieved 0.458 and 0.468, respectively). Nevertheless, \(Obs^{}\) and \(Exp^{}\) are relatively high. Endocrinology results in lower diagnostic accuracy and higher explanatory performance. A smaller gap may imply that in these two domains, successful predictions are associated with observations similar to those of human doctors, and the reasoning process may be analogous. Conversely, in Gastroenterology, higher \(Acc^{}\)) is accompanied by lower \(Obs^{}\) and \(Exp^{}\) (especially for LLama3), potentially indicating a significant divergence in the reasoning process from human doctors. Overall, DiReCT demonstrates that the degree of alignment between the model's diagnostic reasoning ability and that of human doctors varies across different medical domains.

**Reliability of automatic evaluation.** We randomly pick out 100 samples from DiReCT and their prediction by GPT-4 over the task with \(\) to assess the consistency of our automated metrics to evaluate the observational and explanatory performance in Section 3.3 to human judgments. Three physicians joined this experiment. For each prediction \(}\), they are asked to find a similar observation in ground truth \(}\). For explanatory metrics, they verify if each prediction \(}\) for \(}\) align with ground-truth \(z\) corresponding to \(o\). A prediction and a ground truth are deemed aligned for both assessments if at least two specialists agree. We compare LLama3's and GPT-4's judgments to explore if there is a gap between these LLMs. As summarized in Table 7, GPT-4 achieves the best results, with LLama3 8B also displaying a similar performance. From these results, we argue that our automated evaluation metrics are consistent with human judgments, and LLama3 is sufficient for this evaluation, allowing the cost-efficient option. Detailed analysis is available in the supplementary material.

**Prediction examples.** Figure 6 shows a sample generated by GPT-4. The ground-truth PDD of the input clinical note is Hemorrhagic Stroke. In this figure, purple, orange, and red indicate explanations only in the ground truth, only in prediction, and common in both, respectively; therefore, red is a successful prediction of an explanation, while purple and orange are a false negative and false positive. GPT-4 treats the observation of aurosis fugax as the criteria for diagnosing Ischemic Stroke. However, this observation only supports Suspected Stroke. Conversely, observation thalamic hematoma, which is the key indicator of Hemorrhagic Stroke, is regarded as a less important clue. Such observation-diagnosis correspondence errors lead to the model's misdiagnosis. In Figure 7, we can observe that GPT-4 can find the key observation for the diagnosis of GERD,

    & &  &  &  \\  Setting & Models & \(Acc^{}\) & \(Acc^{}\) & \(Obs^{}\) & \(Obs^{}\) & \(Obs^{}\) & \(Obs^{}\) & \(Exp^{}\) & \(Exp^{}\) \\   & LLama3 70B & 0.575 & 0.219 & 0.109\(\)0.233 & 0.443\(\)0.171 & 0.203\(\)0.186 & 0.304\(\)0.388 & 0.114\(\)0.115 \\  & GPT-3.5 turbo & 0.548 & 0.233 & 0.293\(\)0.243 & 0.218\(\)0.198 & 0.184\(\)0.166 & 0.251\(\)0.357 & 0.072\(\)0.106 \\  & GPT-4 turbo & 0.616 & 0.260 & 0.452\(\)0.241 & 0.410\(\)0.211 & 0.349\(\)0.223 & 0.467\(\)0.437 & 0.220\(\)0.266 \\   & LLama3 70B & 0.685 & 0.537 & 0.261\(\)0.195 & 0.493\(\)0.230 & 0.277\(\)0.171 & 0.452\(\)0.407 & 0.185\(\)0.194 \\  & GPT-3.5 turbo & 0.657 & 0.465 & 0.390\(\)0.227 & 0.272\(\)0.194 & 0.232\(\)0.156 & 0.401\(\)0.394 & 0.127\(\)0.145 \\   & GPT-4 turbo & 0.712 & 0.589 & 0.534\(\)0.214 & 0.452\(\)0.180 & 0.401\(\)0.201 & 0.607\(\)0.442 & 0.286\(\)0.258 \\   

Table 6: Amendment ablation study using \(\).

    & &  &  \\  Model & Mean & 95\% CI & Mean & 95\% CI \\  LLama3 8B & 0.887 & \(0.844 0.878\) & 0.835 & \(0.759 0.818\) \\ GPT-4 turbo & 0.902 & \(0.830 0.863\) & 0.876 & \(0.798 0.853\) \\   

Table 7: Consistency of automated evaluation with human judgments. Evaluated by mean and confidence interval (CI).

    & &  &  &  \\  Setting & Models & \(Acc^{}\) & \(Acc^{}\) & \(Obs^{}\) & \(Obs^{}\) & \(Obs^{}\) & \(Exp^{}\) & \(Exp^{}\) \\   & LLama3 70B & 0.547 & 0.273 & 0.225\(\)0.143 & 0.472\(\)0.144 & 0.253\(\)0.138 & 0.216\(\)0.271 & 0.073\(\)0.087 \\  & GPT-3.5 turbo & 0.507 & 0.273 & 0.393\(\)0.216 & 0.355\(\)0.174 & 0.278\(\)0.151 & 0.207\(\)0.305 & 0.062\(\)0.093 \\  & GPT-4 turbo & 0.616 & 0.328 & 0.446\(\)0.211 & 0.418\(\)0.164 & 0.340\(\)0.178 & 0.242\(\)0.324 & 0.098\(\)0.137 \\   & LLama3 70B & 0.698 & 0.534 & 0.250\(\)0.173 & 0.507\(\)0.134 & 0.240\(\)0.129 & 0.296\(\)0.354 & 0.133\(\)0.142 \\  & GPT-3.5 turbo & 0.671 & 0.411 & 0.487\(\)0.206 & 0.351\(\)0.152 & 0.310\(\)0.145 & 0.272\(\)0.321 & 0.092\(\)0.118 \\   & GPT-4 turbo & 0.726 & 0.547 & 0.546\(\)0.184 & 0.465\(\)0.148 & 0.412\(\)0.171 & 0.391\(\)0.374 & 0.180\(\)0.186 \\   

Table 5: Amendment ablation study using \(\).

which is consistent with human in both observation and rationale. However, it still lacks the ability to identify all observations. More samples are available in the supplementary material.

## 6 Conclusion and Limitations

We proposed DiReCT as the first benchmark for evaluating the diagnostic reasoning ability of LLMs with interpretability by supplying external knowledge as a graph. Our evaluations reveal a notable disparity between current leading-edge LLMs and human experts, underscoring the urgent need for AI models that can perform reliable and interpretable reasoning in clinical environments. DiReCT can be easily extended to more challenging settings by removing the knowledge graph from the input, facilitating evaluations of future LLMs.

**Limitations.** DiReCT encompasses only a subset of disease categories and considers only one PDD, omitting the inter-diagnostic relationships due to their complexity--a significant challenge even for human doctors. Additionally, our baseline may not use optimal prompts or address issues related to hallucinations in task responses. Our dataset is solely intended for model evaluation but not for use in clinical environments. The use of the diagnostic knowledge graph is also limited to serving merely as a part of the input and once a knowledge graph is provided, the focus shifts to whether the LLM follows the graph's rules well (refer to supplementary). Future work will focus on constructing a more comprehensive disease dataset and developing an extensive diagnostic knowledge graph.