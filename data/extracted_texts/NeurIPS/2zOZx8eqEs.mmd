# Graph Agnostic Causal Bayesian Optimization

Sumantrak Mukherjee\({}^{1}\) Mengyan Zhang\({}^{2}\) Seth Flaxman\({}^{2}\) Sebastian Vollmer\({}^{1,3}\)

\({}^{1}\)Department of Data Science and its Applications, DFKI GmbH

\({}^{2}\)Department of Computer Science, University of Oxford

\({}^{3}\)Department of Computer Science, University of Kaiserslautern-Landau

Equal Contribution

###### Abstract

We study the problem of globally optimising a target variable of an _unknown_ causal graph on which a sequence of soft or hard interventions can be performed. The problem of optimising the target variable associated with a causal graph is formalised as Causal Bayesian Optimisation (CBO). We study the CBO problem under the _cumulative regret_ objective with unknown causal graphs for two settings, namely structural causal models with hard interventions and function networks with soft interventions. We propose Graph Agnostic Causal Bayesian Optimisation (GACBO), an algorithm that actively discovers the causal structure that contributes to achieving optimal rewards. GACBO seeks to balance exploiting the actions that give the best rewards against exploring the causal structures and functions. To the best of our knowledge, our work is the first to study causal Bayesian optimization with cumulative regret objectives in scenarios where the graph is unknown or partially known. We show our proposed algorithm outperforms baselines in simulated experiments and real-world applications.

## 1 Introduction

Bayesian Optimization (BO) is a robust technique for optimizing black-box functions, widely used in fields like drug discovery, robotics, and automated machine learning (Mockus, 1975; Garnett, 2023). Traditional BO methods (Srinivas et al., 2009; Garnett, 2023) often treat functions as black boxes, but real-world data usually exhibits structural patterns. Causal Bayesian Optimization (CBO) methods (Aglietti et al., 2020; Sussex et al., 2022) leverage these structures to improve sample efficiency. However, in many cases, causal graphs are either unknown or incorrectly specified. We address this by proposing a _Graph Agnostic Causal Bayesian Optimization_ (GACBO) method that works with unknown or partially known causal graphs. Unlike previous methods (Branchini et al., 2023; Alabed and Yoneki, 2022; Toth et al., 2022), which focus on hard interventions and simple regret, have a limited prior on graphs or target causal reasoning but not BO, GACBO handles

Figure 1: Graph Agnostic Causal Bayesian Optimisation (gacbo) workflow. _Top_: Select plausible graphs based on data collected so far, _Right_: Perform Causal Bayesian Optimisation on plausible graphs, _Bottom_: Select the action based on the highest reward among all plausible graphs, _Left_: Execute selected action, collect Data and repeat steps.

both soft and hard interventions and aims to maximize cumulative rewards while learning the causal structure as needed. Our approach balances exploitation (selecting actions with the highest potential outcomes) and exploration (uncertainty in function space or causal structure learning). Figure 1 illustrates our proposed method. We begin with a uniform prior over all possible acyclic graph structures, modeling surrogate functions for each target node's ancestors using Gaussian processes, with inputs being the node's parents and influencing actions. The Bayesian Score (Friedman and Nachman, 2013) models the probability of these graphs. At each iteration, we retain functions and graphs within high-probability confidence intervals, selecting interventions with a ucb-based acquisition function using the reparametrization trick (Sussex et al., 2022). Our **contributions** are as follows: **1)** We are the first to study causal Bayesian optimization with a cumulative objective in scenarios where the graph is unknown or partially known. **2)** We propose a novel algorithm, Graph Agnostic Causal Bayesian Optimization (gacbo), that handles both soft and hard interventions and includes all possible graphs in the prior, effectively sharing information across different experiments through a model-based approach. **3)** We introduce an _Upper Confidence Bound_-based acquisition function that integrates causal discovery as a subtask, engaging in it only when distinguishing between graphs improves outcomes, thereby balancing exploitation and exploration. **4)** We demonstrate on synthetic and real-world causal graphs that our algorithm performs competitively compared to existing baselines.

## 2 Problem Setup

Structural Causal ModelsAn scm(Pearl, 2009) is defined as a tuple \( g,Y,,_{g},\), where \(g\) is a Directed Acyclic Graph (dag) describing the relations between observed random variables \(=\{V_{i}\}_{i=0}^{m-1}\), with each node \(i[m]\) belonging to a compact space \(_{i}\). Here, \(Y=V_{m}\) is the reward variable, and \(_{g}=\{f_{i}^{g}\}_{i=0}^{m}\) represents the unknown functions associated with \(g\), with independent noise terms \(=\{_{i}\}_{i=0}^{m}\) having zero mean and a known distribution. The parent nodes of any node \(i\) in \(g\) are denoted by \(pa_{g}(i)[m]\), and \(_{i}^{g}=\{V_{j}\}_{j pa_{g}(i)}\) represents the parents of node \(i\) in \(g\). Each node \(V_{i}\) is generated by the function \(f_{i}^{g}:_{i,g}_{i}\), with the observed value \(v_{i}\) given by \(v_{i}=f_{i}^{g}(_{i}^{g})+_{i}\). These functions are evaluated in topological order from the root to the leaf nodes according to \(g\). In this setting, not all observable variables are intervenable (Lee and Bareinboim, 2019). Let \(\{0,,m-1\}\) denote the indices of intervenable variables. The set of observed variables \(\) is decomposed into intervenable variables \(=\{V_{j}\}_{j}\) and non-intervenable variables \(=\{V_{j}\}_{j}\), with the target variable \(Y=V_{m}\) assumed to be non-intervenable.

InterventionsWe use a _soft intervention_ model for noisy function networks (NFNs) (Eberhardt and Scheines, 2007), where controllable action variables \(=\{a_{j}\}_{j=0}^{n}\) are added as nodes in \(g\) and act as parents to nodes \(V_{i}\), making them inputs to \(f_{i}^{g}\). The subset \(_{i}^{g}\) affects \(V_{i}\) based on \(g\), with the action space \(_{i}^{g}^{|_{i}^{g}|}\) and total action space \(\). Since \(f_{i}^{g}:_{i}^{g}_{i}^{g}_ {i}\) is unknown, the agent cannot predict the effect of \(_{i}^{g}\) on \(V_{i}\) in advance. Observations are modelled as a special case i.e., \(\{a_{j}=0\ \ a_{j}_{i}^{g}\}\)

_Hard interventions_ are modelled as a subset of intervenable variables \(()\) being set to values \(_{}=\{a_{i}\}_{i}\) independent of their parents using the do operator s.t. \(\{do(x_{i}=a_{i})\  i,\,a_{i}_{i}\}\) and values are evaluated for all nodes \(i[m]\), based on the topological ordering of \(g\)

\[v_{i}=f_{i}^{g}(_{i}^{g})+_{i}&i\\ a_{i}&i\] (1)

Problem Statement and Performance MetricWe address the problem of an agent interacting with an SCM or NFN defined by \( g^{*},Y,,_{g^{*}},\), where the graph \(g^{*}\) and functions \(_{g^{*}}\) are unknown but fixed. At each round \(t\), the agent selects soft intervention actions \(_{,t}=\{_{i,t}^{g}\}_{i=0}^{m}\), and for hard interventions, it chooses the nodes \(_{t}\) and the corresponding intervention values \(_{_{t}}\). The agent then collects data \(_{t}\), with the subscript \(t\) indicating the time step of the intervention and data collection. The objective is to design a sequence of actions \(\{_{,t}\}_{t=0}^{T}\) or \(\{_{t},_{_{t}}\}_{t=0}^{T}\) that maximizes the average expected reward for soft and hard interventions, respectively, which is equivalent to minimizing the expected cumulative regret (Sussex et al., 2022; Lattimore and Szepesvari, 2020):

\[R_{T}=_{t=1}^{T}[[y|^{*}]-[y|_{,t} ]]; R_{T}=_{t=1}^{T}[[y|^{*}]-[y| {d}(_{_{t}}=_{_{t}})]].\] (2)

[MISSING_PAGE_FAIL:3]

It is important to note that 6 is not suitable for standard optimization methods because it requires maximization over a set of functions with a bounded RKHS norm.

Therefore for a graph \(g\) within the plausible models, the reparametrisation trick introduced in Curi et al. (2020) and utilised for CBO in Sussex et al. (2022) can be used to write any function \(_{i}^{g}}_{g}_{t}^{g}\) using \(_{i,g}:_{i}^{g}_{i}^{g}[-1,1]\), as

\[_{i,t}^{g}(}_{i}^{g},}_{i}^{g})=_{i,t-1}^{ g}(}_{i}^{g},}_{i}^{g})+_{t}_{i,t-1}^{g}( }_{i}^{g},}_{i}^{g})_{i,g}(}_{i}^{g },}_{i}^{g}),\] (7)

The acquisition function can therefore be expressed in terms of \(}:^{g}^{g}[-1,1]^{|V(g)|}\), where \(|V(g)|\) is the number of nodes in the graph \(g\),

\[_{}_{g G_{t}}_{_{g}()} [y|}_{g},].\] (8)

More details about the optimistic reparameterisation trick can be found in A.5. The data collected is used to update model posteriors and construct plausible models for next time step.

## 4 Results

We evaluate gacbo on synthetic environments (Dropwave, Alpine3, Rosenbrock, ToyGraph) and a real-world Epidemiology Graph from (Astudillo and Frazier, 2021; Branchini et al., 2023). The metric used is the average reward, inversely related to cumulative regret. We repeat each experiment 5 times with different seeds and report average rewards \(/\), where \(\) is the standard deviation. We compare gacbo with: 1) mcbo(Sussex et al., 2022) using the true causal graph, 2) mcbo with incorrect graphs (missing or extra edges), 3) gp-ucb(Srinivas et al., 2009) for soft interventions.

SimulationsFigure 2 shows our results. For soft interventions, we use Dropwave, Alpine3, and Rosenbrock. For hard interventions, we use ToyGraph (Aglietti et al., 2020). mcbo with the true graph generally performs best, except in Rosenbrock, where gp-ucb excels due to the function's additive structure. mcbo struggles with incorrect graphs, particularly when extra edges increase dimensionality or missing edges misrepresent the function space. gacbo, initially hampered by lack of graph information, quickly learns the correct structure and matches mcbo's performance after about 100 rounds. Further information regarding performance in specific environments can be found in A.9.

Real-World Application: EpidemiologyWe test gacbo in an Epidemiology setting (Havercroft and Didelez, 2012; Branchini et al., 2023), aiming to minimize HIV viral load by choosing from interventions \(=\{,\{T\},\{R\},\{T,R\}\}\). Despite the environment's complexity, gacbo quickly learns the correct causal structure and matches mcbo's performance with the true graph within 100 rounds, significantly outperforming mcbo with incorrect graphs.

Figure 3: Epidemiology application. Top left: true causal graph. Bottom left: incorrect causal structure for mcbo. Right: performance comparison.

Figure 2: Simulation results comparing gacbo with mcbo (true and incorrect graphs) and gp-ucb. gp-ucb is not applicable to ToyGraph due to hard interventions.