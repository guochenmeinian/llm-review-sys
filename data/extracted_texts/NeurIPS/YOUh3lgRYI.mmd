# Synergistic Dual Spatial-aware Generation

of Image-to-Text and Text-to-Image

 Yu Zhao\({}^{1}\), Hao Fei\({}^{2}\), Xiangtai Li\({}^{3}\), Libo Qin\({}^{4}\), Jiayi Ji\({}^{2}\),

**Hongyuan Zhu\({}^{5}\), Meishan Zhang\({}^{6}\), Min Zhang\({}^{6}\), Jianguo Wei\({}^{1}\)**

\({}^{1}\) Tianjin University \({}^{2}\) National University of Singapore \({}^{3}\) Bytedance \({}^{4}\) Central South University

\({}^{5}\) I\({}^{2}\)R & CFAR, A*STAR\({}^{6}\) Harbin Institute of Technology (Shenzhen)

zhaoyucs@tju.edu.cn, haofei37@nus.edu.sg

Corresponding Author: Hao FeiInstitute for Infocomm Research (I\({}^{2}\)R) & Centre for Frontier AI Research (CFAR), A*STAR

###### Abstract

In the visual spatial understanding (VSU) area, spatial image-to-text (SI2T) and spatial text-to-image (ST2I) are two fundamental tasks that appear in dual form. Existing methods for standalone SI2T or ST2I perform imperfectly in spatial understanding, due to the difficulty of 3D-wise spatial feature modeling. In this work, we consider modeling the SI2T and ST2I together under a dual learning framework. During the dual framework, we then propose to represent the 3D spatial scene features with a novel 3D scene graph (3DSG) representation that can be shared and beneficial to both tasks. Further, inspired by the intuition that the easier 3D\(\)image and 3D\(\)text processes also exist symmetrically in the ST2I and SI2T, respectively, we propose the Spatial Dual Discrete Diffusion (SD\({}^{3}\)) framework, which utilizes the intermediate features of the 3D\(\)X processes to guide the hard X\(\)3D processes, such that the overall ST2I and SI2T will benefit each other. On the visual spatial understanding dataset VSD, our system outperforms the mainstream T2I and I2T methods significantly. Further in-depth analysis reveals how our dual learning strategy advances.

## 1 Introduction

Within the research topic of Visual Spatial Understanding (VSU) , Spatial Image-to-Text (SI2T)  and Spatial Text-to-Image (ST2I)  are two representative task forms across vision and language. SI2T aims to understand the spatial relationships of objects in the given image, while ST2I focuses on synthesizing a spatial-faithful image based on the input text prompts. Existing efforts mostly formalize SI2T and ST2I tasks as the normal I2T and T2I problems, applying general-purpose I2T and T2I models for task solutions . Technically, researchers widely employ the vision-language generative architecture  for I2T tasks, i.e., generally, there is a visual encoder and a text decoder. For the T2I task, recent diffusion-based methods have shown the extraordinary capability of image generation and achieved state-of-the-art (SoTA) performance on a mount of benchmarks .

Unfortunately, these strong-performing I2T and T2I methods, without the deliberate spatial semantics modeling in VSU tasks, largely fall short in precisely extracting spatial features from visual or textual inputs. For instance, in the SI2T process, the spatial relationships are often incorrectly recognized due to layout overlap and perspective illusion . This is due to the inherent characteristics of 2D images, which, lacking 3D feature modeling, inevitably fail to understand spatial relations. On the other hand, in ST2I, synthetic images frequently fail to match strictly the spatial constraints specifiedin the prompts, such as the position, pose, and perspective . This is because language's abstract nature allows only for a general description of the content rather than detailed depictions of spatial scenes. Moreover, unlike general image generation, ST2I should place greater emphasis on 3D spatial modeling, while the input sequential language tokens intrinsically do not portray the kind of specific spatial scene.

Let us revisit the human process in solving SI2T and ST2I tasks. We typically process the input image or text within our minds by constructing a 3D spatial scene, which serves as the center for further spatial textual descriptions or image generation. Specifically for SI2T, we intuitively project a 2D image into a reasonable 3D scene based on common sense before describing that scene in words. In contrast, for ST2I tasks, we start by imaginatively converting the text of user instruction into a 3D conceptual scene which is then rendered into a 2D image. Interestingly, we can actually find that SI2T and ST2I are dual processes, with each task's input and output being the reverse of the other, as illustrated in Figure 1(a). More importantly, there are two important observations in these dual tasks. **First, [intermediate processing sharing]**, they can complement and benefit each other. For SI2T, the 'Image\(\)3D' reasoning process is challenging in acquiring necessary 3D features, whereas the descriptive '3D\(\)Text' process is relatively easier. Conversely, for ST2I, the 'Text\(\)3D' process requires complex reasoning of the 3D features derived feature, while rendering '3D\(\)Image' is much more straightforward. Ideally, if complementing the information during each learning process, i.e., letting the easy part aid the hard part, it should enhance the performance of both tasks. **Second, [3D scene feature sharing]**, both dual tasks urgently require modeling of the respective 3D features, where such stereospecific insights in 3D perspective can be essentially shared and also complementary between each other. Intuitively, vision offers very concrete clues describing spatial scenes, e.g., objects and attributes, while the 3D features derived from texts are more likely to define the semantics-oriented relations or constraints, which are often abstract and rough.

Inspired by such intuition, in this paper, we introduce a novel synergistic dual framework for SI2T and ST2I. To start with, we propose a spatial-aware 3D scene graph (namely **3DSG**), where the spatial objects, their relations and the layouts within the 3D scene are formulated with a semantically structured representation. The 3DSG representation effectively depicts the stereospecific attributes of all objects, and meanwhile models the spatial relations between them, from which both the SI2T and ST2I processes can be beneficial. Technically, 3DSG is obtained from a shared graph diffusion model for both SI2T and ST2I processes, as shown in Figure 1(b). Trained with our '2DSG-3DSG' pair data, the graph diffusion is learned to propagate and evolve the initial 2D visual SG (parsed from input image at SI2T side) or the textual SG (parsed from input text at ST2I side) into the final 3DSG, i.e., by adding all necessary and reasonable spatial details.

With _3DSG_, we next implement the whole dual framework of SI2T and ST2I generation. Instead of directly employing the SoTA generative 12T models or diffusion-based T2I methods, we consider a solution fully based on discrete diffusions , due to several key rationales. Primarily, for VSU, the most crucial spatial information that determines a scene consists of objects and their relationships, which presents the characteristic of discretization and combination in the spatial layout, while other background and spatial unrelated information would be noisy. Thus, the discrete representation is more appropriate to model pure spatial semantics in our scenario. Besides, in our scenario both the textual token and SG representations possess discrete characteristics , which can be perfectly modeled by discrete diffusion. Moreover, the discrete diffusion works on the limited index space

Figure 1: Demonstration of SI2T and ST2I tasks.

[28; 54; 35; 99], which is much more computationally efficient, especially for visual synthesis tasks. As illustrated in Figure 2, our **S**patial **D**ual **D**iscrete **D**iffusion (dubbed as **SD3**) system consists of three components: 1) _3DSG_ generation, 2) SI2T generation and 3) ST2I generation. During dual learning, both SI2T and ST2I first induce the _3DSG_ representations from the input image or text respectively via one shared graph diffusion, where the modality-variant features are simultaneously preserved in _3DSG_ for unbiased and holistic modeling of 3D spatial scene. Then, the image synthesis (for ST2I) and text generation (SI2T) are carried out via two separate discrete diffusion models, during which the _3DSG_ feature is integrated for better generation. At the meanwhile, the intermediate features of the '3D\(\)X' (X means text or image) diffusion steps are also passed to the counterpart hard 'X\(\)3D' processes for further facilitation.

We conduct experiments on the VSD dataset , which is a VSU benchmark with paired images and texts of spatial descriptions that allow for both SI2T and ST2I. Extensive results demonstrate that our proposed system significantly outperforms all baselines on both ST2I and SI2T, including the vision-language model based and diffusion-based methods. Further analysis reveals that the dual framework helps align the asymmetric spatial semantics across image and text modalities. To our knowledge, this is the first attempt to resolve the SI2T and ST2I tasks with a novel dual perspective, and further successfully investigate synergistic learning in between by sufficiently modeling the spatial 3D scene representations.

## 2 Related Work

**Visual Spatial Understanding.** VSU is an important topic within the research of multimodal learning [51; 17; 19; 21]. VSU aims to extract spatial information from a given scene, developed within the forms of reasoning , relation extraction , role labeling , question answering [44; 61; 52], image-to-text generation [95; 97], image synthesis , 3D reconstruction [74; 69], etc. With the VSU capability, many downstream applications can achieve, such as robotics [24; 53], navigation [33; 80; 6], and language grounding . Among various VSU tasks, the SI2T and ST2I generation attract significant attention due to their fundamental positions in vision-language cross-modal tasks. Current efforts mostly study ST2I or SI2T separately. For the text-to-image generation, the diffusion models have emerged as the SoTA approaches . For image-to-text generation, i.e., image captioning, it has been a long-standing task and has achieved great progress. Recent advances can be largely attributed to vision-language pre-training (VLP) [79; 10]. Besides conventional VLP methods,  are the first to use diffusion models for image captioning (and more specifically, for text generation). In this work, we consider the two tasks together under a dual learning framework, via which we aim to achieve mutual benefits of the spatial feature modeling from each other.

**Discrete Diffusion Models.** The diffusion model is first proposed by , and has achieved impressive performance for text-to-image generation [63; 12; 71; 65; 86]. Original diffusion models are parameterized Markov chains trained to translate simple distributions to more sophisticated target distributions in a finite set of steps on the continuous data or its latent representations. In this work we adopt the SoTA diffusion-based model as our T2I backbone. Recently, diffusion models on discrete space are introduced to markedly reduce the computing cost [28; 3; 34; 35]. Discrete diffusion methods are also used in text generation  and structure generation  due to its natural adaptability for the data with discrete nature. This work follows the line and takes the SoTA discrete diffusion model as the backbone for image, text and scene graph generation.

**Scene Graph Representations.** This work is also closely related to scene graph (SG)-based representation learning. Scene graphs have advanced in depicting the intrinsic semantic structures of scenes in images or texts [43; 81; 93]. In SGs, key object and attribute nodes are connected via pairwise relations to describe semantic contexts, which have been shown to be useful as auxiliary features that carry rich contextual and semantic information for a wide range of downstream applications, such as image retrieval , image generation [40; 86], translation , image captioning [90; 83] and video modeling [96; 18]. However, research on utilizing 3D scene graph representations to enhance various downstream tasks can be currently very scarce. In this paper, we incorporate both visual and language scene graphs within a 3D scope to enhance cross-modal alignment learning for better spatial semantics understanding.

**Dual Learning.** The dual learning method is proposed to enhance the coupled tasks that have the same exact input and output but in reverse [88; 91]. With dual bidirectional learning, the model could capture potential mutual information from the primary and dual tasks, improving their performance.

Recently, the idea of dual learning has been applied to various tasks, such as intertranslation , speech recognition with text-to-speech , question answering with question generation [76; 75], and image classification with image generation . The key point of dual learning is to model the paired and complementary features between the coupled tasks, and then the learning process can reinforce them mutually. In this work, we first connect the dual SI2T and ST2I tasks with their shared 3D spatial feature and use dual learning to enhance 3D feature construction. To our knowledge, we are the first to achieve synergy between two spatial-aware cross-modal dual generations.

## 3 Preliminaries

### Task Formulation

We process the dual visual spatial understanding tasks, ST2I and SI2T. Given a textual prompt \(Y\), ST2I aims to generate an image \(\) that semantically matches the spatial constraints with \(Y\). Its dual task is SI2T, which is also known as the visual spatial description (VSD), aiming to generate a piece of textual description \(\) based on an input image \(I\). In this paper, we process the two tasks parallelly.

### Discrete Diffusion

Diffusion models  are generative models characterized by a forward and reverse Markov process. In the forward process, the given data \(_{0}\) with distribution \(q(_{0})\) is corrupted into a Gaussian distribution variable \(_{T}\) in \(T\) steps, formulated as \(q(_{1:T}|_{0})=_{t=1}^{T}q(_{t}|_{t-1})\). In the reverse process, the model learns to recover the original data \(_{0}\) from \(_{T}\), denoted as \(p_{}(_{0:T})=p(_{T})_{t=1}^{T}p_{}(_{t-1}| _{t})\). In order to optimize the generative model \(p_{}(_{0})\) to fit the data distribution \(q(_{0})\), one typically optimizes a variational upper bound on the negative log-likelihood:

\[_{vlb}=_{q(_{0})}D_{KL}[q(_{T}| _{0})||p(_{T})]+_{t=1}^{T}_{q(_{t}|_{0})}[D_{KL}[q(_{t-1}|_{t},_{0})||p_{}(_{t-1 }|_{t})]].\] (1)

Vanilla diffusion models are defined on continuous space. Recently, the discrete diffusion model has been introduced where a transition probability matrix \(Q_{t}\) is defined to indicate how \(_{0}\) transits to \(_{t}\) for each step of the forward process, where \(_{t}^{N}\) is defined in discrete space. The matrices \([Q_{t}]_{ij}=q(_{t}=i|_{t-1}=j)\) defines the probabilities that \(_{t-1}\) transits to \(_{t}\). Then the forward and reverse process could be rewritten as \(q(_{t}|_{t-1})=^{}(_{t})Q_{t}(_{t-1})\) and \(q(_{t-1}|_{t},_{0})=q(_{t}|_{t-1},_{0})q( _{t-1}|_{0})/q(_{t}|_{0})\), where \(()\) means the one-hot representation of \(\). Appendix A.1 gives more technical details about the discrete diffusion models.

### Scene Graph Representation

The scene graph presents a scene via the objects with their attributes and relationships in the form of a graph, which can be constructed from either text (TSG)  or image (VSG) [92; 46; 45]. We represent a scene graph as \(G=\{V,E\}\), where \(V\) is the node set, and \(E\) is the edge set. There are three types of nodes in the scene graph: object nodes, attribute nodes, and relationship nodes. Each type of node has to own unique tag vocabulary.

For SI2T and ST2I, we focus on spatial information extraction, especially the object relationships in the 3D space. However, due to the limited information presented by text or image, a 2D TSG or VSG hardly fully models these 3D spatial semantics. Here, we introduce the spatial-aware 3D scene graph (3DSG) , which thoroughly depicts 3D scenes. The 3DSG is formally equivalent to the 2D scene graph, i.e. the object, attribute, and relationship, but organized

}  
**2D TSG** \\ 
**Objects:** Only key objects \\
**Attributes:** Any attributes \\
**Relationships:** Semantic relationships between objects \\ 
**2D VSG** \\ 
**Objects:** The front objects in one perspective \\
**Attributes:** Visual related attributes \\
**Relationships:** Simple 2D spatial relationships \\ 
**3DSG** \\ 
**Objects:** All the objects in the 3D scene; High-level spatial concepts. \\
**Attributes:** Any attributes including 3D attributes such as pose and texture. \\
**Relationships:** 3D spatial relationships and subordinate relationships between spatial concepts. \\   

Table 1: Comparison of 3DSG and 2DSG.

hierarchically, which contains more abundant elements such as nodes for high-level spatial concepts, texture attributes, and spatial relationships in the 3D perception. Table 1 presents the differences between 2DSG and our 3DSG. Conventionally, the 3DSG should be constructed directly from a 3D scene, i.e., sensor data , point clouds , 3D mesh , and RGB-D sequences [87; 26]. In this work, we uniform the VSG/TSG/3DSG representations, modeling the object nodes \(v_{obj}\), attribute nodes \(_{attr}\), and relationship nodes \(_{rel}\) by the embedding of their textual tags \(_{obj},_{attr},_{rel}^{d}\), where \(d\) is the dimension of the tag embedding.

## 4 Methodology

### Spatial Dual Discrete Diffusion Framework

In Figure 2, we illustrate the overall framework of the proposed Spatial Dual Discrete Diffusion (SD\({}^{3}\)), consisting of three separate discrete context diffusion models, i.e., the 3DSG diffusion model for the **X\(\)3D** process, the ST2I diffusion model for the **3D\(\)Image** process, and the SI2T diffusion model for the **3D\(\)Text** process.

**X\(\)3D: 3DSG Diffusion Model.** We set a graph diffusion model to convert the initial TSG (for ST2I) and VSG (for SI2T) to the 3DSG. We first acquire the initial VSG and TSG from the input image and textual description through the off-the-shelf VSG  and TSG  parsers. Then the initial VSG and TSG nodes (represented as \(\{_{obj},_{attr},_{rel}\}\)) are encoded to the latent quantized representations by a discrete graph auto-encoder (DGAE) , on which the discrete diffusion process on discrete graph representations is conducted to generate the 3DSG. Concretely, we denote the quantized gold 3DSG as \(_{0}^{G}\). Then, following conventional discrete diffusion, we can calculate \(p_{}^{Graph}(_{t-1}^{G}|_{t}^{G})\). Moreover, on our final dual training, the 3DSG diffusion model leverages the intermediate feature of the following **3D\(\)X** process to aid the **TSG\(\)3DSG** and **VSG\(\)3DSG** generation process. For **TSG\(\)3DSG**, the model takes global text features and the intermediate feature of the dual SI2T diffusion, i.e., \(p_{}^{Graph}(_{t-1}^{G}|_{t}^{G},^{Y})\), \(p_{}^{Graph}(_{t-1}^{G}|_{t}^{G},_{t}^{Y})\), and for **VSG\(\)3DSG** it will be \(p_{}^{Graph}(_{t-1}^{G}|_{t}^{G},^{I})\), \(p_{}^{Graph}(_{t-1}^{G}|_{t}^{G},_{t}^{I})\), where the \(_{t}^{Y}\) and \(_{t}^{I}\) are the \(t\) step representations of SI2T and ST2I diffusion respectively. Then we align them by:

\[_{X-T23D} =D_{KL}(p_{}^{Graph}(_{t-1}^{G}|_{t}^{G},^{ Y})||p_{}^{Graph}(_{t-1}^{G}|_{t}^{G},_{t}^{Y})),\] (2) \[_{X-I23D} =D_{KL}(p_{}^{Graph}(_{t-1}^{G}|_{t}^{G},^{ I})||p_{}^{Graph}(_{t-1}^{G}|_{t}^{G},_{t}^{I})).\] (3)

To enable the training for this 2DSG\(\)3DSG process, we should construct the paired '2DSG-3DSG' data. We follow previous work [72; 78; 27] to construct a gold 3DSG dataset. After that, we adopt a strong captioning model to generate text descriptions from view images. With all the inputs and

Figure 2: Overall Framework of the S\({}^{3}\)D. The figure presents the dual processes of ST2I and SI2T. The RED block represents the hard X\(\)3D processes, and the GREEN block represents the 3D\(\)X processes. There are three diffusion processes in total, i.e., a shared graph diffusion model for VSG/TSG\(\)3DSG generation, and the image diffusion model and text diffusion model.

outputs ready, we can train the graph diffusion model on aligned 3DSG-Image-Text data, after which the model will acquire the 3D estimation capability.

**3D\(\)Image: ST2I Diffusion Model.** The ST2I diffusion model is used to generate image \(\) with the condition of input textual prompts \(Y\). In this task, we adopt a vector quantized variational autoencoder (VQ-VAE)  as the quantized model to encode image data to embedding vectors. We denote the quantized image as \(_{0}^{I}\) and we could also calculate \(q(_{t}^{I}|_{t-1}^{I})\) and \(q(_{t-1}^{I}|_{t}^{I},_{0}^{J})\). On the other hand, the ST2I diffusion model takes two conditions, i.e., the global text feature \(^{Y}\) extracted via a CLIP model , and the shared 3DSG feature \(^{G}\). Then \(^{Y}\) and \(^{G}\) are fused and fed to the diffusion model to calculate \(p_{}^{ST2I}(_{t-1}^{I}|_{t}^{I},^{T}^{G})\). At last, the decoder from VQ-VAE is used to generate images from latent codes.

**3D\(\)Text: SI2T Diffusion Model.** In the SI2T model, the inputs and outputs are reversed. The diffusion is applied on the text representation \(_{0}^{V}\) with a similar process as ST2I. The latent text representation is the word embedding, which is functionally equivalent to the visual codebook. We use another denoising network \(p_{}^{SI2T}(_{t-1}^{Y}|_{t}^{I},^{I}^{G})\), while the input condition becomes the visual tokens \(^{I}\) and also the 3DSG feature \(^{G}\). Afterward, the language model decoder generates textual results based on the latent representations.

**Image and Text Decoding.** Finally, through three diffusion models, we acquire the predicted latent representations of image, text, and 3DSG, denoted as \(}_{0}^{I}\), \(}_{0}^{Y}\), \(}_{0}^{G}\). For ST2I, we fuse the generated graph vectors \(}_{0}^{G}\) to visual vectors \(}_{0}^{I}\) by adopting an attention mechanism:

\[Attn_{i,m}=(}_{0}^{G}[m]}_{0}^ {I}[i]),}_{0}^{I+}[i]=}_{0}^{I}[i])_{m} Attn_{i,m}}_{0}^{G}[m],\] (4)

where \(\) means the concatenation operation. Afterwards, the image decoder \(G_{V}\) is used to reconstruct image from the scene graph enhanced codes \(}^{I+}\):

\[=G_{V}(}^{I+}).\] (5)

For SI2T, we append the flatten \(}_{0}^{G}\) after generated textual codes \(}_{0}^{Y}\) and use a language model decoder \(G_{T}\) to generate the description:

\[=G_{T}([}_{0}^{Y};}_{0}^{G}]).\] (6)

### Mutual Spatial Synergistic Dual Learning

To exploit the complementarity of the dual processes, we elaborate a dual training strategy for our framework. To conduct the strategy effectively, we introduce the essential training objectives.

**Dual Learning Objective.** Our dual learning framework contains two tasks, i.e. ST2I and SI2T, where their inputs and outputs are just reversed. We denote ST2I as \(f_{}:i y,i I,y Y\) and SI2T as \(f_{}:y i,i I,y Y\). Their learning objectives should be:

\[_{ST2I}=_{i,y} p_{}(y|i),_{ST2I }=_{i,y} p_{}(y|i).\] (7)

Based on the dual supervising learning , given the duality of the two tasks, if the learned ST2I and SI2T models are perfect, we should have the probabilistic duality:

\[p(i)p_{}(y|i)=p(y)p_{}(i|y)=p(i,y), i,y,\] (8)

where \(p(i)\) and \(p(y)\) are the marginal distributions. Then we add this constraint to the dual learning target as an equivalent regularization term:

\[_{dual}=_{ST2I}+_{SI2T}+||(i)+  p_{}(y|i)-(y)- p_{}(i|y)||,\] (9)

where \((i)\) and \((y)\) are the estimated marginal distribution by a pre-trained vision-language model, which is illustrated detailly in Appendix SSA.4.

**Loss for Mutual 3D Feature Learning.** The 3DSG diffusion model is used to estimating 3D scene information from TSG or VSG, denoted as \(f_{}:i g\) and \(f_{}:y g\), where \(i I,y Y,g G\). Based SS4.1 and Eq. 1, the graph diffusion loss can be acquired, denoted as \(_{I23D}\) and \(_{T23D}\)

\[_{I23D}=_{i,y} p_{}(g|i),_{T23D} =_{i,y} p_{}(g|y),\] (10)where \(z^{I}\) and \(z^{Y}\) are the intermediate features of image diffusion and text diffusion. Along with the X\(\)3D alignment loss \(_{X-T23D}\) and \(_{X-I23D}\), the final mutual 3D Feature learning target is:

\[_{mutual}=_{I23D}+_{X-I23D}+_{T23D }+_{X-T23D}.\] (11)

**Loss for Spatial Feature Alignment.** The paired latent visual and textual representations are initialized in different feature spaces. We thus conduct a spatial feature alignment to bridge them by the shared spatial representation of the 3DSG. Concretely, we consider the image decoder, text decoder and graph encoder. Given the paired image \(I\), text \(Y\) and the corresponding 3DSG \(G_{host}\), we can easily get their quantified representations \(z_{0}^{I}\), \(z_{0}^{Y}\), \(z_{0}^{G}\), and then the fused feature \(z_{0}^{I+}\) and \([z_{0}^{Y};z_{0}^{G}]\) based on the Eq. 5 and Eq. 6. After that, we adopt the reconstruct loss of VQ-VAE \(_{v-dec}\), and the next token prediction loss \(_{t-dec}\) of text decoder for optimization:

\[_{v-dec}=||I-G_{V}(z_{0}^{I+})||^{2},_{t-dec}=- _{i=1}^{|y|} p(y_{i}|y_{<i},[z_{0}^{Y};z_{0}^{G}]).\] (12)

**Loss for 3DSG Reconstruction.** To initialize the graph encoder and decoder, i.e., the DGAE, we follow  to calculate the graph reconstruction loss:

\[_{DGAE}=-_{}G}(p(G_{host}|}^{G})),\] (13)

where \(}^{G}\) is the latent representations of the predicted 3DSG and the \(G_{host}\) is the gold 3DSG.

**Training Remarks.** To achieve a perfect convergency, we use a four-step strategy for the overall training process, shown in Figure 3. **Step-1 DGAE pre-training.** First, we pre-train the DGAE model with the 3DSG reconstruction target \(_{DGAE}\) to initialize the DGAE and the graph codebook, with the self-supervised training on gold 3DSG data. For this step, we specially choose the 3DSG datasets [72; 78; 27] for training and the graph codebook will be well initialized. **Step-2 Spatial Alignment.** Then we tune the visual and text decoder with the loss in Eq. 12. During this step, only visual decoder and text decoder are updated with the loss \(_{v-dec}+_{t-dec}\). **Step-3 2DSG\(\)3DSG Diffusion Training.** In this step, we use the constructed aligned 3DSG-Image-Text data (SS4.1) to train the 2DSG\(\)3DSG graph diffusion, thus the model will acquire the prior 3D estimation capability. The optimization objectives here is \(_{I23D}+_{T23D}\). **Step-4 Overall Training.** Finally we tune the whole model with dual learning objectives, where we update the three diffusion models and freeze other modules. The overall learning target is \(_{dual}+_{mutual}\).

After above training steps, the SI2T or ST2I can be launched alone without the intermediate process sharing. At this point, the critical graph diffusion module has learned sufficiently well from the previous training, so without the dual task aiding, the 3DSG generated during inference is also of high quality for the following 3D\(\)X generation.

## 5 Experiment

### Experiment Settings

**Dataset.** To demonstrate the capability of our proposed method for both ST2I and SI2T generation, we conduct experiments on the VSD [95; 97] dataset, which is constructed for visual spatial understanding. The VSD dataset contains about 30K images from SpatialSense  and Visual Genome

Figure 3: Illustrations of the training steps of SD\({}^{3}\).

[MISSING_PAGE_FAIL:8]

When removing both 3DSG modeling and dual learning ("Singleton"), the model decay to the simple discrete diffusion model, which is just comparable to the VQ-Diffusion and DDCap model.

Spatial Evaluation.To compare the model's effectiveness, we conduct human evaluations for both ST2I and SI2T. We follow  to ask ten volunteers to answer the 5-point Likert scale on 100 samples. For SI2T, we collect scores for _Spatial Description Accuracy_ and _Spatial Description Diversity_. For ST2I, we collect scores for _Visual Spatial Accuracy_. The results are shown in Table 3. Overall, our SD\({}^{3}\) method shows the best spatial understanding capability on SI2T and ST2I. More details are put in Appendix SSB.

### Qualitative Results

To present the ST2I and SI2T performance of our model in a more intuitive way, we show some qualitative results in Figure 4. We visualize the generated images and texts using different methods. For ST2I, compared with Frido and VQ-Diffusion, our SD\({}^{3}\) generates more spatial-faithful images. For SI2T, compared with 3DVSD and DDCap, our method is able to extract and correctly describe the key spatial information.

### In-depth Analyses and Discussions

Previously, we have verified the effectiveness of our dual learning by thorough numerical evaluations. Now, we explore how our methods advance via the following research questions.

How does 3DSG guidance aid the generation of spatial-faithful image and text?First, after removing the 3DSG integration, comparing the last two lines in Table 2, we can see that the 3DSG feature contributes great influence. Further, we follow GLIP  to assess how well the objects

Figure 4: Qualitative results by different models, where the samples are selected from VSDv2.

   & **ST2I** & **SI2T** \\   & SpaAcc. & SpaAcc. & Div. \\ 
3D\({}^{3}\) & 3.86 & 4.03 & 3.62 \\ Frido & 3.04 & - & - \\
3DVSD & - & 3.03 & 2.76 \\  

Table 3: Human Evaluation for Spatial Accuracy.

Figure 5: The evaluation of structure matching on VSDv2.

Figure 6: The change of average number of SG nodes.

attribute matching between input image/text and generated ones, Also, we assess how well the subject-predicate-object triplets of the gold TSG and VSG could be retrieved in the ones from the generated image/text via the triplets recall (TriRec.) between scene graphs. We compare the SoTA SI2T and ST2I baselines and the results are shown in Figure 5. We observe that our SD\({}^{3}\) significantly outperforms the model without 3DSG guidance ("Vanilla Dual") on the two metrics, which is just comparable to the baseline models. This suggests that with the 3DSG guidance, the model could capture correct and sufficient spatial structures from inputs for the generation.

How does the dual intermediate sharing aid the graph diffusion model?On one hand, we report the performance of 3DSG generation on the gold 3DSG dataset  to evaluate how well the structures of generated 3DSG could be retrieved in the gold ones. As shown in Table 4, we can see that compared with the initial VSG/TSG the generated 3DSG of our full model highly matches to the ground truth while without the dual intermediate sharing ("w/o Xfeat."), i.e., remove the \(_{X-I23D}\) and \(_{X-T23D}\) in the **X\(\)3D** diffusion, the performance dramatically drops, showing the effectiveness of intermediate process sharing. Besides, if the graph diffusion pre-training is removed ("w/o Diffre."), it will lose the ability to generate 3DSG (degrade to initial TSG/VSG). On the other hand, we assess how much the graph diffusion model produce the new structures, compared with the initial TSG/VSG. As shown in Figure 6, after graph diffusion, the average numbers of the three types of elements are enriched substantially.

The influence of the training strategy.To show the effectiveness of our four-step training strategy, here we conduct an objective ablation study. We investigate the model without DGAE pre-training in step 1, the model without spatial alignment in step 2, and the model without 2DSG\(\)3DSG in step 3, respectively. As shown in Figure 7, we can see both ST2I and SI2T performance decreases when removing any training steps. Notably, the 2DSG\(\)2DSG step contributes the most to the final results. The essential 3D understanding function lies in the capability of the graph diffusion module, which should be largely enhanced via this step.

## 6 Conclusion

In this work, we study the ST2I and SI2T tasks under a dual learning framework. We first propose the spatial-aware 3D scene graph to model the 3D feature which is essentially shared by ST2I and SI2T. The 3DSG is constructed by being initialized with a 2D TSG/VSG and then evolved to the 3DSG by a graph diffusion model. We then leverage the dual learning to enhance the 2DSG\(\)3DSG evolving by sharing clues of the dual 3DSG\(\)Image/Text process, through which the 3DSG diffusion model is adequately guided and then facilitates the whole ST2I and SI2T. On the VSD dataset, our method shows great superiority in both SI2T and ST2I. Further analyses demonstrate how our dual learning method could capture 3D spatial structures and then help generate spatial-faithful images and texts.

Looking forward, there can be quite rich explorations in future research. First, the graph diffusion model highly relies on the quality of 3DSG training data, which has significant impact to the final performance of our method. Correspondingly, we in the future will explore the data augmentation methods to optimize the training. Second, the evaluation for spatial understanding of ST2I and SI2T has not been fully explored in this work, i.e., with human evaluation instead. Also, one promising direction for VSU is constructing multimodal large language models (MLLMs) [22; 85; 20; 84; 94; 57; 82], especially for 3D spatial understanding .