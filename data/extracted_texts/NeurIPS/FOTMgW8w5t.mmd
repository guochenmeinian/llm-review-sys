# (b) Proof of semiparametric efficiency bound

Using Surrogates in Covariate-adjusted Response-adaptive Randomized Experiments with Delayed Outcomes

Lei Shi

Division of Biostatistics

University of California, Berkeley

2121 Berkeley Way, Berkeley, CA 94704

leishi@berkeley.edu

&Waverly Wei

Marshall School of Business

University of Southern California

3670

Trousdale Pkwy, Los Angeles, CA 90089

waverly@marshall.usc.edu

&Jingshen Wang

Division of Biostatistics

2121 Berkeley Way, Berkeley, CA 94704

jingshenwang@berkeley.edu

###### Abstract

Covariate-adjusted response-adaptive randomization (CARA) designs are gaining increasing attention. These designs combine the advantages of randomized experiments with the ability to adaptively revise treatment allocations based on data collected across multiple stages, enhancing estimation efficiency. Yet, CARA designs often assume that primary outcomes are immediately observable, which is not the case in many clinical scenarios where there is a delay in observing primary outcomes. This assumption can lead to significant missingness and inefficient estimation of treatment effects. To tackle this practical challenge, we propose a CARA experimental strategy integrating delayed primary outcomes with immediately observed surrogate outcomes. Surrogate outcomes are intermediate clinical outcomes that are predictive or correlated with the primary outcome of interest. Our design goal is to improve the estimation efficiency of the average treatment effect (ATE) of the primary outcome utilizing surrogate outcomes. From a methodological perspective, our approach offers two benefits: First, we accommodate arm and covariates-dependent delay mechanisms without imposing any parametric modeling assumptions on the distribution of outcomes. Second, when primary outcomes are not fully observed, surrogate outcomes can guide the adaptive treatment allocation rule. From a theoretical standpoint, we prove the semiparametric efficiency bound of estimating ATE under delayed primary outcomes while incorporating surrogate outcomes. We show that the ATE estimator under our proposed design strategy attains this semiparametric efficiency bound and achieves asymptotic normality. Through theoretical investigations and a synthetic HIV study, we show that our design is more efficient than the design without incorporating any surrogate information.

## 1 Introduction

### Motivation

In recent years, covariate-adjusted response-adaptive randomization (CARA) designs have become increasingly prominent in clinical research for evaluating the effects of treatment plans or drugs on primary outcomes of interest . Specifically, CARA designs are experiment strategies that adaptively revise treatment allocation based on observed outcomes and covariate information accumulated during multi-stage clinical trials . Inheriting the advantage of traditional clinical trial designs, CARA designs can also help with providing reliable causal evidence to support clinical discoveries. Nevertheless, different from traditional clinical trial designs, CARA designs offer several major benefits. On the one hand, CARA designs enhance the precision of medicine by improving the statistical power to estimate treatment effects. On the other hand, CARA designs allow for adaptive modifications of treatment allocation based on intermediate findings. As highlighted in the recent Food and Drug Administration (FDA)'s adaptive design clinical trials for drugs and biologics guidance for industry , the key advantage of adaptive clinical trial designs is their ability to adapt to new information that emerges during the trial. This fundamental characteristic fosters more flexible and efficient clinical trials. In sum, CARA designs can utilize clinical trial data efficiently by performing sequentially adaptive subgroup-specific optimization.

While CARA designs are beneficial, they face a practical challenge when outcomes are observed with delays. Such delays make it impossible to sequentially revise the randomization probability to optimize trial objectives. Delayed outcomes are common in clinical practice, as treatments may take time to show their effects, especially for chronic conditions or diseases with slow progression. For instance, consider an HIV study conducted in Tanzania that investigates the effect of cash incentives on viral load suppression . The primary outcome is the viral load measured six months after starting antiretroviral therapy (ART) because achieving viral suppression (below 1000 copies per mL) is critical for preventing HIV transmission . However, measuring viral load depends on regular clinic visits by study subjects, which are often delayed due to factors such as limited access to care, poverty, or social stigma . These delays lead to significant missingness in primary outcome data, which undermines the efficiency of estimating treatment effects on the primary outcome.

In situations where primary outcomes are delayed, surrogate outcomes-intermediate or substitute biomarkers that can be measured immediately and are predictive of primary outcomes-emerge as a natural remedy . As mentioned in the FDA's surrogate endpoint resources for drug and biologic development, from 2010 to 2012, the FDA granted approval to 45% of new drugs based on a surrogate endpoint . Using surrogate outcomes provides early indicators of a treatment's efficacy, which accelerates the decision-making process and can lead to faster delivery of beneficial treatments to patients. Surrogate outcomes are particularly useful in CARA designs because they enable modifications of treatment allocation without waiting for delayed primary outcomes during the interim stages.

As such, there is a pressing need to develop new CARA designs to answer the following questions: How can both delayed primary outcomes and immediately observed surrogate outcomes be used simultaneously to guide treatment allocation revisions, optimizing the estimation efficiency of the primary outcome's treatment effect? In this manuscript, we propose a multi-stage CARA design with the goal of improving the estimation efficiency of primary outcome treatment effects by utilizing surrogate outcomes in the presence of delayed primary outcomes.

Our contributions can be summarized as follows:

1. From a methodological perspective, we propose a novel CARA design strategy that significantly improves the estimation efficiency of the primary outcome's ATE by incorporating surrogate outcomes. First, our approach uniquely integrates both primary and surrogate outcomes synergistically, unlike traditional clinical trial designs that depend exclusively on one or the other. Second, diverging from some adaptive experimental strategies that incorporate both surrogate and primary outcomes, we explore strategies that tackle the arm-dependent delay mechanism of primary outcomes and optimize the statistical efficiency in the presence of temporary or permanent missingness.
2. From a theoretical perspective, we prove the semiparametric efficiency bound under arm-dependent delayed primary outcomes while incorporating surrogate outcomes for estimating the ATE (Theorem 3). We show that our proposed design strategy converges to the oracle design, which represents the optimal design assuming perfect knowledge of the data-generating distribution. We also prove the statistical validity of our inference procedure by establishing the asymptotic normality of our proposed ATE estimator (Theorem 1). Furthermore, the proposed ATE estimator attains the semiparametric efficiency bound (Theorem 2), which verifies the efficiency gain of adopting the proposed design. Theorem 1 further providespractical guidance for the general setup of the design in terms of the number of experimentation stages and the portion of enrolled units within each stage to achieve optimality. Lastly, we illustrate that our design largely enhances statistical efficiency compared to the design that only uses delayed primary outcomes.

### Related literature

**CARA designs.** When covariate information is available to experimenters, CARA design can utilize both outcome information and covariate information to optimize for the experimental goals [37; 47]. CARA designs originate from response-adaptive randomization designs, yet they further utilize covariate information to assist the design [34; 21; 45].  introduced a family of CARA designs that consider both efficiency and ethics. Generalizations of CARA to incorporate semiparametric estimates are discussed by . Related CARA designs are also explored in studies such as [35; 1; 48]. However, unlike conventional CARA designs that assume immediate observation of outcomes, our approach accommodates delayed outcomes.

**Criteria of surrogacy.** proposes the statistical surrogacy criterion, which states that the observed primary outcome should be conditionally independent of the assigned treatment given the observed value of the post-treatment variable (surrogate outcome). The proposal is further extended by  and .  argues that 's proposal does not satisfy the causal necessity properties and proposes to study the principal surrogate.  introduces the notion of a strong surrogate using a graphical model, which states that treatment serves as an instrument for the effect of the surrogate on the primary outcome.  makes a detailed comparison of different notions of surrogacy. The authors propose (strictly) consistent surrogacy to avoid the surrogacy paradox and evaluate several conditions for the criteria to hold.  studies criteria of surrogacy based on distributional average causal effects.

**Surrogates in randomized experiments.** Existing literature focuses on using surrogates can be roughly divided into two lines of work. The first line of work utilizes surrogates from a data fusion perspective.  proposes to use the surrogate index to estimate long-term causal effects when primary outcomes are missing in experimental data and only observed in observational data. This work relies on the statistical surrogacy assumption.  proposes a data combination framework to incorporate surrogate outcomes under the assumption of _latent unconfoundedness_.  proposes methods to use surrogate outcomes as proxy variables for persistent confounders. The second line of work uses surrogates as supplements for the primary outcomes.  investigates using surrogate data to improve efficiency when inferring parameters from estimating functions.  proposes to view surrogates as supplements instead of replacements for the primary outcome and investigates how this proposal can improve the efficiency of treatment effect estimation.  proposes to combine primary data and auxiliary data where both datasets are assumed to satisfy ignorability.  uses surrogate outcomes to assist with the design of adaptive clinical trials and show their relative and absolute benefits. Diverging from the usage of surrogate outcomes in randomized experiments, we explicitly model the arm and covariates delay mechanisms of primary outcomes while incorporating surrogates.

## 2 Problem setup

Suppose we are designing an adaptive experiment with a total of \(T\) stages. Let \(X_{it}\) denote the covariates, \(S_{it}\) denote the surrogate outcome, and \(Y_{it}\) denote the primary outcome for subject \(i\) at stage \(t=1,,T\). Let \(A_{it}\) denote the treatment assignment status, where \(A_{it}=1\) corresponds to the treatment arm, while \(A_{it}=0\) corresponds to the control. Following the Neyman-Rubin causal inference framework [30; 38], we let \(Y_{it}(a)\) and \(S_{it}(a)\) represent the primary potential outcome and surrogate potential outcomes under treatment \(a\), where \(a\{0,1\}\). Assume that \((Y_{it}(1),Y_{it}(0),S_{it}(1),S_{it}(0))\) are i.i.d. copies of a population tuple \((Y(1),Y(0),S(1),S(0))\). Our parameter of interest is the average treatment effect corresponding to the primary outcome:

\[=[Y(1)-Y(0)].\]

We are in a setting where, at the end of Stage \(t\), we cannot observe the primary outcome for all subjects due to possible delay in the data collection process, but we can observe the surrogate outcomes for all subjects. The surrogate outcomes can inform the primary outcomes. We assume the primary outcome is observed after \(D_{it}\) stages and denote the conditional cumulative distribution function of \(D_{it}\) as

\[_{a}(d|x)=(D_{it} d|A_{it}=a,X_{it}=x), d=\{0,1,2,,T-1\}\{\},\;a\{0,1\}.\]\(D_{it}\) represents the number of stages for which an observation is delayed at stage \(t\). For example, in a two-stage experiment, \(D_{i1}=0\) means no delay for the \(i\)-th observation. \(D_{i1}=1\) means that the \(i\)-th primary outcome will be observed at stage \(2\). When \(D_{i1}=\), we never collect the \(i\)-th primary outcome back. A primary outcome can only be observed by the end of the experiment if \(D_{it} T-t\). Moreover, we allow \(D_{it}=\), which means that the primary outcome \(Y_{it}\) is missing (censored) at the end of the experiment.

The observed primary outcome can be written as

\[Y_{it}=\{A_{it}Y_{it}(1)+(1-A_{it})Y_{it}(0),&D_{it}  T-t;\\ ,&D_{it}>T-t..\]

The observed surrogate outcome can be written as \(S_{it}=A_{it}S_{it}(1)+(1-A_{it})S_{it}(0)\). Therefore, our observed data has the following structure:

\[\{(X_{it},A_{it},S_{it},Y_{it},D_{it})_{i=1}^{n_{t}}\}_{t=1}^{T}.\]

In our designs, experimenters can sequentially revise the treatment assignment based on the historical data. We define the treatment assignment probability for subjects in stage \(t\) as

\[e_{t}=(A_{it}=1|X_{it},}_{t-1}), t=1,,T,\]

where \(}_{t-1}=\{(X_{is},A_{is},D_{is},S_{is},Y_{is})_{i=1}^{n_{s}}\} _{s=1}^{t-1}\) is the historical information collected up to Stage \(t-1\). In our manuscript, we consider a multi-stage clinical trial setting where \(T<\) and \(n_{t}\) for \(t=1,,T\).

We have the following unconfounded assumption for arm-dependent delayed outcomes: \(A\!\!\!(Y(1),Y(0),S(1),S(0)) X\). We also assume the delay is arm and covariates dependent: \(D\!\!\!(Y(1),Y(0),S(1),S(0)) X,A\). As we are in the randomized experiment setting, the unconfoundedness assumption holds by design. The delay mechanism says that the delay variable is independent of potential primary outcomes and potential surrogate outcomes when conditional one covariates and treatment arms. This rules out the arrow between the delay and the outcome, which simplifies the technical discussion of the paper. Moreover, such a setup aims to reflect real-world randomized experiments where the delay is mainly due to protocol or structural factors instead of the realized outcome (such as the severity of some diseases). For example, if we are testing the effect of a vitamin supplement on blood vitamin levels and ask patients for regular check-ins, the delay is less likely to depend on the outcome since the outcome does not cause severe symptoms that affect patient check-in.

## 3 Design objective

In this section, we shall formulate our design objective. Our goal of the CARA design is to improve the estimation efficiency of the ATE. Heuristically, we aim to find the optimal treatment allocation that minimizes the semiparametric efficiency bound (SPEB) of estimating the ATE.

The formulation of the design objective relies on the derivation of the SPEB of the ATE under the delayed outcome setting while incorporating surrogate information. In Theorem 3 of the Appendix, we establish the SPEB for estimating \(\). If we introduce the following notations on the conditional expectation of the outcomes: \((a,x,s)=[Y|A=a,X=x,S=s]\), \((a,x)=[(A,X,S)|A=a,X=x]\), our design objective can be formally defined as follows:

\[_{[,1-]^{T}}\ _{}\] \[=_{[,1-]^{T}}\  }{_{t=1}^{T}r_{t}e_{t}(X)_{1}(T-t|X)}+}{_{t=1}^{T}r_{t}(1-e_{t}(X))_{0}(T-t|X)}\] \[+}{ _{t=1}^{T}r_{t}e_{t}(X)}+}{_{t=1}^{T}r_{t }(1-e_{t}(X))}}.\]

The SPEB is a theoretical result derived from the work of . Our design objective says that we aim to find the sequence of optimal treatment allocation that minimizes the semiparametric efficiency bound. Furthermore, we require that the treatment allocation should be bounded by \(\) and \(1-\) for \((0,1/2)\). Note that our design objective depends on the conditional expectation of the primary outcome on covariates and surrogates and the delay mechanism. However, in practical settings, both the conditional expectations and the delay mechanisms are unknown to practitioners. Therefore, we propose to use CARA designs that allow us to adaptively learn the unknown parameters based on sequentially collected data. We shall introduce our proposed design strategy in the following section.

## 4 Proposed CARA design strategy

In this section, we shall formally introduce our proposed design strategy. We consider a delay variable \(D\) with finite support: \(=\{0,1,,D^{*}\}\{\}\), where \(D^{*}\) is pre-specified based on domain knowledge. Also, we allow \(D\) to take \(\), meaning the outcome is permanently missing. For simplicity, we assume that the enrollment proportion at each stage is \(r_{t}=1/T\), for \(t=1,,T\), \(T<\). We assume both \(X\) and \(S\) take discrete values to avoid unnecessary technical complexity.

From a high level, our proposal consists of four steps. Step 1 consists of \(D^{*}+1\) stages and serves as an exploration step that learns parameters like the delay distribution, outcome model, etc. Step 2 is a policy optimization step after Stage \(D^{*}+1\), to compute the optimal allocation with the learned parameters. Step 3 is a policy calibration step from Stage \(D^{*}+1\) to \(T\), where we calibrate the allocation to match the optimal strategy. Step 4 constructs point and variance estimators based on the data. The full procedure is summarized in Algorithm 1.

```
1:Enroll \(n_{1}\) participants, and assign treatments with \(e_{1}=\);
2:Estimate \(_{a}^{(1)}(0|x)\) and let \(_{a}^{(1)}(l|x)=_{a}^{(1)}(0|x)\), \(l=1,,T-1\).
3:Stage \(2\) to \(D^{*}+1\)(Learn delay mechanism):
4:for\(l 2\) to \(D^{*}+1\)do
5: Enroll \(n_{i}\) subjects and assign treatment with probability \(e_{t}=\);
6: Update \(_{a}^{(t)}(l|x)\) for \(l t-1\).
7:endfor
8:Obtain the sequence of optimal treatment allocation \(}^{(D^{*}+1)}\) by solving (1). Stage \(D^{*}+2\)to \(T\)(Calibration of treatment allocation):
9:for\(t D^{*}+2\) to \(T\)do
10:Enroll subjects and assign treatments with calibrated probability \(_{t}^{*}\).
11:endfor
12:After Stage \(T\)(Inference):
13:Update \(\) and \(\).
14:Construct a two-sided \(\)-level confidence interval for \(\). ```

**Algorithm 1** Surrogate-enhanced adaptive experiment with delayed outcomes

Below we take a deeper dive into the details and motivations for each step in Algorithm 1.

**Stage 1**. In line 1 -2, we initialize the experiment by assigning treatments with probability \(_{1}=\). After Stage 1, we are able to observe all the surrogate outcomes for \(n_{1}\) subjects and part of the primary outcomes. One can estimate arm-dependent delay with \(_{a}(0|x)\) by counting the portion of the observed sample:

\[_{a}^{(1)}(0|x)=^{n_{1}}_{(D_{i1} 0 )}_{(X_{i1}=x)}_{(A_{i1}=a)}}{_{i=1}^{n_{1}} _{(X_{i1}=x)}_{(A_{i1}=a)}}\]

As we only observe outcomes whose delay variable \(D_{i1} 0\) at the end of Stage 1, we let \(_{a}^{(1)}(l|x)=_{a}^{(1)}(0|x),\ l 1\). We then estimate \(^{(1)}(a,x,s)\) and \(^{(1)}(a,x)\) by taking a sample average of the observed outcome stratified by \((a,x,s)\) and \((a,x)\), respectively:

\[^{(1)}(a,x,s) =^{n_{1}}_{(D_{i1} 0)}Y_{i1}_{(A _{i1}=a)}_{(X_{i1}=x)}_{(S_{i1}=s)}}{_{i=1}^{n_{1}} _{(D_{i1} 0)}_{(A_{i1}=a)}_{(X_{i1}=a)} _{(S_{i1}=s)}},\] \[^{(1)}(a,x) =^{n_{1}}_{(D_{i1} 0)}Y_{i1} _{(A_{i1}=a)}_{(X_{i1}=x)}}{_{i=1}^{n_{1}} _{(D_{i1} 0)}_{(A_{i1}=a)}_{(X_{i1}=x)}}.\]

**Stage 2 to \(+1}\).** In line 4 to 5, we keep enrolling subjects and assign subjects to the treatment arm with probability \(_{t}=1/2\). Update the estimates of the delay mechanism by counting portions of the observed sample up to the current stage:

\[_{a}^{(t)}(l|x)=^{t-1}_{i=1}^{n_{s}}_{(D_{is} l)}_{(X_{is}=x)}_{(A_{is}=a)}}{_{s= 1}^{t-1}_{i=1}^{n_{s}}_{(X_{is}=x)}_{(A_{is}=a)}}, { for }l=0,,t-1,\]

and let \(_{a}^{(t)}(l|x)=_{a}^{(t)}(t-1|x)\) for \(l t\). Then update the estimates \(^{(t)}(a,x,s)\) and \(^{(t)}(a,x)\) as the new stratified sample averages:

\[^{(t)}(a,x,s)=^{t-1}_{i=1}^{n_{ t}}Y_{it}_{(D_{is} t-1)}_{(A_{il}=a)}_{(X_{il} =x)}_{(S_{il}=s)}}{_{l=1}^{t-1}_{i=1}^{n_{t}}_{(D _{is} t-1)}_{(A_{il}=a)}_{(X_{il}=x)}_{(S_{ il}=s)}},\] \[^{(t)}(a,x)=^{t-1}_{i=1}^{n_{ t}}Y_{it}_{(D_{is} t-1)}_{(A_{il}=a)}_{(X_{il} =x)}}{_{l=1}^{t-1}_{i=1}^{n_{t}}_{(D_{is} t-1)}_{(A_{il}=a)}_{(X_{il}=x)}}.\]

At the end of Stage \(D^{*}+1\), we can obtain estimates of all the delay mechanisms: \(_{a}^{(D^{*}+1)}(0|x),,_{a}^{(D^{*}+1)}(D^{* }|x)\). We then solve the following optimization problem to find the optimal sequence of \(}=(_{1},,_{T})\):

\[_{[,1-]^{T}} ^{D^{*}+1}n_{s}}_{s=1}^{D^{*}+1} _{i=1}^{n_{s}}-^{(t)}(1,X_{is},S_{is}) )^{2}}{_{t=1}^{T}r_{t}e_{t}_{1}^{(t)}(T-t|X_{it})}+ -^{(t)}(0,X_{is},S_{is}))^{2}}{_{t=1}^{T}r_{t}(1 -e_{t})_{0}^{(t)}(T-t|X_{it})}\] \[+^{(t)}(1,X_{is},S_{is})-^{(t )}(1,X_{is}))^{2}}{_{t=1}^{T}r_{t}e_{t}}+^{(t)} (0,X_{is},S_{is})-^{(t)}(0,X_{is})^{2}}{_{t=1}^{T}r_{t }(1-e_{t})}+_{N}\|\|_{2}^{2}}}.\] (1)

In particular, confronted with the possibility that multiple minima could exist for the oracle optimization program, we introduced the penalty term \(_{N}\|\|_{2}^{2}\), which regularizes the solution. In Theorem 2, we will showcase that, theoretically, if we choose the penalty level to be \(_{N}=C\), \(}\) will converge in probability to an oracle minima of the population program. In practice, we propose to choose the tuning parameter based on cross-validation, where we split the collected data into multiple folds to tune the best scaling factor \(C\) for \(_{N}=C\).

**Stage \(+2)}\) to \(\)**. In line 7 to 9, we calibrate the treatment allocation based on the derived Stage \(D^{*}+1\) optimal treatment allocation strategy. From Stage \((D^{*}+2)\) to Stage \((T-D^{*})\), we assign treatments with calibrated probability \(_{l}\), where

\[_{l}=^{T-D^{*}}n_{s}_{s}-_{s=1}^ {D^{*}+1}n_{s}_{s}}{_{s=D^{*}+2}^{T-D^{*}}n_{s}},l=D^{*}+2,,T-D^{*}.\]

and \(_{s}\) is the actual treatment allocation at each Stage \(s\). Then, from Stage \(s=(T-D^{*}+1)\) to \(T\), we assign treatments with probability \(_{s}=_{s}\), where \(s=T-D^{*}+1,,T\). After Stage \(T\) (line 11 to 12), we update the delay mechanism and the treatment assignment probability using data collected from the whole experiment.

**After Stage \(\)**. We obtain the final ATE estimate \(\) based on the efficient influence curve derived in Theorem 3 as

\[=_{t=1}^{T}_{i=1}^{n_{t}} _{(D_{it} T-t)}}{_{t=1}^{T}r_{t} _{t}(X_{it})_{t,1}(D_{it} T-t|X)}Y_{ it}-(1,X_{it},S_{it})\] \[-)_{(D_{it} T-t)}}{_{t=1}^{T}r_{t} (1-_{t}(X_{it})_{t,0}(D_{it} T-t|X)}Y_ {it}-(0,X_{it},S_{it})\] \[+}{_{t=1}^{T}r_{t}_{t}(X_{it})} (1,X_{it},S_{it})-(1,X_{it})\] \[-)}{_{t=1}^{T}r_{t}(1-_{t}(X_{it })}(0,X_{it},S_{it})-(0,X_{it})+ (1,X_{it})-(0,X_{it})},\]and the variance estimates as

\[} =_{t=1}^{T}_{i=1}^{n_{t}}_{(D_{it}  T-t)}A_{it}(Y_{it}-(1,X_{it},S_{it}))^{2}}{\{_{t=1}^{T}r_{ t}_{t}(X_{it})_{1}(T-t|X_{it})\}^{2}}+_{(D_{it} T-t)}(1-A_{it})(Y_{it}-(0,X_{it},S_{it}) )^{2}}{\{_{t=1}^{T}r_{t}1-_{t}(X_{it}) _{0}(T-t|X_{it})\}^{2}}\] \[+_{t=1}^{T}_{i=1}^{n_{t}}( (1,X_{it},S_{it})-(1,X_{it}))^{2}}{\{_{t=1}^{T }r_{t}_{t}(X_{it})\}^{2}}+)((0,X_ {it},S_{it})-(0,X_{it}))^{2}}{\{_{t=1}^{T}r_{t}1 -_{t}(X_{it})\}^{2}}\] \[+_{t=1}^{T}_{i=1}^{n_{t}} {}(1,X_{it})-(0,X_{it})-^{2}.\]

## 5 Theoretical investigation

In this section, we investigate the theoretical properties of our proposed design strategy. In Theorem 1, we demonstrate the asymptotic normality of the ATE estimator with any sequence of propensity scores that are generated sequentially from history and converge to some fixed scores. Furthermore, we show that our design strategy asymptotically converges to the oracle design strategy in Theorem 2, which suggests that the constructed estimator is semi-parametrically efficient.

**Theorem 1** (Asymptotic normality).: _Assume the delays are conditionally independent of the surrogate and potential outcomes, given covariates and historical data. Assume the following conditions hold:_

1. _Bounded conditional moments:_ \(\{m_{4}(0,s,x),m_{4}(1,s,x)\} M_{4}\)_, where_ \[m_{4}(a,s,x)=\{|Y(a)|^{4} S(a)=s,X=x\},a=0,1.\]
2. _Convergent scores: there exists a set of propensity scores_ \(\)_, such that_ \[_{t[T],x}|_{t}(x)-_{t}(x)|=o_{p} (1).\] (2)

_Let \(n_{t}=r_{t}N\) with \(r_{t}>0\), \(_{t}r_{t}=1\). Then when \(N\), we have_

\[(-)(0,()).\]

_Moreover, the variance estimator satisfies_

\[}()-()=O_{p}(}).\]

Theorem 1 is a general theoretical result that works for _any_ sequence of historic-dependent treatment allocation strategy \(}\), as long as \(}\) converges to an oracle policy in probability asymptotically. For example, one can apply complete randomization through the experiment, which corresponds to \(_{t,cr}=_{t,cr}=1/2\) and establish the asymptotic normality of \(\) with variance \((_{cr})\). In particular, if the proposed adaptive designing strategy (Algorithm 1) is implemented, the treatment allocation probability will converge to one set of optimal policies that minimizes the semiparametric efficiency bound (4), which is established in Theorem 2 below.

**Theorem 2** (Convergence of the proposed design strategy).: _Let \(n_{t}=r_{t}N\) with \(r_{t}>0\), \(_{t}r_{t}=1\). Assume the bounded conditional moments hold as in Theorem 1. Assume sufficient enrollment at the first \((T-D^{})\) (non-delayed) stages:_

\[_{t=1}^{T-D^{}}r_{t}^{2}/_{0,}+_{0}^{2}},^{2}/_{1,}+_{1}^{2}}\}}{^{2} /_{1,}+_{1}^{2}}+^{2}/_{0, }+_{0}^{2}}}.\] (3)

_Set \(_{N}=C\). When \(N\), we have_

1. \(}-^{}=o_{p}(1)\)_, where_ \(^{}=_{ 0}^{}()\)_, and_ \[^{}()=*{arg\,min}_{[,1-]^{T }}()+\|\|_{2}^{2}.\]_._
2. \(}-^{**}=o_{p}(1)\)_, where_ \(^{**}\) _is a minima of_ \(()\) _defined as follows:_ \[e_{t}^{**}=\{1/2,&t D^{*}+1;\\ ^{T-D^{*}}r_{s}e_{s}^{*}-_{s=1}^{D^{*}+1}r_{s}/1+2}{_{ s=D^{*}+2}r_{s}},&D^{*}+2 t T-D^{*};\\ e_{t}^{*},&t T-D^{*}+1..\]

Theorem 2 formally established the convergence property of the propensity scores generated by Algorithm 1. More concretely, Theorem 2 showed that two sets of estimated treatment allocation probability converge to the minima of the population optimal variance: one is the scores \(}\) generated by the optimization program (1), and the other is the sequence of propensity scores \(}\) upon calibration which is implemented through the experiment. Therefore, Theorem 1 and Theorem 2 together imply that the point estimator based on the proposed treatment strategy attains the semiparametric efficient bound asymptotically.

Theorem 2 imposes an additional condition (3), which requires a sufficient number of enrollment in the non-delayed stages. This is an important sufficient condition for the optimality of the adaptive allocation strategy, which ensures the optimization program has multiple global minima and enables experimenters to calibrate the propensity scores based on the history to achieve optimality. In practice, Condition (3) can also provide guidance on the design of the experiment to decide the length of the study and the portion of units to recruit in the initial stages.

## 6 Synthetic case study: HIV trial

In this synthetic case study, we calibrate our data-generating process using data collected from an HIV randomized controlled trial (RCT) conducted in Tanzania . In this study, \(n=530\) participants are initially enrolled and randomized to one of the three treatment arms: (1) receive no cash, (2) receive 10,000 TZS, and (3) receive 22,500 TZS. In our case study, we combine the latter two arms and define the control arm \(A=0\) as "receive no cash transfer" and the treatment arm \(A=1\) as "receive any cash transfer." For the treatment arm, the cash incentives were administered six times from May 21, 2018, to May 31, 2019. In our case study, we consider June 1, 2019, as the starting point of our trial because all the delays observed after June 1, 2019, are not due to the delay in cash transfer administration. After all the cash incentives were administered, \(n=511\) subjects were still alive on June 1, 2019, with \(n=177\) subjects in the control arm and \(n=334\) in the treatment arm. As the very last test was taken on June 29, 2021, we consider June 29, 2021, as the last time point where we gathered outcome data.

Motivated by the original HIV trial, we also consider a multi-stage trial where each stage consists of six months, with the primary outcome \(Y\) being the viral load measured at the end of a stage. The viral load can be delayed to be measured because HIV patients may miss their scheduled test appointments. Therefore, we consider the World Health Organization (WHO) stage as the surrogate outcome \(S\{1,2,3\}\) because the WHO stage is a clinical indicator of HIV infection progression and it is measured without delay, where \(S=1,2,3\) indicates the asymptomatic, mild, and advanced symptoms respectively. We use "sex" as the covariate \(X\) in our study, where \(X=1\) indicates male and \(X=0\) indicates female. We further observe that the delay mechanism depends on both the treatment arm and the covariate. We summarize the delay mechanism observed from the real data in Table B. We summarize the expectation and standard deviation of the primary outcome under arm \(A\) given \(X\) and \(S\) in Table 2.

In our synthetic data generation, we generate the surrogate outcome from a multinomial distribution. The delay mechanism is also generated following multinomial distribution using the parameters in Table B. We generate X as \(X_{it}(0.64)\), and the primary outcome variable \(Y\) as \(Y_{it}|A_{it}=a,X_{it}=x,S_{it}=s((a,x,s))\). The true average treatment effect of the primary outcome is \(=0.04\). Following our proposed design strategy, we set the total number of experimental stages as \(T=2(D^{*}+1)=8\). In this case study, We compare three designs: (1) Our proposed design strategy; (2) the complete randomization design which sets \(e_{t}=1/2\) for \(t=1,,T\); (3) CARA design that only utilizes primary outcomes but not surrogate outcomes.

We present the case study results in Figure 1. In terms of bias, Figure 1(A) suggests that the point estimators from all three designs have a vanishing bias as the sample size grows, validating the asymptotic unbiasedness of all strategies. Nevertheless, in terms of variance, Figure 1(B) demonstratesthat our proposed design yields smaller standard deviations and thus higher estimation efficiency for estimating the ATE. The synthetic case study results verify our efficiency comparison in Section 5 and demonstrate the efficiency gain of our proposed design strategy.

## 7 Discussion

In this work, we proposed a CARA design strategy that improves the efficiency of ATE estimation in the presence of delay by incorporating surrogate outcomes. The strategy leads to a point estimator that achieves semiparametric efficiency under the arm-covariate-dependent delay setting. It also demonstrates efficiency gain compared with the strategy that uses only primary endpoints. There are some future directions to explore. First, we mainly considered an arm-dependent delay setting . A more general setup is to consider the delay mechanism that is also dependent on the outcomes . Another possible framework is to consider outcomes that are also impacted by delays, for which the delay variable serves as a special set of surrogate variables . Moreover, the objective of this work focuses on statistical efficiency gain for ATE estimation. It is also important to incorporate realistic constraints for practical implementation, such as fairness among subgroups , safety concerns , the discrepancy between algorithmic results and human knowledge , etc. More generally, it is also interesting to draw connection to other relevant problems in causal inference and adaptive experiments, such as dealing with many treatment arms , targeting other causal parameters , incorporating instrumental variables , among others. We leave these questions as future research work.