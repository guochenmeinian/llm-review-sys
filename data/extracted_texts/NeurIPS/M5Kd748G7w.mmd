# Probabilistic Fusion Approach for

Robust Battery Prognostics

 Jokin Alcibar

Mondragon Unibertsitatea

jalcibar@mondragon.edu

&Ekhi Zugasti

University of the Basque Country (UPV/EHU)

ekhi.zugasti@ehu.es

&Aitor Aguirre-Ortuzar

Mondragon Unibertsitatea

aaguirre@mondragon.edu

&Jose I. Aizpurua

University of the Basque Country (UPV/EHU)

Ikerbasque, Basque Foundation for Science

joxe.aizpurua@ehu.eus

###### Abstract

Batteries play a critical role for advancing the decarbonization of the transportation and energy systems. Ensuring their safe and reliable operation is essential for the effectiveness of battery-powered systems. To support this, the development of accurate and robust prognostic models for battery state-of-health is key, enabling autonomous systems to operate effectively in complex and remote settings. The combination of Neural Networks, Bayesian modelling concepts and ensemble learning strategies, form a valuable prognostics framework to combine uncertainty in a robust and accurate manner. Accordingly, this study presents a Bayesian ensemble learning methodology for predicting the capacity degradation of lithium-ion batteries. The approach effectively forecasts capacity fade and quantifies the uncertainty associated with battery design and degradation processes. The proposed methodology employs a stacking ensemble technique, integrating multiple Bayesian Neural Networks (BNNs) as base learners, which have been trained on data diversity. Validation was performed using a battery aging dataset from NASA Ames Prognostics Center of Excellence. Obtained results highlight the enhanced accuracy and reliability of the proposed probabilistic fusion approach compared to (i) pseudo-Bayesian model averaging, (ii) pseudo-Bayesian model averaging with Bayesian bootstrapping, and (iii) a point prediction stacking approach using distinct BNNs.

## 1 Introduction

Batteries are crucial for a sustainable, carbon-free economy. The development of accurate battery Remaining Useful Life (RUL) prediction models is particularly important for reliable energy strategies and cost-effective solutions. The estimation of the state-of-health (SOH) is a key activity for the design of RUL prognostics models, focusing on capturing aging dynamics and health state (Toughzaoui et al., 2022). SOH-based prognostics capture battery ageing and health estimation which are crucial indicators for addressing the degradation that impacts capacity and increases safety risks like overheating (Wang et al., 2022). Thus, precise SOH monitoring and forecasting are imperative for safe and efficient operation of battery-operated systems (Zhao et al., 2023).

Recent data-driven approaches have focused on modeling the capacity degradation of lithium-ion (Li-ion) batteries. Toughzaoui et al. (2022) developed a Convolutional Neural Network (CNN)-Long short-term memory (LSTM) architecture, and Wei and Wu (2023) presented a graph CNNcomplemented by dual attention mechanisms for the estimation of SOH and RUL of batteries. Due to the variability inherent in the battery manufacturing process, it is essential to quantify this uncertainty to ensure robust and reliable prognostics predictions Abdar et al. (2021); Nemani et al. (2023).

In the broader machine learning context, ensembles of probabilistic models have been utilized to capture complex uncertainties. Fan et al. (2017) introduced a Bayesian posterior predictive framework for weighting ensemble climate models. Cobb et al. (2019) present a new machine learning retrieval method based on an ensemble of BNNs. In this scenario, the overall output from the ensemble is treated as a Gaussian mixture model. However, models are equally weighted with no adaptation to the observed data. Zhang et al. (2022) present a Bayesian Mixture Neural Network (BMNN) for Li-ion battery RUL prediction. However, the absence of a weighted model combination limits the analysis of individual model contributions. Alternatively, Bai and Chandra (2023) described a Bayesian ensemble framework using gradient boosting and Markov Chain Monte Carlo sampling, while Dai et al. (2023) demonstrated a robust Bayesian fusion method within a sequential Monte Carlo algorithm, enhancing uncertainty quantification in predictions.

In this context, inspired by the promising ability of probabilistic ensemble models to capture model uncertainty, the main contribution of this research is the development of a probabilistic model fusion approach for battery SOH predictions. Bayesian convolutional neural networks (BCNNs) are used as base models for SOH prediction, and the developed fusion approach integrates individual BCNN probabilistic predictions. The fusion strategy balances between precision and reliability of individual predictions, adopting an optimal tradeoff between accuracy and uncertainty of predictions through the proposed stacking approach. The proposed approach has been compared with (i) stacking BCNN models using mean information, (ii) Pseudo BMA, and (iii) a Pseudo-BMA variant stabilized with Bayesian bootstrap, called Pseudo-BMA+. Obtained results confirm that the proposed framework infers accurate, well-calibrated, and reliable probabilistic predictions, which improve predictive performance and contribute to estimate uncertainty in a robust and reliable manner in complex data-driven tasks. The proposed approach has been tested and validated with the publicly available NASA's battery dataset Saha and Goebel (2007).

## 2 Methodology

The proposed framework integrates BCNNs with probabilistic ensemble strategies to generate accurate predictions with robust uncertainty quantification, leveraging Bayesian modeling and ensemble strategies. The approach is divided into offline and online stages. From battery datasets, the offline process completes data pre-processing and model training. In the online process, trained models are stacked according to computed weight and stacking criteria. The outcome is a one-step-ahead probabilistic capacity estimate. Figure 1 shows the high-level block diagram of the proposed approach. The approach is generally divided into offline and online phases.

Figure 1: Block diagram of the proposed approach Alcibar et al. (2024).

### Offline Phase

During the offline phase, starting from a battery dataset with different run-to-failure trajectories on the same type of batteries, different base models are designed through a training strategy which seeks diversity in the training set to develop complementary predictive models.

**Ensemble Base Models: BCNNs**

BCNN combines feature extraction capabilities of classical CNN models with the uncertainty quantification of Bayesian theory. This fusion enables robust predictions by capturing model uncertainty, crucial for reliable decision-making in complex scenarios. The proposed architecture is built using variational layers of TensorFlow Probability in Python Dillon et al. (2017). Detailed architecture is provided in the Appendix A.

**Training for Diversity**

Model diversity is crucial for effective ensemble models Nam et al. (2021). Accordingly, the training set for each battery model is modified to learn different battery aging properties. Using the leave-one-out (LOO) strategy, \(K\) diverse BCNN models are built from \(K\) run-to-failure trajectories, changing the training set in each iteration (cf. Figure 1). Each model is trained on all batteries except one, held as a test set. This LOO approach enhances models' ability to generalize across battery types and manufacturing conditions. This stage completes the offline training process, which results in a set of BCNN models, \(=\{BCNN_{1},BCNN_{2},,BCNN_{K}\}\).

### Online Phase: Stacking of Predictive Distribution (SPD)

During the online phase, the proposed stacking of predictive distribution strategy is designed and tested. The proposed approach takes as input individual base models [cf. Eq. (2.1)] and monitored data up to the prediction instant \(t\), which is used to forecast the probability density function (PDF) of the capacity at \(t+1\), \(_{PDF}(t+1)\). The objective of the stacking process is to integrate the predictive distributions of different base models and propagate all the information end-to-end.

For comparison and benchmarking purposes, we implemented alternative ensemble methods: Pseudo-Bayesian Model Averaging (Pseudo-BMA) (cf. Appendix C.1), an enhanced variant of Pseudo-BMA stabilized using Bayesian bootstrap, known as Pseudo-BMA+ (cf. Appendix C.2) and Stacking Point Prediction (SPP) (cf. Appendix C.3).

**Stacking using Logarithmic Score**

The optimal way to combine a set of Bayesian posterior predictive distributions is by using the logarithmic score Yao et al. (2018). This method maximizes the average log-likelihood of the observed data, which is a proper scoring rule used to evaluate the accuracy of probabilistic forecasts. It measures the accuracy of a forecast and penalizes overconfidence and underconfidence in the predicted probability. The logarithmic score is defined as follows:

\[=_{w}_{i=1}^{N}log_{k=1}^{K}w_{k}p(y_{i} y _{-i},M_{k})+_{reg}_{k=1}^{K}w_{k}^{2}\] (1)

where \(N\) denotes the total number of data points and \(K\) denotes the total number of base models. The LOO predictive distribution for each model, _i.e._\(p(y_{i} y_{-i},M_{k})\), is used to compute the model's prediction for the data point \(i\). To avoid overfitting, a regularization term \(_{reg}\) is added.

In the Bayesian framework, stacking extends beyond averaging point predictions by combining multiple Bayesian posterior predictive distributions. This approach develops a _stacking model_ that leverages the strengths of various predictive models [cf. Eq. (2.1)], enhancing the overall predictive accuracy. Stacking predictive distributions enables fusion of uncertainties from various models into a unified predictive framework. This approach improves forecast accuracy and offers a comprehensive evaluation of uncertainty associated with forecasts, providing advantages across diverse decision-making scenarios. The fundamental equation governing this process is defined as follows:

\[(|y)=_{k=1}^{K}_{k}p(|y,M_{k})\] (2)where \((|y)\) represents the aggregate probability estimation based on the ensemble model, \(_{k}\) denotes the weight assigned to the \(k\)-th component within the ensemble, and \(p(|y,M_{k})\) refers to the probabilistic forecast generated by each base model.

### Forecasting

Online forecasting computes one-step ahead predictions. To forecast battery capacity at instant \(t+1\), previous data until instant \(t\) is used, plus an uncertainty factor expressed as noise. This data includes voltage \(V(t)\) and temperature \(T(t)\) at instant \(t\), as well as a Gaussian noise term \(\) distributed as \(N(0,=1)\), which introduces variability in the data's progression over time. The one-step ahead capacity distribution prediction is thus defined as :

\[_{PDF}(t+1)=f((t))\] (3)

where \(f(.)\) denotes the designed ensemble model, and \(_{PDF}(t+1)\) is the distribution of the capacity estimate at \(t+1\).

## 3 Results

To evaluate the proposed approach, different ensemble strategies are compared to evaluate their strengths and identify the most suitable approach. Table 1 presents a comparative analysis in terms of accuracy and probabilistic metrics.

A notable observation from the results in Table 1 is the variance between the proposed ensemble approach (cf. Figure 1) and the benchmarking ensemble models (cf. Appendix C) in specific scenarios. For batteries #5, #6 and #7, the proposed approach exhibited superior outcomes, particularly in probabilistic metrics such as Negative Log-Likelihood (NLL) (cf. Appendix D.2) and Continuous Rank Probability Score (CRPS) (cf. Appendix D.1). This suggests that the method produces not only accurate point estimates but also well-calibrated probability distributions. This is particularly valuable for battery health prognostics, where understanding prediction uncertainty is crucial for informed decision-making.

Figure 2 displays a visual comparative analysis corresponding to the data presented in Table 1, showcasing the different ensemble methods used for forecasting the capacity degradation of battery #5. The pseudo-BMA method displays a relatively narrow credible interval, though its accuracy is not very precise, especially at the beginning. The pseudo-BMA+ method shows similar uncertainty quantification to pseudo-BMA, with slightly improved accuracy. In contrast, the stacking of point predictions method yields the least favorable results in both accuracy and uncertainty quantification. Notably, the stacking of predictive distributions method provides the most comprehensive results, combining high accuracy with narrow credible intervals.

These observations highlight that although pseudo-BMA and pseudo-BMA+ present good results, the stacking of predictive distributions is generally superior due to its connection with the logarithmic score. This approach avoids potential issues such as identification problems arising from the lack of strict propriety associated with the energy score, and eliminates the need for additional smoothness assumptions required by other proper local scoring rules (Gneiting and Raftery, 2007).

    &  &  &  &  \\   & \(NLL()\) & \(CRPS()\) & \(NLL()\) & \(CRPS()\) & \(NLL()\) & \(CRPS()\) & \(NLL()\) & \(CRPS()\) \\  B0005 & -2.141 & 0.014 & -2.158 & 0.013 & -1.667 & 0.025 & **-2.163** & **0.012** \\ B0006 & -1.973 & 0.018 & -1.965 & 0.018 & -1.709 & 0.024 & **-2.008** & **0.016** \\ B0007 & -2.172 & 0.013 & -2.181 & 0.013 & -1.986 & 0.015 & **-2.191** & **0.012** \\ B0018 & -1.493 & 0.031 & -1.553 & 0.029 & **-1.799** & **0.019** & -1.593 & 0.0286 \\   

Table 1: Comparison of different ensemble strategies for different batteries used as test.

## 4 Discussion

The proposed research work demonstrates that the stacking of predictive distributions based on a Bayesian framework improves the accuracy and robustness of predictions compared with pseudo-BMA, pseudo-BMA+ and point prediction stacking approach. However, before drawing definitive conclusions about the application of the proposed solution in real-world applications,

_Robustness_

Credible intervals indicate the uncertainty associated with the data and the model (see Figure 2). Enhancing robustness involves reducing these intervals by minimizing uncertainty. This can be achieved by increasing observations to refine model uncertainty and using priors, such as maximum entropy or weakly informative priors, to tighten credible intervals.

_Scalability_

To analyze larger fleets of batteries, clustering similar batteries or using hierarchical modeling with a global model and specific group models would be more efficient than leave-one-out methods, enabling better data diversity and scalable adaptations.

## 5 Conclusion

This work presented a novel probabilistic fusion approach for battery state-of-health prognostics, combining BCNNs with Bayesian ensemble stacking techniques. The proposed stacking of predictive distributions method demonstrated superior performance on the NASA battery dataset, particularly in terms of probabilistic metrics. Results showed improved accuracy and well-calibrated uncertainty estimates compared to alternative probabilistic fusion methods, highlighting the potential of this approach for robust battery health monitoring.

The main contribution lies in the effective integration of model diversity and uncertainty quantification, enabling more reliable decision-making in battery management systems. However, the generalization to diverse battery types and operational conditions requires further investigation. Despite this limitation, the proposed method represents a significant progress in probabilistic battery prognostics, with potential applications in other health monitoring domains.

Figure 2: Battery capacity degradation forecasting results.