# Weighted ROC Curve in Cost Space:

Extending AUC to Cost-Sensitive Learning

 Huiyang Shao\({}^{1,2}\) Qianqian Xu\({}^{1}\)1 Zhiyong Yang\({}^{2}\)

Peisong Wen\({}^{1,2}\)

Peifeng Gao\({}^{2}\)

Qingming Huang\({}^{2,1,3}\)1

\({}^{1}\) Key Lab. of Intelligent Information Processing, Institute of Computing Tech., CAS

\({}^{2}\) School of Computer Science and Tech., University of Chinese Academy of Sciences

\({}^{3}\) BDKM, University of Chinese Academy of Sciences

shaohuiyang21@mails.ucas.ac.cn xuqianqian@ict.ac.cn

wenpeisong20z@ict.ac.cn gaopeifeng21@mails.ucas.ac.cn

yangzhiyong21@ucas.ac.cn qmhuang@ucas.ac.cn

###### Abstract

In this paper, we aim to tackle flexible cost requirements for long-tail datasets, where we need to construct a (1) cost-sensitive and (2) class-distribution robust learning framework. The misclassification cost and the area under the ROC curve (AUC) are popular metrics for (1) and (2), respectively. However, limited by their formulations, models trained with AUC are not well-suited for cost-sensitive decision problems, and models trained with fixed costs are sensitive to the class distribution shift. To address this issue, we present a new setting where costs are treated like a dataset to deal with arbitrarily unknown cost distributions. Moreover, we propose a novel weighted version of AUC where the cost distribution can be integrated into its calculation through decision thresholds. To formulate this setting, we propose a novel bilevel paradigm to bridge weighted AUC (WAUC) and cost. The inner-level problem approximates the optimal threshold from sampling costs, and the outer-level problem minimizes the WAUC loss over the optimal threshold distribution. To optimize this bilevel paradigm, we employ a stochastic optimization algorithm (SACCL) which enjoys the same convergence rate (\(O(^{-4})\)) with the SGD. Finally, experiment results show that our algorithm performs better than existing cost-sensitive learning methods and two-stage AUC decisions approach.

## 1 Introduction

Receiver Operating Characteristics (ROC) is a popular tool to describe the trade-off between the True Positive Rate (TPR) and False Positive Rate (FPR) of a scoring function. AUC is defined by the area under the ROC curve . This metric naturally measures the average classification performance under different thresholds and is widely used (_e.g._, disease prediction , and anomaly detection ). Compared with accuracy, AUC is insensitive to the threshold and cost , making it be a popular metric for long-tail learning  and achieve remarkable success .

Similar to AUC optimization, cost-sensitive learning is a common data mining method . The main goal is to incorporate the misclassification costs in the model, which is more compatible with realistic scenarios (_e.g._, the cost of misdiagnosing a disease as healthy is greater than the counterexample). Over the past two decades, researchers have pointed out that the ROC curve can be transferred to cost space by utilizing a threshold choice method, this is equivalent to computing the area under the convex hull of the ROC curve . In this way, AUC can be seen as the performance of the model with a uniform cost distribution . However, AUC considers all situations, which can not focus more on hard samples, Partial AUC (PAUC) is proposed as an extension of AUC withtruncated uniform cost distribution . Recently, some studies extend PAUC using parameterized cost distributions and propose WAUC to fit real-world applications .

Whether we use AUC or cost learning, our main purpose is to train models with these attributes:

**Attr.1**: The trained model can be robust to class distribution shift in the test **without class prior**.
**Attr.2**: The trained model can be robust to cost distribution in the test **without cost prior**.

However, to the best of our knowledge, there are few methods can train a model to have both of these attributes. According to Tab. 1, both AUC-related methods and cost-sensitive learning require a strong prior knowledge of the cost distribution; **(1)** The cost learning mainly considers a specified cost \(c\) and class imbalanced radio \(\). Models trained under this method are sensitive to class distribution, which does not apply to the scenario where test data distribution with offset. **(2)** AUC (PAUC) assumes that the cost distribution belongs to (truncated) uniform cost distribution \(U(a,b)\). Models trained with them will have poor performance when the true cost distribution is not uniform . **(3)** WAUC considers optimizing models based on more complex forms of cost distribution, such as \(beta(a,b)\). However, we can not obtain the cost prior in real problem scenarios, \(e\)._g_., financial market prediction . Considering the weakness comes from the existing settings, we will explore the following question in this paper:

_Can we bridge AUC and complicated cost distribution to training robust model on desired cost-sensitive and arbitrary class imbalanced decision scenarios?_

To answer this question, **we propose a view that, in some real applications , the cost, like the instance data, is not available prior but can be obtained by sampling.** Therefore, we choose to sample desired cost to approximate the true cost distribution. Different from previous settings, ours is closer to real world, the main process can be divided into three parts:

**Step.1 Cost Sampling:**: Firstly, we sample some desired costs to construct the empirical cost set.
**Step.2 Data Sampling:**: Next, we sample some instance data to construct the empirical dataset.
**Step.3 Build Formulation:**: Finally, we construct the appropriate formulation to maximize the performance in different desired costs and ensure model is robust to distribution shift.

It is natural for us to ask the question: Can we use the existing methods to realize this process? It's clear the answer is no. For AUC-related methods, they can not perform Step.1, and for cost-sensitive learning, they fail to achieve robust distribution shift and multiple costs in Step.3 (as shown in Fig. 1 (orange line). Hence, we propose a novel bilevel formulation combining the advantages of WAUC and cost learning. The inner-level process calculates the optimal threshold from sampling costs, and the outer-level process minimizes the WAUC loss over the optimal threshold distribution. The method can help the model improve robustness to class distribution in cost-sensitive decision problems. The main process is shown in Fig. 1 (green line). We summarize our contributions below:

* We propose a setting that focuses on the robustness of the model to the class distribution and cost distribution simultaneously. This setting treats cost as data that can be sampled, not as prior information, which is closer to the real-world cost-sensitive scenario.

   Different setting & Formulation & Attr.1 & Attr.2 & Cost distribution \\  Cost learning & \(_{}[c p(1|x)+(1-c)(1-) p(0|x)]\) & \(\) & \(\) & \(\) \\ AUC/PAUC & \(_{}[()^{}()]\) & \( U(a,b)\) & \(\) & \(\) \\ WAUC & \(}[()^{}()W( )]\) & \(W() beta(a,b)\) & \(\) & \(\) \\ Our method & \(}{}[()^{ }()]\) & \(}_{}_{COST}\) & \(\) & \(\) \\   

Table 1: Comparison with existing classification settings. Cost distribution represents the cost condition of each setting.

* We present a bilevel paradigm where the inner cost function is an inner constraint of outer WAUC optimization. For sake of optimization, we reformulate this paradigm into a nonconvex-strongly convex bilevel form. Moreover, we employ a stochastic optimization algorithm for WAUC (SACCL), which can solve this problem efficiently.
* We conduct extensive experiments on multiple imbalanced cost-sensitive classification tasks. The experimental results speak to the effectiveness of our proposed methods.

## 2 Observation and Motivation

In Tab. 1, we compare the existing methods with ours from different views. However, the table comparison does not have a very visual presentation. In this section, we will analyze the disadvantages of existing settings and explain our motivation. We train the model with all methods on a Cifar-10-Long-Tail training set under the different imbalanced ratios and cost distribution. We visualize the feature representation (the last layer's output of the trained model) in test data by t-SNE. The blue point represents negative samples predicted by the optimal threshold, and the orange point represents positive samples. The smaller the overlap between them, the better the performance. From Fig. 2, we can make the following remarks: **(1)** According to Fig. 2 (a), AUC is robust to changes in the imbalance ratio but completely not applicable with the cost distribution. **(2)** According to Fig. 2 (b), cost learning can process different cost distributions, but is sensitive to imbalance ratios.

Hence, our motivation is to propose a new approach to solve the problems in AUC and Cost-sensitive learning. As shown in Fig. 2 (c), our proposed method can have better learning results in various complex cost distributions and imbalance ratios. That means our method can overcome the shortcomings of traditional AUC and cost-learning, which perfectly fits the proposed setting.

## 3 Preliminaries

**Notations.** In this section, we give definitions and preliminaries about \(\). We denote \((,y)\) be an instance, where \(\) is drawn from feature space \(^{d}\) (\(d\) is feature number) and \(y\) is drawn from

Figure 1: The comparison of our proposed setting with the previous setting. The orange line represents the previous cost-sensitive learning approach, and the green line represents our method.

Figure 2: The feature representations comparison among different methods. (a) AUC optimization. (b) Cost learning. (c) Ours result. We solve the optimal threshold with the \(}_{COST}\) (defined in Sec. 3). \(\) denotes the probability of positive class, \(c\) denotes the cost ratio of misclassification (\(U\) denotes Uniform, \(N\) denotes Normal). For example, \(=0.5\), \(c N\) means model tested on dataset which has imbalanced ratio \(\) and cost set sampled from \(N\).

label space \(=\{0,1\}\). Let \(_{}\) (\(_{}\)_resp._) be positive (negative _resp._) instance distribution. Let \(^{+}_{}\) (\(^{-}_{}\)_resp._) be positive (negative _resp._) instance. We denote \(S_{+}=\{(^{+}_{i},y_{i})\}_{i=1}^{n_{+}}\) (\(S_{-}=\{(^{-}_{j},y_{j})\}_{j=1}^{n_{-}}\)_resp._) as a set of training data drawn from \(_{}\) (\(_{}\)_resp._), where \(n_{+}\) (\(n_{-}\)_resp._) denotes the instance number of \(S_{+}\) (\(S_{-}\)_resp._). Let \(_{()}\) be the indicator function, which returns 1 when the condition is true and 0 otherwise. In this paper, we focus on the deep neural network scoring function \(s(,):\), where parameterized by \(\) on an input \(\).

**AUC & WAUC.** For specified threshold \(\), the \(\) of a classifier derived from \(s(,)\) measures the likelihood that it accurately predicts a positive instance when getting a random positive instance from \(_{}\). Formally, we have:

(Pop.) \[_{s}()=_{^{+}_{ }}[s(,^{+})>]\ \ }_{s}()=}_{i=1}^{n_{+}}_{s( ,^{+}_{i})>}.\] (1)

In a similar spirit, the classifier's \(\) on threshold \(\) refers to the probability that it predicts positive when it gets a negative instance from \(_{}\).

(Pop.) \[_{s}()=_{^{-}_{ }}[s(,^{-})>]\ \ }_{s}()=}_{j=1}^{n_{-}}_{s( ,^{-}_{j})>}.\] (2)

AUC measures a scoring function's trade-off between TPR and FPR under uniform thresholds. Denote \(\) drawn from the distribution \(_{}\), WAUC utilizes the threshold distribution explicitly based on AUC. \(^{}_{s}\) denotes the probability density function of \(s(,^{-})\).

\[=_{}^{-}_{s}()^{}_{s}()d\] (3a) \[=_{}^{-}_{s}() ^{}_{s}()p()d,\] (3b)

**Cost function .** In some real application scenarios, we need to consider the misclassification cost. We denote \(c_{()}\) as misclassification cost for class \(()\), cost \(c\) drawn from \(_{c}\). Since we could not obtain the cost distribution \(_{c}\), we sample empirical set \(S_{c}=\{c_{i}\}_{i=1}^{n_{c}}\), \(n_{c}\) denotes the sample number of cost \(c\). Given a scoring function \(s\) and parameter \(\), the cost function \(_{COST}\) is (the empirical version of cost function, \(}_{COST}\) contains the empirical forms of \(\) and \(\)):

\[_{COST}(,c,^{*}(c))=c(1-_{s}( ^{*}(c)))+(1-c)(1-)_{s}(^{*}(c)),\] (4)

where \(=n_{+}/(n_{+}+n_{-})\), \(c=c_{+}/(c_{+}+c_{-})\) and \(^{*}(c)\) is optimal threshold for score function \(s\) under specified \(c\), the sample number \(n_{}=n_{c}\).

## 4 Problem Formulation

In this section, we introduce how to link the ROC curve to the cost space. First, we reformulate Eq.(3) into expectation:

\[=}_{ U}[_{s }()^{}_{s}()]\] (5a) \[=}_{_{}} [_{s}()^{}_{s}()].\] (5b)

If threshold \(\) is drawn from the uniform distribution \(U\), \(\) will degrade to the standard \(\) formulation. However, AUC only describes the global mean performance under all possible costs. If we want to extend AUC to cost-sensitive problems, maybe lifting the restriction on the uniform distribution of \(\) is a good solution. Hence, we release the \(_{}\)'s restriction to make it belongs to complicated distribution (_e.g._, normal distribution, exponential distribution). Then we can extend \(\) to \(\). However, using WAUC raises another question: how do we get \(_{}\)? We find that \(^{*}(c)\) is one of parameters of \(_{COST}(,c,^{*}(c))\). A natural idea is to use \(_{COST}\) to solve for the optimal \(^{*}(c)\) and to combine the \(^{*}(c)\) solved for at different \(c\) to obtain \(_{}\).

\[^{*}(c)=_{}_{COST}(,,c)=c(1- _{s}())+(1-c)(1-)_{s}(),\] (6)If we couple Eq.(5b) and Eq.(6) together so that \(\) can enjoy the optimal threshold distribution in \(_{COST}\), then we can break the barrier between the ROC curve and the cost space. With the help of the threshold as a bridge, we can extend the \(\) metric to achieve the WAUC cost-sensitive learning. Then we give the problem formulation (intuitively, from the result of 2 (c), (OP0) satisfies both Attr.1 and Attr.2 simultaneously):

\[(OP0)\ \ & =*{}_{^{+}}[_{s }()^{}_{s}()]\\ &^{*}=\{^{*}(c)= _{}_{COST}(,,c)|c_{c}\}\] (7)

Nevertheless, there are still three main challenges in WAUC cost-sensitive learning:

* Given the scoring function \(s\) and negative dataset \(S_{-}\), how to estimate \(^{}_{s}()\) in \(\)?
* The inner problem is nonconvex, which is hard to give a theoretical convergence guarantee.
* How to design a formulation that can bridge \(\) and \(_{COST}\) so that \(\) can be optimized over the cost distribution of the desired problem scenario?

We will address the challenge **(1)** in Sec. 5.1, challenge **(2)** in Sec. 5.2 and challenge **(3)** in Sec. 5.3.

## 5 Methodology

### The Estimation of False Positive Rate

For challenge **(1)**, we choose the kernel density estimation (KDE) to estimate \(^{}_{s}()\) and denote it as \(K(x)\) (please see definition in Sec. C.1). Then we can address the density estimation problem. However, Eq.(5b) still exists non-differentiable and non-smooth term \(_{()}\), which is hard to optimize. Hence, we propose the following smooth and differentiable \(\) estimator to approximate Eq.(5b).

**Definition 5.1**.: Denote \(K(x)\) be statistics kernel with bandwidth \(m\) and \(S^{}_{}=\{s(,_{j}^{-})\}_{j=1}^{n_{-}}\). With Lemma 5.2, we have the approximate estimator and loss function for WAUC:

\[}=_{}^{-}_{s}() (S^{}_{},)p()d,}_{}(,)=}_{l=1}^{n_{}} (,_{l})\] (8)

where \(=\{_{l}\}_{l=1}^{n_{}}\) and the point loss \(\) is defined by

\[(,)=1-n_{-}}_{i=1}^{n_{+}}_{j=1}^{n_{- }}(s(,_{i}^{+})-_{l}) K((s(,_{j}^{-})- _{l})/m)/m.\] (9)

\((x)=1/(1+(- x))\), \(\) is smooth parameter and we have \((x)_{x}\).

**Lemma 5.2**.: _Given a scoring function \(s\), if \(\) is known, when the number of instances is large enough, \(}\) almost surely converges to \(\)._

\[_{n_{-}}|}-|0.\] (10)

With KDE consistency , when the negative sample size is large enough, Lemma 5.2 provides theoretical approximation guarantees for our proposed \(\) estimator in Prop. 5.1.

### The Estimation of Threshold Weighting

For challenge **(2)**, a natural idea is to use \(}_{COST}\) to solve for the optimal threshold set \(^{*}\) when given the cost set \(S_{c}\) and the scoring function \(s\). Then we can use the optimal threshold set \(^{*}\) to calculate \(}\). Firstly, we define the solution for \(}^{*}\) be

\[}^{*}=\{^{*}(c)|^{*}(c)_{ }\ }_{COST}(,c),c S_{c}\}.\] (11)However, it's noticed that the \(_{}\ }_{COST}\) in Eq.(11) is non-convex. As we analyzed before, \(^{*}\) is the inner constraint of \(}\). To the best of our knowledge, there are few studies on optimizing two coupled non-convex problems simultaneously with theoretical convergence guarantees. Most studies on coupled optimization assume that the inner problems have good properties, such as strong convexity. Hence, we propose the approximated convex formulation of the inner problem for \(}^{*}\).

**Theorem 5.3**.: _When we set \(,M\) are large positive numbers and \(M^{ 2}<M^{2}e^{3}}{(e^{}+1)^{6}}\), then we have the approximated convex formulation for \(}_{COST}\)_

\[_{,^{n+},^{n-}} }_{eq}(,,c):=c(1-} _{i=1}^{n_{+}}P_{i})+(1-c)(1-)(}_{j=1}^{n_{ -}}N_{j})\] (12) \[+}_{i=1}^{n_{+}}M^{}(s(, _{i}^{+})-)-P_{i}(s(,_{i}^{+})-))+M(P_{i}-1)+M( -1)\] \[+}_{j=1}^{n_{-}}M^{}(s(, _{j}^{-})-)-N_{j}(s(,_{j}^{-})-))+M(N_{j}-1)\ \ 0,P_{i},N_{j}\]

_where \((x)=(1+( x))/\). \(}_{eq}\) in Eq.(12) is \(_{g}\)-strongly convex w.r.t. \(\). Eq.(12) has same solution as \(_{}}_{COST}\) when the parameters satisfy the conditions of the penalty._

Thm. 5.3 provides an optimization method with good properties. Eq. (12) adopts the penalty function to convert inequality constraints into a part of the objective function. When these inequality constraints are not satisfied, the objective function will increase to infinity. Otherwise, we will get \(P_{i}=[s(,x_{i}^{+})>]\) and \(N_{j}=[s(,x_{j}^{-})>]\), then we will get the same formulation as \(}_{COST}\). When the parameters meet the requirements, Eq.(12) has the same solution as \(}_{COST}\). We give the proof of Thm. 5.3 and the definition \(\) in Sec. C.4. Moreover, we give the analysis of approximation error between \(}_{COST}\) and Thm. 5.3 in Sec. B.7.

### Bilevel Optimization for WAUC learning

After answering questions in challenge **(1)** and **(2)**, we have solved most of the problems in WAUC cost-sensitive learning. However, there remains a challenge **(3)** in optimization: How do we design learning paradigms to solve the coupled optimization problem of \(\) and \(_{COST}\)? In recent years, bilevel optimization has achieved remarkable success. This approach can combine two related optimization problems to form a coupled optimization formulation. Hence, with Prop. 5.1 and Thm.5.3, we propose a bilevel paradigm to formulate this coupled optimization problem.

\[(OP1)\ \ &_{}\ ():=(,^{*}):=}_{}(,}^{*})\\ &}^{*}= {arg\,min}_{,_{a},_{a}}(,):=}_{l=1}^{n_{}}}_{eq}(,_{l},c_ {l}),\] (13)

where \(_{a}^{n_{} n_{+}}\) and \(_{a}^{n_{} n_{-}}(OP1)\) describes a bilevel optimization formulation for WAUC cost-sensitive learning, where the inner-level provides a threshold optimization process, and the outer-level minimizes the WAUC loss over the optimal threshold distribution. Moreover, this formulation is consistent with the mainstream bilevel optimization problem (outer-level is smooth and non-convex, inner-level is convex and smooth), which enjoys a faster convergence rate.

## 6 Optimization Algorithm

In this section, we focus on optimizing \((OP1)\) in an end-to-end manner. Hence, we propose a stochastic algorithm for WAUC cost-sensitive learning shown in Alg. 1, which is referred to SAACL.

### Main Idea of SAACL

We provide some intuitive explanations of our algorithm. At each iteration \(k\), SACCL alternates between the inner-level gradient update on \(\) and the outer-level gradient update on \(\). Duringiteration \(k\), we update \(_{k,t}\) with standard SGD \(T\) steps to ensure that \(_{k+1}\) is as optimal as possible. After updating inner-level variables, we perform outer-level optimization with \(_{k+1}\) as the parameter to update \(_{k}\). Notice that \(T\) will not take a large value to ensure the validity of the coupling update of \(\) and \(\). Let \(_{k}\) and \(_{k}\) be stepsizes of \(\) and \(\) that have the same decrease rate as SGD. We denote \(n\) be the number of elements in deep neural network parameters \(\).

### Convergence Analysis of SAACL

In this subsection, we present the convergence analysis for SAACL. We give some Lipschitz continuity assumptions that are common in bilevel optimization problems [11; 28].

**Assumption 6.1**.: **(Lipschitz continuity)** Assume that \(f\), \( f\), and \( g\) are respectively \(L_{f,0}\),\(L_{f,1}\), \(L_{g,1}\)-Lipschitz continuous.

**Assumption 6.2**.: **(Bounded stochastic derivatives)** The variance of stochastic derivatives \( f(,;)\) and \( g(,;)\) are bounded by \(_{f,1}^{2}\), \(_{g,1}^{2}\), respectively.

Based on Assumption 6.1 and Assumption 6.2, following , Thm. 6.3 indicates that we can optimize \((OP1)\) with the same convergence rate as the traditional SGD algorithm.

**Theorem 6.3**.: _Suppose Assumption 6.1 and 6.2 hold. We define_

\[_{1}=+4L_{f}L_{y}+2L_{f}L_{yx}/(L_{y} )},_{2}=}{(+L_{g,1})^{2}(8L_{f}L_{ y}+2 L_{yx}_{f}^{2}_{1})},\] (14)

_where \(=L_{F}/L_{y}\), \(L_{F}\), \(L_{f}\), \(L_{y}\) and \(_{f}^{2}\) come from Lem. 2 and Lem. 4 in . We select the following stepsize as_

\[_{k}=\{_{1},_{2},}\}_{k}=L_{y}+2 L_{yx}_{f}^{ 2}_{1}}{4T}_{k}\] (15)

_For any \(T 1\), the iteration sequence \(\{_{k}\}_{k=1}^{K}\) and \(\{_{k}\}_{k=1}^{K}\) generated by Algorithm 1 satisfy_

\[_{k=0}^{K-1}[|| F(_{k})|| ^{2}](/(^{} +1)^{2}+L_{g,1}}{24M^{}/(^{}+1)^{2}L_{g,1}} )^{2}}+O(}).\] (16)

_where \(=2_{g,1}^{2}}{L_{y}}(1+5L_{f}L_{y}_{1}+_{f}^{2}}{4}_{1}^{2}) (8L_{f}L_{y}+2 L_{yx}_{f}^{2}_{1})^{2}\)_

_Remark 6.4_.: When \(\) and \(M\) are large enough positive integers, according to Eq. (16), Alg. 1 is still guaranteed to find a \(\)-stationary point within \(O(^{-4})\) iterations (\(\) is error tolerance).

## 7 Experiments

In this section, we conduct a series of experiments for WAUC cost-sensitive learning on common long-tail benchmark datasets. Due to space limitations, please refer to Sec. B for the details of our experiments. The source code is available in supplemental materials.

### Dataset Details

We use three datasets: **Binary CIFAR-10-Long-Tail Dataset**, **Binary CIFAR-100-Long-Tail Dataset**, and **Jane Street Market Prediction**. Binary CIFAR-10-Long-Tail Dataset and Binary CIFAR-100-Long-Tail Dataset are common datasets in long-tail learning, and we construct their cost distributions. Jane Street Market Prediction is data from real cost-sensitive learning application scenarios. For all datasets, we divide them into the training set, validation set, and test set with a proportion 0.7:0.15:0.15. All image data is normalized to ensure a more stable training process.

### Overall Performance

In Tab. 2 and Tab. 3, we collect all the methods' performance on test sets of three types of datasets. For cost distribution of \(c\), we sample some data from a normal distribution \((0.5,1)\) to construct a dataset \(S_{c}\) (we clip all data to \(\)). We also conduct numerous experiments for other types of distribution of \(c\), and please see Appendix B for the details. From the results, we make the following observations:

(1) For \(}\) and \(}_{COST}\) metric, Our proposed algorithm achieves superior performance in most benchmark datasets compared to other methods. This demonstrates that our proposed WAUC cost-sensitive learning can extend the ROC curve into the cost space. Models trained with our proposed bilevel optimization formulation can enjoy high WAUC and cost-related metrics.

(2) AUC and cost-related metrics are inconsistent. From the high-performing heatmap of Tab. 2, it can be noticed that \(}_{COST}\) and \(}\) have two completely different highlight regions. This indicates that the assumption of uniform distribution of AUC does not match the realistic scenario.

(3) We also find that AUC-related and traditional classification algorithms do not perform well in cost-sensitive problems. This means that if we first train the model with the classification algorithm, subsequently using the cost function to solve for the optimal threshold for decision does not work well. Meanwhile, the algorithm that can learn from scratch has better scalability. Two-stage decision method Therefore, designing one-stage algorithms for WAUC cost-sensitive learning is necessary.

    &  &  &  &  &  & }\)} \\  & & & \(}\) & \(}_{COST}\) & \(}\) & \(}_{COST}\) & \(}\) & \(}_{COST}\) & Subset1 & Subset2 & Subset3 \\   &  & BCE & 0.525 & 0.027 & 0.533 & 0.015 & 0.318 & 0.029 & 0.822 & 0.960 & **0.870** \\  & & EAUC & 0.516 & 0.029 & 0.518 & 0.013 & 0.366 & 0.028 & **0.845** & **0.954** & 0.858 \\  & & SAUC & 0.407 & 0.028 & 0.548 & 0.012 & 0.327 & 0.031 & 0.811 & 0.933 & 0.867 \\  & & WNAUC & 0.565 & 0.030 & 0.574 & 0.017 & 0.396 & 0.027 & 0.786 & 0.855 & 0.827 \\  & & PAUC-cep & 0.549 & 0.029 & 0.508 & 0.015 & 0.354 & 0.028 & 0.650 & 0.801 & 0.736 \\  & & PAUC-cep & 0.526 & 0.028 & 0.470 & 0.015 & 0.354 & 0.029 & 0.664 & 0.812 & 0.742 \\  & & PAUC & 0.516 & 0.027 & 0.520 & 0.510 & 0.382 & 0.028 & 0.704 & 0.847 & 0.734 \\  & & CS-shape & 0.566 & 0.026 & 0.026 & 0.833 & **0.018** & 0.377 & 0.002 & 0.657 & 0.782 & 0.762 \\  & & ALCOS & 0.576 & 0.025 & 0.539 & 0.014 & 0.391 & 0.023 & 0.758 & 0.873 & 0.742 \\  & & ECL & 0.589 & 0.026 & 0.561 & 0.014 & 0.388 & 0.020 & 0.694 & 0.918 & 0.762 \\   & & WAUC-cep & **0.479** & 0.024 & 0.650 & 0.012 & 0.457 & 0.015 & 0.787 & 0.934 & 0.843 \\  & & WAUC-cep & 0.653 & **0.023** & **0.047** & 0.011 & **0.468** & **0.014** & 0.820 & 0.958 & 0.869 \\   &  & BCE & 0.556 & 0.022 & 0.463 & 0.012 & 0.512 & 0.019 & 0.912 & 0.957 & 0.806 \\  & & EAUC & 0.522 & 0.019 & 0.502 & 0.011 & 0.506 & 0.017 & 0.933 & 0.967 & 0.833 \\  & & SAUC & 0.483 & 0.024 & 0.367 & 0.015 & 0.474 & 0.018 & 0.839 & 0.955 & 0.855 \\  & & WNAUC & 0.654 & 0.025 & 0.511 & 0.016 & 0.631 & 0.019 & 0.867 & 0.925 & 0.807 \\  & & PAUC-cep & 0.464 & 0.020 & 0.282 & 0.014 & 0.469 & 0.016 & 0.826 & 0.811 & 0.787 \\  & & PAUC-cep & 0.461 & 0.022 & 0.262 & 0.017 & 0.473 & 0.017 & 0.828 & 0.857 & 0.791 \\  & & PAUC-cep & 0.549 & 0.018 & 0.439 & 0.016 & 0.514 & 0.018 & 0.812 & 0.843 & 0.8022 \\  & & CS-shape & 0.523 & 0.017 & 0.457 & 0.010 & 0.515 & 0.018 & 0.744 & 0.910 & 0.716 \\  & & ALCOS & 0.5900 & 0.018 & 0.474 & 0.011 & 0.557 & 0.016 & 0.769 & 0.919 & 0.727 \\  & & ECL & 0.583 & 0.017 & 0.497 & 0.009 & 0.595 & 0.015 & 0.863 & 0.939 & 0.794 \\   & & WAUC-cep & 0.746 & 0.015 & **0.589** & 0.005 & 0.728 & 0.013 & 0.842 & 0.928 & 0.745 \\   & & WAUC-cep & 0.719 & **0.012** & 0.560 & **0.003** & **0.745** & **0.010** & 0.306 & 0.960 & **0.875** \\   

Table 2: Performance comparisons on benchmark datasets with different metrics. The first and second best results are highlighted with **bold text** and underline, respectively.

   Methods & ROC & EAUC & SAUC & WAUC & PAUC-cep & PAUC-cep & PAUC-cep & PAUC-cep & PAUC-cep & PAUC-cep & PAUC-cep & PAUC-cep & PAUC-cep & PAUC-cep & PAUC-cep & PAUC-cep \\  WAUC & 0.547 & 0.599 & 0.546 & 0.569 & 0.565 & 0.565 & 0.565 & 0.565 & 0.565 & 0.565 & 0.565 & 0.565 & 0.565 & 0.565 \\ ZAUC & 0.523 & 0.464 & 0.396 & 0.565 & 0.565 & 0.565 & 0.565 & 0.565 & 0.565 & 0.565 & 0.565 & 0.565 & 0.565 & 0.565 \\ ZAUC & 0.535 & 0.564 & **0.569** & 0.565 & 0.

### Sensitivity Analysis

In this subsection, we show the sensitivity of \(\), \(T\), and bandwidth on test data.

**Effect of \(\).** In Fig. 3 (a) and (d), we observe that for both WAUC and cost metrics, when \(\) closes to 7, the model will have the largest performance improvement and the lowest variance. This can be explained in two ways: (1) When the \(\) is too small, the error between the \((x)\) and the 0-1 loss function is large, resulting in a large approximation error between the \(}\) and the \(\). (2) When the \(\) is too large, the gradient also tends to be 0. Therefore, choosing a beta value that trades off the approximation error and the gradient is essential.

**Effect of \(T\).** As we mentioned in the Section 6.1, choosing a smaller \(T\) can effectively improve the performance of the model. However, as shown in Fig. 3(e), a larger \(T\) value can reduce the variance. Hence, as set in our experiments, \(T=3\) is a good choice to ensure the average performance and variance of the model.

**Effect of \(m\).** From Fig. 3(c), we find that the kernel's bandwidth strongly influences the model's performance. The model's bandwidth and performance are almost proportional; the closer the bandwidth is to [0.4, 0.5], the better the effect; otherwise, the effect is worse. This indicates that our proposed method is sensitive to the bandwidth parameter, which also compounds the bandwidth characteristics in the KDE method.

## 8 Conclusion

This paper focuses on extending the traditional AUC metric to associate with misclassification costs. Restricted by the assumption of cost distribution, existing settings could not describe the model's performance in the complicated cost-sensitive scenario. To address this problem, we propose a novel setting that treats the cost as sampled data. We employ the WAUC metric and propose a novel estimator to approximate it. With the help of threshold weighting, we establish the correspondence between WAUC and the cost function. To describe this connection, we present a bilevel optimization formulation to couple them, where the inner-level problem provides a threshold optimization process, and the outer-level minimizes the WAUC loss based on the inner thresholds. This paradigm ensures that the WAUC can always be optimized at the optimal threshold value based on the complicated cost distribution in reality. Moreover, we propose a stochastic algorithm to optimize this formulation. We prove that our algorithm enjoys the same convergence rate as standard SGD. Finally, numerous

Figure 3: Sensitivity analysis on test data where WAUC and cost for WAUC-Gau with respect to \(\), \(T\), and bandwidth. The other two variables are fixed for each box in the plots, and the scattered points along the box show the variation.

experiments have shown that our method can extend AUC to cost-sensitive scenarios with significant performance.