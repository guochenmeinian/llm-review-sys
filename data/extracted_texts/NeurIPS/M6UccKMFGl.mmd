# Multiply Robust Federated Estimation of Targeted Average Treatment Effects

Larry Han

Department of Health Sciences

Northeastern University

Boston, MA 02115

lar.han@northeastern.edu

&Zhu Shen

Department of Biostatistics

Harvard University

Boston, MA 02115

zhushen@g.harvard.edu

&Jose R. Zubizarreta

Departments of Health Care Policy, Biostatistics, and Statistics

Harvard University

Boston, MA 02115

zubizarreta@hcp.med.harvard.edu

###### Abstract

Federated or multi-site studies have distinct advantages over single-site studies, including increased generalizability, the ability to study underrepresented populations, and the opportunity to study rare exposures and outcomes. However, these studies are complicated by the need to preserve the privacy of each individual's data, heterogeneity in their covariate distributions, and different data structures between sites. We propose a novel federated approach to derive valid causal inferences for a target population using multi-site data. We adjust for covariate shift and accommodate covariate mismatch between sites by developing a multiply-robust and privacy-preserving nuisance function estimation approach. Our methodology incorporates transfer learning to estimate ensemble weights to combine information from source sites. We show that these learned weights are efficient and optimal under different scenarios. We showcase the finite sample advantages of our approach in terms of efficiency and robustness compared to existing state-of-the-art approaches. We apply our approach to study the treatment effect of percutaneous coronary intervention (PCI) on the duration of hospitalization for patients experiencing acute myocardial infarction (AMI) with data from the Centers for Medicare & Medicaid Services (CMS).

## 1 Introduction

Compared to single-site studies, federated or multi-site studies confer distinct advantages, such as the potential for increased generalizability of findings, the opportunity to learn about underrepresented populations, and the ability to study rare exposures and outcomes. However, deriving valid causal inferences using multi-site data is difficult due to numerous real-world challenges, including heterogeneity of site populations, different data structures, and privacy-preserving constraints stemming from policies such as the General Data Protection Regulation (GDPR) and Health Insurance Portability and Accountability Act (HIPAA) that prohibit direct data pooling.

Recent methodological developments have focused on privacy-preserving estimation strategies. These strategies typically involve sharing summary-level information from multiple data sources [28; 29; 13; 14; 20]. However, they often require restrictive assumptions such as homogeneous datastructures and model specifications (e.g., a common set of observed covariates measured using a common data model), which are not realistic in practice.

To address these methodological gaps, we propose a multiply robust and privacy-preserving estimator that leverages multi-site information to estimate causal effects in a target population of interest. Compared to existing approaches, our method allows investigators from different sites to incorporate site-specific covariate information and domain knowledge and provides increased protection against model misspecification. Our method allows for flexible identification under different settings, including systematically missing covariates and different site-specific covariates (termed covariate mismatch). Our proposed method adopts an adaptive ensembling approach that optimally combines estimates from source sites and serves as a data-driven metric for the transportability of source sites. Moreover, the proposed method relaxes the assumption of homogeneous model specifications by adopting a class of multiply robust estimators for estimating the nuisance functions.

### Related Work and Contributions

The current literature on multi-site causal inference typically assumes that a common set of confounders is observed in all sites [8; 7; 13; 14]. However, this assumption is rarely met due to variations in local practices, e.g., differing data collection standards and coding practices. In particular, the target site often lacks data on certain covariates available in the source sites, and ignoring them can result in biased and inefficient inference . Recently,  proposed a method to address covariate mismatch by integrating source samples with unmeasured confounders and a target sample containing information about these confounders. However, they assumed that the target and source samples are obtained from the same population.  extended the method of  to the setting where the average treatment effect (ATE) is not identifiable in some sites by constructing control variates. However, their approach is focused on addressing selection biases where preferential selection of units solely depends on the binary outcome, and it is not obvious how one could extend the method to other settings.  extended the framework by [8; 7] to handle covariate mismatch by regressing predicted conditional outcomes on effect modifiers and then taking the means of these regression models evaluated on target site samples. Our work leverages ideas from  to a more general multi-site federated data setting by utilizing an adaptive weighting approach that optimally combines estimates from source sites.

Most existing approaches in the generalizability and transportability literature deal with heterogeneous covariate distributions by modeling the site selection processes [6; 2; 27; 8; 7]. These approaches, which incorporate inverse probability of selection weights [6; 2], stratification , and augmentation [8; 7], involve pooling individual-level information across sites. Our work differs from those in that we preserve individual data privacy, sharing only summary-level information from the target site. Specifically, we adopt density ratio models [24; 9] that only share covariate moments of the target samples. Under certain specifications, these density ratio models are equivalent to logistic regression-based selection models for adjusting heterogeneity between target and source populations. Our approach shares similarities with calibration weighting methods but leverages semi-parametric efficiency theory to enable a closed-form approximation of the variance.

Further, when data sources are heterogeneous, it would be beneficial for investigators at different sites to incorporate site-specific knowledge when specifying candidate models. However, to the best of our knowledge, existing methods require common models to be specified across sites, which may not be realistic or flexible enough [28; 29; 13; 14; 20]. In contrast, this paper takes a different stance; we accommodate variations in outcome and treatment models across sites using a multiply robust estimator, instead of imposing a uniform model. Our work builds on , which established an equivalence between doubly robust and multiply robust estimators using mixing weights determined by predictive risks of candidate models [17; 15; 16; 3; 4; 5]. We take advantage of this equivalent form to obtain closed-form expressions for the variance of our federated global estimator. Compared to , where they consider a single source site and a single target site, we are able to consider multiple source sites and multiple target sites. To prevent the negative transfer, we combine the estimates from multiple sites via a data-adaptive ensembling approach first proposed in .

Preliminaries

We consider data from \(K\) sites, where each site has access to its individual-level data but is prohibited from sharing this data with any other site. The set of sites will be denoted by \(=\{1,2,...,K\}\). We index the target site with \(T\) and the source sites as the remaining sites, i.e., \(= T\).

For each individual \(i\), let \(Y_{i}\) denote an observed outcome, which can be continuous or discrete. \(X_{i}^{p}\) represents the \(p\)-dimensional baseline covariates in source site \(k\). \(V_{i}^{q}\) represents the (partial) baseline covariates in the target site \(T\) such that \(V_{i} X_{i}\). To simplify the presentation, we assume an identical set of covariates across all source sites, although our method can accommodate scenarios where distinct covariate sets are present among the source sites. Let \(A_{i}\) represent a binary treatment indicator, with \(A_{i}=1\) denoting treatment and \(A_{i}=0\) denoting control. \(R_{i}\) is a site indicator with \(R_{i}=k\) if patient \(i\) is from the site \(k\). We observe \(n_{T}\) target observations, \(D_{T}=\{Y_{i},V_{i},A_{i},R_{i}=T,1 i n_{T}\}\) and \(n_{k}\) source observations, \(D_{k}=\{Y_{i},X_{i},A_{i},R_{i}=k,1 i n_{k}\}\) for each \(k\). The total sample size is \(N=_{k}n_{k}\). Under the potential outcomes framework [23; 25], we denote the counterfactual outcomes under treatment and control as \(\{Y_{i}(1),Y_{i}(0)\}\), and only one of them is observed: \(Y_{i}=A_{i}Y_{i}(1)+(1-A_{i})Y_{i}(0)\). The data structure is illustrated in Figure 1.

Our goal is to estimate the target average treatment effect (TATE),

\[_{T}=_{1,T}-_{0,T}_{a,T}=E\{Y_{i}(a)  R_{i}=T\}a\{0,1\},\] (1)

where \(_{a,T}\) is the mean potential outcome under treatment \(a\) in the target population. To identify this quantity, we consider the following assumptions:

* (Consistency): For every individual \(i\), if \(A_{i}=a\), then \(Y_{i}=Y_{i}(a)\).
* (Mean exchangeability over treatment assignment in the target population): \(E\{Y_{i}(a) V_{i}=v,A_{i},R_{i}=T\}=E\{Y_{i}(a) V_{i}=v,R_{i}=T\}\).
* (Positivity of treatment assignment in the target population): \(0<P(A_{i}=1 V_{i}=v,R_{i}=T)<1\) for any \(v\) s.t. \(P(V_{i}=v R_{i}=T)>0\).
* (Mean exchangeability over treatment assignment in the source populations): \(E\{Y_{i}(a) X_{i}=x,A_{i},R_{i}=k\}=E\{Y_{i}(a) X_{i}=x,R_{i}=k\}\), \(k\).
* (Positivity of treatment assignment in the source populations): \(0<P(A_{i}=1 X_{i}=x,R_{i}=k)<1\) for any \(x\) s.t. \(P(X_{i}=x R_{i}=k)>0\), \(k\).
* (Mean exchangeability over site selection): \(E\{Y_{i}(a) V_{i}=v,R_{i}=k\}=E\{Y_{i}(a) V_{i}=v\}\), \(k\).
* (Positivity of site selection): \(0<P(R_{i}=k V_{i}=v)<1\) for \(k\) and any \(v\) s.t. \(P(V_{i}=v)>0\).

Assumption (A1) is the stable unit treatment value assumption (SUTVA), requiring no interference between individuals. Assumption (A2) (Assumption (A4)) states that the mean counterfactual outcome under treatment \(a\) is independent of treatment assignment, conditional on baseline covariates in the target (source) populations. For Assumption (A2) and (A4) to hold, we require all effect modifiers to be measured in \(V\). Assumption (A3) (Assumption (A5)) states that each individual in the

Figure 1: Schematic of the data structure in the multi-site setting.

target (source) populations has a positive probability of receiving each treatment. Assumption (A6) states that the mean counterfactual outcome is independent of site selection, conditional on covariates in the target population. For Assumption (A6) to hold, we require all covariates that are distributed differently between target and source populations (shifted covariates) to be measured in \(V\). Thus, if these effect modifiers are measured in \(V\), Assumption (A2), (A4) and (A6) automatically hold. Assumption (A7) requires that in each stratum defined by \(V\), the probability of being in a source population for each individual is positive. Theorem 1 shows that under Assumption (A1), (A4) - (A7), the mean counterfactual outcome for the target can be identified in the sources.

**Theorem 1**.: _If Assumptions (A1) - (A3) hold, the mean counterfactual outcomes in the target population can be identified using the target sample._

\[_{a,T}=E\{Y_{i}(a) R_{i}=T\}=E\{E\{Y_{i} V_{i}= v,A_{i}=a,R_{i}=T\} R_{i}=T\}.\] (2)

_If Assumptions (A1), (A4) - (A7) hold, the mean counterfactual outcomes in the target population can be identified using the source samples._

\[_{a,T} =E\{Y_{i}(a) R_{i}=T\}\] \[=E\{E\{E\{Y_{i} X_{i}=x,A_{i}=a,R_{i}=k\}  V_{i}=v,R_{i}=k\} R_{i}=T\}.\] (3)

## 3 Site-specific Estimation

For the target site \(k=\{T\}\), a standard augmented inverse propensity weighted (AIPW) estimator is used for \(_{a,T}\) as follows

\[_{a,T}=}_{i=1}^{n}=a,R_{i }=T)}{_{a,T}(V_{i})}Y_{i}-_{a,T}(V_{i}) }+_{a,T}(V_{i}),\] (4)

where \(_{a,T}(V_{i})\) is an estimator for \(E\{Y_{i} V_{i}=v,A_{i}=a,R_{i}=T\}\), the outcome model in the target population, and \(_{a,T}(V_{i})\) is an estimator for \(P(A_{i}=1 V_{i}=v,R_{i}=T)\), the probability of receiving treatment \(a\) in the target population.

For each source site \(k\), we propose an estimator for \(_{a,T}\) as follows

\[_{a,k}= }_{i=1}^{n}=a,R_{i}=k)}{ _{a,k}(X_{i})}_{k}(V_{i})Y_{i}-_{a,k}(X_{i})}\] \[+ }_{i=1}^{n}I(R_{i}=k)_{ k}(V_{i})_{a,k}(X_{i})-_{a,k}(V_{i}) }+}_{i=1}^{n}I(R_{i}=T)_{a,k}( V_{i}),\] (5)

where \(_{a,k}(V_{i})\) is an estimator for \(E\{m_{a,k}(x) V_{i}=v,R_{i}=k\}\) and \(_{a,k}(X_{i})\) is an estimator for \(E\{Y_{i} X_{i}=x,A_{i}=a,R_{i}=k\}\). \(_{k}(V_{i})\) estimates \(f(V_{i} R_{i}=T)/f(V_{i} R_{i}=k)\), the density ratios of covariate distributions in the target population \(T\) and source population \(k\). \(_{a,k}(X_{i})\) estimates \(P(A_{i}=1 X_{i}=x,R_{i}=k)\), the probability of receiving treatment \(a\) in source \(k\). The estimators (4) and (5) are derived leveraging semi-nonparametric theory. They can be seen as a functional Taylor expansion of the target functional \(_{a,T}\). This method is commonly used in causal inference to correct for the bias of the plug-in estimators. These resulting estimators exhibit favorable statistical properties, even when slow-converging non-parametric techniques are used for nuisance estimation. For a more comprehensive discussion, interested readers can refer to  and .

Compared to the transportation estimators in , we introduce two additional nuisance functions, \(_{k}(V_{i})\) and \(_{a,k}(V_{i})\). Specifically, \(_{k}(V_{i})\) accounts for covariate shift across sites while preserving individual's data privacy, while \(_{a,k}(V_{i})\) is introduced to address covariate mismatch across sites. We provide estimation procedures for these nuisance functions in the following subsections, and the theoretical guarantees of the estimator are presented in Section 5.

### Density Ratio Weighting

Most existing methods adjust for covariate shift across sites by relying on inverse probability of selection weighting, which requires pooling target and source samples. However, such pooling is often not possible due to data privacy regulations. We consider a density ratio weighting approach, which offers equivalent estimation without the need for direct data pooling (see Appendix A).

Formally, as in , we model the density ratios of covariate distributions in the target \(T\) and source \(k\) by specifying an exponential tilt model [24; 9]; \(_{k}(V_{i};_{k})=f(V_{i} R_{i}=T)/f(V_{i} R_{i}=k)=\{ -_{k}^{}(V_{i})\}\) where \(f(V_{i} R_{i}=T)\) and \(f(V_{i} R_{i}=k)\) are density functions of covariates \(V_{i}\) in the target \(T\) and source \(k\), respectively, and \((V_{i})\) is some \(d\)-dimensional basis with \(1\) as its first element. With this formulation, \(_{k}(V_{i};_{k})=1\) for \(_{k}=0\) and \(_{k}(V_{i};_{k})f(V_{i} R_{i}=k)dx=1\). If we choose \((V_{i})=V_{i}\), we can recover the entire class of natural exponential family distributions. If we include higher-order terms, the exponential tilt model has greater flexibility in characterizing the heterogeneity between two populations . We solve for \(_{k}\) with the following estimating equation

\[}_{i=1}^{N}I(R_{i}=T)(V_{i})= {1}{n_{k}}_{i=1}^{N}I(R_{i}=k)(V_{i})\{ -_{k}^{}(V_{i})\}.\] (6)

This procedure preserves individual privacy; choosing \((V_{i})=V_{i}\), the target site only needs to share its covariate means with the source sites; each source site then solves (6) with its own data to obtain the density ratios.

### Multiply Robust Estimation

We relax the assumption of homogeneous model specifications across sites and allow each site to propose multiple models for nuisance functions. Our proposal follows the construction of multiply robust estimators for nuisance functions via a model-mixing approach .

Formally, for each site \(k\), we consider a set of \(J\) candidate treatment models for the propensity scores \(\{_{a,k}^{j}(x):j=\{1,...,J\}\}\). Let \(_{a,k}^{j}(x)\) be the estimator of \(_{a,k}^{j}(x)\) obtained by fitting the corresponding candidate models on the data, which can be parametric, semiparametric, or nonparametric machine learning models. \(_{a,k}(X_{i})=_{j=1}^{J}_{j}_ {a,k}^{j}(X_{i})\) denotes the weighted predictions of propensity scores, with weights \(_{j}\) assigned to predictions by each candidate model \(j\). To calculate the weights \(_{j}\), we adapt a model-mixing algorithm developed in  and  based on the cumulative predictive risks of candidate models.

First, we randomly partition the data within each site into a training set \(D_{k}^{}\) of units indexed by \(\{1,...,n_{k}^{}\}\) and a validation set \(D_{k}^{}\) of units indexed by \(\{n_{k}^{}+1,...,n_{k}\}\). Then, each candidate treatment model is fit on \(D_{k}^{}\) to obtain \(_{a,n_{k}^{}}^{j}\) for \(j\). The model-mixing weights are determined by the models' predictive risks assessed on \(D_{k}^{}\) according to the Bernoulli likelihood. Specifically,

\[_{j}=(n_{k}-n_{k}^{})^{-1}_{i=n_{ k}^{}+1}^{n_{k}}_{j,i}\] \[_{j,i}=^{}+1}^{i-1 }_{a,n_{k}^{}}^{j}(X_{q})^{A_{q}}\{ 1-_{a,n_{k}^{}}^{j}(X_{q})\}^{1-A_ {q}}}{_{j^{}=1}^{J}_{q=n_{k}^{}+1}^{i-1}_{a,n_{k}^{}}^{j^{}}(X_{q})^{A_{q}}\{1- _{a,n_{k}^{}}^{j^{}}(X_{q})\}^ {1-A_{q}}} n_{k}^{}+2 i n_{k},\] (7)

where \(_{j,n_{k}^{}+1}=1/J\). The model-mixing estimators are consistent if one of the \(j\) candidate models is correctly specified . A similar strategy can be used for conditional outcomes \(m_{a,k}(X_{i})\) by combining a set of \(L\) candidate outcome models \(\{m_{a,k}^{l}(x):l=\{1,...,L\}\}\). We obtain \(_{a,k}(X_{i})=_{l=1}^{L}_{l}_{a,k}^ {l}(X_{i})\) as the predicted outcomes with weights \(_{l}\) of candidate outcomes models under treatment \(a\) in site \(k\). Further details are provided in Appendix B.

### Covariate Mismatch

To account for covariate mismatch, we adapt the approach in , introducing the nuisance function \(_{a,k}(V_{i})=E\{m_{a,k}(x) V_{i}=v,R_{i}=k\}\), where \(m_{a,k}(x)\) is the outcome regression for treatment in site \(k\). First, we estimate \(m_{a,k}(X_{i})\) by regressing the outcome \(Y_{i}\) on covariates \(X_{i}\) among units receiving treatment \(a\) in site \(k\). We then regress \(_{a,k}(X_{i})\), the estimates from the previous step, on \(V_{i}\) in the source site \(k\) to obtain \(_{a,k}(x)\). By doing so, we project all site-specific estimates of conditional outcomes to a common hyperplane defined by \(V_{i}\). If all effect modifiers that are distributed differently between target and source populations are measured in \(V_{i}\), then the information contained in the projected site-specific estimates can be transported to the target site. Finally, we take the mean of \(_{a,k}(x)\) over the target sample, which gives us the transported estimate \(_{a,k}(V_{i})\) for the mean counterfactual outcomes under treatment \(a\) in the target population.

## 4 Federated Estimation

Let \(_{a,T}\) denote the estimate of \(_{a,T}\) based on target data only and \(_{a,k}\) be the estimates of \(_{a,T}\) using source data \(k\). We propose a general form of the federated global estimator as follows

\[_{a,G}=_{a,T}+_{k} _{k}\{_{a,k}-_{a,T}\},\] (8)

where \(_{k} 0\) is a non-negative weight assigned to site-specific estimates and \(_{k}_{k}=1\). The role of \(_{k}\) is to determine the ensemble weight given to the site-specific estimates. We can employ diverse weighting methods by selecting appropriate values of \(_{k}\). For example, if \(_{k}=0\), the global estimator is simply the estimator based on target data only; if \(_{k}=n_{k}/N\), the global estimator combines site-specific estimates by their sample sizes; if \(_{k}=(1/_{k}^{2})/_{j}(1/_{j}^{2})\) where \(_{k}^{2}=(_{a,k})\), the global estimator is the inverse variance weighting estimator, which is known to be appropriate when working models are homogeneous across sites .

In transportability studies, preventing negative transfer is critical when there are multiple, potentially biased source sites. If source sites are biased, both the sample size-weighted estimator and the variance-weighted estimator would inherit this bias. By examining the MSE of the data-adaptive estimator to the limiting estimand of the target estimator, the MSE can be decomposed into a variance term that can be minimized by regression of influence functions obtained from the asymptotic linear expansion of the target and source estimates, and an asymptotic bias term. This allows us to rewrite the problem of solving for ensemble weights as an adaptive LASSO problem [13; 14] as follows:

\[_{k,L_{1}}=_{_{k} 0}_{i=1}^{N} [_{T,i}(a)-_{k}_{k}(_{T,i}(a)-_{k,i}(a)-_{k})]^{2}+ _{k}|_{k}|_{k}^{2},\] (9)

where \(_{k,L_{1}}\) denotes the data-adaptive weights; \(_{T,i}(a)\) and \(_{k,i}(a)\) are the estimated influence functions for the target and source site estimators (see Appendix E.3 for the exact form of the influence functions). The estimated difference \(_{k}=_{a,k}-_{a,T}\) quantifies the bias between the estimate from source \(k\) and the estimate from the target \(T\). The tuning parameter \(\) determines the penalty imposed on source site estimates and in practice, is chosen via cross-validation. Specifically, we create a grid of values of \(\) and iteratively train and evaluate the model using different \(\) values, selecting the one with the lowest average validation error after multiple sample splits.

We estimate the variance of \(_{a,G}\) using the estimated influence functions for \(_{a,T}\) and \(_{a,k}\). By the central limit theorem, \((_{a,G}-_{a,G})(0,)\), where \(=E\{_{k}_{k}_{k,i}(a)\}^{2}\) and \(_{a,G}\) and \(_{k}\) denote the limiting values of \(_{a,G}\) and \(_{k}\) respectively. The standard error of \(_{a,G}\) is estimated as \(/N}\) where \(=N^{-1}_{k}_{i=1}^{n_{k}}\{_{k}_{k,i}(a)\}^{2}\). A two-sided \((1-)\)100% confidence interval for \(_{a,G}\) is

\[}_{}=[_{a,G}-/N}_{/2},_{a,G}+/N}_{/2}],\] (10)

where \(_{/2}\) is the \(1-/2\) quantile for a standard normal distribution.

## 5 Theoretical Guarantees

In this section, we first establish the theoretical properties of the site-specific estimators constructed with the multiply robust model-mixing approach. Define \(_{a,k}^{j}\), \(_{a,k}^{l}\), \(_{a,k}\) and \(_{k}\) as non-stochasticfunctionals that the corresponding estimators \(^{j}_{a,k}\), \(^{l}_{a,k}\), \(_{a,k}\) and \(_{k}\) converge to for \(k\)1. That is,

\[\|^{j}_{a,k}-^{j}_{a,k}\|=o_{p}(1),\| {}^{l}_{a,k}-^{l}_{a,k}\|=o_{p}(1),\|_{ a,k}-_{a,k}\|=o_{p}(1),\|_{k}-_{k}\|=o_{p}(1).\]

As shown in Lemmas E.1 and E.2 in Appendix E.2, the \(L_{2}\) risks of the model-mixing estimators \(_{a,k}\) and \(_{a,k}\) are bounded by the smallest risks of all candidate models plus a remainder term that vanishes at a faster rate than the risks themselves. Leveraging Lemmas E.1 and E.2, we show the consistency and asymptotic normality of the site-specific estimators in Theorem 2. The proofs are given in the Appendix E.4.

**Theorem 2**.: _Suppose that the conditions in Lemmas E.1 and E.2 hold, and for \(k\) that \(^{j}_{a,k}\), \(^{l}_{a,k}\), \(_{k}\), \(_{a,k}\), \(^{j}_{a,k}\), \(^{l}_{a,k}\), \(_{k}\) and \(_{a,k}\) are uniformly bounded for all treatment models \(j\) and for all outcome models \(l\). Consider the following conditions:_

1. \(^{j}_{a,k}=_{a,k}\) _for some_ \(j\)_,_
2. \(^{l}_{a,k}=m_{a,k}\) _for some_ \(l\)_,_
3. \(_{k}=_{k}\)_,_
4. \(_{a,k}=_{a,k}\)_._

_Then, under Assumptions (A1) - (A7), and if one of (B1) or (B2) and one of (C1) or (C2) hold,_

\[\|_{a,k}-_{a,T}\|=O_{p}(n^{-1/2}+\|_{a,k}- _{a,k}\|\|_{a,k}-m_{a,k}\|+\|_{k}-_{k}\|\| _{a,k}-_{a,k}\|).\] (11)

_Further, if the nuisance estimators satisfy the following convergence rate_

\[\|_{a,k}-m_{a,k}\|\,\|_{a,k}-_{a,k}\|=o_{p}(1/ ),\|_{k}-_{k}\|\,\|_{a,k}- _{a,k}\|=o_{p}(1/),\] (12)

_then \((_{a,k}-_{a,T})\) asymptotically converges to a normal distribution with mean zero and asymptotic variance equal to the semiparametric efficiency bound._

In Theorem 3, we establish the consistency and asymptotic normality of the federated global estimator. These properties are attained without requiring consistency in the site-specific estimators from the source sites, a consequence of the adaptive weighting method employed. We further delve into conditions in which leveraging information from source sites can enhance the efficiency of the estimator constructed solely with the target data. The proofs are given in the Appendix E.5.

**Theorem 3**.: _Under Assumptions (A1) - (A7) and the regularity conditions specified in the Appendix E.5, the federated global estimator of \(_{T}\), given by \(_{G}=_{1,G}-_{0,G}\), is consistent and asymptotically normal,_

\[}}(_{G}-_{T}) (0,1),\] (13)

_with the variance estimated consistently as \(}\). The variance of \(_{G}\) is no larger than that of the estimator based on target data only, \(_{T}=_{1,T}-_{0,T}\). Further, if there exist some source sites with consistent estimators of \(_{T}\) and satisfy conditions specified in the Appendix E.5, the variance of \(_{G}\) is strictly smaller than \(_{T}\)._

## 6 Numerical Experiments

We evaluate the finite sample properties of five different estimators: (i) an augmented inverse probability weighted (AIPW) estimator using data from the target site only (Target), (ii) an AIPW estimator that weights each site proportionally to its sample size (SS), (iii) an AIPW estimator that weights each site inverse-proportionally to its variance (IVW), (iv) an AIPW estimator that weights each site with the \(L_{1}\) weights defined in (9) (AIPW-\(L_{1}\)), and (v) a multiply robust estimator with the \(L_{1}\) weights defined in (9) (MR-\(L_{1}\)). Across different settings, we examine the performance of each estimator in terms of mean absolute error, root mean square error, and coverage and length of 95% confidence intervals (CI) across \(500\) simulations.

We consider a total of five sites and fix the first site as the target site with a relatively small sample size of \(300\). The source sites have larger sample sizes of \(\{500,500,1000,1000\}\). We model heterogeneity in the covariate distributions across sites with skewed normal distributions and varying levels of skewness in each site, \(X_{kp}(x;_{kp},_{kp}^{2},_{kp})\), where \(k\{1,...,5\}\) indexes each site and \(p\{1,...,4\}\) indexes the covariates; \(_{kp}\), \(_{kp}^{2}\) and \(_{kp}\) are the location, scale, and skewness parameters, respectively. Following , we also generate covariates \(Z_{kp}\) as non-linear transformation of \(X_{kp}\) such that \(Z_{k1}=(X_{k1}/2)\), \(Z_{k2}=X_{k2}/\{1+(X_{k1})\}+10\), \(Z_{k3}=(X_{k1}X_{k3}/25+0.6)^{3}\) and \(Z_{k4}=(X_{k2}+X_{k4}+20)^{2}\).

To demonstrate that our proposed MR-\(L_{1}\) estimator can handle covariate mismatch across sites, we consider the setting where there exists covariate mismatch across sites, i.e. \(V_{k}=\{X_{k1},X_{k2}\}\) for the target site and \(X_{k}=\{X_{k1},X_{k2},X_{k3},X_{k4}\}\) for the source sites. In Appendix D.1, we also provide results for the setting where there is no covariate mismatch between sites. Specifically, we generate potential outcomes as

\[Y_{k}(a)=210+X_{k}_{x}+_{k}\] (14)

where \(_{x}=(27.4,13.7,0,0)\) for units in the target site and \(_{x}=(27.4,13.7,13.7,13.7)\) for units in the source sites. Similarly, the treatment is generated as

\[A_{k}(_{k})\ \ \ \ _{k}=(X_{k}_{x})\] (15)

where \(_{x}=(-1,0.5,0,0)\) for units in the target site and \(_{x}=(-1,0.5,-0.25,-0.1)\) for units in the source site. With this data generation scheme, the true TATE is \(_{T}=0\).

The AIPW-\(L_{1}\) estimator, which requires common models across sites, only uses the shared covariates (\(X_{k1}\) and \(X_{k2}\)) to specify outcome and treatment models for all sites. On the other hand, our MR-\(L_{1}\) estimator allows for different covariates in different sites, so we utilize both shared covariates with the target site and unique covariates to specify the outcome and treatment models in the source sites.

For the site-specific estimators based on MR-\(L_{1}\), we adaptively mix two outcome models and two treatment models. In particular, we specify the first model with the covariates \(X_{kp}\), and the second model with the covariates \(Z_{kp}\).

In Table 1, we observe that the AIPW-\(L_{1}\) estimator exhibits similar MAE, RMSE, coverage, and length of confidence intervals as the Target estimator while outperforming the SS and IVW estimators. This is because relying solely on shared covariates leads to significant biases in all source sites (Figure 2, left panel), and the AIPW-\(L_{1}\) estimator assigns nearly all of the ensemble weight to the target site so as to reduce bias.

In contrast, the MR-\(L_{1}\) estimator outperforms the AIPW-\(L_{1}\) estimator by exhibiting substantially smaller MAE, lower RMSE, and better coverage. This improvement can be attributed to the inclusion of unique covariates from the source sites, which allows for the recovery of true models in those sites and contributes to accurate estimation of \(_{T}\) (Figure 2, right panel). These findings suggest that neglecting covariate mismatch by solely relying on shared covariates can lead to highly biased results.

## 7 Case Study

We employ our approach to investigate the treatment effect of percutaneous coronary intervention (PCI) on the duration of hospitalization for individuals experiencing acute myocardial infarction

    & Target & SS & IVW & AIPW-\(L_{1}\) & MR-\(L_{1}\) \\  MAE & 0.108 & 4.331 & 0.150 & 0.107 & 0.053 \\ RMSE & 0.136 & 4.401 & 0.186 & 0.134 & 0.067 \\ Cov. & 0.946 & 1.000 & 0.882 & 0.950 & 0.944 \\ Len. & 0.538 & 26.024 & 0.553 & 0.536 & 0.253 \\   

Table 1: Mean absolute error (MAE), root mean squared error (RMSE), coverage (Cov.), and length (Len.) of \(95\%\) CIs based on 500 simulated data sets in covariate mismatch settings.

(AMI), one of the leading causes of hospitalization and mortality in the United States. We utilize a dataset from the Centers for Medicare & Medicaid Services (CMS), comprising a representative cohort of Medicare beneficiaries admitted to short-term acute-care hospitals. We select Maine as our target state of interest and incorporate data from the other 48 continental states to augment the Maine-specific treatment effect estimation.

We choose Maine as our target state for studying PCI treatment quality due to its limited AMI patient population. This scarcity of data in Maine necessitates the integration of information from other states for more precise treatment quality assessment. We consider a scenario where we only possess basic patient demographic information, including age, race, gender, and principal diagnosis categories in Maine. In contrast, the other source states have access to more extensive patient medical histories and have collected additional covariates, namely patient comorbidities.

The AIPW-\(L_{1}\) estimator requires a homogeneous model across states, so we define outcome and treatment models within each state using common patient demographic variables. By contrast, for our proposed MR-\(L_{1}\) estimator, we use patient demographic variables for outcome and treatment models in Maine, while in other states, we use both patient demographic and comorbidity variables for model specification. We adaptively combine two outcome models and two treatment models in the source states. The first model is defined using patient demographic variables, and the second model is defined with both patient demographic and comorbidity variables.

The estimation results of the case study are illustrated in Figure 3 using the five estimators. We observe that the AIPW-\(L_{1}\) and our proposed MR-\(L_{1}\) estimators yield point estimates that are close to the estimate by the Target estimator, while SS and IVW estimators exhibit substantial bias. The estimated treatment effect of PCI is approximately -7.6 days, indicating that if patients diagnosed with AMI in Maine had received PCI treatment instead of medical management alone, they would have experienced an estimated reduction in their hospitalization duration of approximately 7.6 days2. Both the AIPW-\(L_{1}\) and our proposed MR-\(L_{1}\) estimators exhibit efficiency gain with smaller standard errors compared to the Target estimator.

Figure 3: Estimates of PCI treatment effect in Maine with covariate mismatch in patient comorbidities

Figure 2: Estimates of the TATE based on \(500\) simulated data sets with covariate mismatch comparing the site-specific estimators with nuisance functions estimated by AIPW and by multiply robust model-mixing.

To highlight the ensemble weights corresponding to the source states, we generate Figure 4 illustrating the estimated weights associated with each state. States with positive weights are colored in blue, with darker shades indicating larger weights. States with zero weights are uncolored (white). We observe that both SS and IVW estimators integrate all state-specific estimates, regardless of how dissimilar these estimates are to the target estimate, thereby introducing negative transfer. In contrast, with the proposed adaptive ensemble approach, both AIPW-\(L_{1}\) and MR-\(L_{1}\) estimators only incorporate estimates from a few states whose state-specific estimates are close to the target state estimate, ensuring that the federated estimate closely aligns with the target estimate while achieving an efficiency gain.

## 8 Conclusion

We have proposed a novel federated approach for privacy-preserving, multiply robust, and covariate flexible estimation of causal effects. Compared to existing federated methods, our proposed approach accommodates covariate shift and covariate mismatch across sites, while guaranteeing efficient estimation and preserving privacy in the sense that only covariate means of the target samples are shared in a single round of communication. Our proposal allows investigators in each site to have greater flexibility in specifying candidate models by utilizing site-specific information. Moreover, our method utilizes adaptive ensemble weights to avoid negative transfer in the federation process.

In practical scenarios, the proposed method would be particularly valuable in multi-source research settings (e.g., data consortia) lacking a central data collection point. These methods would be beneficial for combining dissimilar data sources from various hospitals. Additionally, our proposed methodology would find utility in other contexts, such as multi-source clinics, firms, or schools needing to assess their performance relative to peer institutions. These situations may involve data privacy or propriety concerns that prevent the sharing of detailed, unit-level data.

To handle high-dimensional covariates, future research can explore ways to jointly model the propensity score and density ratio to reduce the dimension of parameters for population balancing.

In real-world scenarios, a potential weakness of our proposed approach is the risk of breaching patient privacy. We do not claim or test for formal privacy guarantees of the method; our work is privacy-preserving in the sense that only summary-level information is shared between target and source sites. Any given site is not allowed to specify a specific group and query this group's statistics in any other source site's dataset. Consequently, the target site cannot easily perform membership inference attacks. Nonetheless, for a more formal demonstration of privacy preservation, future research could employ the differential privacy (DP) method .

Figure 4: Federation weights across states for the PCI treatment effect in Maine using four federated estimators.

## 9 Acknowledgements

We would like to thank Yige Li, Bijan Niknam, Zhenghao Zeng, Wei Li, feedback received at the 2023 American Causal Inference Conference (ACIC) and the 2023 Institute for Operations Research and the Management Sciences (INFORMS) Annual Meeting, and the five anonymous reviewers for their helpful comments and input that greatly enhanced the paper.