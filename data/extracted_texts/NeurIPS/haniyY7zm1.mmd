# Exact Generalization Guarantees for (Regularized) Wasserstein Distributionally Robust Models

Waiss Azizian, Franck Iutzeler, Jerome Malick

Univ. Grenoble Alpes, CNRS, Grenoble IN

Grenoble, 38000, France

firstname.lastname@univ-grenoble-alpes.fr

###### Abstract

Wasserstein distributionally robust estimators have emerged as powerful models for prediction and decision-making under uncertainty. These estimators provide attractive generalization guarantees: the robust objective obtained from the training distribution is an exact upper bound on the true risk with high probability. However, existing guarantees either suffer from the curse of dimensionality, are restricted to specific settings, or lead to spurious error terms. In this paper, we show that these generalization guarantees actually hold on general classes of models, do not suffer from the curse of dimensionality, and can even cover distribution shifts at testing. We also prove that these results carry over to the newly-introduced regularized versions of Wasserstein distributionally robust problems.

## 1 Introduction

### Generalization and (Wasserstein) Distributionally Robust Models

We consider the fundamental question of generalization of machine learning models. Let us denote by \(f_{}\) the loss induced by a model parametrized by \(\) for some uncertain variable \(\) (typically a data point). When \(\) follows some distribution \(\), seeking the best parameter \(\) writes as minimizing the expected loss

\[_{}\;_{}[f_{}()]\,.\]

We usually do not have a direct knowledge of \(\) but rather we have access to samples \((_{i})_{i=1}^{n}\) independently drawn from \(\). The empirical risk minimization approach then consists in minimizing the expected loss over the associated empirical distribution \(}_{}=_{i=1}^{n}_{_{i}}\) (as a proxy for the expected loss over \(\)), i.e.,

\[_{}\;_{}_{}} [f_{}()]\;(=_{i=1}^{n}f_{}(_{i})).\]

Classical statistical learning theory ensures that, with high probability, \(_{}[f_{}]\) is close to \(_{}_{}}[f_{}]\) up to \((1/)\) error terms, see e.g., the monographs Boucheron et al. (2013); Wainwright (2019).

A practical drawback of empirical risk minimization is that it can lead to over-confident decisions (when \(_{}_{}}[f_{}]<_{ }[f_{}]\), the real loss can be higher that the empirical one (Esfahani and Kuhn, 2018)). In addition, this approach is also sensitive to distribution shifts between training and application. To overcome these drawbacks, an approach gaining momentum in machine learning is _distributionally robust_ optimization, which consists in minimizing the _worst expectation_ of the loss when the distribution lives in a neighborhood of \(}_{}\):

\[_{}\;_{(}_{ })}_{}[f_{}()]\,,\] (1)where the inner \(\) is thus taken over \(\) in the neighborhood \((}_{})\) of \(}_{}\) in the space of probability distributions. Popular choices of distribution neighborhoods are based on the Kullback-Leibler (KL) divergence (Laguel et al., 2020; Levy et al., 2020), kernel tools (Zhu et al., 2021; Staib and Jegelka, 2019; Zhu et al., 2021), moments (Delage and Ye, 2010; Goh and Sim, 2010), or Wasserstein distance (Shafieezadeh Abadeh et al., 2015; Esfahani and Kuhn, 2018). If \((}_{})\), distributionally robust models can benefit from direct generalization guarantees as,

\[_{(}_{})}_ {}[f_{}()]\ \ \ \ _{}[f_{}()].\] (2)

Thus, for well-chosen neighborhoods \((}_{})\), distributionally robust objectives are able to provide _exact upper-bounds_ on the expected loss over distribution \(\), i.e., the true risk.

Wasserstein distributionally robust optimization (WDRO) problems correspond to (1) with

\[(}_{})=\{():W(}_{},)\}\,,\]

where \(W(}_{},)\) denotes the Wasserstein distance between \(}_{}\) and \(\) and \(>0\) controls the required level of robustness around \(}_{}\). As a natural metric to compare discrete and absolutely continuous probability distributions, the Wasserstein distance has attracted a lot of interest in both machine learning (Shafieezadeh Abadeh et al., 2015; Sinha et al., 2018; Shafieezadeh-Abadeh et al., 2019; Li et al., 2020; Kwon et al., 2020) and operation research (Zhao and Guan, 2018; Arrigo et al., 2022) communities; see e.g., the review articles Blanchet et al. (2021); Kuhn et al. (2019).

WDRO benefits from out-of-the-box generalization guarantees in the form of (2) since it inherits the concentration properties of the Wasserstein distance (Esfahani and Kuhn, 2018). More precisely, under mild assumptions on \(\), (Fournier and Guillin, 2015) establishes that \(W(}_{},)\) with high probability as soon as \( 1/n^{1/d}\) where \(d\) denotes the dimension of the samples space. Thus, a major issue is the prescribed radius \(\) suffers from the curse of the dimensionality: when \(d\) is large, \(\) decreases slowly as the number of samples \(n\) increases. This constrasts with other distributionally robust optimization ambiguity sets, such as Maximum Mean Discrepancy (MMD) (Staib and Jegelka, 2019; Zeng and Lam, 2022), where the radius scales as \(1/\). Moreover, the existing scaling for WDRO is overly conservative for WDRO objectives since recent works (Blanchet et al., 2022; Blanchet and Shapiro, 2023) prove that a radius behaving as \(1/\) is asymptotically optimal. The main difference with (Esfahani and Kuhn, 2018) is that they -- and us -- consider the WDRO objective as a whole, instead of proceeding in two steps: first considering the Wasserstein distance independently and invoking concentration results on the Wasserstein distance and then plugging this result in the WDRO problem.

### Contributions and related works

In this paper, we show that WDRO provides exact upper-bounds on the true risk with high probability. More precisely, we prove non-asymptotic generalization bounds of the form of (2), that hold for general classes of functions, and that only require \(\) to scale as \(1/\) and not \(1/n^{1/d}\). To do so, we construct an interval for the radius \(\) for which it is both sufficiently large so that we can go from the empirical to the true estimator (i.e., at least of the order of \(1/\)) and sufficiently small so that the robust problem does not become degenerate (i.e., smaller than some critical radius, that we introduce as an explicit constant). Our results imply proving concentration results on Wasserstein Distributionally Robust objectives that are of independent interest.

This work is part of a rich and recent line of research about theoretical guarantees on WDRO for machine learning. One of this first results, Lee and Raginsky (2018), provides generalization guarantees, for a general class of models and a fixed \(\), that, however, become degenerate as the radius goes to zero. In the particular case of linear models, WDRO models admit an explicit form that allows Shafieezadeh-Abadeh et al. (2019); Chen and Paschalidis (2018) to provide generalization guarantees (2) with the radius scaling as \(1/\). The case of general classes of models, possibly non-linear, is more intricate. Sinha et al. (2018) showed that a modified version of (2) holds at the price of non-negligible error terms. Gao (2022); An and Gao (2021) made another step towards broad generalization guarantees for WDRO but with error terms that vanish only when \(\) goes to zero.

In contrast, our analysis provides exact generalization guarantees in the form (2) without additional error terms, that hold for general classes of functions and allow for a non-vanishing uncertainty radius to cover for distribution shifts at testing. Moreover, our guarantees also carry over to the recently introduced regularized versions of WDRO (Wang et al., 2023; Azizian et al., 2023), whose statistical properties have not been studied yet.

This paper is organized as follows. In Section 2, we introduce notations and our blanket assumptions. In Section 3, we present our main results, an idea of proof, and discussions. The complete proofs are deferred to the appendix.

## 2 Setup and Assumptions

In this section, we formalize our setting and introduce Wasserstein Distributionally Robust risks.

### Wasserstein Distributionally Robust risk functions

In this paper, we consider as a samples space \(\) a subset of \(^{d}\) equipped with the Euclidean norm \(\|\|\). We rely on Wasserstein distances of order \(2\), in line with the seminal work Blanchet et al. (2022) on generalization of WDRO. This distance is defined for two distributions \(\), \(^{{}^{}}\) in the set of probability distributions on \(\), denoted by \(()\), as

\[W_{2}(,^{})(_{( ),_{1}=,_{2}=^{}}_{( ,)}[\|-\|^{2}])^{1/2}\,,\]

where \(()\) is the set of probability distributions in the product space \(\), and \(_{1}\) (resp. \(_{2}\)) denotes the first (resp. second) marginal of \(\).

We denote by \(f:\) the loss function of some model over the sample space. The model may depend on some parameter \(\), that we drop for now to lighten the notations; instead, we consider a class of functions \(\) encompassing our various models and losses of interest (we come back to classes of parametric models of the form \(=\{f_{}:\}\) in Section 4).

We define the empirical Wasserstein Distributionally Robust risk \(}_{^{2}}(f)\) centered on \(}_{}\) and similarly the true robust risk \(_{^{2}}(f)\) centered on \(\) as

\[}_{^{2}}(f)_{()\\ W_{2}^{2}(}_{},)^{2}} _{}[f()] _{^{2}}(f)_{ ()\\ W_{2}^{2}(,)^{2}}_{ }[f()]\,.\] (3)

Note that \(}_{^{2}}(f)\), which is based on the empirical distribution \(}_{}\), is a computable proxy for the true robust risk \(_{^{2}}(f)\). Note also that the true robust risk \(_{^{2}}(f)\) immediately upper-bounds the true (non-robust) risk \(_{}[f()]\) and also upper-bounds \(_{}[f()]\) for neighboring distributions \(\) that correspond to distributions shifts of magnitude smaller than \(\) in Wasserstein distance.

### Regularized versions

Entropic regularization of WDRO problems was recently studied in Wang et al. (2023); Blanchet and Kang (2020); Piat et al. (2022); Azizian et al. (2023) and used in Dapogny et al. (2023); Song et al. (2023); Wang and Xie (2022); Wang et al. (2022). Inspired by the entropic regularization in optimal transport (OT) (Peyre and Cuturi, 2019, Chap. 4), the idea is to regularize the objective by adding a KL divergence, that is defined, for any transport plan \(()\) and a fixed reference \(()\), by

\[(\,|)=\,}{ }\,\,&\,\\ +&.\]

Unlike in OT though, the choice of the reference measure in WDRO is not neutral and introduces a bias in the robust objective (Azizian et al., 2023). For their theoretical convenience, we take reference measures that have Gaussian conditional distributions

\[_{}(|)_{}\,e^{-(-)^{2}}{2^{2}}},\,,\] (4)where \(>0\) controls the spread of the second marginals, following Wang et al. (2023); Azizian et al. (2023). Then, the regularized version of \(}_{^{2}}(f)\) (WDRO empirical risk) is given by

\[}_{^{2}}^{}(f)_{ (),_{1}= }_{}\\ _{(,)}[\|-\|^{2}] ^{2}}_{_{2}}[f()]- (|_{}^{n}.) \ _{}^{n}=}_{}()\,_{ }(|)\] (5)

and similarly, the regularized version of \(_{^{2}}(f)\) is given by

\[_{^{2}}^{}(f)_{ (),_{1}=\\ _{(,)}[\|-\|^{2}] ^{2}}_{_{2}}[f()]- (|_{}.) \ _{}=()\,_{}(|).\] (6)

These regularized risks have been studied in terms of computational or approximation properties, but their statistical properties have not been investigated yet. The analysis we develop for WDRO estimators is general enough to carry over to these settings.

In (5) and (6), note finally that the regularization is added as a penalization in the supremum, rather than in the constraint. As in Wang et al. (2023), penalizing in the constraint leads to an ambiguity set defined by the regularized Wasserstein distance, that we introduce in Section 3.2. We refer to Azizian et al. (2023) for a unified presentation of the two penalizations.

### Blanket assumptions

Our analysis is carried under the following set of assumptions that will be in place throughout the paper. First, we assume that the sample space \(^{d}\) is convex and compact, which is in line with previous work, e.g., (Lee and Raginsky, 2018; An and Gao, 2021).

**Assumption 1** (On the set \(\)).: The sample space \(\) is a compact convex subset of \(^{d}\).

Second, we require the class of loss functions \(\) to be sufficiently regular. In particular, we assume that they have Lipschitz continuous gradients.

**Assumption 2** (On the function class).: The functions of \(\) are twice differentiable, uniformly bounded, and their derivatives are uniformly bounded and uniformly Lipschitz.

Finally, we assume that \(}_{}\) is made of independent and identically distributed (i.i.d.) samples of \(\) and that \(\) is supported on the interior of \(\) (which can be done without loss of generality by slightly enlarging \(\) if needed).

**Assumption 3** (On the distributions).: \(}_{}=_{i=1}^{n}_{_{i}}\) where \(_{1},,_{n}\) are i.i.d. samples of \(\). We further assume that there is some \(R>0\) such that \(\) satisfies \(\,+}(0,R)\).

## 3 Main results and discussions

The main results of our paper establish that the empirical robust risk provide high probability bounds, of the form of (2), on the true risk. Since the results and assumptions slightly differ between the WDRO models and their regularized counterparts, we present them separately in Section 3.1 and Section 3.2. In Section 3.3, we provide the common outline for the proofs of these results, the proofs themselves being provided in the appendix. Finally, in Section 4, we detail some examples.

### Exact generalization guarantees for WDRO models

In this section, we require the two following additional assumptions on the function class. The first assumption is common in the WDRO litterature, see e.g., Blanchet et al. (2022); Blanchet and Shapiro (2023); Gao (2022); An and Gao (2021).

**Assumption 4**.: The quantity \(_{f}_{}\|\,f\|^{2}\) is positive.

The second assumption we consider in this section makes use of the notation \(d(,A)\), for a set \(A\) and a point \(\), to denote the distance between \(\) and \(A\), i.e., \(d(,A)=_{ A}\|-\|\).

**Assumption 5**.:
1. For any \(R>0\), there exists \(>0\) such that, \[ f,\,, d(, f) R f ()- f-\,.\]
2. The following growth condition holds: there exist \(>0\) and \(L>0\) such that, for all \(f\), \(\) and \(^{*}\) a projection of \(\) on \( f\), i.e., \(^{*}_{ f}-\), \[f(^{*}) f()+-^{*}^{2}- -^{*}^{3}\,.\]

The first item of this assumption has a natural interpretation: we show in Lemma A.7, that it is equivalent to the relative compactness of the function space \(\) w.r.t. to the distance

\[D(f,g) f-g_{}+D_{H}( f, g)\,,\]

where \(D_{H}\) denotes the (Hausdorff) distance between sets and \( f_{}_{} f()\) is the infinity norm. The last one is a structural assumption on the functions \(\) that is new in our context but is actually very close the so-called parametric Morse-Bott condition, introduced in of bilevel optimization (Arbel and Mairal, 2022), see Section A.5.

We now state our main generalization result for WDRO risks.

**Theorem 3.1**.: _Under Assumptions 4 and 5, there is an explicit constant \(_{c}\) depending only on \(\) and \(\) such that for any \((0,1)\) and \(n 1\), if_

\[\!(})}{2}-\!(})\] (7)

_then, there is \(_{n}=\!(})\) such that, with probability \(1-\),_

\[ f,}_{^{2}}(f)_{}[f()]\,\,W_{2}^{2}( ,)(-_{n})\,.\] (8)

_In particular, with probability \(1-\), we have_

\[ f,}_{^{2}}(f)_{}[f()].\] (9)

The second part of the result, (9), is an _exact_ generalization bound: it is an actual upper-bound on the true risk \(_{}[f()]\), that we cannot access in general, through a quantity that we can actually compute with \(}_{n}\). The first part of the result, (8) gives us insight into the robustness guarantees offered by the WDRO risk. Indeed, it tells us that, when \(\) is greater than the minimal radius \(_{n} 1/\) by some margin, the empirical robust risk \(}_{^{2}}(f)\) is an upper-bound on the loss even with some perturbations of the true distribution. Hence, as long as \(\) is large enough, the WDRO objective enables us to guarantee the performance of our model even in the event of a distribution shift at testing time. In other words, the empirical robust risk is an _exact_ upper-bound on the true robust risk \(_{(-_{n})}(f)\) with a reduced radius.

The range of admissible radiuses is described by (7). The lower-bound, roughly proportional to \(1/\), is optimal, following the results of Blanchet et al. (2022). The upper-bound, almost independent of \(n\), depends on a constant \(_{c}\), that we call _critical radius_ and that has an interesting interpretation, that we formalize in the following remark. Note, finally, that, the big-O notation in this theorem has a slightly stronger meaning1 than the usual one, being non-asymptotic in \(n\) and \(\).

**Remark 3.2** (Interpretation of critical radius).: _The critical radius \(_{c}\), appearing in (7), is defined by_

\[_{c}^{2}_{f}_{} d^{2}(, f)\,.\]_It can be interpreted as the threshold at which the WDRO problem w.r.t. \(\) starts becoming degenerate. Indeed, when \(^{2}_{}d^{2}(, f) \) for some \(f\) that we fix, the distribution \(\) given by the second marginal of the transport plan \(\) defined by,_

\[(,)()_{ ^{*}()}()^{*}() *{arg\,min}_{*{arg\,max}f}d^{2}(,)\,,\]

_satisfies_

\[W_{2}^{2}(,)_{(,)} \|-\|^{2}=_{} d^{2}(, f)^{2}\,.\]

_As a consequence, the robust problem is equal to_

\[_{^{2}}(f)=_{( )\\ W_{2}^{2}(,)^{2}}_{ }[f()]=_{}f()\,.\]

_Thus, when the radius exceeds \(_{c}\), there is some \(f\) such that the robust problem becomes degenerate as it does not depend on \(\) nor \(\) anymore._

Finally, note that we can obtain the same generalization guarantee as Theorem 3.1 without Assumption 5 at the expense of losing the above interpration on the condition on the radius. More precisely, we have the following result.

**Theorem 3.3**.: _Let Assumption 4 hold. For any \((0,1)\) and \(n 1\), if \(\) satisfies (7), and if, in addition, it is smaller than a positive constant which depends only on \(\), \(\) and \(\), then both conclusions of Theorem 3.1 hold._

This theorem can be compared to existing results, and in particular with Gao (2022); An and Gao (2021). These two papers provide generalization bounds for WDRO under a similar assumption on \(\) and a weakened version of Assumption 3. However, these generalization bounds involve extra error terms, that require \(\) to be vanishing. In comparison, with a similar set of assumptions, Theorem 3.3 improves on these two issues, by allowing \(\) not to vanish as \(n\) and by providing the exact upper-bound (9). Allowing non-vanishing radiuses is an attractive feature of our results that enables us to cover distribution shifts.

### Regularized WDRO models

The analysis that we develop for the standard WDRO estimators is general enough to also cover the regularized versions presented in Section 2.2. We thus obtain the following Theorem 3.4 which is the first generalization guarantee for regularized WDRO. This theorem is very similar to Theorem 3.1 with still a couple of differences. First, the regularization leads to ambiguity sets defined in terms of \(W_{2,}(,)\), the _regularized_ Wasserstein distance to the true distribution \(\), defined, for some regularization parameter \(>0\), as

\[W_{2,}^{2}(,)\{_{} \|-\|^{2}+(\,|\, _{}):(),_{1}=,\,_{2}= \}\,,\]

where \(_{}\) appears in the definition of the regularized robust risk (6). Besides, the regularization allows us to avoid Assumptions 4 and 5 to show our generalization result.

**Theorem 3.4**.: _For \(=_{0}\) with \(_{0}>0\), \(=_{0}\) with \(_{0}>0\) such that \(_{0}/_{0}^{2}\) is small enough depending on \(\), \(\), \(\), there is an explicit constant \(_{c}\) depending only on \(\), \(\) and \(\) such that for all \((0,1)\) and \(n 1\), if_

\[}}{2}-}\,, _{c}}+^{1/4}\,,\]

_then, there are \(=()\) and \(_{n}=}\) such that, with probability at least \(1-\),_

\[ f,}_{^{2}}^{}(f) _{}[f()]\,\,W_{2,}^{2}(,) (-_{n})\,.\] (10)

_Furthermore, when \(_{0}\) and \(\) are small enough depending on \(\) and \(\), with probability \(1-\),_

\[ f,}_{^{2}}^{}(f) _{}_{_{}(|) }[f()].\]The first part of the theorem, (10), guarantees that the empirical robust risk is an upper-bound on the loss even with some perturbations of the true distribution. As in OT, the regularization added to the Wasserstein metric induces a bias that may prevent \(W^{2}_{2,}(,)\) from being null. As a result, the second part of the theorem involves a smoothed version of the true risk: the empirical robust risk provides an _exact_ upper-bound the true expectation of a convolution of the loss with \(_{}\).

A few additional comments are in order:

* Our result prescribes the scaling of the regularization parameters: \(\) and \(\) should be taken proportional to \(\).
* The critical radius \(_{c}\) has a slightty more intricate definition, yet the same interpretation as in the standard WDRO case inRemark 3.2; see Section D.2.
* The regularized OT distances do not suffer from the curse of dimensionality (Genevay et al., 2019). However this property does not directly carry over to regularized WDRO. Indeed, we cannot choose the same reference measure as in OT and we have to fix the measure \(_{}\), introducing a bias. As a consequence, we have to extend the analysis of the previous section to obtain the claimed guarantees that avoid the curse of dimensionality.

### Idea of the proofs

In this section, we present the main ideas of the proofs of Theorem 3.1, Theorem 3.3, and Theorem 3.4. The full proofs are detailed in appendix; we point to relevant sections along the discussion. First, we recall the duality results for WDRO that play a crucial role in our analysis. Second, we present a rough sketch of proofs that is common to both the standard and the regularized cases. Finally, we provide a refinement of our results that is a by-product of our analysis.

Duality in WDRO.Duality has been a central tool in both the theoretical analyses and computational schemes of WDRO from the onset (Shafieezadeh Abadeh et al., 2015; Esfahani and Kuhn, 2018). The expressions of the dual of WDRO problems for both the standard case (Gao and Kleywegt, 2016; Blanchet and Murthy, 2019) and the regularized case (Wang et al., 2023; Azizian et al., 2023) can be written with the following dual generator function \(\) defined as

\[(f,,,,)\{ _{}f()-\|-\|^{2}} &=0\\ _{_{}(|)} /2}{} &>0\,,.\] (11)

where \(\) is the dual variable associated to the Wasserstein constraint in (3), (5) and (6). The effect of regularization appears here clearly as a smoothing of the supremum. Note also that this function depends on the conditional reference measures \(_{}(|)\) but not on other probability distributions. Then, under some general assumptions (specified in Section 2.3 in appendix), the existing strong duality results yield that the (regularized) empirical robust risk writes

\[}^{}_{^{2}}(f)=_{ 0} ^{2}+_{}_{n}}[(f,, ,,)]\,,\] (12)

and, similarly, the (regularized) true robust risk writes

\[^{}_{^{2}}(f)=_{ 0}^{2}+ _{}[(f,,,,) ]\,.\] (13)

These expressions for the risks are the bedrock of our analysis.

Sketch of proof.In both the standard case and the regularized case, our proof is built on two main parts: the first part is to obtain a concentration bound on the dual problems that crucially relies on a lower bound of the dual multiplier; the second part then consists in establishing such a lower bound. All the bounds are valid with high probability, and we drop the dependency on the confidence level \(\) of the theorems for simplicity.

For the first part of the proof (Section B), we assume that there is a deterministic lower-bound \(>0\) on the optimal dual multiplier in (12) that holds with high-probability. As a consequence, we can restrict the range of \(\) in (12) to obtain:

\[}^{}_{^{2}}(f)=_{ }\{^{2}+_{}_{n}}[(f,,,,)]\}\] \[=_{}\{^{2}+ _{}[(f,,,,) ]-_{}[(f,,, ,)]-_{}_{n}}[(f,, ,,)]}{}\}\] \[_{}\{^{2}+ _{}[(f,,,,) ]-_{^{}}_ {}[(f,,^{},,)]-_{}_{n}}[(f,,^{},, )]}{^{}}\}\] \[_{}\{^{2}+ _{}[(f,,,,) ]-_{n}^{2}\}\] \[^{}_{^{2}-_{n}^{2}}(f )\,.\] (14)

In the above, we used that the inner supremum, which is random, can be bounded by a deterministic and explicit quantity that we call \(_{n}^{2}\), i.e.,

\[_{n}^{2}_{^{}} {_{}[(f,,^{},,) ]-_{}_{n}}[(f,,^{}, ,)]}{^{}}\]

Hence, we obtain an upper-bound on the robust risk w.r.t. the true distribution with radius \(^{2}-_{n}^{2}\). Moreover, we show that \(_{n}^{2}=(1/())\) which highlights the need for a precise lower bound \(\) to control the decrease in radius.

The second part of the proof thus consists in showing that the dual variable is indeed bounded away from \(0\), which means that the Wasserstein constraint is _sufficiently active_. We have to handle two cases differently:

* when \(\) is small, i.e., close to \(_{n}\) (Section C),
* when \(\) is large, i.e., close to the critical radius \(_{c}\) (Section D). Note that the additional Assumption 5 is required here: where we need to control the behaviors of \(f\) close to their maxima (see (11) for \(=0\) and small \(\)).

In both cases we obtain that \(\) scales as \(1/\) for the respective ranges of admissible radiuses. As a consequence \(_{n}^{2}\) is bounded by \(_{n}\) with \(_{n}=(1/)\) and (14) becomes

\[}^{}_{^{2}}(f)^{} _{(-_{n})}(f)\,,\] (15)

which leads to our main results.

Extension: upper and lower bounds on the empirical robust risk.The proof that we sketched above actually shows that \(^{}_{(-_{n})}(f)\) is a lower bound of \(}^{}_{^{2}}(f)\). This proof technique also yields an upper bound by exchanging the roles of \(\) and \(}_{n}\).

**Theorem 3.5**.: _In the setting of either Theorem 3.1, Theorem 3.3 or Theorem 3.4 (with \(=0\) or \(>0\)), with probability at least \(1-\), it holds that_

\[ f,^{}_{(-_{n})}( f)}^{}_{^{2}}(f)^{ }_{(+_{n})}(f)\,,\]

_with \(_{n}=}\)._

This result shows how two robust objectives w.r.t. \(\) provide upper and lower bounds on the empirical robust risk, with only slight variations in the radius. Furthermore, when the number of data points \(n\) grows, both sides of the bound converge to the same quantity \(^{}_{^{2}}(f)\). Hence our generalization bounds of the form (15) are asymptotically tight.

As a final remark, we underline that the proofs of this theorem and of the previous ones rely on the cost being the squared Euclidean norm and the extension to more general cost functions is left as future work. In particular, the Laplace approximation of Section A.3 in the regularized case and the analysis of Section D.1 in the standard WDRO case would need further work to accomodate general cost functions.

Examples: parametric models

Our main theorems Theorems 3.1, 3.3 and 3.4 involve a general class \(\) of loss functions. We explain in this section how to instantiate our results in the important class of parametric models. We then illustrate this setting with logistic regression and linear regression in Examples 4.1 and 4.2.

Let us consider the class of functions of the form

\[=\{ f(,):\}f:\] (16)

where \(\), the parameter space, is a subset of \(^{p}\) and \(\), the sample space, is a subset of \(^{d}\).

For instance, this covers the case of linear models of the form \(f(,)=(,)\) with \(\) a convex loss. This class of models is studied by Shafieezadeh-Abadeh et al. (2019); Chen and Paschalidis (2018) in a slightly different setting, where they obtain a closed form for the robust objective and then establish a generalization bound similar to (9).

Let us show how to instantiate our theorems in the case of (16).

* If \(f\) is twice continuously differentiable on a neighborhood of \(\) with \(\) and \(\) both compact, then Assumption 2 is immediately satisfied. Therefore, Theorem 3.4 can be readily applied and its generalization guarantee hold.
* As for Assumption 4, it is equivalent to, for all \(\), \((_{}\,f(,) 0)>0\). Thus disregarding the degenerate case of \(_{}\,f(,)\) being null for \(\)-almost every \(\) (e.g., when the loss does not depend on \(\)), we are in the setting of Theorem 3.3.
* Satisfying Assumption 5, needed for Theorem 3.1, requires some problem-dependent developments, see the examples below. Note though that the second item of Assumption 5 is implied by the parametric Morse-Bott property (Arbel and Mairal, 2022); see Section A.5.

We discuss linear and non-linear examples of this framework. In light of the above, we focus our discussion on Assumption 5. We first present the examples of linear models, Examples 4.1 and 4.2, where the latter assumption is satisfied. We then consider several examples of nonlinear models: kernel regression (Example 4.3), smooth neural networks (Example 4.4) and families of invertible mappings (Example 4.5). In Section H, we also provide numerical illustrations for linear models.

**Example 4.1** (Logistic Regression).: _For a training sample \((x,y)^{p}\{-1,+1\}\), the logistic loss for a parameter \(^{p}\) is given by \(1+e^{-y x,}\). It fits into our framework by defining \(f(,)=1+e^{,}\) with \(\) playing the role of \(-y x\). We assume that \(\) is a compact set that does not include the origin, and, for the sake of simplicity, we take \(\) as a closed Euclidean ball, i.e., \(=}(0,r)\). We are going to show that Assumption 5 is satisfied, and, for this, we need the following elements. For any \(\), the maximizer of \(f(,)\) over \(=}(0,r)\) is reached at \(^{*}}{\|\|}\). Besides, for any \(\), it holds that_

\[r^{2}\|\|^{2}=\|^{*}\|^{2}+2^{*},-^{*}+\| -^{*}\|^{2}\,,\]

_so that, since \(\|^{*}\|=r\), we have_

\[^{*},^{*}-\|-^{*}\|^{2}\,.\] (17)

_We can now turn to the verification of Assumption 5._

1. _Take some_ \(R>0\) _and some_ \(\) _such that_ \(\|-^{*}\| R\)_. Then, (_17_) yields_ \[,-,^{*}= ^{*},-^{*}-\|-^{*}\|^{ 2}-}{2r}\,.\] (18) _Since_ \(u(1+e^{u})\) _is increasing, this yields that_ \(f(,)-f(,^{*})\) _is bounded away from 0 by a negative constant uniformly in_ \(\)_. The first item of Assumption_ 5 _is thus satisfied._
2. _Fix_ \(\)_; by Taylor expanding_ \(u(1+e^{u})\) _around_ \(,^{*}\) _we get_ \[f(,)=f(,^{*})+}} ,-^{*}+(,-^{*} )^{2}\,,\]_where the big-O remainder is uniform over \(\). Using the first inequality in (_18_), we get for \(\) close enough to \(^{*}\)_

\[f(,) f(,^{*})- })},-^{*} f(,^{*})-\|-^{*}\|^{2}\,.\]

_This shows that the second item of Assumption 5 is satisfied locally around \(^{*}\). It can be made global by using the uniform Lipschitz-continuity of \(f\), which introduces a term of the form \(\|-^{*}\|^{3}\)._

**Example 4.2** (Linear Regression).: _With samples of the form \(=(x,y)^{p}\) and parameters \(^{p}\), the loss is given by \(f(,)=,x-y)^{2}\). Similarly to the previous example, we take \(\) as a compact set of \(^{d}\) that does not include the origin and \(\) of the form \(}(0,r)[-r^{},r^{}]\). The maximizers of \(f(,)\) on \(\) are \(_{1}^{*}=(r/\|\|,-r^{})\) and \(_{2}^{*}=(-r/\|\|,r^{})\). By symmetry, one can restrict to the case of \(_{1}^{*}\) and \(,x-y 0\); the same rationale as above can then be applied._

**Example 4.3** (Kernel Ridge Regression).: _Using a kernel \(k:\) with \(\) compact and \(k\) smooth, for instance Gaussian or polynomial, we consider the following class of loss functions:_

\[f(,)=(_{i=1}^{m}_{i}k(x,x_{i})-y)^{2} +\|\|_{2}^{2}\,.\]

_where \(=(x,y)\), \(\) is some compact subset of \(\), \(=(_{1},,_{m},x_{1},,x_{m})\), \(=A_{m}_{m}\), \(m\) is a fixed integer, \(A\) is a compact subset of \(^{m}\), \(_{m}\) can be any closed subset of \(^{m}\) and \( 0\) is the regularization parameter. A typical choice for \(_{m}\) would be the datapoints of the training set. This class then fits into our framework of parametric models above. Finally, further information on the kernel would be needed to ensure that Assumption 5 is satisfied._

**Example 4.4** (Smooth Neural Networks).: _Denote by \((x,,)\) a multi-linear perceptron that takes \(x\) as input, has weights \(\) and a smooth activation function \(\), for instance the hyperbolic tangent or the Gaussian Error Linear Units (GELU). We choose \((,y)\) a smooth loss function and we consider the loss \(f(,(x,y))=((x,,),y)\) with \(\) some compact set. Provided that the inputs \((x,y)\) lie in a compact set \(\), this class fits the parametric framework above. Note that we require \(\) to be smooth, further work would be required for non-smooth activation functions._

**Example 4.5** (Family of diffeomorphisms).: _Consider maps \(h\) and \((,) g_{}()\) and define the parametric loss \(f(,)=h(g_{}())\). Assume that these functions are twice differentiable, that \(h\) satisfies the second item of Assumption 5 and that, for every \(\), \(g_{}\) has a inverse \(g_{}^{-1}\) which is also continuously differentiable in a neighborhood of \(\)._

_As before, this setting fits into the framework above. We now show that Assumption 5 is satisfied._

1. _Since_ \(h\) _is continuous,_ \(h\) _satisfies the first item of Assumption_ 5_. It is satisfied by_ \(\) _as well thanks to_ \(g_{}^{-1}\) _being Lipschitz-continuous in_ \(\) _uniformly in_ \(\) _by compactness of_ \(\)_._
2. _Take_ \(C\) _such that both_ \(g_{}\) _and_ \(g_{}^{-1}\) _are_ \(C\)_-Lipschitz in_ \(\) _uniformly in_ \(\)_. Since_ \( f(,)=g_{}^{-1}( h)\)_, it holds that_ \(_{^{*} h}\|g_{}()-^{*}\|=_{^{*} f (,)}\|g_{}()-g_{}(^{*})\|\) _which lies between_ \(C^{-1}_{^{*} f(,)}\|-^{*}\|\) _and_ \(C_{^{*} f(,)}\|-^{*}\|\)_. Combined with_ \(h\) _satisfying the second item of Assumption_ 5_, this shows that_ \(f\) _satisfies this condition as well._

## 5 Conclusion and perspectives

In this work, we provide generalization guarantees for WDRO models that improve over existing literature in the following aspects: our results avoid the curse of dimensionality, provide exact upper bounds without spurious error terms, and allow for distribution shifts during testing. We obtained these bounds through the development of an original concentration result on the dual of WDRO. Our framework is general enough to cover regularized versions of the WDRO problem: they enjoy similar generalization guarantees as standard WDRO, with less restrictive assumptions.

Our work could be naturally extended in several ways. For instance, it might be possible to relax any of the assumptions (on the sample space, the sampling process, the Wasserstein metric, and the class of functions) at the expense of additional technical work. Moreover, the crucial role played by the radius of the Wasserstein ball calls for a principled and efficient procedure to select it.