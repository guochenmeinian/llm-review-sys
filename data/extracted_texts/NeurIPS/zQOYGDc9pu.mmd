# Optimized Covariance Design for AB Test on Social Network under Interference

Qianyi Chen\({}^{1}\), Bo Li\({}^{1}\), Lu Deng\({}^{2}\), Yong Wang \({}^{2}\)

\({}^{1}\)School of Economics and Management, Tsinghua University, China

\({}^{2}\)Tencent Inc., Shenzhen, China

cqy22@mails.tsinghua.edu.cn, libo@sem.tsinghua.edu.cn

adamdeng@tencent.com, darwinwang@tencent.com

Corresponding author

###### Abstract

Online A/B tests have become increasingly popular and important for social platforms. However, accurately estimating the global average treatment effect (GATE) has proven to be challenging due to network interference, which violates the Stable Unit Treatment Value Assumption (SUTVA) and poses great challenge to experimental design. Existing network experimental design research was mostly based on the unbiased Horvitz-Thompson (HT) estimator with substantial data trimming to ensure unbiasedness at the price of high resultant estimation variance. In this paper, we strive to balance the bias and variance in designing randomized network experiments. Under a potential outcome model with 1-hop interference, we derive the bias and variance of the standard HT estimator and reveal their relation to the network topological structure and the covariance of the treatment assignment vector. We then propose to formulate the experimental design problem as to optimize the covariance matrix of the treatment assignment vector to achieve the bias and variance balance by minimizing a well-crafted upper bound of the mean squared error (MSE) of the estimator, which allows us to decouple the unknown interference effect component and the experimental design component. An efficient projected gradient descent algorithm is presented to the implement of the desired randomization scheme. Finally, we carry out extensive simulation studies2 to demonstrate the advantages of our proposed method over other existing methods in many settings, with different levels of model misspecification.

## 1 Introduction

A/B test, also known as controlled experiment, is an effective way to evaluate treatment effect of new product features and facilitate data-driven decision-making . Due to its simplicity and efficiency, it has become the gold standard in the industry. The theory of A/B test is based on the Stable Unit Treatment Value Assumption (SUTVA), under Neyman-Rubin's framework , which assumes unit's treatment effect isn't influenced by other units' treatment assignments. However, in situations where social network connects units, SUTVA is often violated since an individual's behavior can be influenced by their friends. This violation of SUTVA is referred as network interference or social interference, which brings challenges to both estimation and inference of parameters of interest. It has been shown that ignoring network effect can induce much higher bias or variance .

To tackle the bias and variance induced by network interference, researchers have tried to design randomization schemes in pre-treatment phase and estimators or adjustment methods in post-treatment phase. In this paper, we will focus on designing randomization scheme, namely, experiment design.

Specifically, we take the graph structure as known and leverage it to assist experiment design. Our basic scheme is cluster-level randomization, which treats cluster or community in the graph as unit of treatment and all units in the same cluster share the same treatment.  is an early work investigating this approach, and  proposes to form clusters utilizing graph. The graph cluster randomization is conceptually simple but effective in many scenes, and thus becomes a prevalent paradigm for network experiment design. Moreover, we consider experimental design on a social network in this work. Social network typically has organic structure and high clustering coefficient, which corresponds to meaningful cluster structure and also motivates us to adopt cluster-level randomization. We assume the cluster structure of the network is given. In practice, interpretable community detection algorithms such as the Louvain algorithm  are typically applied for cluster construction. Moreover, we stress the scalability of our method since social network is usually large-scale in reality.

Related works have shown that there exists an explicit bias-variance tradeoff . However, many HT-style estimators that utilize exposure indicator to ensure unbiasedness are designed on the basis of the neighborhood interference assumption that restricts global interference to 1-hop neighborhood , and graph-dependent generalized propensity score . Nonetheless, we argue that pursuing unbiasedness by simple sample trimming leads to small effective sample size with high variance, and thus is far from optimal. Moreover, computational cost is also high in this approach since a large number of Monte Carlo simulations are usually needed for computing the generalized propensity score, or the trimming probability for constructing sample weights. Having observed the preceding drawbacks of the unbiased estimator, we consider the standard unit-level HT estimator to achieve possible better bias and variance tradeoff with less computation burden at the meantime. Based on a potential outcome model, we characterize the relationship among the bias, variance, the network topology, and the treatment assignment mechanism. This development allows us to design experimental schemes that minimizes MSE and achieve better bias-variance tradeoff.

Besides from the time-consuming Monte Carlo simulation for calculating generalized propensity score mentioned above, the computational efficiency of experiment design is indeed a limitation of current methods. For instance, the two-wave experiment , entails solving a mixed-integer quadratic programming problem, which can be computationally expensive. The adaptive covariates-balancing design  adopts a sequential process for treatment assignment and thus isn't very scalable. To address this limitation, we propose to utilize gradient-based optimization algorithm.

In this paper, we propose to treat the covariance matrix of treatment vector as decision variable in optimization, which is nontrivial as a result of interference and corresponding complex variance of estimator. Similar approach in optimization step is proposed in , where interference isn't considered, and making covariance covariance acting as decision variable is a natural choice owing to the simple structure of variance there. We draw attention to the fact that related works concerning experiment design mostly concentrates on a predetermined class of randomization schemes and seeks to optimize the parameters to obtain designs that minimize variance or MSE of estimator . However, we argue that these designs can all be understood as different patterns of the covariance matrix of the treatment vector, and we propose to treat the covariance matrix as decision variables rather than limiting our scope to a particular class of designs. One of major challenges with this approach is generating a randomization scheme that supports legitimate sampling, as there may not be a joint distribution that corresponds to the optimized covariance matrix in our formulation. To address this issue, we propose to adopt projected gradient descent to guarantee the validity of optimized covariance matrix. Furthermore, we also compare our method with other popular designs through extensive simulation on a real online social network. Various interference intensity levels and potential outcome models are considered. It is found that our method is robust to model misspecification and outperforms in almost all settings, especially when the interference isn't too weak compared to the direct treatment effect, which is the scene we target.

**Contributions.** Our contributions are summarized as follows.

1. We derive a well-crafted upper bound for the MSE of the HT estimator that decouples the estimation of causal mechanism and experimental design. This enables us to optimize the experimental design by minimizing this bound, in which the covariance matrix of treatment vector acts as decision variables.
2. We propose the formulation of covariance optimization problem with reparameterization of covariance matrix and constraints that guarantees legitimate sampling subject to optimizedcovariance matrix, and a projected gradient descent algorithm is proposed for solving the optimization problem.
3. We conduct systematic simulation on a social network and compare our method with several methods proposed recently under a range of settings, providing credible reference for the effectiveness of our method.

**Related Works.** A variety of interference has been considered in related works, such as spatial , temporal  and network, which is the scene we target. Besides from the general network, there is also another line of work focused on a two-sided marketplace or platform, where the graph is bipartite [43; 24; 16; 30; 27].

In the field of network experiment design, most of extant research assumes that the graph structure is known and leverage it to assist in modeling the interference, though several graph agnostic methods are developed these days [40; 8]. Nevertheless, the interference is conducted through edges of network, and agnostic methods aren't effective enough.

Beyond unit-level randomization, cluster-level randomization on graph has attracted extensive attention, including both experimental design [23; 25; 5; 30] and estimation [26; 1; 6; 15]. The seminal paper of this line of work is , which proposes graph cluster randomization that treats clusters as units in randomization. This methodology is motivated by providing a better lower bound of exposure probability in HT estimator that uses exposure probability as inverse weight, aiming at controlling the variance of such an unbiased estimator. Along the same direction,  proposes a polynomial lower bound on exposure probability through randomized local clustering algorithm.

Irregular global interference may render the experimental design problem intractable , thus structural assumptions are usually introduced to rule out such arbitrary interference. The first category is partial interference [34; 19; 3; 11; 5], which assumes disjoint community structures and interference only happens within each community. The second category is neighborhood interference, which assumes the interference solely originates from units' 1-hop neighborhood [25; 36; 41; 12; 8]. This kind of assumption is more practical compared with partial interference, and thus widely applied. The third category is potential outcome model, which directly assumes the expression of potential outcome, e.g. classical Cliff-Ord auto-regressive model , linear potential outcome models[25; 39]. Actually, some potential outcome model implies neighborhood interference assumption in its mathematical expression. It's also worth to be noted that there also appear works trying to weaken the structural assumptions mentioned above and consider the interference of more general form [6; 22; 23; 18; 15].

## 2 Basic Framework

### Setup

We consider a finite population of \(n\) units, and the treatment vector is represented as \(=(z_{1},z_{2},,z_{n})\{0,1\}^{n}\). In this paper, we consider the experiment design problem in which a sensible random treatment assignment mechanism of all units is designed to achieve good performance of the resultant treatment effect estimation. We follow the Neyman-Rubin's framework . Without SUTVA assumption, we define the potential outcome of unit \(i\) as \(Y_{i}=Y_{i}()\), which means the potential outcome of unit \(i\) can depend on the treatment assignment of all units.

The parameter of interest is the global average treatment effect (GATE), which is denoted by \(\),

\[:=_{i[n]}(Y_{i}()-Y_{i}())\] (1)

Here we use \([n]\) to denote set \(\{1,2,...,n\}\), and \(()\) is the \(n\)-dimensional vector of \(1(0)\), which corresponds to global treatment and global control.

We denote the social network as \(=(,)\). The node set \(\) is \([n]\), corresponding to all units considered above. Edge set \(\) represents the social connection between units. Furthermore, we use \(d_{i}\) to denote the degree of node \(i\). We assume the graph structure \(\) is known in advance.

In this paper, we consider graph cluster randomization . Here we also assume that cluster structure is given, which is generated from certain community detection algorithm. We define \(S_{k}\) as the \(k\)-thcluster, where \(k[K]\). Clusters compose a splitting of node set, namely,

\[S_{k}[n] S_{i} S_{j}=_{k=1}^{K}S_{k}=[n]\] (2)

The graph cluster randomization implies that units in the same cluster share the same treatment assignment, namely,

\[z_{i}=z_{j} i,j S_{k},k[K]\] (3)

Since we consider randomization scheme at cluster level, it's more convenient to define cluster-level treatment vector \(=(t_{1},t_{2},...,t_{K})\{0,1\}^{K}\). Specifically, we consider the balanced cluster-level randomization scheme satisfying

\[(t_{k}=1|)=[z_{i}]=\] (4)

### Potential Outcome Model and Estimators

One of the key ideas of this paper is to deduce an appropriate objective function to optimize experiment design schemes under consideration. In this part, we will consider standard HT estimator, namely,

\[=_{i[n]}((}{[z_{i}]}- )}{[1-z_{i}]})Y_{i}())\] (5)

Then we introduce the considered potential outcome model.

**Assumption 1** (Potential Outcome Model): _The potential outcome of unit \(i\) is generated by_

\[Y_{i}()=_{i}+_{i}z_{i}+_{j N_{i}}z_{j}\] (6)

_where \(N_{i}\) is the 1-hop neighborhood of unit \(i\)._

In this potential outcome model, \(_{i}\) can be interpreted as direct treatment effect of unit \(i\), and \(\) measures the interference effect, characterizing the extent to which each unit is affected by its neighborhood in the network. This model is a simplified (in interference part) version of over-parameterized model in , in which heterogeneous interference effects are accommodated. We make a somewhat stronger assumption to simplify the structure of the bias, variance and MSE. Under this model, we can express the GATE in terms of the potential outcome model parameters,

\[=_{i[n]}(Y_{i}()-Y_{i}())=_{i[n]}(_{i}+ d_{i})\] (7)

We will then derive the bias and variance of \(\) under this potential outcome model. We point out that the number of unknown parameters in this model is still greater than the number of known potential outcomes, which can be understood as overparameterization, and we only utilize it to derive an optimizable MSE upper bound that's not concerned with estimation of \(_{i}\) and \(\) in this model. In fact, when the interference effect and the direct treatment effect are comparable at cluster-level, a multiplier of the MSE upper bound can be factored out, which is crucial in our methodology and will be shown in section 3.1.

### Bias of HT Estimator

Based on the potential outcome model, we can derive the bias and variance of our estimator explicitly. We firstly introduce cluster-level treatment assignment, \(=(t_{1},t_{2},...,t_{K})\), and matrix \(\) summarizing edges between(within) clusters with its elements defined as

\[_{ij}=|\{(u,v):(u,v),u S_{i},v S_{j}\}|\] (8)

We have following proposition about bias.

**Proposition 1** (Bias of HT Estimator): _The bias of standard HT estimator is_

\[[]-=(4( [])-_{i,j[K]}_{ij})\] (9)

_where \([]\) refers to the covariance matrix of treatment vector \(\)._

Specifically, we can delineate the source of bias in our setting. If we consider graph cluster randomization as basic scheme, edges within cluster don't contribute any bias, while every edge between clusters contributes to bias according to the covariance of cluster-level treatment assignments. This enlightens us that independent treatment assignments is far from optimal, and we can reduce bias by assigning treatments with appropriate positive correlations that should be higher for more densely connected cluster pair. Furthermore, we point out that bias may be of no account when a very sparse network is considered, but it indeed counts in our context of social network.

We also note that the treatment vector is summarized by its covariance matrix in the expression of bias. Hence, we denote the bias by \(B([])\).

### Variance of HT Estimator

To derive the variance, we plug in the potential outcome model and express the estimator as

\[=_{i=1}^{n}-_{i}+(_{i}+2_{i}- d _{i})z_{i}+2_{j N_{i}}z_{i}z_{j}\] (10)

An important difference in the derivation of variance contrasting that of bias is all base levels \(_{i}\) is no longer negligible. Hence, we consider to target at the scenes that we can acquire knowledge of all base levels in advance.

**Assumption 2** (Known Base Levels): _The base level \(_{i}\) of unit \(i\) is known in advance for all units \(i\)._

This assumption is strong in the classic context of experiment design, while we propose to target the scene where AB tests are launched by social platforms. On the one hand, the improvement in user activity indices brought by new traits or interventions, specifically, direct treatment effect and interference, is typically much smaller than the base levels \(_{i}\), which means the experiment design may be quite challenging when agnostic to base levels. On the other hand, it's very reasonable to assume that we know all \(_{i}\)s before conducting experiments since those indices we're concerned with are recorded and/or estimated daily or weekly by social platforms.

Utilizing this assumption, we can first adjust our estimator as

\[_{-}=_{i[n]}((}{[ z_{i}]}-)}{[1-z_{i}]})(Y_{i}()-_{i}))\] (11)

This adjustment has also been recommended by . Notice that this adjustment helps us remove the influence of base level \(_{i}\) when we consider variance. In the following, we'll adhere to this format and proceed to derive the variance term, which is summarized in the following proposition.

**Proposition 2** (Variance of HT Estimator): _The variance of standard HT estimator is_

\[[]=}(( ^{T}[])+4[^{T} {t},^{T}]+4^{2}[^{T}])\] (12)

_where \(\) is the vector \((_{i S_{k}}_{i}- d_{i})_{k=1}^{K}\)._

Notice that the expression of variance contains second-order term with regard to \(t\), namely, \([]\), as well as third and fourth-order terms involving \(^{T}\), a quadratic form of \(\). It's feasible to analyze the variance precisely with a specific randomization scheme, such as the independent block randomization , but it is generally not straightforward to optimize a broad set of randomization schemes in its exact form. In the following subsection, we will derive a bound of variance to transform third and fourth-order terms into second-order, which also motivates our optimized covariance design.

We comment that a bias-variance tradeoff is unveiled in the previous two propositions. Actually, \(\) is a matrix with non-negative elements, and introducing positive covariance between treatment assignments of different clusters will reduce the bias. On the other hand, introducing positive covariance means an increment in variance. In addition, though this paper doesn't involve upstream clustering algorithm, the resolution of clustering can also impact the relative importance of bias and variance, namely, low resolution usually corresponds to a higher proportion of edges within cluster, which weakens the importance of bias and stress on variance.

## 3 Optimized Covariance Design

### Constructing Objective for Optimization

Although we have derived the expression of bias and variance, the expression of variance is complicated due to the existence of treatment effects \(_{i}\)s, the interference effect \(\), and the higher-order terms involving the treatment vector. We will bypass the first hurdle by adding reasonable assumption about the direct treatment effect and interference effect. The second challenge will be addressed by a upper bound argument.

We first consider the former issue, which is the relationship between \(_{i}\) and \(_{i}\). Since we consider the interference, we propose to restrict our scope to the situation that network interference isn't too weak, which is formulated as following assumption.

**Assumption 3** (Comparability between Direct Treatment Effect and Interference): _Given potential outcome model in equation (6), we assume there exists a constant \(>0\) such that_

\[|_{k}|(_{i S_{k}}d_{i})\] (13)

_holds for each cluster \(k[K]\)._

This assumption actually demands the magnitude of interference is comparable to direct effect at cluster level. Namely, we allow a significant difference between direct treatment effect \(_{i}\) and interference \( d_{i}\) for certain units, but there isn't too much difference after aggregation in cluster. The constant \(\) can be viewed as degree of tolerance on incomparability between direct causal effect and interference and depends on the both nature of potential outcome and graph structure. It's natural that people may be more susceptible to the states of their friends in some social metrics. Since we'll utilize the MSE bound as optimization objective, this constant can also be viewed as tuning parameter that's determined by domain knowledge or pilot experiment. To demonstrate the robustness of our method, we don't tune \(\) according to the result and fix \(=1\) in the simulation, which corresponds to a moderate constraint on comparability. Empirically, our result isn't sensitive to the value of \(\).

We then discuss the latter issue. We bound all high-order terms by second or lower order terms. This effort leads to an upper bound which allows us to simply optimize the covariance matrix.

**Proposition 3** (Variance Bound): _The variance of the standard HT estimator has following upper bound,_

\[[](^{2}+4)}{n^{2}} {trace}(^{T}([]+^{T}))\] (14)

_where \(\) is the vector \((_{i S_{k}}d_{i})_{k=1}^{K}\)._

In brief, we choose to bound the third-order term by the sum of second and fourth-order terms, and bound the fourth-order term by the definition of binary treatment vector. The format is adjusted for our optimization formulation later, where we choose the covariance matrix as decision variables.

Actually, we can find that experiment design is summarized by the covariance matrix in this upper bound. Hence, we denote this upper bound by \(_{}([])\). Notice that there is a common multiplier \(^{2}\), which is associated with the unknown interference effect, in the squared bias and variance. This appealing feature allows us to optimize the MSE upper bound without estimating the parameter of the potential outcome model.

Combining proposition 1 and 3, we derive following upper bound for MSE.

**Theorem 1**: _The MSE of the standard HT estimator has following upper bound_

\[ B([])^{2}+_{}([])\] (15)

### Optimizing Covariance

Now we can discuss our experiment design. For a class of parameterized randomization schemes, one can always analyze the covariance and express the bias and variance with parameters in randomization schemes. Based on the derivation in previous section, we argue that these randomization schemes is actually specifying the patterns of covariance matrix, e.g., the block diagonal pattern. We thus choose to directly optimize the covariance matrix of randomization scheme, which is actually considering a much larger hypothesis space.

Since our decision variable is a positive semi-definite matrix, it's intuitive to make attempts for formulating the problem as positive semi-definite programming with the MSE bound acting as objective. However, notice that there is still one square term with regard to \((X)\), which appears in the \(B(X)^{2}\). If we want to transform it into semi-definite programming (SDP), we must modify the objective further. Moreover, there are some intrinsic disadvantages of this formulation. Primarily, after we solve the optimal covariance matrix, we can't directly sample from the multivariate Bernoulli distribution that is subject to this covariance matrix. Secondly, method based on mathematical programming is usually precise but not efficient enough.

To guarantee that we can sample treatment vector subject to the optimized covariance, we first present a lemma that is equivalent to the Grothendieck's identity .

**Lemma 1**: _Suppose that \((X,Y)\) follows a bivariate Gaussian distribution with correlation \(r\), namely,_

\[X\\ Y(0\\ 0,1&r\\ r&1)\] (16)

_we have_

\[[(X),(Y)]=\] (17)

This lemma enables us to sample from bivariate Bernoulli distribution with mean \((,)\) and any valid covariance. Specifically, once we solve out the optimal covariance matrix \(X^{*}\), we can sample from multivariate Gaussian distribution with \((2 X^{*})\) acting as covariance matrix, here \(\) function is element-wise. Nevertheless, it must be noted that this transformation isn't omnipotent for \(n>2\) case, namely, \((X)/2\) can't recover all possible covariance matrix of \(n\)-variable multivariate Bernoulli distribution when \(X 0\), since otherwise the multivariate Bernoulli distribution can be uniquely determined by its mean vector and covariance matrix, which is apparently false.

Moreover, we can't guarantee \((2 X^{*})\) to be positive semi-definite even if \(X^{*}\) is positive semi-definite. Motivated by this, we adopt the Cholesky-based parameterization. We set our decision variable as matrix \(R\), and we guarantee the validity of the covariance matrix of Gaussian distribution first, namely, we set the covariance matrix of Gaussian distribution as \(RR^{T}\) and the covariance matrix of (Bernoulli) treatment vector is

\[X(R)=)}{2}\] (18)

Now we can propose our final formulation

\[_{R}& M(R)=B(X(R))^{2}+_{ }(X(R))\\ &(RR^{T})_{i,j}[-1,1] i  j,\,i,j[K]\\ &(RR^{T})_{i,i}=1 i[K]\] (19)

This optimization problem is no longer convex with the introduction of \(\) function, for which we design a projected gradient descent algorithm. Since it's a non-convex optimization problem, adaptive optimizer, such as Adam  can be applied to improve the performance of the gradient descent step.

We would like to draw attention to the fact that row normalization can be viewed as a projection operator to the domain in the aforementioned formulation, with the Frobenius norm of the matrix. This fact can be verified through the Cauchy-Schwarz inequality. Additionally, we actually optimize a total of \(K K\) parameters using gradient information, which is both efficient and easy to implement.

After the optimization problem is solved, we can sample from it directly through a reparameterization of the multivariate Gaussian distribution,

\[=+(R^{*}(,I_{K}))}{2}\] (20)

## 4 Simulation Study

### Basic Setting

In this part, we carry out simulation based on a linear/multiplicative potential outcome model on a social network FB-Stanford3.3. We consider following linear potential outcome model,

\[Y_{i}()=+ z_{i}+c}{}+ _{i}+}z_{j}}{d_{i}}\] (21)

and multiplicative model, which is a simplified version of that in , with removing a covariate.

\[Y_{i}()=(+_{i})}{} (1+ z_{i}+}z_{j}}{d_{i}})\] (22)

We choose to fix all parameters except for interference density, \(\). Namely, we set \((,,c,)=(1,1,0.5,0.1)\) for both models, and set \(\{0.5,1,2\}\) to construct three regimes. \(_{i}(0,1)\).

It should be noted that these two models correspond to different model misspecification forms, aiming to demonstrate the robustness of our method.

Besides our optimized covariance design (OCD), we implement following randomization schemes. We first consider two baselines, independent Bernoulli randomization (Ber) and complete randomization (CR), both of which are cluster-level. We also implement two adaptive schemes, rerandomized-adaptive randomization (ReAR) and pairwise-sequential randomization (PSR) [25; 31], which balance heuristic covariates adaptively and act as competitive baselines, since the average degree is considered as a covariate in these two methods and exactly appear in both two of our models, explicitly. Then we implement the independent block randomization (IBR) , which represents methods that optimize parameterized randomization schemes. Nevertheless, we argue that an appropriate objective for optimization is crucial, and we propose a randomization scheme based on IBR with optimizing variance in equation (12) as objective. We nominate it as IBR-p since the heuristic solution of this scheme in our optimization problem is pairing cluster with cluster size, namely, each block is of size 2. Notice that all randomization schemes satisfy equation (4).

For every randomization scheme we consider, we perform Monte Carlo simulation that repeats randomization schemes 10,000 times and calculates the sample mean and variance of estimators.

Moreover, the oracular GATE are utilized to calculate bias.

\[_{1}&=(++c}{ }+)-(+c}{})=+\\ _{2}&=(1++)-=(+) \] (23)

At last, we set the clusters as given by Louvain algorithm with fixed random seed and resolution parameter as 10, which gives \(K=192\) clusters. We also consider other two resolution levels, namely, \(2\) and \(5\), corresponding to \(K=30,95\), respectively. The outcome under these two levels is presented in the appendix.

### Analysis of Results

From table 1 to table 2, we show the bias, standard deviation, and MSE of standard HT estimator. We also present the result under different estimator (such as difference-in-means estimator), different clustering resolution and different dataset (network topology) in the appendix due to limited space. Overall, it meets our expectation that the proposed method OCD demonstrates greater advantages over other methods when interference intensity, namely, \(\), increases. We emphasize the outstanding performance of our method in the multiplicative model and give the credit to handling the bias-variance tradeoff better. We also discover that our approach OCD isn't sensitive to the resolution level of upstream clustering, which isn't often the case for other methods, according to the thorough simulation results presented in the appendix. In reality, when there are certain densely connected cluster pairings that are assumed to have merged but have not, the clustering outcome is poor and resolution level may be inappropriate. Such pair would typically receive a high positive covariance from the optimization process in OCD, which could be regarded as adaptively fixing the fault.

In addition, we highlight that the bias usually dominates in MSE in many settings, and it almost scales linearly with interference intensity, which is exactly as shown in the expression of bias. According to our theoretical derivation, we attribute the dominance of bias to the density of social network. There is a trend that all other methods perform similarly with two baselines, since bias is dominating in a denser network, while this component is usually ignored in the experiment design, on account of the introduction of HT estimator with exposure indicator. Moreover, although we fix \(=1\) in presented result, we actually observe that our method is very robust to the choice of \(\) in related experiment.

  
**gamma** & & 0.5 & & & 1.0 & & & 2.0 & \\
**metric** & Bias & SD & MSE & Bias & SD & MSE & Bias & SD & MSE \\
**method** & & & & & & & & & & \\ 
**Ber** & -0.293 & 0.521 & 0.358 & -0.588 & 0.584 & 0.688 & -1.178 & 0.709 & 1.893 \\
**CR** & -0.292 & 0.409 & 0.253 & -0.586 & 0.459 & 0.554 & -1.177 & 0.562 & 1.702 \\
**ReAR** & -0.393 & 0.227 & 0.206 & -0.700 & 0.251 & 0.554 & -1.317 & 0.303 & 1.829 \\
**PSR** & -0.295 & 0.235 & 0.143 & -0.587 & 0.264 & 0.415 & -1.179 & 0.323 & 1.496 \\
**IBR** & -0.298 & 0.273 & 0.164 & -0.593 & 0.308 & 0.447 & -1.181 & 0.380 & 1.541 \\
**IBR-p** & -0.294 & 0.232 & **0.141** & -0.596 & 0.261 & 0.423 & -1.185 & 0.318 & 1.507 \\
**OCD** & -0.198 & 0.411 & 0.209 & -0.388 & 0.469 & **0.371** & -0.764 & 0.585 & **0.926** \\   

Table 1: The average bias, standard deviation and MSE of HT estimator under linear model

  
**gamma** & & 0.5 & & & 1.0 & & & 2.0 & \\
**metric** & Bias & SD & MSE & Bias & SD & MSE & Bias & SD & MSE \\
**method** & & & & & & & & & \\ 
**Ber** & -0.365 & 0.348 & 0.255 & -0.736 & 0.394 & 0.698 & -1.475 & 0.493 & 2.421 \\
**CR** & -0.368 & 0.235 & 0.191 & -0.744 & 0.274 & 0.629 & -1.477 & 0.336 & 2.297 \\
**ReAR** & -0.402 & 0.178 & 0.194 & -0.809 & 0.174 & 0.685 & -1.548 & 0.226 & 2.450 \\
**PSR** & -0.366 & 0.134 & 0.152 & -0.738 & 0.153 & 0.569 & -1.479 & 0.192 & 2.227 \\
**IBR** & -0.369 & 0.155 & 0.161 & -0.737 & 0.178 & 0.576 & -1.484 & 0.221 & 2.252 \\
**IBR-p** & -0.368 & 0.163 & 0.163 & -0.739 & 0.185 & 0.581 & -1.482 & 0.232 & 2.252 \\
**OCD** & -0.258 & 0.040 & **0.069** & -0.517 & 0.050 & **0.271** & -1.034 & 0.054 & **1.073** \\   

Table 2: The average bias, standard deviation and MSE of HT estimator under multiplicative model Finally, we point out that the distribution of proportion of treated units of optimized randomization scheme is usually bimodal (e.g. peak at 45%, 55%) in our randomization scheme, with the mean still 50%. This bimodal pattern is the outcome of introducing non-zero covariance on almost all off-diagonal positions of covariance matrix. This is different from other methods we considered here, for which the proportion is usually strictly 50% or unimodal and concentrates at its mean, 50%.

## 5 Discussion

In this article, we derive the bias and variance of the standard HT estimator under a parametric potential outcome model and construct an optimizable objective based on the derived MSE. We then propose an appropriate formulation to transform the experiment design into an optimization problem with the covariance matrix of treatment vector acting as decision variables. Besides, we propose an algorithm based on projected gradient descent to provide optimized covariance design that supports legitimate sampling. Finally, we implement a series of methods and compare their performance in diverse settings, where the advantage of our methods is demonstrated.

We stress the significance of bias and propose our method to make attempts for balancing bias and variance better. Actually, almost all potential outcome models used in the simulation part of related works admit neighborhood interference assumption, which makes the estimator using exposure indicator unbiased or nearly unbiased. However, we argue that this assumption is reasonable but also restricts our scope. There have recently been some works considering interference beyond this assumption, where bias is also demonstrated to be important.

Although there has been a lot of variance bound in this area, few of them can guide experiment design directly, and we have actually made many attempts on finding appropriate variance bound. For example, the gradient of fourth-order term \(t^{T}Ct^{2}\) can be estimated directly through REINFORCE estimator  without need of upper bound. Nevertheless, the optimized covariance matrix tends to give a proportion of densely linked cluster pairs high correlation (near to 1), causing the covariance matrix to become nearly singular. This, in turn, leads to catastrophic gradient variance that can't be reduced by conventional technique such as . In addition, weaker assumption on comparability between direct effect and interference is feasible. We can only demand there exists \(^{}>0\) such that \(\|\|_{2}^{}\|\|_{2}\). This weaker assumption corresponds to spectral norm bound on the second order term \(^{T}[tt^{T}]\), which is a looser bound and finally produces a empirically worse solution. This bound is also utilized in  and is expressed as the worst-case variance, which is concerned with maximizing a convex objective over bounded potential outcomes. The optimal value is taken when potential outcome is taken as the endpoint value of its domain, which is too conservative to have good empirical performance. The simulation result of IBR can support this claim, since similar worst-case variance is utilized in IBR.

Additionally, our work can be improved and extended in several aspects. Firstly, the optimization objective can be improved with a tighter but still optimizable upper bound on variance. Moreover, the situation of non-balanced treatment assignment, i.e., \([z_{i}]\), is worthy of exploration. Besides, the derivation for more complex estimator is kept explorable, e.g., the difference-in-means estimator, and HT estimator with exposure indicator. Our derivation is performed on the standard HT estimator, and structural assumption is introduced when the derivation encounters essential difficulties. In addition, the basic setting beyond neighborhood interference assumption also warrant further extension.