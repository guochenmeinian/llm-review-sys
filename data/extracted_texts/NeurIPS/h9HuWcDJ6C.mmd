# Beyond MD17: The xxMD Dataset as a Chemically Meaningful Benchmark for Neural Force Fields Development

Beyond MD17: The xxMD Dataset as a Chemically Meaningful Benchmark for Neural Force Fields Development

 Zihan Pengmei

Department of Chemistry

The University of Chicago

Janyu Liu

Pritzker School of Molecular Engineering

The University of Chicago

&Yinan Shu

Department of Chemistry

University of Minnesota

Kadanoff Center for Theoretical Physics, The University of Chicago, Chicago, IL 60637, USA. qBraid Co., Chicago, IL 60615, USA. SeQure, Chicago, IL 60615, USA

###### Abstract

Neural force fields (NFFs) have gained prominence in computational chemistry as surrogate models, superseding quantum-chemistry calculations in ab initio molecular dynamics. The prevalent benchmark for NFFs has been the MD17 dataset and its subsequent extension. These datasets predominantly comprise geometries from the equilibrium region of the ground electronic state potential energy surface, sampling from direct adiabatic dynamics. However, many chemical reactions entail significant molecular deformations, notably bond breaking. We demonstrate the constrained distribution of internal coordinates and energies in the MD17 datasets, underscoring their inadequacy for representing systems undergoing chemical reactions. Addressing this sampling limitation, we introduce the xxMD (Extended Excited-state Molecular Dynamics) dataset, derived from non-adiabatic dynamics. This dataset encompasses energies and forces ascertained from both multireference wave function theory and density functional theory. Furthermore, its nuclear configuration spaces authentically depict chemical reactions, making xxMD a more chemically relevant dataset. Our re-assessment of equivariant models on the xxMD datasets reveals notably higher mean absolute errors than those reported for MD17 and its variants. This observation underscores the challenges faced in crafting a generalizable NFF model with extrapolation capability.

## 1 Introduction

The data-driven evolution of molecular force fields is predominantly benchmarked against the **MD17** dataset introduced by Chmiela et al.  and its derivative, the rMD17 . These datasets encompass dynamic data of ten small to medium-sized gas-phase molecules. While it's a common practice in machine learning community to consider both training and testing data as in-domain, this assumption is precarious for molecular dynamics. Such data, inherently being time-series sequences, mandates careful sampling to prevent unintended leakage of future information. A closer scrutiny of MD17 and its variant reveals their sampling bias, majorly confined to an exceedingly narrow **potential energy surface (PES)** in proximity to the equilibrium structure. This limited exploration translates to a circumscribed conformation and energy space. To highlight these shortcomings, we employ internal coordinate analysis, revealing that existing molecular dynamics datasets are suboptimal concerning their segmentation strategy and the scope of molecular conformation space they cover.

For our analysis, we label those preliminary molecular dynamic datasets as **in-distribution (ID)** datasets. Nevertheless, significant chemical processes typically fall under the **out-of-distribution (OOD)** category. To underscore this discrepancy, consider the simplest chemical reaction depicted in Figure 1. The nuclear configuration space in this instance encompasses three pivotal regions: the reactant, the product, and the transition state (or the dividing plane) bridging the reactant and product. Merely sampling from the reactant region is inadequate and does not authentically represent chemical reactions. Consequently, calibrating NFF models on these skewed datasets induces a bias towards the reactant region. This can not only skew the NFF models but might also lead them to offer qualitatively inaccurate insights.

In this study, we introduce the **extended excited-state molecular dynamics (xxMD)** dataset, a successor to the MD17 dataset. While it retains the foundational aspect of encapsulating trajectory data from small to medium-sized gas-phase molecules, the xxMD stands apart due to its incorporation of **non-adiabatic** trajectories, emphasizing the dynamics associated with excited electronic states.[8; 24; 23; 4] Comprising four photo-sensitive molecules, these entities start within the excited electronic states, endowing them with a notably higher initial energy in contrast to their MD17 or rMD17 counterparts. This distinction leads the xxMD dataset to span a broader nuclear configuration space, ensuring representation across the complete chemical reaction PES: reactants, transition states, and products. A salient feature of the xxMD is its capture of regions near the conical intersections--crossings of potential energies spanning different electronic states. By encompassing these critical regions, including reactants, transition states, products, and conical intersections, the xxMD dataset promises to set novel benchmarks and challenges for NFF models.

For our xxMD dataset, we diverge from the MD17's framework by employing the trajectory surface hopping dynamics algorithm in tandem with the **state-averaged complete active state self-consistent field (SA-CASSCF)** electronic theory. This approach stands in contrast to the adiabatic dynamics used in MD17. The reason for the pivot to SA-CASSCF lies in its adeptness at handling electronic correlation effects at strongly deformed geometries, where KS-DFT often falls short, especially in scenarios involving multiple electronic states and conical intersections. Nevertheless, to ensure compatibility with prevalent datasets like MD17, we also computed single-point **spin-polarized KS-DFT (or unrestricted KS-DFT)** values. These calculations leverage the **M06** exchange-correlation functional--a notably superior **meta-GGA** functional relative to PBE. This dual approach culminates in two datasets: **xxMD-CASSCF** and **xxMD-DFT**. The former captures potential energies and forces across the first three electronic states for azobenzene, dithiophene, malonaldehyde, and stilbene. The latter provides recomputed ground-state energy and force values, anchored to the same trajectories. Both xxMD datasets are structured via a **temporal split** method, partitioning training and testing data based on trajectory timesteps.

We evaluated six prominent message-passing NFF models on the xxMD datasets: SchNet, DimeNet++ (DPP), SphereNet (SPN), NequIP, Allegro, and MACE. Each model was mostly used with its default parameters, and in line with convention, we trained the NFFs emphasizing more on force losses. While hyperparameter optimization could potentially fine-tune performance (See Supplementary Information for an example), it remains outside the scope of this study. Therefore, the presented results might not showcase the absolute best performance for each model. Given our observations, we urge researchers aiming to apply NFFs in practical scenarios to conduct rigorous re-benchmarks tailored to their specific chemical systems and objectives.

## 2 Preliminaries

In the realm of quantum mechanics, the behavior of nuclei is ideally described by the time-dependent Schrodinger equation. Yet, practical computation limits restrict nuclear quantum dynamics simulations to small systems with just 5 or 6 atoms. Consequently, in many cases, the nuclei are treated as classical particles. This premise paves the way for classical Molecular Dynamics (MD) and adiabatic Ab Initio Molecular Dynamics (AIMD), wherein the dynamics are propagated based on a **single electronic state**.

### Dynamics

At the heart of classical MD is the Newtonian equation of motion:

\[m_{i}_{i}}{dt^{2}}=_{i}\] (1)

where \(m_{i}\) denotes the mass of atom \(i\), \(_{i}\) its position, and \(_{i}\) the force exerted on it. This force can be described as the negative gradient of the potential energy \(V\) at the atom's location:

\[_{i}=- V(_{i})\] (2)

The ground state electronic potential energy, \(V(_{i})\), in the absence of an external field, forms the basis for the PES. Classical force fields offer an analytical approximation of this energy based on nuclear configuration:

\[V()=V_{}()+V_{}()+V_{ }()+V_{}()\] (3)

This classical approximation often falls short under quantum mechanical scenarios, particularly during bond breaks, necessitating improvements in force field formulations. Upon electronic excitation, as observed in solar cells or photochemical reactions, nuclei confront electronic potentials beyond the ground state. Herein, dynamics involving multiple electronic states emerge. Nonadiabatic dynamics, particularly pertinent when energy levels soar, may either adopt the trajectory surface hopping method or the semiclassical Ehrenfest dynamics, depending on the specific conditions.

### Chemical Reactions and PES

Chemical reactions within the classical MD or adiabatic AIMD framework involve a system transition between different PES minima. This movement is influenced by differences in electronic potential energy across nuclear configurations. However, systems generally adopt paths that demand minimal effort, known as reaction pathways. Accurate NFFs demand two crucial ingredients: a quantum chemical dataset spanning reactants, transition states, and products, and a proficient machine learning model capable of extrapolating across the PES. Notably, nonadiabatic dynamics can help curate datasets that offer richer nuclear configuration insights compared to adiabatic AIMD.

## 3 Dataset

### MD17 and Revised MD17 Datasets (rMD17)

**The use of the PBE density functional in conjunction with single-valence basis sets often falls short in simulating chemically meaningful reactions.** Chmiela et al. conducted adiabatic AIMD simulations on small gas-phase molecules at room temperature, purporting the electronic potential energies to be computed at the KS-DFT level. However, detailed specifics about the density functional, basis set, spin-polarization, and the software employed were notably absent from both the main

Figure 1: Illustration of trajectories on a sample potential energy surface. The contour plot showcases the energy landscape, with varied hues depicting distinct energy tiers. Predominantly, trajectories navigate regions surrounding the minima, emphasizing systems’ inclination towards states with diminished potential energy in or near equilibrium.

manuscript and supporting information. Later, Christensen et al. revisited the potential energies and forces of the MD17 dataset, recalculating them at the PBE/def2SVP level of theory with an enhanced grid precision, leading to the inception of the rMD17 dataset. These datasets have been embraced widely as benchmarks in NFF studies[3; 2]. It's pivotal to underscore the inadequacy of employing the PBE density functional and def2SVP basis set for accurate chemical reaction simulations, as they can sometimes yield both quantitatively and qualitatively erroneous outcomes. Despite this, they might offer a continuous PES dependent on nuclear configuration, suggesting that the MD17 and rMD17 could be considered well-behaved datasets.

**Adiabatic molecular dynamics datasets at low energy can not benefit from uniform sampling and cross-validation.** It's important to highlight that the initial low-energy conditions in these adiabatic AIMD simulations constrain the nuclear configuration space considerably. As illustrated in Figure 1, adiabatic AIMD simulations at ambient conditions tend to produce trajectories that linger primarily within the reactant zone of the PES. To scrutinize the nuclear configuration space covered in the MD17 and rMD17 datasets, we analyzed the internal coordinate distributions of two specific molecules: the C-N=N-C dihedral angle and N=N bond length for azobenzene, as well as the C-C-C=O dihedral angle and C=O bond length for malonaldehyde. These distributions are visualized in Figure 2. Additionally, Figure 2 portrays the relative electronic potential energies, benchmarked against the ground state minimum geometry, and the force norm (essentially the electronic potential energy derivative) corresponding to these geometries. It's evident from the findings that the internal coordinate distribution is notably constricted. Consequently, this suggests that the training and testing samples in the MD17 and rMD17 datasets overlap significantly. Such overlaps flag concerns related to potential data leakage, which could inadvertently lead to unduly optimistic benchmark outcomes as cited in previous literature [1; 2; 3; 20; 12].

### xxMD dataset

**An updated alternative to the MD17 dataset is imperative for the effective development and benchmarking of NFFs.** To meet this need, we introduce the **xxMD** dataset, curated specifically for benchmarking NFFs in the context of chemical reactions. This dataset encompasses four molecular entities: azobenzene, malonaldehyde, stilbene, and dithiophene. Key geometries along their respective reaction trajectories are depicted in Figure 6. It's noteworthy that both azobenzene and malonaldehyde are constituents of the MD17 and rMD17 datasets. This inclusion facilitates a comparative analysis of the internal coordinate distribution between the xxMD and the previously mentioned datasets. We refer readers to the supplementary information for the comparison.

**The cornerstone of the xxMD datasets is the non-adiabatic dynamic sampling.** We employed the trajectory surface hopping (TSH) nonadiabatic dynamics, interfaced with the SA-CASSCF  electronic structure method, for all included molecules. In stark contrast to KS-DFT, SA-CASSCF

Figure 2: Illustration of training and testing sets using the reference split indices for azobenzene and malonaldehyde datasets in rMD17. The X-axis depicts dihedral angles (marked by ’C’, ’N’, and ’O’), the Y-axis denotes bond distances (highlighted by bold letters), and the Z-axis shows relative energy. Training and testing samples are differentiated by color, correlating to force norms. Note that training samples overlap with testing ones.

ensures qualitative precision in representing the global PES--encompassing both bond-breaking geometries and conical intersections[11; 21]. Our data selection prioritized samples from energy-conserving trajectories exclusively, with the criteria for total energy conservation. The sample size is listed in Table 9. Current NFF methodologies have demonstrated the capability to attain chemical precision vis-a-vis the foundational electronic structure calculations, even with a dataset of fewer than 1,000 training samples [19; 12; 3; 2; 20]. Comprehensive computational specifics can be found in the Supplementary Information.

**The ensemble-averaged radial distribution function (RDF) and mean square displacement (MSD) from the xxMD datasets demonstrate a more expansive and meaningful sampling of the PES than that of MD17.** Both the RDF and MSD of nuclear configurations as functions of time are depicted in the left and right columns of Figure 3, respectively. While the RDF quantifies the average likelihood of finding a particle at a particular radial distance from a reference configuration, the MSD gauges the average squared movement of molecules over time. The nuclear configuration shifts evident in nonadiabatic dynamics--and by extension, in the xxMD dataset--are substantial. This dynamic sampling breadth sets the xxMD dataset distinctly apart from the MD17 datasets and its variants. With the xxMD dataset capturing diverse regions on the PESs, we anticipate that mastering the PESs for molecules within this dataset will pose a significantly greater challenge.

**Spin-unpolarized DFT is ill-suited for simulating chemical reactions involving bond-breaking or bond-forming events.** From the geometries sampled through TSH with SA-CASSCF dynamics, we recalculated the ground-state potential energy and atomic forces employing spin-polarized KS-DFT at the M06/6-31g level. It's worth noting that M06 is a hybrid meta-GGA exchange-correlation functional, which delivers notably superior accuracy compared to PBE. Crucially, spin-unpolarized (or unrestricted) KS-DFT falls short when simulating chemical reactions, particularly during bond-breaking events due to the reactions' open-shell nature. For clarity, we've named the dataset derived from these recalculations as the **xxMD-DFT** dataset, whereas our principal dataset is referred to as the **xxMD-CASSCF** dataset.

**Temporal splitting presents a formidable yet insightful test for NFFs in predicting unexplored sections of the PES.** In curating the xxMD datasets, we favored temporal over random splitting. While the latter uniformly divides data by shuffling all sampled geometries and randomly segregating them into training, validation, and testing sets, temporal splitting allocates time-series data based on timesteps. A designated range of timesteps in the dynamic sequence is reserved as the hold-out test set, adhering to a 50:25:25 splitm, granting a unique vantage point to scrutinize the predictive prowess of the model over unseen portions of PESs. This distinction becomes evident in the right columns of Figure 3 where trajectories rapidly deviate over time. This behavior underscores that the temporal-split xxMD datasets adeptly challenge the extrapolation and predictive power of NFFs.

## 4 Experiment

We picked six representative equivariant NFFs to benchmark. The hyperparameters and training details of models in the supplementary information. We used a weighted loss of 1:1000 on energy and forces. We stress that our purpose is not to perform an extensive comparison of models over multiple choices of hyperparameters. Rather, we limit ourselves to showing the performance of the models in the default configurations.

### Complete xxMD-CASSCF and xxMD-DFT

We first evaluate the regression precision of all models on the first three electronic states, which are labeled as \(S_{0}\), \(S_{1}\), and \(S_{2}\) respectively (Label \(S\) denotes the singlet spin state which is a widely used notation in photochemistry) by using the temporal splitting approach. The MAE of the predictive energy and forces for test sets are shown in Table 1. Similarly, we present such results of using xxMD-DFT datasets in Table 2. Additional results on the validation sets are available in the supporting information. Note that validation sets depict the nuclear configurations that are closer to the training sets. Therefore, the MAE shown in validation sets are in general lower than that for test sets.

Figure 3: Comparison of Average RDFs and MSDs Across Multiple Trajectories. Each row corresponds to a group of trajectories, with RDF on the left (indicating particle density as a function of distance) and MSD on the right (showing particle displacement over time). Shaded regions represent standard deviations.

### Model behavior comparison between xxMD and (r)MD17 datasets

In this section, we analyze model behavior for azobenzene and malonaldehyde from xxMD and (r)MD17 datasets. Benchmarks for (r)MD17 reveal that the accuracy of MACE, NequIP, and SPN exceeds that of traditional electronic structure methods[2; 3; 12; 14]. It's essential to note that typical errors for KS-DFT in predicting relative transition state energy can be several kcal/mol. For instance, the MAE of HTBH38 and NHTBH38 is about 9.1 kcal/mol for PBE and 2.4 kcal/mol for M06. Thus, an NFF fitting error below 50 meV would surpass the accuracy of modern density functionals. However, such claims are pertinent mainly to ground state potential energies, given that excited state calculations are often less precise. Therefore, given the reported MAEs, these NFF models perform admirably on (r)MD17 datasets.

  
**Dataset** & **Task** & **MACE** & **Allegro** & **NequIP** & **SchNet** & **DPP** & **SPN** \\  Azobenzene & E & 292 & **174** & 1754 & 722 & 300 & 260 \\  & F & **85** & 110 & 129 & 283 & 173 & 168 \\  Stilbene & E & **315** & 332 & 647 & 397 & 439 & 477 \\  & F & **149** & 189 & 156 & 291 & 162 & 168 \\  Malonaldehyde & E & 190 & **151** & 244 & 360 & 179 & 185 \\  & F & **166** & 210 & 227 & 394 & 257 & 255 \\  Dithiophene & E & 100 & 103 & 243 & 323 & **61** & 76 \\  & F & **51** & 75 & 101 & 177 & 74 & 90 \\   

Table 2: Comparison of predictive MAE of energy(E, meV) and forces(F, meV/A) on hold-out testing set for different models xxMD-DFT datasets and tasks with temporal split.

  
**Dataset** & **Task** & **MACE** & **Allegro** & **NequIP** & **SchNet** & **DPP** & **SPN** \\  Azobenzene & E & 292 & **174** & 1754 & 722 & 300 & 260 \\  & F & **85** & 110 & 129 & 283 & 173 & 168 \\  Stilbene & E & **315** & 332 & 647 & 397 & 439 & 477 \\  & F & **149** & 189 & 156 & 291 & 162 & 168 \\  Malonaldehyde & E & 190 & **151** & 244 & 360 & 179 & 185 \\  & F & **166** & 210 & 227 & 394 & 257 & 255 \\  Dithiophene & E & 100 & 103 & 243 & 323 & **61** & 76 \\  & F & **51** & 75 & 101 & 177 & 74 & 90 \\   

Table 1: Comparison of predictive MAE of energy(E, meV) and forces(F, meV/A) on hold-out testing set for different models on temporally split xxMD-CASSCF datasets and tasks.

However, this conclusion might be deceiving. Previous discussions highlight the constrained nuclear configuration space in MD17 and rMD17. A comparative analysis of MAEs for the six NFF models on azobenzene and malonaldehyde from xxMD-DFT and (r)MD17 is presented in Table 3. Literature-derived MD17/rMD17 results indicate that all models used 1,000 training samples. Predictably, the predictive progress of NFF models diminishes when applied to the xxMD dataset.

## 5 Conclusion

The effectiveness of NFF models largely depends on the datasets they are benchmarked against. Historically, the (r)MD17 datasets have been the gold standard for this purpose. However, our study highlights the potential shortcomings of relying solely on (r)MD17 datasets. Given that they primarily capture a narrow nuclear configuration space from ground state ab initio molecular dynamics, they fall short of encompassing the holistic nuclear configuration pertinent to chemical reactions. Training NFF models on such datasets can be somewhat trivial and could result in misleading conclusions about their true capabilities.

Addressing this gap, we introduced the xxMD dataset, derived from nonadiabatic dynamics trajectories. The xxMD dataset offers a comprehensive representation of the nuclear configuration space, encapsulating the reactant, transition state, product, and conical intersection regions of potential energy surfaces. Its inclusion of several low-lying excited state potential energy surfaces underscores its importance and the challenges it presents for NFF model development. Our benchmarks of prevailing NFF models on the xxMD dataset have revealed pronounced difficulties. Utilizing default hyperparameters, the chosen NFF models struggled to offer quantitatively or even qualitatively accurate force field models for specific systems. We anticipate that our findings will galvanize the community towards pioneering more advanced NFF models better equipped to study intricate chemical reactions.

  
**Molecule** & **Dataset** & **Task** & **MACE** & **Allegro** & **NequIP** & **SchNet** & **DPP** & **SPN** \\  Azobenzene & rMD17 & E & 1.2 & 1.2 & 0.7 & N/A & N/A & N/A \\  & & F & 3.0 & 2.6 & 2.9 & N/A & N/A & N/A \\  & xxMD & E & 292 & 174 & 1754 & 722 & 300 & 260 \\  & & F & 85 & 110 & 129 & 283 & 173 & 168 \\  Malonaldehyde & (r)MD17 & E & 0.8 & 0.6 & 0.8 & 5.6 & 4.5 & N/A \\  & & F & 4.1 & 3.6 & 5.1 & 28.6 & 16.6 & 7.5 \\  & xxMD & E & 190 & 151 & 244 & 360 & 179 & 185 \\  & & F & 166 & 210 & 227 & 394 & 257 & 255 \\   

Table 3: Comparison of predictive MAE on hold-out testing sets of NFF models on azobenzene and malonaldehyde in (r)MD17 and xxMD-DFT datasets. (r)MD17 benchmarks with 1,000 samples are taken from .