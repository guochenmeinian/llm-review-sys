# On the estimation of persistence intensity functions and linear representations

of persistence diagrams

Anonymous Author(s)

Affiliation

Address

email

###### Abstract

Persistence diagrams are one of the most popular types of data summaries used in Topological Data Analysis. The prevailing statistical approach to analyzing persistence diagrams is concerned with filtering out topological noise. In this paper, we adopt a different viewpoint and aim at estimating the actual distribution of a random persistence diagram, which captures both topological signal and noise. To that effect,  has shown that, under general conditions, the expected value of a random persistence diagram is a measure admitting a Lebesgue density, called the persistence intensity function. In this paper, we are concerned with estimating the persistence intensity function and a novel, normalized version of it - called the persistence density function. We present a class of kernel-based estimators based on an i.i.d. sample of persistence diagrams and derive estimation rates in the supremum norm. As a direct corollary, we obtain uniform consistency rates for estimating linear representations of persistence diagrams, including Betti numbers and persistence images. Interestingly, the persistence density function delivers stronger statistical guarantees.

## 1 Introduction

_Topological Data Analysis_ (TDA) is a field at the interface of computational geometry, algebraic topology and data science whose primary objective is to extract topological and geometric features from possibly high-dimensional, noisy and/or incomplete data. The literature on the statistical analysis of TDA summaries has mainly focused on distinguishing topological signatures from the unavoidable topological noise resulting from the data sampling process. Toward that goal, the primary objective in designing statistical inference methods for TDA is to isolate points on the sample persistence diagrams that are sufficiently far from the diagonal to be deemed statistically significant in the sense of expressing underlying topological features instead of randomness. This paradigm is entirely natural when the target of inference is the unobservable persistence diagram arising from a filtration of interest, and the sample persistent diagrams are noisy and imprecise approximations to it. On the other hand, empirical evidence has also demonstrated that topological noise is not unstructured and, in fact, may also carry expressive and discriminative power that can be leveraged for various machine-learning tasks. In some applications, the distribution of the topological noise itself is of interest; in cosmology, see e.g., . As a result, statistical summaries able to express the properties of both topological signal and topological noise in a unified manner have also been proposed and investigated: e.g., persistence images andlinear functional of the persistence diagrams. In a recent contribution,  has derived sufficient conditions to ensure that the expected persistent measure - the expected value of the random counting measure corresponding to a noisy persistent diagram - admits a Lebesgue density, hereafter called the persistence intensity function; see also . The significance of this result is multifaceted. First, the persistent intensity function provides an explicit and highly-interpretable representation of the entire distribution of the persistence homology of random filtrations. Secondly, it allows for a straightforward calculation of the expected linear representation of a persistent diagram as a Lebesgue integral. Finally, the representation provided by the persistence intensity function is of functional, as opposed to algebraic, nature and thus analytically simpler. It is amenable to statistical analysis via well-established theories and methods from the non-parametric statistics literature.

In this paper we derive consistency rates of estimation of the persistence intensity function and of a novel variant called persistence density function in the \(_{}\) norm based on a sample of i.i.d. persistent diagrams. As we argue below in Theorem 3.1, controlling the estimation error for the persistence intensity function in the \(_{}\) norm is stronger than controlling the optimal transport measure \(_{q}\) for any \(q>0\) and, under mild assumptions, immediately implies uniform control and concentration of any bounded linear representation of the persistence diagram including (persistent) Betti numbers and persistence surfaces.

## 2 Background and definitions

In this section we introduce fundamental concepts from TDA that we will use throughout the paper. We refer the reader to  for detailed background and extensive references.

Persistence diagrams.We define a persistence diagram to be a locally finite multiset of points \(D=\{_{i}=(b_{i},d_{i}) 1 i N(D)\}\) belonging to the set

\[=(L)=\{(b,d) 0<b<d L\}^{2},\] (1)

consisting of all the points on the plane in the positive orthant above the identity line and of coordinate values no larger than a fixed constant \(L>0\). The coordinates of each point of \(D\) correspond to the birth and death times of a persistent homology feature, where time is measured with respect to the totally ordered set indexing a filtration. The restriction that the persistence diagrams be contained in a box of side length \(L\) is a mild assumption that is widely used in the TDA literature; see  and the discussion therein. To simplify our notation, we will omit the dependence on \(L\), but we will keep track of this parameter in our error bounds. Some related quantities used throughout are

\[ \{(x,x) 0 x L\}; ;\] \[_{} \{:_{x} \|-\|_{2}\},(0,L/).\] (2)

That is, \(\) is a segment on the diagonal in \(^{2}\) and \(_{}\) consists of all the points in \(\) at a Euclidean distance of \(\) or smaller from it.

The expected persistent measure and its normalization.A persistence diagram \(D=\{_{i}=(b_{i},d_{i}) 1 i N(D)\}\) can be equivalently represented as a counting measure \(\) on \(\) given by

\[A(A)=_{i=1}^{N(D)}_{_{i}}(A),\]

where \(=()\) is the class of all Borel subsets of \(\) and \(_{}\) denotes the Dirac point mass at \(\). We will refer to \(\) as the _persistence measure_ corresponding to \(D\) and, with a slight abuse of notation, will treat persistence diagrams as counting measures. If \(D\) is a random persistence diagram, then the associated persistence measure is also random. In addition to the persistence measure \(\) associated to a persistence diagram \(D\), we will also study its _normalized measure_\(\), which is the persistence measure divided by the total number of points\(N(D)\) in the persistence diagram. In detail, \(\) is the (possibly random) probability measure on \(\) given by

\[A(A)=_{i=1}^{N(D)}_{ _{i}}(A).\]

The normalized persistence measure may be desirable when the number of points \(N(D)\) in the persistence diagram is not of direct interest but their spatial distribution is. This is typically the case when the persistence diagrams at hand contain many points or are obtained from large random filtrations (e.g. the Vietoris-Rips complex built on point clouds), so that the value of \(N(D)\) will mostly accounts for noisy topological fluctuations due to sampling.

We will consider the setting in which the observed persistence diagram \(D\) is a random draw from an unknown distribution. Then, the (non-random) measures

\[A[](A)=[(A)]  A[](A)=[ (A)]\]

are well defined. We will refer to \([]\) and \([]\) as the _expected persistence measure_ and the _expected persistence probability_, respectively. Notice that typically, neither is a discrete measure, and that the expected persistence probability is a probability measure by construction.

The interpretations of the measure \([]\) and the probability measure \([]\) is straightforward: for any Borel set \(A\), \([](A)\) is the expected number of points from the random persistence diagram falling in \(A\), while \([](A)\) is the probability that a random persistence diagram will intersect \(A\). As a result, they are able to directly express the randomness of the distribution of persistence diagram including structural properties of the topological noise. Despite their interpretability, the expected persistence measure and probability are not yet standard concepts in the practice and theory of TDA. As a result, they have not been thoroughly investigated.

The persistence intensity and density functions and linear representations.In a recent, important contribution,  derived conditions - applicable to a wide range to problems - that ensure that the expected persistence measure \([]\) and its normalization \([]\) both admit densities with respect to the Lebesgue measure on \(\). Specifically, under fairly mild and general conditions detailed in  there exist measurable functions \(p:_{ 0}\) and \(:_{ 0}\), such that for any Borel set \(A\),

\[[](A)=_{A}p(), [](A)=_{A}() .\] (3)

In fact,  provided explicit expressions for \(p\) and \(\) (see Section D.5). Notice that, by construction, \(\) integrates to \(1\) over \(\). We will refer to the functions \(p\) and \(\) as the _persistence intensity_ and the _persistence density_ functions, respectively. We remark that the notion of a persistence intensity function was originally put forward by .

The persistence intensity and density functions "operationalize" the notions of expected persistence measure and expected persistence probability introduced above, allowing to evaluate, for any Borel set \(A\), \([](A)\) and \([](A)\) in a straightforward way as Lebesgue integrals.

The main objective of the paper is to construct estimators \(\) and \(\) of the persistence intensity \(p\) and persistence density \(\), respectively, and to provide high probability error bounds with respect to the \(L_{}\) norm. As we show below in Theorem 3.1,\(L_{}\)-consistency for the persistence intensity function is a stronger guarantee than consistency in the \(_{p}\) metric, for any \(p<\). Interestingly, we find that estimation of the persistence probability density function is statistically easier, in the sense that uniform estimation error bounds can be obtained for all points in \(\). In contrast, estimating the persistence intensity function becomes progressively more difficult for points near \(\). See Theorem 3.6 below.

Linear representations of persistence diagrams.As noted in , the persistence intensity and density functions are naturally suited to compute the expected value of linear representations of random persistence diagrams. A linear representation \(\) of the persistence diagram \(D=\{_{i}=(b_{i},d_{i}) 1 i N(D)\}\) with corresponding persistence measure \(\) is a summary statistic of \(D\) of the form

\[(D)=_{i=1}^{N(D)}f(_{i})=_{}f()d(),\] (4)

for a given measurable function \(f\) on \(\). (An analogous definition can be given for the normalized persistence measure \(\) instead). Then,

\[[(D)]=_{}f()d[]()=_{ }f()p()d,\] (5)

where the second identity follows from (3). Linear representations include persistent Betti numbers, persistence surfaces, persistence silhouettes and persistence weighted Gaussian kernels.

The _persistence surface_ is an especially popular linear representation introduced by . In detail, for a _kernel function_\(K():^{2}_{ 0}\) and any \(^{2}\), let \(K_{h}()=}K(}{h})\), where \(h>0\) is the bandwidth parameter1. The persistence surface of a persistence measure \(\) is defined as

\[_{h}()=_{}f()K_{h}(-)(),\] (6)

where \(f()^{2}\) is the user-defined _weighting function,_ chosen to ensure stability of the representation. Our analysis allows to immediately obtain consistency rates for the expected persistence surface in \(L_{}\) norm, which, for brevity, we present in the supplementary material (see Theorem B.5). Instead we focus on the estimation error the expected Betti numbers.

Betti and the persistent Betti numbers.The **Betti number** at scale \(x[0,L]\) is the number of persistent homologies that are in existence at "time" \(x\). Furthermore, the **persistent Betti number** at a certain point \(=(x_{1},x_{2})\) measures the number of persistent homologies that are born before \(x_{1}\) and die after \(x_{2}\). In our notation, given a persistence diagram \(D\) and its associated persistence measure \(\), for \(x[0,L]\) and \(=(x_{1},x_{2})\), the corresponding Betti number and persistent Betti number are given by

\[_{x}(D)=(B_{x})_{}(D)=(B _{}),\]

respectively, where \(B_{x}=[0,x)(x,L]\) and \(B_{}=[0,x_{1})(x_{2},L]\). Though Betti numbers are among the most prominent and widely used TDA summaries, relatively little is known about the statistical hardness of estimating their expected values when the sample size is fixed and the number of persistence diagrams increases. Our results will yield error bounds of this type. We will also consider normalized versions of the Betti numbers defined using the persistence probability \(\) of the persistence diagram:

\[_{x}(D)=(B_{x}) _{}(D)=(B_{}).\]

Notice that, by definition, \(_{}(D) 1\). While their interpretation is not as direct as the Betti numbers computed using persistence diagrams, the expected normalized (persistence) Betti numbers are informative topological summaries while showing favorable statistical properties (see Theorem 3.12 below).

## 3 Main results

### The OT distance between measures and \(L_{}\) distance between intensity functions

A popular and, arguably, natural metric for persistence diagrams - and, more generally, locally finite Radon measures such as normalized persistence measures and probabilities - is the _optimal transport_ distance; see, e.g., . In detail, for two Radon measures \(\) and \(\) supported on \(\), an _admissible transport_ from \(\) to \(\) is defined as a function \(:\), such that for any Borel sets \(A,B\),

\[(A)=(A),( B)=(B).\]

Let \((,)\) denote all the admissible transports from \(\) to \(\). For any \(q^{+}\{\}\), the \(q\)-th order Optimal Transport (OT) distance between \(\) and \(\) is defined as

\[_{q}(,)=(_{(,)}_{ }\|-\|_{2}^{q} (,))^{}.\]

When \(\) and \(\) are persistent diagrams the choice of \(q=\) corresponds to the widely-used _bottleneck distance_. The OT distance is widely used for good reasons: by transporting from and to the diagonal \(\), it captures the distance between two measures that have potentially different total masses, taking advantage of the fact that points on the diagonal have arbitrary multiplicity in persistent diagrams. It also proves to be stable with respect to perturbations of the input to TDA algorithms. However, for expected persistent measures with intensity functions with respect to the Lebesgue measure, we will show next that the \(L_{}\) distance between intensity functions provides a tighter control on the difference between two persistent measures. Below, for a real-valued function on \(\), we let \(\|f\|_{}=_{}|f()|\) be its \(L_{}\) norm.

**Theorem 3.1**: _Let \(\), \(\) be two expected persistent measures on \(\) with intensity functions \(p_{}\) and \(p_{}\) respectively. Then_

\[_{q}^{q}(,)()^{q+2}(}{q+1}-)\|p_{}-p_{}\|_{}.\] (7)

_Furthermore, there exists two sequences of expected persistence measures \(\{_{n}\}_{n}\) and \(\{_{n}\}_{n}\) with intensity functions \(\{p_{_{n}}\}_{n}\) and \(\{p_{_{n}}\}_{n}\) respectively such that, as \(n\),_

\[_{q}(_{n},_{n}) 0,\|p_{_{n}}-p_{_{n}} \|_{}.\]

The bottleneck distanceFor the case \(q=\), which yields the bottleneck distance when applied to persistence diagrams, there can be no meaningful upper bound in the form of (7): we show in Section D.1 of the supplementary material that there exist two sequences of measures such that their bottleneck distance converges to a finite number while the \(L_{}\) distance between their intensity functions vanishes. Existing contributions  also upper bound the optimal transport distance by a Sobolev-type distance between density functions. It is noteworthy that these bounds require, among other things, the measures to have common support and the same total mass, two conditions that are not assumed in Theorem 3.1.

### Non-parametric estimation of the persistent intensity and density functions

In this section, we analyze the performance of kernel-based estimators of the persistent intensity function \(p()\) and the persistent density function \(()\). We adopt the setting where we observe \(n\)\(i.i.d.\) persistent measures \(_{1},_{2},,_{n}\). The procedures we proposed are directly inspired by kernel density estimators for probability densities traditionally used in the non-parametric statistics literature; see, e.g., . Specifically, we consider the following estimator for \(p()\) and \(()\), respectively:

\[^{2}_{h}() _{i=1}^{n}_{}K_{h}(-)_{i}();\] (8a) \[^{2}_{h}() =_{i=1}^{n}_{}K_{h}(-) _{i}(),\] (8b)

where \(K()\) is the _kernel function,_ which we assume to satisfy a number of standard regularity conditions used in non-parametric literature, discussed in detail in Section B.2 of the supplementary material.

Assumptions.We will impose a number of regularity conditions on the expected persistent measures, the persistence intensity and density functions and the kernel function. Of course, we will assume throughout that both \(p\) and \(\) (see (3)) are well-defined as densities with respect to the Lebesgue measure, though we point out that this is not strictly necessary for Theorems 3.6 and 3.9.

Our first assumption of smoothness of both \(p\) and \(\) is needed to control the point-wise bias of our estimators and is a standard assumption in non-parametric density estimation.

**Assumption 3.2** (Smoothness): _The persistence intensity function \(p\) and persistence probability density function \(\) are Holder smooth of the order of \(s>0\) with parameters \(L_{p}\) and \(L_{}\) respectively2._

In our next assumption, we impose boundedness conditions on \(p\) and \(\), which are needed in order to apply a key concentration inequality for empirical processes.

**Assumption 3.3** (Boundedness): _For some \(q>0\), let \(()\|-\|_{2}^{q}p()\). Then,_

\[\|\|_{}=_{}\|-\|_{2 }^{q}p()<\|\|_{}=_{ }()<.\]

Notice that instead of assuming a bound on the \(L_{}\) norm of the intensity function \(p\), we are only requiring the weaker condition that the weighted intensity function \(()=\|-\|_{2}^{q}p()\) has finite \(L_{}\) norm, due to the fact that the total mass of the persistence measure may not be uniformly bounded in a number of common data-generating mechanisms. Indeed, it is not a priori clear that Assumption 3.3 itself is realistic; in the supplementary material we prove that this assumption holds for the Vietoris-Rips filtration built on i.i.d. samples. On the other hand, assuming that the persistence density is uniformly bounded poses no problems. See Theorems B.1 and B.2 in the supplementary material for formal arguments. This fact is the primary reason why the persistence probability density function - unlike the persistence intensity function - can be estimated uniformly well over the entire set \(\) - see (3.6) below. We refer readers to Section B.1 of the supplementary materials for details and a discussion on this subtle but consequential point.

In our last assumption, we require a uniform bound on the \(q\)-th order total persistence, though not on the total number of points in the persistence diagram. As elucidated in  and discussed in  and , this is a relatively mild assumption, which should be expected to hold under a broad variety of data-generating mechanisms.

**Assumption 3.4** (Bounded total persistence): _There exists a constant \(M>0\), such that, for the value of \(q\) as in Assumption 3.3, it holds that, almost surely,_

\[_{i=1,,n}_{}\|-\|_{2}^{q}_{i}()<M.\]

We will denote with \(_{L,M}^{q}\) the set of persistent measures on \(_{L}\) satisfying Assumption 3.4.

We are now ready to present our first result concerning the bias of the kernel estimators, whose proof is relatively standard.

**Theorem 3.5**: _Under Assumption 3.2, for any \(\),_

\[|[_{h}()]-p()|  L_{p}h^{s}_{\|\|_{2} 1}K()\|\|_{2}^{s} ,\] \[|[_{h}()]-()|  L_{}h^{s}_{\|\|_{2} 1}K()\|\|_{2}^{s} .\]

The next result provides high-probability uniform bounds on the fluctuations of the kernel estimators around their expected values.

[MISSING_PAGE_FAIL:7]

Then, any linear representations \(_{2h,R}\) and \(_{R}\) can be estimated by

\[_{h}=_{_{2h}}f()_{h}(),_{h}=_{ }f()_{h}(),\] (9)

respectively. The following theorems provide uniform bounds on the bias and variation of these kernel-based estimators.

**Theorem 3.8**: _Under Assumption 3.2, it holds that_

\[_{_{2h,R}}|[_{h}]- | L_{p}h^{s}R_{\|\|_{2} 1}K()\|\|_{2}^{2} ;\] \[_{_{R}}|[_{h}]- | L_{}h^{s}R_{\|\|_{2} 1}K()\| \|_{2}^{2}.\]

**Theorem 3.9**: _Assume that Assumptions 3.2 and 3.3 hold. Then,_

1. _there exists a constant_ \(C\) _depending on_ \(M,\|K\|_{},\|K\|_{2},\|\|_{}\) _and_ \(q\) _such that for any_ \((0,1)\)_, it can be guaranteed with probability at least_ \(1-\) _that_ \[_{_{2h,R}}|_{h}-[ _{h}]| CR\{}},}}}}\};\]
2. _there exists a constant_ \(C\) _depending on_ \(M,\|K\|_{},\|K\|_{2},\|\|_{}\) _and_ \(q\) _such that for any_ \((0,1)\)_, it can be guaranteed with probability at least_ \(1-\) _that_ \[_{_{R}}|_{h}-[ _{h}]| CR\{}},}}}}\}.\]

It is important to highlight the fact that the above bounds hold uniformly over the choice of linear representations under only mild integrability assumptions.

Theorems 3.8 and 3.9 are direct corollaries of Theorems 3.5 and 3.6. We again stress the difference between the two upper bounds of Theorem 3.9: part (a) shows that for a linear functional of the original persistent measure to have controlled variation, we need the field of integral to be at least \(2h\) away from the diagonal \(\), a requirement that is not necessary for linear functionals of the normalized persistent measure, as is shown in part (b).

Next, we apply Theorems 3.9 and 3.9(a) to the persistent Betti number, which, for any \(\), can be estimated by

\[_{,h}=_{B_{}}_{h}() .\] (10)

**Corollary 3.10**: _Under Assumption 3.2, it holds that_

\[_{}|[_{,h}]- _{}| L_{p}h^{s}}{4}_{\|\|_{2} 1}K( )\|\|_{2}^{2}.\]

**Corollary 3.11**: _Under Assumptions 3.2 and 3.3(a), there exists a constant \(C\) depending on \(M,\|K\|_{},\|K\|_{2},\|\|_{}\) and \(q>2\) such that for any \((0,1)\),_

\[_{:\ _{}>h}_{}^{q-2}|_{,h}-[_{,h}]| C\{ }},}}}}\}\]

_holds with probability at least \(1-\)._

Notice that in order for the variation of \(_{,h}\) to be bounded, we need \(\) to be at least \(2h\) away from the diagonal \(\), and that the upper bound for the variation increases as approaches the diagonal. Therefore, based on our analysis, the kernel-based estimator \(_{h}\)_will not be guaranteed to_ yield a stable estimation of the Betti number \(_{x}\). As remarked above, this issue arises as the intensity function may not be uniformly bounded near the diagonal. Indeed, in the supplementary material, we describe an alternative proof technique based on an extension of the standard VC inequality and arrive at a very similar rate.

If instead we target the _normalized Betti numbers_\(_{}\), this issue disappears when we deploy the analogous estimator \(_{x,h}=_{B_{x}}_{h}()\), constructed using \(_{h}\). Indeed, Theorem 3.9(b) leads to the following uniform bounds.

**Corollary 3.12**: _Assume that Assumptions 3.2 and 3.3 hold true. Then there exist a constant \(C>0\) depending on \(M,\|K\|_{},\|K\|_{2},\|\|_{}\) and \(q\) such that for any \((0,1)\), it can be guaranteed with probability at least \(1-\) that_

\[_{}|_{,h}-[_{,h}]|}{4}\{}},}}}}\}\]

As a direct consequence of the previous result, we obtain a uniform error bound for the _expected normalized Betti curve_, i.e.

\[_{x(0,L)}|_{x,h}-[_{x,h}] |}{4}\{}},}}}}\},\]

To the best of our knowledge this is the first result of this kind, as typically one can only establish pointwise and not uniform consistency of Betti numbers.

## 4 Numerical Illustration and discussion

To illustrate our methodology and highlight the differences between the persistence intensity and density functions, we consider the MNIST handwritten digits dataset and the ORBIT5K dataset. The ORBIT5K dataset contains independent simulations for the linked twist map, dynamical systems for fluid flow as described in ; see also Appendix G.2 of . In Section E of the supplementary material, we show the estimated persistence intensity and density functions computed from persistence diagrams obtained over a varying number of random samples from the ORBIT5K datasets, for different model parameters. The figures confirm our theoretical finding that the values of the persistence density function near the diagonal are not as high (on a relative scale) as those of the persistence intensity function. An analogous conclusion can be reached when inspecting the persistence intensity and density functions for different draws of the MNIST datasets for the digits 4 and 8. We further include plots of the average Betti and normalized Betti curves from the ORBIT5K dataset, along with the curves of the empirical point-wise 5% and 95% quantiles. These plots reveal the different scales of the Betti curves and normalized Betti curves, and of their uncertainty.

In this paper, we have taken the first step towards developing a new set of methods and theories for statistical inference for TDA based on samples of persistence diagrams. Our main focus is on the estimation of the persistence intensity function , a TDA summary of a functional type that encodes the entire distribution of a random persistence diagram and is naturally suited to handle linear representations. We have analyzed a simple kernel estimator and derived uniform consistency rates that hold under very mild assumptions. We also propose the persistence density function, a novel functional TDA summary that enjoys stronger statistical guarantees. Though our results guarantee that the proposed estimators are consistent, in order to carry out statistical inference, it is necessary to develop more sophisticated procedures that quantify the uncertainty of our estimators. Towards that goal, it would be interesting to develop bootstrap-based methods for constructing confidence bands for both the persistence intensity and density functions.