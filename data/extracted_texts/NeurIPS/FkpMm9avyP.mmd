# Entropy-dissipation Informed Neural Network

for McKean-Vlasov Type PDEs

Zebang Shen

ETH Zurich

zebang.shen@inf.ethz.ch &Zhenfu Wang

Peking University

zwang@bicmr.pku.edu.cn

Authors are listed in alphabetic order.

###### Abstract

The McKean-Vlasov equation (MVE) describes the collective behavior of particles subject to drift, diffusion, and mean-field interaction. In physical systems, the interaction term can be singular, i.e. it diverges when two particles collide. Notable examples of such interactions include the Coulomb interaction, fundamental in plasma physics, and the Biot-Savart interaction, present in the vorticity formulation of the 2D Navier-Stokes equation (NSE) in fluid dynamics. Solving MVEs that involve singular interaction kernels presents a significant challenge, especially when aiming to provide rigorous theoretical guarantees. In this work, we propose a novel approach based on the concept of entropy dissipation in the underlying system. We derive a potential function that effectively controls the KL divergence between a hypothesis solution and the ground truth. Building upon this theoretical foundation, we introduce the Entropy-dissipation Informed Neural Network (EINN) framework for solving MVEs. In EINN, we utilize neural networks (NN) to approximate the underlying velocity field and minimize the proposed potential function. By leveraging the expressive power of NNs, our approach offers a promising avenue for tackling the complexities associated with singular interactions. To assess the empirical performance of our method, we compare EINN with SOTA NN-based MVE solvers. The results demonstrate the effectiveness of our approach in solving MVEs across various example problems.

## 1 Introduction

Scientists use Partial Differential Equations (PDEs) to describe natural laws and predict the dynamics of real-world systems. As PDEs are of fundamental importance, a growing area in machine learning is the use of neural networks (NN) to solve these equations (Han et al., 2018; Zhang et al., 2018; Raissi et al., 2020; Cai et al., 2021; Karniadakis et al., 2021; Cuomo et al., 2022). An important category of PDEs is the McKean-Vlasov equation (MVE), which models the dynamics of a stochastic particle system with mean-field interactions

\[_{t}=- V(_{t})t+K* _{t}(_{t})t+_{t},_{t}=(_{t}).\] (1)

Here \(_{t}\) denotes a random particle' position, \(\) is either \(^{d}\) or the torus \(^{d}\) (a cube \([-L,L]^{d}\) with periodic boundary condition), \(V:^{d}\) denotes a _known_ potential, \(K:^{d}^{d}\) denotes some interaction kernel and the convolution operation is defined as \(h*=_{}h(-)()d\), \(\{_{t}\}_{t 0}\) is the standard \(d\)-dimensional Wiener process with \( 0\) being the diffusion coefficient, and \(_{t}:\) is the law or the probability density function of the random variable \(_{t}\) and the initial data \(_{0}\) is given. Under mild regularity conditions, the density function \(_{t}\) satisfies the MVE

\[_{t}_{t}()+ (_{t}(- V()+K*_{t}()))= _{t}(),\] (2)where \(\,\) denotes the divergence operator, \(\,\,h()=_{i=1}^{d} h_{i}/ x_{i}\) for a velocity field \(h:^{d}^{d}\), \(\) denotes the Laplacian operator defined as \(=\,()\), where \(\) denotes the gradient of a scalar function \(:^{d}\). Note that all these operators are applied only on the spatial variable \(\).

In order to describe dynamics in real-world phenomena such as electromagnetism (Golse, 2016) and fluid mechanics (Majda et al., 2002), the interaction kernels \(K\) in the MVE can be highly _singular_, i.e. \(\|K()\|\) when \(\|\| 0\). Two of the most notable examples are the Coulomb interactions

\[ K()=- g(),\,\,g( )=((d-2)S_{d-1}(1))^{-1}\|\|^{-(d-2)},&d  3,\\ -(2)^{-1}\|\|,&d=2,\] (3)

with \(S_{d-1}(1)\) denoting the surface area of the unit sphere in \(^{d}\), and the vorticity formulation of the 2D Navier-Stokes equation (NSE) where the interaction kernel \(K\) is given by the Biot-Savart law

\[ K()=^{ }}{\|\|^{2}}=(-}{\|\|^{2}}, }{\|\|^{2}}),\] (4)

where \(=(x_{1},x_{2})\) and \(\|\|\) denotes the Euclidean norm of a vector.

Classical methods for solving MVEs, including finite difference, finite volume, finite element, spectral methods, and particle methods, have been developed over time. A common drawback of these methods lies in the constraints of their solution representation: Sparse representations, such as less granular grids, cells, meshes, fewer basis functions, or particles, may lead to an inferior solution accuracy; On the other hand, dense representations incur higher computational and memory costs.

As a potent tool for function approximation, NNs are anticipated to overcome these hurdles and handle higher-dimensional, less regular, and more complex systems efficiently (Weinan et al., 2021). The most renowned NN-based algorithm is the Physics Informed Neural Network (PINN) (Raissi et al., 2019). The philosophy behind the PINN method is that solving a PDE system is equivalent to finding the root of the corresponding differential operators. PINN tackles the latter problem by directly parameterizing the hypothesis solution with an NN and training it to minimize the \(^{2}\) functional residual of the operators. As a versatile PDE solver, PINN may fail to exploit the underlying dynamics of the PDE, which possibly leads to inferior performance on task-specific solvers. For example, on the 2D NSE problem, a recent NN-based development Zhang et al. (2022) surpasses PINN and sets a new SOTA empirical performance, which however lacks rigorous theoretical substantiation. Despite the widespread applications of PINN, rigorous error estimation guarantees are scarce in the literature. While we could not find results on the MVE with the Coulomb interaction, only in a very recent paper (De Ryck et al., 2023), the authors establish for NSE that the PINN loss controls the discrepancy between a candidate solution and the ground truth. We highlight that their result holds _average-in-time_, meaning that at a particular timestamp \(t[0,T]\), a candidate solution with small PINN loss may still significantly differ from the true solution. In contrast, all guarantees in this paper are _uniform-in-time_. Moreover, there is a factor in the aforementioned guarantee that _exponentially depends_ on the total evolving time \(T\), while the factor in our guarantee for the NSE is _independent_ of \(T\). We highlight that these novel improvements are achieved for the proposed EINN framework since we take a completely different route from PINN: Our approach is explicitly designed to exploit the underlying dynamics of the system, as elaborated below.

Our approachDefine the operator

\[[]}}{{=}}- V+K -.\] (5)

By noting \(_{t}=\,(_{t}_{t})\), we can rewrite the MVE in the form of a continuity equation

\[_{t}_{t}()+\,_{t}() [_{t}]()=0.\] (6)

For simplicity, we will refer to \([_{t}]\) as the _underlying velocity_. Consider another time-varying _hypothesis velocity_ field \(f:^{d}\) and let \(_{t}^{f}\) be the solution to the continuity equation

\[_{t}_{t}^{f}()+\, _{t}^{f}()f(t,)=0,\,\,_{0}^{f}=_{0}\] (7)

for \(t[0,T]\), where we recall that the initial law \(_{0}\) is known. We will refer to \(_{t}^{f}\) as the _hypothesis solution_ and use the superscript to emphasize its dependence on the hypothesis velocity field \(f\). We propose an Entropy-dissipation Informed Neural Network framework (EINN), which trains an NN parameterized hypothesis velocity field \(f_{}\) by minimizing the following EINN loss

\[ R(f_{})}}{{=}} _{0}^{T}_{}|f_{}(t,)-[_{t}^{f_{ }}]()\|^{2}_{t}^{f_{}}()t.\] (8)The objective (8) is obtained by studying the stability of carefully constructed Lyapunov functions. These Lyapunov functions draw inspiration from the concept of entropy dissipation in the system, leading to the name of our framework. We highlight that we provide a rigorous error estimation guarantee for our framework for MVEs with singular kernels (3) and (4), showing that when \(R(f_{})\) is sufficiently small, \(_{t}^{fo}\) recovers the ground truth \(_{t}\) in the KL sense, uniform in time.

**Theorem 1** (Informal).: _Suppose that the initial density function \(_{0}\) is sufficiently regular and the hypothesis velocity field \(f_{t}()=f(t,)\) is at least three times continuously differentiable both in \(t\) and \(x\). We have for the MVE with a bounded interaction kernel \(K\) or with the singular Coulomb (3) or Biot-Savart (4) interaction, the KL divergence between the hypothesis solution \(_{t}^{f}\) and the ground truth \(_{t}\) is controlled by the EINN loss for any \(t[0,T]\), i.e. there exists some constant \(C>0\),_

\[_{t[0,T]}(_{t}^{f},_{t}) CR(f).\] (9)

Having stated our main result, we elaborate on the difference between EINN and PINN in terms of information flow over time, which explains why EINN achieves better theoretical guarantees: In PINN, the residuals at different time stamps are independent of each other and hence there is no information flow from the residual at time \(t_{1}\) to the one at time \(t_{2}(>t_{1})\). In contrast, in the EINN loss (8), incorrect estimation made in \(t_{1}\) will also affect the error at \(t_{2}\) through the hypothesis solution \(_{t}^{f}\). Such an information flow gives a stronger gradient signal when we are trying to minimize the EINN loss, compared to the PINN loss. It partially explains why we can obtain the novel uniform-in-time estimation as opposed to the average-in-time estimation for PINN and why the constant \(C\) in the NSE case is independent of \(T\) for EINN (Theorem 2), but exponential in \(T\) for PINN.

**Contributions.** In summary, we present a novel NN-based framework for solving the MVEs. Our method capitalizes on the entropy dissipation property of the underlying system, ensuring robust theoretical guarantees even when dealing with singular interaction kernels. We elaborate on the contributions of our work from theory, algorithm, and empirical perspectives as follows.

1. (Theory-wise) By studying the stability of the MVEs with bounded interaction kernels or with singular interaction kernels in the Coulomb (3) and the Biot-Savart case (4) (the 2D NSE) via entropy dissipation, we establish the error estimation guarantee for the EINN loss on these equations. Specifically, we design a potential function \(R(f)\) of a hypothesis velocity \(f\) such that \(R(f)\) controls the KL divergence between the hypothesis solution \(_{t}^{f}\) (defined in equation (7)) and the ground truth solution \(_{t}\) for any time stamp within a given time interval \([0,T]\). A direct consequence of this result is that \(R(f)\) can be used to assess the quality of a generic hypothesis solution to the above MVEs and \(_{t}^{f}\) exactly recovers \(_{t}\) in the KL sense given that \(R(f)=0\).

2. (Algorithm-wise) When the hypothesis velocity field is parameterized by an NN, i.e. \(f=f_{}\) with \(\) being some finite-dimensional parameters, the EINN loss \(R(f_{})\) can be used as the loss function of the NN parameters \(\). We discuss in detail how an estimator of the gradient \(_{}R(f_{})\) can be computed so that stochastic gradient-based optimizers can be utilized to train the NN. In particular, for the 2D NSE (the Biot-Savart case (4)), we show that the singularity in the gradient computation can be removed by exploiting the anti-derivative of the Biot-Savart kernel.

3. (Empirical-wise) We compare the proposed approach, derived from our novel theoretical guarantees, with SOTA NN-based algorithms for solving the MVE with the Coulomb interaction and the 2D NSE (the Biot-Savart interaction). We pick specific instances of the initial density \(_{0}\), under which explicit solutions are known and can be used as the ground truth to test the quality of the hypothesis ones. Using NNs with the same complexity (depth, width, and structure), we observe that the proposed method significantly outperforms the included baselines.

## 2 Entropy-dissipation Informed Neural Network

In this section, we present the proposed EINN framework for the MVE. To understand the intuition behind our design, we first write the continuity equation (7) in a similar form as the MVE (6):

\[_{t}_{t}^{f}()+(_{t}^{f}() [_{t}^{f}]()+_{t}())=0,\] (10)

where \(f\) is the hypothesis velocity (recall that \(f_{t}()=f(t,)\)) and

\[_{t}()}{{= }}f_{t}()-[_{t}^{f}]()\] (11)

can be regarded as a perturbation to the original MVE system. Consequently, it is natural to study the deviation of the hypothesis solution \(_{t}^{f}\) from the true solution \(_{t}\) using an appropriate Lyapunovfunction \(L(_{t}^{f},_{t})\). The functional relation between this deviation and the perturbation is termed as the _stability_ of the underlying dynamical system, which allows us to derive the EINN loss (8). Following this idea, the design of the EINN loss can be determined by the choice of the Lyapunov function \(L\) used in the stability analysis. In the following, we describe the Lyapunov function used for the MVE with the Coulomb interaction and the 2D NSE (MVE with Biot-Savart interaction). The proof of the following results are the major theoretical contributions of this paper and will be elaborated in the analysis section 3.

* For the MVE with the Coulomb interaction, we choose \(L\) to be the _modulated free energy_\(E\) (defined in equation (23)) which is originally proposed in (Bresch et al., 2019) to establish the mean-field limit of a corresponding interacting particle system. We have (setting \(L=E\)) \[}{t}E(_{t}^{f},_{t}) _{}_{t}^{f}()\|_{t}()\|^{2} {x}+C\,E(_{t}^{f},_{t}),\] (12) where \(C\) is a universal constant depending on \(\) and \((_{t})_{t[0,T]}\).
* For the 2D NSE (MVE with the Biot-Savart interaction), we choose \(L\) as the KL divergence. Our analysis is inspired by (Jabin and Wang, 2018) which for the first time establishes the quantitative mean-field limit of the stochastic interacting particle systems where the interaction kernel can be in some negative Sobolev space. We have \[}{t}(_{t}^{f},_{t})- _{}_{t}^{f}()\|^ {f}}{_{t}}()\|^{2}+C\,(_{t}^{f},_{t})+ _{}_{t}^{f}()\|_{t}()\|^{2} ,\] (13) where again \(C\) is a universal constant depending on \(\) and \((_{t})_{t[0,T]}\).

After applying Gronwall's inequality on the above results, we can see that the EINN loss (8) is precisely the term derived by stability analysis of the MVE system with an appropriate Lyapunov function. In the next section, we elaborate on how a stochastic approximation of \(_{}R(f_{})\) can be efficiently computed for a parameterized hypothesis velocity field \(f=f_{}\) so that stochastic optimization methods can be utilized to minimize \(R(f_{})\).

### Stochastic Gradient Computation with Neural Network Parameterization

While the choice of the EINN loss (8) is theoretically justified through the above stability study, in this section, we show that it admits an estimator which can be efficiently computed. Define the flow map \(X_{t}\) via the ODE \((t)=f_{t}((t);)t\) with \((0)=_{0}\) such that \((t)=X_{t}(_{0})\). From the definition of the push-forward measure, one has \(_{t}^{f}=X_{t}\,\,_{0}\). Recall the definitions of the EINN loss \(R(f)\) in equation (8) and the perturbation \(_{t}\) in equation (11). Use the change of variable formula of the push-forward measure in (a) and Fubini's theorem in (b). We have

\[R(f)=_{0}^{T}\|_{t}\|_{_{t}^{f}}^{2}dt_{0}^{ T}\|_{t} X_{t}\|_{_{0}}^{2}dt\,_{0}^{T} \|_{t} X_{t}(_{0})\|^{2}dtd_{0}(_{0}).\] (14)

Consequently, by defining the trajectory-wise loss (recall \((t)=X_{t}(_{0})\))

\[R(f;_{0})=_{0}^{T}\|_{t} X_{t}(_{0})\|^{2}dt=_{0 }^{T}\|_{t}((t))\|^{2}dt,\] (15)

we can write the potential function (8) as an expectation \(R(f)=_{_{0}_{0}}[R(f;_{0})]\). Similarly, when \(f\) is parameterized as \(f=f_{}\), we obtain the expectation form \(_{}R(f_{})=_{_{0}_{0}}[_{ }R(f_{};_{0})]\).

We show \(_{}R(f_{};_{0})\) can be computed accurately, via the adjoint method (for completeness see the derivation of the adjoint method in appendix D). As a recap, suppose that we can write \(R(f_{};_{0})\) in a standard ODE-constrained form \(R(f_{};_{0})=()=_{0}^{T}g(t,(t),)dt\), where \(\{(t)\}_{t[0,T]}\) is the solution to the ODE \((t)=(t,(t);)\) with \((0)=_{0}\), and \(\) is a known transition function. The adjoint method states that the gradient \(()\) can be computed as

\[=_{0}^{T}a(t)^{}(t,(t);)+(t,(t);)t.\] (16)

where \(a(t)\) solves the final value problems \(a(t)^{}+a(t)^{}(t,(t );)+(t,(t);)=0,a(T)=0\). In the following, we focus on how \(R(f_{};_{0})\) can be written in the above ODE-constrained form.

Write \(R(f_{};_{0})\) in ODE-constrained formExpanding the definition of \(_{t}\) in equation (11) gives

\[_{t}((t))=f_{t}((t))-(- V((t))+K_{t}^ {f}((t))-_{t}^{f}((t))).\] (17)

Note that in the above quantity, \(f\) and \(V\) are known functions. Moreover, it is known that \(_{t}^{f}((t))\) admits a closed form dynamics (e.g. see Proposition 2 in )

\[_{t}^{f}((t))=-( f_{t}((t);))-(_{f_{t}}((t);) )^{}_{t}^{f}((t)),\] (18)

which allows it to be explicitly computed by starting from \(_{0}(x_{0})\) and integrating over time (recall that \(_{0}\) is known). Here \(_{f_{t}}\) denotes the Jacobian matrix of \(f_{t}\). Consequently, all we need to handle is the convolution term \(K_{t}^{f}((t))\).

A common choice to approximate the convolution operation is via Monte-Carlo integration: Let \(_{i}(t)}{}_{t}^{f}\) for \(i=1,,N\) and denote an empirical approximation of \(_{t}^{f}\) by \(_{N}^{_{t}^{f}}=_{i=1}^{N}_{_{i}(t)}\), where \(_{_{i}(t)}\) denotes the Dirac measure at \(_{i}(t)\). We approximate the convolution term in equation (17) in different ways for the Coulomb and the Biot-Savart interactions:

1. For the Coulomb type kernel (3), we first approximate \(K_{t}^{f}\) with \(K_{c}_{t}^{f}\), where \[K_{c}()}{=}K()&\|\|>c,\\ 0&\|\| c.\] (19)

If \(_{t}^{f}\) is bounded in \(\), we have

\[_{}\|(K-K_{c})_{t}^{f}()\|=_{ }|_{|-| c}-}{|-|^{d}}_{t}^{f}()\|\|_{t}^{f}\|_{^{ }()}_{|| c}\|^{d-1}} .\]

To compute the integral on the right-hand side, we will switch to polar coordinates \((r,)\):

\[_{|| c}|^{d-1}}=_{0}^{c} r}_{}\ J_{(r,)}_{0 }^{c}r=c.\] (20)

Here, \(J_{(r,)}\) denotes the determinant of the Jacobian matrix resulting from the transformation from the Cartesian system to the polar coordinate system. In inequality (20), we utilize the fact that \(J_{(r,)} r^{d-1}\), which allows us to cancel out the factor \(1/r^{d-1}\). Now that \(K_{c}\) is bounded by \(c^{-d+1}\), we can further approximate \(K_{c}_{t}^{f}\) using \(K_{c}_{N}^{f}\) with error of the order \(O(c^{-d+1}/)\). Altogether, we have \(_{}\|K_{t}^{f}()-K_{c}_{N}^{_ {t}^{f}}()\|=O(c+c^{-d+1}/)\) which can be made arbitrarily small for a sufficiently small \(c\) and a sufficiently large \(N\).

2. For Biot-Savart interaction (2D Navier-Stokes equation), there are more structures to exploit and we can completely avoid the singularity: As noted by Jabin and Wang (2018), the convolution kernel \(K\) can be written in a divergence form:

\[K= U,\ \ U()=- (_{1}}{_{2}}),&0\\ 0,&(_{2}}{_{1}}),\] (21)

where the divergence of a matrix function is applied row-wise, i.e. \([K()]_{i}=\ U_{i}()\). Using integration by parts and noticing that the boundary integration vanishes on the torus, one has

\[K_{t}^{f}() = K()_{t}^{f}(-)d= U ()_{t}^{f}(-)d= U()_{t}^{f}( -)d\] \[= U(-)_{t}^{f}()_{t}^{f}( )d=_{_{t}^{f}()}[U(-) _{t}^{f}()].\]

If the score function \(_{t}^{f}\) is bounded, then the integrand in the expectation is also bounded. Therefore, we can avoid integrating singular functions and the Monte Carlo-type estimation \(_{i=1}^{N}U(-_{i}(t))_{t}^{f}(_{ i}(t))\) is accurate for a sufficiently large value of N.

With the above discussion, we can write \(R(f_{};_{0})\) in an ODE-constrained form in a standard way, which due to space limitation is deferred to Appendix D.1.

**Remark 1**.: _Let \(_{N}()\) be the function we obtained using the above approximation of the convolution, where \(N\) is the number of Monte-Carlo samples. The above discussion shows that \(_{N}()\) and \(R(f_{};_{0})\) are close in the \(^{}\) sense, which is hence sufficient when the EINN loss is used as error quantification since only function value matters. When both \(_{N}()\) and \(R(f_{};_{0})\) are in \(C^{2}\), one can translate the closeness in function value to the closeness of their gradients. In our experiments, using \(_{N}()\) as an approximation of \(_{}R(f_{};_{0})\) gives very good empirical performance already._Analysis

In this section, we focus on the torus case, i.e. \(=^{d}\) is a box with the periodic boundary condition. This is a typical setting considered in the literature as the universal function approximation of NNs only holds over a compact set. Moreover, the boundary integral resulting from integration by parts vanishes in this setting, making it amenable for analysis purposes. For completeness, we provide a discussion on the unbounded case, i.e. \(=^{d}\) in the Appendix G, which requires additional regularity assumptions. Given the MVE (2), if \(K\) is bounded, it is sufficient to choose the Lyapunov functional \(L(_{t}^{f},_{t})\) as the KL divergence (please see Theorem 6 in the appendix). But for the singular Coulomb kernel, we need also to consider the modulated energy as in 

\[ F(,)}}{{=}}_{^{2}}g(x-y)(- )(x)(-)(y),\] (22)

where \(g\) is the fundamental solution to the Laplacian equation in \(^{d}\), i.e. \(- g=_{0}\), and the Coulomb interaction reads \(K=- g\) (see its closed form expression in equation (3)). If we are only interested in the deterministic dynamics with Coulomb interactions, i.e. \(=0\) in equation (2), it suffices to choose \(L(_{t}^{f},)\) as \(F(_{t}^{f},_{t})\) (please see Theorem 3). But if we consider the system with Coulomb interactions and diffusions, i.e. \(>0\), we shall combine the KL divergence and the modulated energy to form the modulated free energy as in Bresch et al. , which reads

\[ E(,)}}{{=}}(,)+F(,).\] (23)

This definition agrees with the physical meaning that "Free Energy = Temperature \(\) Entropy + Energy", and we note that the temperature is proportional to the diffusion coefficient \(\). We remark also for two probability densities \(\) and \(\), \(F(,) 0\) since by looking in the Fourier domain \(F(,)=()\|}()\|^{2}  0\) as \(() 0\). Moreover, \(F(,)\) can be regarded as a negative Sobolev norm for \(-\), which metricizes weak convergence.

To obtain our main stability estimate, we first obtain the time evolution of the KL divergence.

**Lemma 1** (Time Evolution of the KL divergence).: _Given the hypothesis velocity field \(f=f(t,x) C^{1}_{t,x}\). Assume that \((_{t}^{f})_{t[0,T]}\) and \((_{t})_{t[0,T]}\) are classical solutions to equation (7) and equation (6) respectively. It holds that (recall the definition of \(_{t}\) in equation (11))_

\[}{t}_{}_{t}^{f} ^{f}}{_{t}}=-_{}_{t}^{f}| ^{f}}{_{t}}|^{2}+_{}_{t}^{f}K (_{t}^{f}-_{t})^{f}}{ _{t}}+_{}_{t}^{f}_{t}^{f }}{_{t}},\]

_where \(\) is the tours \(^{d}\). All the integrands are evaluated at \(\)._

We refer the proof of this lemma and all other lemmas and theorems in this section to the appendix E. We remark that to have the existence of classical solution \((_{t})_{t[0,T]}\), we definitely need the regularity assumptions on \(- V\) and on \(K\). But the linear term \(- V\) will not contribute to the evolution of the relative entropy. See  for detailed discussions.

Similarly, we have the time evolution of the modulated energy as follows.

**Lemma 2** (Time evolution of the modulated energy).: _Under the same assumptions as in Lemma 1, given the diffusion coefficient \( 0\), it holds that (recall the definition of \(_{t}\) in equation (11))_

\[}{t}F(_{t}^{f},_{t}) =-_{}_{t}^{f}\|K(_{t}^{f}-_{t})\|^{2}-_{}_{t}^{f}\;_{t} K( _{t}^{f}-_{t})+_{}_{t}^{f}\;K(_{t}^ {f}-_{t})^{f}}{_{t}}\] \[-_{^{2}}K(x-y)[ _{t}](x)-[_{t}](y)(_{t}^{f }-_{t})^{ 2}(x,y)\]

_where we recall that the operator \(\) is defined in equation (5)._

By Lemma 1 and careful analysis, in particular by rewriting the Biot-Savart law in the divergence of a bounded matrix-valued function (21), we obtain the following estimate for the 2D NSE.

**Theorem 2** (Stability estimate of the 2D NSE).: _Notice that when \(K\) is the Biot-Savart kernel, \(K=0\). Assume that the initial data \(_{0} C^{3}(^{d})\) and there exists \(c>1\) such that \(_{0} c\). Assume further the hypothesis velocity field \(f(t,x) C^{1}_{t,x}\). Then it holds that_

\[_{t[0,T]}_{^{d}}_{t}^{f}^{f}}{_{ t}}x}{}R(f),\]

_where \(C=_{0}^{}M(t)t<\) with \(M(t)}}{{=}}\|_{t}\|_{L }^{2}2+2\|^{2}_{t}/_{t}\|_ {L^{}}\)._We remark that given \(_{0}\) is smooth enough and fully supported on \(\), one can propagate the regularity to finally show the finiteness of \(C\). See detailed computations as in Guillin et al. (2021). We give the complete proof in the appendix E. This theorem tells us that as long as \(R(f)\) is small, the KL divergence between \(_{t}^{f}\) and \(_{t}\) is small and the control is uniform in time \(t[0,T]\) for any \(T\). Moreover, we highlight that \(C\) is independent of \(T\), and our result on the NSE is significantly better than the average-in-time and exponential-in-\(T\) results from (De Ryck et al., 2023).

To treat the MVE (2) with Coulomb interactions, we exploit the time evolution of the modulated free energy \(E(_{t}^{f},_{t})\). Indeed, combining Lemma 1 and Lemma 2, we arrive at the following identity.

**Lemma 3** (Time evolution of the modulated free energy).: _Under the same assumptions as in Lemma 1, one has (recall the definitions of \(_{t}\) and \(\) in (11) and (5) respectively)_

\[}{t}E(_{t}^{f},_{t})= -_{}_{t}^{f}K*(_{t}^{f}- _{t})-^{f}}{_{t}}^{2}-_{ }_{t}^{f}\,_{t}K*(_{t}^{f}-_{t })-^{f}}{_{t}}\] \[-_{^{2}}K(x-y)[ _{t}](x)-[_{t}](y)(_{t}^{ f}-_{t})^{ 2}(x,y).\]

Inspired by the mean-field convergence results as in Serfaty (2020) and Bresch et al. (2019), we finally can control the growth of \(E(_{t}^{f},_{t})\) in the case when \(>0\), and \(F(_{t}^{f},_{t})\) in the case when \(=0\). Note also that \(E(_{t}^{f},_{t})\) can also control the KL divergence when \(>0\).

**Theorem 3** (Stability estimate of MVE with Coulomb interactions).: _Assume that for \(t[0,T]\), the underlying velocity field \([_{t}](x)\) is Lipschitz in \(x\) and \(_{t[0,T]}\|[_{t}]()\|_{L^{}}=C_{1 }<\). Then there exists \(C>0\) such that_

\[_{t[0,T]}\,(_{t}^{f},_{t})_{t[0,T]}E(_{t}^{f},_{t})(CC_{1}T)R(f).\]

_In the deterministic case when \(=0\), under the same assumptions, it holds that_

\[_{t[0,T]}F(_{t}^{f},_{t})(CC_{1}T)R(f).\]

Recall the definition of the operator \(\) in equation 5. Given that \(=^{d}\), and \(_{0}\) is smooth enough and bounded from below, one can propagate regularity to obtain the Lipschitz condition for \([_{t}]\). See the proof and the discussion on the Lipschitz assumptions on \([_{t}]()\) in the appendix E.

Approximation Error of Neural NetworkTheorems 2 and 3 provide the error estimation guarantee for the proposed EINN loss (8). Suppose that we parameterize the velocity field \(f=f_{}\) with an NN parameterized by \(\), as we did in Section 2.1 and let \(\) be the output of an optimization procedure when \(R(f_{})\) is used as objective. In order the explicitly quantify the mismatch between \(_{t}^{f}\) and \(_{t}\), we need to quantify two errors: (i) Approximation error, reflecting how well the ground truth solution can be approximated among the NN function class of choice; (ii) Optimization error, involving minimization of a highly nonlinear non-convex objective. In the following, we show that for a function class \(\) with sufficient capacity, there exists at least one element \(\) that can reduce the loss function \(R()\) as much as desired. We will not discuss how to identify such an element in the function class \(\) as it is independent of our research and remains possibly the largest open problem in modern AI research. To establish our result, we make the following assumptions.

**Assumption 1**.: \(_{0}\) _is sufficiently regular, such that \(_{0}^{}()\) and \(_{t}=[_{t}] W^{2,}()\). \( V\) is Lipschitz continuous. Here \(W^{2,}()\) stands for the Sobolev norm of order \((2,)\) over \(\)._

We here again need to propagate the regularity for \(f_{t}\) at least for a time interval \([0,T]\). It is easy to do so for the torus case, but for the unbounded domain, there are some technical issues to be overcome. Similar assumptions are also needed in some mathematical works for instance in Jabin and Wang (2018). We also make the following assumption on the capacity of the function class \(\), which is satisfied for example by NNs with tanh activation function (De Ryck et al., 2021).

**Assumption 2**.: _The function class is sufficiently large, such that there exists \(\) satisfying \(_{t}^{3}()\) and \(\|_{t}-_{t}\|_{W^{2,}()}\) for all \(t[0,T]\)._

**Theorem 4**.: _Consider the case where the domain is the torus. Suppose that Assumptions 1 and 2 hold. For both the Coulomb and the Biot-Savart cases, there exists \(\) such that \(R() C(T)( 1/)^{2}\), where \(C(T)\) is some constant independent of \(\). Here \(R\) is the EINN loss (8)._The major difficulty to overcome is the lack of Lipschitz continuity due to the singular interaction. We successfully address this challenge by establishing that the contribution of the singular region \(()\) to \(R()\) can be bounded by \(O(()^{2})\). Please see the detailed proof in Appendix F.

## 4 Related Works on NN-based PDE solvers

Solving PDEs is a key aspect of scientific research, with a wealth of literature (Evans, 2022). Due to space limitations, a detailed discussion about the classical PDE solvers is deferred to Appendix A. In this section, we focus on the NN-based approaches as they are more related to our research.

As previously mentioned, PINN is possibly the most well-known method of this type. PINN regards the solution to a PDE system as the root of the corresponding operators \(\{_{i}()\}_{i=1}^{}\), and expresses the time and space boundary conditions as \(()=0\), where \(\) is a candidate solution and \(_{i}\) and \(\) are operators acting on \(\). Parameterizing \(=_{}\) using an NN, PINN optimizes its parameters \(\) by minimizing the residual \(L()}}{{=}}_{i=1}^{n}_{i} _{i}(_{})_{^{2}()} ^{2}+_{0}(_{})_{^{2}()}^{2}\). The hyperparameters \(_{i}\) balance the validity of PDEs and boundary conditions under consideration and must be adjusted for optimal performance. In contrast, EINN requires no hyperparameter tuning. PINN is versatile and can be applied to a wide range of PDEs, but its performance may not be as good as other NN-based solvers tailored for a particular class of PDEs, as it does not take into account other in-depth properties of the system, a phenomenon observed in the literature (Krishnapriyan et al., 2021; Wang et al., 2022). (Shin and Em Karniadakis, 2020) initiates the work of theoretically establishing the consistency of PINN by considering the linear elliptic and parabolic PDEs, for which they prove that a vanishing PINN loss \(L()\) asymptotically implies \(_{}\) recovers the true solution. A similar result is extended to the linear advection equations in (Shin et al., 2020). Leveraging the stability of the operators \(_{i}\) (corresponding to PDEs of interest), non-asymptotic error estimations are established for linear Kolmogorov equations in (De Ryck and Mishra, 2022), for semi-linear and quasi-linear parabolic equations and the incompressible Euler in (Mishra and Molinaro, 2022), and for the NSE in (De Ryck et al., 2023). We highlight these non-asymptotic results are all average-in-time, meaning that even when the PINN loss is small the deviation of the candidate solution to the true solution may be significant at a particular timestamp \(t[0,T]\). In comparison, our results are uniform-in-time, i.e. the supremum of the deviation is strictly bounded by the EINN loss. Moreover, we show in Theorem 2, for the NSE our error estimation holds for any \(T\) uniformly, while the results in (De Ryck et al., 2023) have an exponential dependence on \(T\).

Recent work from Zhang et al. (2022) proposes the Random Deep Vortex Network (RDVN) method for solving the 2D NSE and achieves SOTA performance for this task. Let \(_{t}^{}\) be an estimation of the interaction term \(K*_{t}\) in the SDE (1) and use \(_{t}^{}\) to denote the law of the particle driven by the SDE \(_{t}=_{t}^{}(_{t})t+ _{t}\). To train \(_{t}^{}\), RDVN minimizes the loss \(L()=_{0}^{T}_{}_{t}^{}() -K*_{t}^{}()_{^{2}}^{2} t\). Note that in order to simulate the SDE, one needs to discretize the time variable in loss function \(L\). After training \(\), RDVN outputs \(_{t}^{}\) as a solution. However, no error estimation guarantee is provided that controls the discrepancy between \(_{t}^{}\) and \(_{t}\) using \(L()\).

Shen et al. (2022) propose the concept of self-consistency for the FPE. However, unlike our work where the EINN loss is derived via the stability analysis, they construct the potential \(R(f)\) for the hypothesis velocity field \(f\) by observing that the underlying velocity field \(f^{*}\) is the fixed point of some velocity-consistent transformation \(\) and they construct \(R(f)\) to be a more complicated Sobolev norm of the residual \(f-(f)\). In their result, they bound the Wasserstein distance between \(^{f}\) and \(\) by \(R(f)\), which is weaker than our KL type control. The improved KL type control for the Fokker-Planck equation has also been discussed in (Boffi and Vanden-Eijnden, 2023). A very recent work (Li et al., 2023) extends the self-consistency approach to compute the general Wasserstein gradient flow numerically, without providing further theoretical justification.

## 5 Experiments

To show the efficacy and efficiency of the proposed approach, we conduct numerical studies on example problems that admit explicit solutions and compare the results with SOTA NN-based PDE solvers. The included baselines are PINN (Raissi et al., 2019) and DRVN (Zhang et al., 2022). Note that these baselines only considered the 2D NSE. We extend them to solve the MVE with the Coulomb interaction for comparison, and the details are discussed in Appendix C.1.

Equations with an explicit solutionWe consider the following two instances that admit explicit solutions. We verify these solutions in Appendix C.2.

_Lamb-Oseen Vortex (2D NSE)_[Oseen, 1912]: Consider the whole domain case where \(=^{2}\) and the Biot-Savart kernel (4). Let \((,)\) be the Gaussian distribution with mean \(\) and covariance \(\). If \(_{0}=(0,}_{2})\) for some \(t_{0} 0\), then we have \(_{t}()=(0,)}_{2})\).

_Barenblatt solutions (MVE)_[Serfady and Vazquez, 2014]: Consider the 3D MVE with the Coulomb interaction kernel (3) with the diffusion coefficient set to zero, i.e. \(d=3\) and \(=0\). Let \([]\) be the uniform distribution over a set \(\). Consider the whole domain case where \(=^{3}\). If \(_{0}=[\|\|(t_{0})^{1/3}]\) for some \(t_{0} 0\), then we have \(_{t}=[\|\|((t+t_{0}))^{1/3}]\).

Numerical resultsWe present the results of our experiments in Figure 1, where the first row contains the result for the Lamb-Oseen vortex (2D NSE) and the second row contains the result for the Barenblatt model (3D MVE). The explicit solutions of these models allow us to assess the quality of the outputs of the included methods. Specifically, given a hypothesis solution \(_{t}^{f}\), the ground truth \(_{t}\) and the interaction kernel \(K\), define the relative \(_{2}\) error at timestamp \(t\) as \(Q(t)}}{{=}}_{}\|K*(_{t}^{f} -_{t})()\|/\|K*_{t}()\|d \), where \(\) is some domain where \(_{t}\) has non-zero density. We are particularly interested in the quality of the convolution term \(K*_{t}^{f}\) since it has physical meanings. In the Biot-Savart kernel case, it is the velocity of the fluid, while in the Coulomb case, it is the Coulomb field. We set \(\) to be \([-2,2]^{2}\) for the Lamb-Oseen vortex and to \([-0.1,0.1]^{3}\) for the Barenblatt model. For both models, we take \(=0.1\), \(t_{0}=0.1\), and \(T=1\). The neural network that we use is an MLP with \(7\) hidden layers, each of which has 20 neurons.

From the first column of Figure 1, we see that the objective loss of all methods has substantially reduced over a training period of 10000 iterations. This excludes the possibility that a baseline has worse performance because the NN is not well-trained, and hence the quality of the solution now solely depends on the efficacy of the method. From the second and third columns, we see that the proposed EINN method significantly outperforms the other two methods in terms of the time-average relative \(_{2}\) error, i.e. \(_{0}^{T}Q(t)dt\) and the relative \(_{2}\) error at the last time stamp \(Q(T)\). This shows the advantage of our method.

ConclusionBy employing entropy dissipation of the MVE, we design a potential function for a hypothesis velocity field such that it controls the KL divergence between the corresponding hypothesis solution and the ground truth, for any time stamp within the period of interest. Built on this potential, we proposed the EINN method for MVEs with NN and derived the detailed computation method of the stochastic gradient, using the classic adjoint method. Through empirical studies on examples of the 2D NSE and the 3D MVE with Coulomb interactions, we show the significant advantage of the proposed method, when compared with two SOTA NN based MVE solvers.

Figure 1: The first row contains results for the 2D NSE and the second row contains the results for the 3D MVE with Coulomb interaction. The first column reports the objective losses, while the second and third columns report the average and last-time-stamp relative \(_{2}\) error.