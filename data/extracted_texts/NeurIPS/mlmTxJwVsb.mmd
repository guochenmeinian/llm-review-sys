# DMNet: Self-comparison Driven Model for Subject-independent Seizure Detection

Shihao Tu

Zhejiang University

shihao.tu@zju.edu.cn

&Linfeng Cao

The Ohio State University

cao.1378@osu.edu

&Daoze Zhang

Zhejiang University

zhangdz@zju.edu.cn

&Junru Chen

Zhejiang University

jrchen_cali@zju.edu.cn

&Lvbin Ma

Zhejiang Huayun

Information Technology Co. Ltd

gmmmfly@163.com

&Yin Zhang

Zhejiang University

yinzh@zju.edu.cn

&Yang Yang

Zhejiang University

yangya@zju.edu.cn

Corresponding authors.

###### Abstract

Automated seizure detection (ASD) using intracranial electroencephalography (iEEG) is critical for effective epilepsy treatment. However, the significant domain shift of iEEG signals across subjects poses a major challenge, limiting their applicability in real-world clinical scenarios. In this paper, we address this issue by analyzing the primary cause behind the failure of existing iEEG models for _subject-independent_ seizure detection, and identify a critical universal seizure pattern: seizure events consistently exhibit higher average amplitude compared to adjacent normal events. To mitigate the domain shifts and preserve the universal seizure patterns, we propose a novel _self-comparison_ mechanism. This mechanism effectively aligns iEEG signals across subjects and time intervals. Based on these findings, we propose _Difference Matrix-based Neural Network_ (DMNet), a subject-independent seizure detection model, which leverages self-comparison based on two constructed (_contextual_, _channel-level_) references to mitigate shifts of iEEG, and utilize a simple yet effective _difference matrix_ to encode the universal seizure patterns. Extensive experiments show that DMNet significantly outperforms previous SOTAs while maintaining high efficiency on a real-world clinical dataset that we collected, as well as two public datasets for subject-independent seizure detection. Moreover, the visualization results demonstrate that the generated difference matrix can effectively capture the seizure activity changes throughout the seizure evolution process. Additionally, we deploy our method in an online diagnosis system to illustrate its effectiveness in real clinical applications.

## 1 Introduction

_Epilepsy_, a chronic neurological disorder, affects more than 65 million people around the world. Up to 70% of people with epilepsy can be free from seizure only if the seizure onset zone (SOZ) can be located and surgically removed . To diagnose epilepsy, doctors rely on the assessment ofelectrical activities that reflect the state and function of the subject's brain. Electroencephalography (EEG) is a widely employed and cost-effective method to record these electrical activities by placing sensors on the scalp. However, as a non-invasive method, it is unable to accurately locate SOZ in the deep structures of the brain.

Nowadays, iEEG is widely employed to identify and locate SOZ. _Stereo-EEG_, one representative iEEG technique, involves the deep implantation of electrodes within the brain to record electrical activities. These electrodes contain multiple recording contacts, called _channels_, and are placed across different regions of the brain, which provide stereoscopic recordings of the brain from both cortical and subcortical structures simultaneously . This fully developed technique has been proven to be both effective and safe .

Given a substantial volume of iEEG data, we present a pipeline tailored to real-world application scenarios for automated seizure detection (ASD), as depicted in Fig. 1 (g). Firstly, the ASD model is trained using data from accessible subjects. Subsequently, the trained model is applied to identify seizures in iEEG recordings from previously unseen subjects. Doctors can refer to the prediction results, allowing for a more accurate diagnosis and facilitating more effective treatment decisions.

However, most existing ASD methods are built on non-invasive EEG with a _subject-specific_ setting  and _subject-independent_ setting . However, these EEG-based methods are prone to failure when applied to iEEG data. This is primarily due to the significantly higher complexity of iEEG signals compared to EEG signals. iEEG signals exhibit a greater level of intricacy as a result of the structural and functional disparities in brain neural activities. Furthermore, there are variations in the number and placement of invasive electrodes (Fig. 1 (a,b)), leading to significant domain shifts across different subjects. However, Existing methods that employ domain adversarial training for _subject-independent_ seizure detection on iEEG signals may encounter negative transfer effects . Although  proposed a method that utilizes a series of intricate pre-training strategies to learn the general pattern across subjects, it lacks efficiency. Consequently, developing an effective and efficient subject-independent ASD method using iEEG is crucial for clinical diagnosis. Here, we discuss the primary challenges associated with iEEG in ASD.

**Challenges.** The factors mentioned above cause a significant domain shift between subjects, posing an open question regarding the generalization of _subject-independent_ epilepsy seizure detection using iEEG. This issue gives rise to challenges at both the subject level and the channel level:

**(1)** How to capture the general distinguishable representation for normal and seizures between different subjects and time intervals? Due to individual differences that exist among subjects, the inherent properties of iEEG recordings, such as amplitude, frequency, and others, are personalized to each subject. Even within the same individual, brain activities vary over time.

**(2)** How to reduce the inconsistency of the seizure patterns of different channels? The channels exhibit diverse patterns due to the iEEG records of various regions of the brain, potentially leading to conflicting patterns between subjects. For example, normal and seizure waves are indistinguishable between subjects or channels. As shown in Fig. 1, the normal wave in (e) is difficult to distinguish from the seizure waves in (c) and (d), while the seizure event in (f) is often mistaken for the normal one. Therefore, the second challenge is to personalize the representations of brain activity independent of channels, allowing the model to adapt to different subjects.

Figure 1: (a, b) Locations of iEEG depth electrode contacts (red circle) for subjects _P2_ and _P4_. (c, d, e, f) Examples of seizure and normal iEEG recording activities of subjects _P2_ and _P4_. (g) Application of our proposed method in real-world clinical scenarios.

**Solution.** To address these challenges, we first propose the mechanism of _self-comparison: comparing the target segment with adjacent normal segments_. Subsequently, we conduct a comprehensive observation study (Sec. 3) to demonstrate the effectiveness of _self-comparison_. Our findings indicate that _self-comparison_ can obtain a general distinguishable representation of normal ones and seizures.

Drawing on these inspirations, we argue that the _self-comparison_ mechanism is the key to easily and effectively capture subject-invariant patterns between subjects. To this end, we propose a novel model, namely _**D**ifference **M**atrix based neural **N**etwork_ (**DMNet**), for subject-independent seizure detection. Specifically, considering that different seizure events would present different neural activities (local bias) within different recording channels (global bias), we therefore introduce two reference objects (i.e., _contextual reference_ and _channel-level reference_). These references ensure that we can capture both local and global dependencies within data, which are the primary contributors of distribution shift and can be effectively mitigated through the self-comparison mechanism. Subsequently, we utilize a simple yet effective _fully differencing operation_ to generate the difference matrix, which compares the target segment with its reference objects for _self-comparison_ implementation. To effectively extract semantics from the difference matrix, we design a difference matrix encoder based on convolutional neural network (CNN) blocks to obtain the final representation of the detection segment. Our primary contributions are listed as follows:

* We investigate the problem of subject-independent ASD based on the iEEG. Through comprehensive analysis, we identify the _self-comparison_ mechanism as a simple yet effective way to capture the general representation.
* We propose a novel model named **DMNet** for subject-independent ASD. The _fully differencing operation_ based on _contextual reference_ and _channel-level reference_ for self-comparison can mitigate the local and global biases among subjects and channels, improving the generalizability of learned representations.
* Extensive experiments on clinical and public iEEG datasets show _DMNet_ outperforms existing SOTAs. Moreover, the generated difference matrix effectively captures seizure activity changes during the seizure evolution process. Furthermore, _DMNet_ outperforms existing SOTAs while maintaining the high efficiency. Building on these strengths, we deploy our method in an online system, enhancing clinical applications by assisting medical professionals in the diagnosis of epilepsy and by facilitating the provision of more effective treatment options for patients.

## 2 Problem Formulation

In this work, the iEEG recording is regarded as a set of time series \(=\{}\}_{i=1}^{C}\), where \(C\) refers to the total number of channels. Each \(}^{T}\) corresponds to a channel, and \(T\) refers to the total timestamp. We sequentially test the channels one after another. Specifically, given _one channel_ of iEEG time series \(}=\{x_{1}^{(i)},,x_{T}^{(i)}\}\) from a subject, we first divide the original recording data into segments for detection. For simplicity, we omit the channel index \(i\) in subsequent steps:

\[\{s_{0},s_{1},...,s_{m-1}\}\] (1)

where \(s_{k}=\{x_{ k+1},,x_{(k+1)}\},0 k m-1\), \(\) is the number of timestamp for each segment, \(m\) is the total number of segments. Each segment \(s_{k}\) has a corresponding label \(y_{k}\{0,1\}\), indicating whether the segment contains a seizure event. In this work, our aim is to predict \(y_{k}\) on each segment \(s_{k}\) for different subjects.

We define our problem as an innovative study of _Domain Generalization_ (DG)  in the context of epileptic diagnosis. In this study, we treat each subject's data as a domain, and our goal is to utilize the data of available labeled subjects (source domains) to train a model that can be directly adopted to the subjects with unseen data (target domains).

## 3 Empirical Analysis

In this section, we first analyze the primary cause behind the failure of existing models for subject-independent seizure detection of the iEEG and the reasons of occurrence. Then we explore the possibility of a domain-consistent seizure pattern existing within iEEG data, taking into account thedomain shift issue. Finally, we validate whether _self-comparison_ mechanism can mitigate distribution shifts in iEEG data and capture the potential domain consistent seizure patterns.

### iEEG Domain Shift Issue and Domain Consistent Seizure Pattern

Most previous studies [10; 16] assert that vanilla detection models trained independently by each subject are prone to failure when applied to other subjects. To analyze the direct cause of failure, we merge raw iEEG signals from all subjects and channels in a clinical iEEG dataset (details in App. C), and analyze the distributions of seizure and normal events. As depicted in Fig. 2 (a), the results reveal nearly identical means and close variances for both seizure and normal signals in the merged data. This similarity leads to the indistinguishability between normal and seizure signals across subjects, which becomes a direct factor to the failure of subject-dependent models.

For a detailed analysis, we partition the iEEG signals into multiple intervals, each comprising 250 timestamps, for each subject. We then compute the distributions of seizure and normal events within each interval. Through empirical analysis, we observe significant domain shifts both across different subjects (inter-subject) and different time intervals for the same subject (intra-subject). Fig. 2 (b) presents the normal and seizure distributions within four intervals randomly sampled from subjects P1 and P2, where the distribution patterns of normal and seizure exhibit substantial variation across different time intervals and subjects. This observation aligns with findings from previous studies in neural science and medicine, which have consistently reported that brain signals exhibit high variability between subjects and sessions due to inherent background neural activities , seizure patterns , electrode locations , etc.

Despite the pronounced domain shift observed in iEEG signals across subjects and time intervals, there is a notable commonality among subjects. Specifically, seizure events consistently demonstrate a higher average amplitude in the frequency domain compared to their background signal (adjacent normal events), indicating more intense neural oscillatory activities. This finding is consistent with previous studies in the field [34; 21].

### Self-Comparison can Help

Based on the commonality above, we propose a novel _self-comparison_ mechanism, which compares the target segment with its adjacent normal segment, to mitigate domain shifts between subjects and time intervals. To verify the effectiveness of this mechanism, we conduct an empirical study. First, for each subject, we partition the contiguous iEEG data into small segments. Considering that the spectral signal of brain data can effectively track transient changes before and during seizures , we proceed to transform these segments into the frequency domain using Discrete Fourier Transform (DFT). Subsequently, we calculate the spectrum differences by subtracting the spectrum of the target segment from those of adjacent segments on both sides of the target segment. We then sum up the absolute values of these differences, generating a single value \(D\) for each target segment.

Figure 2: Observation results of the clinical iEEG dataset. (a) Overall distribution of raw iEEG signals (all subjects and channels), where normal and seizure events are indistinguishable. (b) Distribution of raw iEEG signals across different time intervals and subjects, where substantial domain shifts are evident in both distinct time intervals and among different subjects (red dashed line at 0 serves as reference line for domain shift). (c) Overall distribution of raw iEEG data after the _self-comparison_ process. (d) Distribution of raw iEEG data across different time intervals and subjects after the _self-comparison_ process. The _self-comparison_ mechanism effectively mitigates distribution shifts across time intervals and subjects, thus enhancing the model’s ability to distinguish between seizure and normal events.

. Notably, the distribution of the normal and seizure segments becomes distinctly separated after the adoption of the self-comparison mechanism. Additionally, we analyze the distribution of \(D\) values for target segments within the same four intervals from P1 and P2, which is discussed in Section 3.1. The results are shown in Figure 3 (d). It is evident that the distribution of normal or seizures segments is well aligned across different subjects and time intervals, and the patterns of normal and seizure become more distinguishable. These results signify that our proposed self-comparison mechanism effectively mitigates the domain shift issue and preserves a domain consistent and distinguishable representation for normal and seizure segments.

## 4 Methodology

Inspired by the above observations, we propose a subject-independent seizure detection framework called **DMNet**, which leverages self-comparison to alleviate the distribution shift and preserve the domain consistency while distinguishing seizure patterns.

**Overview.** The overall framework is illustrated in Fig. 3. First, for each detection segment \(s_{k}\), we construct two reference segments (_contextual reference_\(\): \(L_{c}(s_{k})\) / \(R_{c}(s_{k})\), _channel-level reference_\(\): \(L_{c}(s_{k})\) / \(R_{c}(s_{k})\)) to compare with the target segment (Fig. 3, left). Then we use a simple yet effective _fully differencing_ operation with signed-min-max normalization for self-comparison implementation, and the compared information is encoded by a _difference matrix_ (DM) (Fig. 3, middle). Then we employ a CNN-based difference matrix encoder to learn the latent representation of DM, and use a classifier for seizure detection (Fig. 3, right).