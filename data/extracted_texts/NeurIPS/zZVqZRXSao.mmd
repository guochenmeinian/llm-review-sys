# Semantic Feature Learning for Universal Unsupervised Cross-Domain Retrieval

Lixu Wang

Northwestern University, IL, USA

lixuwang2025@u.northwestern.edu &Xinyu Du

General Motors Global R&D, MI,USA

xinyu.du@gm.com &Qi Zhu

Northwestern University, IL, USA

qzhu@northwestern.edu

###### Abstract

Cross-domain retrieval (CDR) is finding increasingly broad applications across various domains. However, existing efforts have several major limitations, with the most critical being their reliance on accurate supervision. Recent studies thus focus on achieving unsupervised CDR, but they typically assume that the category spaces across domains are identical, an assumption that is often unrealistic in real-world scenarios. This is because only through dedicated and comprehensive analysis can the category composition of a data domain be obtained, which contradicts the premise of unsupervised scenarios. Therefore, in this work, we introduce the problem of Universal Unsupervised Cross-Domain Retrieval (\(^{2}\)) for the first time and design a two-stage semantic feature learning framework to address it. In the first stage, a cross-domain unified prototypical structure is established under the guidance of an instance-prototype-mixed contrastive loss and a semantic-enhanced loss, to counteract category space differences. In the second stage, through a modified adversarial training mechanism, we ensure minimal changes for the established prototypical structure during domain alignment, enabling more accurate nearest-neighbor searching. Extensive experiments across multiple datasets and scenarios, including close-set, partial, and open-set CDR, demonstrate that our approach significantly outperforms existing state-of-the-art CDR methods and other related methods in solving \(^{2}\) challenges.

## 1 Introduction

In real-world applications, cross-domain retrieval (CDR) finds extensive utility across diverse domains, such as image search , product recommendations , and artistic creation [3; 4]. However, the efficacy of current CDR methods relies heavily on accurate and sufficient supervision [5; 6] to provide categorical or cross-domain pairing labels. The acquisition of such information demands costly efforts and resources. Hence, there is an urgent need to develop unsupervised CDR techniques.

For the regular Unsupervised CDR (UCDR) problem [7; 8], there are two data domains with semantic similarity but distinct characteristics: the query domain and the retrieval domain. Despite the absence of category labels, regular UCDR typically assumes that the label spaces of both domains are identical. However, in real-world applications , _the categorical composition of an unlabeled data domain is usually uncertain, which is hard to acquire without detailed analysis and dedicated expertise_. In this work, we focus on extending UCDR to more universal scenarios, which allow for the possibility of disparate category spaces across domains. The objective of this _Universal UCDR_ (\(^{2}\)) problem is to retrieve samples from the retrieval domain that share the same category label with a query samplefrom the query domain. Naturally, in the case of private categories exclusive to the query domain, the retrieval result should be null.

Two issues must be addressed in solving traditional UCDR: 1) effectively distinguishing data samples in each domain, and 2) achieving alignment across domains for samples of the same category. For the first issue, self-supervised learning [9; 10] (SSL) is employed independently within each domain. For the second, many nearest-neighbor searching algorithms may apply. However, for \(^{2}\), applying these existing methods introduces new challenges. First, the prevailing SSL methods, particularly contrastive learning [9; 11; 10], are highly influenced by the category label space , which means different label spaces lead to distinct semantic structures. Second, existing nearest-neighbor searching algorithms [13; 14; 7] overlook the presence of domain gaps. We found that only by first addressing the domain gap can the nearest neighbor searching become reliable and accurate.

Thus, to effectively address the above challenges in solving \(^{2}\), we propose a two-stage Unified, Enhanced, and Matched (UEM) semantic feature learning framework, as in Figure 1. In the first stage, we establish a cross-domain unified prototypical structure with an instance-prototype-mixed (IPM) contrastive loss, accompanied by a semantic-enhanced loss (SEL). In the second stage, before conducting cross-domain category alignment, we incorporate Semantic-Preserving Domain Alignment (SPDA) to diminish the domain gap while ensuring minimal changes for the established prototypical structure. As the domain gap diminishes, we propose Switchable Nearest Neighboring Match (SN\({}^{2}\)), to select more reliable cross-domain neighbors based on the relationship between instances and prototypes. Extensive experiments and ablation studies on popular benchmark datasets demonstrate that our method can substantially outperform state-of-the-art methods from UCDR and other related problems. In addition, we also theoretically analyze the principles behind the major challenges of \(^{2}\) and the design intuition of UEM. In summary, this work made the following contributions:

* Universal UCDR (\(^{2}\)), where the category spaces of different domains are distinct.
* We propose a two-stage Unified, Enhanced, and Matched (UEM) semantic feature learning framework to solve \(^{2}\). In the first stage, UEM establishes a unified prototypical structure across domains, to ensure consistent semantic learning under category space differences. In the second stage, UEM achieves more effective domain alignment and cross-domain pairing.
* We conduct extensive experiments on multiple benchmark datasets, with settings including Close-set, Partial, and Open-set UCDR. The results demonstrate that UEM can substantially outperform state-of-the-art methods of UCDR and other potential solutions in all settings.

## 2 Related Work

**Cross-Domain Retrieval** (CDR) is not very difficult to achieve if there are categorical labels [15; 16]. However, in real-world applications, such categorical labeling information is hard to acquire, thus

Figure 1: Overview of our proposed UEM semantic feature learning framework for \(^{2}\). In the first stage of Intra-Domain Semantic-Enhanced Learning, UEM establishes a unified prototypical structure across domains, which is driven and enhanced by an instance-prototype-mixed contrastive loss and a semantic-enhanced loss. In the second stage of Cross-Domain Semantic-Matched Learning, Semantic-Preserving Domain Alignment aligns domains while preserving the built prototypical structure, and Switchable Nearest Neighboring Match achieves more accurate cross-domain categorical pairing.

more recent works [7; 8; 17] focus on achieving unsupervised CDR (UCDR). CDS  proposes a contrastive learning-based cross-domain pre-training to align different domains. PCS  incorporates prototype contrastive learning  into the cross-domain pre-training. Recent studies also search ways like clustering , pseudo-labeling , classifier mixup , and data augmentation  to achieve more advanced CDR. However, all these UCDR works assume that the query and retrieval domains share the same category space. Although there is a study  that can achieve CDR with distinct categories, its effectiveness relies on accurate and sufficient data labels.

**Universal Cross-Domain Learning.** Cross-domain learning consists of domain adaptation (DA) and domain generalization (DG) . Regular DA and DG also only consider the scenario where the label space of the target domain is the same as the source label space, which is termed Close-set DA/DG. Recently, more studies have realized that the target label space may be a subset of the source one (i.e., Partial DA/DG) [21; 22] or contain some private labels that other domains do not have (i.e., Open-set DA/DG) [23; 24]. To deal with more universal setups, UniDA  unifies entropy and domain similarity to quantify sample transferability across domains. CMU  extends transferability quantification into entropy, consistency, and confidence. More recent works search ways like clustering [27; 28] and nearest neighbor matching [29; 30] to achieve universal DA/DG. In addition, some studies appear to achieve unsupervised DG where the source domain is also unlabeled [31; 32], which is similar to the setup of UCDR. However, these studies consider the classification task and cannot effectively work in image retrieval, especially in completely unsupervised cases.

## 3 Methodology

### Problem Formulation

In the problem of \(^{2}\), we assume there are two domains characterized by \(N^{}\) and \(N^{}\) unlabeled instances, which are denoted as \(^{}\!=\!\{_{i}^{}\}_{i=1}^{N^{}}\) and \(^{}\!=\!\{_{i}^{}\}_{i=1}^{N^{}}\), respectively. Although these two domains are provided as unlabeled data without category labels, we assume their label spaces \(^{}\), \(^{}\) consist of \(C^{}\) and \(C^{}\) different categories, and there is a relationship that \(C^{} C^{},^{}^{ }^{}^{}\). Without losing generality, if we regard domain \(\) as the query domain, while domain \(\) is the retrieval domain, the objective of \(^{2}\) is to retrieve correct data from domain \(\) that belongs to the same categories as the query data provided by domain \(\). To achieve this objective, it is required to train a valid feature extractor \(f_{}:\) that can map both these two domains from the input space \(\) to a feature space \(\). Then the retrieval process \(R(f_{},_{i}^{})\) is shaped like for a particular query instance \(_{i}^{}\) with the label \(y_{i}^{}\) from domain \(\), the representation distance between all instances in domain \(\) and \(_{i}^{}\) needs to be calculated to form a set, i.e., \(=\{(f(_{j}^{}),f(_{i}^{}) )\}_{j=1}^{N^{}}\) where \(()\) is a particular distance metric (e.g., Euclidean Distance), and we have

\[R(f_{},_{i}^{})=\{, \,\,y_{i}^{}^{} ^{}\\ _{}()[1:k],\,,.\] (1)

where \(_{}()\) means ascending order sorting, and \([1:k]\) denotes the first \(k\) elements of a set.

**Method Overview.** To solve \(^{2}\), we propose a Unified, Enhanced, and Matched (UEM) semantic feature learning framework that consists of two stages - Intra-Domain Semantic-Enhanced (IDSE, Section 3.2) Learning and Cross-Domain Semantic-Matched (CDSM, Section 3.3) Learning, which is shown in Figure 1. IDSE can help the feature extractor \(f_{}\) to extract categorical semantics and ensure a unified semantic structure across domains at the same time, which is achieved by instance-prototype-mixed (IPM, Section 3.2.1) contrastive learning and a novel Semantic-Enhanced Loss (SEL, Section 3.2.2). After IDSE, CDSM conducts Semantic-Preserving Domain Alignment (SPDA, Section 3.3.1) to minimize the domain gap while preserving the semantic structure learned by IDSE. With the minimization of the domain gap, more accurate nearest-neighbor searching can be achieved by our Switchable Nearest Neighboring Match (SN\({}^{2}\)M, Section 3.3.2).

### Intra-Domain Semantic-Enhanced Learning

To achieve effective cross-domain retrieval, feature extractor \(f_{}\) needs to learn consistent cross-domain features to differentiate data categories. Instance Discrimination  is usually employed to achieve discriminative feature learning, but directly applying it in \(^{2}\) has four fundamental issues that hinder the possibility of accurate cross-domain categorical matching later:

1) Instance discrimination tends to extract semantics that separate domains rather than categories,

\[(f(_{i}^{}),f(_{j}^{}))<(f( _{i}^{}),f(_{j}^{})),\,y_{i}^{}=y_{j }^{} y_{j}^{}.\] (2)

2) Instance discrimination cannot characterize categorical semantics in the feature space,

\[(_{i}^{},_{j_{1}}^{})}{(_{i}^{},_{j_{2}}^{})}<(f( _{i}^{}),f(_{j_{1}}^{}))}{(f( _{i}^{}),f(_{j_{2}}^{}))},\,y_{i}^{}=y_{j _{1}}^{} y_{j_{2}}^{}.\] (3)

3) The randomness introduced by stochastic data augmentations results in evident changes in learned categorical semantic structures during training, i.e.,

\[(G(_{t}^{}),G(_{t+1}^{})) _{_{i}^{},_{j}^{}}(G(_{i}^{}),G(_{j}^{})),\] (4)

where \(G()\) corresponds to a graph constructed by the input vectors, and \(\) denotes the set of categorical prototypes for a domain. The subscript \(t\) denotes different training iterations, while \(\) represents the hypothesis space of possible categorical prototype sets for a particular domain. \(()\) here is a measurement for graph difference, e.g., graph edit distance .

4) Distinct label spaces make instance discrimination learn different categorical semantic structures:

**Theorem 3.1** (Geometry Distinctness).: _Suppose data distributions of two domains (A and B) have mutually disjoint supports, and they are uniform over these supports. Assuming the support sets of domains A and B are not identical, the optimal feature extractors \(f^{*}\) that minimize the instance discrimination loss of different domains present distinct geometric feature spaces._

#### 3.2.1 Instance-Prototype-Mixed Contrastive Learning.

To fix the above issues, we adopt a slowly momentum-updated contrastive learning algorithm - MoCo , to handle the third issue reflected by Eq. (4). Moreover, the MoCo-based instance discrimination is conducted separately for each domain, which encourages \(f_{}\) to focus less on learning domain semantics (for the first issue, Eq. (2)). Besides, we accompany MoCo with a prototypical contrastive loss, to enhance the mapping of categorical semantics from the input space to the feature space (for addressing the second issue, Eq. (3)). With a well-crafted prototype update mechanism, this prototypical contrastive loss can also help build a unified semantic structure across domains (for the last issue, Theorem 3.1). Then let us introduce \(\) contrastive learning in detail. First of all, two memory banks \(^{}\) and \(^{}\) are maintained for domains A and B, which store historical features \(\) of data samples \(\):

\[^{}=[_{1}^{},...,_{^ {}}^{}],^{}=[_{1}^{ },...,_{^{}}^{}],_{i}_{i}+(1-)f_{}(_{i}).\] (5)

Here \(_{i}\) is initialized by the feature of \(_{i}\) extracted by the initial \(f_{}\) and updated in momentum, where \(\) controls the momentum speed, and we set it as a popular value \(0.99\). With these two memory banks, MoCo builds the positive pairs as the pair of each instance and its historical feature, while the negative ones are pairs of each instance and the historical features of all other instances:

\[_{}=_{i=1}^{B}-(_{i})_{i}/)}{_{j=1}^{B}(f_{}(_{i}) _{j}/)},\] (6)

where \(B\) is the batch size and \(\) is a temperature factor that is set as \(0.07\).

As for the design of our prototypical contrastive loss, K-Means is applied on \(^{}\) and \(^{}\) to construct prototypes as cluster centers \(=\{_{e}\}_{c=1}^{}\). In our problem, the cluster number \(C\) is unknown, thus we apply the Elbow approach  to estimate it as \(\). Then, for each instance \(_{i}\), if it belongs to the \(c_{i}\)-th cluster, the prototypical contrastive loss \(_{}\) shapes like,

\[_{}=_{i=1}^{B}-( {x}_{i})_{c_{i}}/)}{_{c=1}^{}(f_{ }(_{i})_{c}/)}.\] (7)

Until here, the first three issues can be fixed by mixing \(_{}\) and \(_{}\), but the last issue, Theorem 3.1, is the bottleneck of \(^{2}\). Next, let us introduce how we build a unified prototypical structure for \(_{}\) to address the last issue. Specifically, after obtaining the prototype sets \(^{},^{}\) of domain A and B, if we take domain A as an example to illustrate the prototypical structure building process, the prototype set \(^{}\) of domain B will be translated to domain A as,

\[^{}=\{_{c}^{ }=_{c}^{}}+ {^{}^{}}}\}_{c=1}^{ }^{}},\] (8)

where \(}\) denotes the average vector of all vectors in \(\). Next, each prototype \(_{c}^{}^{}\) searches its closest \(_{c}^{}^{ }\) (we use Hungarian algorithm to search the closest cross-domain prototypes) for the opportunity of merging, which needs to satisfy the condition,

\[d(_{c}^{},_{c}^{})< [_{_{i},_{j}^{}}d(_{i}, {p}_{j}),_{_{i},_{j}^{}}d(_{i}, _{j})],\] (9)

where \(d(,)\) computes the Euclidean distance. If we use the symbol \(\) to identify prototypes that satisfy this merging condition, the final prototypical structure for domain A is \(^{^{}}=(^{} ^{,})(^{ }^{, })(^{,}^{ ,})\) where \((^{,}^{ ,})=\{(_{c^{}}^{,}+_{c}^{,})/2 \}_{c=1}^{C^{}}\). Then the computation of \(_{}^{}}\) - Eq. (7) for domain A is conducted on the newly-built \(^{}}\), and all these operations are same for domain B.

However, as establishing the semantic cluster-like structure requires time, it is unreasonable to conduct prototype contrastive learning from the beginning of training. Therefore, we conduct instance discrimination at the beginning and progressively incorporate \(_{}\). In this case, not only are the constructed cluster centers more reliable, but the Elbow approach also provides more accurate cluster number estimations. Specifically, we use a coefficient \(\) that is scheduled by a Sigmoid function to control the incorporation weight of \(_{}\), i.e.,

\[_{}=_{}+_{ },\,\,=,\] (10)

\(E\) and \(e\) here are the overall training epochs and the current epoch for \(\).

#### 3.2.2 Semantic-Enhanced Loss.

For the IPM contrastive learning, it is arbitrary to allocate a data instance \(_{i}\) to a single cluster when the preferred semantic prototypical structure cannot be learned in advance. As a result, to speed up the structure-building process, we propose a novel _Semantic-Enhanced Loss_ (\(\)) to align data instances with the prototypes better. Specifically, instead of assigning data instances with a single cluster, \(\) considers potential semantic relationships between instances with all clusters, which are measured by the Softmax probability. Moreover, as both \(^{}\) and \(^{}\) are obtained by the Euclidean distance-based K-Means, we directly minimize the Euclidean distance between samples and prototypes:

\[_{}=_{i=1}^{B}_{c=1}^{}(_{i})_{c}/)}{_{c=1}^{} (f_{}(_{i})_{c}/)}d(f_{}(_{i}),_{c}),\] (11)

where \(\) denotes the number of prototypes after merging, e.g., \(^{}\) is the number of elements in \(^{}}\). By taking all potential semantic correlations into account, \(\) can alleviate the impact of the noise within the K-Means clustering results and further guide the model to learn more distinguishable semantic information in terms of Euclidean distance. Certainly, such \(\) benefits also rely on high-quality semantic prototypical structures. As a result, we also apply the progressive coefficient \(\) to \(\), then the final optimization objective for \(\) is

\[_{}=(_{}^{}+ _{}^{})+(_{}^{}+ _{}^{}).\] (12)

### Cross-Domain Semantic-Matched Learning

#### 3.3.1 Semantic-Preserving Domain Alignment.

Domain invariance is another requirement for the extracted features in UEM. However, it is difficult to effectively align feature clusters across domains when no category label nor correspondence annotation can be utilized in \(^{2}\)CDR. Instance matching [7; 32; 13] is proposed to match an instance \(_{i}^{}\) to another instance \(_{j}^{}\) in the other domain with the most similar features. However, due to the domain gap, instances can be easily mapped mistakenly. For example, if there is an instance in one domain that is extremely close to the other domain, it will be determined as the nearest neighbor for all instances in the other domain , shown in Figure 2. As a result, before conducting instance matching, the domain gap needs to be diminished. Existing works usually leverage discrepancy minimization  or adversarial learning  to achieve domain alignment. However, these methods provide inferior performance due to semantic categorical structure changes, i.e., the semantic correlations among instances within domains change a great deal during domain alignment, shown in Figure 3.

To achieve more effective domain alignment, especially with semantic preservation, we propose Semantic-Preserving Domain Alignment (SPDA). Similar to the standard domain adversarial learning, SPDA happens on two parties, one is the feature extractor \(f_{}\), and the other is a domain classifier \(g_{}\) parameterized on \(\). The domain classifier tries to distinguish the representations of two domains, while the feature extractor tries to fool the domain classifier. Thus, the training is shaped like a bi-level optimization in terms of the domain classification task on \(\) and \(\), shown as follows,

\[_{}=_{i=1}^{2B}-y_{i} g_{}(f_{} (_{i}))-(1-y_{i})(1-g_{}(f_{}(_{i}))),\] (13)

where \(y\) here denotes the domain label, e.g., if we regard \(y=1\) for domain A, the domain label of domain B is \(y=0\). After sufficient adversarial training, the feature extractor captures nearly domain-invariant features, thus achieving domain alignment.

To prevent the semantic structure from being changed, we first make a copy for the model trained by DISE and denote it as \(f^{}_{}\). Then for a mini-batch of a particular domain, we feed all instances to \(f^{}_{}\) and calculate pair-wise cosine similarity and Euclidean distance. In this way, all these instances constrain and influence each other, which means that when the correlation of a particular instance pair changes, it will affect the correlations of other related pairs. Then, we apply a semantic-preserving regulation into domain adversarial learning to make the pair-wise correlations unchanged,

\[_{}=}_{i=1}^{B}_{j=1}^ {B} (_{i}) f_{}(_{j})}{|f _{}(_{i})||f_{}(_{j})|}-}( {x}_{i}) f_{^{}}(_{j})}{|f_{^{}}(_{i })||f_{^{}}(_{j})|}^{2}\] (14) \[+[d(f_{}(_{i}),f_{}(_{j}))-d(f_{^{ }}(_{i}),f_{^{}}(_{j}))]^{2}\}.\]

**Recall IPM Contrastive Learning.** Actually, aligning two domains together without any semantic structure change is impossible. As a result, there is a need for a dedicated design to alleviate the impact of such unavoidable changes. Our solution is to strengthen the instances' semantic correlations by enhancing the cluster's inner density and inter-separability. For the final convergence of IPM contrastive learning, each instance is optimized to get as close to its corresponding cluster prototype as possible, and as far to other cluster prototypes as possible:

**Theorem 3.2** (Convergence of IPM).: _Suppose the data distribution of a domain has mutually disjoint supports, and it is uniform over these supports. Simplex Equiangular Tight Frame (ETF) representations  minimize the Instance-Prototype-Mixed Loss of this domain._

#### 3.3.2 Switchable Nearest Neighboring Match.

With SPDA, the domain gap could be effectively minimized to enable more accurate cross-domain instance matching. However, existing instance matching approaches [7; 13; 32] lack the capability of measuring the matching reliability between an instance and its nearest neighbor, which allows us to conduct cross-domain matching with different weights. For example, if an instance is located at the joint boundary of multiple categories, which indicates that the current feature extractor cannot extract sufficiently distinguishable semantic features for this instance, we are supposed to lay less emphasis on this case. To fix such issues, we propose the Switchable Nearest Neighboring Match (SN\({}^{}\)M).

The principle behind SN\({}^{}\)M is that prototypes are more convincing and reliable. Specifically, for a particular sample \(_{i}^{}\) in domain A, we first determine its inner nearest cluster prototype \(_{c_{i}}^{}\) in domain A. We can also search for the nearest instance \(_{i}^{}\) in domain B. Both these two searching processes are based on the product of a modified cosine similarity and Euclidean distance,

\[_{c_{i}}^{} =_{_{j}^{}}[(1-( _{i}^{})_{j}^{}}{|f_{}(_{i}^{ })||_{j}^{}|}) d(f_{}(_{i}^{ }),_{j}^{})]\] (15) \[_{i}^{} =_{_{j}^{}}[(1-( _{i}^{}) f_{}(_{j}^{})}{|f_{}( _{i}^{})||f_{}(_{j}^{})|}) d(f_{ }(_{i}^{}),f_{}(_{j}^{}))].\] (16)

After obtaining \(_{i}^{}\), SN\({}^{}\)M searches for its inner nearest prototype \(_{c_{i}}^{}}\) in \(^{}}\) (which has been merged with the translated prototype set \(^{}\) from domain A) and two cases allows us to measure the reliability of \(_{i}^{}\). Before introducing these two cases, the inner nearest prototype \(_{c_{i}}^{}\) of \(_{i}^{}\) needs to be translated to domain B and checked whether should be merged to follow condition Eq. (9), and we denote the translated prototype as \(}_{c_{i}}^{}\). Then the first potential case is \(_{c_{i}}^{}}\) is exactly identical to \(}_{c_{i}}^{}\), which means, \(_{i}^{}\) is convincing since it shares the same prototype correlations with \(_{i}^{}\) across two domains. Then the pair of \(_{i}^{}\) and \(_{i}^{}\) should be viewed as a positive pair in the contrastive loss. Otherwise, if \(_{c_{i}}^{}}\) is different from \(}_{c_{i}}^{}\), it may be located at the intersection region of multiple clusters. In this case, the pair of \(_{i}^{}\) and \(_{i}^{}\) is not supposed to be treated as a positive pair. However, it does not mean SN\({}^{}\)M does nothing for these unreliable cases, instead, SN\({}^{}\)M leverages a modified prototype contrastive loss to match the pair of \(_{i}^{}\) and \(}_{c_{i}}^{}\). The modification is to incorporate cross-domain instance-wise negative comparison,

\[&_{^{}}= _{i=1}^{B}-^{_{i}^{}} (f_{}(_{i}^{})_{c}^{}}/ )+_{j=1}^{N^{}}(f_{}(_{i}^{}) f_ {}(_{j}^{})/)}\\ &\,=\{(f_{}( _{i}^{})}_{c_{i}}^{}/),\, {if}\,\,_{c_{i}}^{}}}_{c_{i}}^{ },\\ (f_{}(_{i}^{})}_{c_{i}}^{}/)+(f_{}(_{i}^{}) f_{}(_{i}^{ })/),\,..\] (17)

Finally, the overall optimization objective of CDSM follows

\[_{}=_{}+_{}^{ }+_{}^{}+_{^{}}^{}+_{^{}}^{}.\] (18)

## 4 Experiments

The datasets, experimental settings, and comparison baselines are introduced below. More implementation details, experiment results, and source codes are provided in the Supplementary Materials.

**Datasets.**_Office-31_ includes three domains with 31 classes: Amazon (A), DSLR (D), Webcam (W). _Office-Home_ contains four different domains: Art (A), Clipart (C), Product (P), Real (R). And each domain has 67 data categories. _DomainNet_ is the most challenging cross-domain dataset to our best knowledge, which includes six domains: Quickdraw (Qu), Clipart (Cl), Painting (Pa), Infograph (In), Sketch (Sk) and Real (Re). DomainNet is originally class-imbalanced, thus we follow  to select 7 data classes that contain more than 200 samples.

**Experiment Settings.** For fair comparison, we apply ResNet-50  pre-trained with ImageNet in MoCov2  as the feature extractor. The domain classifier consists of two fully-connected layers.

The SGD optimizer with a momentum of 0.9 is adopted with an initial learning rate of 0.0002 that is scheduled to zero by a cosine learning strategy. The batch size is 64. The training epochs of IDSE are 100 for Office-31 and Office-Home, and 200 for DomainNet. The epoch number of CDSM is 50 for all three datasets. Following , we adopt mean average precision on all retrieved results (mAP@All) to measure the performance. All experiments are run repeatedly 3 times with seeds 2024, 2025, and 2026, and we report the mean performance and standard deviation.

**Comparison Baselines.** Our proposed method is compared with a comprehensive set of state-of-the-art works from Cross-Domain Representation Learning (CDS , PCS ), Unsupervised Domain Generalization (DARL , DN2A ), and Unsupervised Cross-Domain Retrieval (UCDIR , CoDA , DGDIR ). We follow their default settings and only conduct compulsory customization.

### Effectiveness of UEM When Solving U\({}^{2}\)CDR

**Close-set Unsupervised Cross-Domain Retrieval.** For the close-set setting, the label space of the query domain is identical to the retrieval domain. All domain pairs of Office-31 and Office-Home are tested, and 5 pairs of DomainNet. The results for Office-31 and DomainNet are shown in Table 1 (Office-Home can be found in the Appendix). According to these results, we can observe that _UEM significantly outperforms other baselines in all cases_. Specifically, we can achieve mAP@All improvement of 2.6% compared to the best baseline method on Office-31, and such improvement is even larger on DomainNet with an average of 3.6%. Figure 4 also shows the retrieval results of our approach on Office-31, Office-Home, and DomainNet, and we can observe that all results are correct.

**Partial Unsupervised Cross-Domain Retrieval.** To establish the partial setting, the query domain contains only half of the label space of the retrieval domain, and the query label space is randomly selected. As shown in Table 2, we can observe that _UEM exceeds all other baseline methods significantly in mAP@All, which is much more substantial than close-set UCDR_. For example, UEM outperforms the second-best with an average of 12.4% on Office-Home. Similar improvements

   Methods & A\(\)D & D\(\)A & D\(\)W & W\(\)A & W\(\)D & Avg. & Q\(\)Cl & Cl\(\)Pa & Pa\(\)In & \(\)Sk & Sk\(\)Re & Avg. \\  CDS & 66.7\({}_{ 1.1}\) & 62.5\({}_{ 0.9}\) & 70.9\({}_{ 1.0}\) & 90.0\({}_{ 0.4}\) & 64.4\({}_{ 1.5}\) & 88.4\({}_{ 2.1}\) & 73.8\({}_{ 0.5}\) & 19.2\({}_{ 1.0}\) & 35.1\({}_{ 1.3}\) & 24.4\({}_{ 0.5}\) & 25.5\({}_{ 0.7}\) & 32.3\({}_{ 1.7}\) & 27.3\({}_{ 0.8}\) \\ PCS & 72.7\({}_{ 2.2}\) & 70.7\({}_{ 0.7}\) & **75.3\({}_{ 1.4}\)** & 88.5\({}_{ 3.0}\) & 71.2\({}_{ 1.5}\) & 89.2\({}_{ 2.6}\) & 77.9\({}_{ 1.1}\) & 22.2\({}_{ 0.9}\) & 36.0\({}_{ 1.3}\) & 27.7\({}_{ 0.3}\) & **28.0\({}_{ 0.3}\)** & 33.0\({}_{ 0.7}\) & 29.4\({}_{ 0.1}\) \\ DARL & 65.5\({}_{ 2.5}\) & 70.2\({}_{ 1.9}\) & 73.4\({}_{ 3.0}\) & 86.6\({}_{ 2.6}\) & 69.3\({}_{ 3.8}\) & 83.7\({}_{ 2.5}\) & 74.7\({}_{ 2.2}\) & 22.1\({}_{ 0.3}\) & 33.7\({}_{ 1.1}\) & 25.9\({}_{ 0.8}\) & 27.2\({}_{ 0.6}\) & 32.5\({}_{ 1.0}\) & 28.3\({}_{ 0.4}\) \\ DN2A & 71.1\({}_{ 1.0}\) & **72.4\({}_{ 2.2}\)** & 72.5\({}_{ 1.4}\) & 88.5\({}_{ 2.1}\) & 71.2\({}_{ 1.1}\) & 90.0\({}_{ 1.5}\) & 77.2\({}_{ 2.2}\) & 23.3\({}_{ 0.5}\) & 35.0\({}_{ 0.6}\) & 26.0\({}_{ 1.1}\) & 27.7\({}_{ 2.3}\) & 33.0\({}_{ 1.6}\) & 29.0\({}_{ 0.7}\) \\ UCDIR & **73.7\({}_{ 1.5}\)** & 69.9\({}_{ 3.1}\) & 74.6\({}_{ 0.4}\) & 91.4\({}_{ 1.1}\) & 73.1\({}_{ 0.9}\) & 90.2\({}_{ 0.6}\) & 78.8\({}_{ 1.2}\) & 25.8\({}_{ 1.1}\) & **36.6\({}_{ 1.3}\)** & 28.0\({}_{ 0.5}\) & 27.5\({}_{ 1.3}\) & **34.1\({}_{ 0.7}\)** & 30.4\({}_{ 0.4}\) \\ CoDA & 71.7\({}_{ 2.0}\) & 71.4\({}_{ 4.3}\) & 74.9\({}_{ 2.7}\) & 91.4\({}_{ 2.7}\) & 73.1\({}_{ 0.9}\) & 90.2\({}_{ 1.1}\) & 78.8\({}_{ 1.5}\) & 26.0\({}_{ 0.8}\) & 34.9\({}_{ 1.1}\) & 29.2\({}_{ 0.4}\) & 27.9\({}_{ 1.0}\) & 33.8\({}_{ 1.0}\) & 30.4\({}_{ 0.5}\) \\ DGDIR & 73.5\({}_{ 2.1}\) & 71.2\({}_{ 1.4}\) & 75.1\({}_{ 3.0}\) & **91.7\({}_{ 1.1}\)** & **74.0\({}_{ 1.9}\)** & **90.5\({}_{ 0.4}\)** & **79.3\({}_{ 0.6}\)** & **62.77\({}_{ 0.4}\)** & 35.0\({}_{ 1.5}\)** & **30.0\({}_{ 2.2}\)** & 27.8\({}_{ 1.5}\) & 33.6\({}_{ 0.2}\) & **30.8\({}_{ 0.9}\)** \\  Ours & **76.2\({}_{ 1.1}\)** & **77.0\({}_{ 2.1}\)** & **75.6\({}_{ 0.2}\)** & **92.5\({}_{ 0.7}\)** & **78.9\({}_{ 3.9}\)** & **91.0\({}_{ 0.2}\)** & **81.9\({}_{ 0.5}\)** & **31.9\({}_{ 0.9}\)** & **39.4\({}_{ 1.4}\)** & **35.9\({}_{ 0.7}\)** & **29.8\({}_{ 0.6}\)** & **35.7\({}_{ 1.8}\)** & **34.4\({}_{ 0.5}\)** \\   

Table 1: Performance comparison (mAP@All) between ours and other baseline methods on Office-31 and DomainNet in Close-set Unsupervised Cross-Domain Retrieval. We blue and bold **the best performance**, and bold **the second best**, same for all tables.

Figure 4: Retrieval results of UEM and DGDIR on Office-31 (A\(\)D), Office-Home (A\(\)C), and DomainNet (Cl\(\)Pa) in Close-set Unsupervised Cross-Domain Retrieval. Green and red rectangles denote correct and incorrect retrieval results. Best viewed in colors.

[MISSING_PAGE_FAIL:9]

**Effectiveness of SN\({}^{2}\)M.** We also replace SN\({}^{2}\)M with the nearest neighboring search approach leveraged by UCDIR. By comparing the results of 'Ours w/o SN\({}^{2}\)M' and 'Ours', we can conclude that SN\({}^{2}\)M is more compatible with UEM and able to achieve more accurate cross-domain categorical matching.

## 5 Conclusion

In this work, we focus on two major challenges when conducting cross-domain retrieval (CDR) in real-world scenarios: one is that the category space across domains is usually distinct, and the other is that both the query and retrieval domains are unlabeled. To tackle these challenges, we propose a Unified, Enhanced, and Matched (UEM) semantic feature learning framework that can establish a unified semantic structure across domains and preserve this structure during categorical matching. Extensive experiments in cases including close-set, partial, open-set unsupervised CDR on multiple datasets demonstrate the effectiveness and universality of UEM, which are reflected in the substantial performance improvement over state-of-the-art studies from Cross-Domain Representation Learning, Unsupervised Domain Generalization, and Unsupervised CDR.

## 6 Limitations and Future Work

To solve the real-world challenges when employing cross-domain retrieval, especially considering the category distinctness across unsupervised data domains, we propose the UEM semantic feature learning framework in this work. Although extensive empirical evaluation and theoretical analysis have validated the effectiveness of UEM, some minor limitations still need more exploration. First, the current UEM framework is composed of two stages, and we empirically determine the switching point. In the future, we need to achieve a real end-to-end UEM by changing the training stage automatically. Besides, there is a lack of theoretical analysis for the second stage (CDSM). In future efforts, we should theoretically prove the semantic preservation of SPDA and the reliability of SN\({}^{2}\)M. Lastly, the general applicability of UEM also needs testing. For instance, cross-person generalization in wearable devices  and property analysis of material  or molecular  structures require cross-domain retrieval. Therefore, we should test UEM on other modalities like time series and graph data.