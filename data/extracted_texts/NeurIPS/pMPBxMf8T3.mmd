# The Implicit Bias of Heterogeneity towards Invariance:

A Study of Multi-Environment Matrix Sensing

 Yang Xu

School of Mathematical Sciences

Peking University

xuyang1014@pku.edu.cn

&Yihong Gu

Department of Operations Research and Financial Engineering

Princeton University

yihongg@princeton.edu

&Cong Fang

School of Intelligence Science and Technology

Peking University

fangcong@pku.edu.cn

Equal Contribution.Corresponding author.

###### Abstract

Models are expected to engage in invariance learning, which involves distinguishing the core relations that remain consistent across varying environments to ensure the predictions are safe, robust and fair. While existing works consider specific algorithms to realize invariance learning, we show that model has the potential to learn invariance through standard training procedures. In other words, this paper studies the implicit bias of Stochastic Gradient Descent (SGD) over heterogeneous data and shows that the implicit bias drives the model learning towards an invariant solution. We call the phenomenon the _implicit invariance learning_. Specifically, we theoretically investigate the multi-environment low-rank matrix sensing problem where in each environment, the signal comprises (i) a lower-rank invariant part shared across all environments; and (ii) a significantly varying environment-dependent spurious component. The key insight is, through simply employing the large step size large-batch SGD sequentially in each environment without any explicit regularization, the oscillation caused by heterogeneity can provably prevent model learning spurious signals. The model reaches the invariant solution after certain iterations. In contrast, model learned using pooled SGD over all data would simultaneously learn both the invariant and spurious signals. Overall, we unveil another implicit bias that is a result of the symbiosis between the heterogeneity of data and modern algorithms, which is, to the best of our knowledge, first in the literature.

## 1 Introduction

In real applications, the machine learning models are often heavily over-parameterized, which means that the number of parameters exceeds the number of data. For over-parameterized models,the generalization in the general case becomes ill-posed. One key insight to generalize well is the implicit preference of the optimization algorithm which plays the role of regularization/bias [45; 22]. Nowadays, there are several kinds of implicit bias discovered from optimization algorithms under different models and settings. One common feature of the bias is the simplicity which concludes that (stochastic) gradient-based algorithms perform the incremental learning with the model complexity gradually increasing. Therefore, benign generalization is possible even when the number of training data is limited. For example, Li et al. , Gunasekar et al.  show that unregularized gradient descent can find the low-rank solution efficiently for matrix sensing models. Kalimeris et al. , Gissin et al. , Jiang et al. , and Jin et al.  further show that (Stochastic) Gradient Descent ((S)GD) learn models from simple ones to complex ones. Most of the existing works study the implicit bias of algorithms over a single distributional environment data.

However, data in modern practice are often collected from multiple sources, thus exhibiting certain heterogeneity. For example, medical data may come from multiple hospitals, and training sets for large language models consist of numerous corpus from the Internet . So _what is the impact of implicit bias for standard training algorithms over heterogeneous data?_

This paper initializes the study and shows that implicit bias of SGD on an over-parameterized model using multi-environment heterogeneous data and shows that the implicit bias can not only save the number of training data but also, more importantly, drive the model learning the invariant relation across diverse environments.

Learning the invariant relation that remains consistent across varying environments  has garnered significant attention in recent years. Though the association-based standard machine learning pipelines can achieve a good performance with identical data distributions, a higher requirement is to make predictions robustly generalize over diverse downstream environments. Learning invariance produces reliable, fair, robust predictions against strong structural mechanism perturbation. More importantly, it opens the door to pursue causality blind to any prior knowledge and can unveil direct causes when the heterogeneity among environments is sufficient [17; 43]. While existing works consider specific algorithms to realize invariance learning, this work shows that implicit bias of algorithms over heterogeneous data has the potential to automatically learn the invaraince. We call the phenomenon _the implicit invariance learning_, partially explains why active invariance learning may not be necessary in practice . Our key insight is:

Figure 1: An illustration comparing training from aggregated data versus from heterogeneous data. The left example resembles the case where the model is trained on complete datasets, resulting in a stable spurious signal that the model tends to fit. The right example simulates a two-environment case where the spurious signal changes at each step. This oscillation creates a contraction effect, preventing the model from fitting the spurious signal.

_The heterogeneity of the data, and the large step size adopted in the optimization algorithm jointly provide strong multiplicative oscillations in the spurious signal space, which prevents the model from moving in the direction of unstable and spurious solutions, thus resulting in an implicit bias to the invariant solution._

We illustrate it rigorously through a simple, canonical but insightful model - multi-environment matrix sensing, where in each environment the signal consists of two parts: an invariant low-rank matrix \(^{}^{d d}\) and an environment-varying spurious low-rank matrix \(^{(e)}^{d d}\) where environment \(e\), the set of environments. For each environment \(e\), the joint distribution of \((^{(e)},y^{(e)})\) satisfies \(y^{(e)}=^{(e)},^{}+^{ (e)},^{(e)}\) with matrix inner product \(,=(^{})\). Here \(^{(e)}^{d d}\) is a random linear measurement and \(y^{(e)}\) is the response. We consider the case that association does not coincide invariance (or causality), where averaging over all the environments, the best prediction of \(y\) given \(\) is

\[f^{}()=,^{} }_{invariant\ part}+,_{e}[ ^{(e)}]}_{spurious\ part}_{e} [^{(e)}] 0.\]

In this case, it is not surprising that given enough data, the standard empirical risk minimizer algorithm, for example, running SGD on pooled data, will return a solution that converges to \(f^{}\), which diverges from the invariant solution. In this paper, we will show that surprisingly, if each batch is sampled from data in one environment rather than data in all the environments, the heterogeneity in the environments together with the implicit regularization effects in the SGD algorithm can drive it towards the invariant solution. This can be stated informally as follows.

**Theorem 1** (Main result, informal).: _Under a sufficient heterogeneity condition and some regularity conditions in matrix sensing, if we adopt an over-parameterized model and runs stochastic gradient descent where batches are sampled from one environment, i.e., \(\) (Algorithm 3), then_

\[\|_{}-^{}\|_{F}=o_{}(1).\]

_Instead, the standard approach, i.e., \(\), will return solution \(_{}\) satisfying_

\[\|_{}-^{}-^{}\|_ {F}=o_{}(1)\|_{}- ^{}\|_{F}=_{}(1).\]

An illustration of our result is shown in Figure 1. Our result demonstrates that implicit bias of commonly used algorithms over heterogeneous data has the potential to drive the model to learn the invariant relation. Such a result thereby provides an explanation for why models may attain some robust and even causal prediction after SGD training.

We emphasize that the previous implicit bias studies are restricted to the same data distribution generalization, under which the population-level minimizer \(f^{}\) minimizing the loss with infinite data is the target in pursuit. However, both the population-level minimizer and those "good" solutions under previous studies diverge from an invariant solution in general and are no longer benign in this context, this is termed as "curse of endogeneity" [12; 13].

**Notations.** We use the conventional notations \(O(),o(),()\) to ignore the absolute constants, \((),(),()\) to further ignore the polynomial logarithmic factors. Similarly, \(a b\) means that there exists an absolute constant \(C>0\) such that \(a Cb\). We also denote it as \(a b\), \(b a\) if \(a=o(b)\). Unless otherwise specified, we use lowercase bold letters such as \(\) to represent vectors, and use \(\|\|\) to denote its Euclidean norm. We use uppercase bold letters such as \(\) to represent matrices and use \(\|\|,\|\|_{F},\|\|_{*}\) to denote its operator norm, Frobenius norm and nuclear norm, respectively. We use \(()\) to denote the condition number, which is \(_{}()/_{}()\). We define \(Z=o_{}(1)\) if the random variable \(Z\) satisfies \(Z0\).

## 2 Related Works

**Implicit Regularization.** It is believed that implicit bias is a key factor in why over-parameterized models can generalize well. Through the analysis of certain settings, existing results suggest that GD/SGD prefers solutions with specific properties [45; 19; 41; 38; 23], or specific local landscapes [3; 9; 32; 38]. For the matrix sensing problem, several works [18; 31; 27; 16; 46; 52; 24; 25] analyze the (S)GD dynamics to show how (S)GD recovers the ground truth low-rank matrix. Recently, the effects of large step size have aroused much attention, particularly the edge-of-stability phenomenon . Lu et al.  investigates the phenomenon "benign oscillation", which suggests that SGD with a large learning rate can effectively help neural networks learn weak features thereby benefiting generalization. Several works [20; 48; 11] show that label noise with large step size has a sparsifying effect for sparse linear regression. This paper instead studies multi-environment scenarios and fills in the understanding of the impact of randomness on matrix sensing problems.

**Federated Learning.** Federated learning [39; 26] is a machine learning paradigm where data is stored separately and locally on multiple clients and not exchanged, and clients collaboratively train a model. Extensive work has focused on designing effective decentralized algorithms (e.g. [39; 29]) while preserving privacy (e.g. [10; 7]). The importance of fairness in federated learning has also garnered attention [30; 33]. One important issue in federated learning is to handle the heterogeneity across the data and hardware. Our work shows that by training with certain stochastic gradient descent methods, the system can automatically remove the bias from the individual environment and thus learn the invariant features. Our work provides insights into discovering the implicit regularization effects of standard decentralized algorithms.

**Invariance Learning.** This research line initiates from causal inference literature [43; 40; 15] since invariant covariates correspond to _direct cause_. From theoretic aspects, Fan et al.  proposes the EILLS method that provably achieves invariant variable selections under mild conditions for linear models. Invariance learning has raised much attention in machine learning since Arjovsky et al.  proposes the structural-agnostic framework IRM. Subsequent works analyze its limitations [44; 28] or propose variant methods [50; 36; 34; 21; 51] as regularization and reweighting. About the failure of classical methods, Wald et al.  construct a hard problem and show that interpolation-based methods fail to learn invariance.

To the best of our knowledge, all the existing works consider specific algorithms to realize invariance learning or constructing hard cases that classical methods fail. In contrast, this paper studies commonly used training algorithms and aims to understand how the algorithms can go beyond learning associations to achieve invariance learning in certain scenarios.

## 3 Main Results

### Problem Formulation

**Data Generating Process.** Suppose we observe data from a set of environments \(\) sequentially. Let \(D\) be some distribution on \(\). At each time \(t=0,1,\), we receive \(m\) samples \(\{(_{i}^{(e_{t})},y_{i}^{(e_{t})})\}_{i=1}^{m}^{d  d}\) from environment \(e_{t} D\) satisfying

\[y_{i}^{(e_{t})}=_{i}^{(e_{t})},^{}+ _{i}^{(e_{t})},^{(e_{t})}, i=1, m,\] (1)

where \(^{}\) is an unknown rank \(r_{1}\)\(d d\) symmetric and positive definite matrix that represents the _true signal_ invariant across different environments, \(^{(e_{t})}\) is an unknown \(d d\) symmetric matrix with rank at most \(r_{2}\) that represents the _spurious signal_ that may vary. Here \(,=(^{})\). We aim to estimate the \(^{}\) using data from heterogeneous environments.

**Algorithm.** We consider running batch gradient descent on an over-parametrization of the model, where at each step \(t\) one gradient update is performed using the data from environment \(e_{t}\). To be specific, we parameterize our fitted model as \(y=,^{}\) with a \(d d\) matrix \(\) for the sake of simplicity. One can generally use the parameterization \(=^{}-^{}\) by the same technique of HaoChen et al. , Fan et al. . We initialize \(\) as \(_{0}=_{d}\) for some small enough \(>0\). At timestep \(t\), we run a one-step gradient descent on the standard least squares loss using \(\{(_{i}^{(e_{t})},y_{i}^{(e_{t})})\}_{i=1}^{m}\):

\[L_{t}()=_{i=1}^{m}(y_{i}^{(e_{t})}- _{i}^{(e_{t})},^{})^{2}.\] (2)

That is, \(_{0}=_{d}\) and

\[_{t+1}=_{t}- L_{t}(_{t})=( _{d}-_{i=1}^{m}(_{i}^{(e_{t})}, _{t}_{t}{}^{}-y_{i}^{(e_{t})})_{i}^{ (e_{t})})_{t}\] (3)for \(t=0,,T-1\). See a complete presentation in Algorithm 3.

```  Set \(_{0}=_{d}\), where \(\) is a small positive constant to be determined later.  Set large step size \(=(1)\). for\(t=1,,T-1\)do  Receive \(m\) samples \(\{(_{i}^{(e_{t})},y_{i}^{(e_{t})})\}_{i=1}^{m}\) from current environment \(e_{t}\).  Gradient Descent \(_{t+1}=_{t}-[_{i=1}^{m}( _{i}^{(e_{t})},_{t}_{t}^{} -y_{i}^{(e_{t})})_{i}^{(e_{t})}]_ {t}\). endfor Output:\(_{T}\). ```

**Algorithm 3**HeteroSGD

**Standard Method: Pooled Stochastic Gradient Descent.** As a comparison, we consider the standard approach where data in each batch come from different environments and the weights follow from \(D\). To be specific, the pooled stochastic gradient descent over all environments adopted the update rule

\[-}(),}()=_{i=1}^{m}[(y_{i}^{(e_{i })}-_{i}^{(e_{i})},^{})^ {2}], e_{i} D.\] (4)

### Assumptions

We first impose some standard assumptions used in matrix sensing. Since we are dealing with learning true invariant signals from heterogeneous environments, several conditions on the structure of the invariant signal \(^{}\) and the spurious signals \(^{(e)}\) should be imposed.

**Assumption 1** (Invariant and Spurious Space).: _There exists \(^{}^{d r_{1}}\) and \(^{}^{d r_{2}}\) both with orthogonal columns, i.e., \((^{})^{}^{}=_{r_{1}}\) and \((^{})^{}^{}=_{r_{2}}\) such that_

* \(C^{4}(d) r_{1} r_{2}\) _and_ \(d(r_{1}+r_{2})^{C}\) _for some large absolute constant_ \(C\)_._
* \(^{}=^{}(^{})^{}\)_._
* \(^{(e)}=^{}^{(e)}(^{})^ {}\) _with some symmetric_ \(r_{2} r_{2}\) _matrix_ \(^{(e)}\) _for any_ \(e\)_._
* \(\|(^{})^{}^{}\|_{1}\) _for some small quantity_ \(_{1} 0\)_._

In Condition (b), we assume that the singular values of the true signal \(^{}\) are the same to simplify the presentation since our main focus is to reduce the spurious signals. It holds for the basic case when there is only one invariant signal, i.e. \(r_{1}=1\). The analysis for varying singular values using the technique of Li et al.  is deferred to Section D in Appendix. Other assumptions are usual and easy to achieve. Condition (a) requires that the total dimension of invariant signals and spurious signals are small relative to the ambient dimension \(d\). Condition (c) resembles the RIP condition  in sparse feature selection . Condition (d) says the overlap of invariant subspace and spurious subspace should be small. Such a condition can be easily satisfied for random projections in high dimensions where \(r_{1}+r_{2} d\), under which we have \(_{1}=(+r_{2})/d})\), see Proposition 1 below.

**Proposition 1**.: _Let \(_{1}^{d r_{1}}\) and \(_{2}^{d r_{2}}\) be two mutually independent random matrix with i.i.d. \(N(0,1)\) entries. Denote their QR decompositions as \(_{1}=_{1}^{}_{1}\) and \(_{2}=_{2}^{}_{2}\), respectively. Then there exists a universal constant \(C_{1}>0\) such that_

\[\|(_{1}^{})^{}_{2}^{}\| t {+r_{2}}{d}},\] (5)

_with probability at least \(1-4(-C_{1}^{-1}d)-2(-C_{1}^{-1}(r_{1}+r_{2})t^{2})\)._

**Assumption 2** (Regularity on Spurious Signal \(^{(e)}\)).: _There exists some constant-level quantity \(M_{1},M_{2}\) such that_

\[_{e,i[r_{2}]}|^{(e)}_{ii}|<M_{1} _{i[r_{2}]}_{e D}[^{(e)}_{ ii}]}{1+|_{e D}[^{(e)}_{ii}]|}>M_{2},\] (6)

_where \(M_{1}<C_{0}M_{2}\) for some universal constant \(C_{0}>0\). Moreover, \(^{(e)}\) is strongly diagonal dominant for any \(e\), i.e.,_

\[_{e}_{i[r_{2}]}r_{2}^{2}_{j i}|^{( e)}_{ij}|}{M_{2}^{1.5}}\] (7)

_where \(c_{o}>0\) is some universal constant._

The first inequality in (6) requires that all the spurious signals have a uniform bound, under which a fixed step size can be adopted. The second inequality in (6) requires that the heterogeneity of the spurious signals be large compared to the bias of the spurious signals. For example, some variables receive different interventions in different environments. The condition (7) is imposed to prevent the explosion of spurious signals during training. When the diagonal and off-diagonal elements are of the same order, empirical studies and theoretical analyses in some toy examples illustrate the failure of recovering \(}^{}\). Condition (d) in Assumption 1 and (6) resemble the RIP condition in sparse feature selection. Example 1 can fulfill all our conditions.

Finally, we impose assumptions on measurements. Recall the RIP condition :

**Definition 1** (RIP for Matrices ).: _A set of linear measurements \(}_{1},,}_{m}\) satisfy the restricted isometry property (RIP) with parameter \((s,)\) if the following inequality_

\[(1-)\|}\|_{F}^{2}_{i=1}^{m}}_{i},}^{2}(1+)\|}\|_{ F}^{2}\] (8)

_holds for any \(d d\) matrix \(}\) with rank at most \(s\)._

**Assumption 3** (RIP Condition for Linear Measurements).: \(}_{1}^{(e_{t})},,}_{m}^{(e_{t})}\) _satisfies the RIP with parameter \(s=4(r_{1}+r_{2})\) and \((d))^{1.5}r_{2}^{2.5}+r_{2}}}\) for all \(e\)._

It is known from Candes and Plan  that for symmetric Gaussian measurements, sample complexity \(m=(ds^{-2},M_{2})=d(r,(d)) d^{2}\) suffices.

### Convergence Analysis

The main conceptual challenge in the problem is that any \(}\) with \(}}^{}=}^{}\) is no longer a local minimum since \(}_{e D}[^{(e)}]\) is non-zero and could even be comparable to \(}^{}\). This further implies that running stochastic gradient descent on pooled data will fail to recover \(}^{}\). However, our main result below shows that simply adopting online gradient descent with "heterogeneous batches" can successfully recover the true, invariant signal from heterogeneous environments.

**Theorem 2** (Main Theorem).: _Under Assumption 1-3, suppose further that \(_{1}</2\). Define \(^{}:=(c_{v}M_{2}(d))^{1.5} r_{2}^{2}+r_{2}}\) for some absolute constant \(c_{v}\). If we choose \((24M_{2}^{-1},M_{1}^{-1})\) and \((1/d^{4},1/d^{2})\), then running Algorithm 3 in \(T=((^{-1})/)\) steps, the algorithm outputs \(}_{T}\) that satisfies_

\[\|}_{T}}_{T}^{}-}^{}\|_{F}  C\{^{}{}^{2}}M_{1}^{2},^{}M_{1}\} ^{2}d\] (9)

_for some absolute constant \(C\), with probability over \(0.99\)._

Consider the case where \(r_{1},r_{2},M_{1}\) are sufficiently large but is regarded at constant level, and the batch size \(m\), ambient dimension \(d\) satisfy \(d^{2}(d) m\). It follows from the RIP result  with \(=()\) and Theorem 2 that one can adopt \(=(d^{-1})\), \(=(1)\), and early stop \(T=( d)\) such that

\[[\|}_{T}}_{T}^{}-} ^{}\|_{F} C_{1}(d)] 1-C_{1}(d(d)/m)^{2/5}\] (10)provided \(_{1} C_{1}^{-1}\) with some large enough constant \(C_{1}>0\). In this case, it follows from (10) that one can distinguish the true invariant signals from those spurious heterogeneous ones since

\[\{\|(^{})^{}_{T}_{T}^{ }^{}-_{r_{1}}\|_{2},\|(^{})^ {}_{T}_{T}^{}^{}\|_{2}\} =o_{}(1).\] (11)

The underlying reason why the online gradient descent can recover \(^{}\) is that the heterogeneity of \(^{(e)}\) and the randomness in the SGD algorithm jointly prevent it from moving in the direction of spurious signals. At the same time, the standard RIP conditions and the almost orthogonality between \(^{}\) and \(^{}\) in Condition 1 ensure a steady movement towards the invariant signals.

Conversely, running pooled stochastic gradient descent using all data will result in a biased solution:

**Theorem 3** (Negative Result for Pooled SGD).: _Under the assumptions of Theorem 2 and some mild conditions, for the certain case where \(^{}^{}\) and \(_{e D}^{(e)}=_{r_{2}}\), if we perform SGD over all samples with batch size \(m=(d(r_{1}+r_{2},M_{1}M_{2},(d)))\) and ends with \(T=( d)\), then \(_{t}\) keeps approaching \(^{}^{}+^{}^{}{}^{}\), in the sense that_

\[\|_{T}_{T}^{}-^{}^{ }{}^{}-^{}^{}{}^{}\|_{F} o (1),\] (12)

_during which for all \(t=0,1,,T\):_

\[\|_{t}_{t}^{}-^{}\|_{F}  r_{2}}.\] (13)

The convergence (12) is similar to (9) in derivation. To see this, since each update uses batch from the whole data, the update in effect degenerates to the case for one environment with no heterogeneity. Now the one-environment invariant solution \(^{}\) in (9) is exactly equal to \(^{}^{}{}^{}+^{}^{ }{}^{}\) in (12). One can also show that for sufficiently large \(t\), \(_{t}_{t}^{}\) is sufficiently away from \(^{}\), indicating that the biased estimation is not attributed to early stopping.

Our framework can be applied to learning the invariant features for a two-layer neural network with quadratic activation functions, by recognizing the fact that :

\[^{}q()=^{ },^{},\] (14)

where \(q()\) is the element-wise quadratic function. The following example shows that Theorem 7 implies success of invariant feature learning for 2-layer NN when the ground truth invariant and variant features are independent random vectors sampled from normal distribution.

**Example 1** (Two-Layer NN with Quadratic Activation).: _Let \(_{1},,_{r}^{d}\) be random vectors sampled from normal distribution \(N(0,_{d})\). For environment \(e\), suppose the target function is determined by \(r_{1}\) invariant features and \(r_{2}\) variant admits that for each sample \((_{i}^{(e)},y_{i}^{(e)})\):_

\[y_{i}^{(e)}=_{j=1}^{r_{1}}q(_{j}^{}_{i}^{(e)})+ _{j=r_{1}+1}^{r}a_{j}^{(e)}q(_{j}^{}_{i}^{(e)})= _{i}^{(e)}_{i}^{(e)},_{j=1}^{r_{1}} _{j}_{j}^{}+_{j=r_{1}+1}^{r}a_{j}^{(e)} _{j}_{j}^{},\] (15)

_which is equivalent to matrix sensing problem with_

\[^{}=_{j=1}^{r_{1}}_{j}_{j}^{}\,\ ^{(e)}=_{j=r_{1}+1}^{r}a_{j}^{(e)}_{j}_{j}^{ }\ \ _{i}^{(e)}=_{i}^{(e)}_{i}^{(e)}{}^{}.\] (16)

_And our goal is to train a two-layer NN to capture the invariant features \((_{1},,_{r_{1}})\). In this example, the invariant component and the spurious component have a more intuitive characterization: they are two disjoint groups of neurons. Moreover, it can be shown that the invariant and variant features are nearly orthogonal (Proposition 1). Then if \(\{a_{j}^{(e)}\}_{j,e}\) satisfies \(\{|a_{j}^{(e)}|\}_{j}\{1+|E_{e}a_{j}^{(e)}|\}}{_{j }\{_{i}[a_{j}^{(e)}]\}}<c_{0}\) for some absolute constant \(c_{0}\), the variant version of Algorithm 3 returns a solution that only significantly selects invariant features with probability over \(0.99\). See Section C and Theorem 7 for details._

## 4 Proof Sketch

We define the invariant part \(_{t}^{d r_{1}}\), spurious part \(_{t}^{d r_{2}}\) in \(_{t}\) as

\[_{t}:=_{t}{}^{}^{} _{t}:=_{t}^{}^{}\] (17)and let the residual be the error part, that is,

\[_{t}:=_{t}-(^{}_{t}{}^{}+ ^{}_{t}{}^{})=(-^{ }^{}{}^{}-^{}^{}{}^{}) _{t}.\] (18)

It is worth noticing that \(_{^{}}=^{}^{}{}^{}\) and \(_{^{}}=^{}^{}{}^{}\) are both orthogonal projections, and \(_{}:=-_{^{}}- _{^{}}\) is not.

It follows from the model (1) and the gradient update that

\[_{t+1}=_{t}-_{i=1}^{m}_{i}^{(e_{t})},_{t}_{t}^{}-^{}- ^{(e_{t})}_{i}^{(e_{t})}_{t}.\] (19)

We use operator \(_{e_{t}}()^{d d}\) to denote the RIP error of the batch at time step \(t\) for some \(d d\) matrix \(\), i.e.,

\[_{e_{t}}():=_{i=1}^{m}_{i}^{(e_{t})},_{i}^{(e_{t})}-.\] (20)

We also write \(_{t}():=_{e_{t}}()\) when there is no ambiguity, and we simply denote matrix \(_{t}=_{t}(_{t}_{t}^{}- ^{}^{}{}^{}-^{}_{t}^{}{}^{})\) with \(_{t}:=^{(e_{t})}\). Then the gradient update of \(_{t}\) can be written as

\[_{t+1}=_{t}-(_{t}_{t}^{} -^{}^{}{}^{}-^{}_{t}^{}{}^{})_{t}-_{t}_{t}}_{}.\] (21)

Combining our definition (17) with (21), we obtain

\[_{t+1}&=(_{t}- (_{t}_{t}^{}-^{}^{}{ }^{}-^{}_{t}^{}{}^{}) _{t}-_{t}_{t})^{}^{ }\\ &=-_{t}^{}_{t}+ )_{t}}_{}+_{t}^{}^{}_{t}^{} {}^{}^{}}_{}-_{t}^{}_{t}^{}}_{}. \] (22)

\[_{t+1}&=(_{t}- (_{t}_{t}^{}-^{}^{ }{}^{}-^{}_{t}^{}{}^{}) _{t}-_{t}_{t})^{}^{ }\\ &=_{t}-_{t}^{}_{t} _{t}+_{t}_{t}}_{}+_{t}^{}^{}{}^{}^{}}_{ }-_{t}^{}_{t} ^{}}_{}.\] (23)

For the error part, combining (18) with (21) yields

\[_{t+1}&=_{}(_{t}-(_{t}_{t}^{}-^{ }{}^{}-^{}^{}{}^{}-^{ }_{t}^{}{}^{})_{t}- _{t}_{t})\\ &=_{t}(-_{t}^{} _{t})}_{}+_{ }(^{}{}^{}^{}{}^{}+^{ }_{t}^{}{}^{})_{t}}_{}-_{}_{t} _{t}}_{}.\] (24)

For the invariant part \(_{t}\), though different singular values of \(_{t}\) will grow at different speeds because of the randomness from RIP error and \(e_{t}\), we claim that all the singular values of \(_{t}\) are close to \(_{t}\) during the training process, where the scalar sequence \(_{t}\) is defined recursively as

\[_{t+1}=(1-_{t}^{2}+)_{t},_ {0}=.\] (25)

The dynamics of \(_{t}\) are very complicated because of the randomness of \(e_{t}\) and the RIP error. Such a dynamic will also impact that of \(_{t}\) and \(_{t}\) through the complicated dependencies between these three parts, which will also make it difficult to utilize probability inequalities applicable under independence. Instead, we claim that such a "fluctuation dynamics" of \(_{t}\) can be controlled as

\[\|_{t}\|<((d),r,M_{1})_{t}_{t}=&,\ t<O((r_{1}+r_{2}))\\ O( M_{1}+r_{2}}_{t})&,\ t O( (r_{1}+r_{2})).\] (26)

[MISSING_PAGE_EMPTY:9]

## 6 Conclusions

This paper explains that implicit bias of heterogeneity leads the model learning towards invariance and causality. We show that under heterogeneous environments, online gradient descent with large step sizes can select out the invariant matrix in the over-parameterized matrix sensing models. We conjecture that both heterogeneity and stochasticity are indispensable. Over-parameterization may not be. We leave future studies to understand the necessity of the three factors.

## 7 Acknowledgement

C. Fang was supported by National Key R&D Program of China (2022ZD0114902), the NSF China (No.62376008).

Figure 4: The left figure shows that the large step size helps eliminate the spurious signal. The right figure shows that both true and spurious signals flow up when \(\) is small, and when \( 0.05\), the spurious signal is eliminated.

Figure 5: The left figure shows that heterogeneity helps eliminate the spurious signal. The right figure shows that Pooled SGD fits invariant signal and spurious signal simultaneously without distinction.