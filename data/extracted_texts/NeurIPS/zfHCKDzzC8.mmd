# Temporal Causal Mediation through a Point Process: Direct and Indirect Effects of Healthcare Interventions

Temporal Causal Mediation through a Point Process: Direct and Indirect Effects of Healthcare Interventions

 Caglar Hizh

Dept. of Computer Science

Aalto University

&ST John

Dept. of Computer Science

Aalto University

&Anne Juuti

Helsinki University Hospital

and University of Helsinki

&Tuure Saarinen

Helsinki University Hospital

and University of Helsinki

&Kirsi Pietilainen

Helsinki University Hospital

and University of Helsinki

&Pekka Marttinen

Dept. of Computer Science

Aalto University

Correspondence: caglar.hizli@aalto.fi

###### Abstract

Deciding on an appropriate intervention requires a causal model of a treatment, the outcome, and potential mediators. Causal mediation analysis lets us distinguish between direct and indirect effects of the intervention, but has mostly been studied in a static setting. In healthcare, data come in the form of complex, irregularly sampled time-series, with dynamic interdependencies between a treatment, outcomes, and mediators across time. Existing approaches to dynamic causal mediation analysis are limited to regular measurement intervals, simple parametric models, and disregard long-range mediator-outcome interactions. To address these limitations, we propose a non-parametric mediator-outcome model where the mediator is assumed to be a temporal point process that interacts with the outcome process. With this model, we estimate the direct and indirect effects of an external intervention on the outcome, showing how each of these affects the whole future trajectory. We demonstrate on semi-synthetic data that our method can accurately estimate direct and indirect effects. On real-world healthcare data, our model infers clinically meaningful direct and indirect effect trajectories for blood glucose after a surgery.

## 1 Introduction

In healthcare, a key challenge is to design interventions that effectively control a target outcome (Vamathevan et al., 2019; Ghassemi et al., 2020). To design an efficient intervention, decision-makers need not only to estimate the _total_ effect of the intervention, but also understand the underlying causal mechanisms driving this effect. To this end, causal mediation analysis decomposes the total effect into: _(i)_ an _indirect_ effect flowing through an intermediate variable (_mediator_), and _(ii)_ a _direct_ effect representing the rest of the effect. The statistical question is then to estimate the direct and indirect effects.

As a running example, we consider the effect of bariatric surgery (_treatment_) on meal-blood glucose (_mediator-outcome_) dynamics. In Fig. 1, we show how blood glucose changes after the surgery. This change is partly mediated by the changes in diet before and after the surgery (alterations in meal size and frequency). However, the surgery can also directly impact blood glucose levels (via metabolic processes, regardless of meal size). To efficiently control glucose, we need to estimate to what extent the effect of surgery is due to the post-surgery diet (_indirect_) or other metabolic processes (_direct_).

Causal mediation has been studied extensively in a static setting with three variables: a treatment \(A\), a mediator \(M\), and an outcome \(Y\)(Robins and Greenland, 1992; Pearl, 2001; Robins, 2003; Vander-Weele, 2009; Imai et al., 2010, 2012). However, as the running example illustrates, many real-world healthcare problems are dynamic, i.e., the variables evolve over time and are measured at multiple time points, e.g., a patient's state observed through electronic health records (Ehr) (Saeed et al., 2011; Soleimani et al., 2017; Schulam and Saria, 2017), tumour growth under chemotherapy and radiotherapy (Geng et al., 2017; Bica et al., 2020; Seedat et al., 2022), and continuous monitoring of blood glucose under meal and insulin events (Berry et al., 2020; Wyatt et al., 2021; Hizh et al., 2023). Hence, instead of observing a single mediator and a single outcome after an intervention, in many situations the intervention is followed by _(i) sequences_ of mediators and outcomes that vary over time. To complicate the matters further, these sequences may be complex, e.g., _(ii)_ sparse and irregularly-sampled, as in Ehr, or _(iii)_ with long-range mediator-outcome dependencies.

Some existing works have addressed dynamic causal mediation for _(i)_ a sequence of mediators and outcomes (VanderWeele and Tchetgen, 2017; Lin et al., 2017; Zheng and van der Laan, 2017; Vansteelandt et al., 2019; Aalen et al., 2020); however, they are limited to measurements at regular time intervals. Furthermore, they are based on the parametric g-formula (Robins, 1986) and marginal structural models (Robins et al., 2000a), which can handle time-varying confounding but rely on simple linear models. A recent work by Zeng et al. (2021) (Fig. 2a) studied causal mediation for _(ii)_ sparse and irregular longitudinal data, but considered neither _(iii)_ long-range mediator-outcome dependencies nor the interaction between past outcomes and future mediators (\(\), Fig. 2c).

We address these limitations in dynamic causal mediation by introducing a method where both the mediator as well as the outcome are stochastic processes (as opposed to single variables in the static case). In this setup, we provide the estimated direct and indirect effects as longitudinal counterfactual trajectories, and theoretically, we present causal assumptions required to identify them. We model the mediator sequence as a marked point process (Mpp), and the outcome sequence as a continuous-valued stochastic process, building on a non-parametric model (Hizh et al., 2023). This allows for irregularly-sampled measurements of mediator and outcome processes, while capturing non-linear, long-range interactions between them. Recently, a different line of research investigated causal inference for Mpps(Gao et al., 2021; Zhang et al., 2022; Noorbakhsh and Rodriguez, 2022), but they have not considered a causal mediation setting. Compared to the existing literature (Hizh et al., 2023), our model enables the estimation of the direct and indirect effects separately by incorporating an external intervention that jointly affects both mediator and outcome processes (Fig. 2b vs. Fig. 2c).

Our contributions are as follows:

* **Dynamic causal mediation with a point process mediator.** We generalize the dynamic causal mediation problem by modeling the mediator as a point process, which can have a ran

Figure 1: Comparison of the meal–blood glucose dynamics of one patient for the pre- and post-surgery periods: meals (carbohydrate intake, cyan bars), glucose (black crosses), predicted glucose baseline \(}\) (red dashed line) and predicted glucose progression \(\) (blue dashed line). For blood glucose, we see, _after the surgery_, (i) the baseline \(}\) declines (red dashed line, pre-surgery \(\) post-surgery), and (ii) the glucose response of a meal has a steeper rise and a steeper decline (blue peaks, pre-surgery \(\) post-surgery). For meals, we see, _after the surgery_, the patient eats (i) more frequently and (ii) less carbohydrates (cyan bars, pre-surgery \(\) post-surgery). A relevant research question is: how much of the surgery effect is due to the post-surgery diet (_indirect_) or other biological processes (_direct_)?

dom number of occurrences at random times and complex interactions with the outcome. Furthermore, we provide causal assumptions required to identify the direct and indirect effects.
* **A mediator-outcome model with an external intervention.** We extend a previous non-parametric model for mediators and outcomes (Hizh et al., 2023) to include an external intervention that affects the joint dynamics of these two processes.
* In a real-world experiment, we study in a data-driven manner **the effect of bariatric surgery for treatment of obesity on blood glucose dynamics**, and separately estimate the direct effect from the indirect effect whereby surgery affects blood glucose through changed diet.

## 2 Dynamic Causal Mediation

In this section, we formulate the dynamic causal mediation problem for a treatment process \(\), a mediator process \(\) and an outcome process \(\), and contrast this with the static causal mediation definition for single variables \(A\), \(M\) and \(Y\). Our formulation builds on structural causal models (Scm, Pearl, 2009) and an interventionist approach to causal mediation (Robins et al., 2022).

**Structural Causal Model.** An Scm \(=(,p())\) of a set of variables \(=\{X_{k}\}_{k=1}^{K}\) is defined as a pair of (i) _structural equations_\(=\{X_{k}=f_{k}((X_{k}),U_{k})\}_{k=1}^{K}\) and (ii) a _noise distribution_\(=\{U_{k}\}_{k=1}^{K} p()\)(Pearl, 2009; Peters et al., 2017). The Scm entails an observational distribution \( p()\). To see this, consider sampling noise \( p()\) and then performing a forward pass through the structural equations \(\). In the Scm, an intervention \((X_{k}=_{k})\) is defined as an operation that removes the structural equation \(f_{k}(,)\) corresponding to \(X_{k}\) and sets \(X_{k}\) to the value \(_{k}\), yielding an interventional distribution \(p((X_{k}=_{k}))\).

Interventionist Approach to Causal Mediation.Consider an Scm of a treatment \(A\), a mediator \(M\) and an outcome \(Y\) (Fig. 2(a)). For brevity, we focus on the indirect path, but the same reasoning applies for the direct path. To estimate the indirect effect, we want to intervene _only_ on the indirect path (\(A{}M{}Y\)), while keeping the direct path (\(A{}Y\)) at its natural value. To achieve this, we follow an interventionist approach (Robins et al., 2022). We hypothetically duplicate the treatment \(A\) into an indirect-path treatment \(A_{ M}\) and a direct-path treatment \(A_{ Y}\), so that each of these affects _only_ its target path (Fig. 2(b)). For instance, in the surgery-diet-glucose example (_treatment-mediator-outcome_), the indirect-path treatment

Figure 3: Graphical models for causal mediation. Mediation is defined in **(a)** using nested counterfactuals, while in **(b)** using path-specific treatments \(A_{ M}\) and \(A_{ Y}\).

Figure 2: Comparison of available implementations for dynamic causal mediation. **(a)** Zeng et al. (2021) studied dynamic causal mediation for a sparse and irregularly-sampled mediator–outcome sequence; their counterfactual formulation allows for only uni-directional effects from mediator to outcome (\(\)), while their implementation assumes the effects are instantaneous. **(b)** Hizh et al. (2023) considered the long-range interaction between mediator and outcome processes (\(\)\(\)\(\)), but did not allow the intervention to directly affect the outcome. **(c)** While capturing long-range dependencies, our work allows for an intervention that affects both processes jointly (\(\)\(\)).

\(A_{ M}\) corresponds to changing _only_ the diet, without changing how the surgery affects blood glucose through other metabolic processes. Using path-specific interventions, we follow Pearl (2001) and define the natural indirect effect (Nie) as

\[() Y[A_{ Y}=,A_{ M}=]-Y[A_{  Y}=,A_{ M}=] Y[,]-Y[ ,],\] (1)

where we use the short-hand notation for an intervention \([_{1},_{2}](A_{ Y}=_{1},A_{  M}=_{2})\), and \(Y[_{1},_{2}]\) is the _potential_ outcome after setting the direct-path treatment (first argument) to \(_{1}\) and the indirect-path treatment to \(_{2}\). The value \(\) means that the corresponding pathwise treatment is set to its _natural_ value, i.e., the value the variable would have attained without our doing any intervention. Hence, the indirect effect is intuitively defined in Eq. (1) as the difference of the outcome \(Y\) when the direct-path treatment is fixed to \(\) while the indirect-path treatment is either \(\) or \(\).

The natural direct effect (Nde) is similarly defined as Pearl (2001); Robins et al. (2022)

\[() Y[A_{ Y}=,A_{ M}=]-Y[A_ { Y}=,A_{ M}=] Y[,]-Y[ ,],\] (2)

However, these definitions are limited to the static case with single variables \(A\), \(M\) and \(Y\). Hence, they are not applicable as such to complex, real-world dynamics of healthcare data sets, where a treatment is typically followed by sequences of irregularly-sampled mediator and outcome measurements.

### Direct and Indirect Effects as Stochastic Processes

We extend the static definitions of natural direct and indirect effects by formulating them as stochastic processes. In the following, we assume a single patient is observed over a period \([0,T]\). The formulation trivially generalizes to multiple patients, assuming exchangeability.

For each patient, we define a mediator process \(\) and an outcome process \(\). We assume the treatment \(A\) represents a single intervention occurring once at time \(t_{a}[0,T]\), e.g., a surgery. For completeness, we define also the treatment as a stochastic process \(\) corresponding to a binary counting process \(_{A}:[0,T]\{0,1\}\) that specifies the pre- and post-intervention periods. The treatment is applied to control an outcome of interest over time, e.g. continuously-monitored blood glucose, which is defined as the outcome process \(:[0,T]\). We assume the treatment affects the outcome process \(\) via two separate causal paths, where the indirect path (\(\)), Fig. 2c) that goes through mediators occurring at non-deterministic times, e.g., meals, is of special interest. Hence, we define this causal path explicitly through the mediator process \(:[0,T]\{\{\}\}\), such that \(M()=(k,m)\), where \(k\) is the number of occurrences of the mediating event up until time \(\) and \(m\) is the value of the mediator at time \(\). Occurrences \(k\) follow a counting process \(_{M}:[0,T]\) and values \(m\) follow a dosage process \(_{M}:[0,T]\{\{\}\}\), such that these two processes contain all the information about the mediator process on the period \([0,T]\). At occurrence times, the mediator gets a value \(m\) and at other times \(m=\). The rest of the possible causal paths are not modeled explicitly but instead their effect is jointly represented as the direct path \(A\) (\(\) - - -, Fig. 2c).

We define direct and indirect treatment effects formally analogously to the static case, and assume that the treatment process \(()\) is hypothetically duplicated into the direct-path treatment \(_{ Y}()\)Robins and Richardson (2010); Didelez (2019). The indirect-path treatment \(_{ M}()\) affects the outcome only through the mediator process \(\). Similarly, the direct-path treatment \(_{ Y}()\) affects the outcome through processes other than the mediator.

In practice, we assume that we observe the mediator process \(\) at \(I\) time points: \(\{(t_{i},m_{i})\}_{i=1}^{I}\), where \(t_{i}\) is the occurrence time of the \(i^{}\) mediator event and \(m_{i}\) the corresponding value. Similarly, we observe the outcome process \(\) as \(\{(t_{j},y_{j})\}_{j=1}^{J}\). We observe \(()\) as the occurrence of a single treatment event at time \(t_{a}[0,T]\). In the 'factual' world, treatments \(A\), \(A_{ Y}\) and \(A_{ M}\) occur at the same time, i.e., their respective counting processes coincide:

\[_{A}()=_{A_{ Y}}()=_{A_{ M}}()= \{ t_{a}\}.\] (3)

For instance, in the surgery-diet-blood glucose (_treatment-mediator-outcome_) example, the surgery starts to affect both the diet and the other metabolic processes immediately after it has occurred at time \(t_{a}\). To measure how the surgery affects the blood glucose (indirectly) through diet or (directly) through other metabolic processes, we consider a hypothetical intervention that changes _either_ the diet _or_ the other metabolic processes, but not both at the same time. Formally, we devise these hypothetical interventions that activate _only_ the direct or the indirect causal path by setting treatment times \(t_{A_{ Y}}\) and \(t_{A_{ M}}\) to distinct values.

Using these hypothetical interventions, we formulate two causal queries _to understand how the treatment affects the outcome process via direct and indirect casual mechanisms_. The natural indirect effect (Nie) is defined as

\[(_{a}) _{>_{a}}[A_{ Y}=,A_{ M}= _{a}]-_{>_{a}}[A_{ Y}=,A_{ M}=]\] \[_{>_{a}}[,_{a}]-_{> _{a}}[,].\] (4)

A close comparison with the static case in Eq. (1) reveals that the outcome is here defined as a stochastic process \(_{>_{a}}\) which describes its entire future trajectory; i.e., a sample from this process corresponds to an entire sequence of values representing the continuation of the outcome after the intervention at time \(_{a}\). For example, Eq. (4) can quantify the contribution of the change of diet at time \(_{a}\) on the blood glucose progression, while other metabolic processes are fixed at their natural state, \(\), before the surgery. Similarly, we estimate the natural direct effect (Nde) using

\[(_{a}) _{>_{a}}[A_{ Y}=_{a},A_{ M}= _{a}]-_{>_{a}}[A_{ Y}=,A_{ M}= _{a}]\] \[_{>_{a}}[_{a},_{a}]-_ {>_{a}}[,_{a}],\] (5)

which quantifies the contribution of the changes in other metabolic processes on the blood glucose progression, while the diet is fixed at its natural state after the surgery. The total effect of the intervention \([t_{a}=_{a}]\) is equal to the sum of the Nde and the Nie:

\[(_{a})=(_{a})+( _{a})=_{>_{a}}[_{a},_{a}]-_{>_ {a}}[,].\] (6)

## 3 Causal Assumptions and Identifiability

In this section, we first develop a mathematical formulation of the causal assumptions required to identify direct and indirect effect trajectories \((_{a})\) and \((_{a})\). Under these assumptions, we next represent the causal queries in the form of statistical terms, which we can estimate using a mediator-outcome model. The proofs and further details are presented in Appendix A.

To identify the direct, indirect and total effects, we make the following Assumptions (**A1**, **A2**, **A3**):

**(A2):**: \(_{ Y}\!\!\! M()_{ M},_{<}, [0,T],\)
**(A3):**: \(_{ M}\!\!\! Y()_{ Y},_{<}, [0,T],\)

where \(_{<}\) is the history up to time \(\), including both mediators and outcomes. **(A1)** is a continuous-time version of the No-Unobserved-Confounders assumption for process pairs \((,)\) and \((,)\)[continuous-time Nuc, Schulam and Saria, 2017]. **(A2, A3)** ensure that path-specific treatments \(A_{ M}\) and \(A_{ Y}\) causally affect only their target path, conditioned on the past. Accordingly, they imply no unobserved confounding between mediator and outcome processes \((,)\). **(A1, A2, A3)** might not hold in observational studies and they are not statistically testable. We discuss their applicability in the running example in Section 5.1.

For the total effect, we need to estimate the trajectories \(_{>_{a}}[_{a},_{a}]\) and \(_{>_{a}}[,]\), which are identifiable under **(A1)**. For direct and indirect effects, we further need to estimate the counterfactual trajectory \(_{>_{a}}[,_{a}]\), i.e., the outcome process under a hypothetical intervention, which is identifiable under **(A1, A2, A3)**. We consider a counterfactual trajectory \(_{>_{a}}\) under a paired intervention, e.g. \([,_{a}]\), at \(R\) ordered query points \(}=\{q_{r}\}_{r=1}^{R}\), \(q_{r}>_{a}\): \(_{}}[,}_{a}]=\{Y(q_{r})[ ,}_{a}]\}_{r=1}^{R}\). Provided that **(A1, A2, A3)** hold, the interventional distribution of the counterfactual trajectory \(_{}}[,}_{a}]\) is given by

\[P(_{}}[,_{a}])=_{_{>_{a}}}_{r=0}^{R-1}}|M_{[q_{r},q_{r+1})},\,t_{a} =,_{ q_{r}})}_{\,} ,q_{r+1})}|t_{a}=_{a},_{ q_{r} })}_{\,},\] (7)

where \(_{>_{a}}=_{r=0}^{R-1}M_{[q_{r},q_{r+1})}\). The two terms in Eq. (7) can be estimated by an interacting mediator-outcome model, discussed in Section 4. In addition, the definitions of the \((_{a})\) and the \((_{a})\) in Eqs. (4) and (5) under a single treatment at time \(_{a}\) can be extended to direct and indirect effects under a sequence of healthcare interventions, if necessary. We further illustrate this extension in Appendix A.3 and provide an identifiability analysis in such multiple treatment setups.

## 4 Interacting Mediator-Outcome Model

To model the interacting mediator-outcome processes, we extend a non-parametric model for mediators and outcomes (Hizli et al., 2023) to include an external intervention \(A\) that affects the joint dynamics of these two processes. Similary et al. (2016); Daley and Vere-Jones (2003) and a conditional Gaussian process (Gp, Williams and Rasmussen, 2006). For background on Mpp, Gp, and details on model definitions, inference and scalability, see Appendix B.

Each patient is observed in two regimes: \(=\{^{(a)}\}_{a\{0,1\}}\). Within each regime \(a\{0,1\}\), the data set \(^{(a)}\) contains the measurements of mediator \(\) and outcome \(\) at irregular times: \(\{(t_{i}^{(a)},m_{i}^{(a)})\}_{i=1}^{I^{(a)}}\) and \(\{(t_{j}^{(a)},y_{j}^{(a)})\}_{j=1}^{J^{(a)}}\). For the full data set \(\), the joint distribution is

\[p()=_{a\{0,1\}}(-^{(a)})_{i=1}^{I^{( a)}}(t_{i},m_{i}_{<t_{i}})}_{\,}_{j=1}^{J^{(a)}}(y_{j} t_{j}, _{<t_{j}})}_{\,},\] (8)

where we denote the conditional intensity function of the mediator Mpp by \(^{(a)}(t_{i},m_{i}_{<t_{i}})\), and the point process integral term by \(^{(a)}=_{0}^{T}^{(a)}(_{<})\,\).

### Mediator Intensity (\(\))

The mediator intensity \((t_{i},m_{i}_{<t_{i}})\) is defined as a combination of the mediator time intensity \((t_{i}_{<t_{i}})\) and the mediator mark or dosage density \(p(m_{i} t_{i},_{<t_{i}})\): \((t_{i},m_{i}_{<t_{i}})=(t_{i}_{< t_{i}})p(m_{i} t_{i},_{<t_{i}})\). Similar to (Hizli et al., 2023), we model the time intensity \((t_{i}_{<t_{i}})\) as the squared sum of three components \(\{_{0},g_{m},g_{o}\}\), to ensure non-negativity:

\[(_{<})=}_{}+(;)}_{}+(;)}_{}^{2},\] (9)

where \(\) contains past mediators (meal times and sizes) and \(\) contains past outcomes (glucose). The constant \(_{0}\) serves as a basic Poisson process baseline. The mediator-effect function \(g_{m}\) and the outcome-effect function \(g_{o}\) model how the intensity depends on the past mediators and outcomes, respectively. The components \(g_{m}\) and \(g_{o}\) are time-dependent functions with Gp priors: \(g_{m},g_{o}\). The mediator dosage density \(p(m_{i} t_{i},_{<t_{i}})\) is also modeled with an independent Gp prior: \(m_{i}(t_{i})\).

### Outcome Model (\(\))

We model the outcome process \(=\{Y(_{<}):[0,T]\}\) as a conditional Gp prior, that is, a sum of three independent functions (Schulam and Saria, 2017; Hizli et al., 2023):

\[Y(_{<})=()}_{}+(;)}_{}+()}_{},\] (10)

where the baseline and the mediator response have Gp priors, \(f_{b},f_{m}\), similar to Hizli et al. (2023), while the noise is sampled independently from a zero-mean Gaussian variable \(u_{Y}()(0,_{y}^{2})\). The mediator response function \(f_{m}\) models the dependence of the future outcomes on the past mediators. We assume that the effects of nearby mediators simply sum up: \(f_{m}(;)=_{i:t_{i}}l(m_{i})f_{m}^{0}(-t_{i})\), where \(f_{m}^{0}\) describes a shared shape function and the magnitude of the effect depends on the mark \(m_{i}\) through a function \(l(m_{i})\).

## 5 Experiments

In this section, we validate the ability of our method to separate direct and indirect effects of a healthcare intervention on interacting mediator-outcome processes. First, we show that our model can support clinical decision-making in _real-world data_ from a randomized controlled trial (Rct) about the effect of gastric bypass surgery (_treatment_) on meal-blood glucose (_mediator-outcome_) dynamics. Second, as the true causal effects are unknown in the real-world data, we set up a _realistic, semi-synthetic simulation study_, where we evaluate the performance of our model on two causal tasks: estimating direct and indirect effect trajectories. Our implementation and code to reproduce the study can be found at https://github.com/caglar-hizli/dynamic-causal-mediation.

### Real-World Study

We first show on data from a real-world Rct[Saarinen et al., 2019, Ashrafi et al., 2021] that our model can learn clinically-meaningful direct and indirect effects of bariatric surgery on blood glucose, by analyzing how surgery affects glucose through changed diet (indirectly) or other metabolic processes (directly). For further details, see Appendix C.1.

**Dataset.** For 15 nondiabetic obesity patients (body mass index, \( 35\,/^{2}\)) undergoing a gastric bypass surgery, a continuous-monitoring device measured the blood glucose of each patient at 15-minute intervals. Patients recorded their meals in a food diary, and the nutrient information was processed into total carbohydrates (sugar + starch) for each meal. Data was collected over two 3-day long periods: (i) _pre-surgery_ and (ii) _post-surgery_.

**Causal Assumptions.** Assumption (**A1**) implies a treatment that is non-informative. The surgery does not depend on patient characteristics (each patient undergoes the surgery), therefore (**A1**) holds. If this was not the case, we could have used a debiasing method such as inverse probability treatment weighting [Robins et al., 2000a]. Assumptions (**A2**, **A3**) imply that (i) path-specific treatments \(A_{ M}\) and \(A_{ Y}\) affect only their target path and (ii) there is no unobserved confounding between mediators and outcomes. They do **not** exactly hold in the study. For (i), one way to realize \(A_{ M}\) is a dietary intervention that only changes the diet; however, it might not be possible to change the rest of the metabolic processes through \(A_{ Y}\) without affecting the diet. For (ii), demographic factors such as age, gender, body weight, and height could be potential confounder variables that could bias the estimation of surgery effects. Moreover, there can be unobserved processes such as exercising habits that affect both meals and blood glucose, even though the impact of confounders other than meals on blood glucose is likely modest for nondiabetics, since blood glucose is known to be relatively stable between meals [Ashrafi et al., 2021].

#### 5.1.1 Bariatric Surgery Regulates Glucose Through Meals and Other Metabolic Processes

To visualize the effect of the surgery on meal-blood glucose dynamics, we show 1-day long meal-glucose measurements for one patient together with predicted glucose trajectories from our outcome model in both pre- and post-surgery periods in Fig. 1. For blood glucose, we see, _after the surgery_, (i) the baseline declines, and (ii) a meal produces a faster rise and decline. For meals, we see, _after the surgery_, the patient eats (i) more frequently and (ii) less carbohydrate per meal.

#### 5.1.2 Direct and Indirect Effects of the Surgery on Meal Response Curves

We compare the predicted glucose baseline \(f_{b}\) and the predicted meal response \(f_{m}\) for all patients in Fig. 4. In Fig. 3(a), _after the surgery_, the glucose baseline declines in agreement with previous findings [Dirksen et al., 2012, Jacobsen et al., 2013]. In Fig. 3(b), we see meal responses corresponding to four hypothetical scenarios. In the **upper-left**, we predict a typical _pre-surgery_ meal response and highlight the area under this curve by shaded grey. In the **upper-right**, we predict the hypothetical meal response by considering _only_ the surgical effect on metabolism, while keeping the diet in its natural pre-surgery state. Here, the meal response increases to a higher peak and declines back to the baseline faster than the shaded pre-surgery response, as previously described

Figure 4: Pre- vs. post-surgery predicted glucose progressions: **(a)** Baseline, **(b)** Meal response.

[Jacobsen et al., 2013, Bojsen-Moller et al., 2014]. Moreover, the response model captures the decline under the baseline around \(2\,\) after a meal and a correction afterwards, which is a clinically-meaningful estimation suggesting overshooting of the glucose lowering due to the higher secretion of insulin after the surgery [Jacobsen et al., 2013, Bojsen-Moller et al., 2014]. In the **lower-left**, we predict the hypothetical meal response if patients _only_ followed the post-surgery diet, while their metabolism would be fixed in its natural pre-surgery state. Here, the meal response increases to a lower peak due to a lower carbohydrate intake, while the shape of the response is preserved. In the **lower-right**, we predict a typical _post-surgery_ response, which increases to a lower peak due to lower carbohydrate intake and declines back to the baseline faster compared to the pre-surgery response due to the high insulin levels.

#### 5.1.3 Surgery Leads to Shorter Meal Intervals and Less Carbohydrate Intake

We compare meal data and predictions from the mediator model between the pre- and post-surgery periods in Fig. 5. The surgery leads to a more regular, low-carb diet due to the post-surgery dietary advice, a reduction in the stomach size, and an increase in appetite-regulating gut hormone levels [Dirksen et al., 2012, Laferrere and Pattou, 2018]. In Fig. 4(a), we see that the surgery leads to a more peak, unimodal distribution for the next meal time, compared to the multimodal pre-surgery distribution. The average time interval until the next meal decreases from \(3.16\,\) to \(2.41\,\). In Fig. 4(b), we see that the post-surgery carbohydrate intake is more concentrated around the mean. The median per-meal carbohydrate intake decreases from \(29.13\,\) to \(11.94\,\).

#### 5.1.4 Would intervening on the mediator (diet) suffice to regularize glucose progression?

As shown in Figs. 1, 4 and 5, the surgery affects glycemia through changing the diet (indirect) and other biological processes (direct). Then, a relevant research question is _how much of the surgery effect can be attributed to the changed diet_?

This question is crucial in assessing whether surgery affects blood glucose levels independently of dietary changes. If confirmed, it implies that surgery can influence blood glucose through two mechanisms: controlling meal size and independent hormonal changes. Additionally, surgery can also induce too low glucose levels (hypoglycemia), if the glucose peak after the meal induces too high insulin secretion [Lee et al., 2016].

To measure the contribution of direct and indirect causal paths, we use two metrics: (i) the percentage time spent in hypoglycemia (\(\)) \(\%T_{}=\{t:y(t) 3.9\,/1\}/T\), and (ii) the percentage time spent in above-normal-glycemia (\(\)) \(\%T_{}=\{t:y(t) 5.6\,/1\}/T\). We estimate direct, indirect and total effects on \(\%T_{}\) and \(\%T_{}\), as in Eqs. (4) to (6). We show the results in Table 1. In the empirical data, \(\%T_{}\) increased \(27.5\) points, while \(\%T_{}\) decreased \(27.0\) points. For the estimation of direct and indirect effects, we train our joint model on the RCT data set and use samples from the posterior to obtain a Monte Carlo approximation. The results suggest that the contribution of the changed diet (indirect, Nie) to the total effect in \(\%T_{}\) and \(\%T_{}\) is much smaller compared to other metabolic processes (direct, Nde). Our computational exploration of these effects from observational data is supported empirically by Laferrere et al. , who study the effects of two

   Data & Causal & \(\%T_{}\) & \(\%T_{}\) \\ type & effect & & \\  Empirical data & Te & \(+27.5\) & \(-27.0\) \\   & Te & \(+24.4 0.2\) & \(-28.0 0.5\) \\  & Nde & \(+24.7 0.2\) & \(-26.4 0.5\) \\  & Nie & \(-0.3 0.2\) & \(-1.5 0.3\) \\   

Table 1: Nde, Nie and Te results for % time spent in hypoglycemia \(\%T_{}\) and in above-normal-glycemia \(\%T_{}\), to investigate _how much of the surgery effect can be attributed to a changed diet?_

Figure 5: Pre- vs. post-surgery data (histograms) and model posterior (kernel density estimate, dashed) for **(a)** next meal time and **(b)** (log) carbohydrate intake.

different interventions -- namely, dietary changes and surgical procedures -- on individuals who had lost equal amounts of weight. In the study, the blood glucose response to a fixed carbohydrate meal shows a more pronounced decline in the surgery group compared to the control group. Because all patients received the same meal, this decline corresponds to the direct effect. This direct effect can be attributed to a range of intricate hormonal influences, including the involvement of gut hormones like GLP-1, alongside heightened insulin peaks subsequent to surgical intervention.

### Semi-Synthetic Simulation Study

In this section, we set up a semi-synthetic simulation study to evaluate the proposed method on two causal tasks: estimating (i) natural direct effect (Nde) and (ii) natural indirect effect (Nie). For further details and additional results on sensitivity analysis, see Appendices C.2 and D.

**Simulator.** We train our joint model on the real-world Rct data set, and then use the learned model as the ground-truth meal-blood glucose simulator. One joint model is learned for each of the pre- and post-surgery periods. For the meal simulator, we use a mediator model learned on all patients. For the glucose simulator, we use an outcome model learned on a subset of three patients with distinct baselines and meal response functions to enable individualization between synthetic patients.

**Semi-synthetic dataset.** We use the ground-truth simulators to sample meal-glucose trajectories for \(50\) synthetic patients. As in the Rct in Section 5.1, we assume each patient undergoes the surgery in the semi-synthetic scenario while being observed in pre- and post-surgery periods. For the training set, we sample \(1\)-day long trajectories for pre- and post-surgery periods. For the test set, we sample three interventional trajectories for each patient for the subsequent 1-day, corresponding to three interventional distributions resulting from the following interventions: \(\{[,],[,_{a}],[_{a},_{a}]\}\). Then, the ground-truth Nie and Nde trajectories are calculated as in Eqs. (4) and (5), respectively.

**Benchmarks.** We compare methods with respect to their abilities in (i) allowing for an external intervention that jointly affects mediator and outcome processes, and (ii) capturing non-linear, long-range dependencies between these processes. For (i), we add a benchmark model  that excludes the direct arrows from the treatment to the outcomes (\(A\!\!-\!Y\)). For (ii), we combine different interacting/non-interacting mediator models and parametric/non-parametric response functions to obtain baseline methods that include the direct arrows (\(A\!\!-\!Y\)). The methods Z21-1 and Z21-2 are named after a longitudinal causal mediation method  with linear, instantaneous effects from mediator to outcome  (Fig. 2a). Additionally, we include a parametric response  (M1, M3), and a non-parametric response [Non-parametric (H22), 13] (M2). The non-interacting mediator model is chosen as a history-independent, non-homogeneous Poisson process [Non-interacting (L15), 12] (M1, M2), while the interacting mediator model is chosen as a history-dependent, non-parametric point process model [Interacting (H22), 13] (M3, Z21-1). In the joint model Z21-2, we further combine the parametric response model by Zeng et al.  (Parametric (Z21)) with the ground-truth (Oracle) mediator sequence.

**Metric.** On the test set, we report the mean squared error (Mse) between ground-truth and estimated trajectories. To sample comparable glucose trajectories, three interventional trajectories are simulated with fixed noise variables for meal (point process) sampling for all methods, as in .

    &  &  \\ Model & \(A\!\!-\!Y\) & Mediator & Response & \((_{a})\) & \((_{a})\) & \((_{a})\) \\  M1 & ✓ & Non-interact. (L15) & Parametric (S17) & \(0.22 0.02\) & \(0.12 0.01\) & \(0.31 0.02\) \\ M2 & ✓ & Non-interact. (L15) & Non-param. (H22) & \(0.04 0.00\) & \(0.15 0.01\) & \(0.16 0.02\) \\ M3 & ✓ & Interacting (H22) & Parametric (S17) & \(0.23 0.02\) & \(0.11 0.01\) & \(0.31 0.02\) \\  Z21-1 & ✓ & Interacting (H22) & Parametric (Z21) & \(0.07 0.00\) & \(0.09 0.01\) & \(0.16 0.01\) \\ Z21-2 & ✓ & Oracle & Parametric (Z21) & \(0.07 0.00\) & \(\) & \(\) \\ H22 & ✗ & Interacting (H22) & Non-param. (H22) & – & – & \(1.14 0.07\) \\ Our & ✓ & Interacting (H22) & Non-param. (H22) & \(\) & \(0.09 0.01\) & \(\) \\   

Table 2: Mean squared error (Mse, mean \(\) std.dev. across 10 runs) for Nde, Nie and Te.

**Results.** Nse results are shown in Table 2. For the **natural direct effect**, formalized as \((_{a})=_{>_{a}}[_{a},_{a}]- _{>_{a}}[,_{a}]\), we answer the causal query: How differently will the glucose progress if we change _only_ the metabolic processes other than the diet, while keeping the diet at its natural post-surgery value? We see that our joint model performs the best compared to the other methods. The models with the non-parametric response produce better Nde trajectories than the models with the parametric response, which fail to capture the glucose baseline and the meal response well. For the **natural indirect effect**, formalized as \((_{a})=_{>_{a}}[,_{a}] -_{_{a}}[,]\), we answer the causal query: How will the glucose progress if we change _only_ the diet, while keeping the rest of the metabolic processes at their natural pre-surgery state? The oracle model Z21-2 that directly uses the mediator sequences sampled from the ground-truth simulator performs better than other methods. Our joint model performs better than the other methods that predict the mediator sequence, and it performs the same compared to the model Z21-1 which also uses the interacting mediator model. In contrast to the Nde results, the performance on the Nie improves with respect to the expressiveness of the mediator model, e.g. models with the interacting point process (M3, Z21-1, Our) perform better than the models with the non-interacting mediator (M1, M2). Similarly, the oracle model that has access to the ground-truth mediator sequences performs the best. For the **total effect**, formalized as \((_{a})=_{>_{a}}[_{a},_{a}] -_{_{a}}[,]\), our joint model performs similar to the model Z21-2 that has access to the ground-truth mediators, while performing better than all the rest.

## 6 Limitations and Future Work

As required for causal inference, our identifiability result relies on causal assumptions, which may not hold in an observational study and are not statistically testable. For example, our assumption that there are no unobserved confounders between the mediator and outcome processes may not hold. To understand the sensitivity to this assumption, we performed an additional preliminary analysis in Appendix D, which can be refined in future work by extending the sensitivity analysis methods used in the static setting [Robins et al., 2000b]. In addition, our method relies on a hypothetical division of a treatment into path-specific treatments which solely affect the variables in their own path. This may not be possible in reality, e.g., it is not trivial to come up with a treatment that changes all the other metabolic processes without affecting the diet in our surgery-diet-blood glucose example.

In our real-world application, we focus on the dynamic causal mediation problem where the sequence of meals is the mediator of the effect of surgery on blood glucose. In this definition, the rest of the metabolic processes, e.g., gut hormones, weight loss, hepatic insulin sensitivity, or any other mediator through which the surgery could affect blood glucose, are included in the _direct effect_. An extension to multiple mediators and an explicit quantification of the corresponding path-specific effects will be an interesting future direction, especially from a medical point of view. In the semi-synthetic study, our joint model matches the functional class of the simulator; in future work, it would be valuable to further analyze the effect of model misspecification.

From a modeling perspective, the main limitation is scalability of the outcome model to a larger number of data points (see Appendix B.5 for details). This can be improved using separate sets of inducing points for the baseline function and the treatment response function. Alternatively, the Gp models describing the components of our joint distribution (Eq. (8)) could be replaced by other model classes (e.g., neural networks). Our dynamic causal mediation framework does not put any fundamental limitations on the dimensionality of mediators or outcome.

## 7 Conclusion

We investigated temporal causal mediation in complex healthcare time-series by defining direct and indirect effects as stochastic processes instead of static random variables. Theoretically, we provided causal assumptions required for identifiability. To estimate the effects, we proposed a non-parametric mediator-outcome model that allows for an external intervention jointly affecting mediator and outcome sequences, while capturing time-delayed interactions between them. Despite the limitations, in a real-world study about the effect of bariatric surgery on meal-blood glucose dynamics, our method identified clinically-meaningful direct and indirect effects. This demonstrates how the model can be used for gaining insights from observational data without tedious or expensive experiments and supports its use for generating novel, testable research hypotheses. We believe that our method can lead to insightful analyses also in other domains such as epidemiology, public policy, and beyond.