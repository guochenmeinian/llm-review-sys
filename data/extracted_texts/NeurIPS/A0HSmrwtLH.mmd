# Testing Semantic Importance via Betting

Jacopo Teneggi

Johns Hopkins University

jtenegg1@jhu.edu &Jeremias Sulam

Johns Hopkins University

jsulam1@jhu.edu

###### Abstract

Recent works have extended notions of feature importance to _semantic concepts_ that are inherently interpretable to the users interacting with a black-box predictive model. Yet, precise statistical guarantees such as false positive rate and false discovery rate control are needed to communicate findings transparently, and to avoid unintended consequences in real-world scenarios. In this paper, we formalize the global (i.e., over a population) and local (i.e., for a sample) statistical importance of semantic concepts for the predictions of opaque models by means of conditional independence, which allows for rigorous testing. We use recent ideas of sequential kernelized independence testing to induce a rank of importance across concepts, and we showcase the effectiveness and flexibility of our framework on synthetic datasets as well as on image classification using several vision-language models.

## 1 Introduction

Providing guarantees on the decision-making processes of autonomous systems, often based on complex black-box machine learning models, is paramount for their safe deployment. This need motivates efforts towards _responsible artificial intelligence_, which broadly entails questions of reliability, robustness, fairness, and interpretability. One popular approach to the latter is to use post-hoc explanation methods to identify the features that contribute the most towards the predictions of a model. Several alternatives have been proposed over the past few years, drawing from various definitions of _features_ (e.g., pixels--or groups thereof--for vision tasks , words for language tasks , or nodes and edges for graphs ) and of _importance_ (e.g, gradients for Grad-CAM , Shapley values for SHAP , or information-theoretic quantities ). While most explanation methods highlight important features in the input space of the predictor, users may care more about their meaning. For example, a radiologist may want to know whether a model considered the size and spiculation of a lung nodule to quantify its malignancy, and not just its raw pixel values.

To decouple importance from input features, Kim et al.  showed how to learn the vector representation of _semantic concepts_ that are inherently interpretable to users (e.g., "stripes", "sky", or "sand") and how to study their gradient importance for model predictions. Recent vision-language (VL) models that jointly learn an image and text encoder, such as CLIP , have made these representations--commonly referred to as concept activation vectors (CAVs)--more easily accessible. With these models, obtaining the representation of a concept boils down to a forward pass of the pretrained text encoder, which alleviates the need of a dataset comprising images annotated with their concepts. Several recent works have defined semantic importance--both with CAVs and VL models--by means of _concept bottleneck models_ (e.g., CBM , PCBM , LaBo ), information-theoretic quantities (e.g., V-IP ), sparse coding (e.g., CLIP-IP-OMP , SpLiCe ), _network dissection_ (e.g., CLIP-DISSECT , TextSpan , INViTE ), or causal inference (e.g., DiConStruct , Sani et al. ).

On the other hand, it is important to communicate findings of important features precisely and transparently in order to avoid unintended consequences in downstream decision tasks. Going back to the example of a radiologist diagnosing lung cancer, how should they interpret two concepts withdifferent importance scores? Does their difference in importance carry any statistical meaning? To start addressing similar questions [10; 71] introduced statistical tests for the local (i.e., on a sample) conditional independence structure of a model's predictions. Framing importance by means of conditional independence allows for rigorous testing with false positive rate control. That is, for a user-defined significance level \((0,1)\), the probability of wrongly deeming a feature important is no greater than \(\), which directly conveys the uncertainty in an explanation. Yet these methods consider features as coordinates in the input space, and it is unclear how to extend these ideas to abstract, semantic concepts.

In this work, we formalize semantic importance at three distinct levels of statistical independence with null hypotheses of increasing granularity: \((i)\) marginally over a population (i.e., global importance), \((ii)\) conditionally over a population (i.e., global conditional importance), and \((iii)\) for a sample (i.e., local conditional importance).1 Each of these notions will allow us to inquire the extent to which the output of a model depends on specific concepts--both over a population and on specific samples--and thus deem them important. To test for these notions of semantic importance, instead of classical (or _offline_) independence testing techniques [5; 10; 11; 28; 29; 69; 86], which are based on \(p\)-values and informally follow the rule _"reject if \(p\)"_, we propose to use principles of _testing by betting_ (or _sequential_ testing) , which are based on \(e\)-values  and follow the _"reject when \(e 1/\)"_ rule. As we will expand on, this choice is motivated by the fact that sequential tests are data-efficient and adaptive to the hardness of the problem--which naturally induces a rank of importance. We will couple principles of conditional randomization testing (CRT)  with recent advances in sequential kernelized independence testing (SKIT) [51; 62], and introduce two novel procedures to test for our definitions of semantic importance: the conditional randomization SKIT (C-SKIT) to study global conditional importance, and--following the explanation randomization test (XRT) framework --the explanation randomization SKIT (x-SKIT) to study local conditional importance. We will illustrate the validity of our proposed tests on synthetic datasets, and showcase their flexibility on zero-shot image classification on real-world datasets across several and diverse VL models.

### Summary of Contributions and Related Works

In this paper, we will rigorously define notions of statistical importance of semantic concepts for the predictions of black-box models via conditional independence--both globally over a population and locally for individual samples. For any set of concepts, and for each level of independence, we introduce novel sequential testing procedures that induce a rank of importance. Before presenting the details of our methodology, we briefly expand on a few distinctive features of our work.

**Explaining nonlinear predictors.** Compared to recent methods based on concept bottleneck models [36; 83; 84], our framework does not require training a surrogate linear classifier because we study the semantic importance structure of any given, potentially nonlinear and randomized model. This distinction is not minor--training concept bottleneck models results on explanations that pertain to the surrogate (linear) model instead of the original (complex, nonlinear) predictor, and these simpler surrogate models typically reduce performance [48; 85]. In contrast, we provide statistical guarantees directly on the original predictor that would be deployed in the wild.

**Flexible choice of concepts.** Furthermore, our framework does not rely on the presence of a large concept bank (but it can use one if it is available). Instead, we allow users to directly specify which concepts they want to test. This feature is important in settings that involve diverse stakeholders. In medicine, for example, there are physicians, patients, model developers, and members of the regulatory agency tasked with auditing the model--each of whom might prefer different semantics for their explanations. Current explanation methods cannot account for these differences off-the-self.

**Local semantic explanations.** Our framework entails explanations for specific (fixed) inputs, whereas prior approaches that rely on the weights of a linear model only inform on global notions of importance. Recently, Shukla et al.  and Pham et al.  set forth ideas of local semantic importance by combining LIME  with T-CAV , and by leveraging prototypical part networks , respectively. Our work differs in that it does not apply to images only, it considers formal notions of statistical importance rather than heuristics of gradient importance, and it provides guarantees such as Type I error and false discovery rate (FDR) control.

**Sequential kernelized testing.** Motivated by the statistical properties of kernelized independence tests , we will employ the maximum mean discrepancy (MMD)  as the test statistic in our proposed procedures. The recent related work in Shaer et al.  introduces the sequential version of the conditional randomization test (CRT) , dubbed e-CRT because of the use of \(e\)-values. Unlike our work, Shaer et al.  employ residuals of a predictor as test statistic, they do so in the context of global tests only, and unrelated to questions of semantic interpretability.

## 2 Background

In this section, we briefly introduce the necessary notation and general background. Throughout this work, we will denote random variables with capital letters, and their realizations with lowercase. For example, \(X P_{X}\) is a random variable sampled from \(P_{X}\), and \(x\) indicates an observation of \(X\).

**Problem setup.** We consider \(k\)-fold classification problems such that \((X,Y) P_{XY}\) is a random sample \(X\) with its one-hot label \(Y\{0,1\}^{k}\), and \((x,y)\) denotes a particular observation. We assume we are given a fixed predictive model, consisting of an encoder \(f:^{d}\) and a classifier \(g:^{d}^{k}\) such that \(h=f(x)\) is a \(d\)-dimensional representation of \(x\), and \(_{k^{}}=g(h)_{k^{}}=g(f(x))_{k^{}}\) is the prediction of the model for a particular class \(k^{}\) (e.g., \(_{k^{}}\) is the output, or score, for class "dog"). Naturally, \(,\) denote the random counterparts of \(h\) and \(\). Although our contributions do not make any assumptions on the performance of the model, \(f\) and \(g\) can be thought of as _good_ predictors, e.g. those that approximate the conditional expectation of \(Y\) given \(X\).

**Concept bottleneck models (CBMs).** Let \(c=[c_{1},,c_{m}]^{d m}\) be a dictionary of \(m\) concepts such that \( j[m]\{1,,m\}\), \(c_{j}^{d}\) is the representation of the \(j^{}\) concept--either obtained via CAVs  or a VL model's text encoder. Then, \(z= c,h\) is the projection of the embedding \(h\) onto the concepts \(c\), and, with appropriate normalization, \(z_{j}[-1,1]\) is the _amount_ of concept \(c_{j}\) in \(h\). Intuitively, CBMs project dense representations onto the subspace of interpretable semantic concepts , and their performance strongly depends on the size of the dictionary . For example, it is common for \(m\) to be as large as the embedding size (e.g., \(d=768\) for CLIP:ViT-L/14). In this work, instead, we let concepts be user-defined, allowing for cases where \(m d\) (e.g., \(m=20\)). This is by design as \((i)\) the contributions of this paper apply to any set of concepts, and \((ii)\) it has been shown that humans can only gain valuable information if semantic explanations are succinct . However, we remark that the construction of informative concept banks--especially for domain-specific applications--is subject of ongoing complementary research [20; 48; 78; 80; 81].

**Conditional randomization tests.** Recall that two random variables \(A,B\) are conditionally independent if, and only if, given a third random variable \(C\), it holds that \(P_{A|B,C}=P_{A|C}\) (i.e., \(A\!\! B C\)). That is, \(B\) does not provide any more information about \(A\) with \(C\) present. Candes et al.  introduced the conditional randomization test (CRT), based on the observation that if \(A B C\), then the triplets \((A,B,C)\) and \((A,,C)\) with \( P_{B|C}\), are exchangeable. That is, \(P_{ABC}=P_{AC}\) and one can essentially _mask_\(B\) without changing the joint distribution. Opposite to classical methods, the CRT assumes the conditional distribution of the covariates is known (i.e., \(P_{B|C}\)), which lends itself to settings with ample unlabeled data.

With this general background, we now present the main technical contributions of this paper.

## 3 Testing Semantic Importance via Betting

Our objective is to test the statistical importance of semantic concepts for the predictions of a fixed, potentially nonlinear model, while inducing a rank of importance. Fig. 1 depicts the problem setup--a fixed model, composed of the encoder \(f\) and classifier \(g\), is probed via a set of concepts \(c\). This figure also illustrates the key difference with post-hoc concept bottleneck models (PCBMs) , in that we do not train a sparse linear layer to approximate \([Y Z]\). Instead, we focus on characterizing the dependence structure between \(\) and \(Z\). Herein, we will drop the \(_{k^{}}\) notation and simply write \(,\) because we always consider the output of the model for a particular class individually.

### Formalizing Statistical Importance of Semantic Concepts

We start by defining _global semantic importance_ as marginal dependence between \(\) and \(Z_{j}\), \(j[m]\)

**Definition 1** (Global semantic importance).: For a concept \(j[m]\),

\[H^{}_{0,j}:\ \!\!Z_{j} \]

is the global semantic independence null hypothesis.

Rejecting \(H^{}_{0,j}\) means that we have observed enough evidence to believe the response of the model depends on concept \(j\), i.e. concept \(j\) is globally important over the population. Note that both \(\) and \(Z_{j}\) are fixed functions of the same random variable \(H\), i.e. \(=g(H)\) and \(Z_{j}= c_{j},H\). Then, it is reasonable to wonder whether there is any point in testing \(H^{}_{0,j}\) at all--can we obtain two independent random variables from the same one? For example, let \(g\) be a linear classifier such that \(= w,H\), \(w^{d}\). Intuition might suggest that if \( w,c_{j}=0\) then \(\!\!Z_{j}\), i.e. if the classifier is orthogonal to a concept, then the concept cannot be important. We show in the short lemma below (whose proof is in Appendix C.1) that this is false, and that, arguably unsurprisingly, statistical independence is different from orthogonality between vectors, which motivates the need for our testing procedures.

**Lemma 1**.: _Let \(= w,H\), \(w^{d}\). If \(d 3\), then \(H^{}_{0,j}\) is true \( w,c_{j}=0\)._

The null hypothesis \(H^{}_{0,j}\) above precisely defines the global importance of a concept, but it ignores the information contained in the rest of them, and concepts may be correlated. For example, predictions for class "dog" may be independent of "stick" given "tail" and "paws", although "stick" is marginally important. To address this, and inspired by , we define _global conditional semantic importance_.

**Definition 2** (Global conditional semantic importance).: For a concept \(j[m]\), let \(-j[m]\{j\}\) denote all but the \(j^{}\) concept. Then,

\[H^{}_{0,j}:\ \!\!Z_{j} Z_{-j} \]

is the global conditional semantic independence null hypothesis.

Analogous to Definition 1, rejecting \(H^{}_{0,j}\) means that we have accumulated enough evidence to believe the response of the model depends on concept \(j\) even in the presence of the remaining concepts, i.e. there is information about \(\) in concept \(j\) that is missing from the rest.

We stress an important distinction between Definition 2 and PCBMs: the latter approximate \([Y Z]\) with a sparse linear layer, which is _inherently interpretable_ because the regression coefficients directly inform on the global conditional independence structure of the predictions, i.e. if \(=,Z\), \(^{m}\) then \(\!\!Z_{j} Z_{-j}_{j}=0\). In this work, however, we do not assume any parametrization between the concepts and the labels because we want to provide guarantees on the original, fixed classifier \(g\) that acts directly on an embedding \(h\). From this conditional independence perspective, PCBMs can be interpreted as a (parametric) test of true linear independence (i.e., \(H^{}_{0,j}:Y\!\!Z_{j} Z_{-j}\)) between the concepts and the labels (note that \(H^{}_{0,j}\) has the _true_ label \(Y\) and not the prediction \(\)), whereas we study the semantic structure of the predictions of a complex model, which may have learned spurious, non-linear correlations of these concepts from data.

Akin to the CRT , we assume we can sample from the conditional distribution of the concepts, i.e. \(P_{Z_{j} Z_{-j}}\). Within the scope of this work, \(m\) is small (\(m 20\)) and we will show how to effectively approximate this distribution with nonparametric methods that do not require prohibitive computational resources. This is an advantage of testing _a few_ semantic concepts compared to input

Figure 1: Overview of the problem setup and our contribution.

features, especially for imaging tasks where the number of pixels is large (\( 10^{5}\)) and learning a conditional generative model (e.g., a diffusion model ) may be expensive.

Finally, we define the notion of _local conditional semantic importance_. That is, we are interested in finding the most important concepts for the prediction of the model locally on a particular input \(x\), i.e. \(=g(f(x))\). Recently,  showed how to deploy ideas of conditional randomization testing for local explanations of machine learning models. Briefly, let \(B,C\) be random variables and \((B,C)\) a fixed, possibly randomized, real-valued predictor. For an observation \((b,c)\), the explanation randomization test (XRT)  null hypothesis is \((b,c)}{{=}}(,c)\), \( P_{B|C=c}\). That is, the _observed_ value of \(B\) does not affect the distribution of the response given the _observed_ value of \(C\). We now generalize these ideas.

**Definition 3** (Local conditional semantic importance).: For a fixed \(z[-1,1]^{m}\) and any \(C[m]\), denote \(_{C}=g(_{C})\) with \(_{C} P_{H|Z_{C}=z_{C}}\). Then, for a concept \(j[m]\) and a subset \(S[m]\{j\}\),

\[H^{}_{0,j,S}:\;_{S\{j\}}}{{=}} _{S} \]

is the local conditional semantic independence null hypothesis.

In words, rejecting \(H^{}_{0,j,S}\) means that, given the observed concepts in \(S\), concept \(j S\) affects the distribution of the response of the model, hence it is important. For this test, we assume we can sample from the conditional distribution of the embeddings given a subset of concepts (i.e., \(P_{H|Z_{C}=z_{C}}\)). This is equivalent to solving an inverse problem stochastically, since \(z= c,h\) and \(c\) is not invertible (\(c^{d m}\), \(m d\)). Hence, there are several embeddings \(h\) that could have generated the observed \(z_{C}\). We will use nonparametric sampling ideas to achieve this, stressing that it suffices to sample the embeddings \(H\) and not an entire input image \(X\) since the classifier \(g\) directly acts on \(h\) and the encoder \(f\) is deterministic. Finally, we remark that \(H^{}_{0,j,S}\) differs from the XRT null hypothesis in that conditioning is performed in the space of semantic concepts instead of the input's.

With these precise notions of semantic importance, we now show how to test for each one of them with principles of sequential kernelized independence testing (SKIT) .

### Testing by Betting

A classical approach to hypothesis testing consists of formulating a null hypothesis \(H_{0}\), collecting data, and then summarizing evidence by means of a \(p\)-value. Under the null, the probability of observing a small \(p\)-value is small. Thus, for a significance level \((0,1)\), we can reject \(H_{0}\) if \(p\). In this setting, all data is collected first, and then processed later (i.e., offline).

Alternatively, one can instantiate a game between a bettor and nature . At each turn of the game, the bettor places a wager against \(H_{0}\), and then nature reveals the truth. If the bettor wins, they will increase their wealth, otherwise lose some. More formally, and as is commonly done , we define a wealth process \(\{K_{t}\}_{t_{0}}\) with \(K_{0}=1\) and \(K_{t}=K_{t-1}(1+v_{t}_{t})\) where \(v_{t},_{t}[-1,1]\) are a betting fraction and the payoff of the bet, respectively. It is now easy to see that when \(v_{t}_{t} 0\) (i.e., the bettor wins) the wealth increases, and the opposite otherwise. If the payoff \(_{t}\) guarantees the game is _fair_, i.e. the bettor cannot accumulate wealth under the null, then we can use the wealth process to reject \(H_{0}\) with Type I error control (details in Appendix A). In particular, for a significance level \((0,1)\), we denote \(\{t 1:K_{t} 1/\}\) the _rejection time_ of \(H_{0}\).

The choice of using sequential testing is motivated by two fundamental properties. First, sequential tests are _adaptive_ to the hardness of the problem, sometimes provably [62, Proposition 3]. That is, the harder it is to reject the null, the longer the test will take, and vice versa. This naturally induces a rank of importance across concepts--if concept \(c_{j}\) rejects faster than \(c_{j^{}}\), then \(c_{j}\) is more important (i.e., it is easier to reject the null hypothesis that the predictions do not depend on \(c_{j}\)). We stress that this is not always possible by means of \(p\)-values because they do not measure effect sizes: consider two concepts that reject their respective nulls at the same significance level; one cannot distinguish which--if any--is more important. As we will show in our experiments, all tests used in this work are adaptive in practice, but statistical guarantees on their rejection times are currently open questions, and we consider them as future work. Second, sequential tests are _sample-efficient_ because they only analyze the data is needed to reject, which is especially important for conditional randomization tests. In the offline scenario, we would have to resample the entire dataset several times (which is expensive), but the sequential test would terminate in at most the size of the dataset .

```
0: Stream \((^{(t)},Z_{j}^{(t)},Z_{-j}^{(t)}) P_{Z_{j}Z_{-j}}\).
1:\(K_{0} 1\)
2: Initialize ONS strategy (Algorithm A.1)
3:for\(t=1,\)do
4: Compute \(_{t}\) as in Eq. (4)
5:\(D^{(t)}=(^{(t)},Z_{j}^{(t)},Z_{-j}^{(t)})\)
6: Sample \(_{j}^{(t)} P_{Z_{j}|Z_{-j}=Z_{-j}^{(t)}}\)
7:\(^{(t)}(^{(t)},_{j}^{(t)},Z_{-j}^{( t)})\)
8:\(_{t}(_{t}(D^{(t)})-_{t}(^{(t)}))\)
9:\(K_{t} K_{t-1}(1+v_{t}_{t})\)
10:if\(K_{t} 1/\)then
11:return\(t\)
12:endif
13:\(v_{t+1}\) ONS step
14:endfor
```

**Algorithm 1** Level-\(\)\(\)-SKIT for concept \(j\)

### Testing Global Semantic Importance with SKIT

Podkopaev et al.  show how to design sequential kernelized tests of independence (i.e., \(H_{0}:A B\)) by framing them as particular two-sample tests of the form \(H_{0}:P=\), with \(P=P_{AB}\) and \(=P_{A} P_{B}\). Similarly to [58; 62], they propose to leverage a simple yet powerful observation about the _symmetry_ of the data under \(H_{0}\)[51, Section 4]. We state here the main result we will use in this paper (the proof is included in Appendix A.2).

**Lemma 2** (See [51; 58; 62]).: \( t 1\)_, let \(X P\) and \(\), and let \(_{t}:\) be any fixed real-valued function on \(\). Then, \(_{t}=(_{t}(X)-_{t}())\) provides a fair game for \(H_{0}:P=\)._

That is, Lemma 2 prescribes how to construct valid payoffs for two-samples tests and, consequently, tests of independence. We note that the choice of \(\) provides \(_{t}[-1,1]\), but any arbitrary anti-symmetric function can be used (e.g., \(\)). Furthermore, any fixed function \(_{t}\) is valid but, in general, this function should have a positive value under the alternative in order for the bettor to increase their wealth and the testing procedure to have good power.

Going back to the problem studied in this work, note that the global semantic importance null hypothesis \(H_{0,j}^{}\) in Definition 1 can be directly rewritten as a two-sample test, i.e. \(H_{0,j}^{}:\  Z_{j}\) is equivalent to \(H_{0,j}^{}:\ P_{Z_{j}}=P_{} P_{Z_{j}}\). We follow  and use the maximum mean discrepancy (MMD)  to measure the distance between the joint and the product of marginals. In particular, let \(_{},_{Z_{j}}\) be two reproducing kernel Hilbert spaces (RKHSs) on the domains of \(\) and \(Z_{j}\), respectively (recall that \(\) and \(Z_{j}\) are univariate). Then, \(_{t}^{}\) is the plug-in estimate of the _witness function_ of \((P_{Z_{j}},P_{} P_{Z_{j}})\) at time \(t\).2 We include the SKIT algorithm and technical details on computing \(_{t}^{}\) and \(k_{t}^{}\) in Appendix B.1.

**Computational complexity of SKIT.** Analogous to the original presentation in Shekhar and Ramdas , the computational complexity of Algorithm B.1 is \((^{2})\), where \(\) is the random rejection time.

We now move on to presenting two novel testing procedures: the conditional randomization SKIT (C-SKIT) for \(H_{0,j}^{}\), and the explanation randomization SKIT (x-SKIT) for \(H_{0,j,S}^{}\).

### Testing Global Conditional Semantic Importance with C-SKIT

Analogous to the discussion in the previous section, we rephrase the global conditional null hypothesis \(H_{0,j}^{}\) in Definition 2 as a two sample test \(H_{0,j}^{}:\ P_{Z_{j}Z_{-j}}=P_{_{j}Z_{-j} },\ _{j} P_{Z_{j}|Z_{-j}}\). In contrast with other kernel-based notions of distance between conditional distributions [49; 63; 66]--and akin to the CRT --we assume we can sample from \(P_{Z_{j}|Z_{-j}}\), which allows us to directly estimate \((_{_{Z}_{j}Z_{-j}},_{_{_{j}Z_{-j}}})\) in our testing procedure (we will expand on how to sample from this distribution shortly). Let \(_{},_{Z_{j}},_{Z_{-j}}\) be three RKHSs on the domains of \(,Z_{j}\), and \(Z_{-j}\) (i.e., \(,,^{m-1}\), where \(m\) is the number of concepts). Then, at time \(t\), the c-SKIT payoff function is

\[_{t}^{}_{Z_{j}Z_{-j}}^{(t-1)}-_{_{j}Z_{-j}}^{(t-1)}, \]

where \(_{_{Z}Z_{-j}}^{(t-1)},_{_{_{j}Z_{-j}}}^{ (t-1)}\) are the mean embeddings of their respective distributions in \(_{}_{Z_{j}}_{Z_{-j}}\), and \(\) is the tensor product (see Appendix B.2 for technical details). Algorithm 1 summarizes the c-SKIT procedure, which provides Type I error control for \(H_{0,j}^{}\), as we briefly state in the following proposition (see Appendix C.2 for the proof).

**Proposition 1**.: \( t 1\)_, let \((,Z_{j},Z_{-j}) P_{Z_{j}Z_{-j}}\) and \((,_{j},Z_{-j}) P_{_{j}Z_{-j}}\), \(_{j} P_{Z_{j}|Z_{-j}}\). Then, \(_{t}(_{t}^{}(,Z_{j},Z_{-j})-_ {t}^{}(,_{j},Z_{-j}))\) provides a fair game for \(H_{0,j}^{}\)._

**Computational complexity of c-SKIT.** First note that \(Z_{-j}\) is an \((m-1)\)-dimensional vector (where \(m\) is the number of concepts). So, at each step of the test, the evaluation of the kernel associated with \(_{Z_{-j}}\) requires an additional sum over \((m)\) terms. Furthermore, c-SKIT needs access to samples from \(P_{Z|Z_{-j}}\), and we conclude that the computational complexity of Algorithm 1 is \((T_{n}m^{2})\), where \(T_{n}\) represents the cost of the sampler on \(n\) samples, and it depends on implementation. For example, in the following, we will use non-parametric samplers with \(T_{n}=(n^{2})\). Other choices of samplers, such as variational-autoencoders, may have constant cost (e.g., they are trained once and only used for inference).

### Testing Local Conditional Semantic Importance with x-SKIT

Attentive readers will have noticed that the local conditional semantic null hypothesis \(H_{0,j,S}^{}\) in Definition 3 is already a two-sample test where the test statistic \(P\) is the distribution of the response of the model _with_ the observed amount of concept \(j\) (i.e., \(_{\{j\}}=g(_{\{j\}})\)), and the null distribution \(\)_without_ (i.e., \(_{S}=g(_{S})\)). Herein, we assume we can sample from \(_{C} P_{H|Z_{C}=z_{C}}\) for any subset \(C[m]\), i.e. the conditional distribution of dense embeddings with specific concepts, which we will address via nonparametric methods. Then, for an RKHS \(_{}\), the x-SKIT payoff function is

\[_{t}^{}_{_{S\{j\}}}^{(t-1)}- {}_{_{S}}^{(t-1)} \]

with \(_{_{S\{j\}}}^{(t-1)},_{_{S}}^{(t-1)}\) mean embeddings of the distributions in \(_{}\). That is, \(_{t}^{}\) is the plug-in estimate of the witness function of \((_{S\{j\}},_{S})\)--technical details are in Appendix B.3. Then, the x-SKIT testing procedure, which is summarized in Algorithm 2, provides Type I error control for \(H_{0,j,S}^{}\), as the following proposition summarizes (the proof is included in Appendix C.3).

**Proposition 2**.: \( t 1\)_, \(_{t}(_{t}^{}(_{S\{j\}})-_ {t}^{}(_{S}))\) provides a fair game for \(H_{0,j,S}^{}\)._

**Computational complexity of x-SKIT.** Note that Algorithm 2 assumes access to a sampler \(P_{H|Z_{C}=z_{C}}\), so its computational complexity is \((T_{n}^{2})\), where, similarly to above, \(T_{n}\) is the cost of the sampler. We briefly remark that, for the nonparametric samplers used in this work, \(T_{n}=n^{2}\) (compared to \( n^{2}\) for c-SKIT) because we only need to estimate one conditional distribution.

So far, we have presented our tests for _one concept at a time_, but we are interested in testing \(m 1\) concepts. In this setting, it is well-known that multiple hypothesis testing requires appropriate corrections to avoid inflated significance levels. We use a result of Wang and Ramdas  and devise a greedy post-processor that guarantees false discovery rate control  (see Appendix A.4).

## 4 Results

First, we verify that our tests are valid and that they are adaptive to the hardness of their null hypotheses on two synthetic experiments in Appendix D. Here, we showcase the flexibility and effectiveness of our framework on zero-short image classification across several VL models on three real-world datasets: Animal with Attributes 2 (AwA2) , CUB-200-2011 (CUB) , and the Imagenette subset of ImageNet .3. We compare performance and transferability of the ranks of importance provided by each method across 8 VL models (see Appendix E for details) and, for all experiments, \(f\) is the image encoder of the model and \(g\) is the (linear) zero-shot classifier constructed by encoding _"A photo of a <CLASS_NAME>"_ with the text encoder. Herein, we will always use RBF kernels to compute payoffs, and we repeat each test 100 times on independent draws of \(^{}\) samples to estimate each concept's _expected rejection time_ and _expected rejection rate_ at a significance level of \(=0.05\) with the FDR post-processor described in Appendix A.4. That is, a (normalized) rejection time of 1 means failing to reject in \(^{}\) steps. Finally, recall that c-SKIT and x-SKIT need access to \(P_{Z_{j}|Z_{-j}}\) and \(P_{H|Z_{C}=z_{C}}\), and that these distributions are not known in general. Since \(m\) is small, we use nonparametric methods to estimate them (see Appendix E.1).

Table 1 summarizes the results of all experiments, which we now present and discuss individually.

### AwA2 Dataset

Given the presence of global (i.e., class-level) annotations, we use SKIT and c-SKIT to test the global (and global conditional) semantic importance structure of the predictions for the top-10 best classified animal categories across all models (we describe the dataset, the concepts used, and the hyperparameters of the tests in Appendix E.2). We classify the top-10 concepts reported by each method as important, and we compute the \(f_{1}\) score with the ground-truth annotations. We briefly remark that this choice is informed by the fact that most concepts have rejection rates larger than the significance level of \(\). When comparing with PCBM--since we use different concepts for each class--we train 100 independent linear models for each class, and we rank concepts based on their average absolute weights (instead of signed ones) because the null hypotheses presented in this work are two-sided, i.e. a concept is important both if it increases the prediction for a class or if it decreases it. Table 1 shows that both SKIT and c-SKIT outperform PCBM across all three metrics, with SKIT providing the best average rank agreement across different models and importance \(f_{1}\) score (0.50 and 0.65, respectively). The fact that ranks provided by our tests have higher average agreement compared to PCBM suggests that VL models may share a similar semantic independence structure notwithstanding their embedding size or training strategy, i.e. semantic importance may be _transferable_ across models (all individual pairwise agreements are included in Fig. E.4).

Finally, Fig. 2 shows ranks of importance with CLIP:ViT-L/14 on 2 animal categories (see Figs. E.5 and E.6 for all classes). In general, concepts are globally important (rejection rates are greater than \(\)),

    & Original &  &  &  \\   & model & Accuracy & Rank agreement & Accuracy & Rank agreement & \(f_{1}\) & Accuracy & Rank agreement & \(f_{1}\) \\  SKIT & ✓ & 0.51 & & **0.50** & **0.65** & 0.82 & 0.93 \\ c-SKIT & ✓ & **98.99\%** & 0.54 & **99.50\%** & 0.46 & 0.57 & **89.52\%** & - & - \\ x-SKIT & ✓ & & **0.59** & & - & - & - & - \\  PCBM & ✗ & \(95.85\%\) & 0.45 & \(95.11\%\) & 0.36 & 0.53 & - & - & - \\   

Table 1: Summary of results for each dataset. Metrics are reported as average across all VL models used in the experiments. See main text for details about the models and the metrics used.

Figure 2: Importance results with CLIP:ViT-L/14 on 2 classes in the AwA2 dataset. Concepts are annotated with _(p)_ if they are present in the class, or with _(a)_ otherwise.

and it is harder to reject the global conditional null hypothesis (rejection rates are lower and rejection times larger), naturally reflecting the fact that conditional independence is a stronger condition.

### CUB Dataset

This dataset (differently from AwA2) provides per-image annotations of semantic attributes. So, we use x-SKIT to test the semantic importance structure of VL models locally on particular images and validate its performance against such annotations (we include details about this experiment and extended results in Appendix E.3). The purpose of this experiment is to validate the performance of x-SKIT, hence we use the ground-truth binary semantic annotations as an oracle instead of predicting the presence of concepts. In practical scenarios where ground-truth is not available, one could--as done by previous works --use LLMs to answer binary questions (e.g., "Does this bird have an orange bill? Yes/No"). Furthermore, note that for each concept \(j[m]\) there are exponentially many tests with null hypothesis \(H^{}_{0,j,S}\)--one for each subset \(S[m]\{j\}\)--which are intractable to compute. Thus, we report average results over 100 tests with random subsets with fixed size \(s\).

Fig. 3 depicts prototypical results with CLIP:ViT-L/14 (Fig. E.9 includes results for all models on the same images). After running x-SKIT, we classify concepts as important by thresholding their rejection rates at level \(\)--which is a statistically-valid way of selecting important concepts. Results are included in Table 1, and we conclude that x-SKIT provides ranks of importance that are well-aligned both across models (\(0.82\) rank agreement) and with ground-truth annotations (\(f_{1}\) score of \(0.93\)). We remark that x-SKIT is the first method to provide local semantic explanations, hence why we cannot compare with alternatives.

### Imagenette Dataset

Lastly, we use both SKIT, c-SKIT, and x-SKIT on the Imagenette subset of ImageNet --which does not provide ground-truth semantic annotations to evaluate performance with. So, we use SpLiCe  to select which concepts to test (see Appendix E.4 for details), but we stress that any user-defined set of concepts would be valid--a unique feature of our proposed framework.

Figs. 3(a) and 3(b) show SKIT and c-SKIT results with CLIP:ViT-L/14 on 2 classes in the dataset (Fig. E.11 includes all classes). We use SpLiCe to encode the entire dataset and test the top-20 concepts. Analogous to the experiment on AwA2, we can see that rejection rates are lower for c-SKIT (i.e., conditional dependence) compared to SKIT (i.e., marginal dependence). We evaluate rank agreement across all models and compare with PCBM in Table 1. These results confirm that not only are the ranks produced by our tests more transferable across models (rank agreement of \(0.51\) for SKIT, \(0.54\) or c-SKIT, \(0.59\) for x-SKIT, and \(0.45\) for PCBM), but also they retain the performance of the original classifier (\(98.99\%\) for our methods vs \(95.55\%\) for PCBM). We refer interested readers to Fig. E.12 for all pairwise comparisons. Furthermore, we qualitatively study the stability of our tests as a function of \(^{}\) in Fig. E.13. This is important because \(^{}\) represents the sample complexity of the tests. Our findings indicate that important concepts tend to exhibit greater stability in their ranks compared to less important ones, with SKIT showing overall more stability than c-SKIT.

To conclude, Fig. 3(c) shows x-SKIT results with CLIP:ViT-L/14 on three random images from the dataset (see Figs. E.15 and E.16 for all models and more images). We use SpLiCe to encode each image and obtain its top-10 concepts, and then add the bottom-4 according to PCBM, for a total of 14 attributes per image. The choice of combining concepts both from SpLiCe and PCBM will highlight

Figure 3: Importance results with x-SKIT and CLIP:ViT-L/14 on 4 images in the CUB dataset. Concepts with _(p)_ are present in the image according to human annotations, and _(a)_ otherwise.

the differences between these methods and our notion of local statistical importance, as we will shortly expand on. Recall that we use nonparametric samplers to approximate \(P_{H|Z_{C}=z_{C}}\), so the cost of using image-specific concepts boils down to projecting the feature embeddings with a different matrix \(c\), which is negligible compared to running the tests. We note that parametric generative models--such as variational autoencoders or diffusion models--would have required retraining for each set of concepts, which is expensive. Overall, we find that ranks are well-aligned across models (0.71 rank agreement, see Table 1). We can appreciate how the bottom-4 concepts from PCBM, which are annotated with an asterisk, are not always last, i.e. a concept may be locally important even if it is not globally important. For example, concept "fishing" may not be globally important for class "English springer", but it is locally important for an image of a dog in water. Conversely, a concept having a high weight according to SpLiCe does not imply it will be statistically important for the predictions of the model, and these distinctions are important in order to communicate findings transparently.

## 5 Conclusions

There exist an increasing interest in explaining modern, unintelligible predictors and, in particular, doing so with inherently interpretable concepts that convey specific meaning to users. This work is the first to formalize precise statistical notions of semantic importance in terms of global (i.e., over a population) and local (i.e., on a sample) conditional hypothesis testing. We propose novel, valid tests for each notion of importance while providing a rank of importance by deploying ideas of sequential testing. Importantly, by approaching importance via conditional independence (and by developing appropriate valid tests), we are able to provide Type I error and FDR control, a feature that is unique to our framework compared to existing alternatives. Furthermore, our tests allow to explain the original--potentially nonlinear--classifier that would be used in the wild, as opposed to training surrogate linear models as has been the standard so far.

Naturally, our work has limitations. First and foremost, the procedures introduced in this work require access to samplers, and there might be settings were learning these models is hard; we used nonparametric estimators in our experiments, but modern generative models could be employed, too. Second, kernel-based tests rely on the assumption that the kernels used are characteristic for the space of distributions considered. Although these assumptions are usually satisfied in \(^{d}\) for RBF kernels, there may exist data modalities where this is not true (e.g., discrete data, graphs), which would compromise the power of the test. Finally, although we grant full flexibility to users to specify the concepts they care about, there is no guarantee that these are well-represented in the feature space of the model, nor that they are the most informative ones for a specific task. All these points are a matter of ongoing and future work.

Figure 4: Results with CLIP:ViT-L/14 on Imagenette.