# MIM4DD: Mutual Information Maximization for

Dataset Distillation

Yuzhang Shang\({}^{1}\), Zhihang Yuan\({}^{2}\), Yan Yan\({}^{1}\)

\({}^{1}\)Department of Computer Science, Illinois Institute of Technology

\({}^{2}\)Huomo AI

yshang4@hawk.iit.edu, zhihang.yuan@huomo.ai, yyan34@iit.edu

Corresponding author

###### Abstract

Dataset distillation (DD) aims to synthesize a small dataset whose test performance is comparable to a full dataset using the same model. State-of-the-art (SoTA) methods optimize synthetic datasets primarily by matching heuristic indicators extracted from two networks: one from real data and one from synthetic data (see Fig. 1, Left), such as gradients and training trajectories. DD is essentially a compression problem that emphasizes maximizing the preservation of information contained in the data. We argue that well-defined metrics which measure the amount of shared information between variables in information theory are necessary for success measurement but are never considered by previous works. Thus, we introduce mutual information (MI) as the metric to quantify the shared information between the synthetic and the real datasets, and devise MIM4DD numerically maximizing the MI via a newly designed optimizable objective within a contrastive learning framework to update the synthetic dataset. Specifically, we designate the samples in different datasets that share the same labels as positive pairs and _vice versa_ negative pairs. Then we respectively pull and push those samples in positive and negative pairs into contrastive space via minimizing NCE loss. As a result, the targeted MI can be transformed into a lower bound represented by feature maps of samples, which is numerically feasible. Experiment results show that MIM4DD can be implemented as an add-on module to existing SoTA DD methods.

## 1 Introduction

Deep learning has remarkably successful performance in computer vision tasks [25; 6], but most deep-learning-based methods require enormous amounts of data followed by extensive training resources. For example, in order to train a CLIP model  in a self-supervised manner , a high-resolution dataset with more than 10 million images are collected for training, which consumes tens of hundreds of GPU hours.

A straightforward solution to eliminate the reliance on training DNNs on data is to construct small training sets. Before the deep learning era, coreset or subset selection is the most prevalent paradigm, in which one can obtain a subset of salient data points to represent the original dataset of interest [1; 12; 34].
previously mentioned selection-based methods, Dataset Distillation (DD), also known as Dataset Condensation [41; 46; 40; 5], offers a revolutionary paradigm to synthesize a small dataset using gradient descent algorithms , as shown in Fig.1 (Left). In DD, the key question is how to define metrics to measure the distance between synthetic and real datasets. Only by optimizing a well designed distance metric can gradient descent be properly applied to update synthetic data. To answer this question, researchers design several distance algorithms. For example, Zhao _et al._ measure distance between the batch gradients of the synthetic samples and original ones; Wang _et al._ use the similarity between the feature maps extracted by networks on different datasets; Cazenavette _et al._ resort to the MSE between the training trajectories of networks on real and synthetic datasets.

_Dataset distillation task is essentially a compression problem with a strong emphasis on maximizing the preservation of information contained in the data_[41; 19; 11]. Admittedly, previous heuristic-designed distance metrics have achieved promising performance. However, we argue that previous works neglect the well-defined distributional metric in information theory, which is necessary for success measurement. Specifically, if we define a dataset's samples as variables, it is imperative that the high-level distributional properties of these variables from synthetic and real datasets (_e.g._, correlations and dependencies between two datasets) should be captured and utilized to guide the update of synthetic datasets. Motivated by this notion, we introduce Mutual Information (MI), a well-formulated metric in information theory for dataset distillation. In detail, MI quantifies the information amount shared by the real and synthetic datasets. In contrast to the aforementioned works focusing on aligning the indicators extracted by different neural networks, MI can naturally capture non-linear statistical dependencies between variables and be used as a measure of true dependence, which is important information in data compression [4; 39; 36].

Based on MI metric, we propose a novel method, termed Mutual Information Maximization for Dataset Distillation (MIM4DD). In particular, we first formulate DD as a problem of MI maximization between two datasets. Then, we derive a numerically feasible lower bound and maximize this lower bound via contrastive learning [15; 18; 8]. Finally, we design a highly effective optimization strategy for the dataset distillation task using contrastive estimation for MI maximization. In this way, contrastive learning theoretically leads to the targeted MI maximization and also contributes to the inter-class decorrelation of synthetic samples. In other words, MIM4DD is built upon a contrastive learning framework to synthesize the small dataset, where samples from the synthetic dataset are pulled closer to the counterparts with the identical label in the real dataset, and pulled further away from the ones with different labels in the contrastive space. To the best of our knowledge, it is the first work aiming at MIM of the datasets over the DD task within a contrastive learning framework.

Overall, the contributions of this paper are three-fold: **(i)** To distill information from a large real dataset to a small synthetic dataset under a well-defined metric, we formulate the DD task as an MI maximization problem. To the best of our knowledge, this is the first work to introduce MI into the literature of DD. **(ii)** To maximize the targeted MI, we derive a numerically feasible lower bound and maximize it via contrastive learning. In this way, the heterogeneity in the generated images gets enhanced, which further improves the performance of the DD method. **(iii)** Experimental results show that our method outperforms existing SoTA methods. Importantly, our method can be implemented as a plug-and-play module for existing methods.

## 2 Methodology

In this section, we demonstrate the methodology of Mutual Information Maximization for Dataset Distillation (MIM4DD). Firstly, we briefly revisit the general framework in previous SoTA DD methods, and we illustrate the MI background. Secondly, we model the DD problem within the literature on mutual information maximization (MIM). Then, we convert the targeted but numerical inaccessible MIM goal into a learnable object optimization problem, and solve the problem via a newly designed MIM4DD loss. Finally, we discuss the potential insights of MIM4DD. Note that we only elaborate on the key derivations in this section due to the space limitation; detailed discussions and technical theorems can be found in the supplemental material.

### Preliminaries

**Dataset Distillation.** In short, the goal of dataset distillation (also dubbed dataset condensation) is to synthesize a small training set, \(_{syn}=\{^{j}_{syn},^{j}\}_{j=1}^{M}\) such that models trained on this synthetic dataset can have comparable performance as models (with the same architecture) trained on the large real set, \(_{real}=\{_{real}^{i},^{i}\}_{i=1}^{N}\), in which \(M N\). In this way, after obtaining the targeted synthetic data, the training process of DNNs can be largely accelerated. In this premise, we review some representative DD methods , which generally propose to enforce the behaviors of models trained on real and synthetic datasets to be similar. The core idea can be formalized in a form of an optimization problem:

\[_{syn}^{}=_{_{syn}}_{_{syn}_{syn}}_{_{}_{ real}}(f(_{real};^{}),f(_{syn}; ^{})),\] (2.1)

in which \(^{}\) and \(^{}\) are the learned parameters of networks trained on the real dataset \(_{real}\) and the synthetic dataset \(_{syn}\), respectively; and the distance function \((,)\) is specifically developed to measure the similarity of two networks across datasets. With aligning the networks, one can optimize the synthetic data. Note that designing the distance functions aligning the networks trained on different datasets to optimize the synthetic dataset is the core of previous DD methods, _e.g._, CAFE  uses the MSE distance of feature maps, and MTT  calculates the difference of training trajectories as distance functions.

Although those heuristically designed distance functions lead to promising results, we argue that well-defined metrics in information theory for measuring the amount of shared information between variables have never been considered, as DD is essentially a compression problem with a different emphasis on the information contained in the data.

**Mutual Information and Contrastive Learning.** Mutual information quantifies the amount of information obtained about one random variable by observing the other random variable. It is a dimensionless quantity with (generally) units of bits, and can be considered as the reduction in uncertainty about one random variable given knowledge of another. High mutual information indicates a large reduction in uncertainty and _vice versa_. Strictly, for two discrete variables \(\) and \(\), their mutual information (MI) can be defined as :

\[I(,)=_{x,y}P_{}(x,y)}(x,y)}{P_{}(x)P_{}(y)},\] (2.2)

where \(P_{}(x,y)\) is the joint distribution, \(P_{}(x)=_{y}P_{}(x,y)\) and \(P_{}(y)=_{x}P_{}(x,y)\) are the marginals of \(\) and \(\), respectively.

In the content of DD, we would like them to share as much information as possible. Theoretically, considering the samples in real and synthetic datasets as two random variables, the MI between those two variables should be maximized. Recently, contrastive learning has been proven an effective approach to maximize MI. Many methods based on contrastive loss for self-supervised learning are proposed, such as . These methods are theoretically based on NCE  and InfoNCE . Essentially, the key concept of contrastive learning is to pull representations in positive pairs close and push representations in negative pairs apart in a contrastive space. Thus the major obstacle for modeling problems in a contrastive way is to define the negative and positive pairs. In this work, we also resort to a contrastive learning framework for maximizing our targeted MI. Meanwhile, we illustrate how we formulate DD as a MI maximization problem, and how we solve this targeted problem within the contrastive learning framework.

### MIM4DD: Mutual Information Maximization for Dataset Distillation

In this section, we first formalize the idea of maximizing the MI between the distributions of real and synthesized data, via constructing a contrastive task based on Noise-Contrastive Estimation (NCE). Specifically, we derive a novel MIM4DD loss to distill task-specific information from real data \(_{real}\) to synthetic data \(_{syn}\), where NCE is introduced to avoid the direct MI computation by estimating it with its lower bound in Eq.2.14. From the perspective of NCE, straight-forwardly, the real and synthesized samples from the same class can be pulled close, and samples from different classes can be pushed away, which corresponds to the core idea of contrastive learning.

**Problem Formulation:** Ideally, for variable \(_{real}\) representing the samples in real data and \(_{syn}\) in the synthetic data, we desire to maximize the MI between \(_{real}\) and \(_{syn}\) in terms of \(_{syn}\), _i.e._,

\[\ \ \ _{syn}^{}=_{_{syn}}I( _{real},_{syn}).\] (2.3)In this way, synthetic data \(^{*}_{syn}\) and fixed real data \(^{*}_{real}\) can share maximal information. However, directly approaching this goal is unattainable since the distributions of datasets themselves are absurd to estimate . To encounter this obstacle, let us include the networks trained on real and synthetic datasets. We define those networks in the form of \(K\)-layer Multi-Layer Perceptrons (MLPs). For simplification, we discard the bias term of those MLPs. Then the network \(f()\) can be denoted as:

\[f(^{1},,^{K};)=(^{K} ^{K-1}^{1})(),\] (2.4)

where \(\) is the input sample and \(^{k}:^{d_{k-1}}^{d_{k}}(k=1,...,K)\) stands for the weight matrix connecting the \((k-1)\)-th and the \(k\)-th layer, with \(d_{k-1}\) and \(d_{k}\) representing the sizes of the input and output of the \(k\)-th network layer, respectively. The \(()\) function performs element-wise activation operation on the input feature maps. Based on those predefined notions, the sectional MLP \(f^{k}()\) with the front \(k\) layers of the \(f()\) can be represented as:

\[f^{k}(^{1},,^{k};)=(^{k} ^{1})().\] (2.5)

The \(k\)-th layer's feature maps are \(^{k}_{syn}\) and \(^{k}_{real},(k\{1,,K\})\), where \(^{k}_{syn}=(^{k,1}_{syn},,^{k,M}_{syn})\) and \(^{k}_{real}=(^{k,1}_{real},,^{k,N}_{real})\) can be considered as a series of variables. Specifically, the feature map can be obtained by:

\[^{k,j_{cr}}_{syn}=f^{k}(^{j}_{syn}),\;j\{1,,M\}, ^{k,i_{ex}}_{real}=f^{k}(^{i}_{real}),\;i\{1,, N\}.\] (2.6)

Here, we show the relationship of MI in data \(\) level and in feature maps \(\) level, _i.e._, the relationship between \(I(_{real},_{syn})\) and \(I(_{real},_{syn})\). We utilize the in-variance of MI to understand it. The property can be illustrated as follows:

**Theorem 1** (In-variance of Mutual Information): Mutual information is invariant under the reparametrization of the marginal variables. If \(X^{}=F(X)\) and \(Y^{}=G(Y)\) are homeomorphisms (_i.e._, \(F()\) and \(G()\) are smooth uniquely invertible maps), then

\[I(X,Y)=I(X^{},Y^{}).\] (2.7)

Since each layer's mapping \(^{k}:^{d_{k-1}}^{d_{k}}(k=1,...,K)\) can be considered as the smooth uniquely invertible maps **Theorem 1**. Combining this theorem with the definition of MI in Eq.2.2, we observe that the MI in the targeted data level is equivalent to MI in the feature maps level, _i.e._,

\[I(_{real},_{syn})=I(^{k}_{real},^{k}_ {syn}),(k=1,...,K).\] (2.8)

More details and the proof of this theorem are in Supplemental Materials and .

Facilitated by this property, we are able to access the calculation of MI between real and synthetic datasets via the feature maps of networks trained on those datasets. In other words, Theorem 1 helps us transfer the targeted MI maximization in Eq.2.3 to a reachable MI in Eq.2.8 in the dataset distillation literature, _i.e._,

\[_{_{syn}}_{k=1}^{K}I( ^{k}_{real},^{k}_{syn}),\] (2.9)

in which \(^{k}_{syn}=f^{k}(_{syn})\) and \(^{k}_{real}=f^{k}(_{real})\).

Apart from the theoretical derivation, intuitively, the corresponding variables \((^{k}_{syn},^{k}_{real})\) should share more information, _i.e._, MI of the same layer's output feature maps \(I(^{k}_{syn},^{k}_{real})\)\((k\{1,,K\})\) should be maximized to enforce them mutually dependent. This motivation has also been testified from the perspective of KD  by CRD  and WCoRD . In those methods, the penultimate layer's feature maps of teacher and student are aligned in a contrastive learning manner to enhance the heterogeneity of representations, which can also be explained via MI maximization. However, MI4DD is different from those methods (details is in Related Work).

To optimize the accessible Mutual Information (MI) as defined in Eq.2.9, we incorporate a contrastive learning framework into our targeted Dataset Distillation (DD) task. The fundamental principle of contrastive learning involves comparing varying perspectives of the data, typically under different data augmentations, to compute similarity scores . This framework is suitable for our case, since the activations from real and synthetic datasets can be seen as two different views.

**(Definition: Positive and Negative Samples.)** Let's denote each sample from the real and synthetic datasets as \(\{_{real}^{j_{c_{s}}}\}\)\((j_{c_{r}}\{1,,N\})\) and \(\{_{syn}^{i_{c_{s}}}\}\)\((i_{c_{s}}\{1,,M\})\), respectively. Here, \(c_{r}\) and \(c_{s}\{1,,C\}\) represent the class labels of \(_{real}^{j_{c_{r}}}\) and \(_{syn}^{i_{c_{s}}}\), respectively. We feed two batches of samples from two datasets to two different neural networks and obtain \(N M\) pairs of \(k\)-th layer's activations \((_{syn}^{k,i_{c_{s}}},_{real}^{k,j_{c_{r}}})\), which can further be utilized for the contrastive learning task. We define a pair containing two activations corresponding to the same labels as the positive pair, _i.e._, if \(c_{r}=c_{s}\), \((_{syn}^{k,i_{c_{s}}},_{real}^{k,j_{c_{r}}})_{+}\) and _vice versa_. Consequently, there is \( C= N M\) positive pairs, and thus \((1-) N M\) negative pairs. The key concept of contrastive learning is to discriminate whether a given pair of activation \((_{syn}^{k,i_{c_{s}}},_{real}^{k,j_{c_{r}}})\) is positive or negative. In other words, it involves estimate the distribution \(P(D_{syn}^{k,i_{c_{s}}},_{real}^{k,j_{c_{r}}})\), in which \(D\) is a scalar variable indicating whether \(c_{s}=c_{r}\) or \(c_{s} c_{r}\). Specifically, \(D=1\) when \(c_{s}=c_{r}\), and \(D=0\) when \(c_{s} c_{r}\). However, we can not directly reach the distribution \(P(D_{syn}^{k,i_{c_{s}}},_{real}^{k,j_{c_{r}}})\), and thus we introduce its corresponding variational form:

\[q(D_{real}^{k,j_{c_{r}}},_{syn}^{k,i_{c_{s}}}).\] (2.10)

Intuitively, \(q(D_{real}^{k,j_{c_{r}}},_{syn}^{k,i_{c_{s}}})\) can be treated as a binary classifier, which can classify a given pair \((_{syn}^{k,i_{c_{s}}},_{real}^{k,j_{c_{r}}})\) into positive or negative. Importantly, \(q(D_{real}^{k,i_{c_{s}}},_{syn}^{k,j_{c_{r}}})\) can be estimated by some mature statistical methods, such as NCE  and InfoNCE .

Using the Bayes rule, the posterior probability of two activations from the positive pair can be formalized as:

\[q(D=1_{syn}^{k,i_{c_{s}}},_{real}^{k,j_{c_{r}}})= _{syn}^{k,i_{c_{s}}},_{real}^{k,j_{c_{r}}} D =1)}{q(_{syn}^{k,i_{c_{s}}},_{real}^{k,j_{c_{r }}} D=1)+q(_{syn}^{k,i_{c_{s}}},_{real}^{k,j_{c_{r}}} D=0)}.\] (2.11)

The probability of activations from negative pair is \(q(D=0_{syn}^{k,i_{c_{s}}},_{real}^{k,j_{c_{r}}})=1-q (D=1_{syn}^{k,i_{c_{s}}},_{real}^{k,j_{c_{r}}})\). To simplify the NCE derivative, several works [15; 42; 39] build assumption about the dependence of the variables, we also use the assumption that the activations from positive pairs are dependent and the ones from negative pairs are independent, _i.e._\(q(_{syn}^{k,i_{c_{s}}},_{real}^{k,j_{c_{r}}} D=1)=P( _{syn}^{k,i_{c_{s}}},_{real}^{k,j_{c_{r}}})\) and \(q(_{syn}^{k,i_{c_{s}}},_{real}^{k,j_{c_{r}}} D=0)=P( _{syn}^{k,i_{c_{s}}})P(_{real}^{k,j_{c_{r}}})\). Hence, the above equation can be simplified as:

\[q(D=1_{syn}^{k,i_{c_{s}}},_{real}^{k,j_{c_{r}}})= _{syn}^{k,i_{c_{s}}},_{real}^{k,j_{c_{r}}})}{P( _{syn}^{k,i_{c_{s}}},_{real}^{k,j_{c_{r}}})+P(_ {syn}^{k,i_{c_{s}}})P(_{real}^{k,j_{c_{r}}})(C-1)}.\] (2.12)

Performing logarithm to Eq.2.12 and arranging the terms, we can achieve

\[ q(D=1_{syn}^{k,i_{c_{s}}},_{real}^{k,j_{c_{r}}}) _{syn}^{k,i_{c_{s}}},_{real}^{k,j_{c_{r}}})} {P(_{syn}^{k,i_{c_{s}}})P(_{real}^{k,j_{c_{r}}})}-(C-1).\] (2.13)

Figure 2: Feeding images from two datasets into two corresponding neural networks, and we obtain the three pairs of representations for each layer. We embed the representations into a contrastive space, then learn from the pair correlation with the contrastive learning task in Eq. 2.16. In this way, the heterogeneity in the generated images can be enhanced. Theoretically, we can realize the formulated mutual information maximization (MIM) in Eq. 2.9, which is equivalent to the targeted MIM in Eq. 2.3.

Taking expectation of \(P(_{syn}^{k,i_{c_{s}}},_{real}^{k,j_{c_{r}}})\) on both sides, and combining Eq.2.2, we can transfer the MI into:

\[_{syn}^{k},_{real}^{k})}^{}}(C-1)+_{P(_{syn}^{k,i_{c_{s}}}, _{real}^{k,j_{c_{r}}}|D=1)}^{}[ q(D=1 _{syn}^{k,i_{c_{s}}},_{real}^{k,j_{c_{r}}})]}^{},\] (2.14)

where \(I(_{syn}^{k},_{real}^{k})\) is the MI between the real and synthetic data distributions. Instead of directly maximizing the MI, maximizing the lower bound in the Eq.2.14 is a practical solution.

However, even \(q(D=1^{k,i_{c_{s}}},^{k,j_{c_{r}}})\) is still hard to estimate. Thus, as tackled by many contrastive learning works [29; 18; 2; 39; 36; 37], we introduce a discriminator network \(d(,)\) with parameter \(\) (_i.e._, \(d(_{syn}^{k,i_{c_{s}}},_{real}^{k,j_{c_{r}}};)\)). Basically, the discriminator \(d\) can map \(_{syn}^{k},_{real}^{k}\) to \(\) (_i.e._, distinguish given two samples \(_{syn}^{k},_{real}^{k}\) belonging to positive or negative pair). Specifically, the discriminator function is designed as follows:

\[d(_{syn}^{k,i_{c_{s}}},_{real}^{k,j_{c_{r}}})=((_{syn}^{k,i_{c_{s}}}),g_{}(_{real}^{k,j_{c_{r}}})>}{ })/C,\] (2.15)

in which \(g_{}()\) is the embedding function for mapping the activations into the contrastive space and \(C=(_{syn}^{k,i_{c_{s}}}),g(_{real}^{k,j_{c_{ r}}})>}{})+1\), and \(\) is a temperature parameter that controls the concentration level of the distribution [17; 39].

**Loss Function.** We define the contrastive loss function \(_{NCE}^{k}\) between the \(k\)-th layer's activations \(_{syn}^{k}\) and \(_{real}^{k}\) as: \(_{NCE}^{k}=\)

\[_{q(_{syn}^{k,i_{c_{s}}},_{real}^{k,j_{c_{r}}}| D=1)}[ h(_{syn}^{k,i_{c_{s}}},_{real}^{k,j_{c_{r}}}) ]+(C-1)_{q(_{syn}^{k,i_{c_{s}}},_{ real}^{k,j_{c_{r}}}|D=0)}[(1-h(_{syn}^{k,i_{c_{s}}}, _{real}^{k,j_{c_{r}}}))].\] (2.16)

In the view of contrastive learning, the first term in the above loss function about positive pairs is optimized for capturing more intra-class correlations and the second term of negative pairs is for inter-class decorrelation. Because we construct the pairs instance-wisely, the number of negative pairs can be the size of the entire real dataset, _e.g._, 50K for CIFAR . By incorporating hand-crafted, additional contrastive pairs for the proxy optimization problem in Eq.2.16, the representational quality of generated images can be further enhanced as demonstrated by numerous contrastive learning methods[8; 29; 18; 2].

Finally, by incorporating the set of NCE loss for various layers \(\{_{NCE}^{k}\},(k=1,,K)\), we can then formulate MIM4DD loss \(_{}\) as:

\[_{}=_{k=1}^{K}_{NCE}^{k} }{^{K-1-k}}+_{DD},\] (2.17)

in which \(_{DD}\) can be any loss functions in previous DD methods [40; 43; 5], \(\) is used to control the NCE loss, and \(\) is a scalar greater than \(1\). In practice, we use MTT  or BPTT  as default \(_{DD}\).

### Discussion on MIM4DD

In addition to the theoretical formulation, we are going to provide a more straightforward manifestation of MIM4DD. As illustrated in Fig.2, by embedding the activations to the contrastive space and constructing proper negative-and-positive embedding pairs, we can heterogeneously distill the relevant information from the real dataset to learnable synthetic dataset, and enhance the heterogeneity of the synthetic dataset within the contrastive learning framework as shown in Fig.5. Specifically, networks on different datasets first learn self-supervised information benefited from a large number of the designed pairs [18; 39]. Then, via the backward pass in Fig.2, the synthetic data are updatedw.r.t. this contrastive loss. While the actual number of negative samples in practice can be huge, _e.g._, 50K for synthesizing 10 pictures per-class to replace CIFAR10  despite only drawing two samples in Fig.2.

Furthermore, we give a direct explanation of _why optimizing \(_{}\) in_ Eq.2.17 _can lead to the targeted MIM_ between synthetic dataset and real dataset in Eq.2.3. Firstly, optimizing the formulated contrastive loss in Eq.2.16 is equivalent to maximizing the derived accessible MI between activations in Eq.2.9, as the inequality in Eq.2.14 (Eq.2.10-2.13 can derive Eq.2.14). Secondly, based on Theorem 1 (Eq.A.1) and the property of the networks itself (Eq.2.4 and Eq.2.5), maximizing the accessible MI in Eq.2.9 equals to maximizing the targeted MI in Eq.2.8, which is our goal, to minimize the MI between synthetic dataset and real dataset. Since real data are fixed and synthetic data are learnable, the optimized synthetic dataset can contain as much information as the real dataset under the metric of MI.

## 3 Experiments

In this section, we conduct comprehensive experiments to evaluate our proposed method MIM4DD on four different datasets for DD task. We first describe the implementation details of MIM4DD, and then compare our method with several SoTA DD methods to demonstrate superiority of our proposed method. Finally, we validate the effectiveness of MI module (connected with Eq.2.16 and Eq.2.17) by a series of ablation studies.

### Datasets and Implementation Details

**Datasets.** We use MNIST , SVHN , and CIFAR10/100 datasets to conduct our experiments. **MNIST** is a dataset for handwritten digits recognition that is widely used for validating image recognition models. It contains 60,000 training images and 10,000 testing images with the size of \(28 28\). **CIFAR10/100** are two datasets consist of tiny colored natural images with the size of \(32 32\) from 10 and 100 categories, respectively. In each dataset, 50,000 images are used for training and 10,000 images for testing. More details of the datasets can be found in _Supplemental Materials_.

**Implementation Details.** In the experiments, we optimize synthetic sets with 1/10/50 Images Per Class (IPC) across all three datasets, using a three-layer Convolutional Network (ConvNet) identical to those used in [46; 40; 5]. The ConvNet comprises three consecutive blocks of 'Conv-InstNorm-ReLU-AvgPool.' Each convolutional layer has 128 channels, and AvgPool represents a \(2 2\) average pooling operation with stride 2. The synthetic images' initial learning rate is 0.1, which is halved at the 1,800th and 2,800th iterations. The training is stopped after 5,000 iterations. To test the ConvNet's performance on the synthetic dataset, we train the network on synthetic sets for 300 epochs and assess the performance using five randomly initialized networks. The network's initial learning rate is 0.01. As per , we conduct five experiments and report the mean and standard deviation across the five networks. The default batch size is 256, and \(\) in Eq.2.17 is 0.8. The effect of \(\) is explored in Sec.3.3.

### Comparison with SoTA

We compare MIM4DD with a series of state-of-the-art (SoTA) dataset distillation methods, including Dataset Distillation (DD) , LD , Dataset Condensation (DC) , DC with differentiable siamese augmentation (DSA) , DC with distribution matching (DM) , CAFE , FRePo , TESLA , BPTT , and MTT . We report the performances of our method and comparisons on three datasets in Table 1. Taking into account the overall performance of MIM4DD across these mainstream dataset distillation benchmarks, it's apparent that our method consistently outperforms existing SoTAs. For instance, in the setting of generating 10 images per class, our method delivers top-tier results across all datasets. Additionally, when we synthesize 10 images per class using CIFAR100 as a real-world dataset, our method surpasses MTT by a margin of 1.4%. Importantly, our method can serve as an effective plug-and-play module for existing state-of-the-art DD methods.
We conduct a series of ablation studies of MIM4D in CIFAR-10 and CIFAR100. By adjusting the coefficient \(\) in the loss function \(_{}\) (Eq.2.16 and Eq.2.17), we investigate the effect of MIM4DD loss in synthesizing distilled datasets. The results are shown in Fig.3. We observe the trend that with \(\) increasing, the performance improves, which validates the effectiveness of our designed method. However, when the ratio of \(_{NCE}\) in overall loss is greater than a threshold, the performance of student networks drops, which means the main task, dataset distillation is overlooked in the optimization.

MIM4DD as an Add-on Module.We apply the MIM4DD framework to state-of-the-art Dataset Distillation (DD) techniques, including MTT  and BPTT . The results are presented in Table1. It is observed that MIM4DD effectively enhances the performance of all the tested methods, providing substantial evidence that our approach can be utilized as an add-on module to existing techniques.

**Hyper-parameters and Relative Module Selection.** In addition to ablation studies, we conduct experiments to select the important hyper-parameters and modules. We investigate one hyper-parameter, the co-efficient to adjust the weight of layer in overall loss in Eq.2.17, and one module, the architecture of embedding network in Eq.2.15. The results are in Table 2.

### Regularization Propriety

Here, we analyze the trends of dataset distillation loss, \(_{DD}\) in Eq.2.17 during training. As we presented in Sec. 2.2, the term \(_{DD}\) in Eq.2.17 can be any dataset distillation loss. By controling the co-efficient \(\) in Eq.2.17, we can separately study the DD loss \(_{DD}\). Their training curves are presented in Fig.4. When turning on NCE loss (assigning \(=0.8\)), we observe that the \(_{DD}\) drops using our designed NCE loss (Left), while the corresponding testing performance improves (see Table 1).

    &  &  &  \\  & IPC-1 & IPC-10 & IPC-50 & IPC-1 & IPC-10 & IPC-50 & IPC-1 & IPC-10 \\  Full Set &  &  &  \\  DD  & - & \(79.5 8.1\) & - & - & \(36.8 1.2\) & - & - & - \\ LD  & \(60.9 3.2\) & \(87.3 0.7\) & \(93.3 0.3\) & \(25.7 0.7\) & \(38.3 0.4\) & \(42.5 0.4\) & \(11.5 0.4\) & - \\ CAFE  & \(93.1 0.3\) & \(97.2 0.2\) & \(98.6 0.2\) & \(30.3 1.1\) & \(46.3 0.6\) & \(55.5 0.6\) & \(14.0 0.3\) & \(31.5 0.2\) \\ DM  & \(89.7 0.6\) & \(97.5 0.1\) & \(98.6 0.1\) & \(26.0 0.8\) & \(48.9 0.6\) & \(63.0 0.4\) & \(11.4 0.3\) & \(29.7 0.3\) \\ DSA  & \(88.7 0.6\) & \(97.8 0.1\) & \(99.2 0.1\) & \(28.8 0.7\) & \(52.1 0.5\) & \(60.6 0.5\) & \(16.8 0.2\) & \(32.3 0.3\) \\ DC  & \(91.7 0.5\) & \(97.4 0.2\) & \(98.9 0.2\) & \(28.3 0.5\) & \(44.9 0.5\) & \(53.9 0.5\) & \(12.8 0.3\) & \(25.2 0.3\) \\ DCC  & - & - & - & \(32.9 0.8\) & \(49.4 0.5\) & \(61.6 0.4\) & \(13.3 0.3\) & \(30.6 0.4\) \\ DSAC  & - & - & - & \(34.0 0.7\) & \(54.5 0.5\) & \(64.2 0.4\) & \(14.6 0.3\) & \(33.5 0.3\) \\ FRePo  & \(92.4 0.5\) & \(98.4 0.1\) & \(98.8 0.1\) & \(41.3 0.5\) & \(59.6 0.3\) & \(63.6 0.2\) & \(24.8 0.2\) & \(31.2 0.2\) \\ FRePo-w  & \(93.0 0.4\) & \(98.6 0.1\) & \(99.2 0.4\) & \(46.8 0.7\) & \(55.5 0.4\) & \(71.7 0.2\) & \(28.7 0.1\) & \(42.5 0.2\) \\ MTT  & \(91.4 0.9\) & \(97.3 0.1\) & \(98.5 0.1\) & \(46.3 0.8\) & \(65.3 0.7\) & \(71.6 0.2\) & \(24.3 0.3\) & \(40.1 0.4\) \\ TESLA  & - & - & - & \(48.5 0.8\) & \(66.4 0.8\) & \(72.6 0.7\) & \(24.8 0.4\) & \(41.7 0.3\) \\  MTT  & \(91.4 0.9\) & \(97.3 0.1\) & \(98.5 0.1\) & \(46.3 0.8\) & \(65.3 0.7\) & \(71.6 0.2\) & \(24.3 0.3\) & \(40.1 0.4\) \\ + MIM4DD & \(92.0 0.6\) & \(98.1 0.2\) & \(98.9 0.2\) & \(47.6 0.2\) & \(66.4 0.2\) & \(71.4 0.3\) & \(25.1 0.3\) & \(41.5 0.2\) \\ \(\) & \((0.6)\) & \((0.8)\) & \((0.4)\) & \((1.3)\) & \((1.1)\) & \((0.2)\) & \((0.8)\) & \((1.4)\) \\  BPTT  & \(94.7 0.2\) & \(98.9 0.1\) & \(99.2 0.0\) & \(49.1 0.6\) & \(62.4 0.4\) & \(70.5 0.4\) & \(21.3 0.6\) & \(34.7 0.5\) \\ + MIM4DD & \(95.8 0.3\) & \(98.9 0.1\) & \(99.2 0.1\) & \(51.8 0.3\) & \(66.4 0.8\) & \(72.9 0.5\) & \(25.0 0.4\) & \(38.5 0.6\) \\ \(\) & \((1.1)\) & \((0.0)\) & \((0.0)\) & \((2.7)\) & \((4.0)\) & \((2.4)\) & \((3.7)\) & \((3.8)\) \\  DREAM  & - & - & - & \(51.1 0.3\) & \(69.4 0.4\) & \(74.8 0.1\) & \(29.5 0.3\) & \(46.8 0.7\) \\ + MIM4DD & - & - & - & \(51.9 0.3\) & \(70.8 0.1\) & \(74.7 0.2\) & \(31.1 0.4\) & \(47.4 0.3\) \\ \(\) & - & - & - & \((0.8)\) & \((1.4)\) & \((0.1)\) & \((0.6)\) & \((0.6)\) \\   

Table 1: Dataset distillation methods comparisons. The settings are the same as previous SoTA, BPTT , MTT , and DREAM . Importantly, MIM4DD can work as an add-on module for SoTA methods.

Figure 4: \(_{DD}\) curves while training _

Combining this phenomenon and analysis on the effect of \(\) in Fig. 3, we conclude that our designed MIMADD module can act as a regularization term.

### CKA analysis

We formulate DD in a view of variable distribution, and thus we analyze distributional information flow within layers of neural networks. Centered kernel alignment (CKA) [9; 20; 32] is able to compare activations within or across networks quantitatively. Specifically, for a network fed by \(m\) samples, CKA algorithm takes \(^{m p_{1}}\) and \(^{m p_{2}}\) as inputs which are output activations of two layers (with \(p_{1}\) and \(p_{2}\) neurons respectively). Letting \(^{}\) and \(^{}\) denote the Gram matrices for the two layers CKA computes: \((,)=(,)}{(,)(, )}}\), where \(\) is the Hilbert-Schmidt independence criterion . Given the centering matrix \(=_{n}-^{}\) and the centered Gram matrices \(^{}=\) and \(^{}=\), \(=(^{})(L)}{(m- 1)^{2}}\), the similarity between these centered Gram matrices. Therefore, we employ Centered Kernel Alignment (CKA) to delve into the information interplay between real and synthetic data. Specifically, we input two datasets into two correspondingly trained networks and examine the similarity between the networks' feature maps using CKA. The findings are depicted in Fig.5. The CKA heatmap reveals that the dataset distilled via MIMADD shares more information with the real dataset compared to the MTT . This is because, in our DD formulation, the output similarity is supposed to be highly related to the data similarity (Theorem 1, Eq.A.1).

## 4 Related Work

Dataset Distillation is essentially a compression problem that emphasizes maximizing the preservation of information contained in the data. We argue that well-defined metrics which measure the amount of shared information between variables in information theory are necessary for success measurement but are never considered by previous works. Therefore, we propose introducing a well-defined metric in information theory, mutual information (MI), to guide the optimization of synthetic datasets.

The formulation of our method for DD, MIMADD absorbs the core idea of contrastive learning (_i.e._, constructing the informative positive and negative pairs for contrastive loss) of the existing contrastive learning methods, especially the contrastive KD methods, CRD  and WCoRD . However, our approach has several differences from those methods: (i) our targeted MI and formulated numerical problem are totally different; (ii) our method can naturally avoid the cost of MemoryBank  for the exponential number of negative pairs in CRD and WCoRD, thanks to the small size of the synthetic dataset in our task. (Further details can be found in the Appendix.)

## 5 Conclusion

In this paper, we explore that well-defined metrics which measures the amount of shared information between variables in information theory for dataset distillation. Specifically, we introduce MI as the metric to quantify the shared information between the synthetic and the real datasets, and devise MIMADD numerically maximizing the MI via a newly designed optimizable objective within a contrastive learning framework to update the synthetic dataset.

### In-variance of Mutual Information

**Theorem 1 (In-variance of Mutual Information):** Mutual information is invariant under reparametrization of the marginal variables. If \(X^{}=F(X)\) and \(Y^{}=G(Y)\) are homeomorphisms (_i.e._, \(F()\) and \(G()\) are smooth uniquely invertible maps), then

\[I(X,Y)=I(X^{},Y^{}).\] (A.1)

**Proof.** If \(X^{}=F(X)\) and \(Y^{}=G(Y)\) are homeomorphisms (smooth and uniquely invertible maps), and \(J_{X}=\|}\|\) and \(J_{Y}=\|}\|\) are the Jacobi determinants, then

\[^{}(x^{},y^{})=J_{X}(x^{})J_{Y}(y^{})(x,y)\] (A.2)

and similarly for the marginal densities, which gives

\[I(X^{},Y^{}) = dx^{}dy^{}^{}(x^{},y^{}) (x^{},y^{})}{^{}_{x}(x^{}) ^{}_{y}(y^{})}\] (A.3) \[= dxdy(x,y)(x)_{y}(y)}\] \[=I(X,Y).\]

More details can be found in .

**Discussion on Theorem 1.**

Our objective is to maximize the Mutual Information (MI) between the synthetic dataset and the real dataset (Eq. 3), a task that is numerically unfeasible. To overcome this challenge, we present this theorem. It allows us to transform the target problem at the data level (Eq. 3) into a more manageable problem at the feature map level (Eq. 9). Given that each layer's mapping \(^{k}:^{d_{k-1}}^{d_{k}}(k=1,...,K)\) in the network (as per Eq. 4, 5, and 6) can be treated as smooth, uniquely invertible maps, we can achieve the goal of maximizing the mutual information between the two datasets. This is done by maximizing the mutual information between two sets of down-sampled feature maps.

### Datasets and Implementation Details

#### a.2.1 Datasets

**MNIST** is a dataset for handwritten digits recognition that is widely used for validating image recognition models. It contains 60,000 training images and 10,000 testing images with the size of \(28 28\).

**CIFAR10/100** are two datasets consist of tiny colored natural images with the size of \(32 32\) from 10 and 100 categories, respectively. In each dataset, 50,000 images are used for training and 10,000 images for testing.

#### a.2.2 Implementation Details.

In the experiments, we optimize synthetic sets with 1/10/50 Images Per Class (IPC) across all three datasets, using a three-layer Convolutional Network (ConvNet) identical to those used in . The ConvNet comprises three consecutive blocks of 'Conv-InstNorm-ReLU-AvgPool.' Each convolutional layer has 128 channels, and AvgPool represents a \(2 2\) average pooling operation with stride 2. The synthetic images' initial learning rate is 0.1, which is halved at the 1,800th and 2,800th iterations. The training is stopped after 5,000 iterations. To test the ConvNet's performance on the synthetic dataset, we train the network on synthetic sets for 300 epochs and assess the performance using five randomly initialized networks. The network's initial learning rate is 0.01. As per , we conduct five experiments and report the mean and standard deviation across the five networks. The default batch size is 256, and \(\) in Eq.17 is 0.8. The effect of \(\) is explored in Sec.3.3.

### Synthetic Samples Visualization.

## Appendix B Related Work

**Dataset Distillation** (DD) is firstly introduced by Wang _et al._, in which they optimize the distilled images using gradient-based hyperparameter optimization . The key problem is to optimize the specific-designed metrics of networks on real and synthetic datasets to update the optimizable images. Subsequently, several works significantly improve the results by designing different metrics. For example, Bohdal _et al._and Sucholutsky _et al._ use distance between networks' soft labels; Zhao _et al._ define the gradients of networks as metric; Zhao _et al._ further adopts augmentations to enhance the alignment ability; Wang _et al._ utilize distance of network feature maps as metric; and Cazenavete  propose long-range trajectory to construct the metric function. Lee _et al._ propose Dataset Condensation with Contrastive Signals (DCC) by modifying the loss function to enable the DC methods to effectively capture the differences between classes. On the other hand, researchers take DD as a bi-level optimization problem. For example, Zhou _et al._ employ a closed-form approximation for the unrolled inner optimization; Deng _et al._ revisits the optimization framework in  and observe that the inclusion of a momentum term in inner optimization can significantly enhance performance, leading to state-of-the-art results in certain settings.

DD is essentially a compression problem that emphasizes on maximizing the preservation of information contained in the data. We argue that well-defined metrics which measure the amount of shared information between variables in information theory are necessary for success measurement, but are

Figure 6: **(Left)** Samples from CIFAR10; **(Right)** Samples from Synthetic dataset based on CIFAR10. We observe that the heterogeneity in the generated images enhanced, benefited from the contrastive learning loss (Loss \(_{}\) in Eq.17).

never considered by previous works. Therefore, we propose to introduce a well-defined metric in information theory, mutual information (MI), to guide the optimization of synthetic datasets.

**Contrastive Learning and Mutual Information.** The fundamental idea of all contrastive learning methods is to draw the representations of positive pairs closer and push those of negative pairs farther apart within a contrastive space. Several self-supervised learning methods are rooted in well-established ideas of MI maximization, such as Deep InfoMax , Contrastive Predictive Coding , MemoryBank , Augmented Multiscale DIM , MoCo  and SimSaim . These are based on NCE  and InfoNCE  which can be seen as a lower bound on MI . Meanwhile, Tian _et al._ and Chen _et al._ extend the contrastive concept into the realm of Knowledge Distillation (KD), pulling and pushing the representations of teacher and student.

The formulation of our method for DD, MIMADD also absorbs the core idea (_i.e._, constructing the informative positive and negative pairs for contrastive loss) of the existing contrastive learning methods, especially the contrastive KD methods, CRD  and WCoRD . However, our approach has several differences from those methods: (i) our targeted MI and formulated numerical problem are totally different; (ii) our method can naturally avoid the cost of MemoryBank  for the exponential number of negative pairs in CRD and WCoRD, thanks to the small size of the synthetic dataset in our task. Given that the size of the synthetic dataset \(M\) typically ranges from \(0.1-1\%\) of the size of the real dataset \(N\), the product \(M N\) is significantly smaller than \(N N\) (_i.e._, \(M N N N\)).

**Difference with DCC .** Recently, Lee et al.  introduced Dataset Condensation with Contrastive Signals (DCC), modifying the loss function to allow Dataset Condensation methods to effectively discern differences between classes. However, several distinctions exist between DCC and our method: **(i)** They are motivated differently. Our approach is predicated on information degradation, while DCC hinges on class diversity. **(ii)** From the perspective of contrastive learning, the view, positive and negative samples differ considerably. Our approach can be implemented at the feature map level, thanks to the introduced Theorem 1, while DCC can only be deployed at the gradient level. **(iii)** The performance of our method significantly surpasses that of DCC.

## Appendix C Codes

**Codes can be found anomalously in Supplement.**