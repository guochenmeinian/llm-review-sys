# Mixed Samples as Probes for Unsupervised Model Selection in Domain Adaptation

Dapeng Hu\({}^{1}\) Jian Liang\({}^{3}\) Jun Hao Liew\({}^{2}\) Chuhui Xue\({}^{2}\) Song Bai\({}^{2}\) Xinchao Wang\({}^{1}\)

\({}^{1}\)National University of Singapore \({}^{2}\)ByteDance Inc.

\({}^{3}\)CRIPAC \(\&\) MAIS, Institute of Automation, Chinese Academy of Sciences

Contact: lhxxhb15@gmail.com. Partial work was done during an internship at ByteDance with Song Bai. Corresponding authors: Jian Liang (liangjian92@gmail.com), and Xinchao Wang (xinchao@nus.edu.sg).

###### Abstract

Unsupervised domain adaptation (UDA) has been widely applied in improving model generalization on unlabeled target data. However, accurately selecting the best UDA model for the target domain is challenging due to the absence of labeled target data and domain distribution shifts. Traditional model selection approaches involve training extra models with source data to estimate the target validation risk. Recent studies propose practical methods that are based on measuring various properties of model predictions on target data. Although effective for some UDA models, these methods often lack stability and may lead to poor selections for other UDA models. In this paper, we present MixVal, an innovative model selection method that operates solely with unlabeled target data during inference. MixVal leverages mixed target samples with pseudo labels to directly probe the learned target structure by each UDA model. Specifically, MixVal employs two distinct types of probes: the intra-cluster mixed samples for evaluating neighborhood density and the inter-cluster mixed samples for investigating the classification boundary. With this comprehensive probing strategy, MixVal elegantly combines the strengths of two state-of-the-art model selection methods, Entropy and SND. We extensively evaluate MixVal on 11 UDA methods across 4 adaptation settings, including classification and segmentation tasks. Experimental results consistently demonstrate that MixVal achieves state-of-the-art performance and maintains exceptional stability in model selection. Code is available at https://github.com/LHXXHB/MixVal.

## 1 Introduction

Despite the remarkable achievements of supervised learning in visual recognition tasks [1; 2; 3; 4], deep neural networks face challenges when it comes to generalizing to out-of-distribution data . As for the obstacle of out-of-domain generalization, deep domain adaptation techniques  provide an effective solution by transferring knowledge from a label-rich source domain to a related, yet label-scarce, target domain. Unsupervised domain adaptation (UDA) has drawn significant interest in recent years within the field of computer vision, including image classification [7; 8; 9], semantic segmentation [10; 11; 12], and object detection [13; 14], thanks to its practical setup with completely unlabeled target data. As the UDA landscape continues to evolve, various UDA settings have been explored to consider real-world scenarios, such as variations in category overlaps between domains and concerns related to source data privacy. These settings include closed-set UDA , partial-set UDA [15; 16], open-set UDA , open-partial-set UDA , and source-free UDA [19; 20; 21]. To effectively address these UDA problems, researchers have developed various novel solutions, including cross-domain alignment techniques [7; 9; 22; 11; 12], target-domain regularization methods [23; 24; 25], and self-training strategies in the target domain [26; 27; 20].

Nevertheless, it is worth emphasizing that hyperparameters, including those associated with both the method-specific loss functions and the deep training pipeline, play a critical role in ensuring superior performance of UDA models during deployment. Notably, even the model trained by a state-of-the-art UDA approach can underperform the baseline source-trained model without adaptation if the hyperparameters are not properly set . Surprisingly, the selection of hyperparameters has been largely overlooked in previous UDA studies, as highlighted by You _et al._ and Saito _et al._.

To further fill this research gap, this paper tackles the challenging problem of unsupervised model selection * in domain adaptation. Figure 1(a) illustrates the UDA validation pipeline. During the training stage, we employ different values of a hyperparameter \(\), denoted as \(_{1},_{2},_{3}\), to train corresponding UDA models denoted as \(M_{1},M_{2},M_{3}\). Subsequently, in the validation stage, our objective is to identify the model with the minimal risk on the target domain and determine its associated \(\) value as the optimal choice for the UDA method. Dealing with model selection in UDA presents two primary challenges. On one hand, the absence of labeled target data makes conventional supervised target validation unfeasible. On the other hand, even if we had access to labeled source data, relying solely on the source risk  cannot ensure accurate estimation of the target risk due to domain distribution shifts between domains . Therefore, advanced validation approaches are necessary to ensure accurate model selection in UDA.

Footnote *: Throughout this paper, we use model selection, validation, and hyperparameter selection interchangeably.

Existing validation solutions in UDA can be classified into two types. The first type consists of source-based methods, which include the vanilla baseline of using source risk directly for target validation, denoted as SourceVal . Additionally, Importance-Weighted Cross-Validation (IWCV) and Deep Embedded Validation (DEV)  re-weight the source risk based on density similarity between domains. Reverse Validation (RV)  builds a symmetric UDA task to estimate target risk by reversing the source risk. However, source-based methods require training extra models involving source data and are vulnerable to severe distribution shifts between domains. On the other hand, the second type, target-only validation methods, is more straightforward and only utilizes unlabeled target samples. Entropy , based on the assumption of _low-density separation_, selects the model that produces target predictions with the lowest mean entropy. Soft Neighborhood Density (SND) , which relies on the assumption of _neighborhood consistency_, chooses the model with the highest consistency of predictions within the target neighborhood. While both Entropy and SND outperform source-based methods in certain UDA tasks, they have not fully explored the learned target structure for model selection, leading to instability across various UDA methods.

In this paper, we introduce MixVal, a novel target-only method for model selection in UDA. MixVal leverages mixed target samples as validation probes. To achieve this, MixVal employs _mixup_ with unlabeled target samples and their predictions, generating pseudo-labeled mixed samples. These mixed samples are further categorized into two types, depending on whether _mixup_ is performed intra-cluster or inter-cluster. MixVal takes a novel strategy by evaluating inference-stage interpolation consistency for both types of mixed samples. Compared to Entropy and SND, MixVal innovatively employs mixed samples for probing the target structure, rather than directly measuring certain properties of target predictions. Moreover, MixVal elegantly combines the advantages of both Entropy and SND. On one hand, MixVal employs intra-cluster mixed samples to evaluate neighborhood density, leveraging the _neighborhood consistency_ assumption utilized in SND. On the other hand, it utilizes inter-cluster mixed samples to evaluate the classification boundary, considering the _low-density separation_ assumption used in Entropy. The novel probing allows MixVal to benefit from the strengths of both assumptions, making it a competitive UDA model selection method.

**Our main contributions** are highlighted as threefold:

* We study the significant yet under-explored model selection problem in UDA, providing comprehensive empirical evaluations of existing validation baselines.
* We introduce MixVal, a novel target-only validation method that directly probes the target structure using mixed samples. MixVal combines the strengths of both SND and Entropy through novel consistency-based probing with inter-cluster and intra-cluster mixed samples.
* We conduct extensive experiments to evaluate MixVal's effectiveness in model selection across various UDA settings, including closed-set UDA, partial-set UDA, open-partial-set UDA, and source-free UDA. The results highlight MixVal's exceptional stability and superior performance in UDA model selection compared to existing baselines.

## 2 Related Work

### Unsupervised Domain Adaptation

Domain adaptation aims to leverage labeled source domains to facilitate transductive learning in a label-scarce target domain . Unsupervised domain adaptation (UDA), which assumes that the target domain is entirely unlabeled, has gained significant attention due to its practical nature. Many traditional methods have been proposed to address UDA [35; 36; 37; 38]. In recent years, deep learning-based UDA methods have witnessed significant progress, with domain adversarial learning emerging as a popular approach. Adversarial domain adaptation has been explored at multiple levels, including input-level , feature-level [7; 15; 9], prediction-level [11; 22], and entropy-level . Additionally, there has been growing interest in adapting UDA models with a specific focus on the leverage of target data, leading to explorations in techniques such as target clustering [40; 27; 41] and target output regularization [24; 25]. Notably, Xu _et al._ proposed a feature-level regularization approach that diverges from the popular mainstream methods. These UDA methods primarily address conventional scenarios that require source data for adaptation. More recently, a practical variant called source-free UDA has gained increasing attention [19; 20], where adaptation relies solely on the source-trained model. To comprehensively compare different validation approaches, we conduct hyperparameter selection for various representative UDA methods across diverse UDA settings.

### Model Selection in Unsupervised Domain Adaptation

Model selection in UDA poses a significant challenge due to the absence of labeled target data and the presence of domain distribution shifts between domains. Some pioneering efforts have been made to address this issue. Ganin _et al._ initially introduced the estimation of the unavailable target risk using source risk for target-domain validation (SourceVal). However, SourceVal is susceptible to severe domain shifts. Later, Ganin _et al._ proposed Reverse Validation (RV), which considers a symmetric UDA problem from target to source and employs the reversed source risk for validation. Sugiyama _et al._ introduced Importance-Weighted Cross-Validation (IWCV), which estimates the target risk by re-weighting the source risk based on input-level domain similarity. You _et al._ further proposed Deep Embedded Validation (DEV), which considers feature-level similarity and controls variance in IWCV. While these source-based methods have proven effective, their practical applicability is limited by the need of extensive model training, access to source data, and the challenge of dealing with severe domain shifts. Consequently, recent efforts have shifted towards target-only validation methods, which rely solely on unlabeled target data. Morerio _et al._ pioneered the use of mean entropy (Entropy) of target predictions for validation, considering the assumption of _low-density separation_. Musgrave _et al._ introduced the Information Maximization (InfoMax) score, which further considers _class diversity_ in addition to Entropy. Tu _et al._ introduced Corr-C, which prioritizes predictions with both large _class diversity_ and high confidence. However, _class diversity_ serves as a strict prior that is unsuitable for UDA scenarios with label shift . Saito _et al._ introduced Soft Neighborhood Density (SND), the state-of-the-art target-only validation method that prioritizes high _neighborhood consistency_. SND has demonstrated that target-only validation can outperform source-based methods, including IWCV and DEV. We also align with the research line of target-only validation, which offers simplicity and adaptability across various UDA settings. Table 1 showcases a comparison of how our method MixVal differs from other target-only validation methods in terms of the consideration of common assumptions.

   Validation Method &  _neighborhood_ \\ _consistency_ \\  &  no prior of \\ _class diversity_ \\  & 
 _low-density_ \\ _separation_ \\  \\  Entropy  & ✗ & ✓ & ✓ \\ InfoMax  & ✗ & ✗ & ✓ \\ SND  & ✓ & ✓ & ✗ \\ Corr-C  & ✗ & ✗ & ✓ \\ MixVal & ✓ & ✓ & ✓ \\   

Table 1: Comparison of assumptions considered in validation methods using target data.

### Mixup

_Mixup_, a data augmentation technique originally proposed by Zhang _et al._, is used during model training to improve generalization. _Mixup_ has been extended to different levels, such as feature-level , patch-level , and token-level . In addition to supervised learning, _mixup_ has been successfully applied in semi-supervised learning [48; 49] and domain adaptation [50; 51; 52]. Unlike existing studies that consider _mixup_ as a small perturbation to regularize model training, we employ _mixup_ to generate in-between probing samples for model evaluation.

## 3 Methodology

### Problem Setting

**Unsupervised domain adaptation (UDA).** We begin by introducing the UDA problem with a \(K\)-way image classification task, easily extendable to semantic segmentation tasks. In this setup, we are provided with a labeled source domain \(_{}=\{(x_{}^{i},y_{}^{i})\}_{i=1}^{ n_{}}\) consisting of \(n_{}\) labeled images \(x_{}\) with their corresponding labels \(y_{}\), and an unlabeled target domain \(_{}=\{x_{}^{i}\}_{i=1}^{n_{}}\) containing \(n_{}\) unlabeled images \(x_{}\). Here, \(x_{}\) and \(x_{}\) represent image vectors, and \(y_{}\) are one-hot ground truth labels. The objective of UDA is to learn a discriminative model \(M\) using \(_{}\) and \(_{}\), which can accurately predict the target labels \(\{y_{i}^{i}\}_{i=1}^{n_{}}\) for the corresponding target images \(\{x_{i}^{i}\}_{i=1}^{n_{}}\), under covariate shift  or label shift  between domains. Each image vector \(x^{d}\) in the input space is associated with a one-hot pseudo label encoding, denoted as \(^{K}\), which is predicted by model \(M\). We denote \(|_{}|=K\) as the number of categories in the source domain and \(|_{}|\) as that in the target domain. Besides the vanilla UDA, which refers to closed-set UDA where both domains share the same label space (\(_{}=_{}\)), we also investigate other challenging UDA settings to evaluate the versatility of model selection approaches. These include partial-set UDA , where the source domain contains more categories than the target domain (\(_{}_{}\)), and open-partial-set UDA , where both domains have overlapping but not identical labels (\(_{}_{}\), \(_{}_{}\), \(_{}_{}\)).

Traditional UDA settings [34; 6; 15; 53] typically require simultaneous access to source and target data for effective target adaptation. The general optimization objective can be represented as follows:

\[_{}=_{}(M;_{})+_{}(M;_{},_{ },).\]

Here, \(_{}\) is the cross-entropy loss with labeled source data, and \(_{}\) denotes the adaptation loss that adapts the training of model \(M\) to unlabeled target data. The scalar coefficient \(\) is a common type of hyperparameter, and \(\) is a hyperparameter specific to the adaptation loss. Additionally, there are other training-related hyperparameters, such as learning rate, iterations, and network architecture.

Recently, source-free unsupervised domain adaptation (SFUDA) [19; 20] has gained significant attention in the research community. Unlike traditional UDA, SFUDA decouples the source supervised learning and unsupervised target adaptation into two sequential stages. The target adaptation stage in SFUDA is typically guided by the following objective function:

\[_{}=_{}(M;M_{}, _{},).\]

Here, \(M_{}\) represents the source pre-trained model. During the target adaptation stage, a target model \(M\) is learned with access to the source model \(M_{}\) and unlabeled target data \(\{x_{}^{i}\}_{i=1}^{n_{}}\).

**Model selection.** In UDA, the goal of model selection is to pinpoint the hyperparameter configuration that offers the best performance on unlabeled target data. For example, let's consider the hyperparameter \(\), with a set of possible values \(\{_{i}\}_{i=1}^{m}\), where \(m\) is the number of candidate values. We proceed to train \(m\) distinct models \(\{M_{i}\}_{i=1}^{m}\), each employing a different \(\) value. Our aim is to identify the model \(M\) that delivers the highest performance on \(_{}\) among all candidate UDA models \(\{M_{i}\}_{i=1}^{m}\), thus determine the optimal hyperparameter value. Figure 1(a) visually illustrates this process, using \(3\) as the value for \(m\). Model selection in UDA confronts two key challenges. Firstly, the absence of labeled target data renders traditional supervised validation methods, such as using a hold-out dataset , unfeasible. Secondly, the presence of severe domain distribution shifts between domains poses a risk when using source data for selecting the best model for the target data. Additionally, concerns about source data privacy can limit direct source data utilization.

### MixVal: Mixed Samples as Probes for Unsupervised Validation

**Motivation.** While existing target-only model selection methods [42; 29] have demonstrated competitive performance, they sometimes result in extremely poor selections when applied to different UDA methods and datasets, even within the standard closed-set UDA scenario. This phenomenon is substantiated by a comprehensive large-scale empirical study conducted by Musgrave _et al._. We highlight two common limitations in existing target-only validation methods that potentially hinder their ability to generalize across various UDA scenarios. First, these methods primarily rely on raw target predictions to calculate specific metrics for evaluating the learned target structure. However, it's important to note that these target data have already been utilized during the transductive model training. Second, while both the assumptions of _low-density separation_ and _neighborhood consistency_ are effective for model selection, existing validation methods often design their metrics based solely on one of these assumptions, as summarized in Table 1.

To address these limitations, we present MixVal, a target-only validation method that thoroughly evaluates the target structure through the use of mixed samples. We employ the _mixup_ technique  to create novel in-between target samples. These mixed samples are then used for consistency evaluation to probe the learned target structure. With two distinct types of mixed samples, we ensure a comprehensive assessment of the target structure acquired by each candidate UDA model.

**Generation of mixed samples.** We first generate a labeled set of mixed samples using _mixup_ with unlabeled target data and inference-stage UDA models. Specifically, we create a mixed sample \(x_{}\) and its label \(y_{}\) by performing a convex combination of a pair of target samples \(x_{}^{i},x_{}^{j}\) and their corresponding pseudo labels \(_{}^{i},_{}^{j}\) which are predicted by the UDA model. The process of mixed sample generation is formulated as follows:

\[x_{}=*x_{}^{i}+(1-)*x_{}^{j},  y_{}=*_{}^{i}+(1-)*_ {}^{j}.\]

where \(\) is a scalar used for interpolation, and \(_{}^{i}\) and \(_{}^{j}\) denote the one-hot pseudo label encodings. By performing _mixup_ on random target samples for a single epoch in the inference stage, we generate a set of mixed samples \(\{(x_{}^{i},y_{}^{i})\}_{i=1}^{n_{}}\), where \(n_{}\) represents the total number.

**Interpolation consistency evaluation.** Next, we leverage each candidate UDA model to infer labels for all mixed samples, resulting in predicted labels \(\{_{}^{i}\}_{i=1}^{n_{}}\). Using both the mixed labels \(\{y_{}^{i}\}_{i=1}^{n_{}}\) and predicted labels, we assess the accuracy of mixed samples for each candidate model. This assessment yields the Interpolation Consistency Evaluation (ICE) score, defined as follows:

\[=(\{y_{}^{i}\}_{i=1}^{n_{} },\{_{}^{i}\}_{i=1}^{n_{}}).\]

For all UDA models \(\{M_{i}\}_{i=1}^{m}\), we apply the same _mixup_ operation to generate identical mixed samples, but the mixed labels differ because model predictions for target samples vary among different models. We subsequently calculate the ICE score for each candidate model \(M_{i}\), yielding a set of ICE scores \(\{_{i}\}_{i=1}^{m}\). The candidate model with a higher ICE score is deemed superior.

Figure 1: Overview of the proposed method (MixVal) for model selection in UDA.

**MixVal via two types of probes.** Through a meticulous analysis of the _mixup_ operation applied to unlabeled target samples and their pseudo labels, we have identified two distinct categories of mixed samples, as illustrated in Figure 1(b). The first type involves mixing target samples with the same pseudo label, referred to as intra-cluster _mixup_. When we evaluate the ICE score after performing intra-cluster _mixup_, we effectively measure the neighborhood density within each cluster. A higher ICE score indicates a higher level of _neighborhood consistency_. Conversely, the second type involves mixing target samples with different pseudo labels, termed inter-cluster _mixup_. By evaluating the ICE score in this context, we can assess the classification margin between clusters. A higher ICE score in inter-cluster _mixup_ signifies a larger margin of the classification boundary, indicating _low-density separation_. For comprehensive probing, MixVal uses both types of mixed samples as probes. It separately ranks all candidate models in ascending order based on each type of ICE score. Then, MixVal takes the average rank from both rankings to select the candidate model with the highest average rank. Kindly refer to Appendix A for the pseudocode of MixVal.

**Connection to interpolation consistency training.** We provide a comprehensive comparison between our MixVal approach and interpolation consistency training (ICT), a commonly used technique in semi-supervised learning . While our ICE score draws inspiration from ICT, there are three significant distinctions between MixVal and ICT. ICT primarily employs inter-cluster _mixup_ as a minor training perturbation to regularize model learning with unlabeled data. In contrast, MixVal explicitly applies _mixup_ to create in-between target samples, encompassing both inter-cluster and intra-cluster scenarios, during the inference stage without requiring model re-training.

## 4 Experiments

### Setup

**Datasets.** For image classification tasks, we consider 4 popular UDA benchmarks of varied scales. _Office-31_ is a classic domain adaptation benchmark consisting of 31 object categories across 3 domains: Amazon (A), DSLR (D), and Webcam (W). _Office-Home_ is a challenging benchmark with 65 different object categories in 4 domains: Art (Ar), Clipart (Cl), Product (Pr), and Real-World (Re). _VisDA_ is a large-scale benchmark for the synthetic-to-real object recognition task, featuring 12 categories. It consists of a training (T) domain with 152k synthetic images and a validation (V) domain with 55k realistic images. _DomainNet_ is a recent large-scale benchmark comprising approximately 600k images across 345 categories in 6 distinct domains. For evaluation, we focus on a subset of 126 classes with 7 tasks  from 4 domains: Real (R), Clipart (C), Painting (P), and Sketch (S). For semantic segmentation tasks, we use the synthetic _GTAV_ dataset as the source domain and the real-world _Cityscapes_ dataset as the target domain.

**UDA methods.** We use the validation baselines discussed in Section 2.2 to conduct model selection for various UDA methods, with a specific emphasis on the practical target-only baselines. For closed-set UDA, we consider ATDOC , BNM , CDAN , MCC , MDD , SAFN , DMRL , AdaptSeg , and AdvEnt . For partial-set UDA, we consider PADA  and SAFN . For source-free UDA, we consider SHOT . For open-partial-set UDA, we consider DANCE . For ATDOC, BNM, CDAN, PADA, SAFN, SHOT, DMRL, and DANCE, we select the loss coefficient among 7 varied candidate values. For MDD, we validate the margin factor, while for MCC, we validate the temperature. For AdaptSeg and AdvEnt, we validate both the loss coefficient and training iteration. For MCC and MDD, we also include a two-hyperparameter validation task, where the bottleneck dimension is considered as an additional hyperparameter, with 4 possible values. Kindly refer to Appendix B for details of hyperparameter settings.

**Implementation details.** We utilize the Transfer Learning Library2 to train UDA models on a single RTX TITAN 16GB GPU. The batch size is set to 32, and the total number of iterations is set to 5,000. We save the final model as a checkpoint. For _VisDA_ and _GTAV2Cityscapes_, we use ResNet-101 , for _DomainNet_, we use ResNet-34 , and for the other benchmarks, we use ResNet-50 . Regarding SND , we employ the official implementation. For source-based methods, we split \(80\%\) of the source data as the training set and the remaining \(20\%\) as the validation set. In our MixVal approach, we use a fixed value of \(\) to ensure a fair comparison among candidate models. Specifically, we set \(=0.55\) for all experiments, which allows us to probe with in-between samples.

### Results

We report MixVal's validation performance as averages from three random runs. In the tables, 'Best' signifies the optimal selection, and 'Worst' represents the worst one. For brevity, we report average results for tasks with the same target domain. Kindly refer to Appendix D for detailed results.

**Closed-set UDA.** We begin by comparing the performance of validation baselines within the standard closed-set UDA scenario. Specifically, we report the results for both source-based and target-only validation methods across several well-established UDA benchmarks. Table 2 provides the results on the medium-scale benchmark _Office-Home_, while Table 3 presents the results on the small-scale benchmark _Office-31_ and the large-scale benchmark _VisDA_. Furthermore, Table 4 presents the results

    &  &  &  &  \\  & \(\) C & \(\) P & \(\) R & \(\) S & avg & \(\) C & \(\) P & \(\) R & \(\) S & avg & \(\) C & \(\) P & \(\) R & \(\) S & avg \\  Entropy  & **67.09** & **65.80** & **74.42** & **59.34** & **66.66** & 63.36 & 64.28 & 74.31 & 48.69 & **62.66** & 63.75 & 61.85 & **79.60** & 52.17 & 64.34 \\ InfoMax  & **67.09** & **65.80** & **74.42** & **59.34** & **66.66** & 67.05 & 64.28 & 74.31 & 48.57 & 65.67 & 65.33 & 63.75 & 61.85 & **79.60** & 52.17 & 64.34 \\ SND  & **67.99** & 64.68 & **74.42** & **59.34** & 66.38 & 56.56 & 54.50 & 74.31 & 42.37 & 56.93 & 63.75 & 61.85 & **79.60** & 52.17 & 64.34 \\ Corr-C  & 75.35 & 62.88 & **74.42** & 54.63 & 62.32 & 59.75 & 63.41 & 77.62 & 42.37 & 60.79 & 59.98 & 62.27 & 74.42 & 53.69 & 62.59 \\ MixVal & **67.09** & **65.80** & **74.22** & **59.34** & **66.66** & **67.84** & **64.00** & **78.68** & **58.49** & **67.85** & **68.94** & **68.44** & **68.44** & **79.60** & **61.73** & **69.68** \\  Worst & 57.35 & 60.76 & 73.44 & 51.41 & 60.74 & 55.79 & 54.50 & 74.31 & 42.37 & 56.74 & 59.98 & 61.85 & 74.42 & 47.00 & 60.81 \\ Best & 67.09 & 65.80 & 74.44 & 59.34 & 66.66 & 67.86 & 66.50 & 78.68 & 58.49 & 67.88 & 70.30 & 68.44 & 80.38 & 62.23 & 70.34 \\   

Table 4: Validation accuracy (\(\%\)) of closed-set UDA on _DomainNet_.

    &  &  &  \\  & \(\)A & \(\)D & \(\)P & \(\)R & avg & \(\)A & \(\)D & \(\)P & \(\)R & avg & \(\)A & \(\)D & \(\)P & \(\)R & avg \\  SourceVal & 66.63 & 52.54 & 78.57 & 66.18 & **68.59** & 62.44 & 50.74 & 77.53 & 74.76 & 66.35 & 55.00 & 42.65 & 69.90 & 58.61 & 85.99 \\ IWCV  & 67.97 & 54.03 & 78.31 & 79.26 & 68.93 & 66.56 & 48.16 & 74.09 & 73.28 & 68.52 & 63.11 & 42.67 & 61.71 & 71.93 & 60.41 \\ DEV  & 67.39 & 54.23 & 77.78 & 79.39 & 69.70 & 67.56 & 56.39 & 73.92 & 75.93 & 64.81 & 67.23 & 57.04 & 68.76 & 76.91 & 67.48 \\ RV  & **68.65** & 66.13 & **79.39** & **76.08** & **70.85** & **62.56** & **76.78** & **78.86** & **77.04** & **67.66** & 56.74 & 76.01 & 76.78 & 69.52 \\ Entropy  & 63.67 & 55.83 & 76.54 & 78.36 & 68.00 & 62.85 & 54.94 & 71.56 & 68.14 & 67.66 & 57.56 & 76.37 & 77.45 & 69.76 \\ IndMax  & 63.67 & 56.53 & 76.14 & 78.36 & 68.02 & 68.49 & 74.15 & 77.64 & 68.16 & 67.66 & 57.56 & 76.37 & 77.45 & 69.76 \\ SND  & 63.67 & 56.53 & 76.54 & 77.54 & 68.44 & 68.28 & 54.49 & 71.56 & 68.14 & 67.94 & 57.56 & **76.96** & 77.68 & **70.04** \\ Corr-C  & 63.51 & 50.90 & 73.39 & 78.38 & 65.24 & 58.10 & 83.45 & 67.89 & 70.59 & 60.26 & 53.84 & 41.21 & 64.96 & 67.65 & 56.91 \\ MaxVal & 66.47 & **56.78** & 78.14 & 79.20 & 20.17 & 63.76 & 56.36 & 56.18 & 76.10 & 78.12 & 69.44 & 67.71 & **57.78** & 76.89 & **77.76** & 70.00 \\  Worst & 62.89 & 50.39 & 78.99 & 73.89 & 68.25 & 58.10 & 45.37 & 68.97 & 70.59 & 60.75 & 53.80 & 41.21 & 64.78 & 67.65 & 68.91 \\ Best & 66.97 & 58.35 & 60.27 & 80.85 & 72.04 & 68.93 & 57.51 & 68.97 & 70.59 & 60.75 & 53.80 &of practical target-only validation baselines on the large-scale benchmark _DomainNet_. The current state-of-the-art source-based baseline is DEV , and for target-only methods, SND  holds the state-of-the-art position. Nonetheless, our observations differ from previous findings. When considering the averaged validation accuracy across 6 popular UDA methods, we note that RV consistently outperforms other source-based validation methods across three benchmarks. Regarding target-only validation methods, entropy-based approaches like Entropy and InfoMax prove to be competitive, particularly demonstrating a significant advantage over SND on the _Office-Home_ benchmark. As expected, our MixVal consistently attains the highest average accuracy across all four benchmarks, surpassing the vanilla SourceVal baseline, while most existing validation methods may noticeably underperform in comparison to this baseline. Notably, MixVal demonstrates exceptional performance on large-scale benchmarks such as _VisDA_ and _DomainNet_, approaching the upper bound of 'Best' and outperforming the second-best method by substantial margins. MixVal's consistent advantages in closed-set UDA highlight its effectiveness in this widely studied setting.

**Partial-set UDA.** Following , we assess validation performance in partial-set UDA, a scenario with label shifts between domains. We validate two representative partial-set UDA methods, PADA and SAFN, and present the validation accuracy of _Office-Home_ in Table 5. We observe that MixVal consistently outperforms all other validation baselines, maintaining performance close to the 'Best'. However, we notice some differences in comparison to closed-set UDA. Specifically, SND achieves more stable validation performance than Entropy, because Entropy can be susceptible to structure collapse . Second, methods emphasizing 'class diversity', such as InfoMax and Corr-C, often yield lower results than SourceVal. Additionally, RV consistently underperforms SourceVal in scenarios without symmetric label distribution, making it unsuitable for UDA with label shifts.

**Open-partial-set UDA.** We extend our evaluation of UDA scenarios with label shifts, conducting validation for a popular open-partial-set UDA method, DANCE. Table 6 presents the HOS [62; 63] results on _Office-Home_. MixVal consistently provides strong validation performance, nearing the 'Best', while other validation baselines tend to align with the 'Worst'.

**Source-free UDA.** Finally, we compare the target-only validation baselines in source-free UDA. We conduct validation for a popular method, SHOT, and report the accuracy of _Office-31_ and _VisDA_ in Table 6. We find that MixVal consistently outperforms other baselines in this practical setting.

### Analysis

**Influence of pseudo label quality.** Because MixVal utilizes pseudo labels of target data for the _mixup_ operation, it is crucial to assess the impact of pseudo label quality. When examining UDA tasks with

    &  &  &  &  &  \\  & \(\)Ar & \(\)Cl & \(\)Pr & \(\)Re & avg & \(\)Ar & \(\)Cl & \(\)Pr & avg & T\(\)V \\  Entropy  & 32.00 & 39.48 & 27.52 & 38.08 & 34.27 & 71.67 & 90.76 & 88.68 & 83.70 & 82.65 \\ InfoMax  & 32.00 & 39.48 & 27.52 & 38.01 & 34.25 & 71.67 & 90.76 & 88.68 & 83.70 & 82.65 \\ SND  & 15.05 & 4.33 & 27.55 & 16.79 & 14.98 & 71.67 & 90.76 & 88.68 & 83.70 & 82.65 \\ Corr  & 29.60 & 4.33 & 27.55 & 16.79 & 18.62 & 71.58 & 90.76 & 90.19 & 84.18 & 82.65 \\ MixVal & **71.54** & **52.90** & **78.61** & **65.01** & **67.01** & **72.04** & **92.37** & **92.32** & **85.58** & **83.12** \\  Worst & 15.05 & 4.33 & 15.17 & 16.79 & 12.84 & 71.56 & 90.76 & 88.68 & 83.67 & 80.57 \\ Best & 77.01 & 66.29 & 78.81 & 69.81 & 72.98 & 75.66 & 94.78 & 93.33 & 87.72 & 83.12 \\   

Table 6: HOS (\(\%\)) of open-partial-set UDA and accuracy (\(\%\)) of source-free UDA.

    &  &  \\  & \(\)Ar & \(\)Cl & \(\)Pr & \(\)Re & avg & \(\)Ar & \(\)Cl & \(\)Pr & \(\)Re & avg \\  SourceVal & 57.21 & 41.90 & 64.48 & 71.89 & 58.67 & 54.51 & 74.41 & 76.48 & 68.11 \\ IWCV  & 59.65 & 05.51 & 68.42 & 72.96 & 62.49 & 69.36 & 53.39 & 71.78 & 76.38 & 67.86 \\ DEV  & 66.88 & 49.29 & 72.40 & 70.46 & 64.76 & 69.36 & 54.94 & 73.95 & 76.66 & 68.58 \\ RV  & 57.79 & 40.87 & 63.87 & 60.78 & 53.84 & 69.89 & 52.74 & 72.83 & 77.14 & 67.92 \\  Entropy  & 60.08 & 46.51 & 53.16 & 62.47 & 55.56 & **71.75** & 55.62 & 76.36 & 76.59 & 70.08 \\ InfoMax  & 60.08 & **51.40** & 60.20 & 66.67 & 59.59 & 63.67 & 51.74 & 69.64 & 73.62 & 64.67 \\ SND  & **67.80** & 50.71 & 59.46 & 67.13 & 61.27 & **71.55** & 51.74 & 76.36 & 78.36 & 69.55 \\ Corr  & 61.34 & 45.65 & 54.90 & 62.25 & 56.04 & 71.23 & 55.70 & 76.94 & **79.13** & 70.75 \\ MixVal & 67.68 & 51.01 & **72.94** & **78.64** & **67.57** & 71.70 & **57.91** & **77.08** & 78.94 & **71.41** \\  Worst & 56.29 & 39.76 & 50.49 & 59.31 & 51.46 & 62.48 & 49.91 & 68.50 & 73.62 & 63.63 \\ Best & 69.33 & 55.86 & 74.55 & 79.59 & 69.83 & 73.37 & 58.09 & 77.35 & 79.33 & 72.03 \\   

Table 5: Validation accuracy (\(\%\)) of partial-set UDA on _Office-Home_.

low-quality pseudo labels (around \(50\%\) accuracy), such as the results of '\(\) Cl', it becomes evident that MixVal consistently maintains stable validation performance.

**Influence of consistency evaluation.** MixVal utilizes image-level _mixup_-based consistency evaluation for the target probing. To gain a deeper understanding of its role in MixVal, we substitute it with other consistency evaluation techniques, including instance-based augmentations such as RandAug  and SSLAug , as well as _mixup_ at other levels, such as CutMix  and FeatMix . The results in Figure 2(a) consistently demonstrate that image-level _mixup_ outperforms other strategies.

**Two-hyperparameter validation.** We further evaluate all validation baselines in challenging tasks that involve two hyperparameters. Quantitative comparisons in Table 7 consistently position MixVal as one of the top-performance validators. Qualitative comparisons in Figure 2(b) clearly illustrate that MixVal scores demonstrate a strong correlation with actual accuracy, whereas SND  scores exhibit noticeable deviation, resulting in selections far from optimal.

**Validation of _mixup_-based UDA method.** The ICE score of MixVal is based on the evaluation of _mixup_-based interpolation consistency during the inference stage. To assess MixVal's robustness, we apply it in the validation of the UDA method DMRL , which incorporates _mixup_-based consistency training within the target domain and across two domains at the same time. MixVal is employed to determine the optimal consistency loss coefficient for DMRL, and the results are reported in Table 8. Notably, MixVal consistently outperforms most of the existing target-only validation baselines, even when subjected to the 'attack' posed by specialized UDA model training.

    &  &  \\  & Ar \(\) Cl & Pr \(\) Re & Re \(\) Ar & avg & Ar \(\) Cl & Cl \(\) Pr \(\) Re & Re \(\) Ar & avg \\  SourceVal & 55.99 & 73.15 & 78.77 & 69.39 & 69.33 & 57.91 & 76.84 & 81.13 & 72.89 & 72.19 \\ IWCV  & 37.89 & 72.92 & 80.42 & 58.43 & 62.42 & 46.09 & 77.74 & 80.68 & **74.45** & 69.74 \\ DEV  & 52.60 & 72.11 & 53.36 & 67.70 & 61.44 & 59.47 & 76.84 & 81.94 & 74.08 & 73.08 \\ RV  & **57.59** & 72.25 & **80.83** & 70.79 & 70.37 & 59.13 & 76.84 & 82.03 & 71.98 & 72.50 \\  Entropy  & 57.21 & **73.19** & 80.06 & **72.31** & 70.69 & 59.75 & 77.77 & 82.37 & 74.33 & 73.56 \\ InfoMax  & **57.59** & 72.92 & 80.06 & **72.31** & **70.2** & 59.70 & **78.73** & **82.58** & 70.33 & 72.84 \\ SND  & 38.10 & 56.45 & 70.03 & 65.10 & 57.42 & 53.49 & 74.97 & 77.25 & 74.12 & 69.96 \\ Corr-C  & 30.17 & 44.74 & 57.15 & 50.76 & 45.71 & 44.90 & 56.75 & 74.32 & 67.61 & 60.90 \\ MixVal & 55.99 & 72.63 & 80.27 & 72.12 & 70.25 & **60.08** & 78.52 & 81.95 & 74.43 & **73.75** \\  Worst & 30.17 & 39.81 & 53.36 & 50.76 & 43.53 & 43.02 & 56.75 & 73.47 & 67.24 & 60.12 \\ Best & 57.59 & 73.35 & 80.93 & 72.52 & 71.10 & 61.10 & 78.94 & 83.04 & 75.36 & 74.61 \\   

Table 7: Two-hyperparameter validation accuracy (\(\%\)) of closed-set UDA on _Office-Home_.

    &  &  &  &  \\  & \(\)Ar & \(\)Cl & \(\)Pr & \(\)Re & avg & \(\)A & \(\)D & \(\)D & \(\)W & avg \\  Entropy  & 58.14 & 50.25 & 69.06 & 71.37 & 62.20 & 63.67 & 80.52 & **86.67** & 76.95 \\ InfoMax  & 58.14 & **50.75** & 69.06 & 71.37 & 62.33 & 63.67 & 80.52 & **86.67** & 76.95 \\ SND  & 57.74 & 49.96 & **69.28** & 71.42 & 62.10 & 61.84 & **84.14** & **86.67** & 77.55 \\ Corr-C  & 58.29 & 49.46 & 68.67 & 71.73 & 62.04 & 60.23 & 77.51 & 81.13 & 72.95 \\ MixVal & **59.13** & 50.41 & **69.28** & **72.07** & **62.72** & **64.89** & 82.93 & **86.67** & **78.16** \\  Worst & 57.71 & 48.99 & 67.78 & 70.72 & 61.30 & 60.23 & 76.31 & 81.13 & 72.55 \\ Best & 59.20 & 50.75 & 69.28 & 72.24 & 62.87 & 65.30 & 84.14 & 86.67 & 78.70 \\   

Table 8: Validation accuracy (\(\%\)) of a mixup-based closed-set UDA method DMRL .

Figure 2: (a) presents the effect of different consistency evaluation techniques. (b) provides comparisons between SND and our MixVal on a validation task involving two hyperparameters: MCC on the Ar\(\)Cl, where \(\) represents the bottleneck dimension and \(\) represents the temperature. The SND and MixVal scores of the \(28\) candidate models are ranked in ascending order. To enhance clarity, we include the real target accuracy for each model in the left figure labeled as ‘Accuracy’.

**Analysis of probing.** In MixVal, we generate mixed samples by applying _mixup_ with a mix ratio \(\) of 0.55 to both target samples and their hard pseudo labels. We then calculate ICE scores for both intra-cluster and inter-cluster mixed samples. The final score for model selection is determined by averaging ascending rankings of both types of ICE scores. Here, we present a comprehensive ablation study to delve into these design choices within MixVal. To do this, we conduct validation experiments for PADA on four partial-set UDA tasks (Ar\(\)Cl, Cl\(\)Pr, Pr\(\)Re, Re\(\)Ar) and report the average accuracy results in Figure 3. 'AccAvg' represents the direct average of ICE scores (i.e., accuracy values) as the final score for model selection. 'RankAvg' denotes the use of the average ranking of ICE scores for selection. 'RankInter' relies solely on inter-cluster mixed samples for probing. 'RankIntra' employs only intra-cluster mixed samples for probing. 'Hard' and 'Soft' indicate the utilization of hard and soft pseudo labels, respectively. It's worth noting that for intra-cluster mixed samples, there is no distinction between 'Hard' and 'Soft' labels, as all pseudo labels involved are the same. The observations drawn from Figure 3 are as follows: (_i_) The mix ratio (\(\)) influences the level of ambiguity in mixed samples. In MixVal, \(=0.55\) generates more ambiguous in-between samples with greater probing capabilities than the easier samples created by \(=0.9\). Consequently, validation performance at \(=0.55\) surpasses that at \(=0.9\). (_ii_) In MixVal, while soft pseudo labels may provide additional performance improvements for inter-cluster probing, the use of hard pseudo labels offers simplicity and stability advantages. (_iii_) The separate probing of each type of mixed samples demonstrates effectiveness, and the combination of intra-cluster and inter-cluster probing enhances MixVal's stability. Kindly refer to Appendix C for more discussions on probing.

**Extension to segmentation.** We extend the use of MixVal to the domain adaptive segmentation task on _GTAV2Cityscapes_, following the same configuration as SND . Our model selection process involves 66 candidate models generated by varying two hyperparameters: the loss coefficient and training iteration. We save checkpoints every 2,000 iterations, starting from the 10,000th iteration to the 30,000th iteration. The results in Table 9 demonstrate that MixVal consistently delivers the top validation performance for both UDA methods, while Entropy consistently underperforms SourceVal.

**Influence of backbone.** In addition to ResNet backbones, we also utilize ViT-B  as the backbone for the validation of BNM on the task R\(\)S. Accuracies reported in Table 10 highlight MixVal's superior stability with ViT, especially in comparison to Entropy, InfoMax, and Corr-C.

**Limitations and impacts.** While MixVal excels in classification tasks, further research is needed to address its limitations. This includes establishing the theoretical foundations of probing data structure using pseudo-labeled mixed samples. Additionally, extending MixVal to other machine learning tasks like object detection and regression presents challenges. Poor hyperparameter selections could potentially have negative societal impacts on the real-world deployment of UDA models. Nevertheless, we have not observed such situations during our extensive evaluation of MixVal.

## 5 Conclusion

In summary, we introduce MixVal, a novel and straightforward target-only method for model selection in unsupervised domain adaptation (UDA). MixVal leverages inference-stage _mixup_ to generate two distinct types of mixed samples, facilitating effective probing of the learned target structure while elegantly considering key assumptions used in previous approaches. Our extensive evaluations encompass diverse UDA methods and adaptation scenarios, consistently affirming the superior and reliable performance of MixVal when compared to existing model selection methods.

   Method & AdapSeget  & AdvEnt  \\ 
**SourceVal** & 39.52 & 39.08 \\ Entropy  & 39.47 & 38.41 \\ SND  & 40.69 & **40.02** \\ MixVal & **42.20** & **40.02** \\   Worst & 33.84 & 33.06 \\ Best & 42.20 & 41.78 \\   

Table 10: ViT results.

Figure 3: Analysis of probing.