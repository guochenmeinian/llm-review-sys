# Fair and Welfare-Efficient

Constrained Multi-matchings under Uncertainty

Elita Lobo, Justin Payan, Cyrus Cousins, and Yair Zick

University of Massachusetts Amherst

{elobo, jpayan, cbcousins, yzick}@umass.edu

Authors contributed equally.

###### Abstract

We study fair allocation of constrained resources, where a market designer optimizes overall welfare while maintaining group fairness. In many large-scale settings, utilities are not known in advance, but are instead observed after realizing the allocation. We therefore _estimate_ agent utilities using machine learning. Optimizing over estimates requires trading-off between mean utilities and their predictive variances. We discuss these trade-offs under two paradigms for preference modeling - in the _stochastic optimization_ regime, the market designer has access to a probability distribution over utilities, and in the _robust optimization_ regime they have access to an _uncertainty set_ containing the true utilities with high probability. We discuss utilitarian and egalitarian welfare objectives, and we explore how to optimize for them under stochastic and robust paradigms. We demonstrate the efficacy of our approaches on three publicly available conference reviewer assignment datasets. The approaches presented enable scalable constrained resource allocation under uncertainty for many combinations of objectives and preference models.

## 1 Introduction

Constrained resource allocation without money underpins many important systems, including reviewer assignment for peer review (our primary example throughout the paper) , assigning resources to homeless populations , distributing emergency response resources , and more . In these settings, we assign _resources_ to _agents_. Agents and resources are _constrained_; each agent has bounds on the minimum or maximum number of items they receive from different categories, and each item has required minimums and limited total capacity. Each agent has a valuation for every item, and we optimize a welfare function of the agent-item valuations. In the case of reviewer assignment, the reviewer-paper valuations measure the alignment between reviewers and papers, papers must receive a certain number of reviews from unique reviewers, reviewers have upper limits on the number of papers they can review, and conflicts of interest prevent some reviewers from being assigned to certain papers.

A crucial factor in all of the above settings is the presence of _uncertainty_. Uncertainty often stems from the fact that agents' valuations for resources depend on future outcomes. In reviewer assignment, a reviewer-paper pair's match quality is observed only after the reviewer submits his or her reviewUncertainty may also stem from our limited ability to collect data; for example, in deciding where to target lead pipe mitigation projects based on number of school-aged children per neighborhood, we may have access to imperfect school enrollment records, allowing only an approximate model of the impacts of mitigation on children in each neighborhood . We adopt two possible stances towards uncertainty, depending on the information available. When we have access to _aprobability distribution_ over preferences, we optimize the conditional expectation of the distribution at percentiles of interest [33; 50]. When we have access to _a set_ of possible preferences, we adopt the _robust_ approach, which is related to the minimax regret objective used in solving robust assignment problems [3; 10; 11; 32]. Uncertainty-aware optimization approaches can often result in significantly different allocations from the default of optimizing for welfare over a central estimate (see Example 2.1 for an intuitive explanation for this phenomenon).

Typically, we maximize the sum of agent utilities. However, in many of these settings, we are also concerned with _fairness_ to individuals or groups of agents. Groups of agents may represent subject areas of papers in reviewer assignment, demographic groups in poverty alleviation campaigns, or regional groupings of computational resources in bandwidth allocation. Fairness to these groups may be legally required in some cases; in others it is an ethical choice by the decision maker. Although groups are often first-class objects worthy of receiving fair treatment, group fairness is often the smallest granularity of fairness achievable under uncertainty - in a large dataset uncertainty will always cause some individuals to have vanishing welfare, but group welfare can still be upheld. Although there is much literature on combinatorial optimization under uncertainty [3; 10; 11; 32; 33], to our knowledge it has not addressed the intersection of fairness and uncertainty in the constrained multi-matching problem.

### Our Contributions

We study the broad problem of fair and efficient constrained multi-matchings under uncertainty about agents' valuations. We optimize for welfare while simultaneously accounting for the uncertainty inherent in real-world resource allocation problems. Specifically, we develop methods to efficiently optimize the utilitarian and egalitarian welfare objectives using the robust approach [7; 8; 26] and the \(\) approach . Our results are summarized in Table 1.

For robust optimization, we construct an uncertainty set that contains the true preferences with high probability (Section 3). This model is appropriate when building a predictor with statistical error bounds, but without making any assumptions on the full probability distribution over valuations. For utilitarian and egalitarian welfare functions, we robustly maximize welfare over such uncertainty sets. When the uncertainty sets are linear, we can efficiently compute the exact optimal allocations for both utilitarian and egalitarian welfare in polynomial time (Corollaries 3.2 and 3.6). Under a single ellipsoidal uncertainty set, we can apply an _iterated quadratic programming_ approach (Corollaries 3.3 and 3.7), while a projected subgradient ascent approach is needed when uncertainty sets consist of multiple ellipsoids (Propositions 3.1 and 3.5). Under general monotonic, concave welfare functions and arbitrary convex uncertainty sets, we apply the relatively expensive adversarial projected subgradient ascent algorithm of Cousins _et al._.

When the market designer can construct a full probability distribution over preferences or sample from such a distribution, we consider _stochastic optimization_ using the concept of _Conditional Value at Risk_, or \(\). This approach, laid out in Section 4, selects an allocation that maximizes the conditional expectation of welfare over the left tail of the welfare distribution. We often approximate \(\) objectives using sampling and then solve the resulting linear program or LP (as in Propositions 4.1 and H.3). However, in the case of utilitarian welfare and Gaussian-distributed valuations, we present a simple reformulation of the \(\) objective (Proposition 4.3). Optimizing \(\) for general monotonic, concave welfare functions can require solving arbitrary concave optimization problems, even after sampling.

We also compare these optimization approaches empirically in Section 5 on reviewer assignment data from AAMAS \(2015\), \(2016\), and \(2021\).

### Related work

We discuss the history of prior work on robust and \(\) optimization in Appendix A.

Some existing work applies stochastic or robust optimization to fair division problems. A line of work studies the minimax regret objective in combinatorial optimization problems, such as constrained resource allocation [3; 10; 11; 32]. This work does not explicitly consider multi-matching problems like those considered here, nor does it address the robust egalitarian welfare problem. Pujol _et al._ study fair division problems with parameters noised for differential privacy, showing that the noise can cause unfair allocations; they propose a Monte Carlo approach to mitigate unfairness with high probability. Peters _et al._ study envy-free rent division under probabilistic uncertainty. A central mechanism divides rooms and sets room prices for items to minimize envy. We study a setting without money, both utilitarian and egalitarian objectives, and robust optimization in addition to stochastic optimization.

Cousins _et al._ study robust optimization under the utilitarian objective. They propose an adversarial projected subgradient ascent method, which requires solving two quadratic programs (one for the adversary and one for the projection) at each iteration for a large number of iterations. Our empirical analysis in Section 5 demonstrates the inefficiency of this method. Fair machine learning algorithms [17; 22; 23; 43; 59] often employ similar adversarial optimization techniques over an uncertainty set in a machine learning context. Other fair allocation research has studied the case where agent demand or item availability are uncertain but preferences are known [2; 14; 21; 27]. In our case, demand and availability are known but preferences are not. Devic _et al._ consider fair two-sided matching where the fairness constraint is defined with respect to unknown parameters; we assume knowledge of the parameters that define the fairness constraint (i.e., group identities).

## 2 Fair Resource Allocation under Uncertainty

We first introduce the problem of resource allocation without uncertainty, then lay out the two approaches we take to deal with the introduction of uncertainty. Our results are summarized in Table 1.

### Fair Resource Allocation

We have a set of \(n\) agents \(N=\{a_{1}, a_{n}\}\), and \(m\) item types \(I=\{i_{1}, i_{m}\}\). Agents are partitioned into \(g\) groups \(=\{G_{1}, G_{g}\}\), with each \(G N\) and each agent \(i\) belonging to exactly one group.

For any \(n m\) matrix \(\) we use the same lower-case bold letter, i.e., \(\) to denote the vector representing the vectorized form of the matrix \(\), in row-major order. For any group of agents \(G\), we use \(_{G}^{|G|m}\) to denote the vector restricted to the agents in \(G\). Given vectors \(,^{nm}\) and real number \(c\), let \( c\) denote \(_{j} c\) for all \(j\), and let \(\) denote that \(- 0\). The \(\) operator is defined analogously.

We assume a valuation matrix \(^{*}^{n m}_{0+}\), where \(^{*}_{a,i}\) encodes the true value of assigning item type \(i\) to agent \(a\). The values of \(^{*}\) are typically unknown; we discuss our approaches to handle this problem in Section 2.2. We use tildes to denote random variables; for example, \(_{}\) denotes that the random variable \(\) follows the distribution \(_{}\).

Given some set of feasible assignments \(^{n m}\), we aim to find assignments \(\) where \(_{a,i}\) indicates the number of items of type \(i\) allocated to agent \(a\). For each agent \(a N\), we have

    &  \\   &  &  \\   & **Linear** & **One Ellipsoid** & \(\)**Ellipsoids** & **Any (approx.)** & **Gaussian** \\   & \(}\) Reduction & Iterated QR & Projected SGA & Sampling + LP & Projected GA \\  & (Coro. 3.2) & (Coro. 3.3) & (Prop. 3.1) & (Prop. 4.1) & (Prop. 4.3) \\   & \(}\) Reduction & Iterated QP & Projected SGA &  \\  & (Coro. 3.6) & (Coro. 3.7) & (Prop. 3.5) & \\   &  & Sampling + Concave Program \\  & & (Sec. 3.3) & & (Sec. 4) \\   

Table 1: Summary of optimization algorithms for efficiently computing utilitarian and egalitarian welfare under different robustness concepts. Green highlights indicate problems which require solving a single linear program (low difficulty). Yellow highlights indicate solving a small number of linear or quadratic programs (medium difficulty). Red highlights indicate problems which require solving numerous quadratic programs or arbitrary concave programs.

upper and lower bounds on assignments of the form \(_{a}_{i I}_{a,i}_{a}\). For each item \(i\), we have lower and upper bounds on the total assignment of that item; \(_{i}_{a N}_{a,i}_{i}\). Finally, we have pairwise limits \(_{a,i}\) for each agent \(a\) and item type \(i\), requiring that \(_{a,i}_{a,i}\). It is always the case that the constraints define a finite set such that \(||\). In the example of reviewer assignment, these constraints reflect the review requirements per paper, load bounds for reviewers, conflicts of interest, and the constraint that no reviewer is assigned twice to any given paper.

Let \(:_{0+}^{n m}^{g}\) be an affine function mapping from allocations to utilities for each group. \(_{G}(,)\) denotes the utility of the group \(G\) under allocation \(\) (recall \(\) is the vectorized version of the assignment \(\)). We write \(\) instead of \((,)\) when \(\) and \(\) are clear from context. We assume that \(\) is _additive_ and normalized by group size, so \(_{G}=_{i}^{}_{G}}{|G|}\). We define a _welfare function_\(:^{g}\), where \(((,))\) denotes the overall welfare of allocation \(\). The _weighted utilitarian social welfare_ function is defined as \(\), where \(_{0+}^{g}\) denotes the weights on groups in \(\). When \(_{G}=|G|\) for all \(G\), we call this function simply "utilitarian welfare" or "USW." The _group egalitarian social welfare_ function (also "group egalitarian welfare" or "GESW") is defined as \(_{G}_{G}\). We do not consider individual egalitarian welfare in this work; under robust and stochastic optimization the egalitarian welfare is zero when the number of items is proportional to the number of agents and uncertainty is non-trivial.

### Optimizing Allocations under Uncertainty

We consider two main approaches to dealing with uncertainty: the _robust optimization_ approach and the _Conditional Value at Risk_ approach.

In the robust approach (Section 3), we obtain an _uncertainty set_\(\) that contains the true agent valuations \(^{*}\) with probability at least \(1-\) for some confidence parameter \([0,1)\). We then optimize the welfare corresponding to the _worst_ valuation matrix in the uncertainty set, i.e., \(_{}_{}( (,))\). This approach applies when we do not have access to a full distribution over valuations but have some other way of describing \(\).

When we have access to a complete distribution of the random variable \(}^{nm}\), we apply a stochastic approach instead. We compute the welfare distribution and optimize the conditional expectation over an \(\)-percentile of the welfare or _Conditional Value at Risk at \(\)_ (\(_{}\)). Suppose that we have a random variable \(_{}\). For any risk level \((0,0.5)\), \(_{}[]\) is defined as \(_{_{}}[ _{}]\) where \(_{}\) denotes the \(\)-percentile of \(\). This approach is only appropriate when \(_{}\) is fully known, or when we can sample from it. We investigate this regime in Section 4, where we will compute and optimize \(_{}[((,}))]\) for a random variable \(}_{}}\).

**Example 2.1** (The Importance of Considering Uncertainty).: Consider a simple two-agent, two-item instance, where each agent needs to get exactly one item, and either likes (utility \(1\)) or dislikes it (utility \(0\)). Agent preferences are Bernoulli random variables, where \([}_{1,1}=1]=0.8,[}_{1,2}=1]=0.9,[ }_{2,1}=1]=0.5\), and \([}_{2,2}=1]=0.8\). If we maximize the expected USW, we would assign \(i_{1}\) to \(a_{1}\) and \(i_{2}\) to \(a_{2}\), for a total expected USW of \(1.6\). However, consider instead the \(_{0.3}\) of USW. When we make the expectation-maximizing assignment, then \([()=0]=0.04\) and \([()=1]=0.32\). However, if we assign \(i_{2}\) to agent \(a_{1}\) and item \(i_{1}\) to agent \(a_{2}\), we have \([()=0]=0.05\) and \([()=1]=0.5\). This means that the conditional expectation of welfare at the \(30^{th}\) percentile is higher if we assign \(i_{2}\) to \(a_{1}\) and \(i_{1}\) to \(a_{2}\) (it is \(.32\) in the first case and \(.5\) in the second case). If we want to retain welfare in the face of uncertainty, we might well choose to maximize this quantity rather than the expectation of the welfare.

## 3 Robust Welfare Optimization

We construct the optimization problems for utilitarian and egalitarian welfare objectives with the robust approach. Many of these optimization problems are concave-convex max-min problems that can be directly solved using an adversarial projected subgradient ascent technique : in each iteration of the algorithm, the inner minimization problem is solved to optimality, followed by a subgradient step on the allocation \(\), followed by a projection onto the constraint space \(\). However, this method does not exploit the structure of these problems and is often computationally expensive or intractable, as demonstrated empirically in Section 5. Despite the inherent complexities of these problems, we show that, under specific assumptions, these problems can be reduced to more manageable forms that are easier to optimize. We then discuss a range of algorithms for efficiently optimizing the simplified problems.

Scope:The robust approach detailed in Section 2 assumes the availability of an uncertainty set of the valuation matrix. For the sake of computational tractability, we focus on the class of uncertainty sets defined by linear and ellipsoidal constraints

\[=\{^{nm} i[1,],\,( -}_{i})^{}_{i}^{-1}(- }_{i}) r_{i}^{2},, 0\},\]

where the \(i^{th}\) ellipsoid is centered at \(}_{i}_{0+}^{nm}\) with a positive definite covariance matrix \(_{i}^{nm nm}\) and radius \(r_{i}_{0+}\), and \(^{k nm}\), and \(^{k}\) define additional linear constraints.

This limitation on the structure of uncertainty sets is not too restrictive; it is possible to construct such uncertainty sets for linear regression and logistic regression models using statistical bounds, as shown in Appendix D.

In all of our methods, where obtaining an integer allocation is either not feasible or computationally tractable, we relax the set of feasible integer assignments \(^{n m}\) to a set of feasible continuous allocations \(_{0+}^{n m}\). One can obtain integer allocations satisfying all constraints by applying a randomized rounding technique that generalizes the Birkhoff-von Neumann decomposition . The fractional solutions can thus be interpreted as randomized allocations.

### Robust Allocation for Utilitarian Welfare

We consider the problem of finding an allocation that optimizes the weighted utilitarian welfare under the worst valuation matrix in the uncertainty set. We formulate the problem as

\[_{}_{} (,).\] (1)

The objective and constraints of the inner-minimization problem described in (1) are convex. The problem is strictly feasible, which satisfies Slater's condition  for strong duality. Therefore, by taking the dual of the inner-minimization problem, we can simplify the problem in (1) into a single equivalent maximization problem. We provide the dual formation in Proposition 3.1.

To simplify the notation in the results that follow, we assume, without loss of generality, that each group \(G\) has weight \(_{G}=|G|\). In practice, if this assumption does not hold, the weights can be incorporated into the valuations \(\) with a corresponding adjustment to the parameters of the valuation uncertainty set \(\).

In the dual, let \(_{0+}^{k}\) be the dual variable corresponding to the linear constraints \(\), \(_{0+}^{}\) be the dual variable associated with the ellipsoidal constraints, and \(^{nm}\) be the variable that combines the primal variable \(\) with the dual variable of the non-negativity constraint on \(\) for variable elimination. We define a set of feasible \(\) as

\[-_{0+}^{nm}=\{^{ nm}\,\, a N:\,_{i I}\!\!_{am+i}_{a},  i I:\,_{a N}\!\!_{am+i}_{i}, \},\] (2)

which is Pareto-dominated by \(\).

**Proposition 3.1** (Robust Utilitarian Welfare Dual).: _The problem in (1) is equivalent to solving_

\[_{\\ }^{}+ ^{}-^{} +_{i=1}^{}(_{i}}_{i}^{} _{i}^{-1}}_{i}-_{i}r_{i}^{2})-^{},\] (3)

_where \(=-^{}\), \(=_{i=1}^{}_{i}_{i}^{-1}}_{i}\), and \(=(_{i=1}^{}_{i}_{i}^{-1})^{-1}\). Let \(^{*}\) be the optimal \(\) in (3). Then the optimal allocation \(^{*}\) can be derived from \(^{*}\) by finding \(\) such that \(^{*}\)._

Proposition 3.1 shows that the optimal allocation for the problem in Equation (1) can be computed by first solving the concave program in Equation (3) to obtain \(^{*}\) and then deriving the optimal allocation \(^{*}\) from \(^{*}\) by solving a system of equations. Notably, the problem in Equation (3) is a single maximization problem with fewer variables and constraints as compared to the max-min problem in (1), making it simpler to solve. We can either solve it using off-the-shelf convex optimization tools, or by applying a projected subgradient ascent approach (without the previously required adversary).

When the valuation uncertainty set is polyhedral, the problem in (3) simplifies further into a linear program (LP) which can be solved efficiently using standard LP solvers like Gurobi .

**Corollary 3.2** (Utilitarian Welfare with Polyhedral Uncertainty).: _In the case where the uncertainty set \(\) is defined purely by linear constraints, i.e., \(=\{^{nm},  0\}\), the optimal allocation \(^{*}\) for the problem in (1) can be computed by solving the linear program_

\[_{,\ ^{n}_{0+}}^{ }\ ^{}.\]

When the valuation uncertainty set has a single ellipsoidal constraint with a non-negativity constraint, we compute the solution using iterated quadratic programming (Iterated QP).

**Corollary 3.3** (Utilitarian Welfare with Ellipsoidal Uncertainty).: _Suppose that the set \(\) in (1) is defined by a single truncated ellipsoidal constraint, i.e., \(=\{^{nm}(-})^{ }^{-1}(-}) r^{2},  0\}\). The problem in (1) is equivalent to solving_

\[_{_{0+},\ }^{} }-^{}}{4}-  r^{2}.\] (4)

_The exact optimal solution (\(^{*},^{*}\)) to Equation (4) can be computed by alternately performing two steps until convergence: first, fixing \(\) and optimizing \(\), i.e., \(=^{}}/2r\), and second, fixing \(\) and solving a concave quadratic program to optimize \(\). The optimal allocation \(^{*}\) can be computed from \(^{*}\) as in Proposition 3.1._

### Robust Allocation for Group Egalitarian Welfare

We now consider the problem of maximizing egalitarian welfare under the robust approach. We can represent this problem as

\[_{}_{}_{G }\ _{G}(,).\] (5)

This problem presents inherent challenges due to the non-smoothness of the inner-minimization problem and the joint constraint on the uncertainties of the valuation matrices of different groups. These factors make it difficult to compute the dual and reduce the problem or efficiently solve the problem using the quadratic program technique described in Corollary 3.3, although the generic adversarial subgradient ascent approach of Cousins _et al._ can still be applied. For the remainder of this section, we assume that the uncertainty sets for each group \(G\) are independent of each other. To simplify notation, we assume, without loss of generality, that the valuations \(\) and the parameters of the valuation uncertainty set \(\) are scaled to incorporate the factor \(\) in the representation of the utility of each group \(G\) in the corresponding group valuation \(_{G}\).

**Assumption 3.4** (Independence of Groups).: _The uncertainty set \(\) is a Cartesian product of individual groups' uncertainty sets, \(_{G}_{G}\) where each group's uncertainty set \(_{G}\) is given by_

\[_{G}=\{_{G}^{|G|m} i[1, ],\ (_{G}-}_{G,i})^{}_{G,i}^{-1}( _{G}-}_{G,i}) r_{G,i}^{2},_{G}_{G }_{G},_{G}\}.\]

_Here the \(i^{th}\) ellipsoid in group \(G\)'s uncertainty set is centered at \(}_{G,i}^{|G|m}_{0+}\) with positive definite covariance matrix \(_{G,i}^{|G|m|G|m}\) and radius \(r_{G,i}_{0+}\), and \(_{G}^{k|G|m}\), and \(_{G}^{k}\) define additional linear constraints._

This assumption is not unreasonable in practical scenarios. For example, conferences often group papers into disjoint tracks or require paper authors to select a single primary subject area. Although papers may have multiple secondary subject areas, the top-level grouping remains independent. Assumption 3.4 allows us to reorder the two minimization problems without compromising generality:

\[_{}\ _{G}\ _{_{G} _{G}}\ _{G}^{}_{G}.\] (6)

We take the dual of the inner minimization problem and then reorder the minimization over groups and the maximization over the dual variables to obtain a single, concave max-min problem. This can be solved with projected subgradient ascent in the general case, or with more efficient approaches in special cases. Proposition 3.5 expresses the general form of the result.

**Proposition 3.5** (Robust Group Egalitarian Dual).: _The problem in (5) is equivalent to solving_

\[_{\\ ^{9 t}_{G}\\ ^{9 t}_{G}\\ }_{_{G}^{}_{ G}+_{G}^{}_{G}}_{G}-}_{G}^{}_{G}}_{G}+\\ _{i=1}^{}(_{G,i}}}_{G,i}^{ }_{G}}}_{G,i}-_{G,i}r_{G,i} ^{2})-}_{G}^{}_{G}}_{G }\ \,}\] (7)

_where for each group \(G\), \(}_{G}=_{G}-_{G}^{}_{G}\), \(}_{G}=_{i=1}^{}_{G,i}}_{G,i}^{-1} }_{G,i}\), \(_{G}=(_{i=1}^{},_{G,i}}_{G,i}^ {-1})^{-1}\), and \(\) is defined as in Equation (2). The optimal allocation \(}^{*}\) can be computed from \(^{*}\) as in Proposition 3.1._

The dual variables \(_{G},_{G},_{G}\) and \(_{G}\) for each group \(G\) are interpreted as in Proposition 3.1. The optimization problem in (7) is concave with respect to the dual variables \(,\) and \(\). We can solve it using an off-the-shelf convex programming library or by applying projected subgradient ascent.

Under polyhedral uncertainty sets, Equation (7) simplifies to a linear program. This is akin to what we observe in the robust utilitarian case (Corollary 3.2).

**Corollary 3.6** (Group Egalitarian Welfare with Polyhedral Uncertainty).: _In the case where the uncertainty set \(\) is defined only by linear constraints, i.e., \(=\{^{nm} G:}_{G}_{G}_{G}, 0\}\), the max-min-min problem in (5) transforms into a linear program._

When the valuation uncertainty set is defined by a single ellipsoidal constraint per group, we can employ the iterated quadratic programming (Iterated QP) approach used in Corollary 3.3, alternately fixing \(\) and optimizing the rest of the dual variables \((,)\) until convergence.

**Corollary 3.7** (Group Egalitarian Welfare with Ellipsoidal Uncertainty).: _Suppose that the set \(\) in (5) is defined by a single truncated ellipsoidal constraint per group i.e., \(=\{^{nm} G:(_{G}-}_{G})}_{G}^{-1}(_{G}-}_{G})  r_{G}^{2}, 0\}\). Then the problem in (5) is equivalent to solving_

\[_{^{9 t}_{G}\\ }_{}_{G}^{}}_{G}-_{G}^{ }}_{G}_{G}}{4_{G}}-_{G}r_{G}^{2}\ \.\]

_The exact optimal solution (\(^{*},^{*}\)) to Equation (4) can be computed by alternately performing two steps until convergence: first, fixing \(\) and optimizing \(\), i.e., \( G\), \(_{G}=_{G}^{}}_{G}_{G}/2r_{G}}\), and second, fixing \(\) and solving a concave quadratic program to optimize \(\). The optimal allocation \(}^{*}\) can be computed from \(^{*}\) as in Proposition 3.1._

### Robust Allocation for Monotonic Welfare Functions

We now extend our findings to a broader class of monotonic welfare functions. Specifically, we show that when optimizing a monotonic welfare objective under Assumption 3.4, we can decompose the problem into sub-problems such that we independently determine the worst valuation in the uncertainty set of each group, while jointly optimizing the allocation over all groups.

**Proposition 3.8** (Decomposition for Monotonic Welfare Functions).: _Consider an optimization problem of the form_

\[_{}}_{}\ _{}((},))\ \,\] (8)

_where the welfare function \(_{}\) is monotonic in the utility of groups. If Assumption 3.4 holds, then (8) simplifies to_

\[_{}}\ _{}(_{ _{G_{1}}}_{G_{1}}}_{G_{1}}( }_{G_{1}},_{G_{1}}),_{_{G_{2}}}_{G_{ 2}}}_{G_{2}}(}_{G_{2}},_{G_{2}}),,_{ _{G_{g}}}_{G_{g}}}_{G_{g}}( }_{G_{g}},_{G_{g}}))\ \.\]

Proposition 3.8 helps us derive simplified versions of Equation (8), when Assumption 3.4 holds. The egalitarian problem in (5) is an instance of the class of optimization problems described in (8), hence Proposition 3.8 holds under Assumption 3.4 and allows us to derive a single maximization problem (Proposition 3.5). If the allocation and valuation uncertainty sets are convex and compact, the problem in (8) can be solved using constrained convex-concave minimax optimization algorithms [18; 25; 55], or adversarial projected gradient ascent . These approaches do not depend on Assumption 3.4, although optimization can be simplified if independence does hold.

Stochastic Welfare Optimization

In this section, we optimize the \(\) of utilitarian and egalitarian welfare. This approach works when the distribution \(_{}}\) over the valuation matrix is known or when we can sample from \(_{}}\). We demonstrate that when the distribution follows a Gaussian distribution, the \(\) of the utilitarian welfare has a simple representation that can be optimized without sample approximation using a projected gradient ascent method. In all other cases, we can approximately optimize \(\) using a sampling-based approach. In particular, when we have monotone, concave welfare functions, we can always approximate the \(\) objective using sampling. However, unlike in Propositions 4.1 and H.3, where the approximated problem becomes linear, with arbitrary monotone, concave welfare functions the problem may require general concave optimization.

### \(\) Allocation for Utilitarian Welfare

We wish to find an allocation that maximizes the \(_{}\) of the weighted utilitarian welfare. Let \(}\) represent the random valuation vector. For confidence level \(\), we formulate the problem as

\[_{}_{}[ (,})]_{ ,b}\{b-}_{ }_{}}}[(b-(,}))_{+}]\},\] (9)

where \((x)_{+}=(x,0)\) represents the positive part of \(x\). Computing the exact expectation in this problem may not be feasible for every distribution \(_{}}\). Therefore, we adopt a sampling-based approach. We begin by drawing \(h\) i.i.d. samples of the valuation matrix from \(_{}}\) represented as \(^{1},^{2},^{3},,^{}\). We then use these samples to solve the problem described in (9) by solving the linear program outlined in Proposition 4.1.

**Proposition 4.1** (Approximate \(\) of USW).: _Given \(h\) i.i.d samples of \(}\), i.e., \(^{1},^{2},^{3},\)\(,^{h}\) from \(_{}}\), the optimal allocation for the problem in (9) can be approximately computed by solving_

\[_{}_{_{0+}^{h}\\ b}(b-_{j=1}^{h}_{j} ) j[1,h]:\ _{j}(b- (,^{j})).\] (10)

The \(\) estimator used in (10) is a strongly consistent estimator . Therefore, the approximation error of the objective in (10) goes to \(0\) as \(h\). In Proposition 4.2, we bound the sample complexity of the problem in (10) when the valuation matrix is sub-Gaussian distributed.

For any allocation \(\), let \(_{h,}()\) represent the empirical estimate of \(_{}[(,})]\) computed from \(h\) samples and \(c_{}()\) represent the corresponding true value. We will use \(||\) to denote the number of feasible allocations and \(f_{}:_{0+}\) to denote the density function of the random welfare \((,})\). \(_{}\) denotes the \(\) percentile of \((,})\).

**Proposition 4.2** (Sample Complexity of Approximate \(\) of USW).: _Suppose that \(}\) is a multivariate sub-Gaussian random variable with mean \(}^{nm}\) and covariance proxy \(^{nm nm}\), i.e., for all vectors \(^{nm}:\ }_{}_{ }}}[((}-})^{ }))](^{}/\!\! 2)\), and that, for any risk level \((0,)\) and allocation \(\), there exists probability density threshold \(>0\) and radius \(>0\), s.t., \(f_{}(x)>\), \( x[_{}-,_{}+]\). Set \( G:_{G}^{}=_{G} _{G}}{|G|}\). Then, for any confidence parameter \((0,1)\) and error tolerance \(>0\),_

\[[_{}|_{h,}()-c_{ }()|] 1- h>[ }^{} ^{},8)(|}{} )}{(^{2},16^{2})^{2}(^{2},1)}].\]

Proposition 4.2 follows directly from Theorem 3.1 of L.A. _et al._. When \(}\) is Gaussian distributed, we can circumvent the sampling approach and instead solve an optimization problem (Proposition 4.3), which depends solely on the mean and covariance of \(}\).

**Proposition 4.3** (\(\) of USW for Gaussian Distributions).: _If \(}\) is distributed as a multivariate Gaussian, i.e., \(}(},)\), then, the optimization problem in (9) simplifies to_

\[_{}^{}}- ())}{}^{} ^{}},\] (11)where \( G:\,_{G}^{}=_{G}} {|G|}\), and \(\) and \(\) denote the probability density function and the cumulative density function, respectively, of the standard normal distribution \((0,1)\). The problem in (11) is concave and can be solved using the projected gradient ascent method.

### \(\) Allocation for Group Egalitarian Welfare

For our final objective, we wish to optimize egalitarian welfare under uncertainty using the \(\) approach. We formulate this optimization problem as

\[_{}_{}[_{G }_{G}(,})]_{ ,b}\{b-\,\, {}_{}}}{}[(b -_{G}_{G}(,}))_{+ }]\}\.\] (12)

To optimize the problem described in the above equation, we solve a linear program similar to the one used to optimize the utilitarian objective \(\) in (9). See Proposition H.3 for more details.

## 5 Experiments

We run experiments on three reviewer assignment datasets. The datasets contain bids from the International Conference on Autonomous Agents and Multiagent Systems (AAMAS) \(2015\), \(2016\), and \(2021\)[41; 42]. We consider the papers as the "agents" and the reviewers as the "items." This is a fairly standard assumption in most recent reviewer assignment approaches, reflecting the primary goal of peer review to assign qualified and interested reviewers to papers [16; 30; 31; 38; 45; 54].

The reviewers issue bids of yes, maybe, no, or no response. We run two experiments with this data. In one, we binarize the bids such that yes and maybe are considered affirmative and no is considered negative, while in the other we convert the bids to numerical scores such that yes is \(1\), maybe is \(.5\), and no is \(0.01\). Under the binarized model, we fit a logistic matrix factorization model to predict whether the bid is affirmative or negative, and in the continuous model, we fit a Gaussian process matrix factorization model . We derive probability distributions and uncertainty sets from these models. More details on prediction and uncertainty set construction are in Appendix E. These datasets do not contain groups of papers and reviewers, so we create \(4\) roughly balanced clusters of reviewers and papers for each dataset using the procedure outlined in Appendix F. We define our valid set of assignments \(\) as follows. For each paper \(a N\), we set \(_{a}=_{a}=3\) for all \(a\) in AAMAS \(2015\), and \(_{a}=_{a}=2\) for all \(a\) in AAMAS \(2016\) and \(2021\). For each reviewer \(i\), we set \(_{i}=0\) and \(_{i}=15\) for \(2015\) and \(2016\) and \(4\) for \(2021\). We optimize and evaluate \(_{0.01}\); we take \(4,000\) samples from the distribution to optimize for \(\) using the sampling-based approach, and we take \(10,000\) samples to estimate \(\) for evaluation. We optimize and evaluate robust welfare at the \(=0.3\) level (there is a \(70\%\) chance that the true values lie in the uncertainty set). We constrain the naive and \(\) approaches to select integer allocations, while the robust approach selects fractional allocations without rounding.

All results are averaged over \(5\) subsampling runs \(20\%\) of each dataset. For each run, we construct \(6\) allocations, maximizing the naive central estimate, \(\) and robust statistics for USW and GESW respectively. We evaluate each allocation on each metric. For each run, we normalize each metric by the maximum value achieved for that metric by any allocation. We normalize in this manner to highlight that the allocation targeted for a given objective always returns the highest value on that objective, and because the absolute optimal values differ across runs.

All code is available at https://github.com/justinpayan/RAU2.

**Overall Performance** Table 2 shows the results for the binarized version of AAMAS \(2015\) bids. Similar tables for the \(5\) other settings are included in Appendix G. Each row shows the metrics for the allocation produced by the method that optimizes for the objective shown in the left-most column. All nonrobust methods have robust welfare \(0\), indicating that if robustness to adversarial noise is desired, it is very important to consider this objective explicitly. Relatively little noise is actually present in this dataset, as the \(_{0.01}\) is quite high for both the naive USW-optimal and GESW-optimal in all cases. Since the USW-optimal solution has a very high GESW, we implement a simulated example to explore when the USW-optimal solution fails to have a high GESW. We find that in a number of settings, the GESW of the USW-optimal solution is much lower than that of the GESW-optimal solution. Appendix I explains the details of the simulation setting and the results.

**Robustness under Increasing Uncertainty** Figure 1 shows the \(_{0.01}\) on the Gaussian version of all three datasets as we artificially increase the amount of noise. We multiply the standard deviations of the Gaussian distributions by a scalar and optimize for the \(\) or the naively-computed USW and \(\). We then plot \(_{0.01}\) as the noise increases. Although the \(\) approach is less important at low noise levels, the \(\) of welfare decreases for both welfare measures as noise increases. \(\) has a sharper decline than USW. We see that as the noise increases, the \(_{0.01}\) of the baseline USW and \(\) maximizing allocations drops off relative to the same value for the \(\)-optimized allocation. We also verify that when we model valuations using a negatively-skewed Gaussian distribution with the same means and variances, we see increasing importance of optimizing for \(\) relative to uncertainty-unaware USW and robust USW. The difference is sharper as the skewness parameter gets more negative. Details of this experiment and its results are included in Appendix J.

**Runtime** For the robust optimization setting with ellipsoidal uncertainty sets (derived from confidence intervals over the Gaussian process matrix factorization), we compare the Iterated QP approach (Corollary 3.3) to adversarial projected subgradient ascent on the original max-min problem (as in ). We find that Iterated QP converges much faster than the adversarial projected subgradient ascent algorithm on both AAMAS \(2015\) (Figure 1) and \(2016\) (Figure 3). Adversarial projected subgradient ascent fails to converge in \(1,000\) iterations for the robust GESW objective on all datasets and the USW objective on AAMAS \(2021\).

## 6 Conclusion

In conclusion, we explore stochastic and robust optimization regimes for utilitarian and group egalitarian welfare objectives. Robust optimization algorithms depend on the form of the uncertainty set. We show that when the uncertainty set has linear constraints only, the resulting problem is an LP and can be solved efficiently. Under ellipsoidal constraints, we demonstrate that iterative quadratic programming approach converges much faster than adversarial projected subgradient ascent. In the stochastic regime, we lay out the sample complexity of \(\) for the utilitarian welfare objective. We demonstrate the feasibility of estimating probability distributions and uncertainty sets on three years of bid data from AAMAS, and show that the robust and \(\) approaches demonstrated in this paper combat the uncertainty present in these three datasets.

   Allocation &  \\  & USW & \(\) & \(\) USW & \(\) GESW & Rob. USW & Rob. \(\) \\  USW & \(\) & \(\) & \(\) & \(\) & \(0 0\) & \(0 0\) \\ \(\) & \(0.97 0.01\) & \(\) & \(0.97 0.01\) & \(0.97 0.02\) & \(0 0\) & \(0 0\) \\ \(\) USW & \(\) & \(0.99 0\) & \(\) & \(0.99 0\) & \(0 0\) & \(0 0\) \\ \(\) GESW & \(0.98 0\) & \(0.99 0\) & \(0.97 0.01\) & \(\) & \(0 0\) & \(0 0\) \\ Rob. USW & \(0.92 0.01\) & \(0.90 0.02\) & \(0.92 0.01\) & \(0.90 0.02\) & \(\) & \(\) \\ Rob. GESW & \(0.89 0.04\) & \(0.85 0.06\) & \(0.89 0.04\) & \(0.86 0.06\) & \(0.88 0.02\) & \(\) \\   

Table 2: Performance of different allocations across each metric on the AAMAS \(2015\) dataset.

Figure 1: Left: \(\) as noise increases for AAMAS 2015. Right: Convergence behavior of the Iterated Quadratic Program (Iterated QP) vs. Adversarial Projected Subgradient Ascent approach on AAMAS 2015.