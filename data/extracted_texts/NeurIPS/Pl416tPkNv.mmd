# Taking the neural sampling code very seriously: A data-driven approach for evaluating generative models of the visual system

**Suhas Shrinivasan1,\({}^{}\), Konstantin-Klemens Lurz1, Kelli Restivo2, George H. Denfield3, Andreas S. Tolias2,5, Edgar Y. Walker4,*, Fabian H. Sinz1,2* \({}^{1}\) Institute for Computer Science and Campus Institute for Data Science, University of Gottingen, Gottingen, Germany \({}^{2}\) Center for Neuroscience and Artificial Intelligence, Department of Neuroscience, Baylor College of Medicine, Houston, USA \({}^{3}\) Department of Psychiatry, Columbia University, New York City, USA \({}^{4}\) Department of Physiology and Biophysics, and Computational Neuroscience Center, University of Washington, Seattle, USA \({}^{5}\) Department of Electrical and Computer Engineering, Rice University, Houston, USA \({}^{}\)Correspondence: suhas.shrinivasan@uni-goettingen.de, \({}^{*}\) Equal contribution**

[MISSING_PAGE_POST]

Footnote 64perception and behavior have thus grown in prominence, successfully accounting for an extensive array of tasks across perception , cognition , sensory-motor learning  and decision making . These models posit that the brain maintains a statistical generative model of the world, where sensory observations \(\) are generated from unknown, world-state variable \(\). Upon encountering a stimulus \(\), perception in the brain is conceptualized as _probabilistically inferring_ the world-state variable \(\) that caused \(\). In other words, to perceive \(\), the brain would invert the generative model to compute the posterior distribution over \(\): \(p(|)\). One can express the posterior via Bayes' rule as: \(p(|) p(|)p ()\), where \(p()\) is the prior distribution of \(\) and \(p(|)\) is the conditional distribution characterizing how well a given \(\) describes \(\). While this has been an influential framework, the neuronal underpinnings of probabilistic inference remain challenging to conceptualize and test experimentally. To this end, the Neural Sampling Code (NSC)  is a prominent theory that offers a unique link between neuronal responses and probabilistic inference. Specifically, NSC posits that neuronal responses, \(\), to a given stimulus, \(\), can be thought of as samples drawn from the posterior distribution: \( p(|)\) (Figure 1).

Background and related workPrevailing literature on NSC uses simple and restrictive generative models and performs qualitative comparisons of model predictions with neurophysiological data to test the theory. Notably, existing NSC works use simple prior- and conditional distributions with pre-specified parameters. For example, a popular choice for the conditional distribution of images (stimuli) has been Gaussian with a likelihood function that linearly combines pre-specified filters. Hoyer and Hyvarinen  learn these filters via independent component analysis on natural images, whereas Haefner, Berkes, and Fiser  use oriented Gabor filters instead. Similarly, a popular choice for the prior is the exponential distribution with a pre-specified rate parameter . These choices are inspired by (a) what is already known about sensory neurons, especially in the primary visual cortex (V1), and (b) the fact that it renders posterior computation mathematically simpler. In the examples above, the choice of filters reflects well-known findings that the receptive fields of V1 neurons resemble (Gabor-like) orientation filters , and the exponential prior is motivated by the principle of sparse coding . Importantly, these parameters and distributions -- and thereby, the generative models -- are not informed or learned _explicitly_ from neurophysiological data. Rather, these works typically sample from the posterior of the assumed generative model in response to strongly parameterized stimuli (e.g., noisy oriented gratings). The models -- and thereby the theory -- are then evaluated based on how well the samples _qualitatively_ capture specific neurophysiological phenomena such as the mean-variance relationship , task-induced noise correlation structures , and contextual modulation in V1 neurons .

In contrast, recent advances in deep learning-based neural system identification models have set new standards in providing expressive models that can faithfully predict neural population responses to natural stimuli , and offer experimentally verifiable insights at the single-neuron level . Additionally, advances in generative modeling, especially of images, have clearly demonstrated the effectiveness of deep, highly nonlinear, generative models such as auto-regressive models , variational autoencoders , normalizing flows , and diffusion models . Given the complexity of high-dimensional natural stimuli and real-world tasks, it is paramount that NSC be considered under a generative model that can match such complexity.

Our objective and contributionsHere we ask: what exactly is the brain's generative model? More specifically, can we identify the brain's generative model from NSC population responses to natural stimuli? Although simple generative models and qualitative evaluations in the NSC literature have offered us great insight into the potential generative models of the brain and engendered support for the theory, there remains a conspicuous gap in the quantitative evaluation of NSC, particularly in response to natural stimuli. In this work, we bridge this gap by proposing a formalization of NSC that 1 allows us to directly fit NSC generative models to recorded neuronal activity in response to natural images, 2 formulate richer and more flexible generative models, and 3 employ standard metrics such as log-likelihood and single trial correlation to quantitatively evaluate different generative models under NSC. As opposed to specifying a generative model that ought to be maintained by the brain, our framework allows us to _learn_ the generative model directly from neurophysiological data. Learning expressive generative models in a data-driven fashion additionally lets us take advantage of population recordings of large and ever-increasing scale in the field . Furthermore, our formalization 1 lets us derive a stimulus-conditioned predictive model of neuronal responses from the trained generative model, which can be directly compared to state-of-the-art system identification models. The predictive model has the ability to provide experimentally-verifiable, neuron-specific predictions from the normative theory.

We demonstrate our approach by fitting classical generative models from NSC literature and flexible deep learning-based generative models on macaque primary visual cortex (V1) population responses to natural images. We show that the flexible models outperform classical models in both their generative- and predictive-model performance. Overall, this work presents an important step towards a quantitative evaluation of NSC, paving the way for a data-driven approach in _learning_ the generative model of the brain.

## 2 Fitting the Neural Sampling Code

### Theory

An explicit formalization of NSCWe begin by formalizing NSC as a latent variable probabilistic model \(\), where \(\) represents the world state variable that underlies the observable stimulus \(\) (Figure 1**A**). Subsequently, the stimulus \(\) gives rise to the neuronal responses \(\) via the posterior \(p(|)\) (Figure 1**B**). NSC posits that the neuronal responses \(\) elicited by stimulus \(\) can be interpreted as stochastic samples from the posterior distribution \(p(|)\) (Figure 1**B, C**). However, the exact relation between \(\) and \(\) is often left unspecified. For instance, it is not clear what aspect of the neuronal response (e.g., firing rate, presence or absence of spikes, or membrane potential) should be treated as a sample. In fact, most previous works do not make a distinction between \(\) and \(\), and simply equate an aspect of the neuronal response such as firing rate with the latent sample. Here, we make this assumption explicit and treat the neural response \(\) as a random variable that matches the latent random variable \(\) in stimulus-conditioned distributions:

\[_{}  p(|)\] (1) \[ =_{},\] (2)

Equation 2 is a slight abuse of notation to state the equivalence in the stimulus-conditioned distributions of \(\) and \(\), more formally stated as:

\[p(|)}{=}p(| ),\] (3)

where \(}{=}\) denotes equality in distribution or density function. By marginalizing the stimulus, we find that the marginal distribution of \(\) must also match that of \(\):

\[p()= p(|)p( )\ }{=} p(|)p( )=p().\] (4)

Figure 1: Conceptualizing NSC. **A.** Latent variable model of the world (stimulus): \(\) is the world state variable (intensity of oriented Gabor filter here; figure inspired from Orbán et al. ) and \(\) is the observed sensory stimulus (e.g., an image of a tiger). **B.** Responses \(\) under NSC: As the brain encounters a stimulus \(\), it inverts its generative model, combining the likelihood \(p(|)\) and prior \(p()\), to obtain the posterior \(p(|)\), and \(\) are samples from the posterior. **C.** Neural response distribution under NSC: Each point corresponds to a single response pair of two NSC neurons under three distinct stimuli depicted by distinct colors. The distribution of neurons matches the distribution over the corresponding latent variables \(\).

Explicitly formalizing NSC with distinct \(\) and \(\) has two advantages. Firstly, the resulting formulation provides the crucial link between the generative model \(\) and observed responses \(\), serving as the basis for learning the generative model from the responses. This also provides the basis for a neuron-specific model comparison between different NSC models as well as the possibility to make predictions for specific neurons that can be experimentally tested. Secondly, the explicit link highlights the possibility to explore more flexible mappings between \(\) and \(\). For instance, one could assume that the latent variable \(\) is encoded in the membrane potential, but what we observe are spike counts, i.e. \(=f()\) for some stochastic mapping \(f\). This relation can, in turn, become part of the model, which can then be fitted to real data and compared to alternative versions of the model. In this work, we choose to learn the generative models from the data under the simplest mapping of \(\) (Section 3.2). Please see Section 4 for a discussion on alternative mappings between \(\) and \(\).

In NSC, we note that the latent variables are what underlie the stimulus (such as the intensity of an oriented filter in 1\(\)) and are not necessarily any task-relevant experimenter-defined variables (such as orientation in an orientation-discrimination task). This is in contrast to the alternative theory of probabilistic population codes [58; 59], where typically, the latent variable is explicitly defined to be the task-relevant experimenter-defined variables.

Learning the generative model under NSCOne way to quantitatively test an NSC generative model \(p(,)\) is testing how well the response distribution \(p(|)\) approximates the posterior \(p(|)\) of the generative model, i.e., testing equation 3. However in reality \(p(,)\), and consequently \(p(|)\), is unknown to us. However, our formalization allows us to learn the generative model \(p(,)\) via learning the joint distribution \(p(,)\). The equivalence between \(p(,)\) and \(p(,)\) follows from equations 2, 3 and 4:

\[p(,) =p(|)p() }{=}p(|)p( )=p(,)\] (5) \[=p(|)p() }{=}p(|)p( )=p(,)\] (6)

The joint distribution can then simply be fitted to recorded stimulus-response pairs \(\{^{(i)},^{(i)}\}_{i=1}^{N}\) by maximizing the likelihood:

\[^{*}=*{arg\,max}_{}_{i=1}^{N} ^{(i)},^{(i)};)}_{}=*{arg\,max}_{_{L},_{P}}\;_{i=1}^{N} ^{(i)}|^{(i)};_{L})}_{ }+^{(i)};_{P} )}_{}\] (7)

where \(\) are the parameters of the generative model, that we split into \(_{L}\) and \(_{P}\) for parameters relevant to the likelihood and prior, respectively. Provided that \(_{L}\) and \(_{P}\) do not overlap, the generative models can be learned by learning the likelihood and prior separately.

Evaluating NSC on dataFitting generative models under NSC on recorded data allows us to compare the generative models quantitatively by evaluating their performances as log-likelihood on a held-out test set. Furthermore, once we have learned the generative model \(p(,;^{*})\), we can invert it to arrive at the posterior \(p(|;^{*})\). This provides a neuronal encoding model \(p(|)\) under specific assumptions of the NSC model, allowing us to predict neural responses to arbitrary new stimuli. The performance of this predictive model can serve as yet another metric for quantitative model comparison under NSC. Additionally, the posterior allows us to compare the generative models to the normative-theory-free system identification models. It is important to note that our quantification does not make any assumption about the kind of stimuli \(\). Existing works on NSC use parametric stimuli from classical neuroscience experiments and perform a qualitative comparison between model- and real-neuronal responses to the same stimuli. Our formulation, on the other hand, allows us to compare different NSC models on _natural images_, the type of stimuli the visual system has evolved to process.

### Models

Following previous work in NSC [9; 10; 11; 12; 13; 14; 15; 16], here we focus on vision and develop generative models under NSC for natural image stimuli \(\) and spike counts \(\) recorded from the visual cortex (Figure 2**A**). Developing generative models entails developing models for the prior \(p()\) and the likelihood \(p(|)\) (Figure 2**B**). Additionally, we also fit an approximate posterior \(q(|)\). We summarize our fitting methodology in an algorithm towards the end of the section (Algorithm 1).

PriorSpike counts \(\) are discrete. Hence, we can neither directly fit standard literature models, such as an exponential  or a Laplace distribution  to the discrete variable \(\), nor can we straightforwardly fit more common flexible density models such as normalizing flows [49; 60], as they are all continuous density models. A common approach to remedy this is to employ uniform dequantization, where the discrete quantity is converted into a continuous signal by adding uniform random noise [43; 61; 62]. We adopt the more general approach of variational dequantization where the noise distribution is learned instead of being fixed to be uniform [63; 64; 65; 66]. In this method, prior distribution over discrete \(\) is captured by positing a generative model involving a continuous latent variable \(\) linked to the discrete response \(\) via a deterministic quantizer function: \(P()= P(|)p()d\), where \(P(|)\) is the _quantizer_ and \(p()\) is the _continuous prior_.

Since the integral is usually intractable, the whole model is fit by optimizing the evidence lower bound (ELBO):

\[ P()_{ q( |;)}[;)}^{}]+( |;)}^{})\] (8)

where \(q(|;)\) is the approximate posterior distribution with parameters \(\), \(p(;)\) is the continuous prior with parameters \(\), and \((q(|;))=- _{ q(|;)} [ q(|;)]\) is the conditional entropy of the dequantizing distribution. Note that Equation (8) only provides a lower-bound to \( P()\), and a tighter bound via importance-weighted sampling [66; 67; 68] (Appendix A).

In our work, we only consider factorized prior distributions, i.e., we treat neurons to be _a priori_ independent \( P()=_{i} P(_{i})\). This choice is informed by both the nature of the V1 neural data that showed limited correlation across all stimuli and the simplicity of the fit it provides. The same independence assumption was applied for the continuous prior distribution over the dequantized responses \(\). Given this dequantizer framework, we explore three different NSC priors by varying the distribution over the continuous latent \(p(;)\):

1. Exponential (**Exp**), \(}{}H()\), as found in the original NSC model by Hoyer & Hyvarinen .
2. Half-normal (**HN**), \(}{}(-}{2^{2}} )H()\), where \(H()\) is the heavyside function.
3. Normalizing flow (**Flow**): \(p(;)=p_{}(T^{-1}(;) )|(;)}{ {}}|\), where we choose \(p_{}\) to be a standard normal, and \(T^{-1}\) represents the following series of invertible mappings with learnable parameters \(\): [affine, \(\), affine, \(\), affine, \(\), affine, \(^{-1}]\), where \(^{-1}(y)=(e^{y}-1)\), affine\((y)=ay+b\) with learnable parameters \(a\) and \(b\). \(^{-1}\) ensures that the support of \(\) is non-negative, since we are ultimately interested in modeling the distribution of (non-negative) spike counts (Figure 2**C**, "Prior" sub-panel).

Figure 2: **A. Overview of the experimental setup for neuronal recordings (see Section 3.2 for a summary of the data description and Cadena et al.  for the complete details). B. Parameterized generative model for NSC: \(_{P}\): parameter of the prior \(p(;_{P})\); \(_{L}\): parameter of the likelihood \(p(|;_{L})\); \(\): parameters of the (approximate) posterior \(q(|;)\). C. Flexible prior, likelihood, and posterior models. The prior follows our dequantization framework consisting of 3 components: (1) continuous prior \(p(;)\) (normalizing flow with Gaussian base distribution), (2) quantizer \(P(|)\) (floor function), and (3) variational dequantizer \(q(|;)\) (a conditional normalizing flow, Appendix B). The likelihood is an isotropic Gaussian distribution over \(\), where the parameters are functions (MLP) of \(\). The posterior is a Gamma distribution over \(\) whose parameters are functions of \(\), modeled as a system identification-based convolutional neural-network model (Appendix C).**

For the dequantizer distribution, \(q(|;)\), we utilize a conditional normalizing flow-based flexible distribution, as in  (Appendix B).

LikelihoodWe model the likelihood as an isotropic Gaussian distribution:

\[p(|^{(i)})=(|^ {(i)},^{2(i)}),\] (9)

where the parameters mean, \(^{(i)}^{||}\) and variance, \(^{(i)}_{>0}^{||}\) are functions of response, \(^{(i)}\), and \(||\) is the number of dimensions of \(\). We consider (1) a linear function where \(=w_{}^{(i)}+b_{}\) and \(=^{w_{}^{(i)}+b_{}}\) (**Lin**) and (2) a nonlinear function \(=w_{}(^{(i)})+b_{}\) and \(=^{w_{}(^{(i)})+b_{}}\), where \(()\) is a neural network (**MLP**) (Figure 2**C** "Likelihood" sub-panel).

PosteriorIn many cases, the posterior distribution for a desired generative model is not analytically tractable and must be approximated, commonly using variational inference or Markov Chain Monte Carlo sampling [69; 70; 71]. Here, since we learn the generative model \(p(,;^{*})\), we can approximate the true posterior \(p(|;^{*})\) by fitting a model posterior \(q(|;)\) to samples from \(p(,;^{*})\) directly via maximum log-likelihood:

\[^{*}=_{}_{^{},^{}} q (^{}|^{};),\] (10)

where \(^{},^{} p(,; ^{*})\), are samples from the trained generative model. We model the posterior distribution of responses conditioned on images as a factorized Gamma distribution, following state-of-the-art (SOTA) work in system identification : \(p(|^{(i)})=_{j=1}^{S}p_{}( _{j}|^{(i)},^{(i)})\), where \(^{(i)}\) is the \(i\)th image, \(_{j}\) is the \(j\)th neuron out of \(||=S\) total neurons, and the parameters concentration, \(^{(i)}\) and rate, \(^{(i)}\) are functions of the image, \(^{(i)}\). Since these functions map an image to response distribution parameters, we model them using a convolutional neural network model (Figure 2**C** "Posterior" sub-panel), following SOTA system identification work [25; 27; 73] (Appendix C).

## 3 Experiments

### Synthetic data

We simulated 10,000 pairs of images and neuronal responses from the following three classical NSC models: \(.}}$}}}}.\) a Hoyer & Hyvarinen model (HNH) with an exponential prior , \(.}}$}}}}.\) an Olshausen & Field (ONF) model where the prior is a Laplace distribution , and \(.}}$}}}}.\) a full Gaussian model (Gauss) where the prior is an isotropic Gaussian with mean 0 and variance \(_{2}^{2}\). All the three models share a common linear, isotropic Gaussian likelihood \(p(|)=(|Ar,^{2} )\), where \(A\) is the factor loading matrix learned via standard independent component analysis model (ICA) with a complete basis on natural image patches [9; 74]. Additionally, we sampled image-response pairs from \(.}}$}}}}}.\) our flexible model with **Flow** prior (described in Section 2.2) and MLP-based likelihood (Section 2.2), where all parameters were randomly initialized. For any given generative model, we first sample neuronal responses from the prior via \(^{(i)} p()\), and then sample corresponding images via

  
**Prior** & **Likelihood** & **Name** \\  Exponential (\(=1\)) & Linear & Exp1-Lin \\ Exponential & Linear & Exp-Lin \\ Half-Normal & Linear & HN-Lin \\ Normalizing Flow & Linear & Flow-Lin \\ Exponential & MLP & Exp-MLP \\ Half-Normal & MLP & HN-MLP \\ Normalizing Flow & MLP & Flow-MLP \\   

Table 1: Generative models that we fit as being composed of priors and likelihoods.

\(^{(i)} p(|^{(i)})\), where \(i\). We hold out a set of 1,000 pairs as the test set. We fitted all models on the datasets simulated from the classical as well as the flexible models via Equation (7) and computed joint log-likelihoods of the trained models on the held-out test set as \( p(^{(i)},^{(i)})= p(^{(i )}|^{(i)})+ p(^{(i)})\). For the classical models, maximum likelihood estimates of the parameters were obtained analytically (Appendix F). We trained the flexible model using gradient descent.

We find that (1) the flexible model fits responses and images simulated under other NSC models well, i.e., learns \(p()\) and \(p(|)\) and closely approximates the log-likelihood of the true models. Importantly, it outperforms the fit of other NSC models with mismatched generative distributions, consistently being the best model after the ground-truth model (first 3 columns in Figure 3). Furthermore, the flexible model is capable of generating complex image and response distributions that could not be easily captured by the classical generative models (column 4 in Figure 3). This demonstrates that our framework allows for NSC model fitting and that the flexible model has the ability to flexibly capture the data distribution across a wide range of generative models. Critically, a flexible model could fit complex generative models that cannot be modeled well by other classical models.

### Neurophysiological data

Data descriptionNext, we demonstrate applying our approach to real neuronal data. We used 32-channel laminar NeuroNexus arrays (Figure 2**A**) to record population activity from the primary visual cortex (V1) of two awake male rhesus macaque monkeys (_Macaca muldata_)  as they fixated on grayscale natural images sampled from the ImageNet dataset . All the experiments concerned with the recordings adhered to the National Institutes of Health, United States guidelines, and received approval from the Institutional Animal Care and Use Committee. Each image was presented for 120 ms, and spike counts between 40 ms and 160 ms after the image onset were computed and used as the neuronal response \(\). The image stimulus \(\) used for modeling is 41 \(\) 41 px. For more details on the experiments and data collection, refer to Cadena et al. . We collected data across 12 recording sessions, each having approximately 16,000 image-response pairs and at least 16 well-isolated single units. We split the dataset into approximately 10,000 pairs for training, 3,000 pairs for validation, and 3,000 for testing (for exact details on all sessions, see Appendix D). We do not aggregate data across sessions and fit models separately for each session since the images can differ from session to session, and not all neurons have seen every image.

Fitting the generative modelGiven a dataset of images and responses, \(\{,\}_{i=0}^{N}\), we fit the likelihood \(p(|;_{L})\) on the image-response pairs and the prior \(p(;_{P})\) on the responses, \(\) as in Equation (7). We fit all of the generative models on each recording session as following procedure described in Table 1. Below, we describe our results for the session with the largest number of neurons (29 well-isolated single units) in detail and report summary results on all sessions.

For the prior models (Figure 4**A**), we report the test-set log-likelihood performance of all models (Exp, HN, Flow) relative to the Exp1-model as the baseline. We find that our flexible normalizing flow model (Flow) achieves the best performance, improving the score from the exponential distribution (Exp) by 0.095 bits per neuron per trial, amounting to 2.755 bits across 29 neurons per trial. For the likelihood models (Figure 4**B**), we find that using an MLP likelihood function, the model improved by 0.052 bits per pixel per trial, amounting to 87.19 bits of improvement across all 41\(\)41 pixels per trial, relative to the model with linear likelihood function. For the joint distribution (Figure 4**C**), we find that the flexible model (Flow-MLP) achieves the highest log-likelihood score, offering an improvement of 1.8452e-3 bits per pixel per neuron per trial, amounting to 89.951 bits across all 41\(\)41 pixels and 29 neurons per trial. We observed that in each of the cases, flexible models (Flow prior, MLP likelihood) offer much higher log-likelihood performance, with the same trend found across all sessions (Appendix D).

Figure 3: \( p(,)\) of models on simulated data (trial averaged, in bits). Column denotes the model generating the samples (data) and rows the trained NSC model. Since the exponential prior in HN has a non-negative support and does not match that of ONF and Gauss, the scores for HN under ONF and Gauss data are unavailable.

**Learning the posterior distribution** For each of the trained generative models, \(p(,;^{*})\), we approximated the model's posterior distribution \(p(|;^{*})\) using an approximate posterior \(q(|;)\) trained on samples drawn from the trained generative model (Equation (10), Algorithm 1). We evaluated the posterior distribution for each generative model by computing their mean log-likelihood on real neuronal responses conditioned on real images from the test set (Figure 5**A, B**). We also computed a single-trial correlation between the mean of the learned posterior distributions and neuronal responses (Figure 5**C, D**). Finally, we compared the posterior distribution to a deep system identification model.

We find that, in general, a more flexible trained generative model tends to yield a higher posterior predictive performance. Based on the log-likelihood evaluation, our flexible generative model (Flex-MLP) gained as much as 1.39 bits per neuron per trial compared to the baseline Exp1-Lin model and 0.61 bits per neuron per trial compared to Exp-Lin model (the Hoyer & Hyvarinen model ). In terms of single-trial correlation performance, our flexible generative model (Flex-MLP) achieved 10% higher correlation compared to the Exp1-Lin baseline and 8% higher correlation compared to Exp-Lin. When averaged across all sessions, we find that Flow-Lin performs best, almost on

Figure 4: Log-likelihood scores (in bits) of generative models on population recordings (test set) as fit on recording session with the highest number of neurons (\(n=29\)). Error-bars denote the standard error of mean across trials. **A**. Prior models, \(p()\): log-likelihood (lower bound) relative to the baseline Exp1 prior model. The score is averaged across neurons and trials. Note that for the prior models on discrete spike counts, \(\), we can only obtain a lower bound on \(p()\). Here we show the importance-sampling bound (Equation (11)) with 1000 samples. **B**. Likelihood models \(p(|)\): absolute log-likelihood of likelihood functions, averaged across image pixels and trials. **C**. Joint models \(p(,)\): log-likelihoods relative to the baseline Exp1-Lin generative model. The score is averaged across pixels, neurons and trials.

Figure 5: Posterior performance of NSC models, along with system identification model (“Sysident”). Error bars represent the standard error of mean over neuronal responses. All metrics are averaged over number of neurons and trials. **A**. The lower bound of log-likelihood in bits, for session with 29 neurons. We compute the lower-bound since we are evaluating the Gamma-posterior on (discrete) spike counts, and full-likelihood is intractable (Appendix G). **B**. Same as A but across all 12 sessions (purple: average, gray: single session). **C**. Single-trial correlation, for session with 29 neurons. **D**. Same as C across all 12 sessionspar with the Flow-MLP, which achieves 0.019 bits per neuron per trial less. Furthermore, a system identification model trained on the dataset of real neuronal responses performed better than the best NSC generative model, gaining 0.17 bits per neuron per trial and 17% higher correlation per neuron per trial compared to Flex-MLP.

All model training was performed using backpropagation and gradient descent and we provide training, compute and infrastructure details in Appendix E.

## 4 Discussion

The main focus of this work was to develop a way to answer the question, "How well does NSC explain neurophysiological data _quantitatively_?". While NSC is a prominent normative theory for probabilistic computation in the brain, and the literature has provided much qualitative insight, our work is the first to offer a quantitative paradigm for empirically testing it using brain responses to ecological, natural stimuli. Our framework additionally lets us formulate more flexible generative models -- which can be better informed by the data -- and employ standard metrics such as log-likelihood to quantitatively evaluate alternative generative models under NSC. Furthermore, inverting the learned generative model has allowed us to obtain the posterior distribution, which is equivalently a neuronal response predictive model. Importantly, this let us compare NSC models to models outside of NSC's theoretical framework, such as system identification models, allowing us to benchmark the predictive performance of NSC models. Our results demonstrated that the flexible generative models outperformed classical models in terms of both generative and predictive model performance, yet system identification models achieve superior response-predictive performance compared to even our best generative models. We now discuss some limitations of our current study and discuss a number of open questions and implement future directions.

**Limitations I: Assumption of strict 1:1 neuron-latent mapping**: One limitation in our current study is that we only use a 1:1 identity mapping between the activity of neurons and latent variables in our formulation of NSC. Abiding by this restriction could limit the capacity of the NSC models, especially considering some existing work in NSC that have qualitatively explored more flexible mappings. For example, Orban et al.  model membrane potential values (responses) as a nonlinear function of posterior samples. Furthermore, Savin and Deneve  map responses of \(N\) neurons to \(D\) latent variables where \(N>D\). Many more ways of how \(\) and \(\) relate are conceivable. However, our formulation with a separate \(\) and \(\) allows us to, in principle, incorporate different mappings and learn the corresponding generative models. Since the focus of this study was on the aspect of fitting NSC models to data, we chose the simplest (original) interpretation of NSC where \(\).

**Limitations II: Definition of a "sample" as total spike counts**: We defined a "sample" as the total spike count of neuronal activity within a specific time window following the stimulus, which is not necessarily what literature works do. However, to our knowledge, there is no generally agreed upon or rigorous definition of a "sample" in NSC. While NSC was originally motivated with firing rate/spike counts over a 500ms window as the sample [9; 21], many alternative definitions such as membrane potential over 10ms  have been employed. It is unclear on what generally applicable metric -- other than goodness of fit to data -- such a definition could be evaluated. This in fact served to us as another motivating factor for striving towards a data-driven evaluation of sampling models that would allow one to compare such choices in an informed manner. In this work, we chose the total spike count as the working definition.

**Limitations III: Better generative models are needed:** Advances in deep learning architectures, latent variable models, and transfer learning have greatly enhanced the capabilities of generative models in machine learning. We believe the models we chose, although more expressive than classical models, are still limiting, especially considering that our likelihood \(p(|)\) uses linear or MLP decoding from neurons to images, with a simple Gaussian noise model. To capture the rich and complex nature of neuronal representations of natural images, we believe it is necessary to consider more sophisticated generative models, that even incorporate a natural image prior, that would eventually close the gap in predictive performance between system identification performance and NSC generative models. Furthermore, an important avenue of research is identifying biological mechanisms that underlie NSC (i.e. sampling from the posterior) [14; 77; 78; 79; 80; 81; 82]. It is worth noting that our deep learning-based generative models are not meant to be mechanistic models of NSC neurons.

Rather, we believe that our approach lays the foundation for alternative biologically plausible models to be quantitatively evaluated and compared.

**Why do system identification models perform better than NSC generative models?** System identification models are directly trained discriminatively, i.e., \(_{}_{}[D_{}(p_{}( |)||p_{}(|; ))]\), to predict neuronal responses to natural images and deep-learning based ones are currently SOTA. There is still much room to build better generative models that would better explain the data (see Limitations III). However, for a given dataset of responses to stimuli from a _fixed stimulus distribution_, we do not expect the posterior of even the ideal generative model to surpass the performance of the ideal system identification model because the generative model training, i.e., \(_{}\{_{}[D_{}(p_{}(|)||p_{}(| ;))]+D_{}(p_{}( )||p_{}(;))\}\), does not provide any advantage over system identification in response prediction unless some specific inductive biases are introduced in the generative model.

**Why bother fitting NSC models if they fail to quantitatively compete with system identification?** If we change the stimulus distribution \(p()\) to \(p_{}()\) with markedly different stimulus statistics and let the sensory neurons adapt to \(p_{}()\), we would expect the system identification model's performance to drop on \(p_{}()\). The system identification model might have to be retrained on a new dataset of responses under \(p_{}()\). This is the case where we would expect the NSC's learned generative model to be beneficial. Specifically, change in \(p()\) to \(p_{}()\) may entirely derive from the change in prior \(p()\) to \(p_{}()\), while \(p(|)\) remains fixed. Hypothetically, this is since \(p(|)\) represents the invariant "physical" process by which the latents (e.g., the identity of an animal) give rise to observations (e.g., the appearance of the animal). Consequently, if NSC accurately describes a neural population, i.e, \( p(|) p(| )p()\), the neuronal adaptation can be accounted for by simply learning \(p_{}()\), i.e., \(_{} p_{}(|)  p(|)p_{}()\), keeping \(p(|)\) fixed. We believe such out-of-context generalization is a theoretical strength of NSC, and is a consequence of its normative nature (responses being "samples" from the _posterior distribution_). Such normative hypotheses are neither present in the purely phenomenological system identification models and nor is it straightforward to equip them with normative assumptions.

The above insight thus helps us identify potential future experiments to test NSC models utilizing our framework since it lets us learn the generative model \(p(|)p()\) via \(p(|)p()\) (NSC assumption). Namely, one could perform experiments in which we let the neural population adapt to different sensory contexts with expected shifts in \(p()\). Using our NSC framework, we would expect to be able to predict how neuronal responses should change (as reflected in updated \(_{} p_{}(|)\)) under new contexts.

**Why have previous works not fit NSC models to data?** We attribute the lack of such attempts to (1) limitations in data availability, (2) complexities involved in training flexible machine learning and inference algorithms on recorded data, and (3) the philosophical approach behind normative theories. Normative theories describe how a biological system _ought_ to function in order to tackle fundamental tasks. They propose models with parameters that are optimized for those tasks, without relying on actual experimental data . Typically normative theories are evaluated using qualitative agreements between the proposed models and data. NSC is itself a normative theory. In contrast, phenomenological approaches such as system identification propose models whose parameters are directly learned from experimental data. Normative and phenomenological approaches have historically been developed independently of each other. Similar to Mlynarski et al. , who interpolate between phenomenological and normative models via maximum entropy priors, our approach allows us to get the best of both worlds: state-of-the-art deep learning-based system identification models from phenomological approaches and the theoretical underpinnings of the normative NSC. System identification provides us with expressive models that faithfully model and predict the activity of thousands of neurons to rich natural stimuli. NSC, on the other hand, goes beyond what experimental data alone could offer by letting us hypothesize how neurons encode uncertainty about the stimulus, reflecting the posterior distribution over latent variables in a generative model of the world, thus allowing us make novel predictions such as about generalizability across stimulus contexts and design relevant experiments.