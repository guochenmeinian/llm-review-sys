# Rethinking Semi-Supervised Medical Image Segmentation: A Variance-Reduction Perspective

 Chenyu You\({}^{1}\)  Weicheng Dai\({}^{1}\)  Yifei Min\({}^{1}\)  Fenglin Liu\({}^{2}\)  David A. Clifton\({}^{2}\)

S. Kevin Zhou\({}^{3}\)  Lawrence Staib\({}^{1}\)  James S. Duncan\({}^{1}\)

\({}^{1}\)Yale University \({}^{2}\)University of Oxford \({}^{3}\)University of Science and Technology of China

###### Abstract

For medical image segmentation, contrastive learning is the dominant practice to improve the quality of visual representations by contrasting semantically similar and dissimilar pairs of samples. This is enabled by the observation that without accessing ground truth labels, negative examples with truly dissimilar anatomical features, if sampled, can significantly improve the performance. In reality, however, these samples may come from similar anatomical regions and the models may struggle to distinguish the minority tail-class samples, making the tail classes more prone to misclassification, both of which typically lead to model collapse. In this paper, we propose ARCO, a semi-supervised contrastive learning (CL) framework with stratified group theory for medical image segmentation. In particular, we first propose building ARCO through the concept of variance-reduced estimation and show that certain variance-reduction techniques are particularly beneficial in pixel/voxel-level segmentation tasks with extremely limited labels. Furthermore, we theoretically prove these sampling techniques are universal in variance reduction. Finally, we experimentally validate our approaches on eight benchmarks, _i.e._, five 2D/3D medical and three semantic segmentation datasets, with different label settings, and our methods consistently outperform state-of-the-art semi-supervised methods. Additionally, we augment the CL frameworks with these sampling techniques and demonstrate significant gains over previous methods. We believe our work is an important step towards semi-supervised medical image segmentation by quantifying the limitation of current self-supervision objectives for accomplishing such challenging safety-critical tasks. 1

Footnote 1: Codes are available on here.

## 1 Introduction

Model robustness and label efficiency are two highly desirable perspectives when it comes to building reliable medical segmentation models. In the context of medical image analysis, a model is said to be robust if (1) it has a high segmentation quality with only using extremely limited labels in long-tailed medical data; (2) and fast convergence speed [1, 2, 3]. The success of traditional supervised learning depends on training deep networks on a large amount of labeled data, but this improved segmentation/model robustness often comes at the cost of annotations and clinical expertise [4, 5, 6]. Therefore, it is difficult to adopt these models in real-world clinical applications.

Recently, a significant amount of research efforts [7, 8, 9, 10] have resorted to unsupervised or semi-supervised learning techniques for improving the segmentation robustness. One of the most effective methods is contrastive learning (CL) [11, 12, 13, 14]. It aims to learn useful representationsby contrasting semantically similar (positive) and dissimilar (negative) pairs of data points sampled from the massive unlabeled data. These methods fit particularly well with real-world clinical scenarios as we assume only access to a large amount of unlabelled data coupled with extremely limited labels. However, pixel-level contrastive learning with medical image segmentation is quite impractical since sampling all pixels can be extremely time-consuming and computationally expensive [15]. Fortunately, recent studies [16; 17] provide a remedy by leveraging the popular strategy of bootstrapping, which first actively samples a sparse set of pixel-level representation (queries), and then optimize the contrastive objective by pulling them to be close to the class mean averaged across all representations in this class (positive keys), and simultaneously pushing apart those representations from other class (negative keys). The demonstrated imbalancedness and diversity across various medical image datasets, as echoed in [18], show the positive sign of utilizing the massive unlabeled data with extremely limited annotations while maintaining the impressive segmentation performance compared to supervised counterparts. Meanwhile, it can lead to substantial memory/computation reduction when using pixel-level contrastive learning framework for medical image segmentation.

Nevertheless, in practical clinical settings, the deployed machine learning models often ask for strong robustness, which is far beyond the scope of segmentation quality for such challenging safety-critical scenarios. This leads to a more challenging requirement, which demands the models to be more robust to the _collapse_ problems whereby all representations collapse into constant features [14; 13; 19] or only span a lower-dimensional subspace [20; 21; 22; 23], as one main cause of such fragility could be attributed to the non-smooth feature space near samples [24; 25] (_i.e._, random sampling can result in large feature variations and even annotation information alter). Thus, it is a new perspective: _how to sample most informative pixels/voxels towards improving variance reduction in training semi-supervised contrastive learning models_. This inspires us to propose a new hypothesis of semi-supervised CL. Specifically, when directly baking in variance-reduction sampling into semi-supervised CL frameworks for medical image segmentation, the models can further push toward state-of-the-art segmentation robustness and label efficiency.

In this paper, we present ARCO, a semi-supervised str**A**tified g**R**oup **C**ontrastive learning framework with two perspectives (_i.e._, **segmentation/model robustness** and **label efficiency**), and with the aid of variance-reduction estimation, realize two practical solutions - Stratified Group (SG) and Stratified-Antithetic Group (SAG) - for selecting the most semantically informative pixels. ARCO is a group-based sampling method that builds a set of pixel groups and then proportionally samples from each group with respect to the class distribution. The **main idea** of our approach is via _first partitioning the image with respect to different classes into grids with the same size, and then sampling, within the same grid, pixels semantically close to each other with high probability, with minimal additional memory footprint_.

Subsequently, we show that baking ARCO into contrastive pre-training (_i.e._, MONA[17]) provides an efficient pixel-wise contrastive learning paradigm to train deep networks that perform well in long-tailed medical data. ARCO is easy to implement, being built on top of off-the-shelf pixel-level contrastive learning framework [13; 14; 26; 27; 28], and consistently improve overall segmentation quality across all label ratios and datasets (_i.e._, five 2D/3D medical and three semantic datasets).

Our theoretical analysis shows that, ARCO is more label efficient, providing practical means for computing the gradient estimator with improved variance reduction. Empirically, our approach achieves competitive results across eight 2D/3D medical and semantic segmentation benchmarks. Our proposed framework has several theoretical and practical contributions:

* We propose ARCO, a new CL framework based on stratified group theory to improve the label efficiency and model robustness trade-off in CL for medical image segmentation. We show that incorporating ARCO coupled with two special sampling methods, Stratified Group and Stratified-Antithetic Group, into the models provides an efficient learning paradigm to train deep networks that perform well in those long-tail clinical scenarios.
* To our best knowledge, we are the **first work** to show the benefit of certain variance-reduction techniques in CL for medical image segmentation. We demonstrate the unexplored advantage of the refined gradient estimator in handling long-tailed medical image data.
* We conduct extensive experiments to validate the effectiveness of our proposed method using a variety of datasets, network architectures, and different label ratios. For segmentation robustness/accuracy, we show that our proposed method by demonstrating superior segmentation accuracy (up to 11.08% absolute improvements in Dice). For label efficiency, our method trained with different labeled ratios - consistently achieves competitive performance improvements across all eight 2D/3D medical and semantic segmentation benchmarks.
* Theoretical analysis of ARCO shows improved variance reduction with optimization guarantee. We further demonstrate the intriguing property of ARCO across the different pixel-level contrastive learning frameworks.

## 2 Related work

Medical Image Segmentation.Contemporary medical image segmentation approaches typically build upon fully convolutional networks (FCN) [29] or UNet [30], which formulates the task as a dense classification problem. In general, current medical image segmentation methods can be cast into two sets: network design and optimization strategy. One is to optimize segmentation network design for improving feature representations through dilated/atrous/deformable convolutions [31; 32; 33], pyramid pooling [34; 35; 36], and attention mechanisms [37; 38; 39]. Most recent works [40; 41; 6] reformulates the task as a sequence-to-sequence prediction task by using the vision transformer (ViT) architecture [42; 43]. The other is to improve optimization strategies, by designing loss function to better address class imbalance [44] or refining uncertain pixels from high-frequency regions improving the segmentation quality [45; 46; 47; 48; 49]. In contrast, we take a leap further to a more practical clinical scenario by leveraging the massive unlabeled data with extremely limited labels in the learning stage. Moreover, we focus on building _model-agnostic_, label-efficiency framework to improve segmentation quality by providing additional supervision on the most confusing pixels for each class. In this work, we question how medical segmentation models behave under such imbalanced class distributions and whether they can perform well in those challenging scenarios through sampling methods.

Semi-Supervised Learning (SSL).SSL aims to train models with a combination of labeled, weakly-labeled and unlabelled data. In recent years, there has been a surge of work on semi-supervised medical segmentation [8; 9; 50; 48; 16; 51; 52; 17; 10; 53; 54], which makes it hard to present a complete overview here. We therefore only outline some key milestones related to this study. In general, it can be roughly categorized into two groups: (1) Consistency regularization was first proposed by [55], which aims to impose consistency corresponding to different perturbations into the training, such as consistency regularization [56; 57], pi-model [58], and mean-teacher [59; 60]. (2) Self-training was initially proposed in [61], which aims at using a model's predictions to obtain noisy pseudo-labels for performance boosts with minimal human labor, such as pseudo-labeling [7; 62], model uncertainty [8; 63], confidence estimation [64; 65; 66], and noisy student [67]. These methods usually lead to competitive performance but fail to prevent _collapse_ due to class imbalanceness. In this work, we focus on semi-supervised medical segmentation with extremely limited labels since the medical image data is extremely diverse and often long-tail distributed over anatomical classes. We speculate that a good medical segmentation model is expected to distinguish the minority tail-class samples and hence achieve better performance under additional supervision on hard pixels.

Contrastive Self-Supervised Learning.Self-supervised representation learning is a subclass of unsupervised learning, but with the critical distinction that it incorporates "inherent" supervision from the input data itself [68]. The primary aim of self-supervised representation learning is to enable the model to learn the most useful representations from the large amount of unlabelled data for various downstream tasks. Self-supervised learning typically relies on pretext tasks, including predictive [69; 70; 71], contextual [72; 73], and generative [74] or reconstructive [75] tasks.

Among them, contrastive learning is considered as a popular approach for self-supervised representation learning by pulling the representations of similar instances closer and representations of dissimilar instances further apart in the learned feature space [11; 12; 13; 14]. The past five years have seen tremendous progress related to CL in medical image segmentation [50; 23; 76; 48; 16; 17; 77], and it becomes increasingly important to improve representation in label-scarcity scenarios. The key idea in CL [11; 12; 13; 14] is to learn representations from unlabeled data that obey similarity constraints by pulling augmented views of the same samples closer in a representation space, and pushing apart augmented views of different samples. This is typically achieved by encoding a view of a data into a single global feature vector. However, the _global representation_ is sufficient for simple tasks like image classification, but does not necessarily achieve decent performance, especially for more challenging dense prediction tasks. On the other hand, several works on _dense contrastive learning_[50; 23], aim at providing additional supervision to capturing intrinsic spatial structure and fine-grained anatomical correspondence, while these methods may suffer from _class imbalance_ issues. Particularly, very recent work [16; 17] for the first time demonstrates the imbalancedness phenomenon can be mitigated by performing contrastive learning yet lacking stability. By contrast, a key motivation of our work is to bridge the connection between model robustness and label efficiency, which we believe is an important and under-explored area. We hence focus on variance-reduced estimation in medical image segmentation, and show that certain variance-reduction techniques can help provide more efficient approaches or alternative solutions for handling _collapse_ issues, and improving model robustness in terms of accuracy and stability. To the best of our knowledge, we are the first to provide a theoretical guarantee of robustness by using certain variance-reduction techniques.

## 3 Methodology

In this section we set-up our semi-supervised medical segmentation problem, introduce key definitions and notations and formulate an approach to incorporate stratified group theory. Then, we discuss how our proposed ARCO can directly bake in two perspectives into deep neural networks: (1) **model robustness**, and (2) **label efficiency**.

### Preliminaries and setup

Problem Definition.In this paper, we consider the multi-class medical image segmentation problem. Specifically, given a medical image dataset \((\mathcal{X},\mathcal{Y})\), we wish to automatically learn a segmentator, which assigns each pixel to their corresponding \(K\)-class segmentation labels. Let us denote \(\mathbf{x}\) as the input sample of the _student_ and _teacher_ networks \(F(\cdot)\)2, consisting of an encoder \(E\) and a decoder \(D\), and \(F\) is parameterized by weights \(\theta_{s}\) and \(\theta_{t}\).

Footnote 2: The student and teacher networks both adopt the 2D UNet[30] or 3D VNet[78] architectures.

Background.Contrastive learning aims to learn effective representations by pulling semantically close neighbors together and pushing apart other non-neighbors [11]. Among various popular contrastive learning frameworks, MONA[17] is easy-to-implement while yielding the state-of-the-art performance for semi-supervised medical image segmentation so far. The main idea of MONA is to discover diverse views (_i.e._, augmented/mined views) whose anatomical feature responses are _homogeneous_ within the same or different occurrences of the _same class type_, while at the same time being _distinctive_ for _different class types_.

Figure 1: **Pipeline overview. Our semi-supervised segmentation model \(F\) takes a 2D/3D medical image \(x\) as input and outputs the segmentation map and the representation map. We leverage a simplification of MONA pipeline [17] which is composed of two stages: (1) relational semi-supervised pre-training: on labeled data, the student network is trained by the ground-truth labels with the supervised loss \(\mathcal{L}_{\text{sup}}\); while on unlabeled data, the student network takes the _augmented_ and _mined_ embeddings from the EMA teacher for instance discrimination \(\mathcal{L}_{\text{inst}}\) in the global and local manner, (2) anatomical contrastive reconstruction fine-tuning: on labeled data, the student network is trained by the ground-truth labels with the supervised loss \(\mathcal{L}_{\text{sup}}\); while on unlabeled data, the student network takes the representation maps and pseudo labels from the EMA teacher to give more importance to tail class \(\mathcal{L}_{\text{contrast}}\), exploit the inter-instance relationship \(\mathcal{L}_{\text{nn}}\), and compute unsupervised loss \(\mathcal{L}_{\text{unsup}}\). See Appendix M for details of the visualization loss landscapes.**

Hereinafter, we are interested in showing that certain variance-reduction techniques coupled with CL frameworks are particularly beneficial in long-tail pixel/voxel-level segmentation tasks with extremely limited labels. We hence build our ARCO as a simplification of the MONA pipeline [17], without additional complex augmentation strategies, for deriving the **model robustness** and **label efficiency** proprieties of our medical segmentation model. Figure 1 overviews the high-level workflow of the proposed ARCO framework. Training ARCO involves a two-phase training procedure: (1) relational semi-supervised pre-training, and (2) anatomical contrastive fine-tuning. To make the discussion self-contained, we defer the full details of ARCO to the appendix E.

### Motivation and Challenges

Intuitively, the contrastive loss will learn generalizable, balanced and diverse representations for downstream medical segmentation tasks if the positive and negative pairs correspond to the desired latent anatomical classes [50; 16; 17]. Yet, one critical constraint in real-world clinical scenarios is severe _memory bottlenecks_[15; 16]. To address this issue, current pixel-level CL approaches [16; 17] for high-resolution medical images devise their aggregation rules by _unitary simulators_, _i.e._, _Naive Sampling_ (NS), that determines the empirical estimate from all available pixels. Despite the blessing of large learning capacity, such aggregation rules are _unreliable_ "black boxes". It is never well understood which rule existing CL models should use for improved **model robustness** and **label efficiency**; nor is it easy to compare different models and assess the model performance. Moreover, unitary simulators, especially naive sampling, often incur high variances and fail to identify semantically similar pixels [24], limiting CL stability. As demonstrated in Figure 3, regions of similar anatomical features should be grouped together in the original medical images, resulting in corresponding plateau regions in the visualization of the loss landscape. This is consistent with the observations uncovered by the recent empirical findings [79; 80].

If we take a unified mathematical perspective, the execution of simulation can be represented either through an _adaptive_ rule, or by a _unitary_ simulation. To tackle the two critical issues, we look back at adaptive rules. We hence propose two straightforward yet effective techniques - Stratified Group (SG) and Stratified-Antibetic Group (SAG) - to mitigate the undesirable high-variance limitation, and turn to the following idea of sampling the most representative pixels from groups of semantically similar pixels. In particular, our proposed solution is based on stratified group simulation to adaptively characterize anatomical regions found on different medical images. This characterization is succinct, and regions with the same anatomical properties within different medical images are identifiable. _In practice, we first partition the image with respect to different classes into grids with the same size, and then sampling, within the same grid, the pixels semantically close to each other with high probability, with minimal additional memory footprint (Figure 2)._

In what follows, we will theoretically demonstrate the important properties of such techniques (_i.e._, SG and SAG), especially in reduced variance and unbiasedness. Here the reduced variance implies more robust gradient estimates in the backpropagation, and leads to faster and stabler training in theory, as corroborated by our experiments (Section 4). Empirically, we will demonstrate many practical benefits of reduced variances including improved model robustness, _i.e._, faster convergence and better segmentation quality, through mitigating the _collapse_ issue.

### Stratified Group Sampling

To be consistent with the previous notation, we denote an arbitrary image from the given medical image dataset as \(\mathbf{x}\in\mathcal{X}\), and \(\mathcal{P}\) as the set of pixels. For arbitrary function \(h:\mathcal{X}\times\mathcal{P}\rightarrow\mathbb{R}\), we define

Figure 2: Overview of three sampling methods. (1) Naive Sampling, (2) Stratified Group Sampling, and (3) Stratified-Antibetic Group Sampling.

the aggregation function \(H\)3 as:

Footnote 3: The pixel-level contrastive loss \(\mathcal{L}_{\text{contrast}}\) is an example of an aggregation function (up to normalizing constant) according to Eqn. (E.2).

\[H(\mathbf{x})=\frac{1}{|\mathcal{P}|}\sum_{p\in\mathcal{P}}h(\mathbf{x};p).\] (3.1)

As a large cardinality of \(\mathcal{P}\) prevents efficient direct computation of \(H\), an immediate approach is to compute \(H(\mathbf{x})\) by first sampling a subset of pixels \(\mathcal{D}\!\subseteq\!\mathcal{P}\) according to certain sampling strategy, and then computing \(\widehat{H}(\mathbf{x};\mathcal{D})\!=\!\sum_{p\in\mathcal{D}}h(\mathbf{x};p)/ |\mathcal{D}|\). SG sampling achieves this by first decomposing the pixels into \(M\) disjoint groups \(\mathcal{P}_{m}\) satisfying \(\cup_{m=1}^{M}\mathcal{P}_{m}=\mathcal{P}\), and then sampling \(\mathcal{D}_{m}\subseteq\mathcal{P}_{m}\) so that \(\mathcal{D}=\cup_{m=1}^{M}\mathcal{D}_{m}\). The SG sampling can then be written as:

\[\widehat{H}_{\text{SG}}(\mathbf{x};\mathcal{D})=\frac{1}{M}\sum_{m=1}^{M} \frac{1}{|\mathcal{D}_{m}|}\sum_{p\in\mathcal{D}_{m}}h(\mathbf{x};p).\]

SAG, built upon SG, adopts a similar form, except for an additionally enforced symmetry on \(\mathcal{D}_{m}\): \(\forall\ m,\ \exists\ c_{m}\in\mathcal{P}_{m},\) such that for any \(p\in\mathcal{D}_{m}\),

\[c_{m}-p=p^{\prime}-c_{m},\text{ for some }\ p^{\prime}\in\mathcal{D}_{m}.\]

Here \(c_{m}\) denotes the center of the group \(\mathcal{P}_{m}\)4. The implementation of SG and SAG involves two steps: (1) to create groups \(\{\mathcal{P}_{m}\}_{m=1}^{M}\), and (2) to generate each \(\mathcal{D}_{m}\subseteq\mathcal{P}_{m}\). For the latter, we consider independent sampling within and between groups, _i.e._, \(\mathcal{D}_{m}\perp\!\!\!\perp\mathcal{D}_{m^{\prime}}\) for \(m\neq m^{\prime}\), and \(p\perp\!\!\!\perp p^{\prime}\ \forall\ p\), \(p^{\prime}\in\mathcal{D}_{m}\), where the variance of SG sampling is as follows.

Footnote 4: The choice of \(c_{m}\) is flexible. For example, if the convex hull of the pixels in \(\mathcal{P}_{m}\) form a circle, then \(c_{m}\) can be taken as the geometric center.

**Lemma 3.1**.: _Suppose in SG sampling, for each \(m\), \(\mathcal{D}_{m}\) is sampled from \(\mathcal{P}_{m}\) with sampling variance \(\sigma_{m}^{2}\) and sample size \(|\mathcal{D}_{m}|=n_{m}\). Then the variance satisfies \(\operatorname{Var}[\widehat{H}_{\text{SG}}]=\sum_{m=1}^{M}\sigma_{m}^{2}n_{m}/n\), and SAG with the same sample size satisfies \(\operatorname{Var}[\widehat{H}_{\text{SAG}}]\leq 2\operatorname{Var}[\widehat{H}_{ \text{SG}}]\)._

To ensure the unbiasedness property, we adopt the setting of proportional group sizes [85, 86], _i.e._, \(|\mathcal{D}_{m}|\propto|\mathcal{P}_{m}|\) for all \(m\). It turns out that such setting also enjoys the variance-reduction property.

**Theorem 3.2** (Unbiasedness and Variance of SG).: _SG with proportional group sizes is unbiased, and has a variance no larger than that of NS. That is: \(\mathbb{E}[\widehat{H}_{\text{SG}}(\mathbf{x})]=H(\mathbf{x})\), and_

\[\operatorname{Var}[\widehat{H}_{\text{SG}}]=\operatorname{Var}[\widehat{H}_{ \text{NS}}]-\frac{1}{n}\sum_{m=1}^{M}\left(\mathbb{E}_{p\stackrel{{ \text{int.}}}{{\sim}}\mathcal{P}_{m}}[h(\mathbf{x};p)]-\mathbb{E}_{p \stackrel{{\text{int.}}}{{\sim}}\mathcal{P}}[h(\mathbf{x};p)] \right)^{2}.\]

The last term is the intra-group variance, which captures the discrepancy between the pixel groups \(\{\mathcal{P}_{m}\}_{m=1}^{M}\). Theorem 3.2 guarantees that the variance of SG is no larger than that of NS, and SG

Figure 3: Loss landscape visualization of pixel-wise contrastive loss \(\mathcal{L}_{\text{contrast}}\) with ARCO-SG. Loss plots are generated with same original images randomly chosen from ACDC [81], LiTS [82], MMWHS [83], LA [84], and MP-MRI, respectively. \(z\)-axis denotes the loss value at each pixel. For each example of the five benchmarks, the left subplot indicates that similar anatomical features are grouped together in the original medical images, as shown by different anatomical regions in different colors.

[MISSING_PAGE_FAIL:7]

[MISSING_PAGE_FAIL:8]

[MISSING_PAGE_FAIL:9]

Importance of Augmentation Components.We further investigate the impact of data augmentation on the ACDC dataset with a 1% label ratio. As is shown in Table 4 (in Appendix), employing each data augmentation strategy consistently results in notable performance improvements, underscoring the efficacy of these data augmentations. Of note, ARCO-SAG/ARCO-SG using all three augmentations and ARCO-SAG/ARCO-SG using no augmentation are considered as the upper bound and the lower bound for the performance comparison. These results show that each augmentation strategy systematically boosts performance by a large margin, which suggests improved robustness.

Stability Analyses.In Figure 5, we show the stability analysis results on ARCO over different sampling methods. As we can see, our SG and SAG sampling facilitates convergence during the training. More importantly, SG sampling has stable performance with small standard derivations, which aligns with our hypothesis that our proposed sampling method can be viewed as the form of variance regularization. Moreover, loss landscape visualization of different loss functions (Figure 3) reveals similar conclusions.

Extra Study.More investigations about (1) generalization across label ratios and frameworks in Appendix L; (2) final checkpoint loss landscapes in Appendix M; (3) ablation on different training settings are in Appendix N.

## 5 Conclusion and Discussion of Broader Impact

In this paper, we propose ARCO, a new semi-supervised contrastive learning framework for improved model robustness and label efficiency in medical image segmentation. Specifically, we propose two practical solutions via stratified group theory that correct for the variance introduced by the common sampling practice, and achieve significant performance benefits. Our theoretical findings indicate Stratified Group and Stratified-Antithetic Group Sampling provide practical means for improving variance reduction. It presents a curated and easily adaptable training toolkit for training deep networks that generalize well beyond training data in those long-tail clinical scenarios. Moreover, our sampling techniques can provide pragmatic solutions for enhancing variance reduction, thereby fostering their application in a wide array of real-world applications and sectors. These include but are not limited to 3D rendering, augmented reality, virtual reality, trajectory prediction, and autonomous driving. We hope this study could be a stepping stone towards by quantifying the limitation of current self-supervision objectives for accomplishing such challenging safety-critical tasks.

Broader Impact.Defending machine learning models against inevitable variance will have the great potential to build more reliable and trustworthy clinical AI. Our findings show that the stratified group theory can provide practical means for improving variance reduction, leading to realistic deployments in a large variety of real-world clinical applications. Besides, we should address the challenges of fairness or privacy in the medical image analysis domain as our future research direction.

Figure 5: Visualization of training trajectories given by \(\mathcal{L}_{\text{contrast}}\) vs. epochs on ACDC under 10% label ratio. The proposed ARCO is compared in terms of different sampling methods: Naive Sampling (NS), Stratified Group (SG) Sampling, and Stratified-Antithetic Group (SAG) Sampling. The solid line and shaded area of each sampling method denote the mean and variance of test accuracies over 3 independent trials. Clearly, we observe SG sampling consistently outperforms the other sampling methods in convergence speed and training stability. SAG slightly outperforms NS.

## References

* Bastani et al. [2016] Osbert Bastani, Yani Ioannou, Leonidas Lampropoulos, Dimitrios Vytiniotis, Aditya Nori, and Antonio Criminisi. Measuring neural net robustness with constraints. In _NeurIPS_, 2016.
* Carlini and Wagner [2017] Nicholas Carlini and David Wagner. Towards evaluating the robustness of neural networks. In _IEEE symposium on security and privacy (sp)_, 2017.
* Singh et al. [2018] Gagandeep Singh, Timon Gehr, Matthew Mirman, Markus Puschel, and Martin Vechev. Fast and effective robustness certification. In _NeurIPS_, 2018.
* Greenspan et al. [2016] Hayit Greenspan, Bram Van Ginneken, and Ronald M Summers. Guest editorial deep learning in medical imaging: Overview and future promise of an exciting new technique. _IEEE Trans. Med. Imaging_, 2016.
* Raghu et al. [2019] Maithra Raghu, Chiyuan Zhang, Jon Kleinberg, and Samy Bengio. Transfusion: Understanding transfer learning for medical imaging. In _NeurIPS_, 2019.
* You et al. [2022] Chenyu You, Ruihan Zhao, Fenglin Liu, Siyuan Dong, Sandeep Chinchali, Ufuk Topcu, Lawrence Staib, and James Duncan. Class-aware adversarial transformers for medical image segmentation. In _NeurIPS_, 2022.
* Bai et al. [2017] Wenjia Bai, Ozan Oktay, Matthew Sinclair, Hideaki Suzuki, Martin Rajchl, Giacomo Tarroni, Ben Glocker, Andrew King, Paul M Matthews, and Daniel Rueckert. Semi-supervised learning for network-based cardiac mr image segmentation. In _MICCAI_, 2017.
* Yu et al. [2019] Lequan Yu, Shujun Wang, Xiaomeng Li, Chi-Wing Fu, and Pheng-Ann Heng. Uncertainty-aware self-ensembling model for semi-supervised 3d left atrium segmentation. In _MICCAI_, 2019.
* Luo et al. [2020] Xiangde Luo, Jieneng Chen, Tao Song, and Guotai Wang. Semi-supervised medical image segmentation through dual-task consistency. In _AAAI_, 2020.
* Wu et al. [2022] Yicheng Wu, Zongyuan Ge, Donghao Zhang, Minfeng Xu, Lei Zhang, Yong Xia, and Jianfei Cai. Mutual consistency learning for semi-supervised medical image segmentation. _Medical Image Analysis_, 2022.
* Hadsell et al. [2006] Raia Hadsell, Sumit Chopra, and Yann LeCun. Dimensionality reduction by learning an invariant mapping. In _CVPR_, 2006.
* Oord et al. [2018] Aaron van den Oord, Yazhe Li, and Oriol Vinyals. Representation learning with contrastive predictive coding. _arXiv preprint arXiv:1807.03748_, 2018.
* He et al. [2020] Kaiming He, Haoqi Fan, Yuxin Wu, Saining Xie, and Ross Girshick. Momentum contrast for unsupervised visual representation learning. In _CVPR_, 2020.
* Chen et al. [2020] Ting Chen, Simon Kornblith, Mohammad Norouzi, and Geoffrey Hinton. A simple framework for contrastive learning of visual representations. In _ICML_, 2020.
* Yan et al. [2022] Ke Yan, Jinzheng Cai, Dakai Jin, Shun Miao, Dazhou Guo, Adam P Harrison, Youbao Tang, Jing Xiao, Jingjing Lu, and Le Lu. Sam: Self-supervised learning of pixel-wise anatomical embeddings in radiological images. _IEEE Transactions on Medical Imaging_, 2022.
* You et al. [2023] Chenyu You, Weicheng Dai, Lawrence Staib, and James S Duncan. Bootstrapping semi-supervised medical image segmentation with anatomical-aware contrastive distillation. In _IPMI_, 2023.
* You et al. [2022] Chenyu You, Weicheng Dai, Fenglin Liu, Haoran Su, Xiaoran Zhang, Lawrence Staib, and James S Duncan. Mine your own anatomy: Revisiting medical image segmentation with extremely limited labels. _arXiv preprint arXiv:2209.13476_, 2022.
* Li et al. [2019] Zeju Li, Konstantinos Kamnitsas, and Ben Glocker. Overfitting of neural nets under class imbalance: Analysis and improvements for segmentation. In _MICCAI_, 2019.
* Zbontar et al. [2021] Jure Zbontar, Li Jing, Ishan Misra, Yann LeCun, and Stephane Deny. Barlow twins: Self-supervised learning via redundancy reduction. In _ICML_. PMLR, 2021.
* Hua et al. [2021] Tianyu Hua, Wenxiao Wang, Zihui Xue, Sucheng Ren, Yue Wang, and Hang Zhao. On feature decorrelation in self-supervised learning. In _ICCV_, 2021.
* Jing et al. [2021] Li Jing, Pascal Vincent, Yann LeCun, and Yuandong Tian. Understanding dimensional collapse in contrastive self-supervised learning. _arXiv preprint arXiv:2110.09348_, 2021.

* [22] Yuandong Tian, Xinlei Chen, and Surya Ganguli. Understanding self-supervised learning dynamics without contrastive pairs. In _ICML_. PMLR, 2021.
* [23] Chenyu You, Ruihan Zhao, Lawrence H Staib, and James S Duncan. Momentum contrastive voxel-wise representation learning for semi-supervised volumetric medical image segmentation. In _MICCAI_, 2022.
* [24] Ziyu Jiang, Tianlong Chen, Ting Chen, and Zhangyang Wang. Improving contrastive learning on imbalanced data via open-world sampling. In _NeurIPS_, 2021.
* [25] Zhengfeng Lai, Chao Wang, Henry Gunawan, Sen-Ching S Cheung, and Chen-Nee Chuah. Smoothed adaptive weighting for imbalanced semi-supervised learning: Improve reliability against unknown distribution data. In _ICML_, 2022.
* [26] Jean-Bastien Grill, Florian Strub, Florent Altche, Corentin Tallec, Pierre Richemond, Elena Buchatskaya, Carl Doersch, Bernardo Avila Pires, Zhaohan Guo, Mohammad Gheshlaghi Azar, et al. Bootstrap your own latent-a new approach to self-supervised learning. In _NeurIPS_, 2020.
* [27] Ajinkya Tejankar, Soroush Abbasi Koohpayegani, Vipin Pillai, Paolo Favaro, and Hamed Pirsiavash. Isd: Self-supervised learning by iterative similarity distillation. In _ICCV_, 2021.
* [28] Adrien Bardes, Jean Ponce, and Yann LeCun. Vicreg: Variance-invariance-covariance regularization for self-supervised learning. _arXiv preprint arXiv:2105.04906_, 2021.
* [29] Jonathan Long, Evan Shelhamer, and Trevor Darrell. Fully convolutional networks for semantic segmentation. In _CVPR_, 2015.
* [30] Olaf Ronneberger, Philipp Fischer, and Thomas Brox. U-net: Convolutional networks for biomedical image segmentation. In _MICCAI_, 2015.
* [31] Liang-Chieh Chen, George Papandreou, Iasonas Kokkinos, Kevin Murphy, and Alan L Yuille. Deeplab: Semantic image segmentation with deep convolutional nets, atrous convolution, and fully connected crfs. _IEEE TPAMI_, 2017.
* [32] Liang-Chieh Chen, Yukun Zhu, George Papandreou, Florian Schroff, and Hartwig Adam. Encoder-decoder with atrous separable convolution for semantic image segmentation. In _ECCV_, 2018.
* [33] Jifeng Dai, Haozhi Qi, Yuwen Xiong, Yi Li, Guodong Zhang, Han Hu, and Yichen Wei. Deformable convolutional networks. In _CVPR_, 2017.
* [34] Hengshuang Zhao, Jianping Shi, Xiaojuan Qi, Xiaogang Wang, and Jiaya Jia. Pyramid scene parsing network. In _CVPR_, 2017.
* [35] Liang Chen, Paul Bentley, Kensaku Mori, Kazunari Misawa, Michitaka Fujiwara, and Daniel Rueckert. Drinet for medical image segmentation. _IEEE Trans. Med. Imaging_, 2018.
* [36] Yunhe Gao, Rui Huang, Ming Chen, Zhe Wang, Jincheng Deng, Yuanyuan Chen, Yiwei Yang, Jie Zhang, Chanjuan Tao, and Hongsheng Li. Focusnet: Imbalanced large and small organ segmentation with an end-to-end deep neural network for head and neck ct images. In _MICCAI_. Springer, 2019.
* [37] Ozan Oktay, Jo Schlemper, Loic Le Folgoc, Matthew Lee, Mattias Heinrich, Kazunari Misawa, Kensaku Mori, Steven McDonagh, Nils Y Hammerla, Bernhard Kainz, et al. Attention u-net: Learning where to look for the pancreas. _arXiv preprint arXiv:1804.03999_, 2018.
* [38] Dong Nie, Yaozong Gao, Li Wang, and Dinggang Shen. Asdnet: Attention based semi-supervised deep networks for medical image segmentation. In _MICCAI_, 2018.
* [39] Ran Gu, Guotai Wang, Tao Song, Rui Huang, Michael Aertsen, Jan Deprest, Sebastien Ourselin, Tom Vercauteren, and Shaoting Zhang. Ca-net: Comprehensive attention convolutional neural networks for explainable medical image segmentation. _IEEE Trans. Med. Imaging_, 2020.
* [40] Jieneng Chen, Yongyi Lu, Qihang Yu, Xiangde Luo, Ehsan Adeli, Yan Wang, Le Lu, Alan L Yuille, and Yuyin Zhou. Transunet: Transformers make strong encoders for medical image segmentation. In _MICCAI_, 2021.
* [41] Ali Hatamizadeh, Yucheng Tang, Vishwesh Nath, Dong Yang, Andriy Myronenko, Bennett Landman, Holger Roth, and Daguang Xu. Unetr: Transformers for 3d medical image segmentation. _arXiv preprint arXiv:2103.10504_, 2021.
* [42] Ashish Vaswani, Noam Shazeer, Niki Parmar, Jakob Uszkoreit, Llion Jones, Aidan N Gomez, Lukasz Kaiser, and Illia Polosukhin. Attention is all you need. In _NeurIPS_, 2017.

* [43] Alexey Dosovitskiy, Lucas Beyer, Alexander Kolesnikov, Dirk Weissenborn, Xiaohua Zhai, Thomas Unterthiner, Mostafa Dehghani, Matthias Minderer, Georg Heigold, Sylvain Gelly, et al. An image is worth 16x16 words: Transformers for image recognition at scale. In _ICLR_, 2020.
* [44] Tsung-Yi Lin, Priya Goyal, Ross Girshick, Kaiming He, and Piotr Dollar. Focal loss for dense object detection. In _ICCV_, 2017.
* [45] Yuan Xue, Hui Tang, Zhi Qiao, Guanzhong Gong, Yong Yin, Zhen Qian, Chao Huang, Wei Fan, and Xiaolei Huang. Shape-aware organ segmentation by predicting signed distance maps. _arXiv preprint arXiv:1912.03849_, 2019.
* [46] Gonglei Shi, Li Xiao, Yang Chen, and S Kevin Zhou. Marginal loss and exclusion loss for partially supervised multi-organ segmentation. _Medical Image Analysis_, 2021.
* [47] Zhengfeng Lai, Chao Wang, Sen-ching Cheung, and Chen-Nee Chuah. Sar: Self-adaptive refinement on pseudo labels for multiclass-imbalanced semi-supervised learning. In _Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern Recognition_, pages 4091-4100, 2022.
* [48] Chenyu You, Yuan Zhou, Ruihan Zhao, Lawrence Staib, and James S Duncan. Simcvd: Simple contrastive voxel-wise representation distillation for semi-supervised medical image segmentation. _IEEE Transactions on Medical Imaging_, 2022.
* [49] Chenyu You, Weicheng Dai, Yifei Min, Lawrence Staib, and James S Duncan. Implicit anatomical rendering for medical image segmentation with stochastic experts. In _MICCAI_, 2023.
* [50] Krishna Chaitanya, Ertunc Erdil, Neerav Karani, and Ender Konukoglu. Contrastive learning of global and local features for medical image segmentation with limited annotations. In _NeurIPS_, 2020.
* [51] Zhengfeng Lai, Chao Wang, Zin Hu, Brittany N Dugger, Sen-Ching Cheung, and Chen-Nee Chuah. A semi-supervised learning for segmentation of gigapixel histopathology images from brain tissues. In _International conference of the IEEE engineering in Medicine & Biology Society (EMBC)_, 2021.
* [52] Zhengfeng Lai, Chao Wang, Luca Cerny Oliveira, Brittany N Dugger, Sen-Ching Cheung, and Chen-Nee Chuah. Joint semi-supervised and active learning for segmentation of gigapixel pathology images with cost-effective labeling. In _ICCV_, 2021.
* [53] Yicheng Wu, Zhonghua Wu, Qianyi Wu, Zongyuan Ge, and Jianfei Cai. Exploring smoothness and class-separation for semi-supervised medical image segmentation. In _MICCAI_, 2022.
* [54] Chenyu You, Weicheng Dai, Yifei Min, Lawrence Staib, Jas Sekhon, and James S Duncan. ACTION++: Improving semi-supervised medical image segmentation with adaptive anatomical contrast. In _MICCAI_, 2023.
* [55] Philip Bachman, Ouais Alsharif, and Doina Precup. Learning with pseudo-ensembles. In _NeurIPS_, 2014.
* [56] Gerda Bortsova, Florian Dubost, Laurens Hogeweg, Ioannis Katramados, and Marleen de Bruijne. Semi-supervised medical image segmentation via learning consistency under transformations. In _MICCAI_, 2019.
* [57] Xiangde Luo, Wenjun Liao, Jieneng Chen, Tao Song, Yinan Chen, Shichuan Zhang, Nianyong Chen, Guotai Wang, and Shaoting Zhang. Efficient semi-supervised gross target volume of nasopharyngeal carcinoma segmentation via uncertainty rectified pyramid consistency. In _MICCAI_, 2021.
* [58] Mehdi Sajjadi, Mehran Javanmardi, and Tolga Tasdizen. Regularization with stochastic transformations and perturbations for deep semi-supervised learning. In _NeurIPS_, 2016.
* [59] Antti Tarvainen and Harri Valpola. Mean teachers are better role models: Weight-averaged consistency targets improve semi-supervised deep learning results. In _NeurIPS_, 2017.
* [60] Simon Reiss, Constantin Seibold, Alexander Freytag, Erik Rodner, and Rainer Stiefelhagen. Every annotation counts: Multi-label deep supervision for medical image segmentation. In _CVPR_, 2021.
* [61] Henry Scudder. Probability of error of some adaptive pattern-recognition machines. _IEEE Trans. Inf. Theory_, 1965.
* [62] Xiaokang Chen, Yuhui Yuan, Gang Zeng, and Jingdong Wang. Semi-supervised semantic segmentation with cross pseudo supervision. In _CVPR_, 2021.
* [63] Tanya Nair, Doina Precup, Douglas L Arnold, and Tal Arbel. Exploring uncertainty measures in deep networks for multiple sclerosis lesion detection and segmentation. _Medical image analysis_, 2020.

* [64] Charles Blundell, Julien Cornebise, Koray Kavukcuoglu, and Daan Wierstra. Weight uncertainty in neural network. In _ICML_, 2015.
* [65] Yarin Gal and Zoubin Ghahramani. Dropout as a bayesian approximation: Representing model uncertainty in deep learning. In _ICML_, 2016.
* [66] Alex Kendall and Yarin Gal. What uncertainties do we need in bayesian deep learning for computer vision? In _NeurIPS_, 2017.
* [67] Qizhe Xie, Minh-Thang Luong, Eduard Hovy, and Quoc V Le. Self-training with noisy student improves imagenet classification. In _CVPR_, 2020.
* [68] Alexey Dosovitskiy, Jost Tobias Springenberg, Martin Riedmiller, and Thomas Brox. Discriminative unsupervised feature learning with convolutional neural networks. In _NeurIPS_, 2014.
* [69] Carl Doersch, Abhinav Gupta, and Alexei A Efros. Unsupervised visual representation learning by context prediction. In _ICCV_, 2015.
* [70] Carl Doersch and Andrew Zisserman. Multi-task self-supervised visual learning. In _ICCV_, 2017.
* [71] Mehdi Noroozi and Paolo Favaro. Unsupervised learning of visual representations by solving jigsaw puzzles. In _ECCV_, 2016.
* [72] Richard Zhang, Phillip Isola, and Alexei A Efros. Colorful image colorization. In _ECCV_, 2016.
* [73] Gustav Larsson, Michael Maire, and Gregory Shakhnarovich. Learning representations for automatic colorization. In _ECCV_, 2016.
* [74] Deepak Pathak, Philipp Krahenbuhl, Jeff Donahue, Trevor Darrell, and Alexei A Efros. Context encoders: Feature learning by inpainting. In _CVPR_, 2016.
* [75] Kaiming He, Xinlei Chen, Saining Xie, Yanghao Li, Piotr Dollar, and Ross Girshick. Masked autoencoders are scalable vision learners. In _CVPR_, 2022.
* [76] Krishna Chaitanya, Ertunc Erdil, Neerav Karani, and Ender Konukoglu. Local contrastive loss with pseudo-label based self-training for semi-supervised medical image segmentation. _arXiv preprint arXiv:2112.09645_, 2021.
* [77] Quan Quan, Qingsong Yao, Jun Li, and S. kevin Zhou. Information-guided pixel augmentation for pixel-wise contrastive learning. _arXiv preprint arXiv:2211.07118_, 2022.
* [78] Fausto Milletari, Nassir Navab, and Seyed-Ahmad Ahmadi. V-net: Fully convolutional neural networks for volumetric medical image segmentation. In _3DV_. IEEE, 2016.
* [79] Heliang Zheng, Jianlong Fu, Zheng-Jun Zha, and Jiebo Luo. Learning deep bilinear transformation for fine-grained image representation. In _NeurIPS_, 2019.
* [80] Ting Chen, Calvin Luo, and Lala Li. Intriguing properties of contrastive losses. In _NeurIPS_, 2021.
* [81] Olivier Bernard, Alain Lalande, Clement Zotti, Frederick Cervenansky, Xin Yang, Pheng-Ann Heng, Irem Cetin, Karim Lekadir, Oscar Camara, Miguel Angel Gonzalez Ballester, et al. Deep learning techniques for automatic MRI cardiac multi-structures segmentation and diagnosis: Is the problem solved? _IEEE Transactions on Medical Imaging_, 2018.
* [82] Patrick Bilic, Patrick Ferdinand Christ, Eugene Vorontsov, Grzegorz Chlebus, Hao Chen, Qi Dou, Chi-Wing Fu, Xiao Han, Pheng-Ann Heng, Jurgen Hesser, et al. The liver tumor segmentation benchmark (lits). _arXiv preprint arXiv:1901.04056_, 2019.
* [83] Xiahai Zhuang and Juan Shen. Multi-scale patch and multi-modality atlases for whole heart segmentation of mri. _Medical image analysis_, 2016.
* [84] Zhaohan Xiong, Qing Xia, Zhiqiang Hu, Ning Huang, Cheng Bian, Yefeng Zheng, Sulaiman Vesal, Nishant Ravikumar, Andreas Maier, Xin Yang, et al. A global benchmark of algorithms for segmenting the left atrium from late gadolinium-enhanced cardiac magnetic resonance imaging. _Medical Image Analysis_, 2021.
* [85] William G Cochran. _Sampling techniques_. John Wiley & Sons, 1977.
* [86] Soren Asmussen and Peter W Glynn. _Stochastic simulation: algorithms and analysis_, volume 57. Springer, 2007.

* [87] Dimitri P Bertsekas and John N Tsitsiklis. Gradient convergence in gradient methods with errors. _SIAM Journal on Optimization_, 10(3):627-642, 2000.
* [88] Leon Bottou, Frank E Curtis, and Jorge Nocedal. Optimization methods for large-scale machine learning. _Siam Review_, 60(2):223-311, 2018.
* [89] Zeyuan Allen-Zhu. How to make the gradients small stochastically: Even faster convex and nonconvex sgd. In _NeurIPS_, 2018.
* [90] Tuan-Hung Vu, Himalaya Jain, Maxime Bucher, Matthieu Cord, and Patrick Perez. Advent: Adversarial entropy minimization for domain adaptation in semantic segmentation. In _CVPR_, 2019.
* [91] Yassine Ouali, Celine Hudelot, and Myriam Tami. Semi-supervised semantic segmentation with cross-consistency training. In _CVPR_, 2020.
* [92] Yizhe Zhang, Lin Yang, Jianxu Chen, Maridel Fredericksen, David P Hughes, and Danny Z Chen. Deep adversarial networks for biomedical image segmentation utilizing unannotated images. In _MICCAI_, 2017.
* [93] Siyuan Qiao, Wei Shen, Zhishuai Zhang, Bo Wang, and Alan Yuille. Deep co-training for semi-supervised image recognition. In _ECCV_, 2018.
* [94] Shuailin Li, Chuyu Zhang, and Xuming He. Shape-aware semi-supervised 3d semantic segmentation for medical images. In _MICCAI_, 2020.
* [95] Vikas Verma, Kenji Kawaguchi, Alex Lamb, Juho Kannala, Yoshua Bengio, and David Lopez-Paz. Interpolation consistency training for semi-supervised learning. In _IJCAI_, 2019.
* [96] Yicheng Wu, Minfeng Xu, Zongyuan Ge, Jianfei Cai, and Lei Zhang. Semi-supervised left atrium segmentation with mutual consistency training. In _MICCAI_, 2021.
* [97] Marius Cordts, Mohamed Omran, Sebastian Ramos, Timo Rehfeld, Markus Enzweiler, Rodrigo Benenson, Uwe Franke, Stefan Roth, and Bernt Schiele. The cityscapes dataset for semantic urban scene understanding. In _CVPR_, 2016.
* [98] Mark Everingham, SM Ali Eslami, Luc Van Gool, Christopher KI Williams, John Winn, and Andrew Zisserman. The pascal visual object classes challenge: A retrospective. _IJCV_, 2015.
* [99] Shuran Song, Samuel P Lichtenberg, and Jianxiong Xiao. Sun rgb-d: A rgb-d scene understanding benchmark suite. In _CVPR_, 2015.
* [100] Shikun Liu, Shuaifeng Zhi, Edward Johns, and Andrew J Davison. Bootstrapping semantic segmentation with regional contrast. _arXiv preprint arXiv:2104.04465_, 2021.
* [101] Adam Paszke, Sam Gross, Francisco Massa, Adam Lerer, James Bradbury, Gregory Chanan, Trevor Killeen, Zeming Lin, Natalia Gimelshein, Luca Antiga, et al. Pytorch: An imperative style, high-performance deep learning library. In _NeurIPS_, 2019.
* [102] Tsung-Yi Lin, Piotr Dollar, Ross Girshick, Kaiming He, Bharath Hariharan, and Serge Belongie. Feature pyramid networks for object detection. In _CVPR_, 2017.
* [103] Xinlei Chen, Haoqi Fan, Ross Girshick, and Kaiming He. Improved baselines with momentum contrastive learning. _arXiv preprint arXiv:2003.04297_, 2020.
* [104] Wouter Van Gansbeke, Simon Vandenhende, Stamatios Georgoulis, and Luc V Gool. Revisiting contrastive methods for unsupervised learning of visual representations. In _NeurIPS_, 2021.

## Appendix to

**Rethinking Semi-Supervised Medical Image Segmentation:**

**A Variance-Reduction Perspective**

**Sec. A**: provides additional theoretical analysis.
**Sec. B**: provides additional details on the training datasets.
**Sec. C**: provides additional details on the implementation.
**Sec. D**: provides details on 2D/3D methods in comparision.
**Sec. E**: provides additional framework details.
**Sec. F**: provides model architecture details.
**Sec. G**: provides more experimental results on the 2D LiTS [82] dataset.
**Sec. H**: provides more experimental results on the 2D MMWHS [83] dataset.
**Sec. I**: provides more experimental results on the 3D LA [84] dataset.
**Sec. J**: provides more experimental results on the 3D MP-MRI dataset.
**Sec. K**: provides more experimental results on three semantic segmentation benchmarks (Cityscapes [97], Pascal VOC 2012 [98], SUN RGB-D [99]).
**Sec. L**: forms a better understanding of generalization across label ratios and frameworks.
**Sec. M**: provides final checkpoint loss landscapes.
**Sec. N**: provides additional details on the hyperparameter selection.

## Appendix A Theoretical Results Details

### Proof of Lemma 3.1

Proof.: By definition of the estimate \(\widehat{H}\), since the sampling from each group is independent, the variance can be written as

\[\mathrm{Var}[\widehat{H}_{\text{SG}}]=\frac{1}{n^{2}}\sum_{m=1}^{M}\sum_{p\in \mathcal{D}_{m}}\sigma_{m}^{2}.\]

Since \(|\mathcal{D}_{m}|=n_{m}\), it follows that

\[\mathrm{Var}[\widehat{H}_{\text{SG}}]=\sum_{m=1}^{M}\frac{n_{m}^{2}}{n^{2}} \frac{\sigma_{m}^{2}}{n_{m}}.\]

Note that \(\sigma_{m}^{2}\) is the variance of the \(h(\mathbf{x};p)\) where \(p\sim\mathcal{P}_{m}\) uniformly.

**Analysis of SAG.** We now consider SAG. Recall that, compared to SG, SAG first samples \(n_{m}/2\) pixels from \(\mathcal{P}_{m}\)6 from each \(m=1,\cdots,M\) in the same way as SG. SAG then deterministically picks the rest \(n_{m}/2\) pixels to be the reflection pixels of the first half (see Figure 2(3)). Let's choose arbitrary group \(m\) and denote by \(p\) and \(p^{\prime}\) the sampled pixel and its reflection from that group. Note that the variance of \(p\) satisfies \(\mathrm{Var}_{\text{SAG}}[h(\mathbf{x};p)]=\sigma_{m}^{2}\) since \(p\) is sampled in a same way as in the case of SG. Observe that, by symmetry, the variance of \(p\) and \(p^{\prime}\) should be the same \(\mathrm{Var}_{\text{SAG}}[h(\mathbf{x};p)]=\mathrm{Var}_{\text{SAG}}[h( \mathbf{x};p)]=\sigma_{m}^{2}\). It follows that:

Footnote 6: For simplicity, we ignore the rounding issue.

\[\mathrm{Var}_{\text{SAG}}[h(\mathbf{x};p)+h(\mathbf{x};p^{\prime })]\] \[=\mathrm{Var}_{\text{SAG}}[h(\mathbf{x};p)]+\mathrm{Var}_{\text{SAG }}[h(\mathbf{x};p^{\prime})]+2\text{Cov}_{\text{SAG}}[h(\mathbf{x};p),h( \mathbf{x};p^{\prime})]\] \[\leq 4\sigma_{m}^{2},\]where the second step holds because the correlation between \(h(\mathbf{x};p)\) and \(h(\mathbf{x};p^{\prime})\) is at most 1. It follows that:

\[\operatorname{Var}[\widehat{H}_{\text{SAG}}] =\sum_{m=1}^{M}\frac{|\mathcal{P}_{m}|^{2}}{|\mathcal{P}|^{2}} \frac{1}{|\mathcal{D}_{m}|^{2}}\operatorname{Var}\left[\sum_{p\in\mathcal{D}_{ m}}h(\mathbf{x};p)\right]\] \[=\sum_{m=1}^{M}\frac{n_{m}^{2}}{n^{2}}\frac{1}{n_{m}^{2}}\sum_{p, p^{\prime}}\operatorname{Var}[h(\mathbf{x};p)+h(\mathbf{x};p^{\prime})]\] \[\leq\sum_{m=1}^{M}\frac{n_{m}^{2}}{n^{2}}\frac{1}{n_{m}^{2}}\frac {n_{m}}{2}4\sigma_{m}^{2}\] \[=\sum_{m=1}^{M}\frac{2n_{m}}{n^{2}}\sigma_{m}^{2}\] \[=2\operatorname{Var}[\widehat{H}_{\text{SG}}].\]

### Proof of Theorem 3.2

Proof of Theorem 3.2.: Denote \(w_{m}=n_{m}/n\), where \(n_{m}=|\mathcal{D}_{m}|\). The unbiasedness is straightforward: by proportional sampling, the probability that an arbitrary pixel in group \(\mathcal{P}_{m}\) being chosen is equal to \(|\mathcal{D}_{m}|/|\mathcal{P}_{m}|\). Since \(|\mathcal{D}_{m}|=|\mathcal{P}_{m}|\), the probability of being chosen is equal across all pixels, and hence an arbitrary pixel \(p\in\mathcal{D}=\cup_{m}\mathcal{D}_{m}\) is equally likely to be any pixel in the population \(\mathcal{P}\). As a result, we have

\[\mathbb{E}[\widehat{H}_{\text{SG}}(\mathbf{x};\mathcal{D})] =\mathbb{E}\left[\sum_{p\in\mathcal{D}}h(\mathbf{x};p)/|\mathcal{D }|\right]=\mathbb{E}_{p}[h(\mathbf{x};p)]\] \[=H(\mathbf{x}),\]

where the first equality is by the construction of \(\widehat{H}_{\text{SG}}(\mathbf{x};\mathcal{D})\), the second equality is by symmetry of \(p\in\mathcal{D}\), and the last inequality is by the above conclusion that \(p\) is equally possible to be any pixel in \(\mathcal{P}\). This finishes the proof that \(\widehat{H}_{\text{SG}}\) is unbiased.

The variance of \(\widehat{H}_{\text{SG}}\) is equal to

\[\operatorname{Var}[\widehat{H}_{\text{SG}}]=\sum_{m=1}^{M}\frac{n_{m}^{2}}{n^ {2}}\frac{\sigma_{m}^{2}}{n_{m}},\]

where \(\sigma_{m}^{2}\) is the variance of the \(f(\mathbf{x};p)\) when \(p\sim\mathcal{D}_{m}\) uniformly. Under the case of proportional sampling, i.e., \(n_{m}\propto|\mathcal{D}_{m}|\) for all \(m=1,\cdots,M\) (for simplicity we assume such \(n_{m}\)'s are all integers), the variance becomes

\[\operatorname{Var}[\widehat{H}_{\text{SG}}]=\sum_{m=1}^{M}\frac{(w_{m}\cdot n) ^{2}}{n^{2}}\frac{\sigma_{m}^{2}}{w_{m}\cdot n}=\sum_{m=1}^{M}w_{m}\frac{ \sigma_{m}^{2}}{n}.\]

We now consider NS (i.e. naive sampling). By definition, the random sampling samples pixels uniformly from the set \(\mathcal{P}\) of all pixels. Since \(n\) is the total number of pixels sampled, the variance of the \(\widehat{H}_{\text{NS}}\) is given as \(\operatorname{Var}[\widehat{H}_{NS}]=\sigma^{2}/n\) where \(\sigma^{2}\) is the sampling variance of \(h(\mathbf{x};p)\) given \(p\sim\mathcal{P}\) uniformly. To determine \(\sigma^{2}\), we apply a variance decomposition trick via conditioning. Specifically, the sampling from NS is a two-step process: (1) sample the group index \(m\) from \([M]\), (2) sample the pixel uniformly from \(\mathcal{P}_{m}\). Applying the law of total variance, we have

\[\operatorname{Var}_{p\sim\mathcal{P}}[h(\mathbf{x};p)]\] \[=\mathbb{E}[\operatorname{Var}[h(\mathbf{x};p)]|p\in\mathcal{P}_{ m}]+\operatorname{Var}[\mathbb{E}[h(\mathbf{x};p)|p\in\mathcal{P}_{m}]]\] \[=\sum_{m=1}^{M}w_{m}\sigma_{m}^{2}+\sum_{m=1}^{M}\left(\mathbb{E} _{p\sim\mathcal{P}_{m}}[h(\mathbf{x};p)]-\mathbb{E}_{p\sim\mathcal{P}}[h( \mathbf{x};p)]\right)^{2}.\]As a result, we conclude that, for any image \(\mathbf{x}\), the sampling variance of SG estimate and NS estimate satisfies

\[\mathrm{Var}[\widehat{H}_{\text{NS}}] =\mathrm{Var}[\widehat{H}_{\text{SG}}]\] \[+\frac{1}{n}\sum_{m=1}^{M}\left(\mathbb{E}_{p\stackrel{{ \text{\tiny{mtf}}}}{{\rightarrow}}\mathcal{P}_{m}}[h(\mathbf{x};p)]- \mathbb{E}_{p\stackrel{{\text{\tiny{mtf}}}}{{\rightarrow}} \mathcal{P}}[h(\mathbf{x};p)]\right)^{2},\]

which finishes the proof. 

### Further Details on Convergence

We first make the following assumptions about the loss function and the gradient estimate in our learning problem.

**Assumption A.1** (Smoothness).: _The objective function \(\mathcal{L}(\cdot)\) is \(L\)-smooth, i.e., \(\mathcal{L}\) is differentiable and \(\left\|\nabla\mathcal{L}(\theta)-\nabla\mathcal{L}(\theta^{\prime})\right\|_ {2}\leq L(\left\|\theta-\theta^{\prime}\right\|_{2})\) for all \(\theta\), \(\theta^{\prime}\) in the domain of \(\nabla\mathcal{L}\)._

**Assumption A.2** (Bounded variance).: _There exists some \(\sigma_{g}^{2}>0\) such that for all \(\theta\) in the domain,_

\[\mathbb{E}\left[\left\|g(\theta)-\nabla\mathcal{L}(\theta)\right\|^{2}\right] \leq\sigma_{g}^{2}.\]

These assumptions are standard in optimization theory and in various settings [87, 88, 89]. The first assumption allows us to characterize the loss landscape of our learning problem, and the second assumption ensures the gradient estimate does not deviate largely from the truth, which is essential for the training to converge. With these two assumptions, it is guaranteed that

\[\frac{1}{T}\sum_{t=1}^{T}\mathbb{E}\left[\left\|\nabla\mathcal{L}(\theta) \right\|_{2}^{2}\right]\leq C\left(\frac{1}{T}+\frac{\sigma_{g}}{\sqrt{T}} \right).\]

**Proposition 1**.: _Suppose the step sizes in SGD are taken to be \(\min\left\{1/L,\alpha/(\sigma_{g}\sqrt{T})\right\}\) where \(T\) is the number of steps. Then under Assumption A.1 and A.2, there exists some constant \(C\) depending on \(\mathcal{L}\), \(\alpha\), and \(L\), such that_

\[\frac{1}{T}\sum_{t=1}^{T}\mathbb{E}\left[\left\|\nabla\mathcal{L}(\theta_{t}) \right\|_{2}^{2}\right]\leq C\left(\frac{1}{T}+\frac{\sigma_{g}}{\sqrt{T}} \right).\]

Proposition 1 shows that, in expectation, the convergence rate of the average gradient norm consists of a fast rate \(1/T\) and a slow rate \(\sigma_{g}/\sqrt{T}\), with the slow rate being the dominant term. Importantly, the slow rate depends on the variance of the gradient estimate. This suggests that a variance reduced gradient estimate allows SGD to reach an approximate local minimum with less iterations, leading to faster convergence of the training loss. This intuition is corroborated by Fig. 5, where we directly visualize the training trajectory of contrastive loss versus epoch for three sampling methods. We observe that SG features a faster loss decay and a narrower error bar, showing that it outperforms other methods in both the convergence speed and the stability. Furthermore, Proposition 1 indicates that our proposed sampling techniques are universal, since it applies to all scenarios as long as the mild assumptions A.1 and A.2 are satisfied. In other words, when it comes to scenarios that involve pixel/voxel-level sampling on 2D/3D images, utilizing SG/SAG instead of naive sampling can lead to enhanced stability and decreased variance.

## Appendix B Datasets

Our experiments are conducted on five 2D/3D representative datasets in semi-supervised medical image segmentation literature, including 2D benchmarks (_i.e._, ACDC [81], LiTS [82], and MMWHS [83]) and 3D benchmarks (_i.e._, LA [84] and in-house MP-MRI).

* left ventricle (LV), myocardium (Myo), and right ventricle (RV). Following [53, 9, 10], we utilize 120, 40, and 40 scans for training,
validation, and testing 7. Note that 1%, 5%, and 10% label ratios are the ratio of patients. The splitting details are in the supplementary material. For pre-processing, we normalize the intensity of each 3D scan into \([0,1]\) by using min-max normalization, and re-sample images and segmentation maps to \(256\times 256\) pixels. Footnote 7: https://github.com/HiLab-git/SSL4MIS/tree/master/data/ACDC
* liver and tumor. Note that 1%, 5%, and 10% label ratios are the ratio of patients. We utilize 100 and 31 scans for training and testing, with random order. The splitting details are in the supplementary material. For pre-processing, we follow the setting in [6] by truncating the intensity of each 3D scan into \([-200,250]\) HU for removing irrelevant and redundant features, normalizing each 3D scan into \([0,1]\), and re-sample images and segmentation maps to \(256\times 256\) pixels.
* left ventricle (LV), left atrium (LA), right ventricle (RV), right atrium (RA), myocardium (Myo), ascending aorta (AAo), and pulmonary artery (PA). Note that 1%, 5%, and 10% label ratios are based on the ratio of patients. Following [17], we utilize 15 and 5 scans for training and testing. The splitting details are in the supplementary material. For pre-processing, we normalize the intensity of each 3D scan into \([0,1]\) by using min-max normalization, and re-sample images and segmentation maps to \(256\times 256\) pixels.
* left atrium (LA), with an isotropic resolution of \(0.625\times 0.625\times 0.625\)mm\({}^{3}\). Note that 1%, 5%, and 10% label ratios are the ratio of patients. The fixed split (_i.e._, 5%, and 10% ) [8, 53] uses 80 and 20 scans for training and testing 8, and 1% label ratio is randomly split. The splitting details are in the supplementary material. For pre-processing, we crop all the scans at the heart region, normalize the intensities of each 3D scan into \([0,1]\), and randomly crop all the training sub-volumes into \(112\times 112\times 80\)mm\({}^{3}\). Footnote 8: https://github.com/ycwu1997/SS-Net/tree/main/data/LA
* liver, each of which includes T1 weighted DCE-MRI images at three-time points (_i.e._, pre-contrast, arterial phase, and venous phases). Three images are mutually registered to the arterial phase images, with an isotropic voxel size of \(1.00\times 1.00\times 1.00\)mm\({}^{3}\). The dataset is randomly divided into 100 scans for training, 40 for validation, and 20 for testing. Note that 1%, 5%, and 10% label ratios are the ratio of patients. The splitting details are in the supplementary material. For pre-processing, we normalize the intensity of each 3D scan into \([0,1]\) by using min-max normalization, and re-sample images and segmentation maps to \(256\times 256\) pixels.

## Appendix C Implementation Details

In our experiments, all of our evaluated methods have been trained using similar settings for simplicity in reproducing our results. All experiments are conducted with PyTorch [101] on an NVIDIA RTX 3090 Ti. We adopt an SGD optimizer with momentum 0.9 and weight decay \(10^{-4}\). The initial learning rate is set to 0.01. We use the 2D UNet[30] or 3D VNet[78] backbones as the segmentation network under different labeled ratio settings (_i.e._, 1%, 5%, 10% labeled ratios). Following [17], we adopt the feature pyramid network (FPN) [102] architecture as the representation head \(\psi_{r}\) with a separate 512-dimension output layer. The momentum hyperparameter is set to 0.99.

For pre-training, the networks are trained for 100 epochs with a batch size of 6. We apply the _mined_ views with \(d\!=\!5\), following [17]. As for fine-tuning, the networks are trained for 200 epochs with a batch size of 8. The learning rate decays by a factor of 10 every 2500 iterations during the training. We apply the temperature with \(\tau_{t}\!=\!0.01\), \(\tau_{s}\!=\!0.1\), and \(\tau\!=\!0.5\), respectively. The size of the memory bank is set to 36. For the CL training, we use the implementation from [17] and leave all parameters on their default settings, _e.g._, we apply the hyperparameters with \(\lambda_{1}\!=\!0.01\), \(\lambda_{2}\!=\!1.0\), and \(\lambda_{3}\!=\!1.0\). For other hyper-parameters in all the evaluated methods, we adopt the suggested settings in the original papers because they are not of direct interest to us.

For 2D medical segmentation, we follow the same data augmentations [9; 53] to the _teacher_'s input and the _student_'s input, respectively. The augmentations include random rotation, random cropping, and horizontal flipping. For 3D medical segmentation, we follow the same data augmentations [8; 9; 96; 53; 9; 53] to the _teacher_'s input and the _student_'s input, respectively. The augmentations include random rotation and random flipping. We evaluate our methods on 3D segmentation results with two classical metrics: (1) Dice coefficient (DSC) and (2) Average Symmetric Surface Distance (ASD). Note that, for all the evaluated methods, we make no additional modifications during the training process for fair evaluations. We run all our experiments in the same environments with fixed random seeds (Hardware: Single NVIDIA GeForce RTX 3090 GPU; Software: PyTorch 1.10.2+cu113, and Python 3.8.11).

## Appendix D 2D/3D Methods in Comparison

**2D Medical Segmentation**: For experiments, we use 2D UNet[30] as backbone, and compare ARCO with previous state-of-the-art medical segmentation methods: (1) _Baseline_ (_i.e._, UNet-F/UNet-L[30]) using both fully-supervised and limited-supervised settings; and (2) _SSL-based_: EM[90], CCT[91], DAN[92], URPC[57], DTC[9], DCT[93], ICT[95], MT[59], UAMT[8], SASSNet[94], CPS[62], GCL[50], MC-Net[96], SS-Net[53], ACTION[16], and MONA[17]. Note that among all the above evaluated methods, several methods use a contrastive objective, including GCL[50], SS-Net[53], ACTION[16], and MONA[17].

**3D Medical Segmentation**: For experiments, we use 3D VNet[78] as backbone, and compare ARCO with previous state-of-the-art medical segmentation methods: (1) _Baseline_ (_i.e._, VNet-F/VNet-L[78]) using both fully-supervised and limited-supervised settings; and (2) _SSL-based_: EM[90], CCT[91], DAN[92], URPC[57], DTC[9], DCT[93], ICT[95], MT[59], UAMT[8], SASSNet[94], CPS[62], GCL[50], MC-Net[96], SS-Net[53], ACTION[16], and MONA[17]. Note that among all the above evaluated methods, several methods use a contrastive objective, including GCL[50], SS-Net[53], ACTION[16], and MONA[17].

## Appendix E Framework Overview

In the following, we provide a concise overview of ARCO, consisting of two training phases: (1) relational semi-supervised pre-training, and (2) anatomical contrastive fine-tuning. Note that, in this paper, sampling strategies in pixel-level CL framework are of direct interest, so we use a simplification of MONA[17] without using any additional complicated augmentation strategies.

**(1) Relational Semi-Supervised Pretraining.** Given an unlabeled sample, ARCO has two ways to define _augmented_ and _mined_ views: (1) ARCO augments the samples to be \(\mathbf{x}^{1}\) and \(\mathbf{x}^{2}\) as _augmented_ views, with two separate data augmentation operators; and (2) ARCO randomly samples \(d\)_mined_ views (_i.e._, \(\mathbf{x}^{3}\)) from the unlabeled dataset with additional augmentation. The pairs \(\left[\mathbf{x}^{1},\mathbf{x}^{2}\right]\) are then processed by \(\left[F_{s},F_{t}\right]\), and in a similar way \(\mathbf{x}^{3}\) is processed by \(F_{t}\) (See Figure 1(a) in main paper), outputting three global features \(\left[\mathbf{h}^{1},\mathbf{h}^{2},\mathbf{h}^{3}\right]\) after \(E\) and their local features \(\left[\mathbf{f}^{1},\mathbf{f}^{2},\mathbf{f}^{3}\right]\) after

\begin{table}
\begin{tabular}{l|c c} \hline \hline Method & DSC[\(\mathbf{x}^{i}\)]\(\uparrow\) & ASD[voxel]\(\downarrow\) \\ \hline \# ARCO-SAG (ours) & 84.9 & 1.47 \\ w/o random rotation & 84.1 & 2.87 \\ w/o random cropping & 84.4 & 3.47 \\ w/o horizontal flipping & 73.7 & 6.70 \\ w/ no augmentation & 70.8 & 9.83 \\ \hline \# ARCO-SG (ours) & 85.5 & 0.947 \\ w/o random rotation & 83.8 & 3.27 \\ w/o random cropping & 84.6 & 1.62 \\ w/o horizontal flipping & 78.8 & 4.15 \\ w/ no augmentation & 76.2 & 7.74 \\ \hline \hline \end{tabular}
\end{table}
Table 4: Ablation on data augmentation strategies: (1) random rotation; (2) random cropping; and (3) horizontal flipping, compared to our methods with two settings (_i.e._, w/ no augmentation and w/ all three augmentation). Note that we use the identical data augmentation strategies (_i.e._, random rotation, random cropping, and horizontal flipping), as [30; 90; 91; 92; 93; 8; 94; 9; 57; 95; 62; 50; 59; 96; 53; 16; 17] for fair comparisons.

\(D\). These features are fed to the two-layer non-linear projectors for outputting global and local embeddings \(\mathbf{v}_{g}\) and \(\mathbf{v}_{l}\).

To alleviate the _collapse_ issues [26, 27, 16], we make the architecture asymmetric between the _student_ and _teacher_ pipeline by further feeding both the global and local embeddings \(\mathbf{v}\) with respect to the _student_ branch into the non-linear predictor, producing \(\mathbf{w}\) in both global and local manners 9. After passing through the nonlinear projectors and predictor, the relational similarities between _augmented_ and _mined_ embeddings are computed using the softmax transform, which can be formulated as: \(\mathbf{u}_{s}=\text{log}\frac{\text{exp}\left(\text{sim}\left(\mathbf{w}^{ \mathrm{t}},\mathbf{v}^{3}\right)/\tau_{s}\right)}{\sum_{n=1}^{N}\text{exp} \left(\text{sim}\left(\mathbf{w}^{\mathrm{t}},\mathbf{v}^{3}_{n}\right)/\tau_ {s}\right)}\), \(\mathbf{u}_{t}=\text{log}\frac{\text{exp}\left(\text{sim}\left(\mathbf{w}^{ \mathrm{t}},\mathbf{v}^{3}_{n}\right)/\tau_{t}\right)}{\sum_{n=1}^{N}\text{exp} \left(\text{sim}\left(\mathbf{w}^{2},\mathbf{v}^{3}_{n}\right)/\tau_{t}\right)}\), where \(\tau_{s}\) and \(\tau_{t}\) are different temperature parameters. The unsupervised instance discrimination loss (_i.e._, Kullback-Leibler divergence \(\mathcal{KL}\)) can be defined as:

Footnote 9: We omit details of local instance discrimination setting for simplicity in following contexts.

\[\mathcal{L}_{\text{inst}}=\mathcal{KL}(\mathbf{u}_{s}||\mathbf{u}_{t}).\] (E.1)

Figure 6: Visual results on LiTS with 1%, 5%, 10% label ratios. As is shown, ARCO-SG and ARCO-SAG consistently produce more accurate predictions on anatomical regions and boundaries compared to all other SSL methods.

\begin{table}
\begin{tabular}{c c c c c c c c c c} \hline \hline \multicolumn{10}{c}{**LITS**} & \multicolumn{6}{c}{10\% Labeled} \\ \cline{3-10} Method & Average & Liver & Lesion & Average & Liver & Lesion & Average & Liver & Lesion \\ \hline UNet-F [30] & 68.2 / 16.9 & 90.68/1.4 & 48.52/6.5 & 68.21/6.9 & 90.68/1.4 & 45.82/6.5 & 68.21/6.9 & 90.68/1.4 & 45.82/5.6 \\ UNet-L & 50.83/0.7 & 76.51/5.2 & 50.45/6.3 & 63.43/0.4 & 90.59/8.4 & 36.45/0.9 & 64.62/8.8 & 81.48/6.6 & 40.93/9.7 \\ \hline DM [90] & 66.38/8.4 & 86.42/6.3 & 26.95/0.5 & 62.13/3.3 & 87.67/4.9 & 37.47/5.4 & 37.67/4.3 & 62.93/8.5 & 87.47/2.3 & 38.95/5.7 \\ OCCI [91] & 52.45/52.3 & 79.14/2.0 & 25.76/2.6 & 61.42/6.1 & 84.61/6.2 & 38.23/8.9 & 63.42/1.0 & 88.87/6.4 & 38.05/8.5 \\ DM [92] & 57.18/2.83 & 84.51/9.2 & 29.63/4.7 & 62.35/8.8 & 69.04/6.1 & 36.12/4.3 & 63.20/7.8 & 37.71/5.4 & 39.14/1.61 \\ UPC [97] & 55.53/6.4 & 86.37/2.3 & 80.42/0.0 & 60.91/2.4 & 85.51/1.3 & 36.34/6.6 & 62.52/4.8 & 84.91/2.0 & 41.03/1.67 \\ DCC [91] & 39.37/5.5 & 68.1/10.7 & 10.56/4.9 & 52.18/5.8 & 50.74/3.3 & 33.97/2.9 & 62.52/4.8 & 34.91/2.9 & 40.13/1.67 \\ DCCI [93] & 57.78/5.8 & 57.32/5.4 & 38.54/6.6 & 68.74/4.8 & 89.21/6.3 & 23.56/6.2 & 67.31/8.7 & 88.29/3.3 & 37.54/4.1 \\ ICT [95] & 58.3/32.2 & 86.5/2.8 & 30.14/1.5 & 60.39/1.9 & 88.81/6.2 & 33.38/6.5 & 62.53/4.2 & 88.18/17.6 & 36.94/8.2 \\ MT [95] & 54.77/2.8 & 83.1/10.2 & 26.39/1.0 & 60.32/7.3 & 75.86/4.3 & 34.44/1.1 & 62.23/7.3 & 85.89/3.2 & 36.18/1.8 \\ UMT [8] & 55.53/6.4 & 83.07/2.3 & 80.42/0.1 & 61.52/4.7 & 84.51/6.3 & 36.3/8.8 & 62.32/6.7 & 84.77/7.8 & 34.49/3.6 \\ ASSNet [94] & 39.64/2.7 & 69.01/4.7 & 30.67/6.0 & 64.25/4.8 & 86.11/6.3 & 34.79/3.0 & 62.42/1.1 & 86.48/31.8 & 38.33/3.9 \\ CDS [26] & 57.73/6.9 & 67.02/2.4 & 38.54/6.5 & 59.23/6.0 & 84.90/1.9 & 34.93/4.5 & 62.03/8.6 & 67.81/1.8 & 38.64/3.3 \\ OCL [50] & 59.3/29.5 & 88.6/14.2 & 30.04/4.9 & 63.32/2.0 & 90.79/4.6 & 35.93/0.8 & 65.03/7.2 & 91.31/0.0 & 38.76/4.3 \\ MC-Net [96] & 60.93/2.1 & 87.11/7.3 & 34.84/6.5 & 61.69/1.8 & 86.38/1.1 & 36.93/1.4 & 63.47/9.8 & 89.01/3.1 & 38.04/6.8 \\ S-Net [53] & 55.03/5.9 & 89.61/9.8 & 22.05/1.9 & 59.12/4.6 & 87.51/1.2 & 30.63/8.1 & 64.71/9.8 & 31.71/3.3 & 38.58/32.2 \\ ACTION [16] & 61.02/4.5 & 89.81/6.9 & 32.23/3.6 & 63.73/6.4 & 93.06/1.5 & 39.54/0.8 & 67.20/2.4 & 92.85/0.8 & 41.63/5.8 \\ NONA [17] & 62.22/4.9 & 91.51/3.9 & 34.03/5.6 & 66.61/6.6 & 93.17/3.4 & 40.25/4.8 & 63.18/3.0 & 93.48/4.8 & 43.37/1.0 \\ \# ARCO-SAG (ours) & 64.10/2.06 & 91.57/6.3 & **83.03**/5.3 & 67.13/2.3 & 93.07/1.0 & 40.17/1.9 & 63.6 & 67.41/9.9 & 93.37/6.0 & 45.92/2.2 \\ \# ARCO-SG (ours) & 65.5/**20.2** & **92.5**/5.9 & **38.4**/34.7 & **68.4**/**11.3** & **93.7**6.3 & **43.0**/**6.0** & **70.1**/**3.5** & **94.1**/**5.01** & **46.**/**12.1** \\ \hline \hline \end{tabular}
\end{table}
Table 5: Quantitative comparisons (DSC[%] \(\uparrow\)/ ASD[voxel] \(\downarrow\)) across the three labeled ratio settings (1%, 5%, 10%) on the LiTS benchmark. All experiments are conducted as [30, 90, 91, 91, 92, 93, 8, 94, 9, 57, 95, 62, 50, 59, 96, 53, 16, 17] in the identical setting for fair comparisons. Best and second-best results are coloured **blue** and red, respectively. UNet-F (fully-supervieldy) and UNet-L (semi-supervieldy) are considered as the upper bound and the lower bound for the performance comparison. Please refer to the text for discussion. We adopt the atomic data augmentation (_i.e._, random rotation, random cropping, and horizontal flipping) for fair comparisons.

[MISSING_PAGE_FAIL:22]

[MISSING_PAGE_EMPTY:23]

[MISSING_PAGE_FAIL:24]

various label ratios (_i.e._, 1%, 5%, 10%). In this work, we mainly study the state-of-the-art CL frameworks from the computer vision domain hereinafter for ablations, considering their superior performance in the task of image classification. Note that, for each fair comparison, we strictly follow the default setting in these CL frameworks [103, 104, 14, 26, 27, 28] for pretraining, and fine-tune each networks using the same settings in Appendix C. Full experimental details are in Appendix C.

Since they work orthogonally to our pretraining strategy, we conduct a comprehensive comparison of these CL-based frameworks in Table 8. Clearly, our proposed SG and SAG sampling help significantly in improving the segmentation performance across all the CL-based frameworks and is capable of being integrated with previous frameworks for further enhanced **model robustness**. Moreover, it is important to observe that the performance benefits of our methods increase significantly with a lower label setting. This observation augments the necessity of our proposed methods while training networks with high **label efficiency**.

## Appendix M Final Checkpoint Loss Landscapes

From visualizations in Figure 19, ARCO-SG converges to much flatter loss valleys, which evidences their robustness in learning anatomical features.

## Appendix N Ablation on Different Training Settings

Hyperparameter Selection.For grid search, we detail the tuning steps here. The tuning is done in sequential order. \(\lambda_{1}\) is chosen from \(\{0.001,0.005,0.01,0.05,0.1,1.0\}\), and \(\lambda_{2},\lambda_{3}\) are chosen from \(\{0.1,0.2,0.5,1.0,2.0,10.0\}\). We use the validation set to search over hyperparameters and find the best hyperparameter on ACDC with 1% labeled ratio. As shown in Figure 20, with a carefully tuned hyperparameters \(\lambda_{1}{=}0.01\), \(\lambda_{2}{=}1.0\), and \(\lambda_{3}{=}1.0\), such setting achieves superior performance compared to others.

\begin{table}
\begin{tabular}{c c c c c c c c c c} \hline \hline Method (1\% Labeled) & Average & LV & RV & LA & RA & Myo & AA & PA \\ \hline UNet-F [30] & 85.8/8.01 & 87.0/4.11 & 79.5/14.7 & 92.7/4.96 & 81.6/13.1 & 83.9/9.32 & 95.0/3.33 & 81.1/6.46 \\ UNet-L & 58.3/33.9 & 73.5/28.2 & 57.9/37.6 & 74.9/30.2 & 47.2/65.4 & 61.9/27.8 & 74.0/18.7 & 18.6/29.4 \\ \hline EX [90] & 59.5/63.2 & 71.7/55.3 & 64.7/26.3 & 66.6/65.1 & 67.3/73.4 & 56.8/66.0 & 81.9/48.8 & 12.9/157.2 \\ CCT [91] & 62.8/27.5 & 78.1/18.8 & 62.8/45.3 & 83.0/18.4 & 34.5/69.9 & 67.0/18.9 & 76.3/10.6 & 26.7/11.2 \\ DAN [92] & 63.8/79.0 & 76.3/15.4 & 62.2/25.8 & 68.0/25.3 & 52.3/48.2 & 57.0/54.3 & 90.8/20.8 & 40.4/34.4 \\ URPC [57] & 65.7/29.7 & 77.0/29.5 & 65.1/13.4 & 87.6/18.5 & 52.5/16.3 & 65.8/28.5 & 55.5/22.7 & 37.2/39.7 \\ DTC [91] & 62.9/32.3 & 78.0/29.6 & 63.6/29.4 & 74.6/30.8 & 49.4/5.5 & 67.3/28.1 & 89.0/10.0 & 18.2/44.4 \\ DCT [93] & 60.0/35.3 & 72.1/31.6 & 55.6/42.9 & 70.2/4.0 & 54.6/65.2 & 67.3/4.7 & 37.6/26.7 & 29.2/35.3 \\ ICT [95] & 59.9/32.8 & 77.1/15.5 & 53.4/41.8 & 79.7/25.4 & 44.1/69.0 & 62.9/28.5 & 74.1/20.8 & 24.8/28.8 \\ MT [59] & 61.3/36.0 & 70.7/37.5 & 62.8/29.0 & 74.0/49.6 & 52.8/8.5 & 58.7/27.0 & 85.3/13.0 & 24.9/37.5 \\ UANT [8] & 61.1/37.6 & 75.1/31.9 & 60.3/49.2 & 79.5/30.7 & 50.8/81.8 & 62.5/33.1 & 76.6/11.7 & 23.0/25.0 \\ SASSNet [94] & 62.5/33.9 & 76.6/27.6 & 62.8/29.0 & 74.0/49.6 & 52.8/58.5 & 58.7/27.0 & 85.3/13.0 & 24.9/37.5 \\ CPS [62] & 69.2/22.6 & 79.2/90.1 & 67.9/25.3 & 87.8/18.0 & 67.6/27.7 & 67.1/42.1 & 57.0/23.4 & 24.8/32.5 \\ GCL [50] & 71.6/20.3 & 83.5/10.9 & 66.0/31.7 & 91.2/52.9 & 58.9/48.0 & 73.2/16.9 & 89.8/4.59 & 38.6/24.8 \\ MC-Net [96] & 65.4/56.9 & 67.6/59.9 & 69.4/58.8 & 68.2/69.6 & 61.7/65.8 & 53.8/56.8 & 54.4/8.0 & 51.6/36.6 \\ SS-Net [53] & 60.6/37.0 & 67.5/15.5 & 66.0/42.5 & 73.2/25.1 & 53.7/29.5 & 95.1/51.0 & 61.0/29.5 & 23.2/34.5 \\ ACTION [16] & 78.2/10.5 & 88.2/39.5 & 71.0/11.1 & 89.3/40.0 & 74.1/32.5 & 79.0/85.2 & 83.2/3.82 & 62.3/10.2 \\ RONA [17] & 82.2/80.8 & 89.2/36.4 & 75.8/98.9 & 99.3/31.3 & 77.6/27.4 & 79.5/30.7 & **94.4/2.7** & 69.4/8.61 \\ \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\##\#\#\#\#\#\#\#\#\##\#\#\#\#\#\#\#\#\#\#\#\#\#\#\##

Figure 10: Visual results on Pascal validation set with 60 labels. As is shown, ARCO-SG and ARCO-SAG consistently yield more accurate and sharper boundaries compared to all other SSL methods.

Figure 11: Visual results on Pascal validation set with 200 labels. As is shown, ARCO-SG and ARCO-SAG consistently yield more accurate and sharper boundaries compared to all other SSL methods.

Figure 12: Visual results on Pascal validation set with 600 labels. As is shown, ARCO-SG and ARCO-SAG consistently yield more accurate and sharper boundaries compared to all other SSL methods.

## 6 Conclusion

Figure 13: Visual results on Cityscapes validation set with 20 labels. As is shown, ARCO-SG and ARCO-SAG consistently yield more accurate and sharper boundaries compared to all other SSL methods.

## 6 Conclusion

Figure 14: Visual results on Cityscapes validation set with 50 labels. As is shown, ARCO-SG and ARCO-SAG consistently yield more accurate and sharper boundaries compared to all other SSL methods.

## 6 Conclusion

Figure 15: Visual results on Cityscapes validation set with 150 labels. As is shown, ARCO-SG and ARCO-SAG consistently yield more accurate and sharper boundaries compared to all other SSL methods.

## 6 Conclusion

Figure 16: Visual results on SUN RGB-D validation set with 50 labels. As is shown, ARCO-SG and ARCO-SAG consistently yield more accurate and sharper boundaries compared to all other SSL methods.

Figure 17: Visual results on SUN RGB-D validation set with 150 labels. As is shown, ARCO-SG and ARCO-SAG consistently yield more accurate and sharper boundaries compared to all other SSL methods.

Figure 18: Visual results on SUN RGB-D validation set with 500 labels. As is shown, ARCO-SG and ARCO-SAG consistently yield more accurate and sharper boundaries compared to all other SSL methods.

\begin{table}
\begin{tabular}{c c c c c c c c} \hline \hline  & \multicolumn{4}{c}{**MP-MRI**} & \multicolumn{4}{c}{**LA**} \\ \cline{2-9}  & 1\% Labeled & 5\% Labeled & 10\% Labeled & 1 Labeled (1\%) & 4 Labeled (5\%) & 8 Labeled (10\%) \\ \cline{2-9}
3D Method & Liver & Liver & Liver & Left Atrium (LA) & Left Atrium (LA) & Left Atrium (LA) \\ \hline VNet-F [78] & 93.1/5.73 & 93.1/5.73 & 93.1/5.73 & 91.5/1.51 & 91.5/1.51 & 91.5/1.51 \\ VNet-L & 68.6/33.4 & 81.6/12.5 & 87.9/7.55 & 40.0/21.2 & 52.6/9.87 & 82.7/3.26 \\ \hline EN [90] & 73.2/30.1 & 86.0/15.8 & 91.9/6.89 & 48.3/21.3 & 81.1/4.68 & 82.7/4.77 \\ CCT [91] & 74.72/24.5 & 86.0/15.8 & 90.9/9.54 & 40.3/13.8 & 70.8/3.1 & 82.0/5.25 \\ DAN [92] & 69.4/31.4 & 88.3/10.2 & 91.1/8.76 & 38.5/22.0 & 78.8/6.53 & 80.2/5.37 \\ URPC [57] & 72.7/29.9 & 89.8/9.00 & 91.7/7.41 & 65.0/8.97 & 80.2/5.48 & 83.1/4.57 \\ DTC [9] & 78.6/18.8 & 89.6/10.1 & 90.5/11.2 & 36.2/11.7 & 83.6/2.81 & 87.1/2.23 \\ DCT [93] & 74.1/31.1 & 88.2/12.4 & 90.1/11.1 & 42.9/19.1 & 80.1/9.06 & 80.4/9.18 \\ ICT [95] & 72.3/20.5 & 88.6/11.2 & 91.1/8.46 & 47.7/11.60 & 78.4/6.96 & 85.4/4.14 \\ MT [59] & 73.8/29.4 & 87.7/12.8 & 92.0/7.15 & 58.1/17.8 & 77.0/8.15 & 82.8/5.90 \\ UAMT [8] & 71.6/31.2 & 87.1/12.8 & 91.3/9.71 & 60.3/11.3 & 82.3/8.32 & 87.8/2.12 \\ SASSNe [94] & 78.8/19.6 & 88.4/13.1 & 88.7/13.1 & 51.4/14.6 & 81.6/5.58 & 87.5/2.59 \\ CPS [62] & 80.0/17.1 & 89.2/10.8 & 91.0/9.16 & 45.1/22.0 & 79.7/9.28 & 80.7/5.16 \\ CCL [50] & 78.9/14.2 & 87.9/28.9 & 90.4/5.68 & 52.6/12.8 & 75.5/7.60 & 84.8/4.22 \\ MC-Net [96] & 79.7/20.2 & 90.1/8.27 & 92.4/4.34 & 44.4/14.1 & 83.6/2.70 & 87.6/7.81.82 \\ SS-Net [53] & 88.0/8.93 & 90.9/9.94 & 92.0/5.67 & 43.4/14.8 & 86.3/2.31 & 88.6/1.90 \\ ACTION [16] & 86.5/13.6 & 90.3/12.3 & 90.9/10.0 & 71.1/6.23 & 86.6/2.24 & 88.7/2.10 \\ MUM [17] & 91.3/**5.31** & 92.9/4.6 & 92.3/8.16 & 72.8/10.7 & 87.0/2.81 & 89.5/2.40 \\ \(\star\)AROD-SAG (ours) & 91.5/6.82 & 92.5/6.95 & 92.6/7.54 & 73.2/6.47 & 86.9/27.33 & 89.1/2.30 \\ \(\star\)ARCD-SG (ours) & **91.6**/6.60 & **92.5**/**6.31** & **92.8**/6.64 & **75.0**/**4.06** & **87.8**/**1.66** & **89.9**/**1.47** \\ \hline \hline \end{tabular}
\end{table}
Table 9: Quantitative comparisons (DSC[%] \(\uparrow\) / ASD[voxel] \(\downarrow\)) across the three labeled ratio settings (1%, 5%, 10%) on the 3D MP-MRI and 3D LA benchmarks. All 3D experiments are conducted as [78, 90, 91, 92, 93, 8, 94, 9, 57, 95, 62, 50, 59, 96, 53, 16, 17] in the identical setting for fair comparisons. Best and second-best results are coloured **blue** and red, respectively. VNet-F (fully-supervided) and VNet-L (semi-supervided) are considered as the upper bound and the lower bound for the performance comparison. Please refer to the text for discussion.

Figure 10: Loss landscape visualization of pixel-wise contrastive loss \(\mathcal{L}_{\text{contrast}}\) with ARCD-SG. Loss plots are generated with same original images randomly chosen from ACDC [81], LiTS [82], MMWHS [83], LA [84], and MP-MRI, respectively. \(z\)-axis denotes the loss value at each pixel.

Figure 20: Effects of hyperparameters \(\lambda_{1},\lambda_{2},\lambda_{3}\). We report Dice and ASD of ARCO-SG on ACDC with 1% labeled ratio.