# A Combinatorial Algorithm for the Semi-Discrete Optimal Transport Problem

Pankaj K. Agarwal\({}^{1}\), Sharath Raghvendra\({}^{2}\), Pouyan Shirzadian\({}^{3}\), and Keegan Yao\({}^{1}\)

\({}^{1}\)Duke University, \({}^{2}\)North Carolina State University, \({}^{3}\)Virginia Tech

The authors are listed in alphabetical order.

###### Abstract

Optimal Transport (OT, also known as the Wasserstein distance) is a popular metric for comparing probability distributions and has been successfully used in many machine-learning applications. In the semi-discrete \(2\)-Wasserstein problem, we wish to compute the cheapest way to transport all the mass from a continuous distribution \(\mu\) to a discrete distribution \(\nu\) in \(\mathbb{R}^{d}\) for \(d\geq 1\), where the cost of transporting unit mass between points \(a\) and \(b\) is \(d(a,b)=\|a-b\|^{2}\). When both distributions are discrete, a simple combinatorial framework has been used to find the exact solution (see e.g. [10]). In this paper, we propose a combinatorial framework for the semi-discrete OT, which can be viewed as an extension of the combinatorial framework for the discrete OT but requires several new ideas. We present a new algorithm that given \(\mu\) and \(\nu\) in \(\mathbb{R}^{2}\) and a parameter \(\varepsilon>0\), computes an \(\varepsilon\)-additive approximate semi-discrete transport plan in \(O(n^{4}\log n\log\frac{1}{\varepsilon})\) time (in the worst case), where \(n\) is the support-size of the discrete distribution \(\nu\) and we assume that the mass of \(\mu\) inside a triangle can be computed in \(O(1)\) time. Our algorithm is significantly faster than the known algorithms, and unlike many numerical algorithms, it does not make any assumptions on the smoothness of \(\mu\). As an application of our algorithm, we describe a data structure to store a large discrete distribution \(\mu\) (with support size \(N\)) using \(O(N)\) space so that, given a query discrete distribution \(\nu\) (with support size \(k\)), an \(\varepsilon\)-additive approximate transport plan can be computed in \(O(k^{3}\sqrt{N}\log\frac{1}{\varepsilon})\) time in \(2\) dimensions. Our algorithm and data structure extend to higher dimensions as well as to \(p\)-Wasserstein problem for any \(p\geq 1\).

## 1 Introduction

Optimal Transport (OT) is a powerful metric for comparing probability distributions and is used in many machine-learning applications. The semi-discrete optimal transport problem asks for the cheapest transport plan to transport mass from (a possibly continuous) distribution \(\mu\) that is stored compactly (say, using a deep neural network) to a discrete distribution \(\nu\). In recent years, the semi-discrete OT has been used in data mining [31], image processing [28, 29, 33, 40], computational biology [53], variational inference [7], blue noise generation [21, 51], optics [46], solving PDEs [30, 34], and generative models [8, 9, 19].

More formally, a _semi-discrete transport plan_\(\tau\) between a continuous probability distribution \(\mu\) defined over a compact support \(A\subset\mathbb{R}^{d}\) and a discrete distribution \(\nu\) with a support set \(B\) of \(n\) points in \(\mathbb{R}^{d}\) is a distribution over \(A\times B\) whose marginals are dominated by \(\mu\) and \(\nu\), i.e., \(\tau\colon A\times B\to\mathbb{R}_{\geq 0}\) is a _transport plan_ between \(\mu\) and \(\nu\) where \(\sum_{b\in B}\tau(a,b)\leq\mu(a)\) for all \(a\subseteq A\) and \(\int_{A}\tau(a,b)\ da\leq\nu(b)\) for all \(b\in B\). A transport plan \(\tau\) is _complete_ if \(\tau\) transports all mass of \(\mu\) to \(\nu\). For any fixed \(p\geq 1\), inthe _semi-discrete \(p\)-Wasserstein problem_, the goal is to compute a complete transport plan \(\tau\) between \(\mu\) and \(\nu\) minimizing the cost \(\mathfrak{e}(\tau):=\int_{A}\sum_{b\in B}\|a-b\|^{p}\tau(a,b)\,da\). An optimal plan is referred to as a _\(W_{p}\)-OT plan1_. For any parameter \(\varepsilon>0\), a transport plan \(\tau\) is called an _\(\varepsilon\)-close \(W_{p}\)-OT plan_ if \(\mathfrak{e}(\tau)\leq\mathfrak{e}(\tau^{*})+\varepsilon\), where \(\tau^{*}\) is a \(W_{p}\)-OT plan.

Footnote 1: The \(p\)-Wasserstein cost of \(\tau\) is defined as \(\mathfrak{e}(\tau)^{1/p}\), and the \(p\)-Wasserstein distance between \(\mu\) and \(\nu\) is the \(p\)-Wasserstein cost of a \(W_{p}\)-OT plan.

An optimal solution for the semi-discrete OT problem can be compactly represented as the weighted Voronoi diagram (also called the Laguerre diagram) with respect to a weight assignment \(y(b)\) on every point \(b\in B\)[12]. The choice of weights guarantees that mass at \(b\) is equal to the mass of \(\mu\) inside the Voronoi cell (also called the Laguerre cell) of \(b\) and the optimal transport plan simply transports the mass at \(b\) to the mass inside its Voronoi cell. For 2 dimensions, the weighted Voronoi diagram under the squared Euclidean distance (also known as the power diagram) can be constructed in \(O(n\log n)\) time [24, 57]. For higher dimensions \(d>2\), the construction time would be \(O(n^{\lceil(d+1)/2\rceil})\)[11].

The compact and connected nature of the semi-discrete optimal transport plans makes them attractive for many ML applications; for instance, they can help achieve stability in training GANs and avoid issues such as discontinuities and mode collapse [10, 19, 55], they improve the mapping between continuous latent spaces and discrete data in Variational Autoencoders (VAEs) [9], and also have been used in diffusion-based generative models [42]. However, there are no known exact algorithms for computing semi-discrete optimal transport. Additionally, computing an \(\varepsilon\)-close transport plan is known to be \(\#P\)-Hard with respect to \(d\) and \(\log 1/\varepsilon\), i.e., an algorithm with an execution time that is polynomial in \(d\) and \(\log 1/\varepsilon\) seems unlikely [58]. Due to the intractability of the semi-discrete optimal transport in high dimensions, researchers have considered taking \(n\) samples from the model, which is a continuous distribution \(\mu\), and computing an optimal discrete transport plan between the empirical distribution \(\mu_{n}\) defined on the \(n\) samples and \(\nu\)[43]. It has been shown that this empirical \(p\)-Wasserstein distance converges to the true semi-discrete \(p\)-Wasserstein distance at a rate of \(n^{-1/2p}\)[22, 35, 50]; note that the rate of convergence does not depend on the dimension. However, the optimal transport plan from samples is not necessarily a good approximation of the semi-discrete transport plan and may cause biased gradients [14, 19].

For the discrete OT problem, there are several near-optimal scalable exact and approximation algorithms [1, 4, 5, 20, 25, 26, 36, 39, 52, 54], some of which extend to very high dimensions. For the semi-discrete OT in low dimensions, despite extensive work, scalable algorithms to find optimal semi-discrete transport plans remain elusive. There are algorithms to compute an \(\varepsilon\)-close semi-discrete transport plan using numerical solvers [12, 15, 17, 21, 37, 38, 41, 48], entropic regularization [6, 16, 32], and multiscale approaches [40, 44]. The execution time of all these algorithms is exponential in both \(d\) and \(\log 1/\varepsilon\). Furthermore, their convergence relies on a smoothness parameter of \(\mu\). For instance, a notable numerical algorithm by Oliker and Prussner [48] assumes that for a point \(b\in B\), a small change in \(y(b)\) will change the mass of \(\mu\) inside the Voronoi cell of \(b\) by a proportionately small amount [45, Remark 22]. Under this assumption, their algorithm executes \(\operatorname{poly}(n,1/\varepsilon)\) iterations, where each iteration requires the computation of a weighted Voronoi diagram which takes \(n^{O(d)}\) time. Their algorithm slows down when \(\mu\) is non-smooth and does not even converge when \(\mu\) is a discrete distribution. Furthermore, these methods approximate the transport cost but the transport plan that they compute may not be an approximation of the optimal weighted Voronoi diagram.

Recently, Agarwal _et al._[5] described a _cost-scaling_ paradigm to compute an \(\varepsilon\)-close semi-discrete transport plan. Their algorithm executes \(\log\frac{\Delta}{\varepsilon}\) scales, where \(\Delta\) is the diameter of \(A\cup B\). Within each scale, they create an instance of the discrete OT problem of size \(O(n^{5})\) in \(\mathbb{R}^{2}\) (and \(n^{O(d)}\) in \(\mathbb{R}^{d}\)). Using any existing strongly polynomial primal-dual discrete OT solver, such as the algorithm by Orlin [49], their algorithm computes an exact discrete OT plan for each instance and updates the weights for \(B\). The OT plan computed in the final scale is an \(\varepsilon\)-close transport plan. They show that the weight assigned to any point \(b\in B\) is \(\varepsilon\) away from the optimal weight assignment. The overall execution time of this algorithm is \(O(n^{9}\log\frac{\Delta}{\varepsilon})\) in \(\mathbb{R}^{2}\) and \(n^{O(d)}\log\frac{\Delta}{\varepsilon}\) in \(d\)-dimensions. Furthermore, in the limit, the transport plan of their algorithm converges to the optimal weighted Voronoi diagram. Note that their algorithm does not make any assumptions on \(\mu\).

**Our Contributions.** The following theorem states our main result.

**Theorem 1.1**.: _Let \(\mu\) be a continuous probability distribution defined on a compact set \(A\subset\mathbb{R}^{2}\), \(\nu\) a discrete probability distribution with a support \(B\subset\mathbb{R}^{2}\) of size \(n\), and \(\varepsilon>0\) a parameter. Suppose_there exists an oracle that, given a triangle \(\varphi\), returns the mass of \(\mu\) inside \(\varphi\) in \(\Phi\) time. Then, an \(\varepsilon\)-close \(W_{2}\)-OT plan between \(\mu\) and \(\nu\) can be computed in \(O(n^{3}(\Phi+n\log n)\log\frac{\Delta}{\varepsilon})\) time in the worst-case, where \(\Delta\) is the diameter of \(A\cup B\)._

Similar to the algorithm by Agarwal _et al._[5], our algorithm is also based on a cost-scaling approach and executes \(O(\log\frac{\Delta}{\varepsilon})\) scales. However, the algorithm within each scale is different. Agarwal _et al._ create a discrete OT instance with \(n^{4}\) vertices and \(n^{5}\) edges and use an exact discrete OT algorithm to solve this instance. Instead, we extend the combinatorial primal-dual framework of discrete OT to the continuous space and present an algorithm to find the desired semi-discrete transport plan in \(O(n^{4}\log n)\) time in the worst case. There are several challenges in extending the combinatorial framework to semi-discrete settings, and overcoming these challenges is one of the main technical contributions of the paper.

In more detail, in each scale, our algorithm maintains a (partial) transport plan, iteratively computes a set of augmenting paths, and augments the transport plan along such paths until all of the mass is transported. In order to assist in finding augmenting paths, we define a residual graph of size \(O(n^{3})\) in the continuous space. Algorithms for discrete OT maintain dual weights for all points in \(A\cup B\). Unlike in the discrete setting where the vertex set is fixed, the vertex set of our residual graph includes "continuous regions", which evolve over time, and the vertex set of the residual graph changes. Therefore, we are able to maintain weights only for points in \(B\) and not for the regions in \(A\). Our primal-dual framework (especially the definition of admissibility in Section 2), as well as our algorithm (in particular Sections 3.2 and 3.4) contain a number of novel ideas, carefully designed to address various challenges that arise due to the dynamically changing continuous regions of the residual graph. Like all existing algorithms, our algorithm also requires access to an oracle that, given a query triangle, returns the mass of \(\mu\) inside the triangle. We note that Dijkstra's shortest path algorithm has been extended to continuous space [47], but we are not aware of any previous work that extends a combinatorial discrete OT framework to continuous space.

Our algorithm extends to any dimension \(d\geq 2\) and any \(p\geq 1\) in a straightforward way. For \(d>2\), the algorithm in Theorem 1.1 can be shown to have an execution time of \(O(n^{d+1}(\Phi+n\log n)\log\frac{\Delta}{\varepsilon})\). Note that the runtime of Oliker-Prussner's algorithm has a factor \(1/\varepsilon\) while ours has only \(\log 1/\varepsilon\). Unlike their algorithm, ours does not make any assumptions on the smoothness of \(\mu\). Furthermore, similar to Agarwal et al. [5], our transport plan approximates an optimal weighted Voronoi diagram within a small additive factor.

One consequence of our algorithm is that we can use it to design a data structure that answers \(\varepsilon\)-close optimal transport queries efficiently. More precisely, consider a large distribution \(\mu\) with support of size \(N\). We can preprocess this distribution into a data structure that can return the total weight of points inside a query triangle in \(O(N^{1-1/d})\) time [59]. By using Theorem 1.1, we can report an \(\varepsilon\)-additive approximate transport plan to any query distribution \(\nu\) with support of size \(k\) in \(O(k^{d+1}N^{1-1/d}\log\frac{\Delta}{\varepsilon})\) time. Note that this query time is sub-linear in \(N\). There has been some work on computing \(1\)-Wasserstein distance approximately in sub-linear time and for answering nearest neighbor queries under \(1\)-Wasserstein distance [13], but these algorithms have larger error and do not extend to \(2\)-Wasserstein distance.

**Theorem 1.2**.: _Let \(\mu\) be a discrete probability distribution with a support \(A\subset\mathbb{R}^{d}\) of size \(N\). The distribution \(\mu\) can be preprocessed, in \(O(N\log N)\) time, into an \(O(N)\) size data structure so that for a discrete probability distribution \(\nu\) with a support \(B\subset\mathbb{R}^{d}\) of size \(k\), and a parameter \(\varepsilon>0\), an \(\varepsilon\)-close \(W_{2}\)-OT plan between \(\mu\) and \(\nu\) can be computed in \(O(k^{d+1}(N^{1-1/d}+k\log k)\log\frac{\Delta}{\varepsilon})\) time, where \(\Delta\) is the diameter of \(A\cup B\)._

If the points in the supports of \(\mu\) and \(\nu\) have integer coordinates and the masses on them are rational numbers, we can adapt our data structure in Theorem 1.2 to compute an exact \(W_{p}\)-OT plan between \(\mu\) and \(\nu\) in \(O(k^{d+1}(N^{1-1/d}+k\log k)\log\frac{\Delta}{\varepsilon})\) time for any fixed even value of \(p\).

We also note that in \(2\)-dimensions, for \(k<N^{1/4}\), we can use the data structure to compute an exact discrete OT plan for any distribution \(\nu\) in \(O(k^{3}N^{1/2}\log\Delta)\) time that is faster than any existing OT algorithm that takes \((Nk)^{1+o(1)}\) time [3, 18].

For simplicity in presentation, we restrict our presentation to \(d=2\) and \(p=2\).

## 2 Combinatorial Framework

In this section, we extend the combinatorial framework used by discrete OT algorithms to the semi-discrete settings. Let \(\mu\) be a continuous probability distribution defined over a compact support \(A\subset\mathbb{R}^{2}\) and \(\nu\) be a discrete distribution with a support set \(B\) of \(n\) points in \(\mathbb{R}^{2}\).

**Weighted Voronoi diagram.** For any pair of points \(a,b\in\mathbb{R}^{2}\), let \(\mathrm{d}(a,b)=\|a-b\|^{2}\). Given a weight function \(y:B\to\mathbb{R}_{\geq 0}\) on the points in \(B\), the _weighted distance_\(d_{y}(a,b)\) from a point \(b\in B\) to any point \(a\in\mathbb{R}^{2}\) is defined as \(\mathrm{d}_{y}(a,b)=\mathrm{d}(a,b)-y(b)\). For a point \(b\in B\), the _Voronoi cell_ of \(b\) is the locus of all points with \(b\) as their weighted nearest neighbor; more formally,

\[\mathrm{Vor}_{y}(b)=\{a\in\mathbb{R}^{2}\mid\mathrm{d}_{y}(a,b)\leq\mathrm{d} _{y}(a,b^{\prime}),\forall b^{\prime}\in B\}.\]

The _weighted Voronoi diagram_\(\mathrm{VD}_{y}(B)\) of the points \(B\) with weights \(y(\cdot)\) is the decomposition of \(\mathbb{R}^{2}\) induced by Voronoi cells. There exists a weight function \(y(\cdot)\) for \(B\) such that \(\mu(\mathrm{Vor}_{y}(b))=\nu(b)\) for every point \(b\in B\), and an optimal semi-discrete transport plan transports the mass of \(\nu\) at each point \(b\in B\) to the mass of \(\mu\) in \(\mathrm{Vor}_{y}(b)\cap A\)[12].

\(\delta\)-expanded Voronoi cell.Consider a weight function \(y(\cdot)\) for the points in \(B\). For any point \(b\in B\) and a parameter \(\delta>0\), consider the following weight function \(y_{b}^{\delta}\).

\[y_{b}^{\delta}(b^{\prime})=\begin{cases}y(b^{\prime})+\delta,&b^{\prime}=b,\\ y(b^{\prime}),&b^{\prime}\neq b.\end{cases}\] (1)

The \(\delta\)_-expanded Voronoi cell_ of \(b\), denoted by \(V_{b}^{\delta}\), is simply the Voronoi cell of \(b\) in the weighted Voronoi diagram \(\mathrm{VD}_{y_{b}^{\delta}}(B)\) of the point set \(B\) with weights \(y_{b}^{\delta}(\cdot)\). See Figure 1 (left).

\(\delta\)**-feasibility.** Any (possibly partial) transport plan \(\tau\) between \(\mu\) and \(\nu\) along with a weight function \(y(\cdot)\) for the points in \(B\) is \(\delta\)_-feasible_ if

1. for any pair \((a,b)\in A\times B\) with \(\tau(a,b)>0\), the point \(a\) lies inside the \(2\delta\)-expanded Voronoi cell \(V_{b}^{2\delta}\).

For any \(\delta\)-feasible transport plan \(\tau,y(\cdot)\), if \(\tau\) is a complete transport plan between \(\mu\) and \(\nu\), then \(\tau,y(\cdot)\) is called a \(\delta\)_-optimal transport plan_. Recall that any optimal transport plan transports the mass at \(b\) to its weighted Voronoi cell. In a \(\delta\)-optimal transport plan, however, the mass of each point \(b\in B\) is transported inside a \(2\delta\)-expansion of the Voronoi cell of \(b\). This introduces an additive increase of at most \(2\delta\) in the cost of the transport plan.

**Lemma 2.1**.: _Any \(\delta\)-optimal transport plan \(\tau,y(\cdot)\) between \(\mu\) and \(\nu\) is \(2\delta\)-close._

See Appendix A for a proof. Next, given a \(\delta\)-feasible transport plan \(\tau,y(\cdot)\), we define a residual graph and an augmenting path. We also introduce the process of augmenting \(\tau\) along an augmenting path, which allows us to increase the mass transported by \(\tau\).

Figure 1: (left) The \(\delta\)-expanded Voronoi cell \(V_{b}^{\delta}\) of \(b\) (green shaded area), (middle) the partitioning \(\mathcal{X}_{\delta}\), and (right) the green region shows the mass of \(\mu\) that is transported to \(b\), the red points show the representative points of regions, and the purple segments show the compressed transport plan \(\hat{\tau}\).

**Residual graph.** Given a \(\delta\)-feasible (possibly partial) transport plan \(\tau,y(\cdot)\), we construct a residual graph \(\mathcal{G}_{\delta}\) by first partitioning the support \(A\) of \(\mu\) into regions to form the vertex set of \(\mathcal{G}_{\delta}:=\mathcal{G}(\tau,y,\delta)\) and then defining a set of directed edges.

_Vertex set._ For each point \(b\in B\), consider the Voronoi cell of \(b\) and its \(\delta\)- and \(2\delta\)-expansions \(V_{b}^{\delta}\) and \(V_{b}^{2\delta}\). Let \(\mathcal{X}_{\delta}\) denote the arrangement [2] of these \(3n\) cells across all \(n\) points of \(B\). See Figure 1 (middle). For each region \(\varphi\) in this arrangement, pick an arbitrary _representative point_\(r_{\varphi}\) inside \(\varphi\) and assign it a mass of \(\mu_{r_{\varphi}}:=\mu(\varphi)\), where \(\mu(\varphi)=\int_{\varphi}\mu(a)\,da\) denotes the mass of \(\mu\) inside \(\varphi\). Let \(A_{\delta}\) denote the set of representative points of all regions in \(\mathcal{X}_{\delta}\). The vertex set of \(\mathcal{G}_{\delta}\) is the point set \(A_{\delta}\cup B\) along with a source vertex \(s\) and a sink vertex \(t\). We refer to any point \(b\in B\) whose mass is not fully transported by \(\tau\) as a _free_ point and define its _excess_ as the amount of mass of \(b\) that is not transported by \(\tau\), i.e., \(\mathrm{ex}(b)=\nu(b)-\int_{a\in A}\tau(a,b)\,da\). Similarly, any point \(r_{\varphi}\in A_{\delta}\) is free if \(\tau\) does not fully transport the mass into the region \(\varphi\), and its excess is defined as \(\mathrm{ex}(r_{\varphi})=\mu_{r_{\varphi}}-\sum_{b^{\prime}\in B}\tau(\varphi, b^{\prime})\).

_Edge set._ For each pair \((r_{\varphi},b)\in A_{\delta}\times B\), if \(\tau(\varphi,b)>0\), we add a _backward edge_ directed from \(r_{\varphi}\) to \(b\) in the residual graph. Furthermore, if \(r_{\varphi}\in V_{b}^{2\delta}\), we add a _forward edge_ directed from \(b\) to \(r_{\varphi}\) in \(\mathcal{G}_{\delta}\). Additionally, we add a forward edge from the source \(s\) to every free point \(b\in B\) and a backward edge directed from every free vertex \(r_{\varphi}\) to \(t\). This completes the description of the residual graph.

**Lemma 2.2**.: _For any \(\delta>0\) and a \(\delta\)-feasible transport plan \(\hat{\tau},y(\cdot)\), the residual graph \(\mathcal{G}_{\delta}\) has \(O(n^{2})\) vertices and \(O(n^{3})\) edges._

While describing our algorithm, it is useful to have the definition of weighted distance for all the backward edges, including those incident on \(t\). Therefore, we extend the definition of weighted distance to any edge \((r_{\varphi},t)\) as follows. Let \(b_{\varphi}\) denote the weighted nearest neighbor of \(r_{\varphi}\) in \(B\), i.e., \(b_{\varphi}:=\min_{b\in B}d_{y}(r_{\varphi},b)\). Define \(d_{y}(r_{\varphi},t):=d_{y}(r_{\varphi},b_{\varphi})+\delta\).

**Compressing a semi-discrete transport plan.** Given a semi-discrete transport plan \(\tau\) that transports mass from \(B\) to \(A\), we construct a transport plan \(\hat{\tau}\) from \(B\) to \(A_{\delta}\) as follows. For each pair \((r_{\varphi},b)\in A_{\delta}\times B\), let \(\hat{\tau}(r_{\varphi},b):=\tau(\varphi,b)\), i.e., we assign the entire mass transported from \(b\) to \(\varphi\) to the pair \((r_{\varphi},b)\) (Figure 1 (right)). We refer to the transport plan \(\hat{\tau}\) as the _compressed transport plan_.

**Lemma 2.3**.: _For any \(\delta\)-feasible semi-discrete transport plan \(\tau,y(\cdot)\), the compressed transport plan \(\hat{\tau}\) along with weights \(y(\cdot)\) is also \(\delta\)-feasible._

Conversely, consider a transport plan \(\hat{\tau},y(\cdot)\) from \(B\) to \(A_{\delta}\). One can compute a semi-discrete transport plan \(\tau\) that, given a pair \((r_{\varphi},b)\in A_{\delta}\times B\), arbitrarily transports a mass of \(\hat{\tau}(r_{\varphi},b)\) from \(b\) to \(\varphi\).

**Lemma 2.4**.: _Any \(\delta\)-feasible transport plan \(\hat{\tau},y(\cdot)\) from \(B\) to \(A_{\delta}\) can be converted into a \(\delta\)-feasible semi-discrete transport plan \(\tau\) from \(B\) to \(A\)._

We say that any compressed transport plan \(\hat{\tau}\) is a _forest_ if the edges transporting a positive mass in \(\hat{\tau}\) do not create an undirected cycle.

**Augmentation.** Given the residual graph \(\mathcal{G}_{\delta}\) for a \(\delta\)-feasible transport plan \(\hat{\tau},y(\cdot)\), an _alternating path_ (resp. _alternating cycle_) is a directed path (resp. directed cycle) in \(\mathcal{G}_{\delta}\). Note that, in any directed path (resp. cycle) in the residual graph, the edges alternate between forward and backward edges. An _augmenting path_\(P=\langle s,b_{1},r_{1},\ldots,r_{k},t=b_{k+1}\rangle\) is a directed path from the source vertex \(s\) to the sink vertex \(t\) in the residual graph. By construction, the vertex \(b_{1}\) and the vertex \(r_{k}\) are free vertices in the residual graph. One can _augment_\(\hat{\tau}\) along \(P\) as follows. Define the bottleneck capacity of the augmenting path \(P\) as \(\mathrm{bc}(P):=\min\{\mathrm{ex}(b_{1}),\mathrm{ex}(r_{k}),\min_{i\in[1,k-1]} \hat{\tau}(r_{i},b_{i+1})\}\). To augment \(\hat{\tau}\) along \(P\), set \(\hat{\tau}(r_{i},b_{i})\leftarrow\hat{\tau}(r_{i},b_{i})+\mathrm{bc}(P)\) for each forward edge \((b_{i},r_{i})\in P\) and \(\hat{\tau}(r_{i},b_{i+1})\leftarrow\hat{\tau}(r_{i},b_{i+1})-\mathrm{bc}(P)\) for each backward edge \((r_{i},b_{i+1})\in P\).

**Lemma 2.5**.: _The transport plan obtained after augmenting a \(\delta\)-feasible transport plan \(\hat{\tau},y(\cdot)\) along any augmenting path \(P\) in the residual graph is \(\delta\)-feasible._

Consider the following straightforward way to augment a semi-discrete transport plan. Given a \(\delta\)-feasible semi-discrete transport plan \(\tau\), \(y(\cdot)\), we can compute an augmenting path \(P\) in the residual graph and augment the compressed transport plan \(\hat{\tau}\) along \(P\). From Lemmas 2.3 and 2.5, \(\hat{\tau}\) remains \(\delta\)-feasible and from Lemma 2.4, the updated \(\delta\)-feasible transport plan \(\hat{\tau}\) can be converted to a \(\delta\)-feasible semi-discrete transport plan as desired. To obtain a complete transport plan, one can iteratively apply this procedure until there are no augmenting paths in the residual graph; however, this may result in an unbounded number of iterations. To obtain an efficient algorithm, we iteratively compute a set ofspecial augmenting paths called the "admissible" augmenting paths and augment the transport plan along these paths. By doing so, we can reduce the number of iterations to \(O(n)\).

**Admissibility.** Suppose \(\hat{\tau},y(\cdot)\) is a \(\delta\)-feasible transport plan between \(\mu\) and \(\nu\). For any pair of points \(b_{1},b_{2}\in B\) and any region \(\varphi\in\mathcal{X}_{\delta}\) such that \(\hat{\tau}(r_{\varphi},b_{2})>0\), the triple \((b_{1},r_{\varphi},b_{2})\) is _admissible_ if \(d_{y}(r_{\varphi},b_{1})<d_{y}(r_{\varphi},b_{2})\)2. See Figure 2 (left). Note that an admissible triple \((b_{1},r_{\varphi},b_{2})\) forms by a forward edge followed by a backward edge in the residual graph satisfying \(d_{y}(r_{\varphi},b_{1})<d_{y}(r_{\varphi},b_{2})\). Intuitively, for any admissible triple \(\langle b_{1},r_{\varphi},b_{2}\rangle\), the mass of \(\mu\) inside \(r_{\varphi}\) is transported from \(b_{2}\) but \(b_{1}\) is nearer to \(r_{\varphi}\) than \(b_{2}\) (with respect to the weighted distances).

Footnote 2: Discrete OT algorithms use the weights assigned to \(A\cup B\) to define admissible edges. Since \(A_{\delta}\) evolves during the execution of our algorithm, we cannot maintain weights for them, forcing us to define admissibility on a sequence of two consecutive edges \((b_{1},r_{\varphi})\) and \((r_{\varphi},b_{2})\) rather than per edge.

We extend the definition of admissibility to augmenting paths and alternating cycles as follows. Any augmenting path (resp. alternating cycle) \(P=\langle b_{1},r_{1},b_{2},\ldots,r_{k},b_{k+1}\rangle\) is _admissible_ if all triples \((b_{i},r_{i},b_{i+1})\), \(i\in[1,k]\), are admissible. In Figure 2(right), \(b_{2}\) transports mass to \(r_{1}\), and \(b_{1}\) is its weighted nearest neighbor. By augmenting along this admissible path, we increase \(\hat{\tau}(r_{1},b_{1})\) and reduce \(\hat{\tau}(r_{1},b_{2})\), thereby transporting more mass to \(r_{1}\) from its weighted nearest neighbor.

## 3 Algorithm

In this section, we present our cost-scaling algorithm that uses the combinatorial framework from Section 2 to compute an \(\varepsilon\)-close semi-discrete OT plan. Classical discrete OT algorithms assign weights to points in \(A\cup B\) and use them to identify a large set of augmenting paths. Their efficiency critically relies on the acyclicity of the "search" graph. In contrast, during the execution of our algorithm, a change in the weights of \(B\) creates a new weighted Voronoi diagram, which in turn changes \(A_{\delta}\), the discrete representation of \(A\), and thus the vertex set of the residual graph. Since \(A_{\delta}\) may change significantly in each iteration during the execution of our algorithm, we cannot maintain weights for them. This creates significant challenges as the algorithm searches for augmenting paths (See Section 3.2 for details). Furthermore, the updated residual graph may have cycles. We introduce additional steps in our algorithm to eliminate these cycles (See Section 3.4 for details). First, we present an overview of our algorithm and then present the details.

### Overview

The algorithm runs for \(O(\log\frac{\Delta}{\varepsilon})\) scales, where \(\Delta\) is the diameter of \(A\cup B\). In each scale \(\delta\), our algorithm maintains a transport plan \(\hat{\tau}_{\delta}\) and a weight \(y(b)\) for every point \(b\in B\). Initially, set \(\delta=\Delta^{2}\) and define \(y(b)=0\) for all \(b\in B\). In each scale \(\delta\), execute the following steps.

1. _Initialization:_ Set \(\tau_{\delta}\) to be an empty transport plan. Compute the residual graph \(\mathcal{G}_{\delta}\) and the compressed transport plan \(\hat{\tau}_{\delta}\) with respect to \(\tau_{\delta},y(\cdot)\).
2. _Iterations:_ While \(\hat{\tau}_{\delta}\) is not a complete transport plan:

Figure 2: (left) Three admissible triples \((b_{1},r_{1},b_{2}),(b_{1},r_{2},b_{2}),\) and \((b_{1},r_{3},b_{2})\), where solid (resp. dashed) lines show backward (resp. forward) edges, and (right) an admissible augmenting path.

1. Compute a set of admissible augmenting paths in the residual graph \(\mathcal{G}_{\delta}\) and augment \(\hat{\tau}_{\delta}\) along these paths using the SearchAndAugment procedure described in Section 3.2. At the end of this step, there are no admissible augmenting paths in the residual graph.
2. Adjust the weights of all points of \(B\) that are reachable from the source by admissible paths by \(\delta\) and recompute the set \(A_{\delta}\), the residual graph \(\mathcal{G}_{\delta}\), and the compressed transport plan \(\hat{\tau}_{\delta}\) using the IncreaseWeights procedure described in Section 3.3.
3. Update the compressed transport plan \(\hat{\tau}_{\delta}\) and the residual graph using the Acyclify procedure described in Section 3.4, so that the transport plan \(\hat{\tau}_{\delta}\) is a forest and the residual graph does not have any admissible cycles.

3. _Scale Update:_ Set \(\delta\leftarrow\delta/2\).

After the execution of a scale \(\delta\leq\varepsilon/2\), our algorithm terminates by returning a complete semi-discrete transport plan \(\tau_{\delta}\) obtained from the compressed complete transport plan \(\hat{\tau}_{\delta}\) (using Lemma 2.4).

**Invariants.** As shown in Section 4 below, our algorithm iteratively updates the weights \(y(\cdot)\) and the transport plan \(\hat{\tau}_{\delta}\) while maintaining the following invariants:

1. The transport plan \(\hat{\tau}_{\delta},y(\cdot)\) is \(\delta\)-feasible, and
2. At the start of each iteration, the transport plan \(\hat{\tau}_{\delta}\) is a forest and there are no admissible cycles in the residual graphs.

**Remark.** The algorithm by Agarwal et al. [5] creates a discrete instance in each scale of the algorithm by computing the arrangement of the \(\delta\)-, \(2\delta\)-, \(\ldots\), and \((4n+1)\delta\)-expanded Voronoi cells of each point \(b\in B\). Instead of using such a fine partition to create a discrete instance with \(O(n^{5})\) edges, we work directly with the continuous space, maintain a much smaller residual graph with \(O(n^{3})\) edges, and use our semi-discrete combinatorial framework to find a transport plan.

### SearchAndAugment Procedure

The SearchAndAugment procedure executes a partial DFS-style search to identify a set of admissible augmenting paths and augments the transport plan along these paths. The SearchAndAugment procedure is somewhat similar in style to the blocking flow procedure in Dinic's max-flow algorithm [23] or the partial-DFS procedure in Gabow-Tarjan's algorithm [27], both of which rely on the property that there are no admissible cycles in the residual graph. Unlike these algorithms, in our case, if we augment along an arbitrary admissible augmenting path, we may create an admissible cycle. See Figure 3.

We overcome this challenge by carefully calibrating the search algorithm in two ways. First, we begin our search from the free regions instead of the free points of \(B\). Thus, we reverse the direction of all the edges of the residual graph and begin our search from the sink \(t\). Second, we explore all forward edges incident on a region in the increasing order of their weighted distance. This order of processing edges ensures that no admissible cycles are created and that there are no more admissible augmenting paths in the residual graph after the SearchAndAugment procedure terminates. We provide the details below.

Let \(\overleftarrow{\mathcal{G}_{\delta}}\) be the graph formed by reversing the direction of all the edges of \(\mathcal{G}_{\delta}\). We conduct our search starting from the sink \(t\) in the graph \(\overleftarrow{\mathcal{G}_{\delta}}\). Initially, mark all points of \(B\) and all backward edges as unvisited, define \(U:=B\) as the set of unvisited points of \(B\), and \(Q=\langle t=b_{0}\rangle\) as the search path that the procedure grows. Execute the following steps until the search path \(Q\) becomes empty.

1. If \(Q=\langle t=b_{0},r_{1},b_{1},\ldots,r_{i},b_{i}\rangle\) for some \(i\geq 0\), 1. If there is an edge from \(b_{i}\) to \(s\) in \(\overleftarrow{\mathcal{G}_{\delta}}\) (i.e., \(b_{i}\) is a free point), then \(P=\langle s,b_{i},r_{i},\ldots,r_{1},t\rangle\) is an augmenting path in \(\mathcal{G}_{\delta}\). Augment \(\hat{\tau}_{\delta}\) along \(P\) and set \(Q=\langle t=b_{0}\rangle\). 2. Assume there is not edge from \(b_{i}\) to \(s\). If there is an unvisited edge \((b_{i},r)\) in \(\overleftarrow{\mathcal{G}_{\delta}}\), then add \(r=r_{i+1}\) to \(Q\). Otherwise, mark \(b_{i}\) as visited and remove \(b_{i}\) from \(U\) and \(Q\).

2. If \(Q=\langle t=b_{0},r_{1},b_{1},\ldots,b_{i},r_{i+1}\rangle\) for some \(i\geq 0\), let \(b:=\arg\min_{b^{\prime}\in U}d_{y}(r_{i+1},b^{\prime})\) denote the unvisited point with the minimum weighted distance to \(r_{i+1}\)3. Footnote 3: To perform this step efficiently, in the construction of the residual graph, for each \(r\in A_{\delta}\), we store the list of all neighbors of \(r\) sorted in increasing order of their weighted distance. 1. If \((b,r_{i+1},b_{i})\) is admissible, i.e., \(d_{y}(r_{i+1},b)<d_{y}(r_{i+1},b_{i})\), then add \(b\) as \(b_{i+1}\) to \(Q\). 2. Otherwise, remove \(r_{i+1}\) from \(Q\) and mark the edge \((b_{i},r_{i+1})\) as visited.

The algorithm terminates when the search path \(Q\) becomes empty, i.e., the procedure marked \(t\) as visited and removed it from \(Q\). The following lemma shows the properties of the SearchAndAugment procedure.

**Lemma 3.1**.: _Suppose invariants (11) and (12) hold at the start of the SearchAndAugment procedure. Then, during the execution of the SearchAndAugment procedure,_

1. _the transport plan_ \(\hat{\tau}_{\delta},y(\cdot)\) _remains_ \(\delta\)_-feasible,_
2. _any point_ \(b\in B\) _(resp. backward edge_ \((r,b)\)_) marked as visited will not form an admissible augmenting path during the execution of the procedure, and_
3. _there are no admissible cycles in the residual graph._

### IncreaseWeights Procedure

The IncreaseWeights procedure adjusts the weights of \(B\) leading to the formation of admissible augmenting paths. The IncreaseWeights procedure performs a DFS on the residual graph \(\mathcal{G}_{\delta}\) to compute a set \(\mathcal{K}\) of all vertices of \(B\) that are reachable from the source vertex \(s\) by admissible paths. It increases the weights of all points in \(\mathcal{K}\) by \(\delta\) (expand their Voronoi cells). Recall that the set \(A_{\delta}\), and thus \(\mathcal{G}_{\delta}\) as well as the compressed transport plan \(\hat{\tau}_{\delta}\) depend on the weights of \(B\). The procedure then recomputes \(A_{\delta}\), \(\mathcal{G}_{\delta}\), and \(\hat{\tau}_{\delta}\) from \(\tau_{\delta}\). See Appendix B.2 for complete details of the IncreaseWeights procedure. The following lemma states the properties of the IncreaseWeights procedure.

**Lemma 3.2**.: _Suppose invariant (11) holds at the start of the IncreaseWeights procedure. Then, during the execution of the IncreaseWeights procedure,_

1. _the transport plan_ \(\hat{\tau}_{\delta},y(\cdot)\) _remain_ \(\delta\)_-feasible,_
2. _the weight of each free point_ \(b\in B\) _increases by_ \(\delta\)_, and_
3. _the weight of each point_ \(b\in B\) _with free regions inside_ \(V_{b}^{\delta}\) _remains unchanged._

### Acyclify Procedure

The change in the weights of \(B\) in the IncreaseWeights procedure requires us to recompute the residual graph and the compressed transport plan. This recomputation may potentially create a cycle in the transport plan or an admissible cycle in \(\mathcal{G}_{\delta}\). The Acyclify procedure eliminates such cycles and ensures that the invariant (12) holds at the start of the next iteration. Converting the transport plan into a forest is critical for the efficiency of the SearchAndAugment procedure while eliminating admissible cycles is essential for the correctness of the SearchAndAugment procedure. The procedure executes the following steps. First, use the dynamic tree structure by Sleator and Tarjan [56] to make the transport plan \(\hat{\tau}_{\delta}\) a forest. Then, execute a partial DFS search from each unvisited point \(b\in B\) similar to the one described in the SearchAndAugment procedure to detect admissible cycles. Upon finding an admissible cycle, cancel the cycle right away, remove the vertices of the cycle from the search path, and continue the search. When all vertices are visited, no admissible cycles are remaining in the residual graph. Since canceling admissible cycles could have introduced new cycles in the transport plan, repeat the first step to update \(\hat{\tau}_{\delta}\) and make it a forest. See Appendix B.3 for details. The following lemma shows the properties of the Acylify procedure.

**Lemma 3.3**.: _Suppose invariant (I1) holds at the start of the Acylify procedure. Then, during the execution of the Acylify procedure,_

1. _the transport plan_ \(\hat{\tau}_{\delta},y(\cdot)\) _remains_ \(\delta\)_-feasible, and_
2. _the transport plan_ \(\hat{\tau}_{\delta}\) _is a forest and there are no admissible cycles in the residual graph._

This completes the description of our algorithm.

## 4 Algorithm Analysis

In this section, we first prove the correctness of our algorithm and then analyze its runtime.

**Proof of invariants (I1) and (I2).** For any scale \(\delta\), the initial transport plan \(\hat{\tau}_{\delta}\) is empty. Therefore, \(\hat{\tau}_{\delta}\) along with the weights \(y(\cdot)\) is \(\delta\)-feasible. By properties (S1), (W1), and (A1), the transport plan \(\hat{\tau}_{\delta},y(\cdot)\) remains \(\delta\)-feasible in each iteration of our algorithm, and therefore, invariant (I1) holds. The invariant (I2) is a direct consequence of property (A2) in Lemma 3.3.

**Proof of Correctness.** From Invariant (I1), in each scale \(\delta\), our algorithm maintains a \(\delta\)-feasible transport plan \(\hat{\tau}_{\delta},y(\cdot)\) during its execution. The while loop in Step 2 breaks when \(\hat{\tau}_{\delta}\) is a complete transport plan. Therefore, \(\hat{\tau}_{\delta}\) along with weights \(y(\cdot)\) is \(\delta\)-optimal. From Lemma 2.4, one can convert \(\hat{\tau}_{\delta}\) into a \(\delta\)-optimal semi-discrete transport plan \(\tau_{\delta}\). Given that our algorithm terminates when \(\delta\leq\varepsilon/2\), from Lemma 2.1, the transport plan returned by our algorithm is \(\varepsilon\)-close, as desired.

**Efficiency of the algorithm.** The SearchAndAugment procedure runs a partial DFS on the residual graph with \(O(n^{3})\) edges. Upon finding an augmenting path \(P\), the procedure augments the transport plan along \(P\) in \(O(|P|)\) time. In Lemma C.1, we use invariant (I2) to show that the total length of all augmenting paths found by the procedure is \(O(n^{3})\). Hence, the running time of the SearchAndAugment procedure is \(O(n^{3})\). The IncreaseWeights procedure stores a sorted list of neighbors for each region and executes a DFS procedure in the residual graph, which takes \(O(n^{3}\log n)\) time. After increasing the weight of a subset of points of \(B\), the procedure recomputes the residual graph \(\mathcal{G}_{\delta}\) and the transport plan \(\hat{\tau}_{\delta}\), which can be done in \(O(n^{2}(\Phi+n\log n))\) time. See Lemma C.2 in the appendix for details. In the Acylify procedure, converting a transport plan into a forest can be done using a dynamic tree data structure [56] in \(O(n^{3}\log n)\) time. To eliminate the admissible cycles, the Acylify procedure relies on a partial DFS that runs in \(O(n^{3})\) time. Therefore, the total time by the Acylify procedure is \(O(n^{3}\log n)\) (see Lemma C.3 for details). Combining the running times of all three procedures, each iteration of step 2 of our algorithm takes \(O(n^{2}(\Phi+n\log n))\) time. In the following lemma, we show that in each scale, the total number of iterations of step 2 of our algorithm is at most \(O(n)\).

**Lemma 4.1**.: _For each scale \(\delta\), the total number of iterations of step 2 of our algorithm is \(O(n)\)._

Proof Sketch.: Let \(\tau_{2\delta},y_{2\delta}(\cdot)\) denote the \(2\delta\)-feasible semi-discrete transport plan computed by our algorithm for scale \(2\delta\), and let \(\tau_{\delta},y_{\delta}(\cdot)\) denote a partial semi-discrete transport plan maintained during the execution of step 2 of our algorithm. Let \(\mathcal{X}_{2\delta}\) (resp. \(\mathcal{X}_{\delta}\)) denote the partitioning of the set \(A\) with respect to weights \(y_{2\delta}(\cdot)\) (resp. \(y_{\delta}(\cdot)\)). Let \(\mathcal{Y}\) be the arrangement of all \(3n\) cells used to construct \(\mathcal{X}_{2\delta}\) with all \(3n\) cells used to construct \(\mathcal{X}_{\delta}\). Let \(\hat{\tau}_{2\delta}\) (resp. \(\hat{\tau}_{\delta}\)) denote the compressed transport plan for \(\tau_{2\delta}\) (resp. \(\tau_{\delta}\)) using the partitioning \(\mathcal{Y}\). It is well-known that one can transform \(\hat{\tau}_{\delta}\) to \(\hat{\tau}_{2\delta}\) by augmenting \(\hat{\tau}_{\delta}\) along a set of augmenting paths \(\mathcal{P}\) on \(\mathcal{Y}\times B\) and rearrange the transported mass along a set of cycles \(\mathcal{C}\) on \(\mathcal{Y}\times B\). Consider an augmenting path \(P=\langle r_{1},b_{1},\ldots,r_{k},b_{k}\rangle\) in \(\mathcal{P}\). Since \(P\) is a simple path, it contains each point of \(B\) at most once and therefore, it has a length at most \(2n-1\). Additionally, for all \(i\in[1,k]\), \(\hat{\tau}_{2\delta}(r_{i},b_{i})>0\) and for each \(i\in[2,k]\), \(\hat{\tau}_{\delta}(r_{i},b_{i-1})>0\). For each edge \((r_{i},b_{i})\), since \(\hat{\tau}_{2\delta}(r_{i},b_{i})>0\), by \(2\delta\)-feasibility of \(\tau_{2\delta},y_{2\delta}(\cdot)\) (condition (F1)), the point \(b_{i}\) is a \(4\delta\)-weighted nearest neighbor of \(r_{i}\) with respect to weights \(y_{2\delta}(\cdot)\). Similarly, for each edge \((b_{i-1},r_{i})\), since \(\hat{\tau}_{\delta}(r_{i},b_{i-1})>0\), by \(\delta\)-feasibility of \(\tau_{\delta},y_{\delta}(\cdot)\) (condition (F1)), the point \(b_{i-1}\) is a \(2\delta\)-weighted nearest neighbor of \(r_{i}\) with respect to weights \(y_{\delta}(\cdot)\). Since the length of \(P\) is at most \(2n-1\) and the weight of \(b_{1}\) does not change (by property (W3) in Lemma 3.3), we show that for the free point \(b_{k}\) in \(P\), \(y_{\delta}(b_{k})-y_{2\delta}(b_{k})\leq 6n\delta\). Our algorithm increases the weight of \(b_{k}\) by \(\delta\) in each iteration (property (W2) in Lemma 3.3), and therefore after \(6n\) iterations, the point \(b_{k}\) cannot be free, i.e., after \(O(n)\) iterations, all points of \(B\) are fully transported in \(\tilde{\tau}_{\delta}\). We provide the full proof in Section C.4.

Using Lemma 4.1, the total time spent in step 2 in each scale of our algorithm is \(O(n^{3}(\Phi+n\log n))\). Since there are \(O(\log\frac{\Delta}{\varepsilon})\) scales, the overall runtime is \(O(n^{3}(\Phi+n\log n)\log\frac{\Delta}{\varepsilon})\), thereby proving Theorem 1.1.

## 5 Applications to the Discrete Optimal Transport Problem

In this section, we extend our combinatorial semi-discrete OT algorithm to the discrete OT problem and design a data structure that preprocesses and stores a large discrete distribution \(\mu\) and efficiently computes an \(\varepsilon\)-close OT plan between \(\mu\) and any query distribution \(\nu\) in sub-linear time relative to the support size of \(\mu\). More precisely, given a discrete distribution \(\mu\) with a (possibly large) support \(A\) of \(N\) points in \(\mathbb{R}^{2}\), we design a data structure that, given a query discrete distribution \(\nu\) with a support \(B\) of \(k\) points, computes an \(\varepsilon\)-close transport plan between \(\mu\) and \(\nu\) in \(O(k^{3}(\sqrt{N}+k\log k)\log\frac{\Delta}{\varepsilon})\) time. Additionally, we show that if the support points have bounded integer coordinates and the masses are rational numbers, our data structure can efficiently compute an exact discrete OT plan.

At a high level, our data structure interprets the large discrete distribution \(\mu\) as a continuous distribution and uses a simplex range-searching data structure as an oracle to compute the mass of \(\mu\) inside a query triangle. In this way, for any query distribution \(\nu\), one can execute the steps of our combinatorial semi-discrete algorithm to compute an \(\varepsilon\)-close transport plan between \(\mu\) and \(\nu\). More formally, our data structure preprocesses the distribution \(\mu\) into a simplex range-searching data structure RS-DS, which takes \(O(N)\) space, can be built in \(O(N\log N)\) time, and returns the mass of \(\mu\) inside a query triangle in \(\Phi=O(\sqrt{N})\) time [59]. Given a query discrete distribution \(\nu\), one can use our algorithm from Section 3 in conjunction with the RS-DS to compute an \(\varepsilon\)-close transport plan between \(\mu\) and \(\nu\) in \(O(k^{3}(\sqrt{N}+k\log k)\log\frac{\Delta}{\varepsilon})\) time leading to Theorem 1.2.

Consider the special case where the points in \(A\cup B\) have positive integer coordinates bounded by \(\lambda\), the mass of \(\mu\) (resp. \(\nu\)) on each point \(a\in A\) (resp. \(b\in B\)) is a rational number of form \(\frac{\pi}{T}\) (resp. \(\frac{\pi_{b}}{T}\)) for positive integers \(T\) and \(x_{a}\) (resp. \(x_{b}\)), and \(p\) is an even number. In this case, the \(p\)-Wasserstein cost of any transport plan between \(\mu\) and \(\nu\) is an integer multiple of \(\frac{1}{T}\), and therefore, any \(\frac{1}{2T}\)-close transport plan between \(\mu\) and \(\nu\) would have a minimum cost. Thus, one can compute an exact discrete OT plan between \(\mu\) and \(\nu\) by setting \(\varepsilon=\frac{1}{2T}\) in our data structure, which would have a query time of \(O(k^{3}(\sqrt{N}+k\log k)\log(\lambda T))\), leading to the following corollary.

**Corollary 5.1**.: _When the points in the supports of the distributions \(\mu\) and \(\nu\) have integer coordinates bounded by \(\lambda\) and the mass on each point is a rational number of form \(\frac{\pi}{T}\), our data structure computes, for any even number \(p\), an optimal solution for the \(p\)-Wasserstein problem between \(\mu\) and \(\nu\) in \(O(k^{3}(\sqrt{N}+k\log k)\log(\lambda T))\) time._

## 6 Conclusion

In this paper, we designed a novel combinatorial framework for the semi-discrete optimal transport problem and used it to compute an \(\varepsilon\)-close semi-discrete transport plan. We also used this framework to design a data structure that stores a discrete distribution \(\mu\) over a large support of size \(N\) and can compute \(\varepsilon\)-close OT cost between \(\mu\) and a query discrete distribution \(\nu\) in a time that is sub-linear in \(N\). We conclude with the following question: Can we use our combinatorial framework to compute an \(\varepsilon\)-close semi-discrete transport plan between high dimensional distributions in \(\operatorname{poly}(n,d,1/\varepsilon)\) time.

## Acknowledgement

Work by P.A. and K.Y. was supported by NSF grants CCF-22-23870 and IIS-24-02823 and by BSF grant 2022131. Work by S.R. and P.S. was supported by NSF grant CCF-2223871. We thank the anonymous reviewers for their useful comments.

## References

* [1]P. K. Agarwal and R. Sharathkumar (2014) Approximation algorithms for bipartite matching with metric and geometric costs. In Proc. 46th Annual ACM Sympos. on Theory of Computing, STOC '14, pp. 555-564. Cited by: SS1.
* [2]P. K. Agarwal and M. Sharir (2000) Arrangements and their applications. In Handbook of Computational Geometry, pp. 49-119. Cited by: SS1.
* [3]P. K. Agarwal, K. Fox, D. Panigrahi, K. R. Varadarajan, and A. Xiao (2017) Faster algorithms for the geometric transportation problem. In 33rd Internat. Symposium on Computational Geometry, Cited by: SS1.
* [4]P. K. Agarwal, S. Raghvendra, P. Shirzadian, and R. Sowle (2023) A higher precision algorithm for computing the \(1\)-Wasserstein distance. In Proc. 11th Internat. Conference on Learning Representations, Cited by: SS1.
* [5]P. K. Agarwal, S. Raghvendra, P. Shirzadian, and K. Yao (2024) Fast and accurate approximations of the optimal transport in semi-discrete and discrete settings. In Proc. 2024 Annual ACM-SIAM Sympos. on Discrete Algorithms, pp. 4514-4529. Cited by: SS1.
* [6]J. M. Altschuler, J. Niles-Weed, and A. J. Stromme (2022) Asymptotics for semidiscrete entropic optimal transport. SIAM Journal of Mathematical Analysis54 (2), pp. 1718-1741. Cited by: SS1.
* [7]L. Ambrogioni, U. Guclu, and M. van Gerven (2018) Wasserstein variational gradient descent: from semi-discrete optimal transport to ensemble variational inference. arXiv preprint arXiv:1811.02827. Cited by: SS1.
* [8]L. Ambrogioni, U. Guclu, and M. van Gerven (2019) k-gans: ensemble of generative models with semi-discrete optimal transport. arXiv preprint arXiv:1907.04050. Cited by: SS1.
* [9]D. An, Y. Guo, N. Lei, Z. Luo, S. Yau, and X. Gu (2019) AE-OT: a new generative model based on extended semi-discrete optimal transport. In Proc. 32nd Internat. Conference on Learning Representations, Cited by: SS1.
* [10]D. An, Y. Guo, M. Zhang, X. Qi, N. Lei, and X. Gu (2020) AE-OT-GAN: training gans from data specific latent distribution. In Proc. 16th European Conference on Computer Vision, pp. 548-564. Cited by: SS1.
* [11]F. Aurenhammer (1987) Power diagrams: properties, algorithms and applications. SIAM journal on computing16 (1), pp. 78-96. Cited by: SS1.
* [12]F. Aurenhammer, F. Hoffmann, and B. Aronov (1998) Minkowski-type theorems and least-squares clustering. Algorithmica20 (1), pp. 61-76. Cited by: SS1.
* [13]A. Backurs, Y. Dong, P. Indyk, I. Razenshteyn, and T. Wagner (2020) Scalable nearest neighbor search for optimal transport. In Internat. Conference on Machine Learning, pp. 497-506. Cited by: SS1.
* [14]M. G. Bellemare, I. Danihelka, W. Dabney, S. Mohamed, B. Lakshminarayanan, S. Hoyer, and R. Munos (2017) The Cramer distance as a solution to biased Wasserstein gradients. arXiv preprint arXiv:1705.10743. Cited by: SS1.
* [15]J. Benamou and Y. Brenier (2000) A computational fluid mechanics solution to the Monge-Kantorovich mass transfer problem. Numerische Mathematik84 (3), pp. 375-393. Cited by: SS1.

[MISSING_PAGE_POST]

* [18] Li Chen, Rasmus Kyng, Yang P Liu, Richard Peng, Maximilian Probst Gutenberg, and Sushant Sachdeva. Maximum flow and minimum-cost flow in almost-linear time. In _Proc. 63rd IEEE Annual Sympos. Foundations of Computer Science_, pages 612-623. IEEE, 2022.
* [19] Yucheng Chen, Matus Telgarsky, Chao Zhang, Bolton Bailey, Daniel Hsu, and Jian Peng. A gradual, semi-discrete approach to generative network training via explicit Wasserstein minimization. In _Internat. Conference on Machine Learning_, pages 1071-1080. PMLR, 2019.
* [20] Marco Cuturi. Sinkhorn distances: Lightspeed computation of optimal transport. In _Advances in Neural Information Processing Systems_, pages 2292-2300, 2013.
* [21] Fernando De Goes, Katherine Breeden, Victor Ostromoukhov, and Mathieu Desbrun. Blue noise through optimal transport. _ACM Transactions of Graphics_, 31(6):1-11, 2012.
* [22] Eustasio Del Barrio, Alberto Gonzalez Sanz, and Jean-Michel Loubes. Central limit theorems for semi-discrete Wasserstein distances. _Bernoulli_, 30(1):554-580, 2024.
* [23] Efim A Dinic. Algorithm for solution of a problem of maximum flow in networks with power estimation. In _Soviet Math. Doklady_, volume 11, pages 1277-1280, 1970.
* [24] Steven Fortune. Voronoi diagrams and Delaunay triangulations. _In Handbook of Discrete and Computational Geometry_, pages 225-265, 1995.
* [25] Emily Fox and Jiashuai Lu. A deterministic near-linear time approximation scheme for geometric transportation. In _Proc. 64th IEEE Annual Sympos. on Foundations of Computer Science_, pages 1301-1315. IEEE, 2023.
* [26] Kyle Fox and Jiashuai Lu. A near-linear time approximation scheme for geometric transportation with arbitrary supplies and spread. In _Proc. 36th Annual Sympos. on Computational Geometry_, pages 45:1-45:18, 2020.
* [27] H. N. Gabow and R. E. Tarjan. Faster scaling algorithms for network problems. _SIAM Journal of Computing_, 18(5):1013-1036, October 1989. ISSN 0097-5397.
* [28] Bruno Galerne, Arthur Leclaire, and Julien Rabin. Semi-discrete optimal transport in patch space for enriching Gaussian textures. In _Proc. 3rd Internat. Conference on Geometric Science of Information_, pages 100-108, 2017.
* [29] Bruno Galerne, Arthur Leclaire, and Julien Rabin. A texture synthesis model based on semi-discrete optimal transport in patch space. _SIAM Journal of Imaging Sciences_, 11(4):2456-2493, 2018.
* [30] Thomas O Gallouet and Quentin Merigot. A Lagrangian scheme a la Brenier for the incompressible Euler equations. _Foundations of Computational Mathematics_, 18(4):835-865, 2018.
* [31] Jing Gao, Peng Li, Asif Ali Laghari, Gautam Srivastava, Thippa Reddy Gadekallu, Sidra Abbas, and Jianing Zhang. Incomplete multiview clustering via semidiscrete optimal transport for multimedia data mining in IoT. _ACM Transactions of Multimedia Computing, Communications and Applications_, 20(6):1-20, 2024.
* [32] Aude Genevay, Marco Cuturi, Gabriel Peyre, and Francis Bach. Stochastic optimization for large-scale optimal transport. _Advances in Neural Information Processing Systems_, 29, 2016.
* [33] Antoine Houdard, Arthur Leclaire, Nicolas Papadakis, and Julien Rabin. A generative model for texture synthesis based on optimal transport between feature distributions. _Journal of Mathematical Imaging and Vision_, 65(1):4-28, 2023.
* [34] Martin Huesmann and Karl-Theodor Sturm. Optimal transport from Lebesgue to poisson. _The Annals of Probability_, 41(4):2426-2478, 2013.
* [35] Shayan Hundrieser, Thomas Staudt, and Axel Munk. Empirical optimal transport between different measures adapts to lower complexity. In _Annales de l'Institut Henri Poincare (B) Probabilites et statistiques_, volume 60, pages 824-846, 2024.

* [36] Andrey Boris Khesin, Aleksandar Nikolov, and Dmitry Paramonov. Preconditioning for the geometric transportation problem. _arXiv preprint arXiv:1902.08384_, 2019.
* [37] Jun Kitagawa. An iterative scheme for solving the optimal transportation problem. _Calculus of Variations and Partial Differential Equations_, 51(1):243-263, 2014.
* [38] Jun Kitagawa, Quentin Merigot, and Boris Thibert. Convergence of a Newton algorithm for semi-discrete optimal transport. _Journal of European Math. Society_, 21(9):2603-2651, 2019.
* [39] Nathaniel Lahn, Deepika Mulchandani, and Sharath Raghvendra. A graph theoretic additive approximation of optimal transport. _Advances in Neural Information Processing Systems_, 32, 2019.
* [40] Arthur Leclaire and Julien Rabin. A stochastic multi-layer algorithm for semi-discrete optimal transport with applications to texture synthesis and style transfer. _Journal of Mathematical Imaging and Vision_, 63(2):282-308, 2021.
* [41] Bruno Levy and Erica L Schwindt. Notions of optimal transport theory and how to implement them on a computer. _Computers & Graphics_, 72:135-148, 2018.
* [42] Zezeng Li, Shenghao Li, Zhanpeng Wang, Na Lei, Zhongxuan Luo, and David Xianfeng Gu. DPM-OT: a new diffusion probabilistic model based on optimal transport. In _Proc. IEEE/CVF Internat. Conference on Computer Vision_, pages 22624-22633, 2023.
* [43] Huidong Liu, GU Xianfeng, and Dimitris Samaras. A two-step computation of the exact GAN Wasserstein distance. In _Internat. Conference on Machine Learning_, pages 3159-3168, 2018.
* [44] Quentin Merigot. A multiscale approach to optimal transport. _Computer Graphics Forum_, 30(5):1583-1592, 2011.
* [45] Quentin Merigot and Boris Thibert. Optimal transport: discretization and algorithms. In _Handbook of Numerical Analysis_, volume 22, pages 133-212. Elsevier, 2021.
* [46] Jocelyn Meyron. Initialization procedures for discrete and semi-discrete optimal transport. _Computer-Aided Design_, 115:13-22, 2019.
* [47] Joseph SB Mitchell, David M Mount, and Christos H Papadimitriou. The discrete geodesic problem. _SIAM Journal of Computing_, 16(4):647-668, 1987.
* [48] Vladimir I Oliker and Laird D Prussner. On the numerical solution of the equation \(\frac{\partial^{2}z}{\partial x^{2}}\frac{\partial^{2}z}{\partial y^{2}}- \left(\frac{\partial^{2}z}{\partial x\partial y}\right)=f\) and its discretizations, i. _Numerische Mathematik_, 54(3):271-293, 1989.
* [49] James Orlin. A faster strongly polynomial minimum cost flow algorithm. In _Proc. 20th Annual ACM Sympos. Theory of Computing_, pages 377-387, 1988.
* [50] Aram-Alexandre Pooladian, Vincent Divol, and Jonathan Niles-Weed. Minimax estimation of discontinuous optimal transport maps: The semi-discrete case. In _Internat. Conference on Machine Learning_, pages 28128-28150. PMLR, 2023.
* [51] Hongxing Qin, Yi Chen, Jinlong He, and Baoquan Chen. Wasserstein blue noise sampling. _ACM Transactions of Graphics_, 36(5):1-13, 2017.
* [52] Sharath Raghvendra and Pankaj K Agarwal. A near-linear time \(\varepsilon\)-approximation algorithm for geometric bipartite matching. _Journal of the ACM_, 67(3):1-19, 2020.
* [53] Nathan A Seifert, Kirill Prozument, and Michael J Davis. Computational optimal transport for molecular spectra: The semi-discrete case. _The Journal of Chemical Physics_, 156(13), 2022.
* [54] R Sharathkumar and Pankaj K Agarwal. Algorithms for the transportation problem in geometric settings. In _Proc. 23rd Annual ACM-SIAM Sympos. on Discrete Algorithms_, pages 306-317, 2012.

* [55] Ilia Shumailov, Zakhar Shumaylov, Yiren Zhao, Nicolas Papernot, Ross Anderson, and Yarin Gal. Ai models collapse when trained on recursively generated data. _Nature_, 631(8022):755-759, 2024.
* [56] Daniel D Sleator and Robert Endre Tarjan. A data structure for dynamic trees. In _Proc. 13th Annual ACM Sympos. on Theory of Computing_, pages 114-122, 1981.
* [57] Kokichi Sugihara. Laguerre Voronoi diagram on the sphere. _Journal for Geometry and Graphics_, 6(1):69-81, 2002.
* [58] Bahar Taskesen, Soroosh Shafieezadeh-Abadeh, and Daniel Kuhn. Semi-discrete optimal transport: Hardness, regularization and numerical solution. _Mathematical Programming_, 199 (1):1033-1106, 2023.
* [59] Emo Welzl. Partition trees for triangle counting and other range searching problems. In _Proc. 4th Annual Sympos. Computational Geometry_, pages 23-33, 1988.

Missing Proofs of Section 2

In this section, we present the missing proofs and details of our combinatorial framework described in Section 2.

**Lemma 2.1**.: _Any \(\delta\)-optimal transport plan \(\tau,y(\cdot)\) between \(\mu\) and \(\nu\) is \(2\delta\)-close._

Proof.: Define the weighted cost of a transport plan \(\tau^{\prime}\) as \(\mathfrak{e}_{y}(\tau^{\prime}):=\sum_{b\in B}\int_{A}\mathrm{d}_{y}(a,b)\tau^ {\prime}(a,b)\,da\). For any complete transport plan \(\tau^{\prime}\),

\[\mathfrak{e}_{y}(\tau^{\prime})=\sum_{b\in B}\int_{A}\mathrm{d}_{y}(a,b)\tau^ {\prime}(a,b)\,da=\sum_{b\in B}\int_{A}\big{(}\mathrm{d}(a,b)-y(b)\big{)}\tau^ {\prime}(a,b)\,da=\mathfrak{e}(\tau^{\prime})-\sum_{b\in B}y(b)\nu(b).\] (2)

For any point \(a\in A\), let \(b_{a}\) denote the weighted nearest neighbor of \(a\), i.e., \(b_{a}:=\arg\min_{b\in B}\mathrm{d}_{y}(a,b)\). By property (F1) in the definition of \(\delta\)-feasibility,

\[\mathfrak{e}_{y}(\tau) =\sum_{b\in B}\int_{A}\mathrm{d}_{y}(a,b)\tau(a,b)\,da\leq\sum_{b \in B}\int_{A}\big{(}\mathrm{d}_{y}(a,b_{a})+2\delta\big{)}\tau(a,b)\,da\] \[=\sum_{b\in B}\int_{A}\mathrm{d}_{y}(a,b_{a})\tau(a,b)\,da+2\delta.\] (3)

Let \(\tau^{*}\) denote an optimal transport plan from \(\mu\) to \(\nu\). Then,

\[\mathfrak{e}_{y}(\tau^{*})=\sum_{b\in B}\int_{A}\mathrm{d}_{y}(a,b)\tau^{*}(a,b)\,da\geq\sum_{b\in B}\int_{A}\mathrm{d}_{y}(a,b_{a})\tau^{*}(a,b)\,da.\] (4)

Combining Equations (3) and (4) and plugging \(\tau\) and \(\tau^{*}\) in Equation (2),

\[\mathfrak{e}(\tau) =\mathfrak{e}_{y}(\tau)+\sum_{b\in B}y(b)\nu(b)\leq\bigg{[}\sum_{ b\in B}\int_{A}\mathrm{d}_{y}(a,b_{a})\tau(a,b)\,da+2\delta\bigg{]}+\sum_{b\in B }y(b)\nu(b)\] \[\leq\mathfrak{e}_{y}(\tau^{*})+2\delta+\sum_{b\in B}y(b)\nu(b)= \mathfrak{e}(\tau^{*})+2\delta.\]

Therefore, \(\mathfrak{e}(\tau)\leq\mathfrak{e}(\tau^{*})+2\delta\) and \(\tau\) is \(2\delta\)-close. 

Residual graph.Next, we show that for any \(\delta>0\) and any \(\delta\)-feasible transport plan \(\hat{\tau},y(\cdot)\), the residual graph \(\mathcal{G}_{\delta}\) has \(O(n^{2})\) vertices and \(O(n^{3})\) edges, leading to Lemma 2.2. To do so, we show below that the partitioning \(\mathcal{X}_{\delta}\) consists of \(O(n^{2})\) regions. We then conclude that the number of vertices of \(\mathcal{G}_{\delta}\) is \(O(n^{2})\). Furthermore, since the residual graph is a bipartite graph between set \(B\) of size \(n\) and set \(A_{\delta}\) of size \(O(n^{2})\), the number of edges of \(\mathcal{G}_{\delta}\) would be at most \(O(n^{3})\).

Recall that the partitioning \(\mathcal{X}_{\delta}\) is constructed as the arrangement of all Voronoi cells, \(\delta\)-expansions, and \(2\delta\)-expansions of the Voronoi cells of all points in \(B\). Let \(\mathcal{V}\) denote the set of vertices of this arrangement. Since the arrangement is a planar graph, the number of faces (i.e., regions) in \(\mathcal{X}_{\delta}\) is \(O(|\mathcal{V}|)\). Therefore, to show that \(\mathcal{X}_{\delta}\) has \(O(n^{2})\) regions, we show that the number of vertices of this arrangement is \(O(n^{2})\).

For each point \(b\in B\), let \(V_{b}^{0}\) (resp. \(V_{b}^{\hat{\delta}}\), \(V_{b}^{2\delta}\)) denote the Voronoi cell (resp. \(\delta\)-expanded Voronoi cell, \(2\delta\)-expanded Voronoi cell) of \(b\), and let \(y_{0}^{\hat{\delta}}\) (resp. \(y_{b}^{\hat{\delta}},y_{b}^{2\delta}\)) denote the weights of \(B\) used to compute the cell. Note that each Voronoi cell \(V_{b}^{i}\) for each \(b\in B\) and \(i\in\{0,\delta,2\delta\}\) has at most \(n\) vertices. Hence, the total number of Voronoi vertices in the arrangement \(\mathcal{X}_{\delta}\) is \(O(n^{2})\). Next, we count the number of intersection points of these Voronoi cells. For each pair of points \(b_{1},b_{2}\in B\), consider the pair of cells \(V_{b_{1}}^{i}\) and \(V_{b_{2}}^{j}\), for some \(i,j\in\{0,\delta,2\delta\}\). We show that \(V_{b_{1}}^{i}\) and \(V_{b_{2}}^{j}\) intersect each other in at most two points.

Define the _weighted bisector_ of two points \(b\) and \(b^{\prime}\) with respect to weights \(y(\cdot)\) as the locus of points that have the same weighted distance to \(b\) and \(b^{\prime}\), i.e., all points \(x\in\mathbb{R}^{2}\) such that \(\mathrm{d}_{y}(x,b)=\mathrm{d}_{y}(x,b^{\prime})\). Note that under the squared Euclidean distances, the weighted bisector of two points is a straight line. Let \(v\) denote an intersection point of \(V_{b_{1}}^{i}\) and \(V_{b_{2}}^{j}\), and suppose \(v\) lies on the segment of corresponding to the weighted bisector of \(b_{1}\) and a point \(b_{3}\in B\) (See Figure 4). Note that if \(b_{3}=b_{2}\), then \(V^{i}_{b_{1}}\) and \(V^{j}_{b_{2}}\) share a segment containing \(v\), which means that

\[\mathrm{d}_{y}(v,b_{1})-i=\mathrm{d}_{y^{i}_{b_{1}}}(v,b_{1})=\mathrm{d}_{y^{i}_ {b_{1}}}(v,b_{2})=\mathrm{d}_{y}(v,b_{2}),\]

and also

\[\mathrm{d}_{y}(v,b_{2})-j=\mathrm{d}_{y^{j}_{b_{2}}}(v,b_{2})=\mathrm{d}_{y^{j }_{b_{2}}}(v,b_{1})=\mathrm{d}_{y}(v,b_{1}).\]

Therefore, in this case, \(i=j=0\), and the two endpoints of the shared segment is counted toward the number of Voronoi vertices of the arrangement. Hence, we assume \(b_{3}\neq b_{2}\). In this case,

\[\mathrm{d}_{y^{i}_{b_{1}}}(v,b_{1})=\mathrm{d}_{y^{i}_{b_{1}}}(v,b_{3})=\min_ {b\in B}\mathrm{d}_{y^{i}_{b_{1}}}(v,b).\] (5)

By the construction of the weight function \(y^{i}_{b_{1}}(\cdot)\) in Equation (1), for any point \(b\in B\setminus\{b_{1},b_{2}\}\), \(y^{i}_{b_{1}}(b)=y^{j}_{b_{2}}(b)=y(b)\); thus, using Equation (5),

\[\mathrm{d}_{y^{j}_{b_{2}}}(v,b_{3})=\mathrm{d}_{y^{i}_{b_{1}}}(v,b_{3})=\min_ {b\in B\setminus\{b_{1},b_{2}\}}\mathrm{d}_{y^{i}_{b_{1}}}(v,b)=\min_{b\in B \setminus\{b_{1},b_{2}\}}\mathrm{d}_{y^{j}_{b_{2}}}(v,b).\] (6)

Using Equation (6), the point \(v\) also lies in the segment of \(V^{j}_{b_{2}}\) that corresponds to the weighted bisector of \(b_{2}\) and \(b_{3}\) with respect to weights \(y^{j}_{b_{2}}\). Thus,

\[\mathrm{d}_{y^{j}_{b_{1}}}(v,b_{1})=\mathrm{d}_{y^{i}_{b_{1}}}(v,b_{3})= \mathrm{d}_{y^{j}_{b_{2}}}(v,b_{3})=\mathrm{d}_{y^{j}_{b_{2}}}(v,b_{2}).\]

In other words, the point \(v\) satisfies

\[\mathrm{d}(v,b_{1})-(y(b_{1})+i)=\mathrm{d}(v,b_{2})-(y(b_{2})+j),\]

i.e., the point \(v\) lies on the weighted bisector of \(b_{1}\) and \(b_{2}\) (the blue dashed line in Figure 4). Since the weighted bisector is a straight line, it intersects the convex polygon \(V^{i}_{b_{1}}\) in at most \(2\) points; hence, the two Voronoi cells \(V^{i}_{b_{1}}\) and \(V^{j}_{b_{2}}\) intersect each other in at most \(2\) points. Since the are \(O(n^{2})\) pairs of such Voronoi cells, each intersecting each other in at most \(2\) points, the total number of intersection points is at most \(O(n^{2})\), as claimed.

**Lemma 2.2**.: _For any \(\delta>0\) and a \(\delta\)-feasible transport plan \(\hat{\tau},y(\cdot)\), the residual graph \(\mathcal{G}_{\delta}\) has \(O(n^{2})\) vertices and \(O(n^{3})\) edges._

Next, we extend our bounds for the number of vertices and edges of the residual graph in Lemma 2.2 to any dimension \(d\geq 3\) and show that for any pair of \(d\)-dimensional distributions \(\mu\) and \(\nu\) and any \(\delta\)-feasible transport plan \(\hat{\tau},y(\cdot)\), the residual graph \(\mathcal{G}_{\delta}\) has \(O(n^{d})\) vertices and \(O(n^{d+1})\) edges. We prove our bounds by showing that the number of vertices of the arrangement \(\mathcal{X}_{\delta}\) is \(O(n^{d})\). Using this

Figure 4: For two cells \(V^{i}_{b_{1}}\) (green cell) and \(V^{j}_{b_{2}}\) (orange cell), any intersection point \(v\) lies on their weighted bisector.

bound, we get that the number of regions in the arrangement is upper-bounded by \(O(n^{d})\); therefore, \(|A_{\delta}|=O(n^{d})\) and the residual graph has \(O(n^{d})\) vertices. Furthermore, since \(\mathcal{G}_{\delta}\) is a bipartite graph between set \(B\) with \(n\) points and set \(A_{\delta}\) with \(O(n^{d})\) points, the number of edges would be bounded by \(O(n^{d+1})\).

For each point \(b\in B\) and each \(i\in\{0,\delta,2\delta\}\), the Voronoi cell \(V_{b}^{i}\) has \(O(n^{\lceil d/2\rceil})\) vertices; since \(3n\) such cells are used in the construction of the arrangement, the total number of Voronoi vertices in the arrangement is \(O(n^{\lceil d/2\rceil+1})\). Next, we bound the number of intersection points of these Voronoi cells. For each \(d\)-tuple \((V_{b_{1}}^{i_{1}},V_{b_{2}}^{i_{2}},\ldots,V_{b_{d}}^{i_{d}})\) of Voronoi cells, for \(d\) distinct points \(b_{1},\ldots,b_{d}\) and \(d\) values \(i_{1},\ldots,i_{d}\in\{0,\delta,2\delta\}\), let \(v\) denote a point in the intersection of these cells. Similar to our analysis for \(2\)-dimensional distributions, we show that \(v\) lies on the weighted bisector of \(b_{1},\ldots,b_{d}\), where the weight of each point \(b_{j}\) is \(y(b_{j})+i_{j}\). Since this weighted bisector is a straight line, and since a straight line intersects a convex polytope in at most \(2\) points, each \(d\)-tuple of Voronoi cells intersect in at most \(2\) points, where the number of such \(d\)-tuples are \(O(n^{d})\)4. Therefore, we conclude that the number of intersection points is \(O(n^{d})\), as desired.

Footnote 4: Here, the constant is \(O(n^{d})\) hides a factor of \(3^{d}\).

Let \(v\) be an intersection point of the \(d\) Voronoi cells \(V_{b_{1}}^{i_{1}},V_{b_{2}}^{i_{2}},\ldots,\) and \(V_{b_{d}}^{i_{d}}\). Suppose \(v\) lies on the \((d-1)\)-dimensional hyperplane of \(V_{b_{1}}^{i_{1}}\) that is shared between \(b_{1}\) and a point \(b_{d+1}\in B\). In this case,

\[\mathrm{d}_{y_{b_{1}}^{i_{1}}}(v,b_{1})=\mathrm{d}_{y_{b_{1}}^{i_{1}}}(v,b_{d+ 1})=\min_{b\in B}\mathrm{d}_{y_{b_{1}}^{i_{1}}}(v,b).\] (7)

We claim that for any \(k\in\{1,\ldots,d\}\), \(y_{b_{k}}^{i_{k}}(b_{d+1})=y(b_{d+1})\). Consider the following two cases:

* If \(b_{d+1}=b_{j}\) for some \(j\in\{2,\ldots,d\}\), then \[\mathrm{d}_{y}(v,b_{1})-i_{1}=\mathrm{d}_{y_{b_{1}}^{i_{1}}}(v,b_{1})=\mathrm{d }_{y_{b_{1}}^{i_{1}}}(v,b_{j})=\mathrm{d}_{y}(v,b_{j}),\] and also \[\mathrm{d}_{y}(v,b_{j})-i_{j}=\mathrm{d}_{y_{b_{j}}^{i_{j}}}(v,b_{j})=\mathrm{ d}_{y_{b_{j}}^{i_{j}}}(v,b_{1})=\mathrm{d}_{y}(v,b_{1}).\] Therefore, \(i_{1}=i_{j}=0\) and for any \(k\in\{1,\ldots,d\}\), \(y_{b_{k}}^{i_{k}}(b_{d+1})=y(b_{d+1})\).
* Otherwise, \(b_{d+1}\notin\{b_{1},\ldots,b_{d}\}\) and by the construction of \(y_{b_{k}}^{i_{k}}(\cdot)\), for any \(k\in\{1,\ldots,d\}\), \(y_{b_{k}}^{i_{k}}(b_{d+1})=y(b_{d+1})\).

Therefore, from Equation (7),

\[\mathrm{d}_{y}(v,b_{d+1})=\mathrm{d}_{y_{b_{1}}^{i_{1}}}(v,b_{d+1})=\min_{b \in B}\mathrm{d}_{y_{b_{1}}^{i_{1}}}(v,b)=\min_{b\in B}\mathrm{d}_{y}(v,b),\] (8)

and for any \(k\in\{1,\ldots,d\}\), since \(v\) lies on a \((d-1)\)-dimensional hyperplane of \(V_{b_{k}}^{i_{k}}\), it has to lie on the hyperplane of \(V_{b_{k}}^{i_{k}}\) that is shared between \(b_{k}\) and \(b_{d+1}\); therefore, \(\mathrm{d}(v,b_{d+1})-y(b_{d+1})=\mathrm{d}(v,b_{k})-(y(b_{k})+i_{k})\). Thus,

\[\mathrm{d}(v,b_{1})-(y(b_{1})+i_{1})=\mathrm{d}(v,b_{2})-(y(b_{2})+i_{2})= \ldots=\mathrm{d}(v,b_{d})-(y(b_{d})+i_{d}).\] (9)

From Equation (9), the point \(v\) lies on the weighted bisector of \(b_{1},\ldots,b_{d}\) with weights \(y(b_{1})+i_{1},\ldots,y(b_{d})+i_{d}\), and the \(d\)-tuple \((V_{b_{1}}^{i_{1}},V_{b_{2}}^{i_{2}},\ldots,V_{b_{d}}^{i_{d}})\) intersect each other in at most \(2\) points.

**Lemma A.1**.: _For any dimension \(d\geq 2\), a parameter \(\delta>0\), and a \(\delta\)-feasible transport plan \(\hat{\tau},y(\cdot)\), the residual graph \(\mathcal{G}_{\delta}\) has \(O(n^{d})\) vertices and \(O(n^{d+1})\) edges._

Compressing the transport plan.Recall that for any semi-discrete transport plan \(\tau\) from \(B\) to \(A\), a set of weights \(y(\cdot)\), and a parameter \(\delta>0\), the compressed transport plan \(\hat{\tau}\) is a discrete transport plan from \(B\) to \(A_{\delta}\). Note that the definition of \(\delta\)-feasibility (and more precisely, condition (F1)) is applicable for the discrete OT as well; the discrete transport plan \(\hat{\tau}\) along with weights \(y(\cdot)\) for \(B\) is \(\delta\)-feasible if \(\hat{\tau}\) transports the mass of each point \(b\in B\) to points of \(A_{\delta}\) within its \(2\delta\)-expanded Voronoi cell. Any complete transport plan \(\hat{\tau}\) from \(B\) to \(A_{\delta}\) that is \(\delta\)-feasible along with weights \(y(\cdot)\) is called \(\delta\)-optimal.

**Lemma A.2**.: _Any \(\delta\)-optimal compressed transport plan \(\hat{\tau},y(\cdot)\) from \(B\) to \(A_{\delta}\) is \(2\delta\)-close._

Proof.: For any transport plan \(\tau^{\prime}\) from \(B\) to \(A_{\delta}\) define \(\mathfrak{e}_{y}(\tau^{\prime}):=\sum_{(r,b)\in A_{\delta}\times B}\mathrm{d}_{ y}(r,b)\tau^{\prime}(r,b)\). Then,

\[\mathfrak{e}_{y}(\tau^{\prime})=\sum_{(r,b)\in A_{\delta}\times B}\mathrm{d}_{ y}(r,b)\tau^{\prime}(r,b)=\sum_{(r,b)\in A_{\delta}\times B}\big{(}\mathrm{d}(r,b)- y(b)\big{)}\tau^{\prime}(r,b)=\mathfrak{e}(\tau^{\prime})-\sum_{b\in B}y(b) \nu(b).\] (10)

For any point \(r\in A_{\delta}\), let \(b_{r}\) denote the weighted nearest neighbor of \(r\), i.e., \(b_{r}:=\arg\min_{b\in B}\mathrm{d}_{y}(r,b)\). By the definition of \(\delta\)-feasibility, for any pair \((r,b)\) with \(\hat{\tau}(r,b)>0\), we have \(\mathrm{d}_{y}(r,b)\leq\mathrm{d}_{y}(r,b_{r})+2\delta\). Therefore,

\[\mathfrak{e}_{y}(\hat{\tau}) =\sum_{(r,b)\in A_{\delta}\times B}\mathrm{d}_{y}(r,b)\hat{\tau }(r,b)\leq\sum_{(r,b)\in A_{\delta}\times B}\big{(}\mathrm{d}_{y}(r,b_{r})+2 \delta\big{)}\hat{\tau}(r,b)\] \[=\sum_{(r,b)\in A_{\delta}\times B}\mathrm{d}_{y}(r,b_{r})\hat{ \tau}(a,b)+2\delta.\] (11)

Let \(\tau^{*}\) denote an optimal transport plan from \(B\) to \(A_{\delta}\). Then,

\[\mathfrak{e}_{y}(\tau^{*})=\sum_{(r,b)\in A_{\delta}\times B}\mathrm{d}_{y}(r, b)\tau^{*}(r,b)\geq\sum_{(r,b)\in A_{\delta}\times B}\mathrm{d}_{y}(r,b_{r}) \tau^{*}(r,b).\] (12)

Combining Equations (11) and (12) and plugging \(\hat{\tau}\) and \(\tau^{*}\) in Equation (10),

\[\mathfrak{e}(\hat{\tau}) =\mathfrak{e}_{y}(\hat{\tau})+\sum_{b\in B}y(b)\nu(b)\leq\bigg{[} \sum_{(r,b)\in A_{\delta}\times B}\mathrm{d}_{y}(r,b_{r})\hat{\tau}(r,b)+2 \delta\bigg{]}+\sum_{b\in B}y(b)\nu(b)\] \[\leq\mathfrak{e}_{y}(\tau^{*})+2\delta+\sum_{b\in B}y(b)\nu(b)= \mathfrak{e}(\tau^{*})+2\delta.\]

Therefore, \(\mathfrak{e}(\hat{\tau})\leq\mathfrak{e}(\tau^{*})+2\delta\) and \(\hat{\tau}\) is \(2\delta\)-close. 

The following observation, which is straightforward from the construction of the partitioning \(\mathcal{X}_{\delta}\), helps in proving Lemmas 2.3 and 2.4.

**Observation A.3**.: _For any region \(\varphi\in\mathcal{X}_{\delta}\) and any point \(b\in B\), the region \(\varphi\) either completely lies inside \(V_{b}^{2\delta}\) or it is completely outside \(V_{b}^{2\delta}\)._

**Lemma 2.3**.: _For any \(\delta\)-feasible semi-discrete transport plan \(\tau,y(\cdot)\), the compressed transport plan \(\hat{\tau}\) along with weights \(y(\cdot)\) is also \(\delta\)-feasible._

Proof.: Consider any point \(b\in B\) and any region \(\varphi\in\mathcal{X}_{\delta}\) such that \(\tau(\varphi,b)>0\), i.e., in the compressed graph, \(\hat{\tau}(r_{\varphi},b)>0\). To prove this lemma, we show that \(r_{\varphi}\in V_{b}^{2\delta}\). Since \(\tau(\varphi,b)>0\), there exists a point \(a\in\varphi\) such that \(\tau(a,b)>0\), and by the \(\delta\)-feasibility of \(\tau,y(\cdot)\), we have \(a\in V_{b}^{2\delta}\); therefore, using Observation A.3, the region \(\varphi\) has to completely lie inside \(V_{b}^{2\delta}\), and the representative point \(r_{\varphi}\), which is a point inside \(\varphi\) also lies inside \(V_{b}^{2\delta}\). Hence, \(\hat{\tau},y(\cdot)\) is \(\delta\)-feasible. 

**Lemma 2.4**.: _Any \(\delta\)-feasible transport plan \(\hat{\tau},y(\cdot)\) from \(B\) to \(A_{\delta}\) can be converted into a \(\delta\)-feasible semi-discrete transport plan \(\tau\) from \(B\) to \(A\)._

Proof.: Consider any transport plan \(\tau\) from \(B\) to \(A\) such that for any point \(b\in B\) and any region \(\varphi\in\mathcal{X}_{\delta}\), transports a mass of \(\hat{\tau}(r_{\varphi},b)\) from \(b\) to the mass of \(\mu\) inside the region \(\varphi\). One such construction is to assign \(\tau(a,b)=\frac{\hat{\tau}(r_{\varphi},b)}{\mu(\varphi)}\mu(a)\) for each point \(a\in\varphi\). We next show that the transport plan \(\tau\) is \(\delta\)-feasible.

Consider any point \(b\in B\) and any point \(a\in A\) such that \(\tau(a,b)>0\). We prove this lemma by showing that \(a\in V_{b}^{2\delta}\). Suppose \(\varphi\in\mathcal{X}_{\delta}\) is the region containing the point \(a\). Since \(\tau(a,b)>0\), we should have \(\hat{\tau}(r_{\varphi},b)>0\), and by the \(\delta\)-feasibility of \(\hat{\tau},y(\cdot)\), we have \(r_{\varphi}\in V_{b}^{2\delta}\). By Observation A.3, the whole region \(\varphi\) has to lies inside \(V_{b}^{2\delta}\) and therefore, the point \(a\) also lies inside \(V_{b}^{2\delta}\). Hence, \(\tau,y(\cdot)\) is \(\delta\)-feasible.

Augmentation.In this section, we first show that upon augmenting a transport plan \(\hat{\tau}\) along an augmenting path \(P\), the transport plan remains valid. We then show that upon augmentation, either a backward edge gets removed from the transport plan or a free point will become fully transported. We finally prove Lemma 2.5.

For an augmenting path \(P=\langle s,b_{1},r_{1},\ldots,r_{k},t\rangle\) from a free point \(b_{1}\) to a free point \(r_{k}\), recall that the bottleneck capacity of \(P\) is defined as

\[\operatorname{bc}(P):=\min\{\operatorname{ex}(b_{1}),\operatorname{ex}(r_{k}),\min_{i\in[1,k-1]}\hat{\tau}(r_{i},b_{i+1})\},\]

where \(\operatorname{ex}(b_{1})\) (resp. \(\operatorname{ex}(r_{k})\)) denotes the excess mass of \(b_{1}\) (resp. \(r_{k}\)). To show that the transport plan after augmentation is a valid one, we show that no point \(v\) in \(\mathcal{G}_{\delta}\) transports more mass than the mass at \(v\) and that each edge transports a non-negative amount of mass.

In the augmentation process, for any \(i\in\{1,\ldots,k-1\}\), we decrease \(\hat{\tau}(r_{i},b_{i+1})\) by \(\operatorname{bc}(P)\), where by definition, \(\operatorname{bc}(P)\leq\hat{\tau}(r_{i},b_{i+1})\); hence, \(\hat{\tau}(r_{i},b_{i+1})\geq 0\) after augmentation. Furthermore, for any forward edge \((b_{i},r_{i})\), \(i\in\{1,\ldots,k\}\), we increases \(\hat{\tau}(r_{i},b_{i})\) by \(\operatorname{bc}(P)\), and \(\hat{\tau}(r_{i},b_{i})\) remains non-negative.

For any \(i\in\{2,\ldots,k\}\), we increase \(\hat{\tau}(b_{i},r_{i})\) (resp. decrease \(\hat{\tau}(r_{i-1},b_{i})\)) by \(\operatorname{bc}(P)\); hence, the total amount of mass transported from \(b_{i}\) remains unchanged. Similarly, for each \(i\in\{1,\ldots,k-1\}\), we increase \(\hat{\tau}(b_{i},r_{i})\) (resp. decrease \(\hat{\tau}(r_{i},b_{i+1})\)) by \(\operatorname{bc}(P)\) and the total amount of mass transported into \(r_{i}\) remains unchanged. For the endpoint \(b_{1}\) (resp. \(r_{k}\)), we only increase the amount of mass transported from \(b_{1}\) (resp. into \(r_{k}\)) by \(\operatorname{bc}(P)\), where by definition, \(\operatorname{bc}(P)\leq\operatorname{ex}(b_{1})\) (resp. \(\operatorname{bc}(P)\leq\operatorname{ex}(r_{k})\)). Therefore, the total mass transport from \(b_{1}\) (resp. into \(r_{k}\)) after augmentation is at most \(\nu(b)\) (resp. \(\mu_{r_{k}}\)), as desired.

Note that if a backward edge \((r,b)\in P\) determines the bottleneck capacity of the augmenting path \(P\), then \(\hat{\tau}(r,b)=0\) after augmentation and the backward edge is removed from the residual graph. Otherwise, if the endpoint \(b_{1}\) (reps. \(r_{k}\)) determines the bottleneck capacity of \(P\), then \(b_{1}\) (resp. \(r_{k}\)) will be fully transported after augmentation.

**Lemma 2.5**.: _The transport plan obtained after augmenting a \(\delta\)-feasible transport plan \(\hat{\tau},y(\cdot)\) along any augmenting path \(\dot{P}\) in the residual graph is \(\delta\)-feasible._

Proof.: Let \(P=\langle s,b_{1},r_{1},\ldots,b_{k},r_{k},t\rangle\) denote an augmenting path in the residual graph. When augmenting the transport plan along \(P\), we increase the mass transportation on forward edges \((b_{i},r_{i})\) for each \(i\in[1,k]\) and decrease the mass transportation on the backward edges \((r_{i},b_{i+1})\) for each \(i\in[1,k-1]\). Therefore, any pair \((r,b)\) that transports mass after augmentation but was not transporting mass before augmentation has to be a forward edge of \(P\). Since we only add forward edges from the point \(b\) to the representative points in \(V_{b}^{2\delta}\cap A_{\delta}\), the edge \((r,b)\) satisfies the \(\delta\)-feasibility condition (F1), and \(\hat{\tau},y(\cdot)\) remains feasible after augmentation. 

## Appendix B Missing Details of Section 3

In this section, we provide the missing details of the implementation of the IncreaseWeights and Acyclify procedures and also prove the properties of the three procedures.

### Missing Proofs of the SearchAndAugment Procedure

**Lemma 3.1**.: _Suppose invariants (I1) and (I2) hold at the start of the SearchAndAugment procedure. Then, during the execution of the SearchAndAugment procedure,_

1. _the transport plan_ \(\hat{\tau}_{\delta},y(\cdot)\) _remains_ \(\delta\)_-feasible,_
2. _any point_ \(b\in B\) _(resp. backward edge_ \((r,b)\)_) marked as visited will not form an admissible augmenting path during the execution of the procedure, and_
3. _there are no admissible cycles in the residual graph._

Proof.: We prove the properties separately in the following.

_Property (S1)._ By the construction of the search path, any augmenting path computed by the SearchAndAugment procedure is an admissible augmenting path. From Lemma 2.5, augmenting\(\hat{\tau}_{\delta}\) along an admissible augmenting path does not violate the \(\delta\)-feasibility condition; hence, the transport plan \(\hat{\tau}_{\delta},y(\cdot)\) is a \(\delta\)-feasible transport plan during the execution of the SearchAndAugment procedure and (S1) holds.

Next, we present an overview of a new property of the SearchAndAugment procedure, which we formally state and prove in Lemma B.1 below. Using that, we first prove (S3) and then prove (S2).

In Figure 5 (left), suppose the blue edges show an admissible augmenting path found by the SearchAndAugment procedure, and suppose the green (resp. red) points show the unvisited (resp. visited) points of \(B\). For the region \(\varphi\), suppose \(\langle b_{1},b_{2},\ldots,b_{6}\rangle\) denote the set of neighbors of \(r_{\varphi}\) in \(\mathcal{G}_{\delta}\), sorted in increasing order of their weighted distance to \(r_{\varphi}\). When the partial DFS procedure processes \(r_{\varphi}\), the two weighted nearest neighbors of \(\varphi\) (i.e., \(b_{1}\) and \(b_{2}\)) are already marked as visited, leading the procedure to add \(b_{3}\) to the search path. After augmentation (Figure 5 (right)), for the newly created backward edge \((r_{\varphi},b_{3})\), the only admissible triples containing \((r_{\varphi},b_{3})\) are \((b_{1},r_{\varphi},b_{3})\) and \((b_{2},r_{\varphi},b_{3})\) (the triples highlighted in pink), where \(b_{3}\) is unvisited and both \(b_{1}\) and \(b_{2}\) are visited. More formally, as shown in Lemma B.1, for an augmenting path \(P\) found by the procedure, assuming that (S3) holds before augmentation along \(P\), for any newly created admissible triples \((b,r_{\varphi},b^{\prime})\) after augmenting the transport plan along \(P\), the point \(b\) (resp. \(b^{\prime}\)) is marked as visited (resp. unvisited).

_Property (S3)_. We begin by presenting an overview of our proof. Consider any augmenting path \(P\) found by the SearchAndAugment procedure. Assuming that (S3) holds before augmentation along \(P\), all vertices that are reachable from a visited point \(b\) by an admissible path in the procedure are also visited, since those points were also added to the search path, did not lead to an admissible augmenting path, marked as visited and removed from the search path. Hence, all points having an admissible path to the visited points (i.e., all points that are reachable from the visited points in our backward DFS) are also visited. Therefore, there are no admissible paths from an unvisited point to a visited point in the residual graph. After augmenting along \(P\), by Lemma B.1, for any newly formed admissible triple \((b,r_{\varphi},b^{\prime})\), the point \(b\) (resp. \(b^{\prime}\)) is visited (resp. unvisited), and since there are no admissible paths from any unvisited point to any visited point, the newly formed admissible triple \((b,r_{\varphi},b^{\prime})\) does not form a cycle of admissible triples. Hence, (S3) holds after augmentation as well.

We provide the details of the proof below.

Let \(P^{1},\ldots,P^{k}\) denote the sequence of augmenting paths computed by the SearchAndAugment procedure, and let \(\hat{\tau}^{0}_{\delta},\hat{\tau}^{1}_{\delta},\ldots,\hat{\tau}^{k}_{\delta}\) denote the sequence of transport plans computed by the procedure, i.e., \(\hat{\tau}^{0}_{\delta}\) is the transport plan computed in the previous iteration, and for each \(i\in[1,k]\), \(\hat{\tau}^{i}_{\delta}\) is obtained by augmenting \(\hat{\tau}^{i-1}_{\delta}\) along \(P^{i}\). Let \(\mathcal{G}^{i}\) denote the residual graph corresponding to \(\hat{\tau}^{i}_{\delta}\) for each \(i\in[0,k]\). Let \(V^{i}\) (resp. \(U^{i}\)) denote the set of visited (resp. unvisited) points in \(B\) when the procedure augments \(\hat{\tau}^{i-1}_{\delta}\) along \(P^{i}\).

Initially, from invariant (I2), there are no cycles of admissible triples in the residual graph, and (S3) holds for \(\mathcal{G}^{0}\). For any \(i\in[1,k]\), assuming \(\mathcal{G}^{0},\ldots,\mathcal{G}^{i-1}\) satisfies (S3), we show that \(\mathcal{G}^{i}\) also satisfies (S3). Suppose \((b,r,b^{\prime})\) is any admissible triple in \(\mathcal{G}^{i}\) formed after augmenting \(\hat{\tau}^{i-1}_{\delta}\) along \(P^{i}\), i.e., the triple \((b,r,b^{\prime})\) is admissible in \(\mathcal{G}^{i}\) but not in \(\mathcal{G}^{i-1}\). We show that the triple \((b,r,b^{\prime})\) does not participate in any admissible cycles; hence, using property (S3) on \(\mathcal{G}^{i-1}\), there are no admissible cycles in \(\mathcal{G}^{i}\) and property (S3) holds for \(\mathcal{G}^{i}\) as well.

Figure 5: (left) An augmenting path found by the SearchAndAugment procedure (blue path), and (right) two admissible triples (highlighted in pink) formed after augmentation.

Since (S3) holds for \(\mathcal{G}^{0},\ldots,\mathcal{G}^{i-1}\), for any visited point \(b\in V^{i-1}\), the point \(b\) has been added to the search path \(Q\) by the SearchAndAugment procedure, did not lead to the computation of an augmenting path, marked as visited and removed from the path. In this case, any point \(b^{\prime\prime}\) that is reachable from \(b\) by an admissible path in \(\widehat{\mathcal{G}^{i-1}}\) (and therefore, is reachable by our partial DFS procedure from \(b\)) would have also been added to the path, marked as visited and removed from \(Q\), i.e., any point \(b^{\prime\prime}\in B\) that has an admissible path to the visited point \(b\) in the residual graph \(\mathcal{G}^{i-1}\) is also visited. By this observation, there are no admissible paths from any unvisited point in \(B\) to any visited point in \(\mathcal{G}^{i-1}\). From Lemma B.1, for any newly formed admissible triple \((b,r,b^{\prime})\), we have \(b\in V^{i-1}\) and \(b^{\prime}\in U^{i-1}\). Thus, all admissible triples formed after augmenting \(\hat{\tau}^{i-1}_{\delta}\) along \(P^{i}\) are from a visited point to an unvisited point, while there are no admissible paths from any unvisited point to any visited point; therefore, the newly formed admissible triples do not form any admissible cycles and (S3) holds for \(\mathcal{G}^{i}\) as well.

_Property (S2)._ We use the property (S3) to show that (S2) holds. For any point \(b\in B\) that is marked as visited, as discussed above, if (S3) holds, all vertices that are reachable from \(b\) by an admissible path in our backward DFS (i.e., all points having an admissible path to \(b\) in the residual graph) are also visited. Since any free point \(b_{f}\in B\) is unvisited, \(b_{f}\) does not have an admissible path to any visited point \(b\in B\) and therefore, the visited points do not participate in an admissible augmenting path. Furthermore, the procedure marks a backward edge \((r,b)\) as visited if, for each admissible triple \((b^{\prime},r,b)\), the point \(b^{\prime}\) is visited. Since the point \(b^{\prime}\) cannot be included in an admissible augmenting path, the visited backward edge \((r,b)\) also does not form an admissible augmenting path.

**Lemma B.1**.: _During the execution of the SearchAndAugment procedure, suppose \(P\) is an admissible augmenting path found by the procedure, and let \(\mathcal{G}\) (resp. \(\mathcal{G}^{\prime}\)) denote the residual graph before (resp. after) augmenting the transport plan along \(P\). Let \((b,r,b^{\prime})\) denote an admissible triple in \(\mathcal{G}^{\prime}\) that is not admissible in \(\mathcal{G}\). Assuming that (S3) holds prior to augmentation along \(P\), the point \(b\) is marked as visited, and \(b^{\prime}\) is marked as unvisited._

Proof.: Consider any triple \((b,r,b^{\prime})\) that is admissible in \(\mathcal{G}^{\prime}\) but not in \(\mathcal{G}\). Recall that by the definition of the admissible triples, \((r,b^{\prime})\) is a backward edge in \(\mathcal{G}^{\prime}\) and \(\mathrm{d}_{y}(r,b)>\mathrm{d}_{y}(r,b^{\prime})\). Since the SearchAndAugment procedure does not change the weights \(y(\cdot)\), the only case where \((b,r,b^{\prime})\) is not admissible in \(\mathcal{G}\) is when \((r,b^{\prime})\) is not a backward edge in \(\mathcal{G}\), i.e., the pair \((b^{\prime},r)\) is in \(P\) as a forward edge, and augmenting \(\hat{\tau}_{\delta}\) along \(P\) results in transporting mass from \(b^{\prime}\) to \(r\). On the other hand, by step 2(a) of the SearchAndAugment procedure, a forward edge \((b^{\prime},r)\) will be added to the search path only if \(b^{\prime}\) is the weighted nearest unvisited neighbor of \(r\); in other words, since \(\mathrm{d}_{y}(r,b)>\mathrm{d}_{y}(r,b^{\prime})\) and the procedure added \(b^{\prime}\) to the search path (instead of \(b\)), the point \(b\) was marked as visited by the procedure. Therefore, for any newly formed admissible triple \((b,r,b^{\prime})\), point \(b\) (resp. \(b^{\prime}\)) is marked as visited (resp. unvisited). 

### Missing Details and Proofs of the IncreaseWeights Procedure

After the execution of the SearchAndAugment procedure, no admissible augmenting paths remain in the residual graph, i.e., there are no admissible paths from the source vertex \(s\) to the sink vertex \(t\). The IncreaseWeights procedure increases the weights of the subset of points in \(B\) that are reachable from \(s\) by admissible paths to expand their Voronoi cells and to create new admissible triples in the residual graph. For instance, in Figure 6 (left), the path from \(s\) to \(t\) is not admissible (the triple \((b_{2},r_{2},b_{3})\) is not admissible, as \(b_{3}\) has a lower weighted distance to \(r_{2}\) than \(b_{2}\)). As shown in Figure 6 (right), the IncreaseWeights procedure then increases the weight of the points \(b_{1}\) and \(b_{2}\) (which are reachable from \(s\)), leading to the formation of an admissible augmenting path (note that upon updating the weights, the regions corresponding to \(r_{1}\) and \(r_{2}\) have slightly changed). The details of the IncreaseWeights procedure are described below.

For each point \(r\in A_{\delta}\), let \(\mathcal{N}(r)\subseteq B\) denote the set of points \(b\in B\) with \(\hat{\tau}_{\delta}(r,b)>0\), sorted in decreasing order of their weighted distance to \(r\), i.e., \(\mathcal{N}(r)=\{b_{1},\ldots,b_{k}\}\) where \(\mathrm{d}_{y}(r,b_{1})\geq\mathrm{d}_{y}(r,b_{2})\geq\ldots\mathrm{d}_{y}(r,b_ {k})\). Mark all points \(b\in B\) and all forward edges \((b,r)\) as unvisited and set \(\mathcal{K}=\emptyset\), let \(U=B\) denote the set of unvisited points of \(B\), and define \(Q:=\langle s\rangle\) as the search path that the algorithm grows. Execute the following steps until \(Q\) becomes empty.

1. If \(Q=\langle s\rangle\), then if there exists an unvisited point \(b\in U\) such that \((s,b)\in\mathcal{G}_{\delta}\), then add \(b\) to \(Q\) as \(b_{1}\). Otherwise, remove \(s\) from \(Q\).
2. If \(Q=\langle s,b_{1},r_{1},\ldots,b_{i}\rangle\) for some \(i\geq 1\), 1. If there exists an unvisited forward edge \((b_{i},r)\) in \(\mathcal{G}_{\delta}\), add \(r\) to \(Q\) as \(r_{i+1}\). 2. Otherwise, mark \(b_{i}\) as visited, remove \(b_{i}\) from \(U\), add \(b_{i}\) to \(\mathcal{K}\), and remove \(b_{i}\) from \(Q\).
3. If \(Q=\langle s,b_{1},r_{1},\ldots,b_{i},r_{i}\rangle\) for some \(i\geq 1\), let \(b:=\arg\min_{b^{\prime}\in U\cap\mathcal{N}(r)}\mathrm{d}_{y}(r_{i},b^{\prime})\) denote the unvisited point of \(b\) with the minimum weighted distance to \(r\) among all points of \(B\) that transport mass to \(r\). 1. If \((b_{i},r_{i},b)\) is admissible, i.e., \(\mathrm{d}_{y}(r_{i},b)>\mathrm{d}_{y}(r_{i},b_{i})\), then add \(b\) as \(b_{i+1}\) to \(Q\). 2. Otherwise, remove \(r_{i}\) from \(Q\) and mark \((b_{i},r_{i})\) as visited.

After the DFS procedure terminates, for each point \(b\in\mathcal{K}\), set \(y(b)\gets y(b)+\delta\). This completes the description of the DFS step. We next describe how to recompute the residual graph and the compressed transport plan with respect to the updated weights.

Let \(y(\cdot)\) (resp. \(y^{\prime}(\cdot)\)) denote the weights of the points in \(B\) after (resp. before) the weight updates, let \(\mathcal{X}_{\delta}\) (resp. \(\mathcal{X}_{\delta}^{\prime}\)) denote the partitioning of the set \(A\) with respect to weights \(y(\cdot)\) (resp. \(y^{\prime}(\cdot)\)), and let \(A_{\delta}\) (resp. \(A_{\delta}^{\prime}\)) denote the set of representative points of the regions in \(\mathcal{X}_{\delta}\) (resp. \(\mathcal{X}_{\delta}^{\prime}\)). Furthermore, let \(\hat{\tau}_{\delta}^{\prime}\) denote the transport plan maintained by the algorithm for partitioning \(\mathcal{X}_{\delta}^{\prime}\). To compute the new transport plan \(\hat{\tau}_{\delta}\) for the point set \(A_{\delta}\), the IncreaseWeights procedure first computes the arrangement \(\mathcal{Y}\) of all \(3n\) cells used to construct \(\mathcal{X}_{\delta}^{\prime}\) with all \(3n\) cells used to construct \(\mathcal{X}_{\delta}\), i.e., \(\mathcal{Y}\) is the arrangement of Voronoi cell, \(\delta\)-expanded Voronoi cell, and \(2\delta\)-expanded Voronoi cell of each point \(b\in B\) both before and after weight updates. See Figure 7. For each region \(\varphi\in\mathcal{X}_{\delta}^{\prime}\cup\mathcal{X}_{\delta}\), let \(\mathcal{C}(\varphi)\subseteq\mathcal{Y}\) denote the set of regions of \(\mathcal{Y}\) that lie inside \(\varphi\). For each region \(\varrho\in\mathcal{Y}\), pick an arbitrary representative point \(r_{\varrho}\) inside \(\varrho\). We denote the set of all representative points of the regions in \(\mathcal{Y}\) by \(Y\).

The IncreaseWeights procedure first converts \(\hat{\tau}_{\delta}^{\prime}\) to a transport plan \(\hat{\tau}\) over the finer partitioning \(Y\times B\) by simply splitting each region \(\varphi^{\prime}\) in \(\mathcal{X}_{\delta}^{\prime}\) (and its mass transportation) to fine regions of \(\mathcal{Y}\) inside \(\varphi^{\prime}\). The procedure then uses \(\hat{\tau}\) to construct a transport plan \(\hat{\tau}_{\delta}\) over \(A_{\delta}\times B\) by merging the regions of \(\mathcal{Y}\) (and their mass transportation) to regions of \(\mathcal{X}_{\delta}\). The details are provided next.

For each point \(b\in B\), each region \(\varphi^{\prime}\in\mathcal{X}_{\delta}^{\prime}\) with \(\hat{\tau}_{\delta}^{\prime}(r_{\varphi^{\prime}},b)>0\), and each \(\varrho^{\prime}\in\mathcal{C}(\varphi^{\prime})\), set \(\hat{\tau}(\varrho^{\prime},b)=\frac{\mu(\varrho^{\prime})}{\mu(\varphi^{ \prime})}\hat{\tau}_{\delta}^{\prime}(r_{\varphi^{\prime}},b)\). This completes the description of the split step and the construction of \(\hat{\tau}\). Next, the procedure constructs \(\hat{\tau}_{\delta}\) by setting, for each point \(b\in B\) and each region \(\varphi\in\mathcal{X}_{\delta}\), \(\hat{\tau}_{\delta}(r_{\varphi},b):=\sum_{\varrho\in\mathcal{C}(\varphi)}\hat{ \tau}(\varrho,b)\). The transport plan \(\hat{\tau}_{\delta}\) is defined over \(A_{\delta}\times B\).

Figure 6: (left) After the execution of the SearchAndAugment procedure, there are no admissible augmenting paths in \(\mathcal{G}_{\delta}\), and (right) by increasing the weights of the points that are reachable from \(s\) by augmenting paths (points \(b_{1}\) and \(b_{2}\)), new admissible triples are created (e.g. \((b_{2},r_{2},b_{3})\)), which might lead to the formation of admissible augmenting paths.

Finally, for each region \(\varphi\in\mathcal{X}_{\delta}\), our algorithm stores a list \(\mathcal{N}(r_{\varphi})\) of all points \(b\in B\) with \(r_{\varphi}\in V_{b}^{2\delta}\), sorted in increasing order of their weights distance to \(r_{\varphi}\), i.e., \(\mathcal{N}(r_{\varphi})=\langle b_{1},\ldots,b_{k}\rangle\), \(r_{\varphi}\in V_{b_{i}}^{2}\) for each \(i\in[1,k]\), and \(\mathrm{d}_{y}(r_{\varphi},b_{i})\leq\mathrm{d}_{y}(r_{\varphi},b_{j})\) for each \(1\leq i<j\leq k\). This completes the description of the IncreaseWeights procedure.

**Lemma 3.2**.: _Suppose invariant (I1) holds at the start of the IncreaseWeights procedure. Then, during the execution of the IncreaseWeights procedure,_

1. _the transport plan_ \(\hat{\tau}_{\delta},y(\cdot)\) _remain_ \(\delta\)_-feasible,_
2. _the weight of each free point_ \(b\in B\) _increases by_ \(\delta\)_, and_
3. _the weight of each point_ \(b\in B\) _with free regions inside_ \(V_{b}^{\delta}\) _remains unchanged._

Proof.: Let \(y(\cdot)\) (resp. \(y^{\prime}(\cdot)\)) denote the weights of the points after (resp. before) the execution of the IncreaseWeights procedure, and let \(\mathcal{X}_{\delta}\) (resp. \(\mathcal{X}_{\delta}^{\prime}\)) be the partitioning with respect to weights \(y(\cdot)\) (resp. \(y^{\prime}(\cdot)\)). For any point \(a\in A\), let \(\varphi_{a}\) (resp. \(\varphi_{a}^{\prime}\)) be the region in \(\mathcal{X}_{\delta}\) (resp. \(\mathcal{X}_{\delta}^{\prime}\)) that contains \(a\), and let \(b_{a}\) (resp. \(b_{a}^{\prime}\)) denote the weighted nearest neighbor of \(a\) in \(B\) with respect to weights \(y(\cdot)\) (resp. \(y^{\prime}(\cdot)\)). For any pair of points \((a,b)\in A\times B\) with \(\tau_{\delta}^{\prime}(a,b)>0\), by the \(\delta\)-feasibility of \(\tau_{\delta}^{\prime},y^{\prime}(\cdot)\), we have \(\mathrm{d}_{y^{\prime}}(a,b)-2\delta\leq\mathrm{d}_{y^{\prime}}(a,b_{a}^{ \prime})\). To prove property (W1), we show that \(\mathrm{d}_{y}(a,b)-2\delta\leq\mathrm{d}_{y}(a,b_{a})\).

Recall that the IncreaseWeights procedure finds the subset \(\mathcal{K}\subset B\) of points that have admissible paths from the source vertex \(s\) of the residual graph and increases the weights of all points in \(\mathcal{K}\) by \(\delta\). Consider the following cases:

* If \(b\in\mathcal{K}\) is among the points whose weights are increased by the procedure, then \[\mathrm{d}_{y}(a,b)=\mathrm{d}_{y^{\prime}}(a,b)-\delta\leq\mathrm{d}_{y^{ \prime}}(a,b_{a}^{\prime})+\delta\leq\mathrm{d}_{y^{\prime}}(a,b_{a})+\delta \leq\mathrm{d}_{y}(a,b_{a})+2\delta,\] where the second inequality holds from \(\delta\)-feasibility of \(\tau_{\delta}^{\prime},y^{\prime}(\cdot)\), the third inequality holds since \(b_{a}\) is the weighted nearest neighbor of \(a\) with respect to \(y^{\prime}(\cdot)\), and the last inequality holds since \(y(b_{a})\leq y^{\prime}(b_{a})+\delta\). Consequently, \(\mathrm{d}_{y}(a,b)-2\delta\leq\mathrm{d}_{y}(a,b_{a})\).
* Otherwise, \(b\notin\mathcal{K}\) and \(\mathrm{d}_{y}(a,b)=\mathrm{d}_{y^{\prime}}(a,b)\).
* If \(b_{a}\in\mathcal{K}\), then \(\mathrm{d}_{y^{\prime}}(r_{\varphi_{a}},b)\leq\mathrm{d}_{y^{\prime}}(r_{ \varphi_{a}},b_{a})\) (since otherwise, the triple \((b_{a},r_{\varphi_{a}},b)\) would have been an admissible triple and \(b_{a}\in\mathcal{K}\) would have resulted in \(b\in\mathcal{K}\)). In this case, since the weighted nearest neighbor of \(a\) and \(r_{\varphi_{a}}\) are the same, \[\mathrm{d}_{y^{\prime}}(r_{\varphi_{a}},b_{a}^{\prime})\leq\mathrm{d}_{y^{ \prime}}(r_{\varphi_{a}},b)\leq\mathrm{d}_{y^{\prime}}(r_{\varphi_{a}},b_{a}) \leq\mathrm{d}_{y^{\prime}}(r_{\varphi_{a}},b_{a}^{\prime})+\delta,\] where the last inequality holds since increasing the weight of \(b_{a}^{\prime}\) by \(\delta\) made it the weighted nearest neighbor of \(a\). Therefore, the region \(\varphi_{a}\) and consequently, the point \(a\) lie inside \(V_{b}^{\delta}\) and \(V_{b_{a}}^{\prime}\). Thus, \[\mathrm{d}_{y}(a,b)=\mathrm{d}_{y^{\prime}}(a,b)\leq\mathrm{d}_{y^{\prime}}(a, b_{a})+\delta=\mathrm{d}_{y}(a,b_{a})+2\delta.\]
* Otherwise, if \(b_{a}\) is also not in \(\mathcal{K}\), then \(\mathrm{d}_{y}(a,b_{a})=\mathrm{d}_{y^{\prime}}(a,b_{a})\) and, \[\mathrm{d}_{y}(a,b)-2\delta=\mathrm{d}_{y^{\prime}}(a,b)-2\delta\leq\mathrm{d}_ {y^{\prime}}(a,b_{a})=\mathrm{d}_{y}(a,b_{a}).\]

Figure 7: (left) The partitioning \(\mathcal{X}_{\delta}^{\prime}\) before updating weights, (middle) the partitioning \(\mathcal{X}_{\delta}\) after updating the weights of the points of \(B\) that are reachable from \(s\) by admissible paths (the blue cross points), and (right) the combined partitioning \(\mathcal{Y}\).

As a result, the transport plan \(\tau_{\delta}\) along with the updated weights \(y(\cdot)\) is \(\delta\)-feasible and property (W1) holds.

Note that each free point \(b_{f}\in B\) has an edge from the source vertex \(s\); therefore, \(b_{f}\in\mathcal{K}\) and the IncreaseWeights increases the weight of \(b_{f}\) by \(\delta\), proving (W2). Furthermore, for each point \(b\in B\) with a free region \(\varphi\in V_{b}^{\delta}\), since we defined \(\mathrm{d}_{y}(r_{\varphi},t)=\min_{b^{\prime}\in B}\mathrm{d}_{y}(r_{\varphi},b^{\prime})\), the triple \((b,r_{\varphi},t)\) is admissible. Therefore, the SearchAndAugment procedure should have added \(r_{\varphi}\) and \(b\) to the search path, not found an admissible augmenting path, and marked \(b\) (resp. \((r,t)\)) as visited. Therefore, there are no admissible paths from the source to \(b\), or equivalently \(b\notin\mathcal{K}\), and the weight of \(b\) remains unchanged, leading to (W3). 

### Missing Details of the Acyclify Procedure

The goal of the Acyclify procedure is to ensure that the invariant (I2) holds, i.e., that at the beginning of each iteration of our algorithm, the transport plan is a forest and there are no admissible cycles in the residual graph. The procedure runs in three steps: (1) make \(\hat{\tau}_{\delta}\) a forest, as described in Section B.3.1, (2) cancel any admissible cycles from the residual graph, as described in Section B.3.2, and (3) acyclify the transport plan again, as described in Section B.3.1. Note that our procedure acyclifies the transport plan (to make it a forest) twice, in steps (1) and (3). Making the transport plan a forest in the first step is essential for the efficiency of the second step, and making it a forest in the third step is essential for invariant (I2), as canceling admissible cycles might introduce cycles in the transport plan.

#### b.3.1 Acyclifying the Transport Plan

Similar to the Acyclify procedure introduced in [54, Section 3.3], we use a dynamic tree structure to make \(\hat{\tau}_{\delta}\) a forest as follows. Let \(\mathcal{E}=\langle e_{1},e_{2},\ldots,e_{u}\rangle\) denote the set of all edges \(e=(r,b)\in A_{\delta}\times B\) with \(\hat{\tau}_{\delta}(r,b)>0\). For any \(k\leq u\), let \(\mathcal{E}_{k}:=\langle e_{1},e_{2},\ldots,e_{k}\rangle\). Define \(F_{0}:=\emptyset\) as an empty forest and \(\hat{\tau}^{\prime}_{0}(r,b)=0\) for all pairs \((r,b)\in A_{\delta}\times B\). Starting from \(k=1\), for any \(k\leq u\), the algorithm computes a forest \(F_{k}\) and a transport plan \(\hat{\tau}^{\prime}_{k}\) defined over \(F_{k}\) using \(F_{k-1}\) and \(\hat{\tau}^{\prime}_{k-1}\) as follows. If adding the edge \(e_{k}\) to \(F_{k-1}\) does not create a cycle, then the algorithm simply sets \(F_{k}\gets F_{k-1}\cup\{e_{k}\}\), \(\hat{\tau}^{\prime}_{k}(e_{k})\leftarrow\hat{\tau}_{\delta}(e_{k})\) and \(\hat{\tau}^{\prime}_{k}(e)\leftarrow\hat{\tau}^{\prime}_{k-1}(e)\) for all edges \(e\in F_{k-1}\). Otherwise, adding \(e_{k}\) to \(F_{k-1}\) results in the creation of an even-length cycle \(\mathcal{C}\). Let \(c\) denote the minimum capacity of the edges in \(\mathcal{C}\), and let \(e^{*}\) denote the edge with the minimum capacity. Consider an ordering of the edges of the cycle \(\mathcal{C}\) that starts with \(e^{*}\), i.e., \(\mathcal{C}=\langle e^{*}=e^{\prime}_{1},e^{\prime}_{2},\ldots,e^{\prime}_{2j}\rangle\). The algorithm increases (resp. reduces) the mass transported along the edge \(e^{\prime}_{2i}\) (resp. \(e^{\prime}_{2i-1}\)) by \(c\) for each \(i\in[1,j]\). Finally, the algorithm sets \(F_{k}\gets F_{k-1}\cup\{e_{k}\}\setminus\{e^{*}\}\). This completes the description of step 1. Using the dynamic tree structure by Sleator and Tarjan [56], each operation takes \(O(\log n)\) amortized time, and since \(|\mathcal{E}|=O(n^{3})\), this process takes a total of \(O(n^{3}\log n)\) time.

Figure 8: An example of a cycle in a transport plan that is created while increasing weights: (left) a transport plan that is a forest, (middle) the new Voronoi diagram and partitioning (red dashed lines) after increasing the weight of \(b_{1},b_{2},\) and \(b_{3}\), and (right) a cycle formed in the new residual graph.

#### b.3.2 Acyclifying the Admissible Triples

To remove all admissible cycles from the residual graph, we use a partial DFS similar to the one described in the SearchAndAugment procedure. Let \(\overleftarrow{\mathcal{G}_{\delta}}\) be the graph formed by reversing the direction of all the edges of \(\mathcal{G}_{\delta}\). The procedure first marks all points of \(B\) and all backward edges as unvisited and defines \(U:=B\) as the set of unvisited points. While there exists an unvisited point \(b\in B\), the procedure initializes a partial DFS by setting \(Q=(b=b_{1})\) and searches as follows until \(Q\) becomes empty.

1. If \(Q=\langle b_{1},r_{1},\ldots,b_{i}\rangle\) for some \(i\geq 1\), 1. If there are no unvisited backward edges \((b_{i},r)\) in \(\overleftarrow{\mathcal{G}_{\delta}}\), then mark \(b_{i}\) as visited and remove \(b_{i}\) from \(Q\) and \(U\). 2. Otherwise, there exists an unvisited backward edge \((b_{i},r_{\varphi})\). Add \(r_{\varphi}\) to \(Q\) as \(r_{i+1}\).
2. If \(Q=\langle b_{1},r_{1},\ldots,b_{i},r_{i}\rangle\) for some \(i\geq 1\), let \(b:=\arg\min_{b^{\prime}\in U}\mathrm{d}_{y}(r_{i},b^{\prime})\) be the unvisited point with the minimum weighted distance to \(r_{i}\). 1. If \((b,r_{i},b_{i})\) is admissible, i.e., \(\mathrm{d}_{y}(r_{i},b)<\mathrm{d}_{y}(r_{i},b_{i})\), * If be already exists in the path \(Q\) as \(b_{j}\), then \(C=\langle b_{j},r_{j},\ldots,b_{i},r_{i},b_{i+1}=b=b_{j}\rangle\) is an admissible cycle. Canel the cycle \(C\) (as described below) and set \(Q=\langle b_{1},r_{1},\ldots,b_{j}\rangle\). * Otherwise, add \(b\) as \(b_{i+1}\) to \(Q\). 2. Otherwise, remove \(r_{i}\) from \(Q\) and mark the backward edge \((r_{i},b_{i})\) as visited.

Given an admissible cycle \(C=\langle b_{j},r_{j},\ldots,b_{i},r_{i},b_{i+1}=b_{j}\rangle\), the procedure cancels the cycle as follows. Let \(bc(C):=\min_{t\in[j,i]}\hat{\tau}_{\delta}(r_{t},b_{t})\) denote the bottleneck capacity of the cycle \(C\). For any forward edge \((b_{t+1},r_{t})\) (resp. backward edge \((r_{t},b_{t})\)) in \(C\), set \(\hat{\tau}_{\delta}(r_{t},b_{t+1})\leftarrow\hat{\tau}_{\delta}(r_{t},b_{t+1} )+bc(C)\) (resp. \(\hat{\tau}_{\delta}(r_{t},b_{t})\leftarrow\hat{\tau}_{\delta}(r_{t},b_{t})-bc(C)\)). In this way, at least one of the backward edges of the cycle \(C\) is removed from the residual graph and the cycle has vanished.

**Lemma 3.3**.: _Suppose invariant (1) holds at the start of the Acyclify procedure. Then, during the execution of the Acyclify procedure,_

1. _the transport plan_ \(\hat{\tau}_{\delta},y(\cdot)\) _remains_ \(\delta\)_-feasible, and_
2. _the transport plan_ \(\hat{\tau}_{\delta}\) _is a forest and there are no admissible cycles in the residual graph._

Proof.: In the first step of the Acyclify procedure, the algorithm makes the transportation network to be a DAG. Note that the resulting transportation network is a subset of the transportation network before the Acyclify procedure, and therefore, for any transporting edge \((r,b)\in A_{\delta}\times B\), the point \(b\) is a \(2\delta\)-weighted nearest neighbor of \(r\), i.e., the transport plan obtained after the first step of the Acyclify procedure is \(\delta\)-feasible.

Next, we show property (A1) and (A2) for the second step of the procedure. By construction, all triples on the search path maintained by the procedure are admissible, and therefore, any cycle

Figure 9: An example of the formation of admissible cycles due to updating the weights and the residual graph: (left) a transport plan with no admissible cycles in the corresponding residual graph, (middle) the new Voronoi diagram and partitioning (red lines) after increasing the weights of \(b_{3}\) and \(b_{2}\), and (right) an admissible cycle \(\langle b_{1},r_{1},b_{2},r_{2},b_{3},r_{3}\rangle\) formed in the new residual graph.

computed by the second step of Acyclify procedure is admissible. Since all forward edges on the computed cycles are from points \(b\in B\) to regions in \(V_{b}^{2\delta}\), canceling a cycle \(C\) does not violate the \(\delta\)-feasibility condition (F1); hence, the transport plan \(\hat{\tau}_{\delta},y(\cdot)\) is a \(\delta\)-feasible transport plan during the execution of the second step of the Acyclify procedure and (A1) holds.

To prove property (A2), we show that

* any point \(b\in B\) (resp. backward edge \((r,b)\)) marked as visited will not form an admissible cycle during the execution of the procedure, and
* during the execution of the second step of the Acyclify procedure, the subgraph of the residual graph induced by visited vertices and their neighboring regions does not have any cycles of admissible triples. Furthermore, there are no admissible paths from an unvisited point to a visited point.

Assuming property (A3) holds, any point \(b\in B\) that is marked as visited does not participate in an admissible cycle. Since the Acyclify procedure stops when all points in \(B\) are visited, there are no admissible cycles in the residual graph. Furthermore, since the transport plan is maintained by a dynamic tree structure the transport plan is a forest. Therefore, to prove property (A2), we show that (A3) holds.

Furthermore, the property (A3) is a direct corollary of property (A4), as explained next: For each visited point \(b\in B\), all points \(b^{\prime}\in B\) having admissible paths to \(b\) are also visited (note that the Acylify procedure searches on the residual graph in the reverse direction of the edges), and if (A4) holds, there are no admissible cycles solely formed by visited vertices; hence, \(b\) does not form admissible cycles. Furthermore, the procedure marks a backward edge \((r,b)\) as visited if, for each admissible triple \((b^{\prime},r,b)\), the point \(b^{\prime}\) is visited. Since \(b^{\prime}\) is not a part of any admissible cycles (assuming (A4) holds), the triple \((b^{\prime},r,b)\) also cannot be a part of an admissible cycle. Therefore, to prove property (A3), we prove that (A4) holds in the following.

We use an inductive argument to prove (A4). Let \(C^{1},\ldots,C^{k}\) denote the sequence of admissible cycles found by the procedure, and let \(\hat{\tau}_{\delta}^{0},\ldots,\hat{\tau}_{\delta}^{k}\) denote the sequence of transport plans, where \(\hat{\tau}_{\delta}^{0}\) is the transport plan maintained by the algorithm at the beginning of the second step of the procedure and \(\hat{\tau}_{\delta}^{i}\) is obtained by canceling \(\hat{\tau}_{\delta}^{i-1}\) along \(C^{i}\). The property (A4) trivially holds at the beginning of the execution of the second step of the Acyclify procedure.

Note that the Acyclify procedure marks a point \(b\in B\) as visited only if the search from \(b\) did not lead to finding an admissible cycle, i.e., for all pairs \((b^{\prime},r)\in B\times A_{\delta}\) such that \((b^{\prime},r,b)\) is admissible, the point \(b^{\prime}\) is marked as visited and the backward edge \((r,b)\) is marked as visited. Hence, all points having an admissible path to the visited points (i.e., all points that are reachable from the visited points in our backward DFS) are also visited. Therefore, Assuming that property (A4) holds before marking \(b\) as visited, property (A4) holds after marking \(b\) as visited as well. Next, we show the same when we cancel a cycle \(C^{i}\).

First, note that all points of \(B\) that are on the search path are unvisited. Therefore, for any admissible cycle found by the procedure, the points of \(B\) on the cycle are unvisited. Using an identical proof as in Lemma B.1, one can show that after canceling a cycle, for any newly formed admissible triple \((b,r,b^{\prime})\), the point \(b\) is visited and the point \(b^{\prime}\) is unvisited. In other words, canceling a cycle \(C^{i}\) only creates additional admissible paths from visited points to unvisited points. Assuming that (A4) holds before canceling \(C^{i}\), since no new admissible triples are created from a visited point to another visited point, the subgraph induced by visited points and their neighboring regions remain free of admissible cycles after canceling \(C^{i}\). Furthermore, since no new admissible triples are created from an unvisited point to a visited point upon canceling \(C^{i}\), there will be no admissible paths from an unvisited point to a visited point after cancellation; hence, (A4) remains satisfied. 

## Appendix C Missing Details of Section 4

In this section, we analyze the efficiency of the three procedures SearchAndAugment, IncreaseWeights, and Acyclify.

### Efficiency of the SearchAndAugment Procedure

The SearchAndAugment procedure runs a partial DFS on the residual graph to find a set of admissible augmenting paths. The partial DFS procedure, upon backtracking from a point \(b\in B\) (resp. \(r\in A_{\delta}\)), marks the point \(b\) (resp. the backward edge \((b^{\prime},r)\) used to reach \(r\)) as visited and does not visit the point \(b\) (resp. the backward edge \((b^{\prime},r)\)) again in the same execution. Upon finding an augmenting path \(P\), the procedure augments the transport plan along \(P\) in \(O(|P|)\) time. Let \(\langle P_{1},\ldots,P_{k}\rangle\) denote the set of all augmenting paths found by the SearchAndAugment procedure. In \(2\) dimensions (resp. \(d\) dimensions), since the residual graph has \(O(n^{3})\) edges (resp. \(O(n^{d+1})\)), the running time of the procedure would be \(O(n^{3}+\sum_{i=1}^{k}|P_{i}|)\) (resp. \(O(n^{d+1}+\sum_{i=1}^{k}|P_{i}|)\)). In Lemma C.1, we show that \(\sum_{i=1}^{k}|P_{i}|=O(n^{3})\) (resp. \(\sum_{i=1}^{k}|P_{i}|=O(n^{d+1})\)). Hence, each execution of the SearchAndAugment procedure takes \(O(n^{3})\) (resp. \(O(n^{d+1})\)) time.

**Lemma C.1**.: _The total length of augmenting paths computed during the execution of the SearchAndAugment procedure is \(O(n^{3})\) in \(2\) dimensions and \(O(n^{d+1})\) in \(d\) dimensions._

Proof.: Let \(\hat{\tau}_{\delta}^{0}\) denote the transport plan maintained by the algorithm at the beginning of execution of the SearchAndAugment procedure. To prove this lemma, we categorize the augmenting paths found by the procedure based on the source of their bottleneck capacity, namely (1) set \(\mathcal{P}_{v}\) consisting of augmenting paths whose bottleneck capacity is determined based on the residual capacity of its endpoints, and (2) set \(\mathcal{P}_{e}\) consisting of augmenting paths whose bottleneck capacity is determined based on mass transportation over its backward edges. We first show that \(|\mathcal{P}_{v}|=O(n^{2})\) and then show the same bound for \(\mathcal{P}_{e}\). Since each augmenting path has a length of at most \(2n\), we then conclude that the total length of all augmenting paths is \(O(n^{3})\).

Let \(P\) be an augmenting path in \(\mathcal{P}_{v}\). If the bottleneck capacity of \(P\) is determined by a free point \(b\in B\) (resp. free region \(r\in A_{\delta}\)), then the mass of \(b\) (resp. \(r\)) will be fully transported after augmentation; therefore, since \(|A_{\delta}\cup B|=O(n^{2})\), we have \(|\mathcal{P}_{v}|=O(n^{2})\). Next, let \(P\) be an augmenting path in \(\mathcal{P}_{e}\); in this case, the backward edge \((r,b)\) determining the bottleneck capacity of \(P\) will be removed from the transport plan after augmentation. Note that by Lemma B.1, for any newly formed admissible triples \((b^{\prime},r,b)\), the point \(b^{\prime}\) is already marked as visited. By property (S2) in Lemma 3.1, the point \(b^{\prime}\) cannot form an admissible augmenting path during the same execution of the SearchAndAugment procedure. Hence, the edge \((r,b)\) determining the bottleneck capacity of \(P\) was a backward edge of the initial transport plan \(\hat{\tau}_{\delta}^{0}\) and augmentation along each path \(P\in\mathcal{P}_{e}\) removes one of the transporting edges of the transport plan \(\hat{\tau}_{\delta}^{0}\). Using invariant (I2), \(|\mathcal{P}_{e}|=O(n^{2})\), as claimed. Hence, the total number of augmenting paths found by the procedure is \(O(n^{2})\), and since each augmenting path has a length of at most \(2n\), their total length is \(O(n^{3})\).

Next, we extend our analysis to \(d\) dimensional space, for any \(d\geq 2\). Note that in \(d\) dimensions, the residual graph has \(O(n^{d})\) vertices and \(O(n^{d+1})\) edges. Hence, \(|\mathcal{P}_{v}|=O(n^{d})\). Since the transport plan \(\hat{\tau}_{\delta}^{0}\) is a forest over the point set \(A_{\delta}\cup B\), the total number of edges transporting a positive mass in \(\hat{\tau}_{\delta}^{0}\) would be \(O(n^{d})\); since augmenting the transport plan along each augmenting path in \(\mathcal{P}_{e}\) eliminates one of the edges transporting positive mass in \(\hat{\tau}_{\delta}^{0}\), \(|\mathcal{P}_{e}|=O(n^{d})\). Finally, since each augmenting path has a length of at most \(2n\), the total length of all augmenting paths found by the SearchAndAugment procedure would be \(O(n^{d+1})\). 

### Efficiency of the IncreaseWeights Procedure

In this section, we show that for \(2\)-dimensional (resp. \(d\)-dimensional) distributions, the IncreaseWeights procedure runs in \(O(n^{2}(\Phi+n\log n))\) (resp. \(O(n^{d}(\Phi+n\log n))\)) time. The IncreaseWeights procedure runs a DFS that visits each edge of the residual graph at most once and has a total running time of \(O(n^{3})\) (resp. \(O(n^{d+1})\)). Furthermore, in the arrangement used to construct partitioning \(\mathcal{Y}\), each point \(b\in B\) has at most \(6\) Voronoi cells (three cells that are used in the construction of \(\mathcal{X}_{\delta}\) and three that are used in the construction of \(\mathcal{X}_{\delta}^{\prime}\)). Using a similar discussion as Section A, one can show that the total number of vertices in the arrangement used to construct \(\mathcal{Y}\) is \(O(n^{2})\) (resp. \(O(n^{d})\)), and the number of regions in \(\mathcal{Y}\) is at most \(O(n^{2})\) (resp. \(O(n^{d})\)). The construction of the transport plan \(\hat{\tau}\) can be done in \(O(n^{2}(\Phi+n))\) (resp. \(O(n^{d}(\Phi+n))\)) time since (1) the mass of all regions in \(\mathcal{Y}\) can be determined in \(O(n^{2}\Phi)\) (resp. \(O(n^{d}\Phi)\)) time (partitioning the regions in \(\mathcal{Y}\) into simplices remains an arrangement with \(O(n^{2})\) (resp. \(O(n^{d})\)) vertices and therefore,have \(O(n^{2})\) (resp. \(O(n^{d})\)) regions), and (2) the mass transported on each pair \((\varrho,b)\in\mathcal{Y}\times B\) can be determined in \(O(1)\) time. Converting \(\hat{\tau}\) to \(\hat{\tau}_{\delta}\), as is done in the merge step, also takes \(O(n^{3})\) (resp. \(O(n^{d+1})\)) time, given that the total complexity of \(\hat{\tau}\) is \(O(n^{3})\) (resp. \(O(n^{d+1})\)). Finally, storing a sorted list of neighbors for each region \(r\in A_{\delta}\) takes \(O(n^{3}\log n)\) (resp. \(O(n^{d+1})\log n\)) time in total. Hence, the execution of the IncreaseWeights procedure takes \(O(n^{2}(\Phi+n\log n))\) (resp. \(O(n^{d}(\Phi+n\log n))\)) time.

**Lemma C.2**.: _Each execution of the IncreaseWeights procedure takes \(O(n^{2}(\Phi+n\log n))\) time in \(2\) dimensions and \(O(n^{d}(\Phi+n\log n))\) time in \(d\) dimensions._

### Efficiency of the Acyclify Procedure

The first step of this procedure uses a dynamic tree structure to acyclify the transport plan \(\hat{\tau}_{\delta}\). Using the dynamic tree structure by Sleator and Tarjan [56], since the total number of edges of the graph is \(O(n^{3})\) in \(2\) dimensions (resp. \(O(n^{d+1})\) in \(d\) dimensions), the running time of this step would be \(O(n^{3}\log n)\) (resp. \(O(n^{d+1}\log n)\)). In the second step, the procedure runs a partial DFS procedure on the residual graph and cancels the admissible cycles. The partial DFS procedure, upon backtracking from a point \(b\in B\) (resp. \(r\in A_{\delta}\)), marks the point \(b\) (resp. the backward edge \((b^{\prime},r)\) used to reach \(r\)) as visited and does not visit the point \(b\) (resp. the edge \((b^{\prime},r)\)) again in the same execution. Furthermore, upon finding an admissible cycle \(C\), it cancels the cycle in \(O(|C|)\) time. Let \(\langle C_{1},\ldots,C_{k}\rangle\) denote the set of all cycles found in the execution of the Acyclify procedure. In Lemma C.4, we show that \(\sum_{i=1}^{k}|C_{i}|=O(n^{3})\) in \(2\) dimensions (resp. \(\sum_{i=1}^{k}|C_{i}|=O(n^{d+1})\) in \(d\) dimensions). Given that the size of the residual graph is at most \(O(n^{3})\) (resp. \(O(n^{d+1})\)), the second step of the Acyclify procedure takes a total of \(O(n^{3}+\sum_{i=1}^{k}|C_{i}|)=O(n^{3})\) (resp. \(O(n^{d+1})\)) time, leading to the following lemma.

**Lemma C.3**.: _Each execution of the Acyclify procedure takes \(O(n^{3}\log n)\) time in \(2\) dimensions and \(O(n^{d+1}\log n)\) time in \(d\) dimensions._

**Lemma C.4**.: _The total length of admissible cycles computed during the execution of the second step of the Acyclify procedure is \(O(n^{3})\) in \(2\) dimensions and \(O(n^{d+1})\) time in \(d\) dimensions._

Proof.: Let \(\hat{\tau}_{\delta}^{0}\) denote the transport plan maintained by the algorithm at the beginning of execution of the Acyclify procedure. To prove this lemma, we show that the Acyclify procedure finds \(O(n^{2})\) admissible cycles, where each cycle has a length of at most \(2n\); hence, the total length of all cycles found by the procedure would be \(O(n^{3})\).

Let \(C\) be an admissible cycle found by the procedure; in this case, the backward edge determining the bottleneck capacity of \(C\) will be removed from the transport plan after cancellation. For any admissible triple \((b,r,b^{\prime})\) formed after canceling \(C\), using an identical argument as in Lemma B.1, one can show that the edge \((r,b^{\prime})\) is a backward edge that was on the cycle \(C\) as a forward edge, and the point \(b\) is marked as visited; hence, by Lemma 3.3, the point \(b\) does not form an admissible cycle in the same execution of the Acyclify procedure and therefore, the newly formed backward edge \((r,b^{\prime})\) cannot be included in any admissible cycles. Therefore, each cycle cancellation removes one of the backward edges of \(\hat{\tau}_{\delta}^{0}\), which is the transport plan obtained after the first step of the Acyclify procedure, i.e., the transportation network of \(\hat{\tau}_{\delta}^{0}\) is a forest and the number of its transporting edges is \(O(n^{2})\). Therefore, the total number of cycles found by the Acyclify procedure is \(O(n^{2})\), and their total length is \(O(n^{3})\), as claimed.

We next show that the total length of admissible cycles in \(d\) dimensions is \(O(n^{d+1})\) in \(d\) dimensions, for any \(d\geq 2\). Note that in \(d\) dimensions, the residual graph has \(O(n^{d+1})\) edges. Since the transport plan \(\hat{\tau}_{\delta}^{0}\) is a forest over the point set \(A_{\delta}\cup B\), the total number of edges transporting a positive mass in \(\hat{\tau}_{\delta}^{0}\) would be \(O(n^{d})\); since canceling each admissible cycle eliminates one of the edges transporting positive mass in \(\hat{\tau}_{\delta}^{0}\), \(|\mathcal{C}|=O(n^{d})\). Since each admissible cycle has a length of at most \(2n\), the total length of all admissible cycles found by the IncreaseWeights procedure would be \(O(n^{d+1})\). 

### Number of Iterations

**Lemma 4.1**.: _For each scale \(\delta\), the total number of iterations of step 2 of our algorithm is \(O(n)\)._Proof.: Let \(\tau_{2\delta},y_{2\delta}(\cdot)\) denote the \(2\delta\)-feasible transport plan computed by our algorithm for scale \(2\delta\), and let \(\tau_{5},y_{\delta}(\cdot)\) denote a partial transport plan maintained during the execution of step 2 of our algorithm. Let \(\mathcal{X}_{2\delta}\) (resp. \(\mathcal{X}_{\delta}\)) denote the partitioning of the set \(A\) with respect to weights \(y_{2\delta}(\cdot)\) (resp. \(y_{\delta}(\cdot)\)). Let \(\mathcal{Y}\) be the arrangement of all \(3n\) cells used to construct \(\mathcal{X}_{2\delta}\) with all \(3n\) cells used to construct \(\mathcal{X}_{\delta}\), i.e., \(\mathcal{Y}\) is the arrangement of Voronoi cell, \(\delta\)-expanded Voronoi cell, and \(2\delta\)-expanded Voronoi cell of each point \(b\in B\) with respect to weights \(y_{\delta}(\cdot)\) along with the Voronoi cell, \(2\delta\)-expanded Voronoi cell, and \(4\delta\)-expanded Voronoi cell of each point \(b\in B\) with respect to weights \(y_{2\delta}(\cdot)\). For each region \(\varrho\in\mathcal{Y}\), pick an arbitrary representative point \(r_{e}\) inside \(\varrho\). We denote the set of all representative points of the regions in \(\mathcal{Y}\) by \(Y\). Let \(\hat{\tau}_{2\delta}\) (resp. \(\hat{\tau}_{\delta}\)) denote the compressed transport plan for \(\tau_{2\delta}\) (resp. \(\tau_{\delta}\)) using the partitioning \(\mathcal{Y}\). Note that the partitioning \(\mathcal{Y}\) is a refinement of both partitionings \(\mathcal{X}_{\delta}\) and \(\mathcal{X}_{2\delta}\). Define \(\tau^{\prime}:=\hat{\tau}_{2\delta}-\hat{\tau}_{\delta}\).

We construct a bipartite graph \(\mathcal{G}^{\prime}\) over \(Y\times B\), where for any pair \((r,b)\in Y\times B\), there exists an edge directed from \(r\) to \(b\) if \(\tau^{\prime}(r,b)<0\) and directed from \(b\) to \(r\) if \(\tau^{\prime}(r,b)>0\). Consider any directed path \(P=\langle r_{1},b_{1},\ldots,r_{k},b_{k}\rangle\) from a free region \(r\in Y\) to a free point \(b\in B\) (with respect to \(\hat{\tau}_{\delta}\)). The path \(P\) is an augmenting path in the residual graph corresponding to \(\hat{\tau}_{\delta},y_{\delta}(\cdot)\).

Similar to the standard graph algorithms, we define the net-cost of the path \(P\) as \(\phi(P):=\sum_{i=1}^{k}d(r_{k},b_{k})-\sum_{i=1}^{k-1}d(r_{k},b_{k+1})\). Let \(b_{0}:=b_{r_{1}}\) be the weighted nearest neighbor of \(r_{1}\). Then, we can rewrite the net-cost of \(P\) as

\[\phi(P) =\mathrm{d}(r_{1},b_{0})+\sum_{i=1}^{k}\left[\mathrm{d}(r_{i},b_ {i})-\mathrm{d}(r_{i},b_{i-1})\right]\] \[=\mathrm{d}_{y_{\delta}}(r_{1},b_{0})+\sum_{i=1}^{k}\left[ \mathrm{d}_{y_{\delta}}(r_{i},b_{i})-\mathrm{d}_{y_{\delta}}(r_{i},b_{i-1}) \right]+y_{\delta}(b_{k}).\]

Due to \(\delta\)-feasibility of the transport plan \(\hat{\tau}_{\delta},y_{\delta}(\cdot)\), for all edges \((r_{i},b_{i-1})\), \(i\in[1,k]\), the point \(b_{i-1}\) is a \(2\delta\)-weighted nearest neighbor of \(r_{i}\); hence, \(\mathrm{d}_{y_{\delta}}(r_{i},b_{i})-\mathrm{d}_{y_{\delta}}(r_{i},b_{i-1}) \geq-2\delta\). Since the length of \(P\) is at most \(2n-1\),

\[\phi(P)=\mathrm{d}_{y_{\delta}}(r_{1},b_{0})+\sum_{i=1}^{k}\left[\mathrm{d}_{y _{\delta}}(r_{i},b_{i})-\mathrm{d}_{y_{\delta}}(r_{i},b_{i-1})\right]+y_{ \delta}(b_{k})\geq\mathrm{d}_{y_{\delta}}(r_{1},b_{0})+y_{\delta}(b_{k})-2n\delta.\] (13)

Similarly, we can rewrite the net-cost of \(P\) using weights \(y_{2\delta}\) as follows.

\[\phi(P)=\mathrm{d}_{y_{2\delta}}(r_{1},b_{0})+\sum_{i=1}^{k}\left[\mathrm{d}_ {y_{2\delta}}(r_{i},b_{i})-\mathrm{d}_{y_{2\delta}}(r_{i},b_{i-1})\right]+y_{2 \delta}(b_{k}).\]

According to the \(2\delta\)-feasibility of \(\hat{\tau}_{2\delta},y_{2\delta}(\cdot)\), for all edges \((r_{i},b_{i})\), \(i\in[1,k]\), the point \(b_{i}\) is a \(4\delta\)-weighted nearest neighbor of \(r_{i}\) (with respect to weights \(y_{2\delta}(\cdot)\)); hence, \(\mathrm{d}_{y_{2\delta}}(r_{i},b_{i})-\mathrm{d}_{y_{2\delta}}(r_{i},b_{i-1}) \leq 4\delta\). Since the length of \(P\) is at most \(2n-1\),

\[\phi(P)=\mathrm{d}_{y_{2\delta}}(r_{1},b_{0})+\sum_{i=1}^{k}\left[\mathrm{d}_{ y_{2\delta}}(r_{i},b_{i})-\mathrm{d}_{y_{2\delta}}(r_{i},b_{i-1})\right]+y_{2 \delta}(b_{k})\leq\mathrm{d}_{y_{2\delta}}(r_{1},b_{0})+y_{2\delta}(b_{k})+4n\delta.\] (14)

By property (W3) in Lemma 3.3, during the execution of step 2 of our algorithm, the weights of the points in \(B\) with free regions in their \(\delta\)-expansion remain unchanged; therefore, since \(b_{0}\) contains free regions inside its \(\delta\)-expanded Voronoi cell, \(y_{2\delta}(b_{0})=y_{\delta}(b_{0})\) and \(\mathrm{d}_{y_{2\delta}}(r_{1},b_{0})=\mathrm{d}_{y_{\delta}}(r_{1},b_{0})\). Combining with Equations (13) and (14),

\[y_{\delta}(b_{k})-2n\delta\leq\phi(P)-\mathrm{d}_{y_{\delta}}(r_{1},b_{0})=\phi (P)-\mathrm{d}_{y_{2\delta}}(r_{1},b_{0})\leq y_{2\delta}(b_{k})+4n\delta.\]

Equivalently,

\[y_{\delta}(b_{k})-y_{2\delta}(b_{k})\leq 6n\delta.\]

By property (W2) in Lemma 3.3, our algorithm increases the weight of the point \(b_{k}\) by \(\delta\) in each iteration while its mass is not fully transported by \(\hat{\tau}_{\delta}\); therefore, the point \(b_{k}\) cannot remain free after \(6n\) iterations, i.e., after \(O(n)\) iterations, there cannot be any remaining free points in \(B\) and the step 2 of our algorithm terminates after \(O(n)\) iterations.

### NeurIPS Paper Checklist

1. **Claims** Question: Do the main claims made in the abstract and introduction accurately reflect the paper's contributions and scope? Answer: [Yes] Justification: This paper presents a new combinatorial framework for the semi-discrete OT problem. It is used to design an algorithm for computing a \(\varepsilon\)-close semi-discrete transport plan, as well as a data structure for the discrete OT problem. Our main results are stated in Theorems 1.1 and 1.2 in the introduction and are summarized in the abstract.
2. **Limitations** Question: Does the paper discuss the limitations of the work performed by the authors? Answer: [Yes] Justification: Our semi-discrete OT algorithm relies on the existence of an oracle that computes the mass of \(\mu\) inside a triangle, which is common in existing algorithms for the semi-discrete optimal transport problem. We clearly state this assumption in the abstract and Theorem 1.1.
3. **Theory Assumptions and Proofs** Question: For each theoretical result, does the paper provide the full set of assumptions and a complete (and correct) proof? Answer: [Yes] Justification: All theorems and lemmas contain the full set of assumptions, and their proofs are either provided in the main text or the appendix.
4. **Experimental Result Reproducibility** Question: Does the paper fully disclose all the information needed to reproduce the main experimental results of the paper to the extent that it affects the main claims and/or conclusions of the paper (regardless of whether the code and data are provided or not)? Answer: [NA] Justification: This paper does not include experiments.
5. **Open access to data and code** Question: Does the paper provide open access to the data and code, with sufficient instructions to faithfully reproduce the main experimental results, as described in supplemental material? Answer: [NA] Justification: This paper does not include experiments.
6. **Experimental Setting/Details** Question: Does the paper specify all the training and test details (e.g., data splits, hyperparameters, how they were chosen, type of optimizer, etc.) necessary to understand the results? Answer: [NA] Justification: This paper does not include experiments.
7. **Experiment Statistical Significance** Question: Does the paper report error bars suitably and correctly defined or other appropriate information about the statistical significance of the experiments? Answer: [NA] Justification: This paper does not include experiments.
8. **Experiments Compute Resources** Question: For each experiment, does the paper provide sufficient information on the computer resources (type of compute workers, memory, time of execution) needed to reproduce the experiments?Answer: [NA] Justification: This paper does not include experiments.
9. **Code Of Ethics** Question: Does the research conducted in the paper conform, in every respect, with the NeurIPS Code of Ethics https://neurips.cc/public/EthicsGuidelines? Answer: [Yes] Justification: There are no data or human subjects involved in the research process of this paper and there are no known societal impacts and potentially harmful consequences associated with the research conducted in this paper.
10. **Broader Impacts** Question: Does the paper discuss both potential positive societal impacts and negative societal impacts of the work performed? Answer: [NA] Justification: None of the categories described by the NeurIPS Code of Ethics, namely, safety, security, discrimination, surveillance, deception and harassment, environment, human rights, and bias and fairness is impacted by the research conducted in this paper.
11. **Safeguards** Question: Does the paper describe safeguards that have been put in place for responsible release of data or models that have a high risk for misuse (e.g., pretrained language models, image generators, or scraped datasets)? Answer: [NA] Justification: The paper poses no such risks.
12. **Licensees for existing assets** Question: Are the creators or original owners of assets (e.g., code, data, models), used in the paper, properly credited and are the license and terms of use explicitly mentioned and properly respected? Answer: [NA] Justification: The paper does not use existing assets.
13. **New Assets** Question: Are new assets introduced in the paper well documented and is the documentation provided alongside the assets? Answer: [NA] Justification: The paper does not release new assets.
14. **Crowdsourcing and Research with Human Subjects** Question: For crowdsourcing experiments and research with human subjects, does the paper include the full text of instructions given to participants and screenshots, if applicable, as well as details about compensation (if any)? Answer: [NA] Justification: This paper does not involve crowdsourcing nor research with human subjects.
15. **Institutional Review Board (IRB) Approvals or Equivalent for Research with Human Subjects** Question: Does the paper describe potential risks incurred by study participants, whether such risks were disclosed to the subjects, and whether Institutional Review Board (IRB) approvals (or an equivalent approval/review based on the requirements of your country or institution) were obtained? Answer: [NA] Justification: This paper does not involve crowdsourcing nor research with human subjects.