# Semantic Feature Learning for Universal Unsupervised Cross-Domain Retrieval

Lixu Wang

Northwestern University, IL, USA

lixuwang2025@u.northwestern.edu &Xinyu Du

General Motors Global R&D, MI,USA

xinyu.du@gm.com &Qi Zhu

Northwestern University, IL, USA

qzhu@northwestern.edu

###### Abstract

Cross-domain retrieval (CDR) is finding increasingly broad applications across various domains. However, existing efforts have several major limitations, with the most critical being their reliance on accurate supervision. Recent studies thus focus on achieving unsupervised CDR, but they typically assume that the category spaces across domains are identical, an assumption that is often unrealistic in real-world scenarios. This is because only through dedicated and comprehensive analysis can the category composition of a data domain be obtained, which contradicts the premise of unsupervised scenarios. Therefore, in this work, we introduce the problem of Universal Unsupervised Cross-Domain Retrieval (\(\text{U}^{2}\texttt{CDR}\)) for the first time and design a two-stage semantic feature learning framework to address it. In the first stage, a cross-domain unified prototypical structure is established under the guidance of an instance-prototype-mixed contrastive loss and a semantic-enhanced loss, to counteract category space differences. In the second stage, through a modified adversarial training mechanism, we ensure minimal changes for the established prototypical structure during domain alignment, enabling more accurate nearest-neighbor searching. Extensive experiments across multiple datasets and scenarios, including close-set, partial, and open-set CDR, demonstrate that our approach significantly outperforms existing state-of-the-art CDR methods and other related methods in solving \(\text{U}^{2}\texttt{CDR}\) challenges.

## 1 Introduction

In real-world applications, cross-domain retrieval (CDR) finds extensive utility across diverse domains, such as image search [1], product recommendations [2], and artistic creation [3; 4]. However, the efficacy of current CDR methods relies heavily on accurate and sufficient supervision [5; 6] to provide categorical or cross-domain pairing labels. The acquisition of such information demands costly efforts and resources. Hence, there is an urgent need to develop unsupervised CDR techniques.

For the regular Unsupervised CDR (UCDR) problem [7; 8], there are two data domains with semantic similarity but distinct characteristics: the query domain and the retrieval domain. Despite the absence of category labels, regular UCDR typically assumes that the label spaces of both domains are identical. However, in real-world applications [5], _the categorical composition of an unlabeled data domain is usually uncertain, which is hard to acquire without detailed analysis and dedicated expertise_. In this work, we focus on extending UCDR to more universal scenarios, which allow for the possibility of disparate category spaces across domains. The objective of this _Universal UCDR_ (\(\text{U}^{2}\texttt{CDR}\)) problem is to retrieve samples from the retrieval domain that share the same category label with a query samplefrom the query domain. Naturally, in the case of private categories exclusive to the query domain, the retrieval result should be null.

Two issues must be addressed in solving traditional UCDR: 1) effectively distinguishing data samples in each domain, and 2) achieving alignment across domains for samples of the same category. For the first issue, self-supervised learning [9; 10] (SSL) is employed independently within each domain. For the second, many nearest-neighbor searching algorithms may apply. However, for \(\mathsf{U}^{2}\mathsf{CDR}\), applying these existing methods introduces new challenges. First, the prevailing SSL methods, particularly contrastive learning [9; 11; 10], are highly influenced by the category label space [12], which means different label spaces lead to distinct semantic structures. Second, existing nearest-neighbor searching algorithms [13; 14; 7] overlook the presence of domain gaps. We found that only by first addressing the domain gap can the nearest neighbor searching become reliable and accurate.

Thus, to effectively address the above challenges in solving \(\mathsf{U}^{2}\mathsf{CDR}\), we propose a two-stage Unified, Enhanced, and Matched (UEM) semantic feature learning framework, as in Figure 1. In the first stage, we establish a cross-domain unified prototypical structure with an instance-prototype-mixed (IPM) contrastive loss, accompanied by a semantic-enhanced loss (SEL). In the second stage, before conducting cross-domain category alignment, we incorporate Semantic-Preserving Domain Alignment (SPDA) to diminish the domain gap while ensuring minimal changes for the established prototypical structure. As the domain gap diminishes, we propose Switchable Nearest Neighboring Match (SN\({}^{2}\mathsf{M}\)), to select more reliable cross-domain neighbors based on the relationship between instances and prototypes. Extensive experiments and ablation studies on popular benchmark datasets demonstrate that our method can substantially outperform state-of-the-art methods from UCDR and other related problems. In addition, we also theoretically analyze the principles behind the major challenges of \(\mathsf{U}^{2}\mathsf{CDR}\) and the design intuition of UEM. In summary, this work made the following contributions:

* Universal UCDR (\(\mathsf{U}^{2}\mathsf{CDR}\)), where the category spaces of different domains are distinct.
* We propose a two-stage Unified, Enhanced, and Matched (UEM) semantic feature learning framework to solve \(\mathsf{U}^{2}\mathsf{CDR}\). In the first stage, UEM establishes a unified prototypical structure across domains, to ensure consistent semantic learning under category space differences. In the second stage, UEM achieves more effective domain alignment and cross-domain pairing.
* We conduct extensive experiments on multiple benchmark datasets, with settings including Close-set, Partial, and Open-set UCDR. The results demonstrate that UEM can substantially outperform state-of-the-art methods of UCDR and other potential solutions in all settings.

## 2 Related Work

**Cross-Domain Retrieval** (CDR) is not very difficult to achieve if there are categorical labels [15; 16]. However, in real-world applications, such categorical labeling information is hard to acquire, thus

Figure 1: Overview of our proposed UEM semantic feature learning framework for \(\mathsf{U}^{2}\mathsf{CDR}\). In the first stage of Intra-Domain Semantic-Enhanced Learning, UEM establishes a unified prototypical structure across domains, which is driven and enhanced by an instance-prototype-mixed contrastive loss and a semantic-enhanced loss. In the second stage of Cross-Domain Semantic-Matched Learning, Semantic-Preserving Domain Alignment aligns domains while preserving the built prototypical structure, and Switchable Nearest Neighboring Match achieves more accurate cross-domain categorical pairing.

more recent works [7; 8; 17] focus on achieving unsupervised CDR (UCDR). CDS [14] proposes a contrastive learning-based cross-domain pre-training to align different domains. PCS [13] incorporates prototype contrastive learning [11] into the cross-domain pre-training. Recent studies also search ways like clustering [7], pseudo-labeling [18], classifier mixup [17], and data augmentation [8] to achieve more advanced CDR. However, all these UCDR works assume that the query and retrieval domains share the same category space. Although there is a study [19] that can achieve CDR with distinct categories, its effectiveness relies on accurate and sufficient data labels.

**Universal Cross-Domain Learning.** Cross-domain learning consists of domain adaptation (DA) and domain generalization (DG) [20]. Regular DA and DG also only consider the scenario where the label space of the target domain is the same as the source label space, which is termed Close-set DA/DG. Recently, more studies have realized that the target label space may be a subset of the source one (i.e., Partial DA/DG) [21; 22] or contain some private labels that other domains do not have (i.e., Open-set DA/DG) [23; 24]. To deal with more universal setups, UniDA [25] unifies entropy and domain similarity to quantify sample transferability across domains. CMU [26] extends transferability quantification into entropy, consistency, and confidence. More recent works search ways like clustering [27; 28] and nearest neighbor matching [29; 30] to achieve universal DA/DG. In addition, some studies appear to achieve unsupervised DG where the source domain is also unlabeled [31; 32], which is similar to the setup of UCDR. However, these studies consider the classification task and cannot effectively work in image retrieval, especially in completely unsupervised cases.

## 3 Methodology

### Problem Formulation

In the problem of \(\mathtt{U}^{2}\mathtt{CDR}\), we assume there are two domains characterized by \(N^{\mathrm{A}}\) and \(N^{\mathrm{B}}\) unlabeled instances, which are denoted as \(\mathcal{D}^{\mathrm{A}}\!=\!\{\bm{x}_{i}^{\mathrm{A}}\}_{i=1}^{N^{\mathrm{A}}}\) and \(\mathcal{D}^{\mathrm{B}}\!=\!\{\bm{x}_{i}^{\mathrm{B}}\}_{i=1}^{N^{\mathrm{B}}}\), respectively. Although these two domains are provided as unlabeled data without category labels, we assume their label spaces \(\mathcal{Y}^{\mathrm{A}}\), \(\mathcal{Y}^{\mathrm{B}}\) consist of \(C^{\mathrm{A}}\) and \(C^{\mathrm{B}}\) different categories, and there is a relationship that \(C^{\mathrm{A}}\neq C^{\mathrm{B}},\mathcal{Y}^{\mathrm{A}}\cap\mathcal{Y}^{ \mathrm{B}}\neq\mathcal{Y}^{\mathrm{A}}\cup\mathcal{Y}^{\mathrm{B}}\). Without losing generality, if we regard domain \(\mathrm{A}\) as the query domain, while domain \(\mathrm{B}\) is the retrieval domain, the objective of \(\mathtt{U}^{2}\mathtt{CDR}\) is to retrieve correct data from domain \(\mathrm{B}\) that belongs to the same categories as the query data provided by domain \(\mathrm{A}\). To achieve this objective, it is required to train a valid feature extractor \(f_{\theta}:\mathcal{X}\to\mathcal{R}\) that can map both these two domains from the input space \(\mathcal{X}\) to a feature space \(\mathcal{R}\). Then the retrieval process \(R(f_{\theta},\bm{x}_{i}^{\mathrm{A}})\) is shaped like for a particular query instance \(\bm{x}_{i}^{\mathrm{A}}\) with the label \(y_{i}^{\mathrm{A}}\) from domain \(\mathrm{A}\), the representation distance between all instances in domain \(\mathrm{B}\) and \(\bm{x}_{i}^{\mathrm{A}}\) needs to be calculated to form a set, i.e., \(\mathcal{S}=\{\mathrm{d}(f(\bm{x}_{j}^{\mathrm{B}}),f(\bm{x}_{i}^{\mathrm{A}}) )\}_{j=1}^{N^{\mathrm{B}}}\) where \(\mathrm{d}(\cdot)\) is a particular distance metric (e.g., Euclidean Distance), and we have

\[R(f_{\theta},\bm{x}_{i}^{\mathrm{A}})=\left\{\begin{array}{l}\mathrm{null}, \,\mathrm{if}\,y_{i}^{\mathrm{A}}\in\mathcal{Y}^{\mathrm{A}}\setminus \mathcal{Y}^{\mathrm{B}}\\ \mathrm{sort}_{\uparrow}(\mathcal{S})[1:k],\,\mathrm{otherwise},\end{array}\right.\] (1)

where \(\mathrm{sort}_{\uparrow}(\cdot)\) means ascending order sorting, and \([1:k]\) denotes the first \(k\) elements of a set.

**Method Overview.** To solve \(\mathtt{U}^{2}\mathtt{CDR}\), we propose a Unified, Enhanced, and Matched (UEM) semantic feature learning framework that consists of two stages - Intra-Domain Semantic-Enhanced (IDSE, Section 3.2) Learning and Cross-Domain Semantic-Matched (CDSM, Section 3.3) Learning, which is shown in Figure 1. IDSE can help the feature extractor \(f_{\theta}\) to extract categorical semantics and ensure a unified semantic structure across domains at the same time, which is achieved by instance-prototype-mixed (IPM, Section 3.2.1) contrastive learning and a novel Semantic-Enhanced Loss (SEL, Section 3.2.2). After IDSE, CDSM conducts Semantic-Preserving Domain Alignment (SPDA, Section 3.3.1) to minimize the domain gap while preserving the semantic structure learned by IDSE. With the minimization of the domain gap, more accurate nearest-neighbor searching can be achieved by our Switchable Nearest Neighboring Match (SN\({}^{2}\)M, Section 3.3.2).

### Intra-Domain Semantic-Enhanced Learning

To achieve effective cross-domain retrieval, feature extractor \(f_{\theta}\) needs to learn consistent cross-domain features to differentiate data categories. Instance Discrimination [9] is usually employed to achieve discriminative feature learning, but directly applying it in \(\mathtt{U}^{2}\mathtt{CDR}\) has four fundamental issues that hinder the possibility of accurate cross-domain categorical matching later:

1) Instance discrimination tends to extract semantics that separate domains rather than categories,

\[\mathrm{d}(f(\bm{x}_{i}^{\mathrm{A}}),f(\bm{x}_{j}^{\mathrm{A}}))<\mathrm{d}(f( \bm{x}_{i}^{\mathrm{A}}),f(\bm{x}_{j}^{\mathrm{B}})),\,y_{i}^{\mathrm{A}}=y_{j }^{\mathrm{B}}\neq y_{j}^{\mathrm{A}}.\] (2)

2) Instance discrimination cannot characterize categorical semantics in the feature space,

\[\frac{\mathrm{d}(\bm{x}_{i}^{\mathrm{A}},\bm{x}_{j_{1}}^{\mathrm{A}})}{\mathrm{ d}(\bm{x}_{i}^{\mathrm{A}},\bm{x}_{j_{2}}^{\mathrm{A}})}<\frac{\mathrm{d}(f( \bm{x}_{i}^{\mathrm{A}}),f(\bm{x}_{j_{1}}^{\mathrm{A}}))}{\mathrm{d}(f(\bm{x} _{i}^{\mathrm{A}}),f(\bm{x}_{j_{2}}^{\mathrm{A}}))},\,y_{i}^{\mathrm{A}}=y_{j _{1}}^{\mathrm{A}}\neq y_{j_{2}}^{\mathrm{A}}.\] (3)

3) The randomness introduced by stochastic data augmentations results in evident changes in learned categorical semantic structures during training, i.e.,

\[\mathrm{d}(G(\mathcal{P}_{t}^{\mathrm{A}}),G(\mathcal{P}_{t+1}^{\mathrm{A}})) \gg\min_{\mathcal{P}_{i}^{\mathrm{A}},\mathcal{P}_{j}^{\mathrm{A}}\sim\mathcal{ H}}\mathrm{d}(G(\mathcal{P}_{i}^{\mathrm{A}}),G(\mathcal{P}_{j}^{\mathrm{A}})),\] (4)

where \(G(\cdot)\) corresponds to a graph constructed by the input vectors, and \(\mathcal{P}\) denotes the set of categorical prototypes for a domain. The subscript \(t\) denotes different training iterations, while \(\mathcal{H}\) represents the hypothesis space of possible categorical prototype sets for a particular domain. \(\mathrm{d}(\cdot)\) here is a measurement for graph difference, e.g., graph edit distance [33].

4) Distinct label spaces make instance discrimination learn different categorical semantic structures:

**Theorem 3.1** (Geometry Distinctness).: _Suppose data distributions of two domains (A and B) have mutually disjoint supports, and they are uniform over these supports. Assuming the support sets of domains A and B are not identical, the optimal feature extractors \(f^{*}\) that minimize the instance discrimination loss of different domains present distinct geometric feature spaces._

#### 3.2.1 Instance-Prototype-Mixed Contrastive Learning.

To fix the above issues, we adopt a slowly momentum-updated contrastive learning algorithm - MoCo [10], to handle the third issue reflected by Eq. (4). Moreover, the MoCo-based instance discrimination is conducted separately for each domain, which encourages \(f_{\theta}\) to focus less on learning domain semantics (for the first issue, Eq. (2)). Besides, we accompany MoCo with a prototypical contrastive loss, to enhance the mapping of categorical semantics from the input space to the feature space (for addressing the second issue, Eq. (3)). With a well-crafted prototype update mechanism, this prototypical contrastive loss can also help build a unified semantic structure across domains (for the last issue, Theorem 3.1). Then let us introduce \(\mathtt{IPM}\) contrastive learning in detail. First of all, two memory banks \(\mathcal{M}^{\mathrm{A}}\) and \(\mathcal{M}^{\mathrm{B}}\) are maintained for domains A and B, which store historical features \(\bm{m}\) of data samples \(\bm{x}\):

\[\mathcal{M}^{\mathrm{A}}=\left[\bm{m}_{1}^{\mathrm{A}},...,\bm{m}_{\mathrm{N}^ {\mathrm{A}}}^{\mathrm{A}}\right],\mathcal{M}^{\mathrm{B}}=\left[\bm{m}_{1}^{ \mathrm{B}},...,\bm{m}_{\mathrm{N}^{\mathrm{B}}}^{\mathrm{B}}\right],\text{ where }\bm{m}_{i}\leftarrow\beta\bm{m}_{i}+(1-\beta)f_{\theta}(\bm{x}_{i}).\] (5)

Here \(\bm{m}_{i}\) is initialized by the feature of \(\bm{x}_{i}\) extracted by the initial \(f_{\theta}\) and updated in momentum, where \(\beta\) controls the momentum speed, and we set it as a popular value \(0.99\). With these two memory banks, MoCo builds the positive pairs as the pair of each instance and its historical feature, while the negative ones are pairs of each instance and the historical features of all other instances:

\[\mathcal{L}_{\mathrm{INCE}}=\sum_{i=1}^{B}-\log\frac{\exp\left(f_{\theta}(\bm{ x}_{i})\cdot\bm{m}_{i}/\tau\right)}{\sum_{j=1}^{B}\exp\left(f_{\theta}(\bm{x}_{i}) \cdot\bm{m}_{j}/\tau\right)},\] (6)

where \(B\) is the batch size and \(\tau\) is a temperature factor that is set as \(0.07\).

As for the design of our prototypical contrastive loss, K-Means is applied on \(\mathcal{M}^{\mathrm{A}}\) and \(\mathcal{M}^{\mathrm{B}}\) to construct prototypes as cluster centers \(\mathcal{P}=\left\{\bm{p}_{e}\right\}_{c=1}^{\widehat{C}}\). In our problem, the cluster number \(C\) is unknown, thus we apply the Elbow approach [34] to estimate it as \(\widehat{C}\). Then, for each instance \(\bm{x}_{i}\), if it belongs to the \(c_{i}\)-th cluster, the prototypical contrastive loss \(\mathcal{L}_{\mathrm{PNCE}}\) shapes like,

\[\mathcal{L}_{\mathrm{PNCE}}=\sum_{i=1}^{B}-\log\frac{\exp\left(f_{\theta}(\bm {x}_{i})\cdot\bm{p}_{c_{i}}/\tau\right)}{\sum_{c=1}^{\widehat{C}}\exp\left(f_{ \theta}(\bm{x}_{i})\cdot\bm{p}_{c}/\tau\right)}.\] (7)

Until here, the first three issues can be fixed by mixing \(\mathcal{L}_{\mathrm{INCE}}\) and \(\mathcal{L}_{\mathrm{PNCE}}\), but the last issue, Theorem 3.1, is the bottleneck of \(\mathtt{U}^{2}\mathtt{CDR}\). Next, let us introduce how we build a unified prototypical structure for \(\mathcal{L}_{\mathrm{PNCE}}\) to address the last issue. Specifically, after obtaining the prototype sets \(\mathcal{P}^{\mathrm{A}},\mathcal{P}^{\mathrm{B}}\) of domain A and B, if we take domain A as an example to illustrate the prototypical structure building process, the prototype set \(\mathcal{P}^{\mathrm{B}}\) of domain B will be translated to domain A as,

\[\mathcal{P}^{\mathrm{B}\rightarrow\mathrm{A}}=\{\bm{p}_{c}^{\mathrm{B} \rightarrow\mathrm{A}}=\overrightarrow{\bm{p}_{c}^{\mathrm{B}}}+\overrightarrow {\mathcal{M}^{\mathrm{B}}\overrightarrow{\mathcal{M}^{\mathrm{A}}}}\}_{c=1}^{ \bar{\mathcal{C}}^{\mathrm{B}}},\] (8)

where \(\overline{\mathcal{M}}\) denotes the average vector of all vectors in \(\mathcal{M}\). Next, each prototype \(\bm{p}_{c}^{\mathrm{A}}\in\mathcal{P}^{\mathrm{A}}\) searches its closest \(\bm{p}_{c}^{\mathrm{B}\rightarrow\mathrm{A}}\in\mathcal{P}^{\mathrm{B} \rightarrow\mathrm{A}}\) (we use Hungarian algorithm to search the closest cross-domain prototypes) for the opportunity of merging, which needs to satisfy the condition,

\[d(\bm{p}_{c}^{\mathrm{B}\rightarrow\mathrm{A}},\bm{p}_{c}^{\mathrm{A}})<\min \left[\min_{\bm{p}_{i},\bm{p}_{j}\in\mathcal{P}^{\mathrm{A}}}d(\bm{p}_{i},\bm {p}_{j}),\min_{\bm{p}_{i},\bm{p}_{j}\in\mathcal{P}^{\mathrm{B}}}d(\bm{p}_{i}, \bm{p}_{j})\right],\] (9)

where \(d(\cdot,\cdot)\) computes the Euclidean distance. If we use the symbol \(\oplus\) to identify prototypes that satisfy this merging condition, the final prototypical structure for domain A is \(\mathcal{P}^{\mathrm{A}^{\prime}}=\left(\mathcal{P}^{\mathrm{A}}\setminus \mathcal{P}^{\mathrm{A},\oplus}\right)\cup\left(\mathcal{P}^{\mathrm{B} \rightarrow\mathrm{A}}\setminus\mathcal{P}^{\mathrm{B}\rightarrow\mathrm{A}, \oplus}\right)\cup\left(\mathcal{P}^{\mathrm{A},\oplus}\oplus\mathcal{P}^{ \mathrm{B}\rightarrow\mathrm{A},\oplus}\right)\) where \(\left(\mathcal{P}^{\mathrm{A},\oplus}\oplus\mathcal{P}^{\mathrm{B} \rightarrow\mathrm{A},\oplus}\right)=\left\{\left(\bm{p}_{c^{\prime}}^{\mathrm{B }\rightarrow\mathrm{A},\oplus}+\bm{p}_{c}^{\mathrm{A},\oplus}\right)/2 \right\}_{c=1}^{C^{\oplus}}\). Then the computation of \(\mathcal{L}_{\mathrm{PNCE}}^{\mathrm{A^{\prime}}}\) - Eq. (7) for domain A is conducted on the newly-built \(\mathcal{P}^{\mathrm{A^{\prime}}}\), and all these operations are same for domain B.

However, as establishing the semantic cluster-like structure requires time, it is unreasonable to conduct prototype contrastive learning from the beginning of training. Therefore, we conduct instance discrimination at the beginning and progressively incorporate \(\mathcal{L}_{\mathrm{PNCE}}\). In this case, not only are the constructed cluster centers more reliable, but the Elbow approach also provides more accurate cluster number estimations. Specifically, we use a coefficient \(\alpha\) that is scheduled by a Sigmoid function to control the incorporation weight of \(\mathcal{L}_{\mathrm{PNCE}}\), i.e.,

\[\mathcal{L}_{\mathrm{IPM}}=\mathcal{L}_{\mathrm{INCE}}+\alpha\mathcal{L}_{ \mathrm{PNCE}},\,\text{where}\,\alpha=\frac{1}{1+\exp\left(0.5E-e\right)},\] (10)

\(E\) and \(e\) here are the overall training epochs and the current epoch for \(\mathtt{IDSE}\).

#### 3.2.2 Semantic-Enhanced Loss.

For the IPM contrastive learning, it is arbitrary to allocate a data instance \(\bm{x}_{i}\) to a single cluster when the preferred semantic prototypical structure cannot be learned in advance. As a result, to speed up the structure-building process, we propose a novel _Semantic-Enhanced Loss_ (\(\mathtt{SEL}\)) to align data instances with the prototypes better. Specifically, instead of assigning data instances with a single cluster, \(\mathtt{SEL}\) considers potential semantic relationships between instances with all clusters, which are measured by the Softmax probability. Moreover, as both \(\mathcal{P}^{\mathrm{A}}\) and \(\mathcal{P}^{\mathrm{B}}\) are obtained by the Euclidean distance-based K-Means, we directly minimize the Euclidean distance between samples and prototypes:

\[\mathcal{L}_{\mathrm{SEL}}=\frac{1}{B}\sum_{i=1}^{B}\sum_{c=1}^{\bar{C}}\frac{ \exp(f_{\theta}(\bm{x}_{i})\cdot\bm{p}_{c}/\tau)}{\sum\limits_{c=1}^{\bar{C}} \exp(f_{\theta}(\bm{x}_{i})\cdot\bm{p}_{c}/\tau)}d(f_{\theta}(\bm{x}_{i}),\bm{ p}_{c}),\] (11)

where \(\widetilde{C}\) denotes the number of prototypes after merging, e.g., \(\widetilde{C}^{\mathrm{A}}\) is the number of elements in \(\mathcal{P}^{\mathrm{A^{\prime}}}\). By taking all potential semantic correlations into account, \(\mathtt{SEL}\) can alleviate the impact of the noise within the K-Means clustering results and further guide the model to learn more distinguishable semantic information in terms of Euclidean distance. Certainly, such \(\mathtt{SEL}\) benefits also rely on high-quality semantic prototypical structures. As a result, we also apply the progressive coefficient \(\alpha\) to \(\mathtt{SEL}\), then the final optimization objective for \(\mathtt{IDSE}\) is

\[\mathcal{L}_{\mathrm{IDSE}}=(\mathcal{L}_{\mathrm{IPM}}^{\mathrm{A}}+\mathcal{L} _{\mathrm{IPM}}^{\mathrm{B}})+\alpha(\mathcal{L}_{\mathrm{SEL}}^{\mathrm{A}}+ \mathcal{L}_{\mathrm{SEL}}^{\mathrm{B}}).\] (12)

### Cross-Domain Semantic-Matched Learning

#### 3.3.1 Semantic-Preserving Domain Alignment.

Domain invariance is another requirement for the extracted features in UEM. However, it is difficult to effectively align feature clusters across domains when no category label nor correspondence annotation can be utilized in \(\mathbb{U}^{2}\)CDR. Instance matching [7; 32; 13] is proposed to match an instance \(\bm{x}_{i}^{\text{A}}\) to another instance \(\bm{x}_{j}^{\text{B}}\) in the other domain with the most similar features. However, due to the domain gap, instances can be easily mapped mistakenly. For example, if there is an instance in one domain that is extremely close to the other domain, it will be determined as the nearest neighbor for all instances in the other domain [13], shown in Figure 2. As a result, before conducting instance matching, the domain gap needs to be diminished. Existing works usually leverage discrepancy minimization [35] or adversarial learning [36] to achieve domain alignment. However, these methods provide inferior performance due to semantic categorical structure changes, i.e., the semantic correlations among instances within domains change a great deal during domain alignment, shown in Figure 3.

To achieve more effective domain alignment, especially with semantic preservation, we propose Semantic-Preserving Domain Alignment (SPDA). Similar to the standard domain adversarial learning, SPDA happens on two parties, one is the feature extractor \(f_{\theta}\), and the other is a domain classifier \(g_{\omega}\) parameterized on \(\omega\). The domain classifier tries to distinguish the representations of two domains, while the feature extractor tries to fool the domain classifier. Thus, the training is shaped like a bi-level optimization in terms of the domain classification task on \(\theta\) and \(\omega\), shown as follows,

\[\mathcal{L}_{\text{DAL}}=\sum_{i=1}^{2B}-y_{i}\cdot\log g_{\omega}(f_{\theta} (\bm{x}_{i}))-(1-y_{i})\cdot\log(1-g_{\omega}(f_{\theta}(\bm{x}_{i}))),\] (13)

where \(y\) here denotes the domain label, e.g., if we regard \(y=1\) for domain A, the domain label of domain B is \(y=0\). After sufficient adversarial training, the feature extractor captures nearly domain-invariant features, thus achieving domain alignment.

To prevent the semantic structure from being changed, we first make a copy for the model trained by DISE and denote it as \(f^{\prime}_{\theta}\). Then for a mini-batch of a particular domain, we feed all instances to \(f^{\prime}_{\theta}\) and calculate pair-wise cosine similarity and Euclidean distance. In this way, all these instances constrain and influence each other, which means that when the correlation of a particular instance pair changes, it will affect the correlations of other related pairs. Then, we apply a semantic-preserving regulation into domain adversarial learning to make the pair-wise correlations unchanged,

\[\mathcal{L}_{\text{SPR}}=\frac{1}{B^{2}}\sum_{i=1}^{B}\sum_{j=1}^ {B} \big{\{}\bigg{[}\frac{f_{\theta}(\bm{x}_{i})\cdot f_{\theta}(\bm{x}_{j})}{|f _{\theta}(\bm{x}_{i})||f_{\theta}(\bm{x}_{j})|}-\frac{f_{\theta^{\prime}}(\bm {x}_{i})\cdot f_{\theta^{\prime}}(\bm{x}_{j})}{|f_{\theta^{\prime}}(\bm{x}_{i })||f_{\theta^{\prime}}(\bm{x}_{j})|}\bigg{]}^{2}\] (14) \[+[d(f_{\theta}(\bm{x}_{i}),f_{\theta}(\bm{x}_{j}))-d(f_{\theta^{ \prime}}(\bm{x}_{i}),f_{\theta^{\prime}}(\bm{x}_{j}))]^{2}\}.\]

**Recall IPM Contrastive Learning.** Actually, aligning two domains together without any semantic structure change is impossible. As a result, there is a need for a dedicated design to alleviate the impact of such unavoidable changes. Our solution is to strengthen the instances' semantic correlations by enhancing the cluster's inner density and inter-separability. For the final convergence of IPM contrastive learning, each instance is optimized to get as close to its corresponding cluster prototype as possible, and as far to other cluster prototypes as possible:

**Theorem 3.2** (Convergence of IPM).: _Suppose the data distribution of a domain has mutually disjoint supports, and it is uniform over these supports. Simplex Equiangular Tight Frame (ETF) representations [37] minimize the Instance-Prototype-Mixed Loss of this domain._

#### 3.3.2 Switchable Nearest Neighboring Match.

With SPDA, the domain gap could be effectively minimized to enable more accurate cross-domain instance matching. However, existing instance matching approaches [7; 13; 32] lack the capability of measuring the matching reliability between an instance and its nearest neighbor, which allows us to conduct cross-domain matching with different weights. For example, if an instance is located at the joint boundary of multiple categories, which indicates that the current feature extractor cannot extract sufficiently distinguishable semantic features for this instance, we are supposed to lay less emphasis on this case. To fix such issues, we propose the Switchable Nearest Neighboring Match (SN\({}^{\text{2}}\)M).

The principle behind SN\({}^{\text{2}}\)M is that prototypes are more convincing and reliable. Specifically, for a particular sample \(\bm{x}_{i}^{\text{A}}\) in domain A, we first determine its inner nearest cluster prototype \(\bm{p}_{c_{i}}^{\text{A}}\) in domain A. We can also search for the nearest instance \(\bm{x}_{i}^{\text{A,B}}\) in domain B. Both these two searching processes are based on the product of a modified cosine similarity and Euclidean distance,

\[\bm{p}_{c_{i}}^{\text{A}} =\arg\min_{\bm{p}_{j}^{\text{A}}}\left[\left(1-\frac{f_{\theta}( \bm{x}_{i}^{\text{A}})\cdot\bm{p}_{j}^{\text{A}}}{|f_{\theta}(\bm{x}_{i}^{ \text{A}})||\bm{p}_{j}^{\text{A}}|}\right)\cdot d(f_{\theta}(\bm{x}_{i}^{ \text{A}}),\bm{p}_{j}^{\text{A}})\right]\] (15) \[\bm{x}_{i}^{\text{A,B}} =\arg\min_{\bm{x}_{j}^{\text{B}}}\left[\left(1-\frac{f_{\theta}( \bm{x}_{i}^{\text{A}})\cdot f_{\theta}(\bm{x}_{j}^{\text{B}})}{|f_{\theta}( \bm{x}_{i}^{\text{A}})||f_{\theta}(\bm{x}_{j}^{\text{B}})|}\right)\cdot d(f_{ \theta}(\bm{x}_{i}^{\text{A}}),f_{\theta}(\bm{x}_{j}^{\text{B}}))\right].\] (16)

After obtaining \(\bm{x}_{i}^{\text{A,B}}\), SN\({}^{\text{2}}\)M searches for its inner nearest prototype \(\bm{p}_{c_{i}}^{\text{A,B^{\prime}}}\) in \(\mathcal{P}^{\text{B^{\prime}}}\) (which has been merged with the translated prototype set \(\mathcal{P}^{\text{A}\rightarrow\text{B}}\) from domain A) and two cases allows us to measure the reliability of \(\bm{x}_{i}^{\text{A,B}}\). Before introducing these two cases, the inner nearest prototype \(\bm{p}_{c_{i}}^{\text{A}}\) of \(\bm{x}_{i}^{\text{A}}\) needs to be translated to domain B and checked whether should be merged to follow condition Eq. (9), and we denote the translated prototype as \(\widetilde{\bm{p}}_{c_{i}}^{\text{A}}\). Then the first potential case is \(\bm{p}_{c_{i}}^{\text{A,B^{\prime}}}\) is exactly identical to \(\widetilde{\bm{p}}_{c_{i}}^{\text{A}}\), which means, \(\bm{x}_{i}^{\text{A,B}}\) is convincing since it shares the same prototype correlations with \(\bm{x}_{i}^{\text{A}}\) across two domains. Then the pair of \(\bm{x}_{i}^{\text{A,B}}\) and \(\bm{x}_{i}^{\text{A}}\) should be viewed as a positive pair in the contrastive loss. Otherwise, if \(\bm{p}_{c_{i}}^{\text{A,B^{\prime}}}\) is different from \(\widetilde{\bm{p}}_{c_{i}}^{\text{A}}\), it may be located at the intersection region of multiple clusters. In this case, the pair of \(\bm{x}_{i}^{\text{A,B}}\) and \(\bm{x}_{i}^{\text{A}}\) is not supposed to be treated as a positive pair. However, it does not mean SN\({}^{\text{2}}\)M does nothing for these unreliable cases, instead, SN\({}^{\text{2}}\)M leverages a modified prototype contrastive loss to match the pair of \(\bm{x}_{i}^{\text{A}}\) and \(\widetilde{\bm{p}}_{c_{i}}^{\text{A}}\). The modification is to incorporate cross-domain instance-wise negative comparison,

\[\begin{split}&\mathcal{L}_{\text{SN}^{\text{2}}\text{M}}=\frac{1}{B} \sum_{i=1}^{B}-\log\frac{\Delta}{\sum_{c=1}^{\widetilde{c}_{i}^{\text{B}}} \exp(f_{\theta}(\bm{x}_{i}^{\text{A}})\cdot\bm{p}_{c}^{\text{B^{\prime}}}/ \tau)+\sum_{j=1}^{N^{\text{B}}}\exp(f_{\theta}(\bm{x}_{i}^{\text{A}})\cdot f_ {\theta}(\bm{x}_{j}^{\text{B}})/\tau)}\\ &\text{where}\,\Delta=\left\{\begin{array}{l}\exp(f_{\theta}( \bm{x}_{i}^{\text{A}})\cdot\widetilde{\bm{p}}_{c_{i}}^{\text{A}}/\tau),\,\text {if}\,\,\bm{p}_{c_{i}}^{\text{A,B^{\prime}}}\neq\widetilde{\bm{p}}_{c_{i}}^{ \text{A}},\\ \exp(f_{\theta}(\bm{x}_{i}^{\text{A}})\cdot\widetilde{\bm{p}}_{c_{i}}^{\text{A }}/\tau)+\exp(f_{\theta}(\bm{x}_{i}^{\text{A}})\cdot f_{\theta}(\bm{x}_{i}^{ \text{A,B}})/\tau),\,\text{otherwise}.\end{array}\right.\end{split}\] (17)

Finally, the overall optimization objective of CDSM follows

\[\mathcal{L}_{\text{CDSM}}=\mathcal{L}_{\text{DAL}}+\mathcal{L}_{\text{SPR}}^{ \text{A}}+\mathcal{L}_{\text{SPR}}^{\text{B}}+\mathcal{L}_{\text{SN}^{\text{2 }}\text{M}}^{\text{A}}+\mathcal{L}_{\text{SN}^{\text{2}}\text{M}}^{\text{B}}.\] (18)

## 4 Experiments

The datasets, experimental settings, and comparison baselines are introduced below. More implementation details, experiment results, and source codes are provided in the Supplementary Materials.

**Datasets.**_Office-31_[38] includes three domains with 31 classes: Amazon (A), DSLR (D), Webcam (W). _Office-Home_[39] contains four different domains: Art (A), Clipart (C), Product (P), Real (R). And each domain has 67 data categories. _DomainNet_[40] is the most challenging cross-domain dataset to our best knowledge, which includes six domains: Quickdraw (Qu), Clipart (Cl), Painting (Pa), Infograph (In), Sketch (Sk) and Real (Re). DomainNet is originally class-imbalanced, thus we follow [7] to select 7 data classes that contain more than 200 samples.

**Experiment Settings.** For fair comparison, we apply ResNet-50 [41] pre-trained with ImageNet in MoCov2 [10] as the feature extractor. The domain classifier consists of two fully-connected layers.

The SGD optimizer with a momentum of 0.9 is adopted with an initial learning rate of 0.0002 that is scheduled to zero by a cosine learning strategy. The batch size is 64. The training epochs of IDSE are 100 for Office-31 and Office-Home, and 200 for DomainNet. The epoch number of CDSM is 50 for all three datasets. Following [17], we adopt mean average precision on all retrieved results (mAP@All) to measure the performance. All experiments are run repeatedly 3 times with seeds 2024, 2025, and 2026, and we report the mean performance and standard deviation.

**Comparison Baselines.** Our proposed method is compared with a comprehensive set of state-of-the-art works from Cross-Domain Representation Learning (CDS [14], PCS [13]), Unsupervised Domain Generalization (DARL [31], DN2A [32]), and Unsupervised Cross-Domain Retrieval (UCDIR [7], CoDA [17], DGDIR [8]). We follow their default settings and only conduct compulsory customization.

### Effectiveness of UEM When Solving U\({}^{2}\)CDR

**Close-set Unsupervised Cross-Domain Retrieval.** For the close-set setting, the label space of the query domain is identical to the retrieval domain. All domain pairs of Office-31 and Office-Home are tested, and 5 pairs of DomainNet. The results for Office-31 and DomainNet are shown in Table 1 (Office-Home can be found in the Appendix). According to these results, we can observe that _UEM significantly outperforms other baselines in all cases_. Specifically, we can achieve mAP@All improvement of 2.6% compared to the best baseline method on Office-31, and such improvement is even larger on DomainNet with an average of 3.6%. Figure 4 also shows the retrieval results of our approach on Office-31, Office-Home, and DomainNet, and we can observe that all results are correct.

**Partial Unsupervised Cross-Domain Retrieval.** To establish the partial setting, the query domain contains only half of the label space of the retrieval domain, and the query label space is randomly selected. As shown in Table 2, we can observe that _UEM exceeds all other baseline methods significantly in mAP@All, which is much more substantial than close-set UCDR_. For example, UEM outperforms the second-best with an average of 12.4% on Office-Home. Similar improvements

\begin{table}
\begin{tabular}{l|c c c c c c|c c c c c} \hline \hline Methods & A\(\rightarrow\)D & D\(\rightarrow\)A & D\(\rightarrow\)W & W\(\rightarrow\)A & W\(\rightarrow\)D & Avg. & Q\(\rightarrow\)Cl & Cl\(\rightarrow\)Pa & Pa\(\rightarrow\)In & \(\rightarrow\)Sk & Sk\(\rightarrow\)Re & Avg. \\ \hline CDS & 66.7\({}_{\pm 1.1}\) & 62.5\({}_{\pm 0.9}\) & 70.9\({}_{\pm 1.0}\) & 90.0\({}_{\pm 0.4}\) & 64.4\({}_{\pm 1.5}\) & 88.4\({}_{\pm 2.1}\) & 73.8\({}_{\pm 0.5}\) & 19.2\({}_{\pm 1.0}\) & 35.1\({}_{\pm 1.3}\) & 24.4\({}_{\pm 0.5}\) & 25.5\({}_{\pm 0.7}\) & 32.3\({}_{\pm 1.7}\) & 27.3\({}_{\pm 0.8}\) \\ PCS & 72.7\({}_{\pm 2.2}\) & 70.7\({}_{\pm 0.7}\) & **75.3\({}_{\pm 1.4}\)** & 88.5\({}_{\pm 3.0}\) & 71.2\({}_{\pm 1.5}\) & 89.2\({}_{\pm 2.6}\) & 77.9\({}_{\pm 1.1}\) & 22.2\({}_{\pm 0.9}\) & 36.0\({}_{\pm 1.3}\) & 27.7\({}_{\pm 0.3}\) & **28.0\({}_{\pm 0.3}\)** & 33.0\({}_{\pm 0.7}\) & 29.4\({}_{\pm 0.1}\) \\ DARL & 65.5\({}_{\pm 2.5}\) & 70.2\({}_{\pm 1.9}\) & 73.4\({}_{\pm 3.0}\) & 86.6\({}_{\pm 2.6}\) & 69.3\({}_{\pm 3.8}\) & 83.7\({}_{\pm 2.5}\) & 74.7\({}_{\pm 2.2}\) & 22.1\({}_{\pm 0.3}\) & 33.7\({}_{\pm 1.1}\) & 25.9\({}_{\pm 0.8}\) & 27.2\({}_{\pm 0.6}\) & 32.5\({}_{\pm 1.0}\) & 28.3\({}_{\pm 0.4}\) \\ DN2A & 71.1\({}_{\pm 1.0}\) & **72.4\({}_{\pm 2.2}\)** & 72.5\({}_{\pm 1.4}\) & 88.5\({}_{\pm 2.1}\) & 71.2\({}_{\pm 1.1}\) & 90.0\({}_{\pm 1.5}\) & 77.2\({}_{\pm 2.2}\) & 23.3\({}_{\pm 0.5}\) & 35.0\({}_{\pm 0.6}\) & 26.0\({}_{\pm 1.1}\) & 27.7\({}_{\pm 2.3}\) & 33.0\({}_{\pm 1.6}\) & 29.0\({}_{\pm 0.7}\) \\ UCDIR & **73.7\({}_{\pm 1.5}\)** & 69.9\({}_{\pm 3.1}\) & 74.6\({}_{\pm 0.4}\) & 91.4\({}_{\pm 1.1}\) & 73.1\({}_{\pm 0.9}\) & 90.2\({}_{\pm 0.6}\) & 78.8\({}_{\pm 1.2}\) & 25.8\({}_{\pm 1.1}\) & **36.6\({}_{\pm 1.3}\)** & 28.0\({}_{\pm 0.5}\) & 27.5\({}_{\pm 1.3}\) & **34.1\({}_{\pm 0.7}\)** & 30.4\({}_{\pm 0.4}\) \\ CoDA & 71.7\({}_{\pm 2.0}\) & 71.4\({}_{\pm 4.3}\) & 74.9\({}_{\pm 2.7}\) & 91.4\({}_{\pm 2.7}\) & 73.1\({}_{\pm 0.9}\) & 90.2\({}_{\pm 1.1}\) & 78.8\({}_{\pm 1.5}\) & 26.0\({}_{\pm 0.8}\) & 34.9\({}_{\pm 1.1}\) & 29.2\({}_{\pm 0.4}\) & 27.9\({}_{\pm 1.0}\) & 33.8\({}_{\pm 1.0}\) & 30.4\({}_{\pm 0.5}\) \\ DGDIR & 73.5\({}_{\pm 2.1}\) & 71.2\({}_{\pm 1.4}\) & 75.1\({}_{\pm 3.0}\) & **91.7\({}_{\pm 1.1}\)** & **74.0\({}_{\pm 1.9}\)** & **90.5\({}_{\pm 0.4}\)** & **79.3\({}_{\pm 0.6}\)** & **62.77\({}_{\pm 0.4}\)** & 35.0\({}_{\pm 1.5}\)** & **30.0\({}_{\pm 2.2}\)** & 27.8\({}_{\pm 1.5}\) & 33.6\({}_{\pm 0.2}\) & **30.8\({}_{\pm 0.9}\)** \\ \hline Ours & **76.2\({}_{\pm 1.1}\)** & **77.0\({}_{\pm 2.1}\)** & **75.6\({}_{\pm 0.2}\)** & **92.5\({}_{\pm 0.7}\)** & **78.9\({}_{\pm 3.9}\)** & **91.0\({}_{\pm 0.2}\)** & **81.9\({}_{\pm 0.5}\)** & **31.9\({}_{\pm 0.9}\)** & **39.4\({}_{\pm 1.4}\)** & **35.9\({}_{\pm 0.7}\)** & **29.8\({}_{\pm 0.6}\)** & **35.7\({}_{\pm 1.8}\)** & **34.4\({}_{\pm 0.5}\)** \\ \hline \hline \end{tabular}
\end{table}
Table 1: Performance comparison (mAP@All) between ours and other baseline methods on Office-31 and DomainNet in Close-set Unsupervised Cross-Domain Retrieval. We blue and bold **the best performance**, and bold **the second best**, same for all tables.

Figure 4: Retrieval results of UEM and DGDIR on Office-31 (A\(\rightarrow\)D), Office-Home (A\(\rightarrow\)C), and DomainNet (Cl\(\rightarrow\)Pa) in Close-set Unsupervised Cross-Domain Retrieval. Green and red rectangles denote correct and incorrect retrieval results. Best viewed in colors.

[MISSING_PAGE_FAIL:9]

**Effectiveness of SN\({}^{2}\)M.** We also replace SN\({}^{2}\)M with the nearest neighboring search approach leveraged by UCDIR. By comparing the results of 'Ours w/o SN\({}^{2}\)M' and 'Ours', we can conclude that SN\({}^{2}\)M is more compatible with UEM and able to achieve more accurate cross-domain categorical matching.

## 5 Conclusion

In this work, we focus on two major challenges when conducting cross-domain retrieval (CDR) in real-world scenarios: one is that the category space across domains is usually distinct, and the other is that both the query and retrieval domains are unlabeled. To tackle these challenges, we propose a Unified, Enhanced, and Matched (UEM) semantic feature learning framework that can establish a unified semantic structure across domains and preserve this structure during categorical matching. Extensive experiments in cases including close-set, partial, open-set unsupervised CDR on multiple datasets demonstrate the effectiveness and universality of UEM, which are reflected in the substantial performance improvement over state-of-the-art studies from Cross-Domain Representation Learning, Unsupervised Domain Generalization, and Unsupervised CDR.

## 6 Limitations and Future Work

To solve the real-world challenges when employing cross-domain retrieval, especially considering the category distinctness across unsupervised data domains, we propose the UEM semantic feature learning framework in this work. Although extensive empirical evaluation and theoretical analysis have validated the effectiveness of UEM, some minor limitations still need more exploration. First, the current UEM framework is composed of two stages, and we empirically determine the switching point. In the future, we need to achieve a real end-to-end UEM by changing the training stage automatically. Besides, there is a lack of theoretical analysis for the second stage (CDSM). In future efforts, we should theoretically prove the semantic preservation of SPDA and the reliability of SN\({}^{2}\)M. Lastly, the general applicability of UEM also needs testing. For instance, cross-person generalization in wearable devices [42] and property analysis of material [43] or molecular [44] structures require cross-domain retrieval. Therefore, we should test UEM on other modalities like time series and graph data.

## Acknowledgments

We gratefully acknowledge the support of a grant from General Motors.

## References

* [1] Benjamin Klein and Lior Wolf. End-to-end supervised product quantization for image search and retrieval. In _Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern Recognition_, pages 5041-5050, 2019.
* [2] Muhammad Murad Khan, Roliana Ibrahim, and Imran Ghani. Cross domain recommender systems: a systematic literature review. _ACM Computing Surveys (CSUR)_, 50(3):1-34, 2017.
* [3] Min Jin Chong, Wen-Sheng Chu, Abhishek Kumar, and David Forsyth. Retrieve in style: Unsupervised facial feature transfer and retrieval. In _Proceedings of the IEEE/CVF International Conference on Computer Vision_, pages 3887-3896, 2021.
* [4] Bojana Gajic and Ramon Baldrich. Cross-domain fashion image retrieval. In _Proceedings of the IEEE conference on computer vision and pattern recognition workshops_, pages 1869-1871, 2018.
* [5] Xiaoping Zhou, Xiangyu Han, Haoran Li, Jia Wang, and Xun Liang. Cross-domain image retrieval: methods and applications. _International Journal of Multimedia Information Retrieval_, 11(3):199-218, 2022.
* [6] Junshi Huang, Rogerio S Feris, Qiang Chen, and Shuicheng Yan. Cross-domain image retrieval with a dual attribute-aware ranking network. In _Proceedings of the IEEE international conference on computer vision_, pages 1062-1070, 2015.

* [7] Conghui Hu and Gim Hee Lee. Feature representation learning for unsupervised cross-domain image retrieval. In _European Conference on Computer Vision_, pages 529-544. Springer, 2022.
* [8] Conghui Hu, Can Zhang, and Gim Hee Lee. Unsupervised feature representation learning for domain-generalized cross-domain image retrieval. In _Proceedings of the IEEE/CVF International Conference on Computer Vision_, pages 11016-11025, 2023.
* [9] Ting Chen, Simon Kornblith, Mohammad Norouzi, and Geoffrey Hinton. A simple framework for contrastive learning of visual representations. In _International conference on machine learning_, pages 1597-1607. PMLR, 2020.
* [10] Kaiming He, Haoqi Fan, Yuxin Wu, Saining Xie, and Ross Girshick. Momentum contrast for unsupervised visual representation learning. In _Proceedings of the IEEE/CVF conference on computer vision and pattern recognition_, pages 9729-9738, 2020.
* [11] Junnan Li, Pan Zhou, Caiming Xiong, and Steven Hoi. Prototypical contrastive learning of unsupervised representations. In _International Conference on Learning Representations_, 2020.
* [12] Cuie Yang, Yiu-Ming Cheung, Jinliang Ding, Kay Chen Tan, Bing Xue, and Mengjie Zhang. Contrastive learning assisted-alignment for partial domain adaptation. _IEEE Transactions on Neural Networks and Learning Systems_, 2022.
* [13] Xiangyu Yue, Zangwei Zheng, Shanghang Zhang, Yang Gao, Trevor Darrell, Kurt Keutzer, and Alberto Sangiovanni Vincentelli. Prototypical cross-domain self-supervised learning for few-shot unsupervised domain adaptation. In _Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern Recognition_, pages 13834-13844, 2021.
* [14] Donghyun Kim, Kuniaki Saito, Tae-Hyun Oh, Bryan A Plummer, Stan Sclaroff, and Kate Saenko. Cds: Cross-domain self-supervised pre-training. In _Proceedings of the IEEE/CVF International Conference on Computer Vision_, pages 9123-9132, 2021.
* [15] Junshi Huang, Rogerio S Feris, Qiang Chen, and Shuicheng Yan. Cross-domain image retrieval with a dual attribute-aware ranking network. In _Proceedings of the IEEE international conference on computer vision_, pages 1062-1070, 2015.
* [16] Xiaoping Zhou, Xiangyu Han, Haoran Li, Jia Wang, and Xun Liang. Cross-domain image retrieval: methods and applications. _International Journal of Multimedia Information Retrieval_, 11(3):199-218, 2022.
* [17] Xu Wang, Dezhong Peng, Ming Yan, and Peng Hu. Correspondence-free domain alignment for unsupervised cross-domain image retrieval. _arXiv preprint arXiv:2302.06081_, 2023.
* [18] Mingyuan Ge, Jianan Shui, Junyu Chen, and Mingyong Li. Pseudo-label based unsupervised momentum representation learning for multi-domain image retrieval. In _International Conference on Multimedia Modeling_, pages 369-380. Springer, 2024.
* [19] Kaipeng Fang, Jingkuan Song, Lianli Gao, Pengpeng Zeng, Zhi-Qi Cheng, Xiyao Li, and Heng Tao Shen. Pros: Prompting-to-simulate generalized knowledge for universal cross-domain retrieval. _Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern Recognition_, 2024.
* [20] Jindong Wang, Cuiling Lan, Chang Liu, Yidong Ouyang, Tao Qin, Wang Lu, Yiqiang Chen, Wenjun Zeng, and Philip Yu. Generalizing to unseen domains: A survey on domain generalization. _IEEE Transactions on Knowledge and Data Engineering_, 2022.
* [21] Zhangjie Cao, Lijia Ma, Mingsheng Long, and Jianmin Wang. Partial adversarial domain adaptation. In _Proceedings of the European conference on computer vision (ECCV)_, pages 135-150, 2018.
* [22] Lingjing Kong, Shaoan Xie, Weiran Yao, Yujia Zheng, Guangyi Chen, Petar Stojanov, Victor Akinwande, and Kun Zhang. Partial disentanglement for domain adaptation. In _International Conference on Machine Learning_, pages 11455-11472. PMLR, 2022.

* [23] Pau Panareda Busto and Juergen Gall. Open set domain adaptation. In _Proceedings of the IEEE international conference on computer vision_, pages 754-763, 2017.
* [24] Hong Liu, Zhangjie Cao, Mingsheng Long, Jianmin Wang, and Qiang Yang. Separate to adapt: Open set domain adaptation via progressive separation. In _Proceedings of the IEEE/CVF conference on computer vision and pattern recognition_, pages 2927-2936, 2019.
* [25] Kaichao You, Mingsheng Long, Zhangjie Cao, Jianmin Wang, and Michael I Jordan. Universal domain adaptation. In _Proceedings of the IEEE/CVF conference on computer vision and pattern recognition_, pages 2720-2729, 2019.
* [26] Bo Fu, Zhangjie Cao, Mingsheng Long, and Jianmin Wang. Learning to detect open classes for universal domain adaptation. In _Computer Vision-ECCV 2020: 16th European Conference, Glasgow, UK, August 23-28, 2020, Proceedings, Part XV 16_, pages 567-583. Springer, 2020.
* [27] Guangrui Li, Guoliang Kang, Yi Zhu, Yunchao Wei, and Yi Yang. Domain consensus clustering for universal domain adaptation. In _Proceedings of the IEEE/CVF conference on computer vision and pattern recognition_, pages 9757-9766, 2021.
* [28] Kuniaki Saito and Kate Saenko. Ovanet: One-vs-all network for universal domain adaptation. In _Proceedings of the ieee/cvf international conference on computer vision_, pages 9000-9009, 2021.
* [29] Liang Chen, Qianjin Du, Yihang Lou, Jianzhong He, Tao Bai, and Minghua Deng. Mutual nearest neighbor contrast and hybrid prototype self-training for universal domain adaptation. In _Proceedings of the AAAI Conference on Artificial Intelligence_, volume 36, pages 6248-6257, 2022.
* [30] Liang Chen, Yihang Lou, Jianzhong He, Tao Bai, and Minghua Deng. Evidential neighborhood contrastive learning for universal domain adaptation. In _Proceedings of the AAAI Conference on Artificial Intelligence_, volume 36, pages 6258-6267, 2022.
* [31] Xingxuan Zhang, Linjun Zhou, Renzhe Xu, Peng Cui, Zheyan Shen, and Haoxin Liu. Towards unsupervised domain generalization. In _Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern Recognition_, pages 4910-4920, 2022.
* [32] Yuchen Liu, Yaoming Wang, Yabo Chen, Wenrui Dai, Chenglin Li, Junni Zou, and Hongkai Xiong. Promoting semantic connectivity: Dual nearest neighbors contrastive learning for unsupervised domain generalization. In _Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern Recognition_, pages 3510-3519, 2023.
* [33] Xinbo Gao, Bing Xiao, Dacheng Tao, and Xuelong Li. A survey of graph edit distance. _Pattern Analysis and applications_, 13:113-129, 2010.
* [34] Fan Liu and Yong Deng. Determine the number of unknown targets in open world based on elbow method. _IEEE Transactions on Fuzzy Systems_, 29(5):986-995, 2020.
* [35] Mahsa Baktashmotlagh, Mehrtash Har, Mathieu Salzmann, et al. Distribution-matching embedding for visual domain adaptation. _Journal of Machine Learning Research_, 17(108):1-30, 2016.
* [36] Mingsheng Long, Zhangjie Cao, Jianmin Wang, and Michael I Jordan. Conditional adversarial domain adaptation. _Advances in neural information processing systems_, 31, 2018.
* [37] Vardan Papyan, XY Han, and David L Donoho. Prevalence of neural collapse during the terminal phase of deep learning training. _Proceedings of the National Academy of Sciences_, 117(40):24652-24663, 2020.
* [38] Kate Saenko, Brian Kulis, Mario Fritz, and Trevor Darrell. Adapting visual category models to new domains. In _Computer Vision-ECCV 2010: 11th European Conference on Computer Vision, Heraklion, Crete, Greece, September 5-11, 2010, Proceedings, Part IV 11_, pages 213-226. Springer, 2010.

* Venkateswara et al. [2017] Hemanth Venkateswara, Jose Eusebio, Shayok Chakraborty, and Sethuraman Panchanathan. Deep hashing network for unsupervised domain adaptation. In _Proceedings of the IEEE conference on computer vision and pattern recognition_, pages 5018-5027, 2017.
* Peng et al. [2019] Xingchao Peng, Qinxun Bai, Xide Xia, Zijun Huang, Kate Saenko, and Bo Wang. Moment matching for multi-source domain adaptation. In _Proceedings of the IEEE/CVF international conference on computer vision_, pages 1406-1415, 2019.
* He et al. [2016] Kaiming He, Xiangyu Zhang, Shaoqing Ren, and Jian Sun. Deep residual learning for image recognition. In _Proceedings of the IEEE conference on computer vision and pattern recognition_, pages 770-778, 2016.
* Yeh et al. [2023] Chin-Chia Michael Yeh, Huiyuan Chen, Xin Dai, Yan Zheng, Junpeng Wang, Vivian Lai, Yujie Fan, Audrey Der, Zhongfang Zhuang, Liang Wang, et al. An efficient content-based time series retrieval system. In _Proceedings of the 32nd ACM International Conference on Information and Knowledge Management_, pages 4909-4915, 2023.
* Mosavirik et al. [2021] Tahoura Mosavirik, Mohammad Hashemi, Mohammad Soleimani, Vahid Nayyeri, and Omar M Ramahi. Accuracy-improved and low-cost material characterization using power measurement and artificial neural network. _IEEE Transactions on Instrumentation and Measurement_, 70:1-9, 2021.
* Wang et al. [2022] Zichao Wang, Weili Nie, Zhuoran Qiao, Chaowei Xiao, Richard Baraniuk, and Anima Anandkumar. Retrieval-based controllable molecule generation. In _The Eleventh International Conference on Learning Representations_, 2022.
* Awasthi et al. [2022] Pranjal Awasthi, Nishanth Dikkala, and Pritish Kamath. Do more negative samples necessarily hurt in contrastive learning? In _International conference on machine learning_, pages 1101-1116. PMLR, 2022.

**Appendix**

This Appendix includes additional details for the paper _"Semantic Feature Learning for Universal Unsupervised Cross-Domain Retrieval"_, including theoretical proofs (Section A), implementation details (Section B), additional experiment results (Section C), and broader impact (Section D).

## Appendix A Theoretical Proofs

**Theorem 3.1** (Geometry Distinctness).: _Suppose data distributions of two domains (A and B) have mutually disjoint supports, and they are uniform over these supports. Assuming the support sets of domains A and B are not identical, the optimal feature extractors \(f^{*}\) that minimize the instance discrimination loss of different domains present distinct geometric feature spaces._

**Proof.** Suppose a data distribution is made of mutually disjoint supports and distributed uniformly over these supports, there is a theorem demonstrating the representation geometry learned by instance discrimination in a research work [45], i.e.,

**Theorem A.1**.: _Assuming a data distribution has mutually disjoint supports and is uniform over these supports, any Simplex ETF representation extracted by \(f\) minimizes \(\mathcal{L}_{\mathrm{NCE}}(f)\) for any convex and non-increasing loss function \(l\). Moreover, if \(l\) is strictly convex (e.g., logistic loss), then Simplex ETF representations are the only minimizes of \(\mathcal{L}_{\mathrm{NCE}}(f)\)._

The Simplex ETF representations are defined as follows,

**Definition A.2** (Simplex ETF).: _A simplex ETF is a collection of equal-length and maximally equiangular vectors. We call a \(P\times K\) matrix \(\mathbf{M}\) an ETF if it satisfies_

\[\mathbf{M}^{\mathrm{T}}\mathbf{M}=\alpha\left(\frac{K}{K-1}\mathbf{I}-\frac{1 }{K-1}\mathbf{1}_{K}\mathbf{1}_{K}^{\mathrm{T}}\right),\] (19)

_where \(\alpha\) is a non-zero scalar, \(\mathbf{I}\) is the identity matrix and \(\mathbf{1}_{K}\) is an all-ones vector._

In representation learning, ETF representations mean that samples from different categories \((\boldsymbol{x}_{i},y_{i}),(\boldsymbol{x}_{j},y_{j})\) satisfy

\[\forall y_{i}\neq y_{j},\frac{f_{\theta}(\boldsymbol{x}_{i})\cdot f_{\theta}( \boldsymbol{x}_{j})}{|f_{\theta}(\boldsymbol{x}_{i})||f_{\theta}(\boldsymbol{ x}_{j})|}=\frac{-1}{C-1}.\] (20)

With the above preparations, we apply proof by contradiction to prove that different domains hold distinct geometric feature spaces when their respective instance discrimination loss achieves minimization. Specifically, we assume domains A and B share \(C\) categories and there is only one category exclusively owned by domain B, i.e.,

\[\mathcal{Y}^{\mathrm{A}}\cap\mathcal{Y}^{\mathrm{B}}=\{y^{i}\}_{i=1}^{C}, \,\mathcal{Y}^{\mathrm{B}}\setminus\mathcal{Y}^{\mathrm{A}}=y^{C\mathrm{I}, \mathrm{B}},\,C^{\mathrm{B}}=C^{\mathrm{A}}+1.\] (21)

This assumption satisfies that the support sets of domains A and B are not identical. Then suppose that the geometric structures of domains A and B are identical when the instance discrimination loss has been minimized, according to Theorem A.1, both domains A and B present Simplex ETF representations. In this case, if we randomly select two categories \(y^{p},y^{q}\in\mathcal{Y}^{\mathrm{A}}\cap\mathcal{Y}^{\mathrm{B}}\) from the domain-shared category set, and their samples within each domain have the following relation,

\[\forall y^{p},y^{q}\in\mathcal{Y}^{\mathrm{A}}\cap\mathcal{Y}^{\mathrm{B}}, \frac{f_{\theta}(\boldsymbol{x}^{p,\mathrm{A}})\cdot f_{\theta}(\boldsymbol{x }^{q,\mathrm{A}})}{|f_{\theta}(\boldsymbol{x}^{p,\mathrm{A}})||f_{\theta}( \boldsymbol{x}^{q,\mathrm{A}})|}=\frac{-1}{C^{\mathrm{A}}-1},\frac{f_{\theta}( \boldsymbol{x}^{p,\mathrm{B}})\cdot f_{\theta}(\boldsymbol{x}^{q,\mathrm{B}})} {|f_{\theta}(\boldsymbol{x}^{p,\mathrm{B}})||f_{\theta}(\boldsymbol{x}^{q, \mathrm{B}})|}=\frac{-1}{C^{\mathrm{B}}-1}.\] (22)

According to Eq. (21), Eq. (22) implies that the same category pair across domains has different cosine similarities, which contradicts the assumption of identical geometry across domains. 

**Theorem 3.2** (Convergence of 1PM).: _Suppose the data distribution of a domain has mutually disjoint supports, and it is uniform over these supports. Simplex Equiangular Tight Frame (ETF) representations minimize the Instance-Prototype-Mixed Loss of this domain._

**Proof.** As shown in Eq. (10), the Instance-Prototype-Mixed loss is composed of instance discrimination and prototype contrastive loss. The simplex ETF representations have been proven to minimize instance discrimination in Theorem A.1. Then we only need to prove that the prototype contrastive loss satisfies the convex and non-increasing properties,

**Property A.3**.: _For a loss function \(l\) defined on a set \(\mathcal{V}=\{v_{i}\}_{i=1}^{l}\) with the size of \(t\), it holds for all subsets of index \(\mathcal{S}\subseteq\{1,...,t\}\) that_

\[l(\mathcal{V})\geq\frac{1}{|\mathcal{S}|}\sum_{j\in\mathcal{S}}l(\mathcal{V}^{ \mathcal{S}\gets j}),\,\text{where}\,\mathcal{V}_{i}^{\mathcal{S} \gets j}:=\left\{\begin{array}{l}v_{i},\,\text{if}\,\,i\notin\mathcal{S} \\ v_{j},\,\text{otherwise}.\end{array}\right.\] (23)

To prove the non-increasing property of prototype contrastive loss, we can view \(\mathcal{L}_{\text{PNCE}}\) is built on the set \(\mathcal{V}=\{v_{c}=f_{\theta}(\bm{x}_{i})\cdot\bm{p}_{c_{i}}/\tau-f_{\theta} (\bm{x}_{i})\cdot\bm{p}_{c}/\tau\}_{c=1}^{C}\), then \(\mathcal{L}_{\text{PNCE}}(\bm{x}_{i})=l_{\log}(\mathcal{V}):=\log(1+\sum_{c} \exp(-v_{c}))\). We can leverage the concavity of the log function (Jensen's inequality) and denote \(T:=1+\sum_{j\notin\mathcal{S}}\exp(-v_{j})\), and we have

\[l_{\log}(\mathcal{V})=\log(T+\sum_{c\in\mathcal{S}}\exp(-v_{c}))\geq\frac{1}{ |\mathcal{S}|}\sum_{c\in\mathcal{S}}\log(T+|\mathcal{S}|\exp(-v_{c}))=\frac{1 }{|\mathcal{S}|}\sum_{c\in\mathcal{S}}l_{\log}(\mathcal{V}^{\mathcal{S} \gets c}).\] (24)

Therefore, the prototype contrastive loss also holds the non-increasing property, which proves that simplex ETF representations minimize the Instance-Prototype-Mixed Loss. 

## Appendix B Implementation Details

### Open-set Query Label Detection

In open-set unsupervised cross-domain retrieval (UCDR) settings, the query domain has some private categories that are not included in the retrieval domain. In this case, the retrieval results of query samples for such private query categories should be null. As aforementioned, for a query sample \(\bm{x}_{i}^{\text{A}}\), the retrieval process needs to calculate the distance between all samples in the retrieval domain and \(\bm{x}_{i}^{\text{A}}\). Then the most similar retrieval samples are supposed to be those located as close to \(\bm{x}_{i}^{\text{A}}\) as possible. Intuitively, if \(\bm{x}_{i}^{\text{A}}\) belongs to the private query categories, the nearest sample in the retrieval domain should be relatively distant. Therefore, there is a need for a threshold that allows us to determine whether the closest retrieval sample of a query sample is located too far to be a similar sample. Next, let us introduce how our UEM detects and identifies whether a query sample belongs to private query categories.

In our UEM framework, the crucial design is to build a unified prototypical structure across domains, which also shapes the private label detection strategy. Specifically, after the training of CDSM, we apply K-Means to the query and retrieval domain datasets again to construct the prototype sets \(\mathcal{P}^{\text{A}}\) and \(\mathcal{P}^{\text{B}}\). Then the prototypes of the retrieval domain are translated to the query domain for potential merging. The detailed prototype translation and merging have been introduced in Section 3.2.1. After the prototype merging, both \(\mathcal{P}^{\text{A}}\) and \(\mathcal{P}^{\text{B}}\) are divided into two groups by satisfying the merging condition (Eq. (9)) or not. For the prototype pairs that satisfy the merging condition, we record the maximum inter-sample distance among their clusters as

\[D_{c^{\oplus}}=\max_{\bm{x}_{i}^{\text{A}}\in\mathcal{X}_{c^{\oplus}}^{\text{ A}},\bm{x}_{j}^{\text{B}}\in\mathcal{X}_{c^{\oplus}}^{\text{B}}}\left[\left(1- \frac{f_{\theta}(\bm{x}_{i}^{\text{A}})\cdot f_{\theta}(\bm{x}_{j}^{\text{B}}) }{|f_{\theta}(\bm{x}_{i}^{\text{A}})||f_{\theta}(\bm{x}_{j}^{\text{B}})|} \right)\cdot d(f_{\theta}(\bm{x}_{i}^{\text{A}}),f_{\theta}(\bm{x}_{j}^{\text {B}}))\right]\] (25)

\[\mathcal{X}_{c^{\oplus}}^{\text{A}}=\left\{\bm{x}_{i}^{\text{A}}\bigg{|}\arg \min_{\bm{p}^{\text{A}}}\left[d(f_{\theta}(\bm{x}_{i}^{\text{A}}),\bm{p}^{ \text{A}})\right]=\bm{p}_{c^{\oplus}}^{\text{A},\oplus}\right\},\mathcal{X}_{ c^{\oplus}}^{\text{B}}=\left\{\bm{x}_{j}^{\text{B}}\bigg{|}\arg\min_{\bm{p}^{ \text{B}}}\left[d(f_{\theta}(\bm{x}_{j}^{\text{B}}),\bm{p}^{\text{B}})\right] =\bm{p}_{c^{\oplus}}^{\text{B},\oplus}\right\}\] (26)

Then for any query sample \(\bm{x}_{i}^{\text{A}}\), there are two cases for its belonging. One is \(\bm{x}_{i}^{\text{A}}\) belongs to the clusters of prototypes unmerged, i.e., \(\mathcal{P}^{\text{A}}\setminus\mathcal{P}^{\text{A},\oplus}\). In this case, \(\bm{x}_{i}^{\text{A}}\) is supposed to come from private query labels with high confidence. The other case is that the closest prototype of \(\bm{x}_{i}^{\text{A}}\) satisfies the merging condition, i.e., \(\arg\min_{\bm{p}^{\text{A}}}\left[d(f_{\theta}(\bm{x}_{i}^{\text{A}}),\bm{p}^ {\text{A}})\right]=\bm{p}_{c^{\oplus}}^{\text{A},\oplus}\in\mathcal{P}^{ \text{A},\oplus}\), in which we should compare the recorded \(D_{c^{\oplus}}\) and the minimal distance between all samples in the retrieval domain and \(\bm{x}_{i}^{\text{A}}\), i.e.,

\[D_{i}^{\text{A}\rightarrow\text{B}}=\min_{\bm{x}_{j}^{\text{B}}\in\mathcal{P}^{ \text{B}}}\left[\left(1-\frac{f_{\theta}(\bm{x}_{i}^{\text{A}})\cdot f_{ \theta}(\bm{x}_{j}^{\text{B}})}{|f_{\theta}(\bm{x}_{i}^{\text{A}})||f_{\theta} (\bm{x}_{j}^{\text{B}})|}\right)\cdot d(f_{\theta}(\bm{x}_{i}^{\text{A}}),f_{ \theta}(\bm{x}_{j}^{\text{B}}))\right].\] (27)

[MISSING_PAGE_FAIL:16]

[MISSING_PAGE_FAIL:17]

## NeurIPS Paper Checklist

1. **Claims** Question: Do the main claims made in the abstract and introduction accurately reflect the paper's contributions and scope? Answer: [Yes] Justification: The main claims in the abstract and introduction are addressed in Sections 3 and 4 of the main paper. Guidelines: * The answer NA means that the abstract and introduction do not include the claims made in the paper. * The abstract and/or introduction should clearly state the claims made, including the contributions made in the paper and important assumptions and limitations. A No or NA answer to this question will not be perceived well by the reviewers. * The claims made should match theoretical and experimental results, and reflect how much the results can be expected to generalize to other settings. * It is fine to include aspirational goals as motivation as long as it is clear that these goals are not attained by the paper.
2. **Limitations** Question: Does the paper discuss the limitations of the work performed by the authors? Answer: [Yes] Justification: The limitations are discussed in Section 6 of the main paper. Guidelines: * The answer NA means that the paper has no limitation while the answer No means that the paper has limitations, but those are not discussed in the paper. * The authors are encouraged to create a separate "Limitations" section in their paper. * The paper should point out any strong assumptions and how robust the results are to violations of these assumptions (e.g., independence assumptions, noiseless settings, model well-specification, asymptotic approximations only holding locally). The authors should reflect on how these assumptions might be violated in practice and what the implications would be. * The authors should reflect on the scope of the claims made, e.g., if the approach was only tested on a few datasets or with a few runs. In general, empirical results often depend on implicit assumptions, which should be articulated. * The authors should reflect on the factors that influence the performance of the approach. For example, a facial recognition algorithm may perform poorly when image resolution is low or images are taken in low lighting. Or a speech-to-text system might not be used reliably to provide closed captions for online lectures because it fails to handle technical jargon. * The authors should discuss the computational efficiency of the proposed algorithms and how they scale with dataset size.

\begin{table}
\begin{tabular}{l|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c} \hline \hline \multirow{2}{*}{Methods} & \multirow{2}{*}{A\(\rightarrow\)C} & \multirow{2}{*}{A\(\rightarrow\)P} & \multirow{2}{*}{A\(\rightarrow\)R} & \multirow{2}{*}{C\(\rightarrow\)A} & \multirow{2}{*}{C\(\rightarrow\)P} & \multirow{2}{*}{C\(\rightarrow\)R} & \multirow{2}{*}{P\(\rightarrow\)A} & \multirow{2}{*}{P\(\rightarrow\)C} & \multirow{2}{*}{P\(\rightarrow\)R} & \multirow{2}{*}{R\(\rightarrow\)A} & \multirow{2}{*}{R\(\rightarrow\)C} & \multirow{2}{*}{R\(\rightarrow\)P} & \multirow{2}{*}{Arg.} \\ \cline{5-19} \cline{8-19}  & & & & \multicolumn{1}{c}{Shared-set} & & & & & & & & & & & & & & & & & & \\ \hline \multicolumn{19}{c}{Shared-set} \\ \multicolumn{19}{c}{} \\ CDS & 26.9 & 60.2 & 34.7 & 68.7 & 33.9 & 67.5 & 29.6 & 66.2 & 30.6 & 28.6 & 65.3 & 30.6 & **32.1** & 68.9 & 32.0 & 44.4 & 72.5 & 32.6 & 69.2 & 67.5 & 44.0 & 40.0 & 76.0 & 32.5 & 68.2 \\ PCS & 26.6 & 66.1 & 37.8 & 72.0 & 40.9 & 76.6 & **29.0** & 65.4 & 30.1 & 69.2 & **34.2** & 76.1 & 79.3 & **79.0** & 42.6 & 77.4 & **38.9** & 72.8 & 29.4 & 66.6 & 42.7 & 78.0 & **35.1** & 71.4 \\ DARL & 26.9 & **64.0** & 36.9 & 70.1 & 28.5 & 66.4 & 26.7 & 65.0 & 22.0 & 60.6 & 29.4 & 68.2 & 65.9 & 34.3 & 60.1 & 42.5 & 79.5 & 35.0 & 72.2 & 28.0 & 65.1 & 42.2 & 78.0 & 31.4 & 68.5 \\ DNA & **27.0** & **3.3** & **38.2** & **74.4** & 29.0 & 68.0 & 28.6 & 65.8 & 42.5 & 67.5 & 40.2 & 49.6 & 36.3 & 71.5 & 42.0 & 80.3 & 55.7 & 26.9 & 46.8 & 48.8 & 47.1 & 79.2 & 37.0 \\ UCID & 24.7 & 62.2 & 61.4 & 64.2 & 68.0 & 26.5 & 65.2 & 21.6 & 62.5 & 67.0 & 27.3 & 30.1 & 73.1 & 13.4 & 43.0 & 78.3 & 73.6 & 76.6 & 28.0 & 69.3 & 38.7 & 75.0 & 34.0 & 69.1 \\ CoDAn & 24.9 & 63.0 & 35.5 & 74.3 & 36.0 & 74.5 & 25.5 & 65.9 & 31.1 & **70.8** & 32.5 & 72.3 & 30.5 & 77.1 & 33.3 & **77.4** & 44.4 & **81.5** & 37.0 & **78.3** & **36.6** & **76.0** & 42.1 & 80.9 & 34.2 & **73.6** \\ DGDIR & 25.5 & 62.5 & 31.7 & 67.7 & **41.5** & **78.9** & 27.8 & **67.5** & **31.2** & 66.1 & 29.0 & 66.5 & 31.0 & 68.3 & 33.0 & 68.9 & **65.8** & 80.9 & 37.0 & 76.6 & 31.5 & 68.0 & **44.0** & **82.2** & 34.1 & 71.3 \\ \hline Ours & **40.6** & **80.8** & **49.0** & **87.7** & **55.4** & **92.0** & **33.7** & **72.2** & **45.0** & **85.3** & **47.7** & **87.9** & **53.5** & **90.2** & **48.7** & **87.8** & **64.4** & **90.0** & **52.2** & **90.3** & **47.7** & **86.7** & **64.5** & **89.5** & **50.2** & **86.7** \\ \hline \hline \end{tabular}
\end{table}
Table 8: Performance comparison (mAP@All All for shared-label set, detection accuracy for open-label set) between ours and others on Office-Home in Open-set Unsupervised Cross-Domain Retrieval.

* If applicable, the authors should discuss possible limitations of their approach to address problems of privacy and fairness.
* While the authors might fear that complete honesty about limitations might be used by reviewers as grounds for rejection, a worse outcome might be that reviewers discover limitations that aren't acknowledged in the paper. The authors should use their best judgment and recognize that individual actions in favor of transparency play an important role in developing norms that preserve the integrity of the community. Reviewers will be specifically instructed to not penalize honesty concerning limitations.
3. **Theory Assumptions and Proofs** Question: For each theoretical result, does the paper provide the full set of assumptions and a complete (and correct) proof? Answer: [Yes] Justification: The main theoretical insights are discussed in Section 3 and detailed proofs are given in Section A of the Appendix. Guidelines: * The answer NA means that the paper does not include theoretical results. * All the theorems, formulas, and proofs in the paper should be numbered and cross-referenced. * All assumptions should be clearly stated or referenced in the statement of any theorems. * The proofs can either appear in the main paper or the supplemental material, but if they appear in the supplemental material, the authors are encouraged to provide a short proof sketch to provide intuition. * Inversely, any informal proof provided in the core of the paper should be complemented by formal proofs provided in appendix or supplemental material. * Theorems and Lemmas that the proof relies upon should be properly referenced.
4. **Experimental Result Reproducibility** Question: Does the paper fully disclose all the information needed to reproduce the main experimental results of the paper to the extent that it affects the main claims and/or conclusions of the paper (regardless of whether the code and data are provided or not)? Answer: [Yes] Justification: All the implementation details to reproduce the results are given in Section 4 of the main paper and Section B of the Appendix. Guidelines: * The answer NA means that the paper does not include experiments. * If the paper includes experiments, a No answer to this question will not be perceived well by the reviewers: Making the paper reproducible is important, regardless of whether the code and data are provided or not. * If the contribution is a dataset and/or model, the authors should describe the steps taken to make their results reproducible or verifiable. * Depending on the contribution, reproducibility can be accomplished in various ways. For example, if the contribution is a novel architecture, describing the architecture fully might suffice, or if the contribution is a specific model and empirical evaluation, it may be necessary to either make it possible for others to replicate the model with the same dataset, or provide access to the model. In general. releasing code and data is often one good way to accomplish this, but reproducibility can also be provided via detailed instructions for how to replicate the results, access to a hosted model (e.g., in the case of a large language model), releasing of a model checkpoint, or other means that are appropriate to the research performed. * While NeurIPS does not require releasing code, the conference does require all submissions to provide some reasonable avenue for reproducibility, which may depend on the nature of the contribution. For example 1. If the contribution is primarily a new algorithm, the paper should make it clear how to reproduce that algorithm. * If the contribution is a new algorithm, the paper should make it clear how to reproduce that algorithm. * If the contribution is a new algorithm, the paper should make it clear how to reproduce that algorithm.

2. If the contribution is primarily a new model architecture, the paper should describe the architecture clearly and fully. 3. If the contribution is a new model (e.g., a large language model), then there should either be a way to access this model for reproducing the results or a way to reproduce the model (e.g., with an open-source dataset or instructions for how to construct the dataset). 4. We recognize that reproducibility may be tricky in some cases, in which case authors are welcome to describe the particular way they provide for reproducibility. In the case of closed-source models, it may be that access to the model is limited in some way (e.g., to registered users), but it should be possible for other researchers to have some path to reproducing or verifying the results.
5. **Open access to data and code** Question: Does the paper provide open access to the data and code, with sufficient instructions to faithfully reproduce the main experimental results, as described in supplemental material? Answer: [No] Justification: We are checking the relevant regulations of our institutions to release the source code. All the datasets used for this work are publicly available. Guidelines: * The answer NA means that paper does not include experiments requiring code. * Please see the NeurIPS code and data submission guidelines (https://nips.cc/public/guides/CodeSubmissionPolicy) for more details. * While we encourage the release of code and data, we understand that this might not be possible, so "No" is an acceptable answer. Papers cannot be rejected simply for not including code, unless this is central to the contribution (e.g., for a new open-source benchmark). * The instructions should contain the exact command and environment needed to run to reproduce the results. See the NeurIPS code and data submission guidelines (https://nips.cc/public/guides/CodeSubmissionPolicy) for more details. * The authors should provide instructions on data access and preparation, including how to access the raw data, preprocessed data, intermediate data, and generated data, etc. * The authors should provide scripts to reproduce all experimental results for the new proposed method and baselines. If only a subset of experiments are reproducible, they should state which ones are omitted from the script and why. * At submission time, to preserve anonymity, the authors should release anonymized versions (if applicable). * Providing as much information as possible in supplemental material (appended to the paper) is recommended, but including URLs to data and code is permitted.
6. **Experimental Setting/Details** Question: Does the paper specify all the training and test details (e.g., data splits, hyperparameters, how they were chosen, type of optimizer, etc.) necessary to understand the results? Answer: [Yes] Justification: All the experiment details are given in Section 4 and the Appendix. Guidelines: * The answer NA means that the paper does not include experiments. * The experimental setting should be presented in the core of the paper to a level of detail that is necessary to appreciate the results and make sense of them. * The full details can be provided either with the code, in appendix, or as supplemental material.
7. **Experiment Statistical Significance** Question: Does the paper report error bars suitably and correctly defined or other appropriate information about the statistical significance of the experiments?Answer: [Yes] Justification: All the experiment results are supplemented with standard deviations as the error bar resulting from 3 independent runs. Guidelines: * The answer NA means that the paper does not include experiments. * The authors should answer "Yes" if the results are accompanied by error bars, confidence intervals, or statistical significance tests, at least for the experiments that support the main claims of the paper. * The factors of variability that the error bars are capturing should be clearly stated (for example, train/test split, initialization, random drawing of some parameter, or overall run with given experimental conditions). * The method for calculating the error bars should be explained (closed form formula, call to a library function, bootstrap, etc.) * The assumptions made should be given (e.g., Normally distributed errors). * It should be clear whether the error bar is the standard deviation or the standard error of the mean. * It is OK to report 1-sigma error bars, but one should state it. The authors should preferably report a 2-sigma error bar than state that they have a 96% CI, if the hypothesis of Normality of errors is not verified. * For asymmetric distributions, the authors should be careful not to show in tables or figures symmetric error bars that would yield results that are out of range (e.g. negative error rates). * If error bars are reported in tables or plots, The authors should explain in the text how they were calculated and reference the corresponding figures or tables in the text.
8. **Experiments Compute Resources** Question: For each experiment, does the paper provide sufficient information on the computer resources (type of compute workers, memory, time of execution) needed to reproduce the experiments? Answer: [Yes] Justification: The Appendix discusses all relevant computing requirements in detail. Guidelines: * The answer NA means that the paper does not include experiments. * The paper should indicate the type of compute workers CPU or GPU, internal cluster, or cloud provider, including relevant memory and storage. * The paper should provide the amount of compute required for each of the individual experimental runs as well as estimate the total compute. * The paper should disclose whether the full research project required more compute than the experiments reported in the paper (e.g., preliminary or failed experiments that didn't make it into the paper).
9. **Code Of Ethics** Question: Does the research conducted in the paper conform, in every respect, with the NeurIPS Code of Ethics https://neurips.cc/public/EthicsGuidelines? Answer: [Yes] Justification: Our work adheres to all the ethical guidelines outlined by NeurIPS. Guidelines: * The answer NA means that the authors have not reviewed the NeurIPS Code of Ethics. * If the authors answer No, they should explain the special circumstances that require a deviation from the Code of Ethics. * The authors should make sure to preserve anonymity (e.g., if there is a special consideration due to laws or regulations in their jurisdiction).
10. **Broader Impacts**Question: Does the paper discuss both potential positive societal impacts and negative societal impacts of the work performed? Answer: [Yes] Justification: The broader impacts are discussed in Section D of the Appendix. Guidelines: * The answer NA means that there is no societal impact of the work performed. * If the authors answer NA or No, they should explain why their work has no societal impact or why the paper does not address societal impact. * Examples of negative societal impacts include potential malicious or unintended uses (e.g., disinformation, generating fake profiles, surveillance), fairness considerations (e.g., deployment of technologies that could make decisions that unfairly impact specific groups), privacy considerations, and security considerations. * The conference expects that many papers will be foundational research and not tied to particular applications, let alone deployments. However, if there is a direct path to any negative applications, the authors should point it out. For example, it is legitimate to point out that an improvement in the quality of generative models could be used to generate deepfakes for disinformation. On the other hand, it is not needed to point out that a generic algorithm for optimizing neural networks could enable people to train models that generate Deepfakes faster. * The authors should consider possible harms that could arise when the technology is being used as intended and functioning correctly, harms that could arise when the technology is being used as intended but gives incorrect results, and harms following from (intentional or unintentional) misuse of the technology. * If there are negative societal impacts, the authors could also discuss possible mitigation strategies (e.g., gated release of models, providing defenses in addition to attacks, mechanisms for monitoring misuse, mechanisms to monitor how a system learns from feedback over time, improving the efficiency and accessibility of ML).
11. **Safeguards** Question: Does the paper describe safeguards that have been put in place for responsible release of data or models that have a high risk for misuse (e.g., pretrained language models, image generators, or scraped datasets)? Answer: [NA] Justification: Our work does not pose any explicit risks as we use public datasets, and applying our proposed methods to other areas needs dedicated modifications. Guidelines: * The answer NA means that the paper poses no such risks. * Released models that have a high risk for misuse or dual-use should be released with necessary safeguards to allow for controlled use of the model, for example by requiring that users adhere to usage guidelines or restrictions to access the model or implementing safety filters. * Datasets that have been scraped from the Internet could pose safety risks. The authors should describe how they avoided releasing unsafe images. * We recognize that providing effective safeguards is challenging, and many papers do not require this, but we encourage authors to take this into account and make a best faith effort.
12. **Licenses for existing assets** Question: Are the creators or original owners of assets (e.g., code, data, models), used in the paper, properly credited and are the license and terms of use explicitly mentioned and properly respected? Answer: [Yes] Justification: All dataset details and original authorship are cited in Section 4. Guidelines:* The answer NA means that the paper does not use existing assets.
* The authors should cite the original paper that produced the code package or dataset.
* The authors should state which version of the asset is used and, if possible, include a URL.
* The name of the license (e.g., CC-BY 4.0) should be included for each asset.
* For scraped data from a particular source (e.g., website), the copyright and terms of service of that source should be provided.
* If assets are released, the license, copyright information, and terms of use in the package should be provided. For popular datasets, paperswithcode.com/datasets has curated licenses for some datasets. Their licensing guide can help determine the license of a dataset.
* For existing datasets that are re-packaged, both the original license and the license of the derived asset (if it has changed) should be provided.
* If this information is not available online, the authors are encouraged to reach out to the asset's creators.

13. **New Assets** Question: Are new assets introduced in the paper well documented and is the documentation provided alongside the assets? Answer: [NA] Justification: The paper does not release any new assets. Guidelines:

* The answer NA means that the paper does not release new assets.
* Researchers should communicate the details of the dataset/code/model as part of their submissions via structured templates. This includes details about training, license, limitations, etc.
* The paper should discuss whether and how consent was obtained from people whose asset is used.
* At submission time, remember to anonymize your assets (if applicable). You can either create an anonymized URL or include an anonymized zip file.

14. **Crowdsourcing and Research with Human Subjects** Question: For crowdsourcing experiments and research with human subjects, does the paper include the full text of instructions given to participants and screenshots, if applicable, as well as details about compensation (if any)? Answer: [NA] Justification: Our paper does not involve crowdsourcing or research with human subjects. Guidelines:

* The answer NA means that the paper does not involve crowdsourcing nor research with human subjects.
* Including this information in the supplemental material is fine, but if the main contribution of the paper involves human subjects, then as much detail as possible should be included in the main paper.
* According to the NeurIPS Code of Ethics, workers involved in data collection, curation, or other labor should be paid at least the minimum wage in the country of the data collector.

15. **Institutional Review Board (IRB) Approvals or Equivalent for Research with Human Subjects** Question: Does the paper describe potential risks incurred by study participants, whether such risks were disclosed to the subjects, and whether Institutional Review Board (IRB) approvals (or an equivalent approval/review based on the requirements of your country or institution) were obtained? Answer: [NA]Justification: Our paper does not involve crowdsourcing nor research with human subjects, hence do not require IRB approval.

Guidelines:

* The answer NA means that the paper does not involve crowdsourcing nor research with human subjects.
* Depending on the country in which research is conducted, IRB approval (or equivalent) may be required for any human subjects research. If you obtained IRB approval, you should clearly state this in the paper.
* We recognize that the procedures for this may vary significantly between institutions and locations, and we expect authors to adhere to the NeurIPS Code of Ethics and the guidelines for their institution.
* For initial submissions, do not include any information that would break anonymity (if applicable), such as the institution conducting the review.