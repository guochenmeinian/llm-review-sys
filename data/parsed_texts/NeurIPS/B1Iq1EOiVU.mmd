# DeformableTST: Transformer for Time Series Forecasting without Over-reliance on Patching

 Donghao Luo, Xue Wang

Department of Precision Instrument, Tsinghua University, Beijing 100084, China

ldh21@mails.tsinghua.edu.cn, wangxue@mail.tsinghua.edu.cn

###### Abstract

With the proposal of patching technique in time series forecasting, Transformer-based models have achieved compelling performance and gained great interest from the time series community. But at the same time, we observe a new problem that the recent Transformer-based models are overly reliant on patching to achieve ideal performance, which limits their applicability to some forecasting tasks unsuitable for patching. In this paper, we intent to handle this emerging issue. Through diving into the relationship between patching and full attention (the core mechanism in Transformer-based models), we further find out the reason behind this issue is that full attention relies overly on the guidance of patching to focus on the important time points and learn non-trivial temporal representation. Based on this finding, we propose **DeformableTST** as an effective solution to this emerging issue. Specifically, we propose deformable attention, a sparse attention mechanism that can better focus on the important time points by itself, to get rid of the need of patching. And we also adopt a hierarchical structure to alleviate the efficiency issue caused by the removal of patching. Experimentally, our DeformableTST achieves the consistent state-of-the-art performance in a broader range of time series tasks, especially achieving promising performance in forecasting tasks unsuitable for patching, therefore successfully reducing the reliance on patching and broadening the applicability of Transformer-based models. Code is available at this repository: https://github.com/luodhhh/DeformableTST.

## 1 Introduction

Time series forecasting is widely used in real-world applications, such as transportation management [39, 5], economic planning [41, 30, 31], energy planning [42, 34] and weather forecasting [45]. Because of the immense practical value, time series forecasting has received great attention and has grown tremendously in recent years [44, 19, 33, 2, 28, 32, 25].

But looking back at the development of time series forecasting, **Transformer-based models, who have sparked the boom of time series forecasting**[55, 47, 57], **are constantly being challenged**. In particular, some recent studies [52, 18, 22] have questioned that attention mechanism is not suitable for modeling the temporal dependency in time series. As the early strike back of Transformer-based models, PatchTST [35] proposes that attention mechanism can work better in temporal modeling with the help of large size patching technique. Afterwards, equipped with the growing patch size and increasing input length, the advanced Transformer-based models [53, 58, 51, 6] gain great performance improvement and successfully win back the championship in time series forecasting.

However, with large size patching becoming a must-have technique for the following Transformer-based models, a new problem occurs: **patched-based Transformers have to work with a very long input length and a very large patch size to achieve ideal performance**[35, 53, 22]. But large size patching cannot be apply to all kinds of time series forecasting tasks. For example, some forecastingtasks are with limited input lengths [29; 30; 31], which are not sufficient to be divided into patches. In such condition, the advanced Transformer-based models suffer from severe performance degradation due to the lack of patching [58; 51], limiting their applicability to a wider range of forecasting tasks.

**To broaden the applicability of the Transformer-based model, we need to design an attention mechanism that is less reliant on patching (e.g., can work well with a small patch size or can work well even without patching)**. To this end, we first analyze exactly why attention must work with patching and why patching can help attention better model the temporal dependency in time series forecasting? We visualize the effective receptive fields (ERFs) of PatchTST [35] in Figure 1. And the ERFs can indicate which parts of the time points in input series are focused by the model when extracting temporal representations. A surprising finding is shown in Figure 1 (left). If without patching, nearly all time points in input series are equally focused by the model and the model performs worse (MSE 0.385), exposing the problem of distracted attention. This finding means that attention has not learned to distinguish the importance of each time point in input series, leading to trivial representation. Note that the time points in a time series are very redundant or even noisy [35; 56; 55; 7; 53], focusing on the trivial part of them will influence the predictions. Thus, an ideal time series forecaster should mainly focus on a small number of important time points which make contribution to better performance and reflect the property of time series. In Figure 1 (right), when using patching, the model focuses on some selected time points and achieve better performance (MSE 0.367), indicating that the model has successfully focused on the important time points. And in terms of why patching can guide the model to learn a non-trivial representation, we find that the pattern of ERF is also divided by patches, which means that patching can force the model to only focus on a small number of important time points based on the patch partition. As a conclusion of above discussion on Figure 1, since **full attention is unable to focus on the important time points by itself, it highly relies on the guidance of patching to focus on the important time points and learn non-trivial representation. This is the reason why full attention must work with patching to achieve ideal performance**.

Therefore, if we can find another way to help attention focus on the important time points, we can get rid of over-reliance on patching. Since full attention is hard to focus due to the redundancy in time series data [35; 56; 55; 7; 53], replacing it with sparse attention can be a natural idea. There are some previous prior-based sparse attentions in time series community [55; 47; 57]. But due to the diverse pattern in different time series, their priors are hard to match all kinds of inputs, resulting in their inferior performance. Different from them, we introduce a data-driven sparse attention called deformable attention under the inspiration of deformable operations [8; 60; 48]. It can sample a subset of important time points from the input series based on the learnable offsets and only calculate attention with these selected important time points. These learnable offsets are learned from each input sample, therefore being more flexible to the diverse property in different time series.

Based on the above motivations, we intend to broaden the applicability of Transformer-based models. To accomplish this goal, **we propose DeformableTST, a Transformer-based model that is less reliant on patching**. Technically, the patching process in our method is optional. We remove the patching process in most cases. Only when the input length is very long, we will use a small size patching for better efficiency. Since the removal of patching will cause severe memory usage in previous plain architecture, we adopt a hierarchical architecture to alleviate this efficiency issue. And we further introduce deformable attention, a data-driven sparse attention that can better focus on the important time points by itself, to achieve excellent performance without patching. Experimentally, DeformableTST achieves the consistent state-of-the-art performance in a wider range of time series tasks, especially in tasks unsuitable for patching, thus successfully reducing the reliance on patching and broadening the applicability of Transformer-based models. **Our contribution are as follows**:

* We dive into the relationship between patching and attention. We point out a new problem that recent advanced Transformer-based models are too reliant on patching. And we further

Figure 1: The Effective Receptive Field (ERF) of PatchTST. A brighter area means that these time points are focused by the model when extracting temporal representation. The results show that PatchTST highly relies on the guidance of patching to focus on the important time points. This phenomenon is also present in multiple advanced patch-based Transformer forecasters (Appendix E).

find out the reason behind this problem is that full attention relies overly on the guidance of patching to focus on important time points and learn non-trivial temporal representation.
* To get rid of the over-reliance on patching, we propose DeformableTST and achieve the consistent state-of-the-art performance in a wider range of time series forecasting tasks. Experimental results show that our deformable attention can better model the temporal dependency in time series without reliance on patching.
* We successfully broaden the applicability of Transformer-based models in time series tasks. Our DeformableTST can flexibly adapt to multiple input lengths and achieve excellent performance in tasks unsuitable for patching, which is a great improvement than previous Transformer-based models.

## 2 Related Work

### Tranformers for Time Series Forecasting

Transformer-based models mainly use attention mechanism to model the temporal dependency in time series [55; 47; 57]. In 2020s, they achieve excellent performance in time series forecasting for the first time and bring great attention to time series forecasting tasks [26; 9; 56; 20; 21; 7]. But their validity is questioned by [52; 18] with the finding that a simple linear layer can outperform complicated attention mechanisms. It's until the proposal of patching that Transformer-based models win back the championship in time series forecasting [35]. Based on patching technique, Pathformer [6] adopts a multi-scale patches structure. Crossformer [53] and CARD [51] further propose to additionally apply attention on variate and feature dimensions rather than only on temporal dimension. Sageformer [54] combines the graph methods with patch-based Transformer forecasters. And GPT4TS [58] also transfers pre-trained large language models to time series with the help of patching. But the question of whether attention is suitable for modeling the temporal dependency in time series still remains. For example, although adopting a Transformer architecture, iTransformer [22] still suggests that linear layers are more appropriate for temporal modeling. Meanwhile, the proposal of patching also comes with a new question that advanced Transformer-based models are too reliant on patching. Therefore, further research about Transformer-based forecasters are still needed, especially on the question of how to better use attention in temporal modeling without over-reliance on patching.

### Sparse Attention

Sparse attention used to be popular in time series forecasting. Early Transformer-based models usually adopt prior-based sparse attention mechanisms. Informer [55] adopt ProbSparse attention to model the temporal dependency. Autoformer and FEDformer [47; 57] further combine the signal processing technique with the attention mechanisms and select the top-k sparse representation in time domain or frequency domain respectively. But due to the diverse pattern in different time series, these priors are hard to match all kind of inputs, resulting in their inferior performance. As a comparison, data-driven sparse attention, also called deformable attention, is more flexible to diverse inputs. Similar idea has been explored in Computer Vision (CV). Inspired by deformable convolution [8; 59], deformable DERT [60] proposes multi-scale deformable attention for object detection tasks. And [48; 49] further improve it and make it suitable for general CV tasks. In this work, we propose a deformable attention for time series forecasting to break through the bottleneck faced by previous attention mechanism in modeling temporal dependency.

## 3 DeformableTST

Given an observed multivariate or univariate time series as input, time series forecasting aims to predict the length-\(T\) future series based on the length-\(I\) input series. In real-world scenarios, the input length \(I\) varies from a wide range and is not always sufficient for patching technique, leading to the limited applicability of previous patch-based Transformer forecasters. To tackle this problem, we propose DeformableTST. And we introduce details of DeformableTST in following subsections.

### Structure Overview

As shown in Figure 2, our DeformableTST adopts the encoder-only architecture of Transformer [43], including the input embedding layer, hierarchical Transformer backbone and prediction head. And following the recent Transformer-based models, we adopt RevIN [15] to mitigate the distribution shift between the training and testing data.

Input Embedding LayerDenoted \(\mathbf{X}_{in}\in\mathbb{R}^{M\times I}\) as the \(M\) variates input time series of length \(I\), it will be divided into \(N_{0}\) non-overlapping patches and then embedded variate-independently into \(D_{0}\)-dimensional embeddings:

\[\mathbf{X}_{0}=\mathrm{Embedding}(\mathbf{X}_{in})\] (1)

\(\mathbf{X}_{0}\in\mathbb{R}^{M\times D_{0}\times N_{0}}\) is the input embedding. It is worth noting that DeformableTST is less reliant on patching and thus the patching process is optional. We only adopt patching when the input length is very long for efficiency reasons. And we also adopt a much smaller patch size than recent Transformer-based models, making it more adaptable to diverse input lengths.

Hierarchical Transformer BackboneThe backbone is stacked by \(L\) Transformer blocks and utilizes a hierarchical structure. The forward process in the \(i\)-th block is simply formulated as follows:

\[\mathbf{X}_{i}^{local} =\mathrm{LPU}(\mathbf{X}_{i-1})\] (2) \[\mathbf{X}_{i}^{global} =\mathrm{LayerNorm}\left(\mathbf{X}_{i}^{local}+\mathrm{Deformable Attention}(\mathbf{X}_{i}^{local})\right)\] (3) \[\mathbf{X}_{i} =\mathrm{LayerNorm}\left(\mathbf{X}_{i}^{global}+\mathrm{ConvFFN }(\mathbf{X}_{i}^{global})\right)\] (4)

\(\mathbf{X}_{i}\in\mathbb{R}^{M\times D_{i}\times N_{i}}\) is the output feature series of the \(i\)-th block, \(i\in\{1,...,L\}\). And \(D_{i}\) and \(N_{i}\) are the sizes of its feature and temporal dimensions. DeformableAttention is the core component to better capture the global temporal dependency, which will be introduced in Section3.2. \(\mathrm{LPU}\) and \(\mathrm{ConvFFN}\) are local enhancement modules (Figure 2 (b) and (d)). \(\mathrm{LPU}\) is the local perception unit, a depth-wise convolution with residual connection [10]. And \(\mathrm{ConvFFN}\) is a feed-forward network injected with a depth-wise convolution [50]. These two modules are adopted to improve the local temporal modeling ability. And a GELU activation [11] is adopted in \(\mathrm{ConvFFN}\) to provide nonlinearity when learning the new feature representation. Meanwhile, to construct a hierarchical structure, a downsampling convolution layer [24] with kernel size 2 and stride 2 is adopted between two blocks, which will halve the series' temporal dimension and double the feature dimension.

Figure 2: Structure overview of DeformableTST. (a) The input time series is embedded variate-independently. (b) The local perception unit (\(\mathrm{LPU}\)) is used to learn the local temporal information. (c) The proposed deformable attention is adopted to learn the global temporal information. (d) The feed-forward network injected with a depth-wise convolution (\(\mathrm{ConvFFN}\)) is used to learn the local temporal information and the new feature representation.

Prediction HeadWe first flatten the final representation from the backbone \(\mathbf{X}_{L}\in\mathbb{R}^{M\times D_{L}\times N_{L}}\) into \(\mathbb{R}^{M\times(D_{L}\times N_{L})}\). Then we obtain the prediction through a linear projection layer:

\[\widehat{\mathbf{Y}}=\mathrm{Projection}(\mathbf{X}_{L})\] (5)

Where \(\widehat{\mathbf{Y}}\in\mathbb{R}^{M\times T}\) is the prediction of length \(T\) with \(M\) variates.

### Deformable Attention

Figure 3 introduces the detailed process of our deformable attention. In each attention module, it first samples a few important time points from the input feature series \(\mathbf{X}\) based on the learnable offsets. Then the sampled important time points are fed to the key and value projections to get the sampled key and value tokens \(\tilde{\mathbf{K}}\), \(\tilde{\mathbf{V}}\). Meanwhile, the input feature series \(\tilde{\mathbf{X}}\) is also projected into queries \(\mathbf{Q}\). Finally, standard multi-head attention [43] is applied to \(\mathbf{Q}\), \(\tilde{\mathbf{K}}\), \(\tilde{\mathbf{V}}\) to obtain the attention output \(\mathbf{O}\).

Sample the Important Time PointsAs shown in Figure 3 (a), we sample the important time points based on a set of learnable coordinates called sampling points. Specifically, the sampling points are calculated by a set of uniformly sparse reference points and their learnable offsets.

Given a length-\(N\) feature series \(\mathbf{X}\in\mathbb{R}^{M\times D\times N}\), we first generate the sparse reference points \(\mathbf{T}_{ref}\in\mathbb{R}^{M\times 1\times N_{samp}}\) from a 1D uniform grid. The grid size \(N_{samp}=N/r\) is downsampled from the input series length \(N\) with a downsampling factor \(r\) to provide sparsity. The reference points indicate the 1D coordinates of some time points uniformly distributed in the feature series \(\mathbf{X}\) with interval \(r\). These coordinate values are normalized to \([-1,+1]\), where \(-1\) indicates the start of the series and \(+1\) means the end of the series. And these reference points serve as the initial coordinates for the following deforming process.

Then we obtain the offsets for each reference point by offset sub-network (Figure 3 (b)). It contains two convolution layers. The first layer is a depth-wise convolution, which can take the local neighbors into consideration when generating the offsets [48]. It takes the query tokens \(\mathbf{Q}\) as input, where \(\mathbf{Q}\) is the linear projection of the feature series \(\mathbf{X}\). After a nonlinear activation, the output from the first layer is passed into a point-wise convolution layer to generate the offsets \(\Delta\mathbf{T}\in\mathbb{R}^{M\times 1\times N_{samp}}\).

Adding up the reference points with the learnable offsets, we obtain \(N_{samp}\) sampling points, which can serve as the final coordinates to sample the important time points from the feature series \(\mathbf{X}\). In practice, we follow [48, 60] and calculate the values of these important time points by linear interpolation \(\phi(\cdot;\cdot)\) to make this sampling process differentiable. The overall process is as follows:

\[\Delta\mathbf{T} =\mathrm{Offset-Network}(\mathbf{Q})\] (6) \[\mathbf{T}_{samp} =\mathbf{T}_{ref}+\Delta\mathbf{T}\] (7) \[\tilde{\mathbf{X}} =\phi(\mathbf{X};\mathbf{T}_{samp})\] (8)

Figure 3: Deformable Attention. (a) The process of deformable attention from the tensor view and coordinate view. (b) The structure of the offset network, marked with the size of feature series.

where \(\tilde{\mathbf{X}}\in\mathbb{R}^{M\times D\times N_{samp}}\) is the sampled feature series consisting of the important time points. And the implementation of linear interpolation \(\phi(\cdot;\cdot)\) is in Appendix I.1. And we clip \(\mathbf{T}_{samp}\) by \(-1\) and \(+1\) to avoid sampling outside the feature series.

Calculate Attention OutputIn above sampling process, we have got the query tokens \(\mathbf{Q}\). After the sampling process, we can get the sampled key and value tokens \(\tilde{\mathbf{K}}\), \(\tilde{\mathbf{V}}\) after two linear projections of the sampled feature series \(\tilde{\mathbf{X}}\). Then we calculate the multi-head self-attention with \(H\) heads as:

\[\mathbf{O}^{(h)}= \operatorname{Softmax}\left(\mathbf{Q}^{(h)}\tilde{\mathbf{K}}^{ (h)\top}/\sqrt{d}+\mathbf{B}\right)\tilde{\mathbf{V}}^{(h)},h\!=\!1,\ldots,H\] (9) \[\mathbf{O}=\operatorname{OutputProjection}(\operatorname{Concat} \left(\mathbf{O}^{(1)},\ldots,\mathbf{O}^{(H)}\right))\] (10)

where \(d\!=\!D/H\) is the dimension of each head. The upper index \({}^{(h)}\) denotes the \(h\)-th attention head. After concatenating the output embedding from each attention head \(\mathbf{O}^{(h)}\) together, we obtain the output of the \(\operatorname{DeformableAttention}\) module \(\mathbf{O}\in\mathbb{R}^{M\times D\times N}\) through a linear projection. \(\mathbf{B}\) is the deformable relative position bias to provide the positional information into the attention map and its implementation is introduced in Appendix I.2.

To conclude, this subsection introduces the detailed process of \(\operatorname{DeformableAttention}\) (Eq.(3)). And for the \(i\)-th block, \(\mathbf{X}\) in this subsection corresponds to \(\mathbf{X}_{i}^{local}\) in Eq.(3) and \(\mathbf{O}\) corresponds to \(\mathbf{X}_{i}^{global}\).

## 4 Experiments

We thoroughly evaluate our DeformableTST on a wide range of time series forecasting tasks, including long-term forecasting tasks with various input lengths, as well as multivariate and univariate short-term forecasting tasks that are unsuitable for patching, to verify the performance and applicability of our DeformableTST.

BaselinesWe extensively include the latest and advanced models in time series community as strong baselines, including patch-based Transformer models: Pathformer [6], CARD [51], GPT4TS [58], PatchTST [35]; non patch-based Transformer models: iTransformer [22], FEDformer [57], Autoformer [47]; other non Transformer-based models: RLinear [18], TiDE [9], TimesNet [46], DLinear [52] and SCINet [20]. We also include the state-of-the-art models in each specific task as additional baselines for a comprehensive comparison.

Main ResultAs shown in Figure 4, **our DeformableTST achieves consistent state-of-the-art performance in a broader range of time series tasks**. In details, DeformableTST can flexibly adapt to multiple input lengths and especially achieve excellent performance in tasks unsuitable for patching, which is a great improvement than previous Transformer-based models, **proving that our DeformableTST can successfully reduce the reliance on patching and broaden the applicability of Transformer-based models**. Experiment details and result discussions of each task are provided in following subsections. In each table, the best results are in **bold** and the second best are underlined.

Figure 4: Model performance comparison (left) and performance under different input lengths (right).

### Long-term Forecasting

SetupsWe conduct long-term forecasting experiments on 8 popular real-world benchmarks, including Weather [45], Traffic [39], ECL [42], Solar-Energy [34] and 4 ETT datasets [55]. **In this paper, we refine the evaluation approach for a comprehensive comparision of the models.** Different from previous settings that use a fixed short input length (e.g., 96) [55; 47; 22]. We fix three different input lengths \(\{96,384,768\}\) and calculate the averaged results to adequately reflect model's adaptability to multiple input lengths. These input lengths covers a variety of real-world application scenarios, i.e., shorter than prediction lengths, within the prediction lengths' interval and longer than prediction lengths. Following the previous settings, we set prediction lengths as \(\{96,192,336,720\}\) and calculate the MSE and MAE of multivariate time series forecasting as metrics.

ResultsTable 1 shows the excellent performance of DeformableTST in long-term forecasting. Concretely, DeformableTST gains the best performance in most cases, surpassing extensive state-of-the-art Transformer-based models. As shown in Figure 4 (right), DeformableTST achieves the consistent state-of-the-art performance in all input lengths and gains continuous performance improvement with the increasing input length, validating its adaptability to multiple input lengths and its effectiveness in extracting useful information from longer history. For comparison, the non patch-based Transformer baselines suffer from performance degradation with increasing input length due to the distracted attention on the prolonging input. And the patch-based Transformer baselines can not work well with a short input length (e.g., 96) because leveraging patching on the short time series leads to very few tokens, limiting attention's ability in long-term modeling.

### Short-term Forecasting

Time series community are currently focusing on long-term forecasting tasks, where the input length and prediction length are adequate for patching technique. However, the short-term forecasting tasks, where the input length and prediction length are limited, are also of extensive practical value in real-world applications. The study on short-term forecasting tasks has been stagnant in recent years and the advanced patching technique proposed in long-term forecasting is hard to apply to short-term forecasting due to the limited input length. To validate the applicability of our DeformableTST in short-term forecasting, we extensively conduct experiments in following two kinds of tasks.

Setups of Multivariate Short-term ForecastingWe conduct multivariate short-term forecasting experiments on 8 popular real-world benchmarks, including Exchange [17], ILI [3], 2 ETTh [55] and 4 PEMS datasets [5]. We set prediction lengths as \(\{6,12,18\}\) and set the input length to be 2 times of the prediction length, which precisely meets the definition of limited input lengths in short-term forecasting. We calculate the MSE and MAE of multivariate time series forecasting as metrics.

Setups of Univariate Short-term ForecastingThe study on univariate short-term forecasting tasks used to be popular in the early time series community [29; 31; 37] but has been stagnant in recent years. In this paper, we bring back this classic tasks and conduct experiments on following datasets: M1 [29], M3 [30], M4 [31], Tourism [1], NN5 [41], Hospital [12] and KDD Cup [13]. Following the classic settings [29; 37], we calculate the SMAPE as metric. Specially for M4 datasets, we follow the

\begin{table}
\begin{tabular}{c|c c c c c c c c c c c c c c c} \hline \hline \multirow{2}{*}{Models} & \multicolumn{3}{c|}{**DeformableTST**} & \multicolumn{3}{c|}{**DeformableTST**} & \multicolumn{3}{c|}{**DeformableTST**} & \multicolumn{3}{c|}{**PatchTST**} & \multicolumn{3}{c|}{**TiledMemory**} & \multicolumn{3}{c|}{**FEDT**} & \multicolumn{3}{c|}{**AutoMoment**} & \multicolumn{3}{c|}{**Rianew**} & \multicolumn{3}{c}{**Tiled**} & \multicolumn{3}{c}{**TimeNet**} \\  & **(Mon.)** & [6] & [51] & [18] & [35] & [12] & [27] & [47] & [18] & [19] & [46] & \\ \hline Metric & 385 & MAE & MSE & MSE & MAE & MSE & MSE & MSE & MSE & MSE & MSE & MSE & MAE & MSE & MSE & MAE \\ \hline ETTh1 & **0.413** & **0.40** & 0.409 & 0.449 & 0.446 & 0.403 & 0.458 & 0.429 & 0.459 & 0.488 & 0.444 & 0.461 & 0.463 & 0.505 & 0.483 & 0.483 & 0.485 & 0.482 & 0.455 & 0.429 & 0.434 & 0

[MISSING_PAGE_FAIL:8]

## 5 Model Analysis

### Ablation Study

In order to validate the effectiveness of our designs, we start from a PatchTST [35] and gradually update it into our DeformableTST by adding our designs step by step. And we provide the trajectory going from a PatchTST to a DeformableTST in Figure 5. To get rid of the over-reliance on patching, we remove the patching design in PatchTST. After this step, PatchTST suffers from degradation in both performance and efficiency. To address these issues, more designs are adopted in DeformableTST.

First, the removal of patching leads to a larger number of tokens processed in the attention computation, resulting in heavier memory usage. Responding to the issue, we adopt a hierarchical structure to gradually reduce the number of tokens, therefore alleviating the efficiency problem. Secondly, full attention is hard to focus on the important time points after removing the patching design, leading to trivial temporal representation and performance degradation. To help attention better focus without patching, we propose deformable attention as a complementary. Thanks to the better focusing ability in deformable attention, we observe great performance improvement after adding this design. Meanwhile, we also adopt some local enhancement modules in our design since locality is also important in time series [20]. And this step also brings performance improvement. After equipped with all our designs, DeformableTST shows great performance and efficiency superiority than the baseline PatchTST, which proves the necessity and effectiveness of our designs.

### Compared Deformable Attention with Prior-based Sparse Attention

In Section 1, we propose that sparse attention can help attention to better foucs without patching and further argue that data-driven sparse attention is more appropriate than prior-based ones. To validate the necessity and effectiveness of using data-driven sparse attention, we compare our deformable attention with some prior-based sparse attentions in time series community, that is ProbSparse Attention in Informer [55], AutoCorrelation in Autoformer [47] and FourierAttention in FEDformer [57]. We also include the local window attention in Swin Transformer [23] and the vanilla full attention [43] adopted in most baselines [22; 53; 35] for a comprehensive comparison.

As shown in Table 4, our deformable attention surpasses other prior-based competitors in all benchmarks. This is because the priors are hard to match all kind of inputs due to the diverse pattern in different time series, resulting in the inferior performance of prior-based sparse attentions. Different from them, our deformable attention is a data-driven sparse attention that can learn from the input time series, therefore is more flexible to the diverse property in different time series.

Our deformable attention also surpasses the full attention by a large margin for it can better focus on the important time points to learn non-trivial temporal representation, while the full attention suffers from the distracted attention and trivial temporal representation due to the lack of patching. Although window attention can help attention avoid being distracted in a global range by limiting the attention computation into local windows, its performance still decreases due to the lack of long-term modeling ability, which is an important ability a time series forecaster should have.

Figure 5: Ablation study in long-term forecasting tasks. From the top to the bottom, each row means one design that we add on PatchTST to modify it into our DeformableTST. We report the averaged MSE of four prediction lengths. The memory usage is recorded under input-96-predict-96 setting with the same batch size. A lower MSE (a shorter blue bar) and a smaller memory usage (a green star closer to the vertical axis) means better performance and efficiency. More results are in Appendix F.1.

## 6 Conclusion and Future Work

In this paper, we expose an emerging issue faced by advanced Transformer-based models that they have limited applicability in time series forecasting tasks due to their over-reliance on patching. And we further find out the reason behind this problem is that full attention relies overly on the guidance of patching to focus on the important time points and learn non-trivial temporal representation. To tackle this problem, we propose DeformableTST as an effective solution, which equips with deformable attention that can better focus on the important time points by itself to get rid of the over-reliance on patching. Experimentally, DeformableTST achieves the consistent state-of-the-art performance in a broader range of time series forecasting tasks, especially achieving promising performance in tasks unsuitable for patching, therefore successfully reducing the reliance on patching and broadening the applicability of Transformer-based models. And we hope our findings can prompt people to rethink the relationship between Transformer-based models and patching technique, thereby designing more powerful Transformer-based forecasters with a wider range of applicability.

## Acknowledgment

This work was supported by the Hebei Innovation Plan (20540301D).

\begin{table}
\begin{tabular}{c|c c c c c c c c c c c c c c c} \hline \hline Dataset & EETThal & EETThal & EETThal & EETTmal & EETTmal & Weather & Solur & ECL & Traffic & & & & & & & & \\ \hline Metric & MSE & MAE & MSE & MAE & MSE & MAE & MSE & MAE & MSE & MAE & MSE & MAE & MSE & MAE & MSE & MAE & MSE & MAE \\ \hline
**Deformable Attention** & **0.425** & **0.436** & **0.346** & **0.320** & **0.373** & **0.395** & **0.283** & **0.237** & **0.251** & **0.276** & **0.242** & **0.256** & **0.183** & **0.278** & **0.445** & **0.288** \\ ProtoSparse Attention & 0.431 & 0.437 & 0.379 & 0.407 & 0.390 & 0.290 & 0.295 & 0.338 & 0.267 & 0.270 & 0.270 & 0.291 & 0.201 & 0.293 & 0.483 & 0.327 \\ AutoCorrelation & 0.499 & 0.443 & 0.375 & 0.401 & 0.393 & 0.405 & 0.292 & 0.334 & 0.263 & 0.286 & 0.275 & 0.298 & 0.215 & 0.302 & 0.361 & 0.373 \\ ForexAttention & 0.453 & 0.403 & 0.374 & 0.401 & 0.384 & 0.402 & 0.260 & 0.334 & 0.266 & 0.287 & 0.265 & 0.285 & 0.299 & 0.493 & 0.333 \\ Full Attention & 0.447 & 0.444 & 0.373 & 0.400 & 0.385 & 0.403 & 0.293 & 0.337 & 0.260 & 0.286 & 0.247 & 0.273 & 0.201 & 0.292 & 0.469 & 0.316 \\ Window Attention & 0.441 & 0.437 & 0.370 & 0.396 & 0.380 & 0.397 & 0.291 & 0.334 & 0.263 & 0.285 & 0.255 & 0.280 & 0.204 & 0.295 & 0.488 & 0.327 \\ \hline \hline \end{tabular}
\end{table}
Table 4: Comparison of our Deformable Attention with other prior-based Sparse Attentions. We replace our Deformable Attention with other prior-based Sparse Attentions for comparison. We conduct the experiment in long-term forecasting tasks with input length 96 and list the averaged MSE/MAE of four different prediction lengths. More results are in Appendix F.2.

## References

* [1] George Athanasopoulos, Rob J Hyndman, Haiyan Song, and Doris C Wu. The tourism forecasting competition. _International Journal of Forecasting_, 27(3):822-844, 2011.
* [2] Konstantinos Benidis, Syama Sundar Rangapuram, Valentin Flunkert, Yuyang Wang, Danielle Maddix, Caner Turkmen, Jan Gasthaus, Michael Bohlke-Schneider, David Salinas, Lorenzo Stella, et al. Deep learning for time series forecasting: Tutorial and literature survey. _ACM Computing Surveys_, 55(6):1-36, 2022.
* [3] CDC. Illness. https://gis.cdc.gov/grasp/fluview/fluportaldashboard.html.
* [4] Cristian Challu, Kin G Olivares, Boris N Oreshkin, Federico Garza Ramirez, Max Mergenthaler Canseco, and Artur Dubrawski. Nhits: Neural hierarchical interpolation for time series forecasting. In _Proceedings of the AAAI Conference on Artificial Intelligence_, volume 37, pages 6989-6997, 2023.
* [5] Chao Chen, Karl Petty, Alexander Skabardonis, Pravin Varaiya, and Zhanfeng Jia. Freeway performance measurement system: mining loop detector data. _Transportation research record_, 1748(1):96-102, 2001.
* [6] Peng Chen, Yingying ZHANG, Yunyao Cheng, Yang Shu, Yihang Wang, Qingsong Wen, Bin Yang, and Chenjuan Guo. Multi-scale transformers with adaptive pathways for time series forecasting. In _The Twelfth International Conference on Learning Representations_, 2024.
* [7] Razvan-Gabriel Cirstea, Chenjuan Guo, Bin Yang, Tung Kieu, Xuanyi Dong, and Shirui Pan. Triformer: Triangular, variable-specific attentions for long sequence multivariate time series forecasting-full version. _arXiv preprint arXiv:2204.13767_, 2022.
* [8] Jifeng Dai, Haozhi Qi, Yuwen Xiong, Yi Li, Guodong Zhang, Han Hu, and Yichen Wei. Deformable convolutional networks. In _Proceedings of the IEEE international conference on computer vision_, pages 764-773, 2017.
* [9] Abhimanyu Das, Weihao Kong, Andrew Leach, Rajat Sen, and Rose Yu. Long-term forecasting with tide: Time-series dense encoder. _arXiv preprint arXiv:2304.08424_, 2023.
* [10] Jianyuan Guo, Kai Han, Han Wu, Yehui Tang, Xinghao Chen, Yunhe Wang, and Chang Xu. Cmt: Convolutional neural networks meet vision transformers. In _Proceedings of the IEEE/CVF conference on computer vision and pattern recognition_, pages 12175-12185, 2022.
* [11] Dan Hendrycks and Kevin Gimpel. Gaussian error linear units (gelus). _arXiv preprint arXiv:1606.08415_, 2016.
* [12] Hyndman, R. J. expsmooth: Data Sets from Forecasting with Exponential Smoothing. https://cran.r-project.org/package=expsmooth.
* [13] KDD. Kdd cup 2018. https://www.kdd.org/kdd2018/kdd-cup.
* [14] Bum Jun Kim, Hyeyeeon Choi, Hyeonah Jang, Dong Gu Lee, Wonseok Jeong, and Sang Woo Kim. Dead pixel test using effective receptive field. _Pattern Recognition Letters_, 167:149-156, 2023.
* [15] Taesung Kim, Jinhee Kim, Yunwon Tae, Cheonbok Park, Jang-Ho Choi, and Jaegul Choo. Reversible instance normalization for accurate time-series forecasting against distribution shift. In _International Conference on Learning Representations_, 2021.
* [16] Diederik P Kingma and Jimmy Ba. Adam: A method for stochastic optimization. _arXiv preprint arXiv:1412.6980_, 2014.
* [17] Guokun Lai, Wei-Cheng Chang, Yiming Yang, and Hanxiao Liu. Modeling long-and short-term temporal patterns with deep neural networks. In _SIGIR_, 2018.
* [18] Zhe Li, Shiyi Qi, Yiduo Li, and Zenglin Xu. Revisiting long-term time series forecasting: An investigation on linear mapping. _arXiv preprint arXiv:2305.10721_, 2023.

* [19] Bryan Lim and Stefan Zohren. Time-series forecasting with deep learning: a survey. _Philosophical Transactions of the Royal Society A_, 379(2194):20200209, 2021.
* [20] Minhao Liu, Ailing Zeng, Z Xu, Q Lai, and Q Xu. Scinet: time series modeling and forecasting with sample convolution and interaction. In _36th Conference on Neural Information Processing Systems (NeurIPS)_, 2022.
* [21] Shizhan Liu, Hang Yu, Cong Liao, Jianguo Li, Weiyao Lin, Alex X Liu, and Schahram Dustdar. Pyraformer: Low-complexity pyramidal attention for long-range time series modeling and forecasting. In _International conference on learning representations_, 2021.
* [22] Yong Liu, Tengge Hu, Haoran Zhang, Haixu Wu, Shiyu Wang, Lintao Ma, and Mingsheng Long. intramformer: Inverted transformers are effective for time series forecasting. In _The Twelfth International Conference on Learning Representations_, 2024.
* [23] Ze Liu, Yutong Lin, Yue Cao, Han Hu, Yixuan Wei, Zheng Zhang, Stephen Lin, and Baining Guo. Swin transformer: Hierarchical vision transformer using shifted windows. In _Proceedings of the IEEE/CVF international conference on computer vision_, pages 10012-10022, 2021.
* [24] Zhuang Liu, Hanzi Mao, Chao-Yuan Wu, Christoph Feichtenhofer, Trevor Darrell, and Saining Xie. A convnet for the 2020s. In _Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern Recognition_, pages 11976-11986, 2022.
* [25] Donghao Luo and Xue Wang. Moderntcn: A modern pure convolution structure for general time series analysis. In _International Conference on Learning Representations_, 2024.
* [26] Donghao Luo and Xue Wang. ModernTCN: A modern pure convolution structure for general time series analysis. In _The Twelfth International Conference on Learning Representations_, 2024.
* [27] Wenjie Luo, Yujia Li, Raquel Urtasun, and Richard Zemel. Understanding the effective receptive field in deep convolutional neural networks. _Advances in neural information processing systems_, 29, 2016.
* [28] Amal Mahmoud and Ammar Mohammed. A survey on deep learning for time-series forecasting. _Machine learning and big data analytics paradigms: analysis, applications and challenges_, pages 365-392, 2021.
* [29] Spyros Makridakis, Allan Andersen, Robert Carbone, Robert Fildes, Michele Hibon, Rudolf Lewandowski, Joseph Newton, Emanuel Parzen, and Robert Winkler. The accuracy of extrapolation (time series) methods: Results of a forecasting competition. _Journal of forecasting_, 1(2):111-153, 1982.
* [30] Spyros Makridakis and Michele Hibon. The m3-competition: results, conclusions and implications. _International journal of forecasting_, 16(4):451-476, 2000.
* [31] Spyros Makridakis, Evangelos Spiliotis, and Vassilios Assimakopoulos. The m4 competition: Results, findings, conclusion and way forward. _International Journal of Forecasting_, 34(4):802-808, 2018.
* [32] Ricardo P Masini, Marcelo C Medeiros, and Eduardo F Mendes. Machine learning advances for time series forecasting. _Journal of economic surveys_, 37(1):76-111, 2023.
* [33] John A Miller, Mohammed Aldosari, Farah Saeed, Nasid Habib Barna, Subas Rana, I Budak Arpinar, and Ninghao Liu. A survey of deep learning and foundation models for time series forecasting. _arXiv preprint arXiv:2401.13912_, 2024.
* [34] National Renewable Energy Laboratory. Solar power data for integration studies. https://www.nrel.gov/grid/solar-power-data.html.
* [35] Yuqi Nie, Nam H Nguyen, Phanwadee Sinthong, and Jayant Kalagnanam. A time series is worth 64 words: Long-term forecasting with transformers. _arXiv preprint arXiv:2211.14730_, 2023.

* [36] Oleh Onyshchak. Stock market dataset. https://www.kaggle.com/dsv/1054465, 2020.
* [37] Boris N Oreshkin, Dmitri Carpov, Nicolas Chapados, and Yoshua Bengio. N-beats: Neural basis expansion analysis for interpretable time series forecasting. _arXiv preprint arXiv:1905.10437_, 2019.
* [38] Adam Paszke, Sam Gross, Francisco Massa, Adam Lerer, James Bradbury, Gregory Chanan, Trevor Killeen, Zeming Lin, Natalia Gimelshein, Luca Antiga, et al. Pytorch: An imperative style, high-performance deep learning library. _Advances in neural information processing systems_, 32, 2019.
* [39] PeMS. Traffic. http://pems.dot.ca.gov/.
* [40] Alec Radford, Jeff Wu, Rewon Child, David Luan, Dario Amodei, and Ilya Sutskever. Language models are unsupervised multitask learners. 2019.
* [41] Souhaib Ben Taieb, Gianluca Bontempi, Amir F Atiya, and Antti Sorjamaa. A review and comparison of strategies for multi-step ahead time series forecasting based on the nn5 forecasting competition. _Expert systems with applications_, 39(8):7067-7083, 2012.
* [42] UCI. Electricity. https://archive.ics.uci.edu/ml/datasets/ElectricityLoadDiagrams20112014.
* [43] Ashish Vaswani, Noam Shazeer, Niki Parmar, Jakob Uszkoreit, Llion Jones, Aidan N Gomez, Lukasz Kaiser, and Illia Polosukhin. Attention is all you need. _Advances in neural information processing systems_, 30, 2017.
* [44] Qingsong Wen, Tian Zhou, Chaoli Zhang, Weiqi Chen, Ziqing Ma, Junchi Yan, and Liang Sun. Transformers in time series: A survey. _arXiv preprint arXiv:2202.07125_, 2022.
* [45] Wetterstation. Weather. https://www.bgc-jena.mpg.de/wetter/.
* [46] Haixu Wu, Tengge Hu, Yong Liu, Hang Zhou, Jianmin Wang, and Mingsheng Long. Timesnet: Temporal 2d-variation modeling for general time series analysis. _arXiv preprint arXiv:2210.02186_, 2023.
* [47] Haixu Wu, Jiehui Xu, Jianmin Wang, and Mingsheng Long. Autoformer: Decomposition transformers with auto-correlation for long-term series forecasting. _Advances in Neural Information Processing Systems_, 34:22419-22430, 2021.
* [48] Zhuofan Xia, Xuran Pan, Shiji Song, Li Erran Li, and Gao Huang. Vision transformer with deformable attention. In _Proceedings of the IEEE/CVF conference on computer vision and pattern recognition_, pages 4794-4803, 2022.
* [49] Zhuofan Xia, Xuran Pan, Shiji Song, Li Erran Li, and Gao Huang. Dat++: Spatially dynamic vision transformer with deformable attention. _arXiv preprint arXiv:2309.01430_, 2023.
* [50] Enze Xie, Wenhai Wang, Zhiding Yu, Anima Anandkumar, Jose M. Alvarez, and Ping Luo. Segformer: Simple and efficient design for semantic segmentation with transformers, 2021.
* [51] Wang Xue, Tian Zhou, QingSong Wen, Jinyang Gao, Bolin Ding, and Rong Jin. Make transformer great again for time series forecasting: Channel aligned robust dual transformer. _arXiv preprint arXiv:2305.12095_, 2023.
* [52] Ailing Zeng, Muxi Chen, Lei Zhang, and Qiang Xu. Are transformers effective for time series forecasting? _arXiv preprint arXiv:2205.13504_, 2022.
* [53] Yunhao Zhang and Junchi Yan. Crossformer: Transformer utilizing cross-dimension dependency for multivariate time series forecasting. In _International Conference on Learning Representations_, 2023.
* [54] Zhenwei Zhang, Linghang Meng, and Yuantao Gu. Sageformer: Series-aware framework for long-term multivariate time-series forecasting. _IEEE Internet of Things Journal_, 11:18445-18448, 2023.

* [55] Haoyi Zhou, Shanghang Zhang, Jieqi Peng, Shuai Zhang, Jianxin Li, Hui Xiong, and Wancai Zhang. Informer: Beyond efficient transformer for long sequence time-series forecasting. In _Proceedings of the AAAI conference on artificial intelligence_, volume 35, pages 11106-11115, 2021.
* [56] Tian Zhou, Ziqing Ma, Qingsong Wen, Liang Sun, Tao Yao, Rong Jin, et al. Film: Frequency improved legendre memory model for long-term time series forecasting. _arXiv preprint arXiv:2205.08897_, 2022.
* [57] Tian Zhou, Ziqing Ma, Qingsong Wen, Xue Wang, Liang Sun, and Rong Jin. Fedformer: Frequency enhanced decomposed transformer for long-term series forecasting. In _International Conference on Machine Learning_, pages 27268-27286. PMLR, 2022.
* [58] Tian Zhou, Peisong Niu, Xue Wang, Liang Sun, and Rong Jin. One fits all: Power general time series analysis by pretrained LM. In _Thirty-seventh Conference on Neural Information Processing Systems_, 2023.
* [59] Xizhou Zhu, Han Hu, Stephen Lin, and Jifeng Dai. Deformable convnets v2: More deformable, better results. In _Proceedings of the IEEE/CVF conference on computer vision and pattern recognition_, pages 9308-9316, 2019.
* [60] Xizhou Zhu, Weijie Su, Lewei Lu, Bin Li, Xiaogang Wang, and Jifeng Dai. Deformable detr: Deformable transformers for end-to-end object detection. _arXiv preprint arXiv:2010.04159_, 2020.

[MISSING_PAGE_EMPTY:15]

The variate number, dataset size and sampling frequency of each dataset are summarized in Table 5. We follow standard protocol [55] and split all datasets into training, validation and test set in chronological order by the ratio of 6:2:2 for the ETT and PEMS dataset and 7:1:2 for the other datasets. And training, validation and test sets are zero-mean normalized with the mean and standard deviation of training set. Each of above datasets only contains one continuous long time series, and we obtain samples by sliding window.

More introduction of the datasets are as follow:

1. **Weather1** contains 21 meteorological indicators of Germany in 2020. Footnote 1: https://www.bgc-jena.mpg.de/wetter/
2. **Traffic2** contains the road occupancy rates measured by 862 different sensors on San Francisco Bay area freeways in 2 years. Footnote 2: https://pems.dot.ca.gov/
3. **ECL**(Electricity)3 contains hourly electricity consumption of 321 clients from 2012 to 2014. Footnote 3: https://archive.ics.uci.edu/ml/datasets/ElectricityLoadDiagrams20112014
4. **ETT**(Electricity Transformer Temperature)4 contains the data collected from two different electricity transformers with 2 different resolutions (15 minutes and 1 hour) by 7 sensors. Footnote 4: https://github.com/laiguokun/multivariate-time-series-data
5. **Solar**(Solar-Energy)5 contains 137 time series representing the solar power production in Alabama state in 2006. Footnote 5: https://gis.cdc.gov/grasp/fluview/fluportaldashboard.html
6. **PEMS6** is collected from California freeway and contains 4 subsets. Footnote 6: https://doi.org/10.1016/S0169-2070(00)00057-1
7. **Exchange7** the daily exchange rates of eight different countries ranging from 1990 to 2016. Footnote 7: https://doi.org/10.1016/j.ijforecast.2019.04.014
8. **ILI**(Influenza-Like Illness)8 contains 7 indicators of influenza-like illness (ILI) patients in the United States between 2002 and 2021. Footnote 8: https://doi.org/10.1016/j.ijforecast.2019.04.014

Footnote 8: https://www.bgc-jena.mpg.de/wetter/

Footnote 9: https://pems.dot.ca.gov/

Footnote 10: https://archive.ics.uci.edu/ml/datasets/ElectricityLoadDiagrams20112014

Footnote 11: https://github.com/zhouhaovi/ETDataset

Footnote 12: https://www.nrel.gov/grid/solar-power-data.html

### Univariate Short-term Forecasting Datasets

We conduct univariate short-term forecasting experiments on 7 popular datasets, including M1, M3, M4, Tourism, NN5, Hospital and KDD Cup. We emphasize the difference between multivariate and univariate tasks as follows. In multivariate tasks, all input samples are obtained by sliding window from the same multivariate long series. Therefore, there is a high degree of similarity between the input samples in multivariate tasks. In contrast, the input samples in univariate tasks are collected from many different univariate time series sources. As a result, the input samples in univariate tasks may differ from each other and have quite different temporal property, making the univariate short-term forecasting tasks much more difficult.

Table 6 summarizes details of statistics of univariate short-term forecasting datasets. And more introduction of the datasets are as follow:

1. **M19** contains 3 subsets with different frequency: Yearly, Quarterly and Monthly. The series are belonging to 7 different domains: macro 1, macro 2, micro 1, micro 2, micro 3, industry and demographic. Footnote 9: https://doi.org/10.2307/2345077
2. **M310** contains 4 subsets with different frequency: Yearly, Quarterly, Monthly and Others. The series are belonging to 6 different domains: demographic, micro, macro, industry, finance and other. Footnote 10: https://doi.org/10.1016/S0169-2070(00)00057-1
3. **M411** contains 6 subsets with different frequency: Yearly, Quarterly, Monthly, Weekly, Daily and Hourly. The series are belonging to a wide range of economic, industrial, financial and demographic areas. Footnote 11: https://doi.org/10.1016/j.ijforecast.2019.04.0144. **Tourism12** contains 3 subsets with different frequency (Yearly, Quarterly and Monthly) used in the Kaggle Tourism forecasting competition. Considering the dataset size, we only use Tourism Quarterly and Tourism Monthly.
5. **NN5**13 contains weekly time series from the banking domain. Footnote 12: https://cran.r-project.org/web/packages/Tcomp
6. **Hospital Dataset14** contains 767 monthly time series that represent the patient counts related to medical products from January 2000 to December 2006. Footnote 13: http://www.neural-forecasting-competition.com/NN5/
7. **KDD Cup15** contains 270 hourly time series representing the air quality levels by multiple measurements such as PM2.5, PM10, NO2, CO, O3 and SO2.

Footnote 14: https://cran.r-project.org/package-expsmooth

Footnote 15: https://www.kdd.org/kdd2018/kdd-cup

## Appendix B Experiment details

### Long-term Forecasting

Implementation DetailsOur method is trained with the L2 loss, using the ADAM [16] optimizer with an initial learning rate in \(\{10^{-3},5\times 10^{-4},10^{-4}\}\). The default training process is 50 epochs with proper early stopping. The mean square error (MSE) and mean absolute error (MAE) are used as metrics. All the experiments are repeated 5 times with different seeds and the means of the metrics are reported as the final results. All the deep learning networks are implemented in PyTorch[38] and conducted on NVIDIA A100 40GB GPU.

Model ParameterBy default, DeformableTST contains 4 Transformer blocks. And we adopt downsampling layers between two blocks, which will halve the series' length and double the model dimension. The dimension \(D\) of the first block is set as 16. The expansion \(\alpha\) is set as 4. The number of important time points \(N_{samp}\) is set as 12. We optionally adopt non-overlap patching depended on the input lengths. When input length is 96, we do not adopt patching. When input length is 384, the patch size is 4. When input length is 768, the patch size is 8. For baseline models, if the original papers conduct long-term forecasting experiments on the dataset we use, we follow the official codes with the recommended model parameters in the original papers, including the number of blocks, model dimension, etc. Otherwise, their model parameters are searched from following searching space: number of blocks \(L\) from \(\{2,4,6\}\), model dimension \(D\) from \(\{64,128,256\}\) and FFN expansion \(\alpha\) from \(\{1,2,4,8\}\).

MetricWe adopt the mean square error (MSE) and mean absolute error (MAE) of multivariate time series forecasting as metrics.

\[\text{MSE}=\frac{1}{T}\sum_{i=0}^{T}(\widehat{\mathbf{Y}}_{i}-\mathbf{Y}_{i} )^{2}\]

\[\text{MAE}=\frac{1}{T}\sum_{i=0}^{T}\left|\widehat{\mathbf{Y}}_{i}-\mathbf{Y} _{i}\right|\]

where \(\widehat{\mathbf{Y}}\), \(\mathbf{Y}\in\mathbb{R}^{T\times M}\) are the \(M\) variates prediction results of length \(T\) and corresponding ground truth. \(\widehat{\mathbf{Y}}_{i}\) means the \(i\)-th time point in the prediction result.

### Multi-variate Short-term Forecasting

Implementation DetailsOur method is trained with the L2 loss, using the ADAM [16] optimizer with an initial learning rate in \(\{10^{-3},5\times 10^{-4},10^{-4}\}\). The default training process is 50 epochs with proper early stopping. The mean square error (MSE) and mean absolute error (MAE) are used as metrics. All the experiments are repeated 5 times with different seeds and the means of the metrics are reported as the final results. All the deep learning networks are implemented in PyTorch[38] and conducted on NVIDIA A100 40GB GPU.

Model ParameterBy default, DeformableTST contains 6 Transformer blocks with the model dimension \(D=256\) and FFN expansion \(\alpha=4\). The number of important time points \(N_{samp}\) is in the range of 1 to 12 in short-term forecasting tasks, which is depended on the different input lengths. Due to the limited input lengths, we do not adopt patching and downsampling layers in short-term forecasting tasks. For baseline models, we follow the official codes with the recommended model parameters and some of their model parameters are re-searched from following searching space: number of blocks \(L\) from \(\{2,4,6\}\), model dimension \(D\) from \(\{64,128,256\}\) and FFN expansion \(\alpha\) from \(\{1,2,4,8\}\).

MetricWe adopt the mean square error (MSE) and mean absolute error (MAE) of multivariate time series forecasting as metrics.

\[\text{MSE}=\frac{1}{T}\sum_{i=0}^{T}(\widehat{\mathbf{Y}}_{i}-\mathbf{Y}_{i}) ^{2}\]

\[\text{MAE}=\frac{1}{T}\sum_{i=0}^{T}\left|\widehat{\mathbf{Y}}_{i}-\mathbf{Y}_ {i}\right|\]

where \(\widehat{\mathbf{Y}},\mathbf{Y}\in\mathbb{R}^{T\times M}\) are the \(M\) variates prediction results of length \(T\) and corresponding ground truth. \(\widehat{\mathbf{Y}}_{i}\) means the \(i\)-th time point in the prediction result.

### Univariate Short-term Forecasting

Implementation DetailsOur method is trained with the SMAPE loss, using the ADAM [16] optimizer with an initial learning rate of \(5\times 10^{-4}\). The default training process is 50 epochs with proper early stopping. Following [46], we fix the input length to be 2 times of prediction length for all models. All the experiments are repeated 5 times with different seeds and the means of the metrics are reported as the final results.

Model ParameterBy default, DeformableTST contains 4 Transformer blocks with the model dimension \(D=256\) and FFN expansion \(\alpha=4\). Due to the limited input lengths, we do not adopt patching and downsampling layers in short-term forecasting tasks.

MetricFor the M4 datasets, following [31; 37], we adopt the symmetric mean absolute percentage error (SMAPE), mean absolute scaled error (MASE) and overall weighted average (OWA) as the metrics, which can be calculated as follows:

\[\text{SMAPE}=\frac{200}{T}\sum_{i=1}^{T}\frac{|\mathbf{Y}_{i}- \widehat{\mathbf{Y}}_{i}|}{|\mathbf{Y}_{i}|+|\widehat{\mathbf{Y}}_{i}|}, \text{MAPE}=\frac{100}{T}\sum_{i=1}^{T}\frac{|\mathbf{Y}_{i}- \widehat{\mathbf{Y}}_{i}|}{|\mathbf{Y}_{i}|},\]

\[\text{MASE}=\frac{1}{T}\sum_{i=1}^{T}\frac{|\mathbf{Y}_{i}-\widehat{\mathbf{Y }}_{i}|}{\frac{1}{T-p}\sum_{j=p+1}^{T}|\mathbf{Y}_{j}-\mathbf{Y}_{j-p}|}, \text{OWA}=\frac{1}{2}\left[\frac{\text{SMAPE}}{\text{SMAPE}_{ \text{Naive2}}}+\frac{\text{MASE}}{\text{MASE}_{\text{Naive2}}}\right],\]

where \(p\) is the periodicity of the data. \(\widehat{\mathbf{Y}},\mathbf{Y}\in\mathbb{R}^{T\times M}\) are the \(M\) variates prediction results of length \(T\) and corresponding ground truth. \(\widehat{\mathbf{Y}}_{i}\) means the \(i\)-th time point in the prediction result.

For other datasets, we adopt the symmetric mean absolute percentage error (SMAPE) as the metric, which can be calculated as follows:

\[\text{SMAPE}=\frac{200}{T}\sum_{i=1}^{T}\frac{|\mathbf{Y}_{i}-\widehat{ \mathbf{Y}}_{i}|}{|\mathbf{Y}_{i}|+|\widehat{\mathbf{Y}}_{i}|},\]

where \(\widehat{\mathbf{Y}},\mathbf{Y}\in\mathbb{R}^{T\times M}\) are the \(M\) variates prediction results of length \(T\) and corresponding ground truth. \(\widehat{\mathbf{Y}}_{i}\) means the \(i\)-th time point in the prediction result.

## Appendix C Pseudo-code of DeformableTST

We provide the pseudo-code of DeformableTST in Algorithm 1.

```
0: Input time series \(\mathbf{X}_{in}\in\mathbb{R}^{B\times I\times M}\); batch size \(B\); variates number \(M\); input length \(I\); prediction length \(T\); DeformableTST block number \(L\); feature series's embedding dimension in the \(i\)-th block \(D_{i}\); feature series's length in the \(i\)-th block \(N_{i}\). Boolean flag to indicate using downsampling layers or not Use_Downsampling.
1:\(\mathbf{X}_{in}=\texttt{RevIN}(\mathbf{X}_{in},\texttt{mode=norm})\)\(\triangleright\mathbf{X}\in\mathbb{R}^{B\times I\times M}\)
2:\(\mathbf{X}_{in}=\mathbf{X}_{in}.\texttt{transpose}\)\(\triangleright\mathbf{X}\in\mathbb{R}^{B\times M\times I}\)
3:\(\mathbf{X}_{in}=\mathbf{X}_{in}.\texttt{reshape}\)\(\triangleright\mathbf{X}_{in}\in\mathbb{R}^{(BM)\times 1\times I}\)
4:\(\triangleright\) Embedding the input time series variate-independently with optional patching.
5:\(\mathbf{X}_{0}=\texttt{Embedding}(\mathbf{X}_{in})\)\(\triangleright\mathbf{X}_{0}\in\mathbb{R}^{(BM)\times D_{0}\times N_{0}}\)
6:for\(i\)in\(\{1,\ldots,L\}\):\(\triangleright\) Run through DeformableTST blocks.
7:\(\triangleright\) The local perception unit (LPU) is used to learn the local temporal information.
8:\(\mathbf{X}_{i}^{local}=\texttt{LPU}(\mathbf{X}_{i-1})\)\(\triangleright\)\(\mathbf{X}_{i}^{local}\in\mathbb{R}^{(BM)\times D_{i}\times N_{i}}\)
9:\(\triangleright\) The deformable attention is adopted to learn the global temporal information.
10:\(\mathbf{X}_{i}^{global}=\texttt{LayerNorm}(\mathbf{X}_{i}^{local}+\texttt{ DeformAttention}(\mathbf{X}_{i}^{local}))\)\(\triangleright\)\(\mathbf{X}_{i}^{global}\in\mathbb{R}^{(BM)\times D_{i}\times N_{i}}\)
11:\(\triangleright\) The feed-forward network injected with a depth-wise convolution (ConvFFN) is used to learn the local temporal information and the new feature representation.
12:\(\mathbf{X}_{i}=\texttt{LayerNorm}(\mathbf{X}_{i}^{global}+\texttt{ConvFFN}( \mathbf{X}_{i}^{global}))\)\(\triangleright\)\(\mathbf{X}_{i}\in\mathbb{R}^{(BM)\times D_{i}\times N_{i}}\)
13:\(\triangleright\) Adopting the optional downsampling layer between two blocks.
14:if\(i\ <\ L\)and Use_Downsampling is True:
15:\(\mathbf{X}_{i}=\texttt{DownSampling}(\mathbf{X}_{i})\)\(\triangleright\)\(\mathbf{X}_{i}\in\mathbb{R}^{(BM)\times(2D_{i})\times(N_{i}/2)}\)
16:Endfor
17:\(\mathbf{X}_{L}=\mathbf{X}_{L}.\texttt{reshape}\)\(\triangleright\)\(\mathbf{X}_{L}\in\mathbb{R}^{B\times M\times(D_{L}N_{L})}\)
18:\(\mathbf{\hat{Y}}=\texttt{Projection}(\mathbf{X}_{L})\)\(\triangleright\) Obtaining the forecasting series with Projection, \(\mathbf{\hat{Y}}\in\mathbb{R}^{B\times M\times T}\)
19:\(\mathbf{\hat{Y}}=\mathbf{\hat{Y}}.\texttt{transpose}\)\(\triangleright\)\(\mathbf{\hat{Y}}\in\mathbb{R}^{B\times T\times M}\)
20:\(\mathbf{\hat{Y}}=\texttt{RevIN}(\mathbf{\hat{Y}},\texttt{mode=denorm})\)\(\triangleright\)\(\mathbf{\hat{Y}}\in\mathbb{R}^{B\times T\times M}\)
21:Return\(\mathbf{\hat{Y}}\)\(\triangleright\) Return the prediction result\(\mathbf{\hat{Y}}\) ```

**Algorithm 1** DeformableTST - Overall Architecture.

## Appendix D Parameter Sensitivity

To evaluate the parameter sensitivity of our DeformableTST, we perform experiments with varying model parameters, including number of blocks ranging from \(L=\{2,4,6\}\), model dimension ranging from \(D=\{16,32,64\}\), FFN expansion ranging from \(\alpha=\{1,2,4,8\}\), number of important time points ranging from \(N_{samp}=\{6,12,24\}\) and learning rate ranging from \(lr=\{10^{-3},5\times 10^{-4},10^{-4}\}\).

The results are shown in Figure 6. In general, our model is robust to the choice of model parameters. Compared with the default block number \(L=4\), stacking more blocks will bring further performance improvement. Considering both performance and efficiency, we recommend to fix the block number as 4 in long term forecasting tasks.

We also compare our model sensitivity to patch size with PatchTST's. As shown in Figure 6, our model is less sensitive to the choice of patch size, therefore successfully getting rid of the over-reliMore ERF Results

In Section 1, we visualize the effective receptive fields (ERFs) of PatchTST [35] based on [27; 14] to see which parts of the time points in input series are focused by the model when extracting temporal representations. Here we provide more ERF visualization results with other patch-based Transformer forecasters. In a ERF figure, a brighter area means that the model tends to focus on these time points when extracting temporal representation, and thus these time points will contribute more to the middle point of the final representation.

As shown in Figure 7, the ERFs of the patch-based Transformer forecasters highly rely on the guidance of patching. If without patching, nearly all time points in input series are equally focused by the model and the model performs worse, exposing the problem of distracted attention. This finding means that attention has not learned to distinguish the importance of each time point in input series, leading to trivial representation. After patching, these Transformer forecasters tend to foucs on some important time points based on a patch partition. This phenomenon means that: although patching can help attention better focus on important time points, the guidance of patching tend to distribute the focused points evenly among all patches. But in real-world scenarios, it is possible that the important time points are not evenly distributed among all patches, which is inconsistent with the tendency in the guidance of patching, leading to the inferior performance of these patch-based Transformer forecasters in some cases. There is also some difference among the ERFs of these patch-based Transformer forecasters due to their different specific designs. PatchTST [35] tends to only focus on a very few time points in each patch and ignore others. But CARD [51] can focus on more time points in one patch thanks to its additional attention across feature dimension, which aligns the information within patch. And the ERF of GPT4TS [58] also reveals the autoregressive property in GPT [40] backbone, making it only focus on the time points before the the middle point.

By contrast, we provide the ERF of our DeformableTST in Figure 8 for comparison. By default, we set \(N_{samp}=12\). Under input-\(96\) settings, our DeformableTST does not adopt patching technique but can still focus on a small number of important time points, proving that our DeformableTST can foucs well by itself without the need of patching. Under input-\(384\) settings, we adopt a small size patching and divide the input series into 96 patches to alleviate the efficiency issue. Under such condition, our DeformableTST still does not focus based on a patch partition. Although adopting patching technique, the focused time points in our DeformableTST is not evenly distributed among all 96 patches, therefore being less reliant on patching.

Figure 6: Parameter sensitivity. For patch size, we conduct experiments under input-384-predict-96 settings and adopt PatchTST as comparison. For other parameters, we conduct experiments under input-96-predict-96 settings.

## Appendix F More Results of Model Analysis in Section 5

### More Ablation Results in Section 5.1

More ablation results are provided in Figure 9.

### More Comparison Results in Section 5.2

Case StudyWe provide the visualization of learned important time points as an intuitive comparision for some popular sparse attentions in time series community. As shown in Figure 10, the keys of window attention are restricted within the local window. And the important keys for ProbSparse

Figure 8: The Effective Receptive Field (ERF) of DeformableTST. A brighter area means that these time points are focused by the model when extracting temporal representation.

Figure 7: The Effective Receptive Field (ERF) of more patch-based Transformer forecasters. A time points are focused by the model when extracting temporal representation.

Figure 9: More ablation study results in long-term forecasting tasks. From the top to the bottom, each row means one design we add on PatchTST to modify it into our DeformableTST. We report the averaged MSE of four prediction lengths. The memory usage is recorded under input-96-predict-96 setting with the same batch size. A lower MSE (a shorter blue bar) and a smaller memory usage (a green star closer to the vertical axis) means better performance and efficiency.

attention tend to gather in a small area around the time point that most fits the prior. This property makes window attention and ProbSparse attention only focus on a small local area and fail to find the important time points in a global range, leading to the loss of information. Meanwhile, importantant time points refer to the time points that reflect the property of time series and make contribution to better performance. And the types of important time points are varied (e.g., time point in the similar changing stage, the inflexion point, the extremal point and so on). But AutoCorrelation can only foucs on the time points in the similar changing stage due to its prior, resulting in the lack of diversity. By contrast, our deformable attention can find the important time points in a global range for the reference points in the sampling process are uniformly distributed throughout the whole input time series. And our deformable attention can also learn different types of important time points because it is less reliant on specific priors and can foucs on any appropriate important time points based on the learnable offsets learned from the input series. Therefore, our deformable attention can find more types of important time points in a wider range, therefore being more flexible to the diverse property in different time series and performing better than other prior-based sparse attentions.

## Appendix G Model Efficiency

We comprehensively compare the forecasting performance, training speed, and memory usage of some advanced Transformer-based models. And we compare the efficiency under two representative conditions: (1) the dataset is of a large variate number, (2) the experiment setting is of a long input length and prediction length. And the results are shown in Figure 11. Considering both performance and efficiency, our DeformableTST shows great superiority than other Transformer-based competitors, therefore being an ideal choice in time series forecasting.

## Appendix H Error Bar

We report the standard deviation of DeformableTST performance under five runs with different random seeds in Table 7, which exhibits that the performance of DeformableTST is stable.

Figure 11: Model efficiency comparison.

Figure 10: Visualization of learned important time points. For clearness, we show the top-6 keys with respect to the last query for attentions and show the top-6 time delays for AutoCorrelation.

## Appendix I More Implementation Details about Deformable Attention

### Implementation of Linear Interpolation

As mentioned in Section 3.2, we sample the important time points based on a set of learnable coordinates called sampling points \(\mathbf{T}_{samp}\). In practice, after obtaining the sampling points \(\mathbf{T}_{samp}\), we achieve this sampling process via linear interpolation following [48; 60]. In details, we calculate the values of these important time points by linear interpolation \(\phi(\cdot;\cdot)\) to make this sampling process differentiable. And the linear interpolation \(\phi(\cdot;\cdot)\) is calculated as follows:

\[\phi\left(\mathbf{X};\mathbf{T}_{samp}\right) =\sum_{t=0}^{N-1}g(t,\mathrm{De-normalize}(\mathbf{T}_{samp}))\mathbf{X}[:,t,:],\] (11)

where \(g(a,b)=\max(0,1-|a-b|)\) and \(t\) indexes all the coordinates on \(\mathbf{X}\in\mathbb{R}^{M\times D\times N}\). The value of \(\mathbf{T}_{samp}\) is de-normalized back to the range of \([0,N-1]\) before passed into \(g\). As \(g\) would be non-zero only on the 2 integral coordinates closest to \(\mathbf{T}_{samp}\), it simplifies Eq.(11) to calculate the value of each important time point as the weighted average of its only 2 closest time points.

### Deformable Relative Positional Bias

Due to the deforming process and hierarchical representation, the fixed absolute positional embedding is not suitable for our design. Instead, we adopt a relative position bias to encode the position information into the attention map [23], which represents the relative positional information between the query token series \(\mathbf{Q}\) and the key token series \(\tilde{\mathbf{K}}\).

Considering the input feature series \(\mathbf{X}\in\mathbb{R}^{M\times D\times N}\) of the attention module, the relative coordinate displacements of this length-\(N\) series contain \((2N-1)\) different values and lie in the range of \([-N,N]\). Then we will maintain a learnable parameterized bias table \(\tilde{\mathbf{B}}\in\mathbb{R}^{H\times(2N-1)\times 1}\), in which each element represents one of the above \((2N-1)\) relative coordinate displacements.

Meanwhile, to represent the relative positional information between the query token series \(\mathbf{Q}\) and the key token series \(\tilde{\mathbf{K}}\), we also need to denote the coordinates of \(\mathbf{Q}\) and \(\tilde{\mathbf{K}}\). The coordinates of \(\mathbf{Q}\) are generated from a 1D uniform grid with size \(N\). It indicates the 1D coordinates of all \(N\) time points in the query series \(\mathbf{Q}\). These coordinate values are normalized to \([-1,+1]\), where \(-1\) indicates the start of the series and \(+1\) means the end of the series. And the coordinates of \(\tilde{\mathbf{K}}\) are the sampling point \(\mathbf{T}_{samp}\). Then the relative position \(\mathbf{R}\in\mathbb{R}^{N\times N_{samp}\times 1}\) is calculated as follows:

\[\mathbf{R}=\mathbf{Q}_{coord}-\mathrm{Transpose}(\mathbf{T}_{samp})\] (12)

Then we clip \(\mathbf{R}\) by \(-1\) and \(+1\) and obtain deformable relative positional bias \(\mathbf{B}\) by linear interpolation to the learnable parameterized bias table \(\hat{\mathbf{B}}\) with the continuous relative displacements \(\mathbf{R}\) as follows:

\[\mathbf{B}=\phi(\hat{\mathbf{B}};\mathbf{R})\] (13)

\begin{table}
\begin{tabular}{c|c c|c c|c c|c c} \hline \hline Dataset & \multicolumn{2}{c}{ETTh1} & \multicolumn{2}{c}{ETTh2} & \multicolumn{2}{c}{ETTm1} & \multicolumn{2}{c}{ETTm2} \\ \cline{2-10} Horizon & MSE & MAE & MSE & MAE & MSE & MAE & MSE & MAE \\ \hline \(96\) & 0.373\(\pm\)0.002 & 0.396\(\pm\)0.001 & 0.281\(\pm\)0.001 & 0.334\(\pm\)0.001 & 0.316\(\pm\)0.001 & 0.358\(\pm\)0.001 & 0.178\(\pm\)0.000 & 0.262\(\pm\)0.000 \\ \(192\) & 0.427\(\pm\)0.001 & 0.427\(\pm\)0.000 & 0.353\(\pm\)0.002 & 0.382\(\pm\)0.001 & 0.354\(\pm\)0.001 & 0.380\(\pm\)0.001 & 0.243\(\pm\)0.002 & 0.301\(\pm\)0.002 \\ \(336\) & 0.437\(\pm\)0.003 & 0.426\(\pm\)0.002 & 0.341\(\pm\)0.000 & 0.379\(\pm\)0.000 & 0.379\(\pm\)0.002 & 0.405\(\pm\)0.002 & 0.310\(\pm\)0.001 & 0.348\(\pm\)0.001 \\ \(720\) & 0.464\(\pm\)0.003 & 0.462\(\pm\)0.003 & 0.410\(\pm\)0.004 & 0.431\(\pm\)0.003 & 0.443\(\pm\)0.004 & 0.438\(\pm\)0.003 & 0.400\(\pm\)0.002 & 0.398\(\pm\)0.002 \\ \hline Dataset & \multicolumn{2}{c}{Weather} & \multicolumn{2}{c}{Solar-Energy} & \multicolumn{2}{c}{ECL} & \multicolumn{2}{c}{Traffic} \\ \cline{2-10} Horizon & MSE & MAE & MSE & MAE & MSE & MAE & MSE & MAE \\ \hline \(96\) & 0.169\(\pm\)0.000 & 0.213\(\pm\)0.0001 & 0.193\(\pm\)0.001 & 0.232\(\pm\)0.001 & 0.158\(\pm\)0.002 & 0.255\(\pm\)0.002 & 0.418\(\pm\)0.002 & 0.271\(\pm\)0.002 \\ \(192\) & 0.216\(\pm\)0.002 & 0.255\(\pm\)0.001 & 0.225\(\pm\)0.002 & 0.261\(\pm\)0.001 & 0.168\(\pm\)0.004 & 0.265\(\pm\)0.004 & 0.437\(\pm\)0.004 & 0.276\(\pm\More Discussions on Patching and Transformer-based Models

#### b.1 Discussions on Patching

Impact on PerformanceAs shown in Figure 1 and 7, although patching can help attention better focus on important time points, the guidance of patching tend to distribute the focused points evenly among all patches. But in real-world scenarios, it is possible that the important time points are not evenly distributed among all patches. In some cases, most of the important time points are only distributed in a few patches while other patches only contain unimportant time points. Such cases are inconsistent with the tendency in the guidance of patching, leading to the inferior performance of the patch-based Transformer forecasters in these cases. And patching technique must work with a very long input length because leveraging patching on short time series leads to very few tokens, limiting attention's ability in long-term modeling. These drawbacks limit the performance and applicability of the previous patch-based Transformer forecasters.

Impact on EfficiencyIn addition to helping attention focus better, patching can also improve the efficiency by reducing the number of tokens. When facing a very long input length (e.g., 384 and 768), we still adopt a small patch size in our design for better efficiency. Therefore this paper is not a call to completely abandon patching technique in all cases, but an extension to scenarios where patching technique is not suitable.

### Compared with Typical Transformer-based Models

To highlight how we innovate and upgrade the Transformer-based model, we compare our DeformableTST with some milestone Transformer-based models in time series community.

Compared with PatchTST [35]PatchTST is a milestone Transformer-based model and DeformableTST can be seen as an improvement of it to solve the problem of over-reliance on patching. PatchTST highly relies on patching for patching can force the attention to focus on only a few important time points within each patch and ignore other time points within the patch. But the choose of patch size is a dilemma in practice: a too large patch size could lead to many other time points within the patch being ignored, resulting in the risk of neglecting other priorities. And a too small patch size will lead to a huge amount of tokens, making it hard to focus. This dilemma cannot be resolved by PatchTST itself. To address this issue, we propose deformable attention, an attention mechanism that can focus well by itself, to get rid of the need of patching. Since deformable attention enjoys great focusing ability, we can use a small patch size to mitigate the problem of some priorities being ignored and free to worry about attention being hard to focus on important time points, successfully reducing the reliance on patching and resolving the dilemma.

Compared with iTransformer [22]DeformableTST and iTransformer are the lastest Transformer-based forecasters. Both methods focus on the underperformance issue of previous attention mechanism in temporal modeling and devote to designing a more powerful Transformer-based forecaster. But they hold different opinions. Although iTransformer still adopts a Transformer architecture, it insists that attention is not suitable for temporal modeling while linear layers are more appropriate. This design makes its performance more similar to linear-based forecasters rather than Transformer-based ones, being less competitive in difficult tasks (e.g., univariate short-term forecasting tasks with lower similarity between samples). Different from iTransformer, our DeformableTST follows the tradition of Transformer-based models to still uses attention for temporal modeling. Specifically, in this paper, through experiments and analysis, we further attribute the underperformance issue of previous attention mechanism to their over-reliance on patching and thus propose deformable attention to solve this problem, successfully designing a more powerful Transformer-based forecaster and broadening the applicability of Transformer-based models.

## Appendix K Limitations and Future Work

In this paper, we mainly focus on how to better use attention in temporal modeling and do not consider the multivariate correlating. It will be our future work to study how to further capture the multivariate correlation in our model, which can hopefully improve the performance, especially in datasets with large number of variates. Besides, we will further explore the potential of our DeformableTST in more time series analysis tasks and further develop its performance by large-scale pre-training in the future.

## Appendix L Ethics Statement and Broader Impact

Our work only focuses on the time series forecasting problem, so there is no potential ethical risk.

Our model achieves the state-of-the-art performance on a wider range of time series forecasting tasks, covering a large amount of real-world scenarios. Therefore, the proposed model makes it promising to tackle real-world forecasting problem, helping our society make better decisions and prevent risks in advance. And we hope our findings can prompt people to rethink the relationship between Transformer-based models and patching technique, thereby designing more powerful Transformer-based forecasters with a wider range of applicability.

Our paper mainly focuses on scientific research and has no obvious negative social impact.

## Appendix M Reproducibility Statement

In the main text, we have strictly formalized the model architecture with equations. All the implementation details are included in the Appendix, including dataset descriptions, metrics, model, and experiment configurations. Code is available at this repository: https://github.com/luodhhh/DeformableTST.

## Appendix N Full Results

Due to the space limitation of the main text, we place the full results of all experiments and results of more baselines in the following subsections. And we also provide the showcases in Appendix O.

### Long-term Forecasting with Input Length 96

The full results of long-term forecasting with input length 96 are provided in Table 8. And more results with more baselines are also included.

### Long-term Forecasting with Input Length 384

The full results of long-term forecasting with input length 384 are provided in Table 9. And more results with more baselines are also included.

### Long-term Forecasting with Input Length 768

The full results of long-term forecasting with input length 768 are provided in 10. And more results with more baselines are also included.

### Multivariate Short-term Forecasting

The full results of multivariate short-term forecasting tasks are provided in Table 11. And more results with more baselines are also included.

### Univariate Short-term Forecasting

The full results of M4 datasets are provided in Table 12. And the full results of other datasets are provided in Table 13.

[MISSING_PAGE_FAIL:26]

\begin{table}
\begin{tabular}{c|c c c|c c|c c|c c|c c|c c|c c|c c|c c|c c|c c|c c} \hline \hline \multirow{2}{*}{Models} & \multicolumn{2}{c}{**DiformableTIST**} & \multicolumn{2}{c}{**Pathformer**} & \multicolumn{2}{c}{CARD} & \multicolumn{2}{c}{GPT4TS} & \multicolumn{2}{c}{PatchTIST} & \multicolumn{2}{c}{Transformer} & \multicolumn{2}{c}{FEDformer} & \multicolumn{2}{c}{Autoformer} & \multicolumn{2}{c}{RLinear} & \multicolumn{2}{c}{TIDE} & \multicolumn{2}{c}{TimeNet} & \multicolumn{2}{c}{DLinear} & \multicolumn{2}{c}{SCINet} \\  & \multicolumn{2}{c}{**(Ours)**} & \multicolumn{2}{c}{[6]} & \multicolumn{2}{c}{[51]} & \multicolumn{2}{c}{[58]} & \multicolumn{2}{c}{[35]} & \multicolumn{2}{c}{[22]} & \multicolumn{2}{c}{[57]} & \multicolumn{2}{c}{[47]} & \multicolumn{2}{c}{[18]} & \multicolumn{2}{c}{[9]} & \multicolumn{2}{c}{[46]} & \multicolumn{2}{c}{[52]} & \multicolumn{2}{c}{[20]} \\ \cline{2-19}  & Metric & MSE & MAE & MSE & MAE & MSE & MAE & MSE & MAE & MSE & MAE & MSE & MAE & MSE & MAE & MSE & MAE & MSE & MAE & MSE & MAE & MSE & MAE \\ \hline \multirow{2}{*}{Metric} & 96 & **0.369** & **0.396** & 0.386 & 0.413 & 0.377 & 0.402 & 0.415 & 0.419 & 0.376 & 0.401 & 0.413 & 0.427 & 0.398 & 0.439 & 0.446 & 0.448 & 0.372 & 0.397 & 0.451 & 0.455 & 0.414 & 0.428 & 0.373 & 0.399 & 0.419 & 0.435 \\  & 192 & 0.410 & **0.417** & 0.413 & 0.428 & 0.494 & 0.418 & 0.447 & 0.447 & 0.410 & 0.421 & 0.449 & 0.450 & 0.454 & 0.471 & 0.425 & 0.488 & 0.411 & 0.421 & 0.428 & 0.478 & 0.469 & 0.467 & 0.421 & 0.471 & 0.469 \\  & 346 & **0.391** & **0.414** & 0.433 & 0.428 & 0.435 & 0.457 & 0.449 & 0.438 & 0.439 & 0.455 & 0.489 & 0.469 & 0.451 & 0.517 & 0.499 & 0.425 & 0.529 & 0.501 & 0.486 & 0.502 & 0.489 & 0.405 & 0.515 & 0.407 \\  & 720 & 0.447 & 0.464 & 0.463 & 0.472 & **0.437** & **0.499** & 0.471 & 0.462 & 0.451 & 0.471 & 0.528 & 0.521 & 0.650 & 0.559 & 0.557 & 0.536 & 0.450 & 0.465 & 0.510 & 0.509 & 0.645 & 0.542 & 0.479 & 0.501 & 0.529 & 0.515 \\  & & Avg & **0.404** & **0.423** & 0.425 & 0.448 & 0.412 & 0.429 & 0.448 & 0.444 & 0.418 & 0.433 & 0.461 & 0.464 & 0.485 & 0.486 & 0.486 & 0.483 & 0.415 & 0.428 & 0.486 & 0.481 & 0.508 & 0.479 & 0.424 & 0.442 & 0.483 & 0.479 \\ \hline \multirow{2}{*}{Metric} & 96 & **0.722** & **0.334** & 0.283 & 0.390 & 0.275 & 0.136 & 0.319 & 0.371 & 0.275 & 0.337 & 0.306 & 0.363 & 0.425 & 0.469 & 0.395 & 0.444 & 0.278 & 0.338 & 0.370 & 0.431 & 0.347 & 0.395 & 0.368 & 0.327 & 0.383 \\  & 192 & **0.325** & **0.369** & 0.341 & 0.389 & 0.379 & 0.395 & 0.396 & 0.419 & 0.385 & 0.355 & 0.460 & 0.399 & 0.432 & 0.396 & 0.349 & 0.356 & 0.399 & 0.441 & 0.424 & 0.483 & 0.439 & 0.399 & 0.428 & 0.375 & 0.412 \\  & 316 & **0.319** & **0.373** & 0.382 & 0.421 & 0.360 & 0.397 & 0.449 & 0.439 & 0.392 & 0.391 & 0.402 & 0.390 & 0.402 & 0.390 & 0.434 & 0.460 & 0.469 & 0.499 & 0.441 & 0.451 & 0.47

\begin{table}
\begin{tabular}{c c c c c c c c c c c c c c c c c c c} \hline \hline \multirow{2}{*}{Models} & \multicolumn{3}{c}{**DeformableTSF**} & Path\_Conduct & GPTATS & Consus & PatchTST & Transformer & FED/learner & Announce & RLLinear & TIDE & TimeNex & DLLinear & SCINNet & N-HEATS & N-HEATS \\  & & (Ours) & [6] & [51] & [58] & [53] & [22] & [57] & [47] & [18] & [9] & [46] & [52] & [20] & [4] & [37] \\ \hline \multirow{4}{*}{
\begin{tabular}{c} **2** \\ **3** \\ **4** \\ **4** \\ **5** \\ **1** \\ **1** \\ **2** \\ **2** \\ **3** \\ **4** \\ **5** \\ **6** \\ **6** \\ **7** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** **\\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** **8** \\ **8** \\ **8** \\ **8** **8** \\ **8** \\ **8** \\ **8** \\ **8** **8** \\ **8** \\ **8** **8** \\ **8** **8** \\ **8** \\ **8** \\ **8** \\ **8** \\ **8** **8** \\ **8** **\\ **8** \\ **8** **8** \\ **8** \\ **8** \\ **8** \\ **8** **8** \\ **8** **8** \\ **8** \\ **8** \\ **8** \\ **8** **8** \\ **8** \\ **8** **8** \\ **8** \\ **8** **8** \\ **8** **8** \\ **8** **8** \\ **8** **8** \\ **8** **8** \\ **8** ** \\ **8** **8** \\ **8** **8** \\ **8** **8** \\ **8** **\\ **8** **8** \\ **8** \\ **8** **8** \\ **8** **8** \\ **8** **8** \\ **8** **8** \\ **8** **8** \\ **8** **8** \\ **8** **8** \\ **8** **8** \\ **8** ** \\ **8** **8** \\ **8** **8** \\ **8** **8** \\ **8** **8** \\ **8** **8** \\ **8** **8** \\ **8** **8** \\ **8** ** **8** \\ **8** **8** \\ **8** **8** \\ **8** \\ **8** **8** \\ **8** **8** \\ **8** **8** \\ **8** **8** \\ **8** **8** \\ **8** **8** \\ **8** **8** \\ **8** **8** \\ **8** **8** \\ **8** ** **8** \\ **8** **8** \\ **8** **8** \\ **8** **8** \\ **8** \\ **8** ** **8** \\ **8** **8** \\ **8** ** **8** \\ **8** **8** \\ **8** **8** \\ **8** **8** \\ **8** **8** \\ **8** **8** \\ **8** **8** \\ **8** **8** \\ **8** ** **8** \\ **8** ** **8** \\ **8** **8** \\ **8** ** **8** \\ **8** ** **8** \\ **8** **8** \\ **8** **8** \\ **8** **8** \\ **8** **8** \\ **8** ** **8** \\ **8** \\ **8** ** **8** \\ **8** \\ **8** **8** \\ **8** **8** \\ **8** **8** \\ **8** **8** \\ **8** ** \\ **8** ** **8** \\ **8** **8** \\ **8** ** \\ **8** **8** \\ **8** **8** \\ **8** **8** \\ **8** ** **8** \\ **8** **8** \\ **8** **8** \\ **8** ** **8** \\ **8** **8** \\ **8** **8** \\ **8** **8** \\ **8** \\ **8

\begin{table}
\begin{tabular}{c|c|c c c c c c c c c c c c c c c} \hline \hline \multicolumn{2}{c}{\multirow{2}{*}{Models}} & \multicolumn{2}{c}{**DeformableTST**} & \multicolumn{2}{c}{Path.} & \multicolumn{2}{c}{CARD} & \multicolumn{2}{c}{GPT+TS} & \multicolumn{2}{c}{Cross.} & \multicolumn{2}{c}{PatchTST} & \multicolumn{2}{c}{IInnsferner} & \multicolumn{2}{c}{FED.} & \multicolumn{2}{c}{Auto.} & \multicolumn{2}{c}{RLinear} & \multicolumn{2}{c}{TDE} & \multicolumn{2}{c}{TimeNet} & \multicolumn{2}{c}{DLinear} & \multicolumn{2}{c}{SCINet} & \multicolumn{2}{c}{N-HETS} \\  & \multicolumn{2}{c}{(**Ours**)} & \multicolumn{2}{c}{[6]} & \multicolumn{2}{c}{[51]} & \multicolumn{2}{c}{[58]} & \multicolumn{2}{c}{[53]} & \multicolumn{2}{c}{[35]} & \multicolumn{2}{c}{[22]} & \multicolumn{2}{c}{[57]} & \multicolumn{2}{c}{[47]} & \multicolumn{2}{c}{[18]} & \multicolumn{2}{c}{[9]} & \multicolumn{2}{c}{[46]} & \multicolumn{2}{c}{[52]} & \multicolumn{2}{c}{[20]} & \multicolumn{2}{c}{[4]} & \multicolumn{2}{c}{[37]} \\ \hline \multirow{3}{*}{M1} & Yearly & **15.902** & 20.305 & 21.769 & 21.208 & 26.310 & 22.408 & 29.196 & 21.718 & 27.242 & 21.491 & 25.671 & 16.023 & 27.472 & 21.145 & 27.404 & 21.021 \\  & Quarterly & **14.232** & 16.955 & 15.666 & 16.782 & 15.806 & 16.338 & 16.288 & 20.823 & 17.249 & 30.849 & 29.427 & 22.875 & 25.456 & 32.920 & 27.035 & 17.089 \\  & Monthly & **15.616** & 18.793 & 16.569 & 21.322 & 18.049 & 17.241 & 19.401 & 17.626 & 18.708 & 30.788 & 26.259 & 18.480 & 20.337 & 26.665 & 21.960 & 21.320 \\ \hline \multirow{3}{*}{M3} & Yearly & **15.315** & 24.509 & 20.867 & 21.846 & 18.488 & 18.623 & 22.998 & 17.300 & 17.386 & 55.073 & 20.301 & 23.989 & 24.359 & 33.380 & 23.544 & 17.204 \\  & Quarterly & **7.365** & 10.933 & 8.052 & 12.573 & 8.069 & 7.991 & 8.642 & 11.751 & 11.503 & 27.079 & 18.749 & 11.459 & 16.963 & 11.576 & 18.907 & 12.189 \\  & Monthly & **14.928** & 18.193 & 21.103 & 22.804 & 18.278 & 16.562 & 18.060 & 25.910 & 19.309 & 30.241 & 26.082 & 21.350 & 25.341 & 25.883 & 23.808 & 19.809 \\  & Other & **9.378** & 17.353 & 15.500 & 10.999 & 12.100 & 15.770 & 18.439 & 20.989 & 22.525 & 26.769 & 18.370 & 18.091 & 15.690 & 26.064 & 17.216 & 22.900 \\ \hline \multirow{3}{*}{Tourism} & Quarterly & **17.968** & 27.921 & 19.182 & 31.216 & 19.517 & 19.314 & 20.116 & 38.066 & 39.887 & 39.079 & 48.669 & 28.052 & 34.630 & 35.208 & 33.909 & 43.887 \\  & Monthly & **25.037** & 34.769 & 27.515 & 38.819 & 27.718 & 27.570 & 28.743 & 35.983 & 31.698 & 40.432 & 40.399 & 38.505 & 40.095 & 40.269 & 37.559 & 41.778 \\ \hline \multirow{3}{*}{NN5} & Weekly & **14.372** & 21.816 & 22.491 & 16.012 & 17.672 & 17.177 & 20.449 & 17.072 & 19.650 & 22.968 & 23.424 & 22.355 & 23.781 & 26.486 & 16.645 & 23.282 \\ \cline{1-1} \cline{2-16}  & Hospital & Monthly & **19.688** & 21.551 & 21.392 & 22.587 & 20.907 & 22.123 & 20.785 & 28.646 & 25.749 & 26.184 & 29.103 & 21.182 & 23.015 & 28.807 & 25.309 & 23.594 \\ \hline \multirow{3}{*}{KDD Cup} & Hourly & **50.694** & 56.740 & 61.653 & 54.713 & 58.472 & 59.449 & 60.615 & 59.013 & 57.617 & 62.922 & 63.447 & 56.618 & 59.523 & 63.358 & 54.855 & 62.305 \\ \hline \hline \end{tabular}
\end{table}
Table 13: Full results for the **univariate short-term forecasting** tasks in other datasets. We report the SMAPE in this Table as metric and a lower metric indicates better performance. \(*\). in the Transformers indicates the name of \(*\)former. The original paper of N-BEATS [37] adopts a special ensemble method to promote the performance. For fair comparisons, we remove the ensemble and only compare the pure forecasting models.

[MISSING_PAGE_EMPTY:31]

Comparison with More Baselines and Experiments on More Datasets

### Compared with Sageformer

We compare our model with Sageformer [54], the latest Graph-Transformer model. Since Sageformer will produce NaN outputs in some short-term forecasting tasks, we mainly conduct comparisons in long-term forecasting. The results are shown in Table 14. Our DeformableTST achieves consistently better performance than the latest Graph-Transformer method, further demonstrating our performance superiority.

### Experiments on Stock Market Dataset

We conduct multivariate short-term forecasting experiments on Stock Market Dataset [36]. As shown in Table 16, our DeformableTST still outperforms other competitors, validating that DeformableTST can work on stock market data.

## Appendix Q Experiments on Synthetic Dataset

We conduct experiments on synthetic dataset with some typical cases of attention distributions to prove our model can handle both uniform and clustered attention distribution. The details and results are provided in Figure 14.

As shown in Figure 14, our method can accurately predict the future data in all cases. And ERFs can operate as anticipated, successfully matching the distributions of key information. In details, in the case of globally uniform attention, the brighter points in ERF are also distributed globally, which means the model can find the important time points across the whole series. In other cases, the brighter points in ERF tend to concentrate in localized areas of key information, proving the effectiveness of our method in scenarios where key information is clustered within specific time window. These results validate that our method can adeptly manage both uniform and clustered attention distributions.

## Appendix R Model Robustness to Patching

We conduct ablation study to show the effect of patching on our method (under input-384 and input-768 settings). As shown in Figure 6 and Figure 16, our model is robust to the choice of different patch sizes on input length 384 and input length 768.

Meanwhile, as shown in Figure 15, the performance of other Patch-based Transformer competitors (e.g., PatchTST [35] and CARD [51]) will decrease obviously and fell out of the good rankings if without patching. This is a significant performance decrease, especially considering the intense competition in time series forecasting. By contrast, our method works well without patching, which further verifies our robustness to the use of patching and shows that our model can successfully get rid of the over-reliance of patching.

\begin{table}
\begin{tabular}{c c c c c c c c c c c c} \hline \hline \multirow{2}{*}{Dataset Metric} & ETTh1 & ETTh2 & ETTm1 & ETTm2 & Weather & Solar & ECL & Traffic \\ \cline{2-11}  & MSE & MAE & MSE & MAE & MSE & MAE & MSE & MAE & MSE & MAE & MSE & MAE \\ \hline \hline
**DeformableTST (Ours)** & **0.413 0.430** & **0.336 0.381** & **0.358 0.386** & **0.267 0.321** & **0.233 0.266** & **0.199 0.255** & **0.169 0.267** & **0.410 0.280** \\ Sageformer [54] & 0.427 0.438 & 0.368 0.405 & 0.371 0.394 & 0.275 0.327 & 0.238 0.272 & 0.227 0.285 & 0.174 0.273 & 0.418 0.287 \\ \hline \hline \end{tabular}
\end{table}
Table 14: Comparison with Sageformer in long-term forecasting tasks. A lower MSE or MAE indicates a better performance. Results are averaged from three input lengths \(I\in\{96,384,768\}\) and four prediction lengths \(T\in\{96,192,336,720\}\). The best results are in **bold**. Full results of Sageformer [54] are provided in Table 15.

\begin{table}
\begin{tabular}{c c c c c c c c c c c c c c c c c c} \hline \hline \multirow{2}{*}{Models} & \multirow{2}{*}{\begin{tabular}{c} **DeformatedTST** \\ **(Ours)** \\ \end{tabular} } & \multicolumn{2}{c}{**Pathformer**} & \multicolumn{2}{c}{**CARD**} & \multicolumn{2}{c}{**GPT4TS**} & \multicolumn{2}{c}{**PatchTST**} & \multicolumn{2}{c}{**Transformer**} & \multicolumn{2}{c}{**FEDformer**} & \multicolumn{2}{c}{**Autformer**} & \multicolumn{2}{c}{**RLinear**} & \multicolumn{2}{c}{**TIDE**} & \multicolumn{2}{c}{**TimeResNet**} \\  & & **(Ours)** & [6] & [51] & [58] & [35] & [22] & [57] & [47] & [18] & [9] & [46] \\ \hline \multirow{4}{*}{Metric} & MSE & MAE & MSE & MAE & MSE & MAE & MSE & MAE & MSE & MAE & MSE & MAE & MSE & MAE & MSE & MAE & MSE & MAE \\ \hline \multirow{4}{*}{
\begin{tabular}{c} **Model** \\ **Metric** \\ \end{tabular} } & 6 & **0.110** & **0.132** & 0.127 0.143(0.121 0.138(0.121 0.142) & 0.127 0.152(0.121 0.139) & 0.132 0.178(0.126 0.159) & 0.157 0.168(0.149 0.167) & 0.121 0.138 \\  & 12 & **0.121** & **0.152** & 0.130 0.157(0.134 0.161) & 0.144 0.166(0.138 0.174(0.137) 0.162(0.143 0.189) & 0.143 0.186(0.161 0.187) & 0.164 0.192(0.136 0.163) \\  & 18 & **0.136** & **0.170** & 0.146 0.178(0.143 0.177) & 0.155 0.179(0.146 0.186(0.145 0.175) & 0.157 0.1271(0.1520) & 0.171 0.208(0.167 0.200(14.173) \\  & & Avg & **0.122** & **0.151** & 0.134 0.159(0.133 0.159(0.140) 0.162(0.137 0.171) & 0.134 0.159(0.144 0.195) & 0.140 0.184(0.163 0.188) & 0.160 0.186(0.133 0.158) \\ \hline \hline \end{tabular}
\end{table}
Table 16: Multivariate short-term forecasting results on Stock Market. We compare extensive competitive models under different prediction lengths. The input length is 2 times of the prediction length. _Avg_ means the average results from all three prediction lengths. The best results are in **bold**.

Figure 14: We conduct experiments with some typical cases of attention distributions. The synthetic data and experiment setups are as follows. **Setup (1) for globally uniform attention as shown in Case (a)**: The input consists of 4 semi-sinusoidal signals with noise. The task is to predict 1 semi-sinusoidal signal. Thus, the future data evenly relates to the historical data. The length of each signal is 96. So this is an input-384-predict-96 task. **Setup (2) for clustered attention as shown in Case (b) and (c)**: Simlilar to setup (1), but in the length-384 input, only 1 semi-sinusoidal signal is remained while others are masked as 0. Thus, the future data is related only to the local window of remained signal. Masks can be constant or varying across samples to simulate scenarios that the localized areas are constant or varying across samples. **Setup (3) for global but not uniform attention as shown in Case (d)**: This setup is similar to setup (2) but more semi-sinusoidal signals are remained, resulting in global attention distribution but not uniform.

Figure 15: The impact of patching on latest patch-based Transformer forecasters (PatchTST and CARD). After the removal of patching, the performance of PatchTST and CARD will decrease obviously and fell out of the good rankings, while our DeformableTST is robust to patching and maintains the consistent excellent performance, consistently ranked in the top-3. We conduct experiments under input-384-predict-96 settings. The rankings on each dataset are calculated from Table 9 of Appendix N.

Figure 16: Robustness of our DeformableTST to patch size under input-768 settings.

### NeurIPS Paper Checklist

1. **Claims** Question: Do the main claims made in the abstract and introduction accurately reflect the paper's contributions and scope? Answer: [Yes] Justification: Please refer to Section 1 and Abstract. Guidelines: * The answer NA means that the abstract and introduction do not include the claims made in the paper. * The abstract and/or introduction should clearly state the claims made, including the contributions made in the paper and important assumptions and limitations. A No or NA answer to this question will not be perceived well by the reviewers. * The claims made should match theoretical and experimental results, and reflect how much the results can be expected to generalize to other settings. * It is fine to include aspirational goals as motivation as long as it is clear that these goals are not attained by the paper.
2. **Limitations** Question: Does the paper discuss the limitations of the work performed by the authors? Answer: [Yes] Justification: Please refer to Appendix K. And model efficiency is provided in G. Guidelines: * The answer NA means that the paper has no limitation while the answer No means that the paper has limitations, but those are not discussed in the paper. * The authors are encouraged to create a separate "Limitations" section in their paper. * The paper should point out any strong assumptions and how robust the results are to violations of these assumptions (e.g., independence assumptions, noiseless settings, model well-specification, asymptotic approximations only holding locally). The authors should reflect on how these assumptions might be violated in practice and what the implications would be. * The authors should reflect on the scope of the claims made, e.g., if the approach was only tested on a few datasets or with a few runs. In general, empirical results often depend on implicit assumptions, which should be articulated. * The authors should reflect on the factors that influence the performance of the approach. For example, a facial recognition algorithm may perform poorly when image resolution is low or images are taken in low lighting. Or a speech-to-text system might not be used reliably to provide closed captions for online lectures because it fails to handle technical jargon. * The authors should discuss the computational efficiency of the proposed algorithms and how they scale with dataset size. * If applicable, the authors should discuss possible limitations of their approach to address problems of privacy and fairness. * While the authors might fear that complete honesty about limitations might be used by reviewers as grounds for rejection, a worse outcome might be that reviewers discover limitations that aren't acknowledged in the paper. The authors should use their best judgment and recognize that individual actions in favor of transparency play an important role in developing norms that preserve the integrity of the community. Reviewers will be specifically instructed to not penalize honesty concerning limitations.
3. **Theory Assumptions and Proofs** Question: For each theoretical result, does the paper provide the full set of assumptions and a complete (and correct) proof? Answer: [NA]Justification: The paper does not include theoretical results. Guidelines: * The answer NA means that the paper does not include theoretical results. * All the theorems, formulas, and proofs in the paper should be numbered and cross-referenced. * All assumptions should be clearly stated or referenced in the statement of any theorems. * The proofs can either appear in the main paper or the supplemental material, but if they appear in the supplemental material, the authors are encouraged to provide a short proof sketch to provide intuition. * Inversely, any informal proof provided in the core of the paper should be complemented by formal proofs provided in appendix or supplemental material. * Theorems and Lemmas that the proof relies upon should be properly referenced.
4. **Experimental Result Reproducibility** Question: Does the paper fully disclose all the information needed to reproduce the main experimental results of the paper to the extent that it affects the main claims and/or conclusions of the paper (regardless of whether the code and data are provided or not)? Answer: [Yes] Justification: Please refer to Section 3, Section 4, Appendix A and Appendix B. Guidelines: * The answer NA means that the paper does not include experiments. * If the paper includes experiments, a No answer to this question will not be perceived well by the reviewers: Making the paper reproducible is important, regardless of whether the code and data are provided or not. * If the contribution is a dataset and/or model, the authors should describe the steps taken to make their results reproducible or verifiable. * Depending on the contribution, reproducibility can be accomplished in various ways. For example, if the contribution is a novel architecture, describing the architecture fully might suffice, or if the contribution is a specific model and empirical evaluation, it may be necessary to either make it possible for others to replicate the model with the same dataset, or provide access to the model. In general. releasing code and data is often one good way to accomplish this, but reproducibility can also be provided via detailed instructions for how to replicate the results, access to a hosted model (e.g., in the case of a large language model), releasing of a model checkpoint, or other means that are appropriate to the research performed. * While NeurIPS does not require releasing code, the conference does require all submissions to provide some reasonable avenue for reproducibility, which may depend on the nature of the contribution. For example 1. If the contribution is primarily a new algorithm, the paper should make it clear how to reproduce that algorithm. 2. If the contribution is primarily a new model architecture, the paper should describe the architecture clearly and fully. 3. If the contribution is a new model (e.g., a large language model), then there should either be a way to access this model for reproducing the results or a way to reproduce the model (e.g., with an open-source dataset or instructions for how to construct the dataset). 4. We recognize that reproducibility may be tricky in some cases, in which case authors are welcome to describe the particular way they provide for reproducibility. In the case of closed-source models, it may be that access to the model is limited in some way (e.g., to registered users), but it should be possible for other researchers to have some path to reproducing or verifying the results.
5. **Open access to data and code** Question: Does the paper provide open access to the data and code, with sufficient instructions to faithfully reproduce the main experimental results, as described in supplemental material?Answer: [Yes] Justification: Code is available at this repository: https://github.com/luodhhh/DeformableTST. We provide the pseudo-code in Appendix C and add a Reproducibility Statement in Appendix M. We have already provided experimental details and model settings in Section 3, Section 4, Appendix A and Appendix B. And details about tensor shape and model structure are also included. Guidelines:

* The answer NA means that paper does not include experiments requiring code.
* Please see the NeurIPS code and data submission guidelines (https://nips.cc/public/guides/CodeSubmissionPolicy) for more details.
* While we encourage the release of code and data, we understand that this might not be possible, so "No" is an acceptable answer. Papers cannot be rejected simply for not including code, unless this is central to the contribution (e.g., for a new open-source benchmark).
* The instructions should contain the exact command and environment needed to run to reproduce the results. See the NeurIPS code and data submission guidelines (https://nips.cc/public/guides/CodeSubmissionPolicy) for more details.
* The authors should provide instructions on data access and preparation, including how to access the raw data, preprocessed data, intermediate data, and generated data, etc.
* The authors should provide scripts to reproduce all experimental results for the new proposed method and baselines. If only a subset of experiments are reproducible, they should state which ones are omitted from the script and why.
* At submission time, to preserve anonymity, the authors should release anonymized versions (if applicable).
* Providing as much information as possible in supplemental material (appended to the paper) is recommended, but including URLs to data and code is permitted.
6. **Experimental Setting/Details** Question: Does the paper specify all the training and test details (e.g., data splits, hyperparameters, how they were chosen, type of optimizer, etc.) necessary to understand the results? Answer: [Yes] Justification: We have already provided experimental details and model settings in Section 3, Section 4, Appendix A and Appendix B. Guidelines:

* The answer NA means that the paper does not include experiments.
* The experimental setting should be presented in the core of the paper to a level of detail that is necessary to appreciate the results and make sense of them.
* The full details can be provided either with the code, in appendix, or as supplemental material.
7. **Experiment Statistical Significance** Question: Does the paper report error bars suitably and correctly defined or other appropriate information about the statistical significance of the experiments? Answer: [Yes] Justification: Please refer to Appendix H. Guidelines:

* The answer NA means that the paper does not include experiments.
* The authors should answer "Yes" if the results are accompanied by error bars, confidence intervals, or statistical significance tests, at least for the experiments that support the main claims of the paper.
* The factors of variability that the error bars are capturing should be clearly stated (for example, train/test split, initialization, random drawing of some parameter, or overall run with given experimental conditions).

* The method for calculating the error bars should be explained (closed form formula, call to a library function, bootstrap, etc.)
* The assumptions made should be given (e.g., Normally distributed errors).
* It should be clear whether the error bar is the standard deviation or the standard error of the mean.
* It is OK to report 1-sigma error bars, but one should state it. The authors should preferably report a 2-sigma error bar than state that they have a 96% CI, if the hypothesis of Normality of errors is not verified.
* For asymmetric distributions, the authors should be careful not to show in tables or figures symmetric error bars that would yield results that are out of range (e.g. negative error rates).
* If error bars are reported in tables or plots, The authors should explain in the text how they were calculated and reference the corresponding figures or tables in the text.
8. **Experiments Compute Resources** Question: For each experiment, does the paper provide sufficient information on the computer resources (type of compute workers, memory, time of execution) needed to reproduce the experiments? Answer: [Yes] Justification: Please refer to Appendix B. Guidelines: * The answer NA means that the paper does not include experiments. * The paper should indicate the type of compute workers CPU or GPU, internal cluster, or cloud provider, including relevant memory and storage. * The paper should provide the amount of compute required for each of the individual experimental runs as well as estimate the total compute. * The paper should disclose whether the full research project required more compute than the experiments reported in the paper (e.g., preliminary or failed experiments that didn't make it into the paper).
9. **Code Of Ethics** Question: Does the research conducted in the paper conform, in every respect, with the NeurIPS Code of Ethics https://neurips.cc/public/EthicsGuidelines? Answer: [Yes] Justification: Please refer to Appendix L. Guidelines: * The answer NA means that the authors have not reviewed the NeurIPS Code of Ethics. * If the authors answer No, they should explain the special circumstances that require a deviation from the Code of Ethics. * The authors should make sure to preserve anonymity (e.g., if there is a special consideration due to laws or regulations in their jurisdiction).
10. **Broader Impacts** Question: Does the paper discuss both potential positive societal impacts and negative societal impacts of the work performed? Answer: [Yes] Justification: Please refer to Appendix L. Guidelines: * The answer NA means that there is no societal impact of the work performed. * If the authors answer NA or No, they should explain why their work has no societal impact or why the paper does not address societal impact. * Examples of negative societal impacts include potential malicious or unintended uses (e.g., disinformation, generating fake profiles, surveillance), fairness considerations (e.g., deployment of technologies that could make decisions that unfairly impact specific groups), privacy considerations, and security considerations.

* The conference expects that many papers will be foundational research and not tied to particular applications, let alone deployments. However, if there is a direct path to any negative applications, the authors should point it out. For example, it is legitimate to point out that an improvement in the quality of generative models could be used to generate deepfakes for disinformation. On the other hand, it is not needed to point out that a generic algorithm for optimizing neural networks could enable people to train models that generate Deepfakes faster.
* The authors should consider possible harms that could arise when the technology is being used as intended and functioning correctly, harms that could arise when the technology is being used as intended but gives incorrect results, and harms following from (intentional or unintentional) misuse of the technology.
* If there are negative societal impacts, the authors could also discuss possible mitigation strategies (e.g., gated release of models, providing defenses in addition to attacks, mechanisms for monitoring misuse, mechanisms to monitor how a system learns from feedback over time, improving the efficiency and accessibility of ML).
11. **Safeguards** Question: Does the paper describe safeguards that have been put in place for responsible release of data or models that have a high risk for misuse (e.g., pretrained language models, image generators, or scraped datasets)? Answer: [NA] Justification: The paper poses no such risks. Guidelines: * The answer NA means that the paper poses no such risks. * Released models that have a high risk for misuse or dual-use should be released with necessary safeguards to allow for controlled use of the model, for example by requiring that users adhere to usage guidelines or restrictions to access the model or implementing safety filters. * Datasets that have been scraped from the Internet could pose safety risks. The authors should describe how they avoided releasing unsafe images. * We recognize that providing effective safeguards is challenging, and many papers do not require this, but we encourage authors to take this into account and make a best faith effort.
12. **Licenses for existing assets** Question: Are the creators or original owners of assets (e.g., code, data, models), used in the paper, properly credited and are the license and terms of use explicitly mentioned and properly respected? Answer: [Yes] Justification: The code packages, baseline models and datasets used in this paper are publicly available and properly credited. Please refer to Section 4, Appendix A, Appendix B and the Reference. The baseline models are mostly using Apache-2.0 license and MIT license. The datasets we used are all extensively utilized for benchmarking and publicly available. We provide the URLs for the datasets in Appendix A. Guidelines: * The answer NA means that the paper does not use existing assets. * The authors should cite the original paper that produced the code package or dataset. * The authors should state which version of the asset is used and, if possible, include a URL. * The name of the license (e.g., CC-BY 4.0) should be included for each asset. * For scraped data from a particular source (e.g., website), the copyright and terms of service of that source should be provided. * If assets are released, the license, copyright information, and terms of use in the package should be provided. For popular datasets, paperswithcode.com/datasets has curated licenses for some datasets. Their licensing guide can help determine the license of a dataset.

* For existing datasets that are re-packaged, both the original license and the license of the derived asset (if it has changed) should be provided.
* If this information is not available online, the authors are encouraged to reach out to the asset's creators.
* **New Assets*
* Question: Are new assets introduced in the paper well documented and is the documentation provided alongside the assets? Answer: [Yes] Justification: Please refer to Section 3, Section 4, Appendix A, Appendix B and Appendix K. Code with detailed documentation is available at this repository: https://github.com/luodhhh/DeformableTST.. Guidelines:
* The answer NA means that the paper does not release new assets.
* Researchers should communicate the details of the dataset/code/model as part of their submissions via structured templates. This includes details about training, license, limitations, etc.
* The paper should discuss whether and how consent was obtained from people whose asset is used.
* At submission time, remember to anonymize your assets (if applicable). You can either create an anonymized URL or include an anonymized zip file.
* **Crowdsourcing and Research with Human Subjects*
* Question: For crowdsourcing experiments and research with human subjects, does the paper include the full text of instructions given to participants and screenshots, if applicable, as well as details about compensation (if any)? Answer: [NA] Justification: The paper does not involve crowdsourcing nor research with human subjects. Guidelines:
* The answer NA means that the paper does not involve crowdsourcing nor research with human subjects.
* Including this information in the supplemental material is fine, but if the main contribution of the paper involves human subjects, then as much detail as possible should be included in the main paper.
* According to the NeurIPS Code of Ethics, workers involved in data collection, curation, or other labor should be paid at least the minimum wage in the country of the data collector.
* **Institutional Review Board (IRB) Approvals or Equivalent for Research with Human Subjects*
* Question: Does the paper describe potential risks incurred by study participants, whether such risks were disclosed to the subjects, and whether Institutional Review Board (IRB) approvals (or an equivalent approval/review based on the requirements of your country or institution) were obtained? Answer: [NA] Justification: The paper does not involve crowdsourcing nor research with human subjects. Guidelines:
* The answer NA means that the paper does not involve crowdsourcing nor research with human subjects.
* Depending on the country in which research is conducted, IRB approval (or equivalent) may be required for any human subjects research. If you obtained IRB approval, you should clearly state this in the paper.
* We recognize that the procedures for this may vary significantly between institutions and locations, and we expect authors to adhere to the NeurIPS Code of Ethics and the guidelines for their institution.
* For initial submissions, do not include any information that would break anonymity (if applicable), such as the institution conducting the review.