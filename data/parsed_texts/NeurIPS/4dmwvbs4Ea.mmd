# Offline RL via Feature-Occupancy Gradient Ascent

Anonymous Author(s)

Affiliation

Address

email

###### Abstract

We study offline Reinforcement Learning in large infinite-horizon discounted Markov Decision Processes (MDPs) when the reward and transition models are linearly realizable under a known feature map. Starting from the classic linear-program formulation of the optimal control problem in MDPs, we develop a new algorithm that performs a form of gradient ascent in the space of feature occupancies, defined as the expected feature vectors that can potentially be generated by executing policies in the environment. We show that the resulting simple algorithm satisfies strong computational and sample complexity guarantees, achieved under the least restrictive data coverage assumptions known in the literature. In particular, we show that the sample complexity of our method scales optimally with the desired accuracy level and depends on a weak notion of coverage that only requires the empirical feature covariance matrix to cover a single direction in the feature space (as opposed to covering a full subspace). Additionally, our method is easy to implement and requires no prior knowledge of the coverage ratio (or even an upper bound on it), which altogether make it the strongest known algorithm for this setting to date.

## 1 Introduction

We study Offline Reinforcement Learning (ORL) in sequential decision making problems whereby a learner aims to find a near-optimal policy with sole access to a static dataset of interactions with the underlying environment (Levine et al., 2020). This line of work is naturally relevant to real-world tasks for which learning an accurate simulator of the environment is potentially intractable or impossible, trial-and-error learning could have grave consequences, yet logged interaction data is readily available. For example, in a high-stake application such as autonomous driving, building a sufficiently accurate simulator for the vehicle and its environment would require modelling very complex systems, which can be intractable both statistically and computationally. At the same time, running experiments in the real world could endanger the lives of other road users or result in damages to the vehicle. Yet, with the advent of tools for efficient sensory-data collection and processing, large volumes of logged data from human drivers are readily available.

An efficient ORL method is one which finds a near-optimal policy after a tractable number of elementary computations and samples from the dataset. It is well-known in this setting that the quality of the solution has to heavily depend on the quality of the data, and in particular one cannot hope to find a near-optimal policy if the data covers the space of states and actions poorly. To formalize this intuition, many notions of data coverage have been proposed in the offline RL literature, ranging from a very restrictive uniform coverage assumption that requires the data-generating policy to cover the entire state-action space (Munos and Szepesvari, 2008) to a variety of partial coverage conditions whereby this exploratory condition is only required for state-action pairs that are of interest to the optimal policy (Liu et al., 2020; Rashidinejad et al., 2021; Uehara and Sun, 2021; Zhan et al., 2022; Rashidinejad et al., 2022; Li et al., 2024). In the present work, we study the setting of linear _MarkovDecision Processes_ (MDPs) (Jin et al., 2020; Yang and Wang, 2019) where the reward and transition matrix admit a low rank structure in terms of a known feature map, and data-coverage assumptions can be defined in the space of features. As shown by (Zanette et al., 2021), in this setting it is possible to obtain strong guarantees if the offline data is well-aligned with the expectation of the feature vector generated by the optimal policy (as opposed to requiring alignment with the entire distribution of features as required by other common offline RL methods (Jin et al., 2021; Xie et al., 2021; Uehara and Sun, 2021; Zhang et al., 2022)). In the present paper, we propose a simple and efficient algorithm that yields the best known sample complexity guarantees for this problem setting, all while only requiring the weakest known data-coverage assumptions of Zanette et al. (2021).

Our approach is based on the LP formulation of optimal control in infinite-horizon discounted MDPs due to Manne (1960), and more specifically on its low-dimensional saddle-point reparametrization for linear MDPs proposed by Gabbianelli et al. (2024) (which itself builds on earlier work by Neu and Okolo, 2023; Bas-Serrano et al., 2021). Primal variables of this saddle-point objective correspond to expectations of feature vectors under the state-action distribution of each policy (called _feature occupancies_), and dual variables correspond to parameters of linear approximations of action-value functions. We design an algorithm based on the idea of optimizing the unconstrained primal function that is derived from the saddle-point objective by eliminating the dual variables via a classic dualization trick. More precisely, we design a sample-based estimator of the primal function and optimize it via a variant of gradient ascent in the space of feature occupancies.

This approach is to be contrasted with the method of Gabbianelli et al. (2024), which instead optimized the original saddle-point objective via stochastic primal-dual methods. Their algorithm interleaved a sequence of "policy improvement" steps with an inner loop performing "policy evaluation", which resulted in a suboptimal use of sample transitions due to the costly inner loop. This issue was addressed in the very recent work of Hong and Tewari (2024) who, instead of relying on stochastic optimization, built an estimator of the saddle-point objective and optimized it via a deterministic primal-dual method. Our approach is directly inspired by their idea of estimating the saddle-point objective, but our algorithm design is significantly simpler: instead of directly optimizing the primal function in terms of feature occupancies, Hong and Tewari (2024) relied on a sophisticated reparametrization of the primal variables, and used a computationally involved procedure to update the dual variables. Both of these steps required prior knowledge of a tight bound on the feature-coverage ratio of the optimal policy, which is typically not available in problems of practical interest. Such knowledge is not required by our algorithm, thanks to the incorporation of a recently proposed stabilization trick that we make use of in our algorithm (Jacobsen and Cutkosky, 2023; Neu and Okolo, 2024). We provide a more detailed discussion of these closely related works in Section 5.

Notation.We use boldface lowercase letters \(\bm{m}\) to denote vectors and bold uppercase \(\bm{M}\) for matrices. We define the Euclidean ball in \(\mathbb{R}^{d}\) of radius \(D\) by \(\mathbb{B}_{d}(D)=\{\bm{x}\in\mathbb{R}^{d}|\left\|\bm{x}\right\|_{2}\leq D\}\) and the \(A\)-simplex over a finite set \(\mathcal{A}\) of cardinality \(A\) as \(\Delta_{\mathcal{A}}=\{p\in\mathbb{R}_{+}^{A}|\left\|p\right\|_{1}=1\}\).

## 2 Preliminaries

We consider infinite-horizon Discounted Markov Decision Processes (DMDPs) (Puterman, 1994) of the form \((\mathcal{X},\mathcal{A},\bm{r},\bm{P},\gamma)\) where \(\mathcal{X}\) denotes a finite (yet large) set of \(X\) states and \(\mathcal{A}\) is a finite action space of cardinality \(A=|\mathcal{A}|\). We refer to \(\bm{r}\in[0,1]^{XA}\) as the reward vector, \(\bm{P}\in\mathbb{R}_{+}^{XA\times X}\) the transition matrix and \(\gamma\in(0,1)\) the discount factor. For a state-action pair \((x,a)\in\mathcal{X}\times\mathcal{A}\) we also use the notation \(r\left(x,a\right)=\bm{r}[(x,a)]\) to denote the reward of taking action \(a\) in state \(x\) and \(p\left(x^{\prime}|x,a\right)=\bm{P}[(x,a)\,,x^{\prime}]\) as the probability of ending up in state \(x^{\prime}\) afterwards.

The MDP models a sequential decision making process where an agent interacts with its environment as follows. For each step \(k=0,1,2,\cdots\), the agent observes the current state \(X_{k}\) of the environment and then goes on to select its action \(A_{k}\). Based on this action in the current state, it receives a reward \(r\left(X_{k},A_{k}\right)\), transits to a new state \(X_{k+1}\sim\bm{p}\left(\cdot|X_{k},A_{k}\right)\) and the process continues. The objective of the agent is to find a decision-making rule that maximizes its total discounted reward when the initial state \(X_{0}\) is sampled according to a fixed initial-state distribution distribution \(\bm{\nu}_{0}\in\Delta_{\mathcal{X}}\). Without loss of generality, we assume that the initial state is fixed almost surely as \(X_{0}=x_{0}\), and use \(\bm{\nu}_{0}\) to refer to the corresponding delta distribution. It is known that this objective can be achieved by executing a _stationary stochastic policy_\(\pi:\mathcal{X}\rightarrow\Delta_{\mathcal{A}}\), with \(\pi(a|x)\) denoting the probability of the agent selecting action \(A_{k}=a\) in state \(X_{k}=x\) for all \(k\). We will use \(\Pi\) to denote the set of all such behavior rulesand will often simply call them _policies_. We define the normalized discounted return of each policy \(\pi\) as

\[\rho\left(\pi\right)=\left(1-\gamma\right)\mathbb{E}_{\bm{\nu}_{0},\pi}\left[ \sum_{k=0}^{\infty}\gamma^{k}r\left(x_{k},a_{k}\right)\right],\]

where the role of the discount factor \(\gamma\in\left(0,1\right)\) is to emphasize the importance of earlier rewards, and the notation \(\mathbb{E}_{\bm{\nu}_{0},\pi}\left[\cdot\right]\) highlights that the initial state is sampled from \(\nu_{0}\) and all actions are sampled according to the policy \(\pi\). We will use \(\pi^{*}\) to denote any policy that maximizes the return.

We will consider the offline RL setting where we are given access to a data set of \(n\) sample transitions \(\mathcal{D}_{n}=\{(X_{i},A_{i},R_{i},X_{i}^{\prime})\}_{i=1}^{n}\), where \(X_{i}^{\prime}\sim\bm{p}(\cdot|X_{i},A_{i})\) is sampled independently for each \(i\) and \(R_{i}=r(X_{i},A_{i})\). Otherwise, no assumption is made about the state-action pairs \((X_{i},A_{i})\), and in particular we do not require these to be generated by a fixed behavior policy or to be independent of each other.

For describing the approach we take towards solving this problem, we need to introduce some further standard notations. The value function and action-value function associated with policy \(\pi\) are respectively defined as

\[v^{\pi}\left(x\right)=\mathbb{E}_{a\sim\pi\left(\cdot|x\right)}\left[q^{\pi} \left(x,a\right)\right],\quad q^{\pi}\left(x,a\right)=\mathbb{E}_{\pi}\left[ \sum_{k=0}^{\infty}\gamma^{k}r\left(x_{k},a_{k}\right)\right|x_{0}=x,a_{0}=a \right],\]

and the state-occupancy and state-action-occupancy measures under \(\pi\) as

\[\nu^{\pi}\left(x\right)=\sum_{a}\mu^{\pi}\left(x,a\right),\quad\mu^{\pi} \left(x,a\right)=\left(1-\gamma\right)\mathbb{E}_{\bm{\nu}_{0},\pi}\left[\sum_ {k=0}^{\infty}\gamma^{k}\mathbb{E}_{\{x_{k},a_{k}\}}\right].\]

The value functions and occupancy measures adhere to the following recursive equations, respectively termed the Bellman equation and Bellman flow condition (Bellman, 1966):

\[\bm{q}^{\pi}=\bm{r}+\gamma\bm{P}\bm{v}^{\pi},\qquad\bm{\mu}^{\pi}=\pi\circ[ \left(1-\gamma\right)\bm{\nu}_{0}+\gamma\bm{P}^{\intercal}\bm{\mu}^{\pi}].\]

Here, the composition operation \(\circ\) is defined so that for any policy \(\pi\) and state distribution \(\bm{\nu}\in\mathbb{R}^{X}\), we have \(\left(\pi\circ\bm{\nu}\right)\left(x,a\right)=\pi\left(a|x\right)\nu\left(x\right)\). Notice that we can express the return of \(\pi\) in terms of value functions and occupancy measures as \(\rho\left(\pi\right)=\left(1-\gamma\right)\left\langle\bm{\nu}_{0},\bm{v}^{ \pi}\right\rangle=\left\langle\bm{\mu}^{\pi},\bm{r}\right\rangle\). On this note, for a given target accuracy \(\varepsilon>0\), we say policy \(\pi\) is \(\varepsilon\)-optimal if it satisfies \(\left\langle\bm{\mu}^{\pi^{*}}\right.-\bm{\mu}^{\pi},\bm{r}\right\rangle\leq\varepsilon\).

In the present work, we well make use of the _linear MDP_ assumption due to Jin et al. (2020); Yang and Wang (2019), which is defined formally as follows:

**Definition 2.1** (Linear MDP).: An MDP is called linear if both the transition and reward functions can be expressed as a linear function of a given feature map \(\bm{\varphi}:\mathcal{X}\times\mathcal{A}\to\mathbb{R}^{d}\). That is, there exist \(\bm{\psi}:\mathcal{X}\to\mathbb{R}^{d}\) and \(\bm{\omega}\in\mathbb{R}^{d}\) such that, for every \(x,x^{\prime}\in\mathcal{X}\) and \(a\in\mathcal{A}\):

\[r(x,a)=\left\langle\bm{\varphi}(x,a),\bm{\omega}\right\rangle,\quad p\left(x^{ \prime}|x,a\right)=\left\langle\bm{\varphi}(x,a),\bm{\psi}(x^{\prime})\right\rangle.\]

We denote by \(\bm{\Phi}\in\mathbb{R}^{|\mathcal{X}\times\mathcal{A}|\times d}\) the feature matrix with rows given by \(\bm{\varphi}(x,a)^{\intercal}\) and \(\bm{\Psi}\in\mathbb{R}^{d\times|\mathcal{X}|}\) as the weight matrix with columns \(\bm{\psi}(x)\). Further, we will assume that \(\left\|\bm{\omega}\right\|_{2}\leq\sqrt{d}\), that \(\left\|\bm{\Psi}\bm{\upsilon}\right\|_{2}\leq B\sqrt{d}\) holds for all \(\bm{v}\in[-B,B]\), and that all feature vectors satisfy \(\left\|\bm{\varphi}(x,a)\right\|_{2}\leq R\) for some \(R\geq 1\).

An immediate consequence of this assumption is that the action-value function of any policy \(\pi\) can be written as a linear function of the features as \(\bm{q}^{\pi}=\bm{\Phi}\bm{\theta}^{\pi}\), with \(\bm{\theta}^{\pi}=\bm{\omega}+\gamma\bm{\Psi}\bm{v}^{\pi}\in\mathbb{R}^{d}\). For the rest of the paper we explicitly assume that the feature matrix \(\bm{\Phi}\) is full rank - which is enough to ensure uniqueness of \(\bm{\theta}^{\pi}\). It is common to assume that the feature dimension \(d\ll X\) such that the transition operator is low-rank. As common in this setting, we will suppose throughout the paper that the feature map \(\bm{\Phi}\) is known.

Our algorithm design will be based on the linear programming formulation of MDPs, first proposed in a number of papers in the 1960's (Manne, 1960; de Ghellinck, 1960; d'Epenoux, 1963; Denardo, 1970). This formulation frames the problem of finding an optimal control policy as the following pair of primal and dual linear programs:

\[\begin{array}{ll}\operatorname{maximize}&\left\langle\bm{\mu},\bm{r}\right\rangle \\ \operatorname{subject\;to}&\bm{E}^{\intercal}\bm{\mu}=\left(1-\gamma\right)\bm{ \nu}_{0}+\gamma\bm{P}^{\intercal}\bm{\mu}&\text{(1)}\\ &\bm{\mu}\geq 0,\end{array}\qquad\begin{array}{ll}\operatorname{minimize}&\left(1- \gamma\right)\langle\bm{\nu}_{0},\bm{v}\rangle\\ &\operatorname{subject\;to}&\bm{E}\bm{v}\geq\bm{r}+\gamma\bm{P}\bm{v}.\end{array}\] (2)

[MISSING_PAGE_FAIL:4]

Feature-occupancy gradient ascent for offline RL in linear MDPs

A natural idea for developing RL methods is to build an empirical approximation of the function \(f\) defined in the previous section, and use primal-dual methods to find a saddle-point of the resulting approximation. For offline RL, this approach has been explored by Gabbianelli et al. (2024) and Hong and Tewari (2024). In this work, we develop an alternative approach that seeks to directly optimize the return by approximately maximizing the unconstrained primal function \(f^{*}:\mathbb{R}^{d}\times\Pi\), defined for each feature-occupancy vector \(\bm{\lambda}\) and policy \(\pi\) as

\[f^{*}(\bm{\lambda},\pi)=\min_{\bm{\theta}\in\mathbb{B}_{d}(D_{\bm{\theta}})}f( \bm{\lambda},\pi;\bm{\theta}),\]

for an appropriately chosen feasible set \(\mathbb{B}_{d}(D_{\bm{\theta}})\). Given the discussion in the previous section, maximizing this function with respect to \(\bm{\lambda}\) and \(\pi\) is rightly expected to result in an optimal policy (which intuition will be made formal in our analysis). Notably, the so-called objective \(f\) in Equation (7) depends on the transition weight matrix \(\bm{\Psi}\) which is unknown in general. As we soon show, this matrix dominates the loss of the \(\bm{\theta}\)-player and \(\bm{\lambda}\)-player. Based on these observations, our approach consists of building a well-chosen estimator \(\widehat{f}\) of \(f\), and then maximizing the associated primal function \(\widehat{f}^{*}\) defined as

\[\widehat{f}^{*}(\bm{\lambda},\pi)=\min_{\bm{\theta}\in\mathbb{B}_{d}(D_{\bm{ \theta}})}\widehat{f}(\bm{\lambda};\bm{\theta},\pi).\]

The objective \(\widehat{f}\) is built via a least-squares estimator inspired by the classic LSTD model estimate of Bradtke and Barto (1996); Parr et al. (2008), which has been successfully used for analyzing finite-horizon linear MDPs in a variety of recent works (e.g., Jin et al., 2020; Neu and Pike-Burke, 2020). In particular, we fit an estimator \(\widehat{\bm{\Psi}}\) of the true matrix \(\bm{\Psi}\) using samples from the dataset \(\mathcal{D}_{n}=\{(X_{i},A_{i},R_{i},X_{i}^{\prime})\}_{i=1}^{n}\) as follows. Let \(\bm{\varphi}_{i}=\bm{\varphi}(X_{i},A_{i})\) denote the feature vector of \((X_{i},A_{i})\) and \(\bm{\Lambda}_{n}=\beta\bm{I}_{n}+\frac{1}{n}\sum_{i=1}^{n}\bm{\varphi}_{i}\bm {\varphi}_{i}^{\intercal}\) the empirical feature covariance matrix. We define the regularized least squares estimate of \(\bm{\Psi}\) at \(x\in\mathcal{X}\) as

\[\widehat{\bm{\psi}}\left(x\right)=\underset{\bm{\psi}(x)\in\mathbb{R}^{d}}{ \text{arg min}}\frac{1}{n}\sum_{i=1}^{n}\left(\langle\bm{\varphi}_{i},\bm{\psi} \left(x\right)\rangle-\mathbb{I}_{\left\{x=X_{i}^{\prime}\right\}}\right)^{2}+ \beta\left\|\bm{\psi}\left(x\right)\right\|_{2}^{2},\]

so that the estimate can be written as

\[\widehat{\bm{\Psi}}=\sum_{x\in\mathcal{X}}\widehat{\bm{\psi}}(x)\bm{e}_{x}^{ \intercal}=\frac{1}{n}\bm{\Lambda}_{n}^{-1}\sum_{i=1}^{n}\bm{\varphi}_{i}\bm{e }_{X_{i}^{\prime}}^{\intercal}.\] (8)

With this matrix at hand, we define \(\widehat{f}\) as

\[\widehat{f}(\bm{\lambda},\pi;\bm{\theta})=(1-\gamma)\langle\bm{\nu}_{0},\bm{ \nu}_{\bm{\theta},\pi}\rangle+\langle\bm{\lambda},\bm{\omega}+\gamma\widehat{ \bm{\Psi}}\bm{\nu}_{\bm{\theta},\pi}-\bm{\theta}\rangle=\langle\bm{\lambda}, \bm{\omega}\rangle+\langle\bm{\theta},\bm{\Phi}^{\intercal}\widehat{\bm{\mu}}_ {\bm{\lambda},\pi}-\bm{\lambda}\rangle,\]

where \(\widehat{\bm{\mu}}_{\bm{\lambda},\pi}(x,a)=\pi(a|x)\Big{[}(1-\gamma)\nu_{0}(x )+\gamma\langle\widehat{\bm{\psi}}(x),\bm{\lambda}\rangle\Big{]}\) is a sample-based approximation of \(\mu_{\bm{\lambda},\pi}\).

For the purpose of optimization, we will employ appropriately chosen versions of mirror ascent (Nemirovski and Yudin, 1983; Beck and Teboulle, 2003) to iteratively optimize the primal variables. Denoting the iterates for each \(t=1,2,\ldots,T\) by \(\bm{\lambda}_{t}\) and \(\pi_{t}\), and defining \(\theta_{t}=\arg\min_{\bm{\theta}\in\mathbb{B}_{d}(D_{\bm{\theta}})}\widehat{f}( \bm{\lambda}_{t},\pi_{t};\bm{\theta})\), the updates are defined as follows. Using \(\bm{g}_{\bm{\lambda}}(t)=\nabla_{\bm{\lambda}_{t}}\widehat{f}^{*}(\bm{\lambda}_ {t},\pi_{t})\) to denote the gradient of \(\widehat{f}^{*}\) with respect to the feature occupancies, the first set of variables is updated as

\[\bm{\lambda}_{t+1}=\underset{\bm{\lambda}\in\mathbb{R}^{d}}{\text{arg max}}\Big{\{}\langle\bm{\lambda},\bm{g}_{\bm{\lambda}}(t)\rangle-\frac{1}{2\eta} \left\|\bm{\lambda}-\bm{\lambda}_{t}\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}-\frac{ \varrho}{2}\left\|\bm{\lambda}\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}\Big{\}},\] (9)

where the first regularization term acts as proximal regularization (necessary for mirror-ascent-style methods), and the second one has a stabilization effect whose role will be made clear later in the analysis. The resulting update can be written in closed form, and is equivalent to a preconditioned gradient-ascent step on \(\widehat{f}^{*}\). The policies are updated in each state-action pair \(x,a\) as

\[\pi_{t+1}(a|x)=\frac{\pi_{t}(a|x)e^{\alpha\langle\varphi(x,a),\bm{\theta}_{t} \rangle}}{\sum_{a^{\prime}}\pi_{t}(a^{\prime}|x)e^{\alpha\langle\varphi(x,a^{ \prime}),\bm{\theta}_{t}\rangle}}=\frac{\pi_{1}(a|x)e^{\alpha\left\langle \varphi(x,a),\sum_{k=1}^{t}\bm{\theta}_{k}\right\rangle}}{\sum_{a^{\prime}}\pi_{ 1}(a^{\prime}|x)e^{\alpha\left\langle\varphi(x,a^{\prime}),\sum_{k=1}^{t}\bm{ \theta}_{k}\right\rangle}},\]corresponding to performing an entropy-regularized mirror ascent step in each state \(x\) (cf. Neu et al., 2017). We use the shorthand notation \(\pi_{t+1}=\sigma\big{(}\alpha\Phi\sum_{k=1}^{t}\bm{\theta}_{k}\big{)}\) to denote the resulting softmax policy, and note that it is fully specified by a \(d\)-dimensional vector that can be stored compactly. After the final iterate is computed, the algorithm picks the index \(J\) uniformly at random and outputs the policy \(\pi_{J}\). We refer to the resulting algorithm as _Feature-Occupancy Gradient AScent_ (FOGAS), and present its detailed pseudocode featuring the explicit expressions of \(\bm{\lambda}_{t}\) and \(\bm{\theta}_{t}\) as Algorithm 1.

``` Input: Learning rates \(\alpha,\varrho,\eta\), initial points \(\bm{\lambda}_{1}\in\mathbb{R}^{d},\pi_{1}\in\Pi\left(D_{\pi}\right),\bar{\bm{ \theta}}_{0}=\bm{0}\), and dataset \(\mathcal{D}_{n}\). for\(t=1\)to\(T\)do  // Value-parameter update  Compute \(\bm{\Phi}^{\top}\widehat{\bm{\mu}}_{\bm{\lambda}_{t},\pi_{t}}=(1-\gamma)\sum_ {a}\pi_{t}(a|x_{0})\bm{\varphi}(x_{0},a)+\gamma\frac{1}{n}\sum_{i=1}^{n}\sum_{ a}\pi_{t}(a|X_{i}^{\prime})\bm{\varphi}(X_{i}^{\prime},a)\left\langle\bm{ \varphi}_{i},\bm{\Lambda}_{n}^{-1}\bm{\lambda}_{t}\right\rangle\) \(\bm{\theta}_{t}=\text{ arg min}_{\bm{\theta}\in\mathbb{B}_{d}(D_{\theta})} \langle\bm{\theta},\bm{\Phi}^{\top}\widehat{\bm{\mu}}_{\bm{\lambda}_{t},\pi_{ t}}-\bm{\lambda}_{t}\rangle\) // Policy update  Update \(\bar{\bm{\theta}}_{t}=\bar{\bm{\theta}}_{t-1}+\bm{\theta}_{t}\) \(\pi_{t+1}=\sigma\left(\alpha\Phi\bar{\bm{\theta}}_{t}\right)\) // Feature-occupancy update  Compute \(\widehat{\bm{\Psi}}\bm{v}_{\bm{\theta}_{t},\pi_{t}}=\frac{1}{n}\bm{\Lambda}_{ n}^{-1}\sum_{i=1}^{n}\bm{\varphi}_{i}\bm{v}_{\bm{\theta}_{t},\pi_{t}}(X_{i}^{\prime})\)  Compute \(\bm{g}_{\bm{\lambda}}(t)=\bm{\omega}+\gamma\widehat{\bm{\Psi}}\bm{v}_{\bm{ \theta}_{t},\pi_{t}}-\bm{\theta}_{t}\) \(\bm{\lambda}_{t+1}=\frac{1}{1+e\eta}\left(\bm{\lambda}_{t}+\eta\bm{\Lambda}_{ n}\bm{g}_{\bm{\lambda}}(t)\right)\) endfor return\(\pi_{J}\) with \(J\sim\mathcal{U}(1,\cdots,T)\). ```

**Algorithm 1** Feature-Occupancy Gradient Ascent (FOGAS)

The following theorem states our main result regarding the performance of FOGAS.

**Theorem 3.1**.: _Let \(\pi_{1}\) be the uniform policy and \(\bm{\lambda}_{1}=\bm{0}\). Also set \(D_{\bm{\theta}}=\sqrt{d}/\left(1-\gamma\right)\), \(D_{\pi}=\alpha TD_{\bm{\theta}}\) and \(\delta>0\). Suppose that we run FOGAS for \(T\geq\frac{2R^{2}n\log A}{\log\left(1/\delta\right)}\) rounds with parameters \(\beta=R^{2}/dT\) as well as_

\[\alpha=\sqrt{\frac{2\left(1-\gamma\right)^{2}\log A}{R^{2}dT}},\ \ \ \varrho=\gamma\sqrt{\frac{320d^{2}\log\left(2T/\delta\right)}{\left(1-\gamma \right)^{2}n}},\ \ \ \eta=\sqrt{\frac{\left(1-\gamma\right)^{2}}{2T^{2}R^{2}d^{2}T}}.\]

_Then, with probability at least \(1-\delta\), the following bound is satisfied for any comparator policy \(\pi^{*}\) and the associated feature-occupancy vector \(\bm{\lambda}^{\pi^{*}}=\Phi^{\top}\bm{\mu}^{\pi^{*}}\):_

\[\mathbb{E}_{J}\left[\left\langle\bm{\mu}^{\pi^{*}}-\bm{\mu}^{\pi_{J}},\bm{r} \right\rangle\right]=\mathcal{O}\left(\frac{\left\|\bm{\lambda}^{\pi^{*}} \right\|_{\bm{\Lambda}_{n}^{-1}}^{2}+1}{1-\gamma}\cdot\sqrt{\frac{d^{2}\log \left(2T/\delta\right)}{n}}\right),\]

_with the expectation taken with respect to the random index \(J\)._

The most important factor in the bound of Theorem 3.1 is \(\left\|\bm{\lambda}^{*}\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}\), which measures the extent to which the data \(\mathcal{D}_{n}\) covers the comparator policy \(\pi^{*}\) in feature space. We accordingly refer to this quantity as the _feature coverage ratio_ between the policy \(\pi^{*}\) and the data set \(\mathcal{D}_{n}\), and we discuss its relationship with other notions of data coverage in Section 5. Notably, the bound holds simultaneously for all comparator policies \(\pi^{*}\), and thus it can be restated in an oracle-inequality form. On the same note, FOGAS does not need any prior upper bounds on the comparator norm \(\left\|\bm{\lambda}^{*}\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}\), and in particular it does not project the iterates \(\bm{\lambda}_{t}\) to a bounded set. These nontrivial properties are enabled by a recently proposed stabilization trick due to Jacobsen and Cutkosky (2023) and Neu and Okolo (2024), which amounts to augmenting the standard mirror-ascent update of Equation (9) with the regularization term \(\frac{\varrho}{2}\left\|\bm{\lambda}\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}\). Without this additional regularization, the bounds would feature an additional factor of the order \(\frac{1}{T}\sum_{t=1}^{T}\left\|\bm{\lambda}_{t}\right\|_{\bm{\Lambda}_{n}^{-1}}^ {2}\), which cannot be controlled without projecting the iterates and in any case make it impossible to prove a comparator-adaptive bound. We defer further discussion of the result to Section 5.

Analysis

This section is dedicated to proving our main result, Theorem 3.1. While we have defined \(\mathtt{FOGAS}\) as a "primal-only" algorithm above, its analysis will be most convenient if we regard it as a primal-dual algorithm with implicitly defined dual updates. In particular, we will view the updates of \(\mathtt{FOGAS}\) as a sequence of steps in a zero sum game between two teams of players: the _max players_ that control \(\bm{\lambda}_{t}\) and \(\pi_{t}\), and the _min player_ that picks \(\bm{\theta}_{t}\). The min player uses the simple _best-response_ strategy of picking \(\bm{\theta}_{t}=\text{ arg min}_{\bm{\theta}\in\mathbb{B}_{d}(D_{\bm{\theta}})} \widehat{f}(\bm{\lambda},\pi_{t})\), and the other two players perform their updates via appropriate versions mirror ascent on their respective objectives. Importantly, the updates of the \(\bm{\lambda}\)-player are based on the gradients of \(\widehat{f}^{*}\), which satisfy

\[\bm{g}_{\bm{\lambda}}(t)=\nabla_{\bm{\lambda}_{t}}\widehat{f}^{*}(\bm{ \lambda}_{t},\pi_{t})=\nabla_{\bm{\lambda}_{t}}\left(\min_{\theta\in\mathbb{B} _{d}(D_{\bm{\theta}})}\widehat{f}(\bm{\lambda}_{t},\pi_{t};\bm{\theta})\right) =\nabla_{\bm{\lambda}_{t}}\widehat{f}(\bm{\lambda}_{t},\pi_{t};\bm{\theta}_{t }),\]

where the last equality follows from an application of Danskin's theorem. This property enables a major conceptual simplification that allows the interpretation of the updates as optimizing the unconstrained primal \(\widehat{f}^{*}\) directly. We refer the interested reader to Chapter 6 of Bertsekas (1997) for more context on such use of primal-dual analysis.

More concretely, we make use of an analysis technique first developed by Neu and Okolo (2023), and further refined by Gabbianelli et al. (2024) and Hong and Tewari (2024). The core idea is to introduce the _dynamic duality gap_ defined on a sequence of iterates \(\{(\bm{\lambda}_{t},\pi_{t},\bm{\theta}_{t})\}_{t=1}^{T}\) produced by some iterative method, and a set of well-chosen _comparators_\(\left(\bm{\lambda}^{*},\pi^{*};\{\bm{\theta}_{t}^{*}\}_{t=1}^{T}\right)\) as

\[\mathfrak{G}_{T}\left(\bm{\lambda}^{*},\pi^{*};\{\bm{\theta}_{t}^{*}\}_{t=1}^{ T}\right)=\frac{1}{T}\sum_{t=1}^{T}\left(f(\bm{\lambda}^{*},\pi^{*};\bm{\theta}_{t })-f(\bm{\lambda}_{t},\pi_{t};\bm{\theta}_{t}^{*})\right).\]

Similar to Lemma 4.1 of Gabbianelli et al. (2024), we show in Lemma 4.1 below that with an appropriate choice of the comparator points, we can relate the gap to the expected suboptimality of policy \(\pi_{J}\) where \(J\sim\mathcal{U}(1,\cdots,T)\). We leave the proof in Appendix B.1.1.

**Lemma 4.1**.: _Suppose that \(D_{\bm{\theta}}=\sqrt{d}/(1-\gamma)\). Choose \(\left(\bm{\lambda}^{*},\pi^{*},\bm{\theta}_{t}^{*}\right)=\left(\bm{\Phi}^{ \top}\bm{\mu}^{\pi^{*}},\pi^{*},\bm{\theta}^{\pi_{t}}\right)\in\mathbb{R}^{d} \times\Pi\left(D_{\pi}\right)\times\mathbb{B}_{d}(D_{\theta})\) for \(t=1,\cdots,T\) where \(\bm{\mu}^{\pi^{*}}\) is a valid occupancy measure induced by \(\pi^{*}\). Then,_

\[\mathbb{E}_{J}\left[\left\langle\bm{\mu}^{\pi^{*}}-\bm{\mu}^{\pi_{J}},\bm{r} \right\rangle\right]=\mathfrak{G}_{T}\left(\bm{\Phi}^{\top}\bm{\mu}^{\pi^{*} },\pi^{*},\{\bm{\theta}^{\pi_{t}}\}_{t=1}^{T}\right).\]

We will show below that the dynamic duality gap can be written in terms of the _regrets_ of each player and an additional term related to the estimation error of \(\widehat{f}\), and then proceed to provide bounds on all of these quantities. Specifically, the regrets of each player with respect to each of their respective comparators are defined as

\[\mathfrak{R}_{T}\left(\pi^{*}\right) =\sum_{t=1}^{T}\sum_{x}\nu^{*}(x)\sum_{a}\left(\pi^{*}(a|x)-\pi_{t }(a|x)\right)q_{t}(x,a),\] \[\mathfrak{R}_{T}\left(\bm{\lambda}^{*}\right) =\sum_{t=1}^{T}\widehat{f}(\bm{\lambda}^{*},\pi_{t};\bm{\theta}_ {t})-\widehat{f}(\bm{\lambda}_{t},\pi_{t};\bm{\theta}_{t})=\sum_{t=1}^{T} \left\langle\bm{\lambda}^{*}-\bm{\lambda}_{t},\bm{\omega}+\gamma\widehat{\bm{ \Psi}}\bm{v}_{\bm{\theta}_{t},\pi_{t}}-\bm{\theta}_{t}\right\rangle,\] \[\mathfrak{R}_{T}\left(\bm{\theta}_{1:T}^{*}\right) =\sum_{t=1}^{T}\widehat{f}(\bm{\lambda}_{t},\pi_{t};\bm{\theta} _{t})-\widehat{f}(\bm{\lambda}_{t},\pi_{t};\bm{\theta}_{t}^{*})=\sum_{t=1}^{T }\left\langle\bm{\theta}_{t}-\bm{\theta}_{t}^{*},\bm{\Phi}^{\top}\widehat{\bm {\mu}}_{\bm{\lambda}_{t},\pi_{t}}-\bm{\lambda}_{t}\right\rangle.\]

where \(\bm{\nu}^{*}=(1-\gamma)\nu_{0}(x)+\gamma\langle\bm{\psi}(x),\bm{\lambda}^{*}\rangle\). Furthermore, we define the _gap-estimation error_ as

\[\text{err}_{\widehat{\bm{\Psi}}}=\sum_{t=1}^{T}\bigl{\langle}\bm{\lambda}^{*}, \bigl{(}\bm{\Psi}-\widehat{\bm{\Psi}}\bigr{)}\bm{v}_{\bm{\theta}_{t},\pi_{t}} \bigr{\rangle}+\sum_{t=1}^{T}\bigl{\langle}\bm{\lambda}_{t},\bigl{(}\widehat{ \bm{\Psi}}-\bm{\Psi}\bigr{)}\bm{v}_{\bm{\theta}_{t}^{*},\pi_{t}}\bigr{\rangle}.\] (10)

The following lemma rewrites the duality gap using the above terms.

**Lemma 4.2**.: _The dynamic duality gap satisfies_

\[\mathfrak{G}_{T}(\bm{\lambda}^{*},\pi^{*},\bm{\theta}_{1:T}^{*})=\frac{1}{T} \mathfrak{R}_{T}\left(\pi^{*}\right)+\frac{1}{T}\mathfrak{R}_{T}\left(\bm{ \lambda}^{*}\right)+\frac{1}{T}\mathfrak{R}_{T}\left(\bm{\theta}_{1:T}^{*} \right)+\frac{\gamma}{T}\text{err}_{\widehat{\bm{\Psi}}}.\]The proof directly follows from a straightforward calculation similar to the proof of Lemma 4.2 of Gabbianelli et al. (2024) and Section E.1 of Hong and Tewari (2024) which is reproduced in Appendix B.1.2 for completeness. It remains to bound the regret of the players, as well as the gap-estimation error. An obstacle we need to face in the analysis is that our bound of the latter error term scale with \(\frac{1}{T}\sum_{t=1}^{T}\left\|\bm{\lambda}_{\bm{\Lambda}_{n}^{-1}}\right\|_{ \bm{\Lambda}_{n}^{-1}}^{2}\), which is undesirable given our aspiration to achieve bounds that scale only with the comparator norm \(\left\|\bm{\lambda}^{*}\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}\) without requiring prior upper bounds on this quantity (that would enable us to project the iterates to a bounded domain). This challenge is addressed by making use of the stabilization technique of Jacobsen and Cutkosky (2023) and Neu and Okolo (2024) in the updates for the \(\bm{\lambda}\)-player, which effectively eliminates these problematic terms. We briefly outline the remaining parts of the analysis below.

### Regret analysis

The regrets of each player are respectively controlled by the following three lemmas.

**Lemma 4.3**.: _Suppose that \(\bm{\nu}^{*}\in\Delta_{\mathcal{X}}\). Let \(\pi_{1}\) be the uniform policy which selects all actions with equal probability in each state. Under the conditions on the feature map in Definition 2.1, the regret of the \(\pi\)-player against \(\pi^{*}\) satisfies \(\frac{1}{T}\mathfrak{R}_{T}\left(\pi^{*}\right)\leq\frac{\log A}{\alpha T}+ \frac{\alpha R^{2}D_{\bm{\theta}}^{2}}{2}\)._

The proof is a standard application of the analysis of exponential-weight updates, stated as Lemma E.1.

**Lemma 4.4**.: _Let \(\bm{\lambda}_{1}=\bm{0}\) and \(C=6\beta\left(d+D_{\bm{\theta}}^{2}\right)+3d\left(1+RD_{\bm{\theta}}\right)^ {2}+3\gamma^{2}dR^{2}D_{\bm{\theta}}^{2}\). Then, the regret of the \(\bm{\lambda}\)-player against any comparator \(\bm{\lambda}^{*}\in\mathbb{R}^{d}\) satisfies_

\[\frac{1}{T}\mathfrak{R}_{T}\left(\bm{\lambda}^{*}\right)\leq\left(\frac{1}{2 \eta T}+\frac{\varrho}{2}\right)\left\|\bm{\lambda}^{*}\right\|_{\bm{\Lambda} _{n}^{-1}}^{2}+\frac{\eta C}{2}-\frac{\varrho}{2T}\sum_{t=1}^{T}\left\|\bm{ \lambda}_{t}\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}.\]

The proof (provided in Appendix B.2.2) follows from applying the standard analysis of composite-objective mirror descent due to Duchi et al. (2010) (stated as Lemma C.1 in the Appendix) and the bound \(\left\|\bm{\Lambda}_{n}\bm{g}_{\bm{\lambda}}(t)\right\|_{\bm{\Lambda}_{n}^{-1 }}^{2}\leq C\) on the weighted norm of the gradients for all \(t\) provided in Lemma C.2.

**Lemma 4.5**.: _Let \(D_{\bm{\theta}}=\sqrt{d}/\left(1-\gamma\right)\). The regret of the \(\theta\)-player satisfies \(\frac{1}{T}\mathfrak{R}_{T}\left(\bm{\theta}_{1:T}^{*}\right)\leq 0\)._

As we show in Appendix B.2.3, the above statement holds trivially thanks to the "best-response" definition of \(\theta_{t}\). This concludes our regret analysis.

### Bounding the gap-estimation error

The following statement (proved in Appendix B.3) provides a bound on \(\text{err}_{\widehat{\bm{\Psi}}}\):

**Lemma 4.6**.: _Suppose that \(\left\|\bm{\varphi}(x,a)\right\|_{2}\leq R\) for all \((x,a)\in\mathcal{X}\times\mathcal{A}\), \(D_{\bm{\theta}}=\sqrt{d}/(1-\gamma)\) and \(\alpha=\sqrt{2\left(1-\gamma\right)^{2}\log A/R^{2}dT}\) to optimize \(\mathfrak{R}_{T}\left(\pi^{*}\right)\). Then, for any \(T\geq\frac{2R^{2}\log A}{\log(1/\delta)}\) and and \(\xi\geq 0\), the following holds with probability at least \(1-\delta\):_

\[\text{err}_{\widehat{\bm{\Psi}}}\leq\frac{1}{2\xi}\left(\left\|\bm{\lambda}^ {*}\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}+\frac{1}{T}\sum_{t=1}^{T}\left\|\bm{ \lambda}_{t}\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}\right)+T^{2}\xi\left(\frac{320 d^{2}\log\left(2T/\delta\right)}{n\left(1-\gamma\right)^{2}}\right).\]

### The proof of Theorem 3.1

The proof follows from applying Lemmas 4.1 and Lemma 4.2 when \(\left(\bm{\lambda}^{*},\pi^{*},\bm{\theta}_{t}^{*}\right)=\left(\bm{\Phi}^{ \intercal}\bm{\mu}^{\pi^{*}},\pi^{*},\bm{\theta}^{\pi_{t}}\right)\in\mathbb{R} ^{d}\times\Pi\left(D_{\pi}\right)\times\mathbb{B}_{d}(D_{\theta})\) for \(t=1,\cdots,T\). Then, adding up the bounds stated in Lemmas 4.3-4.6 under the respective conditions, yields

\[\mathbb{E}_{J}\left[\left\langle\bm{\mu}^{\pi^{*}}-\bm{\mu}^{\pi _{J}},\bm{r}\right\rangle\right] \leq\sqrt{\frac{d\log\left(1/\delta\right)}{n\left(1-\gamma \right)^{2}}}+\left(\frac{1}{2\eta T}+\frac{\varrho}{2}+\frac{\gamma}{2\xi T} \right)\left\|\bm{\lambda}^{*^{*}}\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}+\frac{ \eta C}{2}\] \[\quad+\left(\frac{\gamma}{\xi T}-\varrho\right)\frac{1}{2T}\sum_{ t=1}^{T}\left\|\bm{\lambda}_{t}\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}+\gamma T\xi\left( \frac{320d^{2}\log\left(2T/\delta\right)}{n\left(1-\gamma\right)^{2}}\right).\]

Then, setting \(\rho=\frac{\gamma}{\xi T}\) simplifies the second term and eliminates the third term. The claim then follows after optimizing the hyperparameters, with the full details provided in Appendix B.4.

Discussion

We discuss various aspects of our results below.

Relation with previous work.As discussed in the introduction, our work draws heavily on previous contributions of Gabbianelli et al. (2024) and Hong and Tewari (2024). In particular, our idea of building a least-squares estimator of the transition function is directly borrowed from the latter of these works, and our implicit update rule for \(\theta_{t}\) is also inspired by their work to a good extent. Their approach, however, failed to reach the same degree of efficiency due to a number of suboptimal design choices. First, they used an alternative parametrization of the feature occupancies which only allowed them to work under a more restrictive coverage condition, so that their bounds depend on \(\left\lVert\bm{\lambda}^{*}\right\rVert_{\bm{\Lambda}_{n}^{-2}}\) which can be much larger than the feature coverage ratio appearing in our bounds. Second, their algorithm required a prior upper bound on this coverage parameter, with the guarantees scaling with the bound rather than the actual coverage. Such bounds are typically difficult to obtain in practice. Third, the implementation of their algorithm required intricate computational steps necessitated by their feature-occupancy parametrization. Our work has successfully removed these limitations and reduced the complexity of their method, thanks to a new primal-only analysis style that we hope will find further uses in reinforcement learning.

Computational and statistical efficiency.As can be inferred from our main result, the sample complexity of finding an \(\varepsilon\)-optimal policy using our algorithm is of the order \(d^{2}\left\lVert\bm{\lambda}^{*}\right\rVert_{\bm{\Lambda}_{n}^{-1}}^{2}/ \varepsilon^{2}\left(1-\gamma\right)^{2}\), which is optimal in terms of scaling with \(\varepsilon\). The rate can be improved to scale linearly with the feature coverage ratio \(\left\lVert\bm{\lambda}^{*}\right\rVert_{\bm{\Lambda}_{n}^{-1}}\), if a tight upper bound is known on it which can be used for hyperparameter tuning. We find this scenario to be unlikely, and are curious to see if future work can attain this improved scaling without such prior knowledge. As for computational complexity, we point out that the cost of each iteration of our method scales linearly with the sample size \(n\), due to having to compute the matrix-vector products \(\widehat{\bm{\Psi}}\bm{v}_{\theta_{t},\pi_{t}}\). Indeed, the matrix \(\widehat{\bm{\Psi}}\) is sparse with \(n\) non-zero rows, and as such computing this product takes linear time in \(n\). Since the iteration complexity of \(\mathsf{FOGAS}\) scales linearly with the sample size \(n\), this makes for an overall runtime complexity of order \(n^{2}\). This limitation is of course shared with all methods using the same least-squares transition estimator for the transition model, including all work that builds on Jin et al. (2020), but we nevertheless wonder if a substantial improvement is possible on this front.

Data coverage assumptions.The only works we are aware of that scale with the feature-coverage ratio \(\left\lVert\bm{\lambda}^{*}\right\rVert_{\bm{\Lambda}_{n}^{-1}}\) are due to Zanette et al. (2021) and Gabbianelli et al. (2024). The latter work only achieves this bound under the assumption that the data is drawn i.i.d. from a fixed behavior policy with known feature covariance matrix, which is a much more restricted setting that we consider here. Such assumptions are not needed by Zanette et al. (2021), however their results are restricted to the simpler finite-horizon MDP setting, and their algorithm is arguably more complex than ours. Using our notation, their approach can be interpreted as solving a "pessimistic" version of the the relaxed dual LP (4) that features some additional quadratic constraints. This approach is not computationally viable for the infinite-horizon discounted case we consider, as it requires solving a fixed-point equation with respect to the estimated transition operator (cf. Wei et al., 2021).

Possible extensions.Our approach can be extended and generalized in a variety of ways. First, following Gabbianelli et al. (2024), we believe that it is straightforward to extend our analysis to undiscounted infinite-horizon MDPs. Second, we similarly believe that an extension to constrained MDPs is possible without major challenges, following Hong and Tewari (2024). We did not pursue these extensions because we believe that they add little additional insight. There are other potential directions that we did not explore because we found them to be too ambitious for the moment. These include extending our results beyond linear MDPs to other MDP models with linear function approximation, including MDPs with low inherent Bellman rank (which may be within reach of the current theory, c.f. Zanette et al., 2020), linearly \(Q^{\pi}\)-realizable MDPs (which are known to be challenging, c.f. Weisz et al., 2022, 2024). Even more ambitiously, one can ask if it is possible to extend our methods to work under more general notions of function approximation. This looks very challenging given the central role of feature occupancies in our formalism, which are strictly tied to linear function approximation. We are nevertheless optimistic that the ideas presented in this work will find use in other contexts, possibly including nonlinear function approximation in the future.

## References

* Abbasi-Yadkori et al. [2011] Y. Abbasi-Yadkori, D. Pal, and C. Szepesvari. Improved algorithms for linear stochastic bandits. _Advances in neural information processing systems_, 24, 2011.
* Bas-Serrano et al. [2021] J. Bas-Serrano, S. Curi, A. Krause, and G. Neu. Logistic q-learning. In _International Conference on Artificial Intelligence and Statistics_, pages 3610-3618. PMLR, 2021.
* Beck and Teboulle [2003] A. Beck and M. Teboulle. Mirror descent and nonlinear projected subgradient methods for convex optimization. _Operations Research Letters_, 31(3):167-175, 2003.
* Bellman [1966] R. Bellman. Dynamic programming. _science_, 153(3731):34-37, 1966.
* Bertsekas [1997] D. P. Bertsekas. Nonlinear programming. _Journal of the Operational Research Society_, 48(3):334-334, 1997.
* Bradtke and Barto [1996] S. J. Bradtke and A. G. Barto. Linear least-squares algorithms for temporal difference learning. _Machine Learning_, 22:33-57, 1996.
* Cesa-Bianchi and Lugosi [2006] N. Cesa-Bianchi and G. Lugosi. _Prediction, learning, and games_. Cambridge university press, 2006.
* de Ghellinck [1960] G. de Ghellinck. Les problemes de decisions sequentielles. _Cahiers du Centre d'Etudes de Recherche Operationnelle_, 2:161-179, 1960.
* Denardo [1970] E. V. Denardo. On linear programming in a Markov decision problem. _Management Science_, 16(5):281-288, 1970.
* d'Epenoux [1963] F. d'Epenoux. A probabilistic production and inventory problem. _Management Science_, 10(1):98-108, 1963.
* Duchi et al. [2010] J. C. Duchi, S. Shalev-Shwartz, Y. Singer, and A. Tewari. Composite objective mirror descent. In _COLT_, volume 10, pages 14-26. Citeseer, 2010.
* Freund and Schapire [1997] Y. Freund and R. E. Schapire. A decision-theoretic generalization of on-line learning and an application to boosting. _Journal of Computer and System Sciences_, 55:119-139, 1997.
* Gabbianelli et al. [2024] G. Gabbianelli, G. Neu, M. Papini, and N. M. Okolo. Offline primal-dual reinforcement learning for linear mdps. In _International Conference on Artificial Intelligence and Statistics_, pages 3169-3177. PMLR, 2024.
* Hong and Tewari [2024] K. Hong and A. Tewari. A primal-dual algorithm for offline constrained reinforcement learning with low-rank mdps. _arXiv preprint arXiv:2402.04493_, 2024.
* Jacobsen and Cutkosky [2023] A. Jacobsen and A. Cutkosky. Unconstrained online learning with unbounded losses. In _International Conference on Machine Learning_, pages 14590-14630. PMLR, 2023.
* Jin et al. [2020] C. Jin, Z. Yang, Z. Wang, and M. I. Jordan. Provably efficient reinforcement learning with linear function approximation. In _Conference on learning theory_, pages 2137-2143. PMLR, 2020.
* Jin et al. [2021] Y. Jin, Z. Yang, and Z. Wang. Is pessimism provably efficient for offline RL? In _International Conference on Machine Learning_, pages 5084-5096. PMLR, 2021.
* Lattimore and Szepesvari [2020] T. Lattimore and C. Szepesvari. _Bandit algorithms_. Cambridge University Press, 2020.
* Levine et al. [2020] S. Levine, A. Kumar, G. Tucker, and J. Fu. Offline reinforcement learning: Tutorial, review, and perspectives on open problems. _arXiv preprint arXiv:2005.01643_, 2020.
* Li et al. [2024] G. Li, L. Shi, Y. Chen, Y. Chi, and Y. Wei. Settling the sample complexity of model-based offline reinforcement learning. _The Annals of Statistics_, 52(1):233-260, 2024.
* Littlestone and Warmuth [1994] N. Littlestone and M. Warmuth. The weighted majority algorithm. _Information and Computation_, 108:212-261, 1994.
* Liu et al. [2020] Y. Liu, A. Swaminathan, A. Agarwal, and E. Brunskill. Provably good batch off-policy reinforcement learning without great exploration. _Advances in neural information processing systems_, 33:1264-1274, 2020.
* Liu et al. [2021]A. S. Manne. Linear programming and sequential decisions. _Management Science_, 6(3):259-267, 1960.
* Munos and Szepesvari [2008] R. Munos and C. Szepesvari. Finite-time bounds for fitted value iteration. _Journal of Machine Learning Research_, 9(5), 2008.
* Nemirovski and Yudin [1983] A. Nemirovski and D. Yudin. _Problem Complexity and Method Efficiency in Optimization_. Wiley Interscience, 1983.
* Neu and Okolo [2023] G. Neu and N. Okolo. Efficient global planning in large MDPs via stochastic primal-dual optimization. In _International Conference on Algorithmic Learning Theory_, pages 1101-1123. PMLR, 2023.
* Neu and Okolo [2024] G. Neu and N. Okolo. Dealing with unbounded gradients in stochastic saddle-point optimization. _arXiv preprint arXiv:2402.13903_, 2024.
* Neu and Pike-Burke [2020] G. Neu and C. Pike-Burke. A unifying view of optimism in episodic reinforcement learning. In _Advances in Neural Information Processing Systems_, pages 1392-1403, 2020.
* Neu et al. [2017] G. Neu, A. Jonsson, and V. Gomez. A unified view of entropy-regularized Markov decision processes. _arXiv preprint arXiv:1705.07798_, 2017.
* Parr et al. [2008] R. Parr, L. Li, G. Taylor, C. Painter-Wakefield, and M. L. Littman. An analysis of linear models, linear value-function approximation, and feature selection for reinforcement learning. In _Proceedings of the 25th international conference on Machine learning_, pages 752-759, 2008.
* Puterman [1994] M. L. Puterman. _Markov decision processes: discrete stochastic dynamic programming_. John Wiley & Sons, 1994.
* Rashidinejad et al. [2021] P. Rashidinejad, B. Zhu, C. Ma, J. Jiao, and S. Russell. Bridging offline reinforcement learning and imitation learning: A tale of pessimism. _Advances in Neural Information Processing Systems_, 34:11702-11716, 2021.
* Rashidinejad et al. [2022] P. Rashidinejad, H. Zhu, K. Yang, S. Russell, and J. Jiao. Optimal conservative offline rl with general function approximation via augmented lagrangian. _arXiv preprint arXiv:2211.00716_, 2022.
* Shalev-Shwartz and Ben-David [2014] S. Shalev-Shwartz and S. Ben-David. _Understanding machine learning: From theory to algorithms_. Cambridge university press, 2014.
* Uehara and Sun [2021] M. Uehara and W. Sun. Pessimistic model-based offline reinforcement learning under partial coverage. _arXiv preprint arXiv:2107.06226_, 2021.
* Vovk [1990] V. Vovk. Aggregating strategies. In _Proceedings of the third annual workshop on Computational learning theory (COLT)_, pages 371-386, 1990.
* Wei et al. [2021] C.-Y. Wei, M. J. Jahromi, H. Luo, and R. Jain. Learning infinite-horizon average-reward mdps with linear function approximation. In _International Conference on Artificial Intelligence and Statistics_, pages 3007-3015. PMLR, 2021.
* Weisz et al. [2022] G. Weisz, A. Gyorgy, T. Kozuno, and C. Szepesvari. Confident approximate policy iteration for efficient local planning in \(q^{\pi}\)-realizable mdps. _Advances in Neural Information Processing Systems_, 35:25547-25559, 2022.
* Weisz et al. [2024] G. Weisz, A. Gyorgy, and C. Szepesvari. Online rl in linearly \(q^{\pi}\)-realizable mdps is as easy as in linear mdps if you learn what to ignore. _Advances in Neural Information Processing Systems_, 36, 2024.
* Xie et al. [2021] T. Xie, C.-A. Cheng, N. Jiang, P. Mineiro, and A. Agarwal. Bellman-consistent pessimism for offline reinforcement learning. _Advances in neural information processing systems_, 34:6683-6694, 2021.
* Yang and Wang [2019] L. Yang and M. Wang. Sample-optimal parametric Q-learning using linearly additive features. In _International conference on machine learning_, pages 6995-7004. PMLR, 2019.
* Zanette et al. [2020] A. Zanette, A. Lazaric, M. Kochenderfer, and E. Brunskill. Learning near optimal policies with low inherent bellman error. In _International Conference on Machine Learning_, pages 10978-10989. PMLR, 2020.

* Zanette et al. [2021] A. Zanette, M. J. Wainwright, and E. Brunskill. Provable benefits of actor-critic methods for offline reinforcement learning. _Advances in neural information processing systems_, 34:13626-13640, 2021.
* Zhan et al. [2022] W. Zhan, B. Huang, A. Huang, N. Jiang, and J. Lee. Offline reinforcement learning with realizability and single-policy concentrability. In _Conference on Learning Theory_, pages 2730-2775. PMLR, 2022.
* Zhang et al. [2022] X. Zhang, Y. Chen, X. Zhu, and W. Sun. Corruption-robust offline reinforcement learning. In _International Conference on Artificial Intelligence and Statistics_, pages 5757-5773. PMLR, 2022.

## Appendix A Missing proofs of Section 2

### Properties of the relaxed LP

In this section we prove a basic result about the feasible sets of the relaxed linear programs defined in Equations (3) and (4). We remark that similar results have been previously shown in Proposition 4 of Bas-Serrano et al. (2021) and Appendix A.1 of Neu and Okolo (2023).

**Lemma A.1**.: _Suppose that the MDP satisfies the linear MDP assumption in the sense of Definition 2.1, consider the relaxed linear programs 3 and 4 and their respective feasible sets:_

\[\mathcal{M}_{\Phi}^{P} =\left\{(\boldsymbol{\lambda},\boldsymbol{\mu})\in\mathbb{R}^{d} \times\mathbb{R}^{XA}_{+}\;\middle|\;\boldsymbol{E}^{\mathsf{ T}}\boldsymbol{\mu}=(1-\gamma)\boldsymbol{\nu}_{0}+\gamma\boldsymbol{\Psi}^{ \mathsf{ T}}\boldsymbol{\lambda},\quad\boldsymbol{\lambda}=\boldsymbol{\Phi}^{ \mathsf{ T}}\boldsymbol{\mu}\right\},\] \[\mathcal{M}_{\Phi}^{D} =\left\{(\boldsymbol{v},\boldsymbol{\theta})\in\mathbb{R}^{X} \times\mathbb{R}^{d}\;\middle|\;\boldsymbol{E}\boldsymbol{v}\geq\boldsymbol{ \Phi}\boldsymbol{\theta},\quad\boldsymbol{\theta}=\boldsymbol{\omega}+\gamma \boldsymbol{\Psi}\boldsymbol{v}\right\}.\]

_Then, the following statements hold:_

* _The set_ \(\mathcal{M}=\left\{\boldsymbol{\mu}:(\boldsymbol{\lambda},\boldsymbol{\mu}) \in\mathcal{M}_{\Phi}^{P}\right\}\) _coincides with the feasible set of the primal LP_ \((\ref{eq:LP})\)_. Furthermore, for all_ \((\boldsymbol{\lambda}^{*},\boldsymbol{\mu}^{*})\in\text{ arg max}_{( \boldsymbol{\lambda},\boldsymbol{\mu})\in\mathcal{M}_{\Phi}^{P}}\left\langle \boldsymbol{\lambda},\boldsymbol{\omega}\right\rangle\)_, we have that_ \(\boldsymbol{\mu}^{*}\) _is the occupancy measure of an optimal policy._
* _The set_ \(\mathcal{V}=\left\{\boldsymbol{v}:(\boldsymbol{v},\boldsymbol{\theta})\in \mathcal{M}_{\Phi}^{D}\right\}\) _coincides with the feasible set of the dual LP_ \((\ref{eq:LP})\)_. Furthermore, the optimal value function_ \(\boldsymbol{v}^{\pi^{*}}\) _and the parameter vector_ \(\boldsymbol{\theta}^{\pi^{*}}\) _satisfying_ \(\boldsymbol{q}^{\pi^{*}}=\boldsymbol{\Phi}\boldsymbol{\theta}^{\pi^{*}}\) _satisfy_ \((\boldsymbol{v}^{\pi^{*}},\boldsymbol{\theta}^{\pi^{*}})\in\text{ arg min}_{( \boldsymbol{v},\boldsymbol{\theta})\in\mathcal{M}_{\Phi}^{P}}(1-\gamma)\left\langle \boldsymbol{\nu}_{0},\boldsymbol{v}\right\rangle\)_._

Proof.: We first show that for any feasible point \(\boldsymbol{\mu}\) of the LP \((\ref{eq:LP})\), the tuple \((\boldsymbol{\lambda},\boldsymbol{\mu})\) is feasible for the relaxed LP with \(\boldsymbol{\lambda}=\boldsymbol{\Phi}^{\mathsf{ T}}\boldsymbol{\mu}\). This choice of \(\boldsymbol{\lambda}\) satisfies the second primal constraint by definition, so it remains to verify that the first constraint is also satisfied. Indeed, this follows from

\[\boldsymbol{E}^{\mathsf{ T}}\boldsymbol{\mu}-(1-\gamma)\boldsymbol{\nu}_{0}- \gamma\boldsymbol{\Psi}^{\mathsf{ T}}\boldsymbol{\lambda} =\boldsymbol{E}^{\mathsf{ T}}\boldsymbol{\mu}-(1-\gamma)\boldsymbol{\nu}_{0}- \gamma\boldsymbol{\Psi}^{\mathsf{ T}}\boldsymbol{\Phi}^{\mathsf{ T}}\boldsymbol{\mu}\] \[=\boldsymbol{E}^{\mathsf{ T}}\boldsymbol{\mu}-(1-\gamma)\boldsymbol{\nu}_{0}- \gamma\boldsymbol{P}^{\mathsf{ T}}\boldsymbol{\mu}=0,\]

where we have used the linear MDP property to write \(\boldsymbol{\Psi}^{\mathsf{ T}}\boldsymbol{\Phi}^{\mathsf{ T}}=\boldsymbol{P}^{\mathsf{ T}}\) in the first step and that \(\boldsymbol{\mu}\) is a valid occupancy measure in the last one. Conversely, supposing that \((\boldsymbol{\lambda},\boldsymbol{\mu})\in\mathcal{M}_{\Phi}^{P}\) are feasible for the relaxed LP, we have that

\[\boldsymbol{E}^{\mathsf{ T}}\boldsymbol{\mu}-(1-\gamma)\boldsymbol{\nu}_{0}- \gamma\boldsymbol{P}^{\mathsf{ T}}\boldsymbol{\mu} =\boldsymbol{E}^{\mathsf{ T}}\boldsymbol{\mu}-(1-\gamma)\boldsymbol{\nu}_{0}- \gamma\boldsymbol{\Psi}^{\mathsf{ T}}\boldsymbol{\Phi}^{\mathsf{ T}}\boldsymbol{\mu}\] \[=\boldsymbol{E}^{\mathsf{ T}}\boldsymbol{\mu}-(1-\gamma)\boldsymbol{\nu}_{0}- \gamma\boldsymbol{\Psi}^{\mathsf{ T}}\boldsymbol{\lambda}=0,\]

thus verifying that \(\boldsymbol{\mu}\) is indeed a valid occupancy measure. Optimality of \((\boldsymbol{\lambda}^{*},\boldsymbol{\mu}^{*})\) follows from the fact that for any \((\boldsymbol{\lambda},\boldsymbol{\mu})\in\mathcal{M}_{\Phi}^{P}\), we can write the LP objective as \(\left\langle\boldsymbol{\lambda},\boldsymbol{\omega}\right\rangle=\left\langle \boldsymbol{\mu},\boldsymbol{r}\right\rangle\) by the linear MDP assumption, and the standard fact that any solution \(\boldsymbol{\mu}^{*}\) to the primal LP \(1\) is the occupancy measure of an optimal policy (cf. Theorem 6.9.4 in Puterman, 1994). This concludes the first part of the proof.

For the second part of the proof, let us first consider a feasible solution \(\boldsymbol{v}\) for the original dual LP \((\ref{eq:LP})\). Then, the choice \(\boldsymbol{\theta}=\omega+\gamma\Psi\boldsymbol{v}\) satisfies the second dual constraint by definition. The first constraint can be verified by writing

\[E\boldsymbol{v}-\Phi\theta=E\boldsymbol{v}-r-\gamma P\boldsymbol{v}\geq 0,\]

where we used the choice of \(\boldsymbol{\theta}\) in the first step and the feasibility of \(\boldsymbol{v}\) for the original LP in the second step. Conversely, supposing that \((\boldsymbol{\theta},\boldsymbol{v})\in\mathcal{M}_{\Phi}^{D}\), we note that

\[E\boldsymbol{v}-r-\gamma P\boldsymbol{v}=E\boldsymbol{v}-\Phi\boldsymbol{\theta }\geq 0,\]

which implies the feasibility of \(\boldsymbol{v}\) in the LP \(2\). Optimality of \(\boldsymbol{v}^{*}\) for both LPs follows from the fact that their objectives are identical, and the standard fact that \(\boldsymbol{v}^{*}\) is an optimal solution of the dual LP \((\ref{eq:LP})\) (cf. Theorem 6.2.2 in Puterman, 1994).

Missing proofs of Section 4

In this section, we provide performance guarantees for Algorithm 1 in terms of the expected suboptimality of the output policy \(\pi_{J}\), and in particular prove the lemmas provided in Section 4 in the main text. Auxiliary lemmas and technical results for proving some of these are included in Appendix E.

### Properties of the Dynamic Duality Gap

We first prove our claims regarding the dynamic duality gap introduced in Section 4 of the main text. First, we relate the gap to the expected suboptimality (in terms of return) of \(\pi_{J}\) against a comparator policy \(\pi^{*}\) in Appendix B.1.1. Next, we relate the dynamic duality gap to the average regret of each player in Appendix B.1.2.

#### b.1.1 Proof of Lemma 4.1

By definition of the the dynamic duality gap, we have that

\[\mathfrak{G}_{T}\left(\bm{\Phi}^{\mathsf{ T}}\bm{\mu}^{\pi^{*}},\pi^{*},\{\bm{\theta}^{\pi_{t}}\}_{t=1}^{T}\right)=\frac{1}{T} \sum_{t=1}^{T}f(\bm{\Phi}^{\mathsf{ T}}\bm{\mu}^{\pi^{*}},\pi^{*};\bm{\theta}_{t})-f(\bm{\lambda}_{t},\pi_{t};\bm{ \theta}^{\pi_{t}}).\]

Considering the first term, we see that

\[f(\bm{\Phi}^{\mathsf{ T}}\bm{\mu}^{\pi^{*}},\pi^{*};\bm{\theta}_{t}) =\left\langle\bm{\Phi}^{\mathsf{ T}}\bm{\mu}^{\pi^{*}},\bm{\omega}\right\rangle+\left\langle\bm{\theta}_{t},\bm{ \Phi}^{\mathsf{ T}}\bm{\mu}_{\bm{\lambda}^{*},\pi^{*}}-\bm{\Phi}^{\mathsf{ T}}\bm{\mu}^{\pi^{*}}\right\rangle\] \[\stackrel{{(a)}}{{=}}\left\langle\bm{\mu}^{\pi^{*}}, \bm{r}\right\rangle+\left\langle\bm{\theta}_{t},\bm{\Phi}^{\mathsf{ T}}\bm{\mu}_{\bm{\lambda}^{*},\pi^{*}}-\bm{\Phi}^{\mathsf{ T}}\bm{\mu}^{\pi^{*}}\right\rangle\] \[\stackrel{{(b)}}{{=}}\left\langle\bm{\mu}^{\pi^{*}}, \bm{r}\right\rangle,\]

where we have used \((a)\) the linear MDP property (definition 2.1) and \((b)\) the following relation:

\[\mu_{\bm{\lambda}^{*},\pi^{*}}(x,a) =\pi^{*}(a|x)\Big{[}(1-\gamma)\nu_{0}(x)+\gamma\left\langle\bm{ \psi}(x),\bm{\Phi}^{\mathsf{ T}}\bm{\mu}^{\pi^{*}}\right\rangle\Big{]}\] \[=\pi^{*}(a|x)\Big{[}(1-\gamma)\nu_{0}(x)+\gamma\sum_{x^{\prime},a ^{\prime}}p\left(x|x^{\prime},a^{\prime}\right)\mu^{\pi^{*}}\left(x^{\prime}, a^{\prime}\right)\Big{]}=\mu^{\pi^{*}}(x,a).\]

Now for the second term, we have

\[f(\bm{\lambda}_{t},\pi_{t};\bm{\theta}^{\pi_{t}}) =(1-\gamma)\left\langle\bm{\nu}_{0},\bm{v}_{\bm{\theta}^{\pi_{t}},\pi_{t}}\right\rangle+\left\langle\bm{\lambda}_{t},\bm{\omega}+\gamma\bm{ \Psi}\bm{v}_{\bm{\theta}^{\pi_{t}},\pi_{t}}-\bm{\theta}^{\pi_{t}}\right\rangle\] \[=\left\langle\bm{\mu}^{\pi_{t}},\bm{r}\right\rangle+\left\langle \bm{\lambda}_{t},\bm{\omega}+\gamma\bm{\Psi}\bm{v}^{\pi_{t}}-\bm{\theta}^{\pi_{ t}}\right\rangle\] \[=\left\langle\bm{\mu}^{\pi_{t}},\bm{r}\right\rangle,\]

where we have used the Bellman equations \(\bm{q}^{\pi_{t}}=\bm{\Phi}\bm{\theta}_{t}^{\pi}=\bm{r}+\gamma\bm{P}\bm{v}^{\pi_ {t}}=\bm{\Phi}\left(\bm{\omega}+\gamma\bm{\Psi}\bm{v}^{\pi_{t}}\right)\), which together with the fact that \(\bm{\Phi}\) is full rank implies that \(\bm{\theta}^{\pi_{t}}=\bm{\omega}+\gamma\bm{\Psi}\bm{v}^{\pi_{t}}\). Substituting the above expressions for \(f(\bm{\Phi}^{\mathsf{ T}}\bm{\mu}^{\pi^{*}},\pi^{*};\bm{\theta}_{t})\) and \(f(\bm{\lambda}_{t},\pi_{t};\bm{\theta}^{\pi_{t}})\) in the dynamic duality gap and noting that \(\pi_{J}\) is such that \(\frac{1}{T}\sum_{t=1}^{T}\left\langle\bm{\mu}^{\pi_{t}},\bm{r}\right\rangle= \mathbb{E}_{J}\left[\left\langle\bm{\mu}^{\pi_{J}},\bm{r}\right\rangle\right]\) we get

\[\mathfrak{G}_{T}\left(\bm{\Phi}^{\mathsf{ T}}\bm{\mu}^{\pi^{*}},\pi^{*},\{\bm{\theta}^{\pi_{t}}\}_{t=1}^{T}\right)= \mathbb{E}_{J}\left[\left\langle\bm{\mu}^{\pi^{*}}-\bm{\mu}^{\pi_{J}},\bm{r} \right\rangle\right].\]

This completes the proof. 

#### b.1.2 Proof of Lemma 4.2

Recall that for any comparator points \(\left(\bm{\lambda}^{*},\pi^{*};\{\bm{\theta}^{*}_{t}\}_{t=1}^{T}\right)\), the dynamic duality gap is defined as

\[\mathfrak{G}_{T}\left(\bm{\lambda}^{*},\pi^{*};\{\bm{\theta}^{*}_{t}\}_{t=1}^{T} \right)=\frac{1}{T}\sum_{t=1}^{T}\left(f(\bm{\lambda}^{*},\pi^{*};\bm{\theta} _{t})-f(\bm{\lambda}_{t},\pi_{t};\bm{\theta}^{*}_{t})\right).\]Then, by adding and subtracting some terms we express the dynamic duality gap in terms of the average loss of each player with respect to the objective \(f(\bm{\lambda},\pi;\bm{\theta})\). This gives

\[\mathfrak{G}_{T}(\bm{\lambda}^{*},\pi^{*},\bm{\theta}_{1:T}^{*}) =\frac{1}{T}\sum_{t=1}^{T}f(\bm{\lambda}^{*},\pi^{*};\bm{\theta}_{ t})-f(\bm{\lambda}^{*},\pi_{t};\bm{\theta}_{t})\] \[\quad+\frac{1}{T}\sum_{t=1}^{T}f(\bm{\lambda}^{*},\pi_{t};\bm{ \theta}_{t})-f(\bm{\lambda}_{t},\pi_{t};\bm{\theta}_{t})\] \[\quad+\frac{1}{T}\sum_{t=1}^{T}f(\bm{\lambda}_{t},\pi_{t};\bm{ \theta}_{t})-f(\bm{\lambda}_{t},\pi_{t};\bm{\theta}_{t}^{*}).\] (11)

Consider the first set of terms from the above expression. By definition of \(f\) in Equation (7), we immediately obtain the _instantaneous_ regret of the \(\pi\)-player as

\[f(\bm{\lambda}^{*},\pi^{*};\bm{\theta}_{t})-f(\bm{\lambda}^{*}, \pi_{t};\bm{\theta}_{t}) =\left\langle\bm{\theta}_{t},\bm{\Phi}^{\mathsf{T}}\bm{\mu}_{\bm {\lambda}^{*},\pi^{*}}-\bm{\Phi}^{\mathsf{T}}\bm{\mu}_{\bm{\lambda}^{*},\pi_{t }}\right\rangle\] \[=\sum_{x}\nu^{*}(x)\sum_{a}\left(\pi^{*}(a|x)-\pi_{t}(a|x)\right) q_{t}(x,a)\] \[=\sum_{x}\nu^{*}(x)\sum_{a}\left(\pi^{*}(a|x)-\pi_{t}(a|x)\right) q_{t}(x,a),\]

where \(\nu^{*}(x)=(1-\gamma)\nu_{0}(x)+\gamma\left\langle\bm{\psi}(x),\bm{\lambda}^{*}\right\rangle\). For the regret of the \(\bm{\lambda}\) and \(\bm{\theta}\)-players, notice that we can express the estimator \(\widehat{f}\) in terms of the objective \(f\) as follows:

\[\widehat{f}(\bm{\lambda},\pi;\bm{\theta}) =(1-\gamma)\left\langle\bm{\nu}_{0},\bm{v}_{\bm{\theta},\pi} \right\rangle+\left\langle\bm{\lambda},\bm{\omega}+\gamma\widehat{\bm{\Psi}} \bm{v}_{\bm{\theta},\pi}-\bm{\theta}\right\rangle\] \[=f(\bm{\lambda},\pi;\bm{\theta})+\gamma\left\langle\bm{\lambda}, \widehat{\bm{\Psi}}\bm{v}_{\bm{\theta},\pi}-\bm{\Psi}\bm{v}_{\bm{\theta},\pi} \right\rangle.\]

Taking advantage of this relation, we now consider the last two set of terms in Equation (11). Indeed, for the second set of terms in the equation, we write

\[f(\bm{\lambda}^{*},\pi_{t};\bm{\theta}_{t})-f(\bm{\lambda}_{t}, \pi_{t};\bm{\theta}_{t})\] \[\quad=\left\langle\bm{\lambda}^{*}-\bm{\lambda}_{t},\bm{\omega}+ \gamma\widehat{\bm{\Psi}}\bm{v}_{\bm{\theta}_{t},\pi_{t}}-\bm{\theta}_{t} \right\rangle-\gamma\left\langle\bm{\lambda}^{*},\widehat{\bm{\Psi}}\bm{v}_{ \bm{\theta}_{t},\pi_{t}}-\bm{\Psi}\bm{v}_{\bm{\theta}_{t},\pi_{t}}\right\rangle+ \gamma\left\langle\bm{\lambda}_{t},\widehat{\bm{\Psi}}\bm{v}_{\bm{\theta}_{t},\pi_{t}}-\bm{\Psi}\bm{v}_{\bm{\theta}_{t},\pi_{t}}\right\rangle,\]

Notice that the last equality follows directly from definition of \(\widehat{f}\). Along these lines, we can also express the last set of terms in Equation (11) as follows:

\[f(\bm{\lambda}_{t},\pi_{t};\bm{\theta}_{t})-f(\bm{\lambda}_{t}, \pi_{t};\bm{\theta}_{t}^{*})\] \[\quad=\widehat{f}(\bm{\lambda}_{t},\pi_{t};\bm{\theta}_{t})- \widehat{f}(\bm{\lambda}_{t},\pi_{t};\bm{\theta}_{t}^{*})-\gamma\left\langle \bm{\lambda}_{t},\widehat{\bm{\Psi}}\bm{v}_{\bm{\theta}_{t},\pi_{t}}-\bm{\Psi }\bm{v}_{\bm{\theta}_{t},\pi_{t}}\right\rangle+\gamma\left\langle\bm{\lambda }_{t},\widehat{\bm{\Psi}}\bm{v}_{\bm{\theta}_{t},\pi_{t}}-\bm{\Psi}\bm{v}_{\bm{ \theta}_{t}^{*},\pi_{t}}\right\rangle\] \[\quad=\left\langle\bm{\theta}_{t}-\bm{\theta}_{t}^{*},\bm{\Phi}^ {\mathsf{T}}\widehat{\bm{\mu}}_{\bm{\lambda}_{t},\pi_{t}}-\bm{\lambda}_{t} \right\rangle-\gamma\left\langle\bm{\lambda}_{t},\widehat{\bm{\Psi}}\bm{v}_{ \bm{\theta}_{t},\pi_{t}}-\bm{\Psi}\bm{v}_{\bm{\theta}_{t},\pi_{t}}\right\rangle +\gamma\left\langle\bm{\lambda}_{t},\widehat{\bm{\Psi}}\bm{v}_{\bm{\theta}_{t},\pi_{t}}-\bm{\Psi}\bm{v}_{\bm{\theta}_{t}^{*},\pi_{t}}\right\rangle,\]

Plugging the above derivations in the dynamic duality gap, we have that

\[\mathfrak{G}_{T}(\bm{\lambda}^{*},\pi^{*},\bm{\theta}_{1:T}^{*}) =\frac{1}{T}\sum_{t=1}^{T}\sum_{x}\nu^{*}(x)\sum_{a}\left(\pi^{* }(a|x)-\pi_{t}(a|x)\right)q_{t}(x,a)\] \[\quad+\frac{1}{T}\sum_{t=1}^{T}\left\langle\bm{\lambda}^{*}-\bm{ \lambda}_{t},\bm{\omega}+\gamma\widehat{\bm{\Psi}}\bm{v}_{\bm{\theta}_{t},\pi_{t }}-\bm{\theta}_{t}\right\rangle\] \[\quad+\frac{1}{T}\sum_{t=1}^{T}\left\langle\bm{\theta}_{t}-\bm{ \theta}_{t}^{*},\bm{\Phi}^{\mathsf{T}}\widehat{\bm{\mu}}_{\bm{\lambda}_{t},\pi_{t }}-\bm{\lambda}_{t}\right\rangle\] \[\quad+\frac{\gamma}{T}\sum_{t=1}^{T}\left\langle\bm{\lambda}^{*}, \bm{\Psi}\bm{v}_{\bm{\theta}_{t},\pi_{t}}-\widehat{\bm{\Psi}}\bm{v}_{\bm{\theta}_{t },\pi_{t}}\right\rangle+\frac{\gamma}{T}\sum_{t=1}^{T}\left\langle\bm{\lambda}_{t },\widehat{\bm{\Psi}}\bm{v}_{\bm{\theta}_{t}^{*},\pi_{t}}-\bm{\Psi}\bm{v}_{\bm{ \theta}_{t}^{*},\pi_{t}}\right\rangle.\]

This matches the claim of the lemma, thus completing the proof.

### Bounding the Regret Terms

In this section we provide the proofs of the our claims made in the main text about the regret of each player--precisely, Lemmas 4.3-4.5.

#### b.2.1 Proof of Lemma 4.3

Consider the regret of the \(\pi\)-player introduced in the main text as,

\[\mathfrak{R}_{T}\left(\pi^{*}\right) =\sum_{t=1}^{T}\sum_{x}\nu^{*}(x)\sum_{a}\left(\pi^{*}(a|x)-\pi_{t }(a|x)\right)q_{t}(x,a)\] \[\overset{(a)}{\leq}\frac{\sum_{x}\nu^{*}(x)\mathcal{D}_{\text{ KL}}\left(\pi^{*}\left(\cdot|x\right)\|\pi_{1}\left(\cdot|x\right)\right)}{ \alpha}+\frac{\alpha TR^{2}D_{\bm{\theta}}^{2}}{2}\] \[\overset{(b)}{\leq}\frac{\log A}{\alpha}+\frac{\alpha TR^{2}D_{ \bm{\theta}}^{2}}{2}.\]

We have used \((a)\) the standard Mirror descent analysis of softmax policy iterates recalled in Lemma E.1 for completeness, and \((b)\) the fact that \(\pi_{1}\) is a uniform policy and \(\bm{\nu}^{*}\in\Delta_{\mathcal{X}}\). Dividing the above expression by \(T\) completes the proof. 

#### b.2.2 Proof of Lemma 4.4

Recall the total regret of the \(\bm{\lambda}\)-player against any fixed comparator \(\bm{\lambda}^{*}\in\mathbb{R}^{d}\) is given as

\[\mathfrak{R}_{T}\left(\bm{\lambda}^{*}\right)=\sum_{t=1}^{T}\left\langle\bm{ \lambda}^{*}-\bm{\lambda}_{t},\bm{\omega}+\gamma\widehat{\bm{\Psi}}\bm{v}_{ \bm{\theta}_{t},\pi_{t}}-\bm{\theta}_{t}\right\rangle.\]

Since the feature-occupancy updates of Algorithm 1 simply implements a version of the composite-objective mirror descent scheme due to Duchi et al. (2010) we apply the standard analysis of this method (recalled as Lemma C.1 in Appendix C) to bound the instantaneous regret as

\[\left\langle\bm{\lambda}^{*}-\bm{\lambda}_{t},\bm{\omega}+\gamma \widehat{\bm{\Psi}}\bm{v}_{\bm{\theta}_{t},\pi_{t}}-\bm{\theta}_{t}\right\rangle\] \[\quad\leq\frac{\|\bm{\lambda}_{t}-\bm{\lambda}^{*}\|_{\bm{ \Lambda}_{n}^{-1}}^{2}-\|\bm{\lambda}_{t+1}-\bm{\lambda}^{*}\|_{\bm{\Lambda}_{ n}^{-1}}^{2}}{2\eta}+\frac{\eta}{2}\left\|\bm{\Lambda}_{n}\bm{g}_{\bm{\lambda}}(t) \right\|_{\bm{\Lambda}_{n}^{-1}}^{2}+\frac{\varrho}{2}\left\|\bm{\lambda}^{*} \right\|_{\bm{\Lambda}_{n}^{-1}}^{2}-\frac{\varrho}{2}\left\|\bm{\lambda}_{t+1 }\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}.\]

Then, taking the sum for \(t=1,\cdots,T\), evaluating the telescoping sums and upper-bounding some negative terms by zero yields the expression

\[\sum_{t=1}^{T} \langle\bm{\lambda}^{*}-\bm{\lambda}_{t},\bm{\omega}+\gamma\widehat {\bm{\Psi}}\bm{v}_{\bm{\theta}_{t},\pi_{t}}-\bm{\theta}_{t}\rangle\] \[\quad\leq\frac{\|\bm{\lambda}_{1}-\bm{\lambda}^{*}\|_{\bm{\Lambda }_{n}^{-1}}^{2}}{2\eta}+\frac{\eta}{2}\sum_{t=1}^{T}\left\|\bm{\Lambda}_{n}\bm{ g}_{\bm{\lambda}}(t)\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}+\frac{\varrho T}{2}\left\|\bm{ \lambda}^{*}\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}-\frac{\varrho}{2}\sum_{t=1}^{ T}\left\|\bm{\lambda}_{t}\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}\] \[\quad=\left(\frac{1}{2\eta}+\frac{\varrho T}{2}\right)\left\|\bm{ \lambda}^{*}\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}+\frac{\eta}{2}\sum_{t=1}^{T} \left\|\bm{\Lambda}_{n}\bm{g}_{\bm{\lambda}}(t)\right\|_{\bm{\Lambda}_{n}^{-1 }}^{2}-\frac{\varrho}{2}\sum_{t=1}^{T}\left\|\bm{\lambda}_{t}\right\|_{\bm{ \Lambda}_{n}^{-1}}^{2}.\]

In the equality, we have used that \(\bm{\lambda}_{1}=\bm{0}\). Dividing the resulting term by \(T\) gives the following bound on the average regret:

\[\frac{1}{T}\mathfrak{R}_{T}\left(\bm{\lambda}^{*}\right)\leq\left(\frac{1}{2T \eta}+\frac{\varrho}{2}\right)\left\|\bm{\lambda}^{*}\right\|_{\bm{\Lambda}_{n }^{-1}}^{2}+\frac{\eta}{2T}\sum_{t=1}^{T}\left\|\bm{\Lambda}_{n}\bm{g}_{\bm{ \lambda}}(t)\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}-\frac{\varrho}{2T}\sum_{t=1}^{ T}\left\|\bm{\lambda}_{t}\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}.\]

The proof is completed by applying Lemma C.2 to bound the norm of the gradients and plugging the result into the bound above.

#### b.2.3 Proof of Lemma 4.5

For the regret of the \(\bm{\theta}\)-player, first note that for any policy \(\pi\) with corresponding state-action value function weights \(\bm{\theta}^{\pi}=\bm{\omega}+\gamma\bm{\Psi}\bm{v}^{\pi}\), we have

\[\left\|\bm{\theta}^{\pi}\right\|_{2}=\left\|\bm{\omega}+\gamma\bm{\Psi}\bm{v}^{ \pi}\right\|_{2}\leq\left\|\bm{\omega}\right\|_{2}+\gamma\left\|\bm{\Psi}\bm{v} ^{\pi}\right\|_{2}\leq\sqrt{d}+\frac{\gamma\sqrt{d}}{(1-\gamma)}=\frac{\sqrt{ d}}{(1-\gamma)},\]

where we have used the triangle inequality in the second line. The last inequality uses Definition 2.1 and the fact that \(\left\|\bm{v}^{\pi}\right\|_{\infty}\leq\frac{1}{(1-\gamma)}\) since the rewards are bounded in \([0,1]\). Thanks to this bound, we can ensure that \(\bm{\theta}_{t}^{*}=\bm{\theta}^{\pi_{t}}\in\mathbb{B}_{d}(D_{\bm{\theta}})\) holds with the choice \(D_{\bm{\theta}}=\sqrt{d}/\left(1-\gamma\right)\) as required by the lemma.Therefore, by construction of value-parameter updates in Algorithm 1, we have

\[\langle\bm{\theta}_{t}-\bm{\theta}_{t}^{*},\bm{\Phi}^{\tau}\widehat{\bm{\mu}} _{\bm{\lambda}_{t},\pi_{t}}-\bm{\lambda}_{t}\rangle\leq 0\qquad\text{for }t=1, \cdots,T.\]

This concludes the proof. 

### Bounding the gap-estimation error

In this section, we provide the proof of Lemma 4.6 which bounds the gap-estimation error defined for an arbitrary comparator sequence \((\bm{\lambda}^{*},\pi_{t},\bm{\theta}_{t}^{*})\in\mathbb{R}^{d}\times\Pi\left( D_{\pi}\right)\times\mathbb{B}_{d}(D_{\bm{\theta}})\) for \(t=1,\ldots,T\) as,

\[\text{err}_{\widehat{\bm{\Psi}}}=\sum_{t=1}^{T}\langle\bm{\lambda}^{*},\left( \bm{\Psi}-\widehat{\bm{\Psi}}\right)\bm{v}_{\bm{\theta}_{t},\pi_{t}}\rangle+ \sum_{t=1}^{T}\langle\bm{\lambda}_{t},\left(\widehat{\bm{\Psi}}-\bm{\Psi} \right)\bm{v}_{\bm{\theta}_{t}^{*},\pi_{t}}\rangle.\]

We control the above term with the now-classic techniques developed by Jin et al. (2020) for bounding model-estimation errors for linear MDPs. These results also make heavy use of self-normalized tail inequalities as popularized by Abbasi-Yadkori et al. (2011) (see also Lattimore and Szepesvari, 2020). To make this clear, we first note that, for any \(\bm{\lambda}\in\mathbb{R}^{d}\), \(\bm{v}\in\mathbb{R}^{X}\), and \(\xi>0\),

\[\left\langle\bm{\lambda},\left(\widehat{\bm{\Psi}}-\bm{\Psi}\right)\bm{v} \right\rangle\overset{(a)}{\leq}\left\|\bm{\lambda}\right\|_{\bm{\Lambda}_{n }^{-1}}\left\|\bm{\Lambda}_{n}\left(\widehat{\bm{\Psi}}-\bm{\Psi}\right)\bm{v }\right\|_{\bm{\Lambda}_{n}^{-1}}\overset{(b)}{\leq}\frac{\left\|\bm{\lambda} \right\|_{\bm{\Lambda}_{n}^{-1}}^{2}}{2T\xi}+\frac{T\xi}{2}\left\|\bm{\Lambda} _{n}\left(\widehat{\bm{\Psi}}-\bm{\Psi}\right)\bm{v}\right\|_{\bm{\Lambda}_{n }^{-1}}^{2}.\]

Here, we have first used \((a)\) the Cauchy-Schwarz inequality, and \((b)\) the inequality of arithmetic and geometric means. Using this expression, we can upper-bound the gap estimation error as

\[\text{err}_{\widehat{\bm{\Psi}}} \leq\frac{\left\|\bm{\lambda}^{*}\right\|_{\bm{\Lambda}_{n}^{-1}} ^{2}}{2\xi}+\sum_{t=1}^{T}\frac{\left\|\bm{\lambda}_{t}\right\|_{\bm{\Lambda} _{n}^{-1}}^{2}}{2T\xi}\] \[\quad+\frac{T\xi}{2}\sum_{t=1}^{T}\left\|\bm{\Lambda}_{n}\left( \widehat{\bm{\Psi}}-\bm{\Psi}\right)\bm{v}_{\bm{\theta}_{t},\pi_{t}}\right\|_{ \bm{\Lambda}_{n}^{-1}}^{2}+\frac{T\xi}{2}\sum_{t=1}^{T}\left\|\bm{\Lambda}_{n} \left(\widehat{\bm{\Psi}}-\bm{\Psi}\right)\bm{v}^{\pi_{t}}\right\|_{\bm{ \Lambda}_{n}^{-1}}^{2}.\] (12)

To control the last two terms in the bound, we employ two main lemmas stated below.

**Lemma B.1**.: _Let \(\bm{v}\in[-B,B]^{X}\). With probability at least \(1-\delta\), we have that:_

\[\left\|\bm{\Lambda}_{n}\left(\widehat{\bm{\Psi}}-\bm{\Psi}\right)\bm{v}\right\| _{\bm{\Lambda}_{n}^{-1}}\leq\frac{2B}{\sqrt{n}}\sqrt{d\log\!\left(1+\frac{R^{2 }}{d\beta}\right)+2\log\frac{1}{\delta}}+B\sqrt{d\beta}.\]

**Lemma B.2**.: _Consider the function class,_

\[\mathcal{V}=\Big{\{}\bm{v}_{\pi,\bm{\theta}}:\mathcal{X}\to[-RD_{\bm{\theta}}, RD_{\bm{\theta}}]\Big{|}\pi\in\Pi\left(D_{\pi}\right),\bm{\theta}\in\mathbb{B}_{d}(D_{ \bm{\theta}})\Big{\}},\]

_Let \(D_{\pi}=\alpha TD_{\bm{\theta}}\) so that \(\bm{v}_{\theta_{1},\pi_{t}}\in\mathcal{V}\). For any \(\epsilon\in(0,1)\), with probability at least \(1-\delta\),_

\[\left\|\bm{\Lambda}_{n}\left(\widehat{\bm{\Psi}}-\bm{\Psi}\right) \bm{v}_{\theta_{t},\pi_{t}}\right\|_{\bm{\Lambda}_{n}^{-1}}\] \[\qquad\qquad\leq\frac{2RD_{\bm{\theta}}}{\sqrt{n}}\sqrt{d\log\! \left(1+\frac{R^{2}}{d\beta}\right)+4d\log\left(1+\frac{4\alpha TR^{2}D_{\bm{ \theta}}^{2}}{\epsilon}\right)+2\log\frac{1}{\delta}}\] \[\qquad\qquad+RD_{\bm{\theta}}\sqrt{d\beta}+\left(\sqrt{\beta}+1 \right)\epsilon\sqrt{d}.\]The rather tedious but otherwise standard proofs of the above lemmas are given in Appendix D. Now, taking into account the fact that for \(D_{\bm{\theta}}\) large enough \(\bm{v}^{\pi_{t}}\in\mathcal{V}\) yields Corollary B.3 below.

**Corollary B.3**.: _In the linear MDP setting described in Definition 2.1, notice that \(\bm{v}^{\pi_{t}}=\bm{v}_{\bm{\theta}^{\pi_{t}},\pi_{t}}\) with \(\bm{\theta}^{\pi_{t}}=\bm{\omega}+\gamma\bm{\Psi}\bm{v}_{\bm{\theta}^{\pi_{t}},\pi_{t}}\). Furthermore, with \(RD_{\bm{\theta}}=R\sqrt{d}/(1-\gamma)\geq\left\|\bm{v}^{\pi_{t}}\right\|_{\infty}\) and \(D_{\pi}=\alpha TD_{\bm{\theta}}\) we have that \(\bm{v}^{\pi_{t}}\in\mathcal{V}\). Therefore, for all \(\epsilon>0\) with probability at least \(1-\delta\), the following holds:_

\[\left\|\bm{\Lambda}_{n}\left(\widehat{\bm{\Psi}}-\bm{\Psi}\right) \bm{v}^{\pi_{t}}\right\|_{\bm{\Lambda}_{n}^{-1}}\] \[\qquad\leq\frac{2\sqrt{d}}{\sqrt{n}\left(1-\gamma\right)}\sqrt{ d\log\!\left(1+\frac{R^{2}}{d\beta}\right)+4d\log\left(1+\frac{4\alpha TR^{2}d}{ \epsilon\left(1-\gamma\right)^{2}}\right)+2\log\frac{1}{\delta}}\] \[\qquad\quad+\frac{d\sqrt{\beta}}{\left(1-\gamma\right)}+\left( \sqrt{\beta}+1\right)\epsilon\sqrt{d}.\]

In the following, we apply these results to bound the last two terms in the right-hand side of Equation (12). Precisely, using \(D_{\bm{\theta}}=\sqrt{d}/(1-\gamma)\), \(\alpha=\sqrt{2\log A/R^{2}D_{\bm{\theta}}^{2}T}=\sqrt{2\left(1-\gamma\right)^ {2}\log A/R^{2}dT}\) (which follows from optimizing the regret of the \(\pi\)-player in Lemma 4.3), as well as \(\epsilon=4\alpha R^{2}d/\left(1-\gamma\right)^{2}=\frac{\sqrt{32R^{2}d\log A}}{ \left(1-\gamma\right)\sqrt{T}}\) and \(\beta=R^{2}/dT\) we have that in any round \(t\), with probability at least \(1-\delta\),

Likewise,

\[\left\|\bm{\Lambda}_{n}\left(\widehat{\bm{\Psi}}-\bm{\Psi}\right)\bm{v}^{\pi_{ t}}\right\|_{\bm{\Lambda}_{n}^{-1}}\leq\sqrt{\frac{20d^{2}\log\left(2T/\delta \right)}{n\left(1-\gamma\right)^{2}}}+\sqrt{\frac{R^{2}d}{T\left(1-\gamma \right)^{2}}}+\sqrt{\frac{R^{4}d\log A}{T^{2}}}+\sqrt{\frac{32R^{2}d^{2}\log A }{T\left(1-\gamma\right)^{2}}}.\]

Then plugging in the above bounds in Equation (12) with \(T\geq\frac{2R^{2}n\log A}{\log(1/\delta)}\), it follows that for \(D_{\widehat{\bm{\Psi}}}=\sqrt{\frac{320d^{2}\log(2T/\delta)}{n\left(1-\gamma \right)^{2}}}\),

\[\text{err}_{\widehat{\bm{\Psi}}}\leq\frac{\left\|\bm{\lambda}^{*}\right\|_{ \bm{\Lambda}_{n}^{-1}}^{2}}{2\xi}+\sum_{t=1}^{T}\frac{\left\|\bm{\lambda}_{t} \right\|_{\bm{\Lambda}_{n}^{-1}}^{2}}{2T\xi}+T^{2}\xi D_{\widehat{\bm{\Psi}}}^ {2},\]

with probability at least \(1-\delta\), thus proving the claim. 

### Full proof of Theorem 3.1

To control the expected suboptimality of the output policy \(\pi_{J}\) of Algorithm 1, we study the repective regret and gap-estimation error at the selected comparator points. Precisely, combining Lemma 4.1 and 4.2 when \(\left(\bm{\lambda}^{*},\pi^{*},\bm{\theta}_{1:T}^{*}\right)=\left(\bm{\Phi}^{ \pi}\bm{\mu}^{\pi^{*}},\pi^{*},\bm{\theta}^{\pi_{t}}\right)\in\mathbb{R}^{d} \times\Pi\left(D_{\pi}\right)\times\mathbb{B}_{d}(D_{\theta})\), we have that,

\[\mathbb{E}_{J}\left[\left\langle\bm{\mu}^{\pi^{*}}-\bm{\mu}^{\pi_{J}},\bm{r} \right\rangle\right]=\frac{1}{T}\mathfrak{R}_{T}\left(\pi^{*}\right)+\frac{1} {T}\mathfrak{R}_{T}\left(\bm{\lambda}^{\pi^{*}}\right)+\frac{1}{T}\mathfrak{R }_{T}\left(\bm{\theta}_{1:T}^{*}\right)+\frac{\gamma}{T}\text{err}_{ \widehat{\bm{\Psi}}}.\] (13)

where,

\[\mathfrak{R}_{T}\left(\pi^{*}\right) =\sum_{t=1}^{T}\sum_{x}\nu^{*}(x)\sum_{a}\left(\pi^{*}(a|x)-\pi_{ t}(a|x)\right)q_{t}(x,a),\] \[\mathfrak{R}_{T}\left(\bm{\lambda}^{\pi^{*}}\right) =\sum_{t=1}^{T}\left\langle\bm{\lambda}^{\pi^{*}}-\bm{\lambda}_{t },\bm{\omega}+\gamma\widehat{\bm{\Psi}}\bm{v}_{\bm{\theta}_{t},\pi_{t}}-\bm{ \theta}_{t}\right\rangle,\] \[\mathfrak{R}_{T}\left(\bm{\theta}_{1:T}^{*}\right) =\sum_{t=1}^{T}\left\langle\bm{\theta}_{t}-\bm{\theta}_{t}^{\pi_{t }},\bm{\Phi}^{\gamma}\widehat{\bm{\mu}}_{\bm{\lambda}_{t},\pi_{t}}-\bm{\lambda }_{t}\right\rangle\] \[\text{err}_{\widehat{\bm{\Psi}}} =\sum_{t=1}^{T}\bigl{\langle}\bm{\lambda}^{\pi^{*}},\bigl{(}\bm{ \Psi}-\widehat{\bm{\Psi}}\bigr{)}\bm{v}_{\bm{\theta}_{t},\pi_{t}}\bigr{\rangle}+ \sum_{t=1}^{T}\bigl{\langle}\bm{\lambda}_{t},\bigl{(}\widehat{\bm{\Psi}}-\bm{ \Psi}\bigr{)}\bm{v}^{\pi_{t}}\bigr{\rangle}.\]Notice that for this choice of \(\bm{\lambda}^{*}\), by Definition 2.1\(\nu^{*}(x)=(1-\gamma)\nu_{0}(x)+\gamma\langle\bm{\psi}(x),\bm{\mu}^{*}\rangle=\nu^ {\pi^{*}}(x)\) is a valid state occupancy measure. Next, introducing the bounds stated in Lemmas 4.3-4.6 under the required conditions \(D_{\bm{\theta}}=\sqrt{d}/\left(1-\gamma\right)\), \(\alpha=\sqrt{2\left(1-\gamma\right)^{2}\log A/R^{2}dT}\), \(D_{\pi}=\alpha TD_{\bm{\theta}}=\sqrt{2T\log A/R^{2}}\) and \(T\geq\frac{2R^{2}n\log A}{\log\left(1/\delta\right)}\), as well as \(\xi\geq 0\) and \(D_{\widehat{\bm{\Psi}}}=\sqrt{\frac{320d^{2}\log\left(2T/\delta\right)}{n \left(1-\gamma\right)^{2}}}\) yields,

\[\mathbb{E}_{J}\left[\left\langle\bm{\mu}^{\pi^{*}}-\bm{\mu}^{\pi_ {J}},\bm{r}\right\rangle\right] \leq\sqrt{\frac{2R^{2}d\log A}{\left(1-\gamma\right)^{2}T}}\] \[\quad+\left(\frac{1}{2\eta T}+\frac{\varrho}{2}\right)\left\| \bm{\lambda}^{\pi^{*}}\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}+\frac{\eta C}{2}- \frac{\varrho}{2T}\sum_{t=1}^{T}\left\|\bm{\lambda}_{t}\right\|_{\bm{\Lambda} _{n}^{-1}}^{2}\] \[\quad+\frac{\gamma}{2T\xi}\left(\left\|\bm{\lambda}^{\pi^{*}} \right\|_{\bm{\Lambda}_{n}^{-1}}^{2}+\frac{1}{T}\sum_{t=1}^{T}\left\|\bm{ \lambda}_{t}\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}\right)+\gamma T\xi D_{ \widehat{\bm{\Psi}}}^{2},\]

with probability at least \(1-\delta\), where \(C=6\beta\left(d+D_{\bm{\theta}}^{2}\right)+3d\left(1+RD_{\bm{\theta}}\right)^{ 2}+3\gamma^{2}dR^{2}D_{\bm{\theta}}^{2}\). Rearranging the bound and selecting \(\varrho=\gamma/\xi T\) to eliminate the (potentially large) norm of the iterates, we obtain

\[\mathbb{E}_{J}\left[\left\langle\bm{\mu}^{\pi^{*}}-\bm{\mu}^{\pi_ {J}},\bm{r}\right\rangle\right] \leq\sqrt{\frac{d\log\left(1/\delta\right)}{n\left(1-\gamma \right)^{2}}}+\left(\frac{1}{2\eta T}+\frac{\varrho}{2}+\frac{\gamma}{2\xi T} \right)\left\|\bm{\lambda}^{\pi^{*}}\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}+\frac {\eta C}{2}\] \[\quad+\left(\frac{\gamma}{\xi T}-\varrho\right)\frac{1}{2T}\sum _{t=1}^{T}\left\|\bm{\lambda}_{t}\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}+\gamma T \xi D_{\widehat{\bm{\Psi}}}^{2}\] \[=\sqrt{\frac{d\log\left(1/\delta\right)}{n\left(1-\gamma\right)^ {2}}}+\left(\frac{1}{2\eta T}+\frac{\gamma}{\xi T}\right)\left\|\bm{\lambda} ^{\pi^{*}}\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}+\frac{\eta C}{2}+\gamma T\xi D _{\widehat{\bm{\Psi}}}^{2}.\]

Furthermore, choosing \(\xi=1/TD_{\widehat{\bm{\Psi}}}\) i.e \(\varrho=\gamma D_{\widehat{\bm{\Psi}}}\), we further simplify the above bound on the regret in terms of the optimization error arising from the policy and feature occupancy updates as,

\[\mathbb{E}_{J}\left[\left\langle\bm{\mu}^{\pi^{*}}-\bm{\mu}^{\pi_ {J}},\bm{r}\right\rangle\right]\leq\sqrt{\frac{d\log\left(1/\delta\right)}{ n\left(1-\gamma\right)^{2}}}+\frac{1}{2\eta T}\left\|\bm{\lambda}^{\pi^{*}} \right\|_{\bm{\Lambda}_{n}^{-1}}^{2}+\frac{\eta C}{2}+\gamma\left(\left\|\bm{ \lambda}^{\pi^{*}}\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}+1\right)D_{\widehat{ \bm{\Psi}}}.\]

Moving our attention to our earlier bound on the norm of \(\bm{g}_{\bm{\lambda}}(t)\),

\[C=6\beta\left(d+D_{\bm{\theta}}^{2}\right)+3d\left(1+RD_{\bm{\theta}}\right)^{ 2}+3\gamma^{2}dR^{2}D_{\bm{\theta}}^{2}\leq\frac{27R^{2}d^{2}}{\left(1-\gamma \right)^{2}}.\]

The inequality follows from our earlier choice of \(\beta=R^{2}/dT\) and that \(T\geq 1/d^{2}\). Plugging the values of \(C\) and \(D_{\widehat{\bm{\Psi}}}\) in the bound, then choosing \(\eta=\sqrt{\frac{\left(1-\gamma\right)^{2}}{27R^{2}d^{2}T}}\) and using the condition \(T\geq\frac{2R^{2}\ln\log A}{\log\left(1/\delta\right)}\), we have that with probability at least \(1-\delta\),

\[\mathbb{E}_{J}\left[\left\langle\bm{\mu}^{\pi^{*}}-\bm{\mu}^{\pi_ {J}},\bm{r}\right\rangle\right] \leq\sqrt{\frac{d\log\left(1/\delta\right)}{n\left(1-\gamma \right)^{2}}}+\left(\left\|\bm{\lambda}^{\pi^{*}}\right\|_{\bm{\Lambda}_{n}^{- 1}}^{2}+1\right)\sqrt{\frac{27d^{2}\log\left(1/\delta\right)}{8n\log A\left(1- \gamma\right)^{2}}}\] \[\quad+\gamma\left(\left\|\bm{\lambda}^{\pi^{*}}\right\|_{\bm{ \Lambda}_{n}^{-1}}^{2}+1\right)\sqrt{\frac{320d^{2}\log\left(2T/\delta\right)}{ n\left(1-\gamma\right)^{2}}}\] \[=\mathcal{O}\left(\frac{\left\|\bm{\lambda}^{\pi^{*}}\right\|_{\bm{ \Lambda}_{n}^{-1}}^{2}+1}{\left(1-\gamma\right)}\sqrt{\frac{d^{2}\log\left(2T/ \delta\right)}{n}}\right).\]

This completes the proof.

Missing proofs of Section B.2.

**Lemma C.1**.: _(cf. Lemma 1 of Duchi et al. [2010]) Let \(\bm{g}_{\bm{\lambda}}(t)=\bm{\omega}+\gamma\widehat{\bm{\Psi}}\bm{v}_{\bm{\theta}_ {t},\pi_{t}}-\bm{\theta}_{t}\) Given \(\bm{\lambda}_{1}=\bm{0}\) and \(\varrho,\eta>0\) and the sequence of iterates \(\{\bm{\lambda}_{t}\}_{t=2}^{T}\) defined for \(t=1,\cdots,T\) as:_

\[\bm{\lambda}_{t+1}=\underset{\bm{\lambda}\in\mathbb{R}^{d}}{\text{arg min}}\Big{\{}-\langle\bm{\lambda},\bm{g}_{\bm{\lambda}}(t) \rangle+\frac{1}{2\eta}\left\|\bm{\lambda}-\bm{\lambda}_{t}\right\|_{\bm{ \Lambda}_{n}^{-1}}^{2}+\frac{\varrho}{2}\left\|\bm{\lambda}\right\|_{\bm{ \Lambda}_{n}^{-1}}^{2}\Big{\}}.\] (14)

_Then, for any \(\bm{\lambda}^{*}\in\mathbb{R}^{d}\),_

\[\langle\bm{\lambda}^{*}-\bm{\lambda}_{t},\bm{\omega}+\gamma \widehat{\bm{\Psi}}\bm{v}_{\bm{\theta}_{t},\pi_{t}}-\bm{\theta}_{t}\rangle\] \[\quad\leq\frac{\left\|\bm{\lambda}_{t}-\bm{\lambda}^{*}\right\|_ {\bm{\Lambda}_{n}^{-1}}^{2}-\left\|\bm{\lambda}_{t+1}-\bm{\lambda}^{*}\right\|_ {\bm{\Lambda}_{n}^{-1}}^{2}}{2\eta}+\frac{\eta}{2}\left\|\bm{\Lambda}_{n}\bm{ g}_{\bm{\lambda}}(t)\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}+\frac{\varrho}{2}\left\|\bm{ \lambda}^{*}\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}-\frac{\varrho}{2}\left\|\bm{ \lambda}_{t+1}\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}.\]

Proof.: The proof of Lemma C.1 follows directly from the referenced Lemma from Duchi et al. [2010]. Consider,

\[\langle\bm{\lambda}^{*}-\bm{\lambda}_{t},\bm{g}_{\bm{\lambda}}(t) \rangle+\frac{\varrho}{2}\left\|\bm{\lambda}_{t+1}\right\|_{\bm{\Lambda}_{n}^{ -1}}^{2}-\frac{\varrho}{2}\left\|\bm{\lambda}^{*}\right\|_{\bm{\Lambda}_{n}^{ -1}}^{2}\] \[\quad=\left\langle\bm{\lambda}_{t+1}-\bm{\lambda}^{*},-\bm{g}_{ \bm{\lambda}}(t)+\frac{1}{\eta}\bm{\Lambda}_{n}^{-1}\left(\bm{\lambda}_{t+1}- \bm{\lambda}_{t}\right)+\varrho\bm{\Lambda}_{n}^{-1}\bm{\lambda}_{t+1}\right\rangle +\langle\bm{\lambda}_{t+1}-\bm{\lambda}_{t},\bm{g}_{\bm{\lambda}}(t)\rangle\] \[\quad\quad-\left\langle\bm{\lambda}_{t+1}-\bm{\lambda}^{*},\frac{ 1}{\eta}\bm{\Lambda}_{n}^{-1}\left(\bm{\lambda}_{t+1}-\bm{\lambda}_{t}\right)+ \varrho\bm{\Lambda}_{n}^{-1}\bm{\lambda}_{t+1}\right\rangle+\frac{\varrho}{2} \left\|\bm{\lambda}_{t+1}\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}-\frac{\varrho}{2 }\left\|\bm{\lambda}^{*}\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}\] \[\quad\leq\frac{1}{\eta}\sup_{\bm{y}\in\mathbb{R}^{d}}\left(\left \langle\bm{y},\eta\bm{\Lambda}_{n}^{1/2}\bm{g}_{\bm{\lambda}}(t)\right\rangle- \frac{1}{2}\left\|\bm{y}\right\|_{2}^{2}\right)+\frac{1}{2\eta}\left(\left\| \bm{\lambda}^{*}-\bm{\lambda}_{t}\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}-\left\| \bm{\lambda}^{*}-\bm{\lambda}_{t+1}\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}\right)\] \[\quad\stackrel{{(d)}}{{=}}\frac{\eta}{2}\left\|\bm{ \Lambda}_{n}\bm{g}_{\bm{\lambda}}(t)\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}+\frac{ 1}{2\eta}\left(\left\|\bm{\lambda}^{*}-\bm{\lambda}_{t}\right\|_{\bm{\Lambda}_{ n}^{-1}}^{2}-\left\|\bm{\lambda}^{*}-\bm{\lambda}_{t+1}\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}\right)\]

We have used

* The first order optimality condition on Equation (14): For any \(\bm{\lambda}\in\mathbb{R}^{d}\), \[\left\langle\bm{\lambda}_{t+1}-\bm{\lambda},-\bm{g}_{\bm{\lambda}}(t)+\frac{1 }{\eta}\bm{\Lambda}_{n}^{-1}\left(\bm{\lambda}_{t+1}-\bm{\lambda}_{t}\right)+ \varrho\bm{\Lambda}_{n}^{-1}\bm{\lambda}_{t+1}\right\rangle\leq 0.\]
* The relation: \[\varrho\left\langle\bm{\lambda}^{*},\bm{\Lambda}_{n}^{-1}\bm{\lambda}_{t+1} \right\rangle-\frac{\varrho}{2}\left\|\bm{\lambda}_{t+1}\right\|_{\bm{\Lambda} _{n}^{-1}}^{2}-\frac{\varrho}{2}\left\|\bm{\lambda}^{*}\right\|_{\bm{\Lambda}_{ n}^{-1}}^{2}=-\frac{\varrho}{2}\left\|\bm{\lambda}_{t+1}-\bm{\lambda}^{*}\right\|_{\bm{ \Lambda}_{n}^{-1}}^{2}\leq 0.\]
* By definition of the squared \(L^{2}\)-norm for vectors \(\bm{a}=\bm{\Lambda}_{n}^{-1/2}\left(\bm{\lambda}_{t+1}-\bm{\lambda}^{*}\right)\) and \(\bm{b}=\bm{\Lambda}_{n}^{-1/2}\left(\bm{\lambda}_{t}-\bm{\lambda}_{t+1}\right)\): \[\langle\bm{a},\bm{b}\rangle=\frac{1}{2}\left(-\left\|\bm{b}\right\|_{2}^{2}+ \left\|\bm{a}+\bm{b}\right\|_{2}^{2}-\left\|\bm{a}\right\|_{2}^{2}\right).\] Note that \(\bm{a}\) and \(\bm{b}\) are well defined since \(\bm{\Lambda}_{n}\) is both symmetric and positive definite.

\((d)\) By definition of the Fenchel conjugate of \(\frac{1}{2}\left\|\bm{y}\right\|_{2}^{2}\) for \(\bm{y}\in\mathbb{R}^{d}\).

Rearranging the terms and plugging in \(\bm{g_{\lambda}}(t)=\bm{\omega}+\gamma\widehat{\bm{\Psi}}\bm{v_{\bm{\theta}_{t}, \pi_{t}}}-\bm{\theta}_{t}\) completes the proof. 

Finally, we will use the following result that bounds the gradient norms appearing in the bound above.

**Lemma C.2**.: _Under the conditions of the linear MDP setting we have that,_

\[\left\|\bm{\Lambda}_{n}\bm{g_{\lambda}}(t)\right\|_{\bm{\Lambda}_{n}^{-1}}^{2} \leq 6\beta\left(d+D_{\bm{\theta}}^{2}\right)+3d\left(1+RD_{\bm{\theta}} \right)^{2}+3\gamma^{2}dR^{2}D_{\bm{\theta}}^{2}.\]

Proof.: Recall that for \(t=1,\cdots,T\)\(\bm{g_{\lambda}}(t)=\bm{\omega}+\gamma\widehat{\bm{\Psi}}\bm{v_{\bm{\theta}_{t}, \pi_{t}}}-\bm{\theta}_{t}\). Then,

\[\left\|\bm{\Lambda}_{n}\bm{g_{\lambda}}(t)\right\|_{\bm{\Lambda}_ {n}^{-1}}^{2}=\left\|\bm{\Lambda}_{n}\Big{[}\bm{\omega}+\gamma\widehat{\bm{ \Psi}}\bm{v_{\bm{\theta}_{t},\pi_{t}}}-\bm{\theta}_{t}\Big{]}\right\|_{\bm{ \Lambda}_{n}^{-1}}^{2}\] \[\qquad=\left\|\beta\left(\bm{\omega}-\bm{\theta}_{t}\right)+ \frac{1}{n}\sum_{i=1}^{n}\bm{\varphi}_{i}\left(r\left(x_{i},a_{i}\right)- \left\langle\bm{\varphi}_{i},\bm{\theta}_{t}\right\rangle\right)+\gamma\bm{ \Lambda}_{n}\widehat{\bm{\Psi}}\bm{v_{\bm{\theta}_{t},\pi_{t}}}\right\|_{\bm{ \Lambda}_{n}^{-1}}^{2}\] \[\qquad\leq 3\left\|\beta\left(\bm{\omega}-\bm{\theta}_{t}\right) \right\|_{\bm{\Lambda}_{n}^{-1}}^{2}+3\left\|\frac{1}{n}\sum_{i=1}^{n}\bm{ \varphi}_{i}\left(r\left(x_{i},a_{i}\right)-\left\langle\bm{\varphi}_{i},\bm{ \theta}_{t}\right\rangle\right)\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}+3\gamma^{2 }\left\|\bm{\Lambda}_{n}\widehat{\bm{\Psi}}\bm{v_{\bm{\theta}_{t},\pi_{t}}} \right\|_{\bm{\Lambda}_{n}^{-1}}^{2}.\]

Now to bound each of the three terms, we use that

\[\left\|\beta\left(\bm{\omega}-\bm{\theta}_{t}\right)\right\|_{\bm{\Lambda}_{n }^{-1}}^{2}\leq 2\beta^{2}\left\|\bm{\Lambda}_{n}^{-1}\right\|_{2}\left(d+D_{ \bm{\theta}}^{2}\right)\leq 2\beta\left(d+D_{\bm{\theta}}^{2}\right),\]

where the first inequality uses the assumption that \(\left\|\bm{\omega}\right\|_{2}\leq\sqrt{d}\) (cf. Definition 2.1) and \(\bm{\theta}_{t}\in\mathbb{B}_{d}(D_{\bm{\theta}})\). Next, we have that

\[\left\|\frac{1}{n}\sum_{i=1}^{n}\bm{\varphi}_{i}\left(r\left(x_{ i},a_{i}\right)-\left\langle\bm{\varphi}_{i},\bm{\theta}_{t}\right\rangle \right)\right\|_{\bm{\Lambda}_{n}^{-1}}^{2} \leq\frac{1}{n}\sum_{i=1}^{n}\left\|\bm{\varphi}_{i}\right\|_{\bm {\Lambda}_{n}^{-1}}^{2}\left|r\left(x_{i},a_{i}\right)-\left\langle\bm{\varphi }_{i},\bm{\theta}_{t}\right\rangle\right|^{2}\] \[\leq d\left(1+RD_{\bm{\theta}}\right)^{2}.\]

The last step follows from the fact that the rewards are bounded in \([0,1]\), \(\left\|\bm{\varphi}_{i}\right\|\leq R\), \(\bm{\theta}_{t}\in\mathbb{B}_{d}(D_{\bm{\theta}})\) and Equation (17). The last remaining term is bounded as

\[\left\|\bm{\Lambda}_{n}\widehat{\bm{\Psi}}\bm{v_{\bm{\theta}_{t}, \pi_{t}}}\right\|_{\bm{\Lambda}_{n}^{-1}}^{2} =\left\|\frac{1}{n}\sum_{i=1}^{n}\bm{\varphi}_{i}\bm{v_{\bm{\theta }_{t},\pi_{t}}}\left(x_{i}^{\prime}\right)\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}\] \[\leq\frac{1}{n}\sum_{i=1}^{n}\left\|\bm{\varphi}_{i}\right\|_{\bm{ \Lambda}_{n}^{-1}}^{2}\left\|\bm{v_{\bm{\theta}_{t},\pi_{t}}}\right\|_{\infty} ^{2}\leq dR^{2}D_{\bm{\theta}}^{2}\]

Therefore, we obtain

\[\left\|\bm{\Lambda}_{n}\bm{g_{\lambda}}(t)\right\|_{\bm{\Lambda}_{n}^{-1}}^{2} \leq 6\beta\left(d+D_{\bm{\theta}}^{2}\right)+3d\left(1+RD_{\bm{\theta}} \right)^{2}+3\gamma^{2}dR^{2}D_{\bm{\theta}}^{2}\]

and this completes the proof.

Missing proofs of Section B.3

In this section, we prove the lemmas stated in Section B.3.

### Proof of Lemma B.1

By definition of \(\bm{\Lambda}_{n}\) Section 3 and \(\widehat{\bm{\Psi}}\) in Equation (8), we can write:

\[\bm{\Lambda}_{n}\left(\widehat{\bm{\Psi}}-\bm{\Psi}\right)\bm{v} =\bm{\Lambda}_{n}\left(\frac{1}{n}\bm{\Lambda}_{n}^{-1}\sum_{i=1} ^{n}\bm{\varphi}_{i}\bm{e}_{x_{i}^{{}^{\prime}}}^{\intercal}\right)\bm{v}- \left(\beta\bm{I}_{n}+\frac{1}{n}\sum_{i=1}^{n}\bm{\varphi}_{i}\bm{\varphi}_{i}^ {\intercal}\right)\bm{\Psi}\bm{v}\] \[=\frac{1}{n}\sum_{i=1}^{n}\bm{\varphi}_{i}[v\left(x_{i}^{\prime} \right)-\left\langle\bm{p}\left(\cdot|x_{i},a_{i}\right),\bm{v}\right\rangle]- \beta\bm{\Psi}\bm{v}\]

In the last equality we used definition 2.1 to write \(\bm{\varphi}_{i}^{\intercal}\bm{\Psi}=\bm{p}\left(\cdot|x_{i},a_{i}\right)^{\intercal}\). Let \(\xi_{i}=v\left(x_{i}^{\prime}\right)-\left\langle\bm{p}\left(\cdot|x_{i},a_{i }\right),\bm{v}\right\rangle\). Then,

\[\left\|\bm{\Lambda}_{n}\left(\widehat{\bm{\Psi}}-\bm{\Psi}\right)\bm{v} \right\|_{\bm{\Lambda}_{n}^{-1}}\leq\left\|\frac{1}{n}\sum_{i=1}^{n}\bm{ \varphi}_{i}\xi_{i}\right\|_{\bm{\Lambda}_{n}^{-1}}+\left\|\beta\bm{\Psi}\bm{v }\right\|_{\bm{\Lambda}_{n}^{-1}}.\]

We easily control the second term with the relation:

\[\left\|\beta\bm{\Psi}\bm{v}\right\|_{\bm{\Lambda}_{n}^{-1}}\leq\beta\left\| \bm{\Lambda}_{n}^{-1/2}\right\|_{2}\left\|\bm{\Psi}\bm{v}\right\|_{2}\leq B \sqrt{d\beta}\] (15)

The last inequality follows from the fact that \(\left\|\bm{\Lambda}_{n}^{-1/2}\right\|_{2}\leq 1/\sqrt{\beta}\) and by definition 2.1\(\left\|\bm{\Psi}\bm{v}\right\|_{2}\leq B\sqrt{d}\) for \(\bm{v}\in[-B,B]^{X}\).

Now, to handle the first term, let \(D_{0}=\emptyset\). We construct a filtration \(\mathcal{F}_{i-1}=\mathcal{D}_{i-1}\cup(x_{i}^{0},x_{i},a_{i},r_{i})\) for \(i=1,2,\cdots,n\). Notice that by construction of the dataset \(\xi_{i}\) is a martingale difference sequence (i.e \(\mathbb{E}\left[\xi_{i}\right|\mathcal{F}_{i-1}]=0\)) taking values in the range \([-2B,2B]\). Then, we can directly apply Lemma E.3 to obtain a bound on the first term as:

\[\left\|\frac{1}{n}\sum_{i=1}^{n}\bm{\varphi}_{i}\xi_{i}\right\|_{ \bm{\Lambda}_{n}^{-1}}=\frac{1}{\sqrt{n}}\sqrt{\left\|\sum_{i=1}^{n}\bm{\varphi }_{i}\xi_{i}\right\|_{(n\bm{\Lambda}_{n})^{-1}}^{2}} \leq\frac{2B}{\sqrt{n}}\sqrt{2\log\!\left(\frac{\det\left(n\bm{ \Lambda}_{n}\right)^{1/2}\det\left(n\beta I\right)^{-1/2}}{\delta}\right)}\] \[\leq\frac{2B}{\sqrt{n}}\sqrt{d\log\!\left(1+\frac{R^{2}}{d\beta} \right)+2\log\frac{1}{\delta}}.\]

with probability \(1-\delta\). In the last inequality we have used the AM-GM inequality and bound on the feature vectors:

\[\det\left(n\bm{\Lambda}_{n}\right)\leq\left(\frac{\text{tr}\left(n\bm{ \Lambda}_{n}\right)}{d}\right)^{d}=\left(n\beta+\frac{\text{tr}\left(\sum_{i=1 }^{n}\bm{\varphi}_{i}\bm{\varphi}_{i}^{\intercal}\right)}{d}\right)^{d}\leq \left(n\beta+\frac{nR^{2}}{d}\right)^{d}.\]

Putting everything together, we have that w.p \(1-\delta\),

\[\left\|\bm{\Lambda}_{n}\left(\widehat{\bm{\Psi}}-\bm{\Psi}\right)\bm{v} \right\|_{\bm{\Lambda}_{n}^{-1}}\leq\frac{2B}{\sqrt{n}}\sqrt{d\log\!\left(1+ \frac{R^{2}}{d\beta}\right)+2\log\frac{1}{\delta}}+B\sqrt{d\beta}.\]

This completes the proof. 

### Proof of Lemma B.2

Unlike Lemma B.1, we now aim to control the error term \(\left\|\bm{\Lambda}_{n}\left(\widehat{\bm{\Psi}}-\bm{\Psi}\right)\bm{v} \right\|_{\bm{\Lambda}_{n}^{-1}}\) when \(\bm{v}\) is random.

Also, notice that with \(\pi_{1}\left(a|x\right)=\frac{e^{\left\langle\varphi\left(x,a\right),0\right\rangle }}{\sum_{a^{\prime}\in\mathcal{A}}e^{\left\langle\varphi\left(x,a^{\prime} \right),0\right\rangle}}\) as the uniform policy, for \(t=1,\cdots,T\) we have that,

\[\pi_{t+1}(a|x)=\frac{\pi_{1}(a|x)e^{\alpha\left\langle\varphi\left(x,a\right), \sum_{k=1}^{t}\bm{\theta}_{k}\right\rangle}}{\sum_{a^{\prime}}\pi_{1}(a^{ \prime}|x)e^{\alpha\left\langle\varphi\left(x,a^{\prime}\right),\sum_{k=1}^{t} \bm{\theta}_{k}\right\rangle}}=\frac{e^{\left\langle\varphi\left(x,a\right), \alpha\right\rangle\sum_{k=0}^{t}\bm{\theta}_{k}\right\rangle}}{\sum_{a^{ \prime}}e^{\left\langle\varphi\left(x,a^{\prime}\right),\alpha\right\rangle \sum_{k=0}^{t}\bm{\theta}_{k}\right\rangle}},\]where \(\bm{\theta}_{0}=\bm{0}\). Furthermore, since \(\{\bm{\theta}_{t}\}_{t=1}^{T}\subset\mathbb{B}_{d}(D_{\bm{\theta}})\), for any \(t\left\|\alpha\sum_{k=0}^{t}\bm{\theta}_{k}\right\|_{2}\leq\alpha TD_{\bm{ \theta}}\). Hence, with \(D_{\pi}=\alpha TD_{\bm{\theta}}\), \(\pi_{t}\in\Pi\left(D_{\pi}\right)\) and \(\bm{v}_{\theta_{t},\pi_{t}}\in\mathcal{V}\).

Therefore, as we have seen in previous (Jin et al., 2020; Hong and Tewari, 2024), the quantity \(\left\|\bm{\Lambda}_{n}\left(\widehat{\bm{\Psi}}-\bm{\Psi}\right)\bm{v}_{ \theta_{t},\pi_{t}}\right\|_{\bm{\Lambda}_{n}^{-1}}\) can be controlled without any dependence on the size of the state space with a _uniform covering_ argument over \(\mathcal{V}\). Let \(C_{\bm{v}}\) be an \(\epsilon\)-cover of \(\mathcal{V}\). That is, for \(\bm{v}_{\pi_{t},\bm{\theta}_{t}}\in\mathcal{V}\), there exists \(\bm{v}^{\prime}\in C_{\bm{v}}\) such that \(\left\|\bm{v}_{\pi,\bm{\theta}_{t}}-\bm{v}^{\prime}\right\|_{\infty}\leq\epsilon\). Then, we can write:

\[\left\|\bm{\Lambda}_{n}\left(\widehat{\bm{\Psi}}-\bm{\Psi}\right) \bm{v}_{\theta_{t},\pi_{t}}\right\|_{\bm{\Lambda}_{n}^{-1}}\] \[\qquad\leq\left\|\bm{\Lambda}_{n}\left(\widehat{\bm{\Psi}}-\bm{ \Psi}\right)\bm{v}^{\prime}\right\|_{\bm{\Lambda}_{n}^{-1}}+\left\|\bm{ \Lambda}_{n}\widehat{\bm{\Psi}}\left(\bm{v}_{\theta_{t},\pi_{t}}-\bm{v}^{ \prime}\right)\right\|_{\bm{\Lambda}_{n}^{-1}}+\left\|\bm{\Lambda}_{n}\bm{ \Psi}\left(\bm{v}^{\prime}-\bm{v}_{\theta_{t},\pi_{t}}\right)\right\|_{\bm{ \Lambda}_{n}^{-1}}\] (16)

Consider the first term in the bound. Note that \(\bm{v}^{\prime}\) is still random with respect to uncertainty in the learning process. However, due to the structure of \(\mathcal{V}\) we know that \(C_{\bm{v}}\) exists and has cardinality \(\log|C_{\bm{v}}|=\mathcal{O}\left(d\log\left(1+\frac{4RD_{\bm{\theta}}RD_{\bm{ \theta}}}{\epsilon}\right)\right)\) (see Lemma E.6). Inspired by Lemma B.1, consider the event:

\[\mathcal{E}_{\bm{v}}=\left\{\text{exists}\,\bm{v}\in C_{\bm{v}}: \left\|\bm{\Lambda}_{n}\left(\widehat{\bm{\Psi}}-\bm{\Psi}\right)\bm{v}\right\| _{\bm{\Lambda}_{n}^{-1}}>\frac{2RD_{\bm{\theta}}}{\sqrt{n}}\sqrt{d\log\!\left( 1+\frac{R^{2}}{d\beta}\right)+2\log\frac{1}{\delta^{\prime}}}+RD_{\bm{\theta}} \sqrt{d\beta}\right\}\]

Since \(C_{\bm{v}}\subseteq\mathcal{V}\), we know from Lemma B.1 that \(\mathbb{P}\left(\mathcal{E}_{\bm{v}}\right)\leq\delta^{\prime}\). Now, taking the union bound over the cover \(C_{\bm{v}}\) we have that,

\[\mathbb{P}\left(\bigcup_{\bm{v}\in C_{\bm{v}}}\mathcal{E}_{\bm{v}}\right)\leq |C_{\bm{v}}|\delta^{\prime}.\]

Therefore for any \(\bm{v}^{\prime}\in C_{\bm{v}}\) with probability at least \(1-\delta\),

\[\left\|\bm{\Lambda}_{n}\left(\widehat{\bm{\Psi}}-\bm{\Psi}\right) \bm{v}^{\prime}\right\|_{\bm{\Lambda}_{n}^{-1}}\] \[\qquad\leq\frac{2RD_{\bm{\theta}}}{\sqrt{n}}\sqrt{d\log\!\left(1+ \frac{R^{2}}{d\beta}\right)+2\log\frac{|C_{\bm{v}}|}{\delta}}+RD_{\bm{\theta}} \sqrt{d\beta}\] \[\qquad\leq\frac{2RD_{\bm{\theta}}}{\sqrt{n}}\sqrt{d\log\!\left(1+ \frac{R^{2}}{d\beta}\right)+4d\log\left(1+\frac{4RD_{\pi}RD_{\bm{\theta}}}{ \epsilon}\right)+2\log\frac{1}{\delta}}+RD_{\bm{\theta}}\sqrt{d\beta}\]

Now, for the second term in Equation (16) we write,

\[\left\|\bm{\Lambda}_{n}\widehat{\bm{\Psi}}\left(\bm{v}_{\theta_{t },\pi_{t}}-\bm{v}^{\prime}\right)\right\|_{\bm{\Lambda}_{n}^{-1}}^{2} =\left\|\frac{1}{n}\sum_{i=1}^{n}\bm{\varphi}_{i}\left(\bm{v}_{ \theta_{t},\pi_{t}}\left(x_{i}^{\prime}\right)-\bm{v}^{\prime}\left(x_{i}^{ \prime}\right)\right)\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}\] \[\overset{(a)}{\leq}\frac{1}{n}\sum_{i=1}^{n}\left|\bm{v}_{\theta_ {t},\pi_{t}}\left(x_{i}^{\prime}\right)-\bm{v}^{\prime}\left(x_{i}^{\prime} \right)\right|^{2}\left\|\bm{\varphi}_{i}\right\|_{\bm{\Lambda}_{n}^{-1}}^{2}\] \[\leq\epsilon^{2}\frac{1}{n}\sum_{i=1}^{n}\left\|\bm{\varphi}_{i} \right\|_{\bm{\Lambda}_{n}^{-1}}^{2}\overset{(b)}{\leq}\epsilon^{2}d.\]

We have used \((a)\) Jensen's inequality and \((b)\) since \(\bm{\Lambda}_{n}\succ 0\), the relation,

\[\frac{1}{n}\sum_{i=1}^{n}\bm{\varphi}_{i}^{\intercal}\bm{\Lambda}_{n}^{-1}\bm{ \varphi}_{i}=\frac{1}{n}\sum_{i=1}^{n}\text{tr}\left(\bm{\Lambda}_{n}^{-1}\bm{ \varphi}_{i}\bm{\varphi}_{i}^{\intercal}\right)=\text{tr}\left(\bm{\Lambda}_{n}^{-1 }\frac{1}{n}\sum_{i=1}^{n}\bm{\varphi}_{i}\bm{\varphi}_{i}^{\intercal}\right) \leq\text{tr}\left(I\right)=d.\] (17)For the last term, notice that:

\[\left\|\mathbf{\Lambda}_{n}\mathbf{\Psi}\left(\boldsymbol{v}^{\prime}- \boldsymbol{v}_{\theta_{t},\pi_{t}}\right)\right\|_{\mathbf{\Lambda}_{n}^{-1}} =\left\|\beta\mathbf{\Psi}\left(\boldsymbol{v}^{\prime}-\boldsymbol {v}_{\theta_{t},\pi_{t}}\right)+\frac{1}{n}\sum_{i=1}^{n}\boldsymbol{\varphi}_ {i}\Big{[}\underset{x^{\prime}}{\sum}\,p\left(x^{\prime}|x_{i},a_{i}\right) \left(\boldsymbol{v}^{\prime}\left(x^{\prime}\right)-\boldsymbol{v}_{\theta_{t },\pi_{t}}\left(x^{\prime}\right)\right)\Big{]}\right\|_{\mathbf{\Lambda}_{n}^{ -1}}\] \[\overset{(a)}{\leq}\epsilon\sqrt{d\beta}+\sqrt{\left\|\frac{1}{n} \sum_{i=1}^{n}\boldsymbol{\varphi}_{i}\Big{[}\underset{x^{\prime}}{\sum}\,p \left(x^{\prime}|x_{i},a_{i}\right)\left(\boldsymbol{v}^{\prime}\left(x^{ \prime}\right)-\boldsymbol{v}_{\theta_{t},\pi_{t}}\left(x^{\prime}\right) \right)\Big{]}\right\|_{\mathbf{\Lambda}_{n}^{-1}}^{2}}\] \[\overset{(b)}{\leq}\epsilon\sqrt{d\beta}+\sqrt{\frac{1}{n}\sum_{ i=1}^{n}\left\|\boldsymbol{v}^{\prime}-\boldsymbol{v}_{\theta_{t},\pi_{t}} \right\|_{\infty}^{2}\left\|\boldsymbol{\varphi}_{i}\right\|_{\mathbf{\Lambda} _{n}^{-1}}^{2}}\] \[\overset{(c)}{\leq}\epsilon\sqrt{d\beta}+\epsilon\sqrt{d}= \epsilon\sqrt{d}\left(\sqrt{\beta}+1\right).\]

This follows from \((a)\) Equation (15) since \(\boldsymbol{v}=\boldsymbol{v}^{\prime}-\boldsymbol{v}_{\theta_{t},\pi_{t}} \in[-\epsilon,\epsilon]^{X}\) and \((b)\) monotonicity of the square root function as well as Jensen's inequality and \((c)\) Equation (17).

Finally, plugging the above results back into Equation (16), we have that with probability at least \(1-\delta\),

\[\left\|\mathbf{\Lambda}_{n}\left(\widehat{\mathbf{\Psi}}- \mathbf{\Psi}\right)\boldsymbol{v}_{\theta_{t},\pi_{t}}\right\|_{\mathbf{ \Lambda}_{n}^{-1}}\] \[\qquad\qquad\leq\frac{2RD_{\boldsymbol{\theta}}}{\sqrt{n}}\sqrt{ d\log\!\left(1+\frac{R^{2}}{d\beta}\right)+4d\log\left(1+\frac{4RD_{\pi}RD_{ \boldsymbol{\theta}}}{\epsilon}\right)+2\log\frac{1}{\delta}}\] \[\qquad\qquad+RD_{\boldsymbol{\theta}}\sqrt{d\beta}+\left(\sqrt{ \beta}+1\right)\epsilon\sqrt{d}\]

The proof of Lemma B.2 is complete.

Auxiliary Lemmas

**Lemma E.1**.: _Let \(\bm{q}_{1},\cdots,\bm{q}_{t}\) be a sequence of iterates satisfying \(\left\|\bm{q}_{t}\right\|_{\infty}\leq RD_{\bm{\theta}}\) by virtue of definition 2.1 and \(\bm{\theta}_{t}\in\mathbb{B}_{d}(D_{\bm{\theta}})\). Given an initial policy \(\pi_{1}\) and learning rate \(\alpha>0\), and sequence of policies \(\left\{\pi_{t}\right\}_{t=2}^{T}\) defined as:_

\[\pi_{t+1}(a|x)=\frac{\pi_{t}(a|x)e^{\alpha q_{t}(x,a)}}{\sum_{a^{\prime}}\pi_{ t}(a^{\prime}|x)e^{\alpha q_{t}(x,a^{\prime})}},\]

_Then, for any comparator policy \(\pi^{*}\) and \(\nu^{*}\) some state distribution,_

\[\sum_{t=1}^{T}\sum_{x}\nu^{*}(x)\sum_{a}\left(\pi^{*}(a|x)-\pi_{t}(a|x)\right) q_{t}(x,a)\leq\frac{\sum_{x}\nu^{*}(x)\mathcal{D}_{\text{KL}}\left(\pi^{*} \left(\cdot|x\right)\right\|\pi_{1}\left(\cdot|x\right)\right)}{\alpha}+\frac {\alpha TR^{2}D_{\bm{\theta}}^{2}}{2}.\]

The proof of the lemma follows from bounding the regret of the \(\pi\)-player in each state \(x\) as

\[\sum_{t=1}^{T}\sum_{a}\left(\pi^{*}(a|x)-\pi_{t}(a|x)\right)q_{t}(x,a)\leq \frac{\mathcal{D}_{\text{KL}}\left(\pi^{*}\left(\cdot|x\right)\right\|\pi_{1} \left(\cdot|x\right)\right)}{\alpha}+\frac{\alpha}{2}\sum_{t=1}^{T}\left\|q_{t }(x,\cdot)\right\|_{\infty}^{2},\]

via the application of the standard analysis of the exponentially weighted forecaster of Vovk (1990); Littestone and Warmuth (1994); Freund and Schapire (1997) (see, e.g., Theorem 2.2 in Cesa-Bianchi and Lugosi, 2006), and noting that \(\left\|q_{t}\right\|_{\infty}\leq RD_{\theta}\) for all \(t\).

**Lemma E.2**.: _Suppose that \(\left\|\bm{\varphi}(x,a)\right\|_{2}\leq R\) for all \((x,a)\in\mathcal{X}\times\mathcal{A}\). Let \(\pi_{\bm{\theta}},\pi_{\bm{\theta}^{\prime}}\) be softmax policies. Then, for all states \(x\in\mathcal{X}\) we have that:_

\[\sum_{a}\left|\pi_{\bm{\theta}}\left(a|x\right)-\pi_{\bm{\theta}^{\prime}} \left(a|x\right)\right|\leq R\left\|\bm{\theta}-\bm{\theta}^{\prime}\right\|_ {2}\]

_holds for any \(\bm{\theta},\bm{\theta}^{\prime}\in\mathbb{R}^{d}\)._

Proof.: Recall that,

\[\Pi\left(D_{\pi}\right)=\Bigg{\{}\pi_{\theta}\left(a|x\right)=\frac{e^{\left\langle \bm{\varphi}(x,a),\bm{\theta}\right\rangle}}{\sum_{a^{\prime}}e^{\left\langle \bm{\varphi}(x,a^{\prime}),\bm{\theta}\right\rangle}}\,\Bigg{|}\,\bm{\theta} \in\mathbb{B}_{d}(D_{\pi})\Bigg{\}}.\]

For \(\pi_{\bm{\theta}},\pi_{\bm{\theta}^{\prime}}\in\Pi\left(D_{\pi}\right)\) using Pinsker's inequality we have that,

\[\left\|\pi_{\bm{\theta}}\left(\cdot|x\right)-\pi_{\bm{\theta}^{\prime}}\left( \cdot|x\right)\right\|_{1}\leq\sqrt{2\mathcal{D}_{\text{KL}}\left(\pi_{\bm{ \theta}}\left(\cdot|x\right)\right\|\pi_{\bm{\theta}^{\prime}}\left(\cdot|x \right)\right)}\qquad\text{for }x\in\mathcal{X}.\] (18)

Furthermore, taking into account the specific structure of the policies, we can write:

\[\mathcal{D}_{\text{KL}}\left(\pi_{\bm{\theta}}\left(\cdot|x\right) \right\|\pi_{\bm{\theta}^{\prime}}\left(\cdot|x\right)\right) =\sum_{a}\pi_{\bm{\theta}}\left(a|x\right)\log\frac{\pi_{\bm{ \theta}}\left(a|x\right)}{\pi_{\bm{\theta}^{\prime}}\left(a|x\right)}\] \[=-\sum_{a}\pi_{\bm{\theta}}\left(a|x\right)\left\langle\bm{\varphi} (x,a),\bm{\theta}^{\prime}-\bm{\theta}\right\rangle+\log\frac{\sum_{a}e^{ \left\langle\bm{\varphi}(x,a),\bm{\theta}^{\prime}\right\rangle}}{\sum_{a}e^{ \left\langle\bm{\varphi}(x,a),\bm{\theta}\right\rangle}}\] \[\overset{(a)}{=}-\sum_{a}\pi_{\bm{\theta}}\left(a|x\right)\left\langle \bm{\varphi}(x,a),\bm{\theta}^{\prime}-\bm{\theta}\right\rangle+\log\sum_{a} \pi_{\bm{\theta}}\left(a|x\right)e^{\left\langle\bm{\varphi}(x,a),\bm{ \theta}^{\prime}-\bm{\theta}\right\rangle}\] \[\overset{(b)}{=}\frac{R^{2}\left\|\bm{\theta}-\bm{\theta}^{\prime }\right\|_{2}^{2}}{2}\]

using that \((a)\) the relation,

\[\log\frac{\sum_{a}e^{\left\langle\bm{\varphi}(x,a),\bm{\theta}^{\prime} \right\rangle}}{\sum_{a}e^{\left\langle\bm{\varphi}(x,a),\bm{\theta}^{\prime} \right\rangle}}=\log\sum_{a}\frac{e^{\left\langle\bm{\varphi}(x,a),\bm{ \theta}^{\prime}\right\rangle}}{\sum_{a^{\prime}}e^{\left\langle\bm{\varphi}(x,a^{\prime}),\bm{\theta}\right\rangle}}\cdot\frac{e^{\left\langle\bm{\varphi}(x,a),\bm{\theta}\right\rangle}}{e^{\left\langle\bm{\varphi}(x,a),\bm{\theta} \right\rangle}}=\log\sum_{a}\pi_{\bm{\theta}}\left(a|x\right)e^{\left\langle \bm{\varphi}(x,a),\bm{\theta}^{\prime}-\bm{\theta}\right\rangle},\]

and \((b)\) Hoeffding's lemma (cf. Lemma A.1 of Cesa-Bianchi and Lugosi (2006)). The final statement follows from substituting this result in Equation (18).

**Lemma E.3**.: _(Self-Normalized Bound for Vector-Valued Martingales - Theorem 1 of Abbasi-Yadkori et al. [2011]) Let \(\{\mathcal{F}_{i-1}\}_{i=1}^{\infty}\) be a filtration and \(\{\xi_{i}\}_{i=1}^{\infty}\) a real-valued stochastic process such that \(\xi_{i}\) for \(i=1,\cdots\) is zero-mean (i.e \(\mathbb{E}\left[\xi_{i}\left|\mathcal{F}_{i-1}\right.\right]=0\)) and conditionally \(s\)-subgaussian for \(s\geq 0\). That is, for all \(b\in\mathbb{R}\),_

\[\mathbb{E}\left[e^{b\xi_{i}}\left|\mathcal{F}_{i-1}\right.\right]\leq e^{\frac {b^{2}s^{2}}{2}}.\]

_Also, let \(\{\boldsymbol{\varphi}_{i}\}_{i=1}^{\infty}\) be \(\mathcal{F}_{i-1}\)-measurable. Then,_

\[\left\|\sum_{i=1}^{n}\boldsymbol{\varphi}_{i}\xi_{i}\right\|_{(n\mathbf{A}_{n })^{-1}}^{2}\leq 2s^{2}\log\Biggl{[}\frac{\det\left(n\mathbf{A}_{n} \right)^{1/2}\det\left(n\beta I\right)^{-1/2}}{\delta}\Biggr{]}.\]

**Lemma E.4**.: _(e.g. see Chapter 27 of Shalev-Shwartz and Ben-David [2014]) For all \(\epsilon>0\),_

\[\log\mathcal{N}\left(\mathbb{B}_{d}(r),\left\|\cdot\right\|_{\infty}, \epsilon\right)\leq d\log\left(1+\frac{2r}{\epsilon}\right).\]

**Corollary E.5**.: _Under the conditions of Lemma E.2, for all \(\epsilon>0\),_

\[\log\mathcal{N}\left(\Pi\left(D_{\pi}\right),\left\|\cdot\right\|_{\infty,1}, \epsilon\right)\leq\log\mathcal{N}\left(\mathbb{B}_{d}(D_{\pi}),\left\|\cdot \right\|_{\infty},\frac{\epsilon}{R}\right)\leq d\log\left(1+\frac{2RD_{\pi}}{ \epsilon}\right).\]

**Lemma E.6**.: _Consider the function class,_

\[\mathcal{V}=\Bigl{\{}\boldsymbol{v}_{\pi,\boldsymbol{\theta}}:\mathcal{X} \rightarrow[-RD_{\boldsymbol{\theta}},RD_{\boldsymbol{\theta}}]\Bigl{|}\pi \in\Pi\left(D_{\pi}\right),\boldsymbol{\theta}\in\mathbb{B}_{d}(D_{ \boldsymbol{\theta}})\Bigr{\}},\]

_we have that:_

\[\mathcal{N}\left(\mathcal{V},\left\|\cdot\right\|_{\infty},\epsilon\right) \leq\mathcal{N}\left(\Pi\left(D_{\pi}\right),\left\|\cdot\right\|_{\infty,1}, \epsilon/2RD_{\boldsymbol{\theta}}\right)\times\mathcal{N}\left(\mathbb{B}_{d }(D_{\boldsymbol{\theta}}),\left\|\cdot\right\|_{2},\epsilon/2R\right),\]

_and,_

\[\log\mathcal{N}\left(\mathcal{V},\left\|\cdot\right\|_{\infty},\epsilon \right)\leq 2d\log\left(1+\frac{4RD_{\pi}RD_{\boldsymbol{\theta}}}{ \epsilon}\right)\]

Proof.: Let \(C_{\pi}\) denote the \(\epsilon_{\pi}\)-cover of \(\Pi\left(D_{\pi}\right)\) with respect to the norm \(\left\|\cdot\right\|_{\infty,1}\) and \(C_{\boldsymbol{\theta}}\) the \(\epsilon_{\boldsymbol{\theta}}\)-cover of \(\mathbb{B}_{d}(D_{\boldsymbol{\theta}})\) under the \(L^{2}\)-norm. For \((\pi,\boldsymbol{\theta})\in\Pi\left(D_{\pi}\right)\times\mathbb{B}_{d}(D_{ \boldsymbol{\theta}})\) and \((\pi^{\prime},\boldsymbol{\theta}^{\prime})\in C_{\pi}\times C_{\boldsymbol{ \theta}}\), it follows that for any state \(x\in\mathcal{X}\),

\[\left|\boldsymbol{v}_{\pi,\boldsymbol{\theta}}(s)-\boldsymbol{v}_ {\pi^{\prime},\boldsymbol{\theta}^{\prime}}(s)\right| =\left|\sum_{a\in\mathcal{A}}\pi(a|x)\left\langle\boldsymbol{ \varphi}(x,a),\boldsymbol{\theta}\right\rangle-\pi^{\prime}(a|x)\left\langle \boldsymbol{\varphi}(x,a),\boldsymbol{\theta}^{\prime}\right\rangle\right|\] \[=\left|\sum_{a\in\mathcal{A}}\left(\pi(a|x)-\pi^{\prime}(a|x) \right)\left\langle\boldsymbol{\varphi}(x,a),\boldsymbol{\theta}\right\rangle +\sum_{a\in\mathcal{A}}\pi^{\prime}(a|x)\left\langle\boldsymbol{\varphi}(x,a), \boldsymbol{\theta}-\boldsymbol{\theta}^{\prime}\right\rangle\right|\] \[\leq RD_{\boldsymbol{\theta}}\sum_{a\in\mathcal{A}}\left|\pi(a|x) -\pi^{\prime}(a|x)\right|+R\sum_{a\in\mathcal{A}}\pi^{\prime}(a|x)\left\| \boldsymbol{\theta}-\boldsymbol{\theta}^{\prime}\right\|_{2}\]

Let \(C_{\boldsymbol{v}}=\Bigl{\{}\boldsymbol{v}_{\pi,\boldsymbol{\theta}}:\mathcal{ X}\rightarrow[-RD_{\boldsymbol{\theta}},RD_{\boldsymbol{\theta}}]\Bigl{|}\pi\in C_{\pi}, \boldsymbol{\theta}\in C_{\boldsymbol{\theta}}\Bigr{\}}\). Then, \(C_{\boldsymbol{v}}\) is an \(\epsilon\)-cover of \(\mathcal{V}\) with respect to the \(L^{\infty}\)-norm when \(\epsilon_{\pi}=\epsilon/2RD_{\boldsymbol{\theta}}\) and \(\epsilon_{\boldsymbol{\theta}}=\epsilon/2R\). Therefore, we can derive a bound on the covering number of \(C_{\boldsymbol{v}}\) as:

\[\mathcal{N}\left(\mathcal{V},\left\|\cdot\right\|_{\infty},\epsilon\right) \leq\mathcal{N}\left(\Pi\left(D_{\pi}\right),\left\|\cdot\right\|_{ \infty,1},\epsilon/2RD_{\boldsymbol{\theta}}\right)\times\mathcal{N}\left( \mathbb{B}_{d}(D_{\boldsymbol{\theta}}),\left\|\cdot\right\|_{2},\epsilon/2R\right)\] \[\leq\left(1+\frac{4RD_{\pi}RD_{\boldsymbol{\theta}}}{\epsilon} \right)^{d}\left(1+\frac{4RD_{\boldsymbol{\theta}}}{\epsilon}\right)^{d}.\]

Hence,

\[\log\mathcal{N}\left(\mathcal{V},\left\|\cdot\right\|_{\infty},\epsilon\right) \leq 2d\log\left(1+\frac{4RD_{\pi}RD_{\boldsymbol{\theta}}}{\epsilon}\right)\]

This completes the proof.

[MISSING_PAGE_EMPTY:27]

Justification:

Guidelines:

* The answer NA means that the paper does not include theoretical results.
* All the theorems, formulas, and proofs in the paper should be numbered and cross-referenced.
* All assumptions should be clearly stated or referenced in the statement of any theorems.
* The proofs can either appear in the main paper or the supplemental material, but if they appear in the supplemental material, the authors are encouraged to provide a short proof sketch to provide intuition.
* Inversely, any informal proof provided in the core of the paper should be complemented by formal proofs provided in appendix or supplemental material.
* Theorems and Lemmas that the proof relies upon should be properly referenced.
4. **Experimental Result Reproducibility** Question: Does the paper fully disclose all the information needed to reproduce the main experimental results of the paper to the extent that it affects the main claims and/or conclusions of the paper (regardless of whether the code and data are provided or not)? Answer: [NA] Justification: This is a theory paper, there are no experiments. Guidelines: * The answer NA means that the paper does not include experiments.
4. If the paper includes experiments, a No answer to this question will not be perceived well by the reviewers: Making the paper reproducible is important, regardless of whether the code and data are provided or not.
5. If the contribution is a dataset and/or model, the authors should describe the steps taken to make their results reproducible or verifiable.
6. Depending on the contribution, reproducibility can be accomplished in various ways. For example, if the contribution is a novel architecture, describing the architecture fully might suffice, or if the contribution is a specific model and empirical evaluation, it may be necessary to either make it possible for others to replicate the model with the same dataset, or provide access to the model. In general. releasing code and data is often one good way to accomplish this, but reproducibility can also be provided via detailed instructions for how to replicate the results, access to a hosted model (e.g., in the case of a large language model), releasing of a model checkpoint, or other means that are appropriate to the research performed.
7. While NeurIPS does not require releasing code, the conference does require all submissions to provide some reasonable avenue for reproducibility, which may depend on the nature of the contribution. For example 1. If the contribution is primarily a new algorithm, the paper should make it clear how to reproduce that algorithm. 2. If the contribution is primarily a new model architecture, the paper should describe the architecture clearly and fully. 3. If the contribution is a new model (e.g., a large language model), then there should either be a way to access this model for reproducing the results or a way to reproduce the model (e.g., with an open-source dataset or instructions for how to construct the dataset). 4. We recognize that reproducibility may be tricky in some cases, in which case authors are welcome to describe the particular way they provide for reproducibility. In the case of closed-source models, it may be that access to the model is limited in some way (e.g., to registered users), but it should be possible for other researchers to have some path to reproducing or verifying the results.
8. **Open access to data and code** Question: Does the paper provide open access to the data and code, with sufficient instructions to faithfully reproduce the main experimental results, as described in supplemental material?Answer: [NA] Justification: This is a theory paper, there is no data or code. Guidelines:

* The answer NA means that paper does not include experiments requiring code.
* Please see the NeurIPS code and data submission guidelines (https://nips.cc/public/guides/CodeSubmissionPolicy) for more details.
* While we encourage the release of code and data, we understand that this might not be possible, so "No" is an acceptable answer. Papers cannot be rejected simply for not including code, unless this is central to the contribution (e.g., for a new open-source benchmark).
* The instructions should contain the exact command and environment needed to run to reproduce the results. See the NeurIPS code and data submission guidelines (https://nips.cc/public/guides/CodeSubmissionPolicy) for more details.
* The authors should provide instructions on data access and preparation, including how to access the raw data, preprocessed data, intermediate data, and generated data, etc.
* The authors should provide scripts to reproduce all experimental results for the new proposed method and baselines. If only a subset of experiments are reproducible, they should state which ones are omitted from the script and why.
* At submission time, to preserve anonymity, the authors should release anonymized versions (if applicable).
* Providing as much information as possible in supplemental material (appended to the paper) is recommended, but including URLs to data and code is permitted.
6. **Experimental Setting/Details** Question: Does the paper specify all the training and test details (e.g., data splits, hyperparameters, how they were chosen, type of optimizer, etc.) necessary to understand the results? Answer: [NA] Justification: This is a theory paper, there are no experiments. Guidelines:

* The answer NA means that the paper does not include experiments.
* The experimental setting should be presented in the core of the paper to a level of detail that is necessary to appreciate the results and make sense of them.
* The full details can be provided either with the code, in appendix, or as supplemental material.
7. **Experiment Statistical Significance** Question: Does the paper report error bars suitably and correctly defined or other appropriate information about the statistical significance of the experiments? Answer: [NA] Justification: This is a theory paper, there are no experiments. Guidelines:

* The answer NA means that the paper does not include experiments.
* The authors should answer "Yes" if the results are accompanied by error bars, confidence intervals, or statistical significance tests, at least for the experiments that support the main claims of the paper.
* The factors of variability that the error bars are capturing should be clearly stated (for example, train/test split, initialization, random drawing of some parameter, or overall run with given experimental conditions).
* The method for calculating the error bars should be explained (closed form formula, call to a library function, bootstrap, etc.)
* The assumptions made should be given (e.g., Normally distributed errors).
* It should be clear whether the error bar is the standard deviation or the standard error of the mean.

* It is OK to report 1-sigma error bars, but one should state it. The authors should preferably report a 2-sigma error bar than state that they have a 96% CI, if the hypothesis of Normality of errors is not verified.
* For asymmetric distributions, the authors should be careful not to show in tables or figures symmetric error bars that would yield results that are out of range (e.g. negative error rates).
* If error bars are reported in tables or plots, The authors should explain in the text how they were calculated and reference the corresponding figures or tables in the text.
8. **Experiments Compute Resources** Question: For each experiment, does the paper provide sufficient information on the computer resources (type of compute workers, memory, time of execution) needed to reproduce the experiments? Answer: [NA] Justification: This is a theory paper, there are no experiments. Guidelines: * The answer NA means that the paper does not include experiments. * The paper should indicate the type of compute workers CPU or GPU, internal cluster, or cloud provider, including relevant memory and storage. * The paper should provide the amount of compute required for each of the individual experimental runs as well as estimate the total compute. * The paper should disclose whether the full research project required more compute than the experiments reported in the paper (e.g., preliminary or failed experiments that didn't make it into the paper).
9. **Code Of Ethics** Question: Does the research conducted in the paper conform, in every respect, with the NeurIPS Code of Ethics https://neurips.cc/public/EthicsGuidelines? Answer: [Yes] Justification: Guidelines: * The answer NA means that the authors have not reviewed the NeurIPS Code of Ethics. * If the authors answer No, they should explain the special circumstances that require a deviation from the Code of Ethics. * The authors should make sure to preserve anonymity (e.g., if there is a special consideration due to laws or regulations in their jurisdiction).
10. **Broader Impacts** Question: Does the paper discuss both potential positive societal impacts and negative societal impacts of the work performed? Answer: [NA] Justification: This is a theory paper, with no specific societal impacts foreseen in the near future. Guidelines: * The answer NA means that there is no societal impact of the work performed. * If the authors answer NA or No, they should explain why their work has no societal impact or why the paper does not address societal impact. * Examples of negative societal impacts include potential malicious or unintended uses (e.g., disinformation, generating fake profiles, surveillance), fairness considerations (e.g., deployment of technologies that could make decisions that unfairly impact specific groups), privacy considerations, and security considerations.

* The conference expects that many papers will be foundational research and not tied to particular applications, let alone deployments. However, if there is a direct path to any negative applications, the authors should point it out. For example, it is legitimate to point out that an improvement in the quality of generative models could be used to generate deepfakes for disinformation. On the other hand, it is not needed to point out that a generic algorithm for optimizing neural networks could enable people to train models that generate Deepfakes faster.
* The authors should consider possible harms that could arise when the technology is being used as intended and functioning correctly, harms that could arise when the technology is being used as intended but gives incorrect results, and harms following from (intentional or unintentional) misuse of the technology.
* If there are negative societal impacts, the authors could also discuss possible mitigation strategies (e.g., gated release of models, providing defenses in addition to attacks, mechanisms for monitoring misuse, mechanisms to monitor how a system learns from feedback over time, improving the efficiency and accessibility of ML).
11. **Safeguards** Question: Does the paper describe safeguards that have been put in place for responsible release of data or models that have a high risk for misuse (e.g., pretrained language models, image generators, or scraped datasets)? Answer: [NA] Justification: This is a theory paper, this question is not relevant. Guidelines: * The answer NA means that the paper poses no such risks. * Released models that have a high risk for misuse or dual-use should be released with necessary safeguards to allow for controlled use of the model, for example by requiring that users adhere to usage guidelines or restrictions to access the model or implementing safety filters. * Datasets that have been scraped from the Internet could pose safety risks. The authors should describe how they avoided releasing unsafe images. * We recognize that providing effective safeguards is challenging, and many papers do not require this, but we encourage authors to take this into account and make a best faith effort.
12. **Licensees for existing assets** Question: Are the creators or original owners of assets (e.g., code, data, models), used in the paper, properly credited and are the license and terms of use explicitly mentioned and properly respected? Answer: [NA] Justification: This is a theory paper, there are no assets used. Guidelines: * The answer NA means that the paper does not use existing assets. * The authors should cite the original paper that produced the code package or dataset. * The authors should state which version of the asset is used and, if possible, include a URL. * The name of the license (e.g., CC-BY 4.0) should be included for each asset. * For scraped data from a particular source (e.g., website), the copyright and terms of service of that source should be provided. * If assets are released, the license, copyright information, and terms of use in the package should be provided. For popular datasets, paperswithcode.com/datasets has curated licenses for some datasets. Their licensing guide can help determine the license of a dataset. * For existing datasets that are re-packaged, both the original license and the license of the derived asset (if it has changed) should be provided.

* If this information is not available online, the authors are encouraged to reach out to the asset's creators.
* **New Assets*
* Question: Are new assets introduced in the paper well documented and is the documentation provided alongside the assets? Answer: [NA] Justification: This is a theory paper, there are no new assets. Guidelines:
* The answer NA means that the paper does not release new assets.
* Researchers should communicate the details of the dataset/code/model as part of their submissions via structured templates. This includes details about training, license, limitations, etc.
* The paper should discuss whether and how consent was obtained from people whose asset is used.
* At submission time, remember to anonymize your assets (if applicable). You can either create an anonymized URL or include an anonymized zip file.
* **Crowdsourcing and Research with Human Subjects*
* Question: For crowdsourcing experiments and research with human subjects, does the paper include the full text of instructions given to participants and screenshots, if applicable, as well as details about compensation (if any)? Answer: [NA] Justification: This is a theory paper, we haven't used crowdsourced data or worked with human subjects. Guidelines:
* The answer NA means that the paper does not involve crowdsourcing nor research with human subjects.
* Including this information in the supplemental material is fine, but if the main contribution of the paper involves human subjects, then as much detail as possible should be included in the main paper.
* According to the NeurIPS Code of Ethics, workers involved in data collection, curation, or other labor should be paid at least the minimum wage in the country of the data collector.
* **Institutional Review Board (IRB) Approvals or Equivalent for Research with Human Subjects*
* Question: Does the paper describe potential risks incurred by study participants, whether such risks were disclosed to the subjects, and whether Institutional Review Board (IRB) approvals (or an equivalent approval/review based on the requirements of your country or institution) were obtained? Answer: [NA] Justification: This is a theory paper, we haven't worked with human subjects. Guidelines:
* The answer NA means that the paper does not involve crowdsourcing nor research with human subjects.
* Depending on the country in which research is conducted, IRB approval (or equivalent) may be required for any human subjects research. If you obtained IRB approval, you should clearly state this in the paper.
* We recognize that the procedures for this may vary significantly between institutions and locations, and we expect authors to adhere to the NeurIPS Code of Ethics and the guidelines for their institution.
* For initial submissions, do not include any information that would break anonymity (if applicable), such as the institution conducting the review.