# Supervised Kernel Thinning

 Albert Gong Kyuseong Choi Raaz Dwivedi

Cornell Tech, Cornell University

agong,kc728,dwivedi@cornell.edu

###### Abstract

The kernel thinning algorithm of [10] provides a better-than-i.i.d. compression of a generic set of points. By generating high-fidelity coresets of size significantly smaller than the input points, KT is known to speed up unsupervised tasks like Monte Carlo integration, uncertainty quantification, and non-parametric hypothesis testing, with minimal loss in statistical accuracy. In this work, we generalize the KT algorithm to speed up supervised learning problems involving kernel methods. Specifically, we combine two classical algorithms--Nadaraya-Watson (NW) regression or kernel smoothing, and kernel ridge regression (KRR)--with KT to provide a _quadratic_ speed-up in both training and inference times. We show how distribution compression with KT in each setting reduces to constructing an appropriate kernel, and introduce the Kernel-Thinned NW and Kernel-Thinned KRR estimators. We prove that KT-based regression estimators enjoy significantly superior computational efficiency over the full-data estimators and improved statistical efficiency over i.i.d. subsampling of the training data. En route, we also provide a novel multiplicative error guarantee for compressing with KT. We validate our design choices with both simulations and real data experiments.

## 1 Introduction

In supervised learning, the goal of coreset methods is to find a representative set of points on which to perform model training and inference. On the other hand, coreset methods in _unsupervised_ learning have the goal of finding a representative set of points, which can then be utilized for a broad class of downstream tasks--from integration [10, 9] to non-parametric hypothesis testing [8]. This work aims to bridge these two research threads.

Leveraging recent advancements from compression in the unsupervised setting, we tackle the problem of non-parametric regression (formally defined in Sec. 2). Given a dataset of \(n\) i.i.d. samples, \((x_{i},y_{i})_{i=1}^{n}\), we want to learn a function \(f\) such that \(f(x_{i})\approx y_{i}\). The set of allowable functions is determined by the kernel function, which is a powerful building block for capturing complex, non-linear relationships. Due to its powerful performance in practice and closed-form analysis, non-parametric regression methods based on kernels (a.k.a "kernel methods") have become a popular choice for a wide range of supervised learning tasks [13, 20, 24].

There are two popular approaches to non-parametric kernel regression. First, perhaps a more classical approach, is kernel smoothing, also referred to as Nadaraya-Watson (NW) regression. The NW estimator at a point \(x\) is effectively a smoothing of labels \(y_{i}\) such that \(x_{i}\) is close to \(x\). These weights are computed using the kernel function (see Sec. 2 for formal definitions). Importantly, the NW estimator takes \(\Theta(n)\) pre-processing time (to simply store the data) and \(\Theta(n)\) inference time for each test point \(x\) (\(n\) kernel evaluations and \(n\) simple operations).

Another popular approach is kernel ridge regression (KRR), which solves a non-parametric least squares subject to the regression function lying in the reproducing kernel Hilbert space (RKHS) of aspecified reproducing kernel function. Remarkably, KRR admits a closed-form solution via inverting the associated kernel matrix, and takes \(\mathcal{O}(n^{3})\) training time and \(\Theta(n)\) inference time for each test point \(x\).

Our goal is to overcome the computational bottlenecks of kernel methods, while retaining their favorable statistical properties. Previous attempts at using coreset methods include the work of Boutsidis et al. [4], Zheng and Phillips [32], Phillips [18], which depend on a projection type compression, having similar spirit to the celebrated Johnson-Lindenstrauss lemma, a metric preserving projection result. So accuracy and running depend unfavorably on the desired statistical error rate. Kpotufe [14] propose an algorithm to reduce the query time of the NW estimator to \(\mathcal{O}(\log n)\), but the algorithm requires super-linear preprocessing time.

Other lines of work exploit the structure of kernels more directly, especially in the KRR literature. A slew of techniques from numerical analysis have been developed, including work on Nystrom subsampling by El Alaoui and Mahoney [11], Avron et al. [1], Diaz et al. [7]. Camoriano et al. [5] and Rudi et al. [22] combine early stopping with Nystrom subsampling. Though more distant from our approach, we also note the approach of Rahimi and Recht [21] using random features, Zhang et al. [31] using Divide-and-Conquer, and Tu et al. [28] using block coordinate descent.

Our contributions.In this work, we show how coreset methods can be used to speed up both training and inference in non-parametric regression for a large class of function classes/kernels. At the heart of these algorithms is a general procedure called kernel thinning [10; 9], which provides a worst-case bound on integration error (suited for problems in the original context of unsupervised learning and MCMC simulations). In Sec. 3, we introduce a meta-algorithm that recovers our two thinned non-parametric regression methods each based on NW and KRR. We introduce the _kernel-thinned Nadaraya-Watson estimator_ (KT-NW) and the _kernel-thinned kernel ridge regression_ estimator (KT-KRR).

We show that KT-NW requires \(\mathcal{O}(n\log^{3}n)\) time during training and \(\mathcal{O}(\sqrt{n})\) time at inference, while achieving a mean square error (MSE) rate of \(n^{-\frac{\beta}{\beta+2}}\) (Thm. 1)--a strict improvement over uniform subsampling of the original input points. We show that KT-KRR requires \(\mathcal{O}(n^{3/2})\) time during training and and \(\mathcal{O}(\sqrt{n})\) time during inference, while achieving an near-minimax optimal rate of \(\frac{m\log n}{n}\) when the kernel has finite dimension (Thm. 2). We show how our KT-KRR guarantees can also be extended to the infinite-dimension setting (Thm. 3). In Sec. 5, we apply our proposed methods to both simulated and real-world data. In line with our theory, KT-NW and KT-KRR outperform standard thinning baselines in terms of accuracy while retaining favorable runtimes.

## 2 Problem setup

We now formally describe the non-parametric regression problem. Let \(x_{1},\ldots,x_{n}\) be i.i.d. samples from the data distribution \(\mathbb{P}\) (with density \(p\)) over the domain \(\mathcal{X}\subset\mathbb{R}^{d}\) and \(w_{1},\ldots,w_{n}\) be i.i.d. samples from \(\mathcal{N}(0,1)\). In the sequel, we use \(\|\cdot\|\) to denote the Euclidean norm unless otherwise stated. Then define the response variables \(y_{1},\ldots,y_{n}\) by the follow data generating process:

\[y_{i}\triangleq f^{\star}(x_{i})+v_{i}\quad\text{for}\quad i=1,2,\ldots,n, \tag{1}\]

where \(f^{\star}:\mathcal{X}\rightarrow\mathcal{Y}\subset\mathbb{R}\) is the _regression function_ and \(v_{i}\triangleq\sigma w_{i}\) for some noise level \(\sigma>0\). Our task is to build an estimate for \(f^{\star}\) given the \(n\) observed points, denoted by

\[\mathcal{S}_{\text{in}}\triangleq((x_{1},y_{1}),\ldots,(x_{n},y_{n})).\]

Nadaraya-Watson (NW) estimator.A classical approach to estimate the function \(f^{\star}\) is kernel smoothing, where one estimates the function value at a point \(z\) using a weighted average of the observed outcomes. The weight for outcome \(y_{i}\) depends on how close \(x_{i}\) is to the point \(z\); let \(\kappa:\mathbb{R}^{d}\rightarrow\mathbb{R}\) denote this weighting function such that the weight for \(x_{i}\) is proportional to \(\kappa(\|x_{i}-z\|/h)\) for some bandwidth parameter \(h>0\). Let \(\mathbf{k}:\mathbb{R}^{d}\times\mathbb{R}\rightarrow\mathbb{R}\) denote a shift-invariant kernel defined as

\[\mathbf{k}(x_{1},x_{2})=\kappa(\|x_{1}-x_{2}\|/h).\]

Then this smoothing estimator, also known as Nadaraya-Watson (NW) estimator, can be expressed as

\[\widehat{f}(\cdot)\triangleq\frac{\sum_{(x,y)\in\mathcal{S}_{\text{in}}} \mathbf{k}(\cdot,x)y}{\sum_{x\in\mathcal{S}_{\text{in}}}\mathbf{k}(\cdot,x)} \tag{2}\]whenever the denominator in the above display is non-zero. In the case the denominator in (2) is zero, we can make a default choice, which for simplicity here we choose as zero. We refer to the estimator (2) as Full-NW estimator hereafter. One can easily note that Full-NW requires \(\mathcal{O}(n)\) storage for the input points and \(\mathcal{O}(n)\) kernel queries for inference at each point.

Kernel ridge regression (KRR) estimator.Another popular approach to estimate \(f^{\star}\) is that of non-parametric (regularized) least squares. The solution in this approach, often called as the kernel ridge regression (KRR), is obtained by solving a least squares objective where the fitted function is posited to lie in the RKHS \(\mathcal{H}\) of a reproducing kernel \(\mathbf{k}\), and a regularization term is added to the objective to avoid overfitting.1 Overall, the KRR estimate is the solution to the following regularized least-squares objective, where \(\lambda>0\) denotes a regularization hyperparameter:

Footnote 1: We note that while KRR approach (14) does require \(\mathbf{k}\) to be reproducing, the NW approach (2) in full generality is valid even when \(\mathbf{k}\) is a not a valid reproducing kernel.

\[\min_{f\in\mathcal{H}}L_{\mathcal{S}_{\mathrm{in}}}+\lambda\|f\|_{\mathbf{k}} ^{2},\quad\text{where}\quad L_{\mathcal{S}_{\mathrm{in}}}\triangleq\frac{1}{n} \sum_{(x,y)\in\mathcal{S}_{\mathrm{in}}}(f(x)-y)^{2}. \tag{3}\]

Like NW, an advantage of KRR is the existence of a closed-form solution

\[\widehat{f}_{\mathrm{full},\lambda}(\cdot) \triangleq\sum_{i=1}^{n}\alpha_{i}\mathbf{k}(\cdot,x_{i})\quad \text{where} \tag{4}\] \[\boldsymbol{\alpha} \triangleq(\mathbf{K}+n\lambda\mathbf{I}_{n})^{-1}\begin{bmatrix} y_{1}\\ \vdots\\ y_{n}\end{bmatrix}\in\mathbb{R}^{n}\quad\text{and}\quad\mathbf{K}\triangleq[ \mathbf{k}(x_{i},x_{j})]_{i,j=1}^{n}\in\mathbb{R}^{n\times n}. \tag{5}\]

Notably, the estimate \(\widehat{f}_{\mathrm{full},\lambda}\), which we refer to as the Full-KRR estimator, can also be seen as yet another instance of weighted average of the observed outcomes. Notably, NW estimator imposes that the weights across the points sum to \(1\) (and are also non-negative whenever \(\mathbf{k}\) is), KRR allows for generic weights that need not be positive (even when \(\mathbf{k}\) is) and need not sum to \(1\). We note that naively solving \(\widehat{f}_{\mathrm{full},\lambda}\) requires \(\mathcal{O}(n^{2})\) kernel evaluations to compute the kernel matrix, \(\mathcal{O}(n^{3})\) to compute a matrix inverse, and \(\mathcal{O}(n)\) kernel queries for inference at each point. One of our primary goals in this work is to tackle this high computational cost of Full-KRR.

## 3 Speeding up non-parametric regression

We begin with a general approach to speed up regression by thinning the input datasets. While computationally superior, a generic approach suffers from a loss of statistical accuracy motivating the need for a strategic thinning approach. To that end, we briefly review kernel thinning and finally introduced our supervised kernel thinning approach.

### Thinned regression estimators: Computational and statistical tradeoffs

Our generic approach comprises two main steps. First, we compress the input data by choosing a coreset \(\mathcal{S}_{\mathrm{out}}\subset\mathcal{S}_{\mathrm{in}}\) of size \(n_{\mathrm{out}}\triangleq|\mathcal{S}_{\mathrm{out}}|\). Second, we apply our off-the-shelf non-parametric regression methods from Sec. 2 to the compressed data. By setting \(n_{\mathrm{out}}\ll n\), we can obtain notable speed-ups over the Full versions of NW and KRR.

Before we introduce the thinned versions of NW and KRR, let us define the following notation. Given an input sequence \(\mathcal{S}_{\mathrm{in}}\) and output sequence \(\mathcal{S}_{\mathrm{out}}\), define the empirical probability measures

\[\mathbb{P}_{\mathrm{in}}\triangleq\frac{1}{n}\sum_{(x,y)\in\mathcal{S}_{ \mathrm{in}}}\delta_{(x,y)}\quad\text{and}\quad\mathbb{Q}_{\mathrm{out}} \triangleq\frac{1}{n_{\mathrm{out}}}\sum_{(x,y)\in\mathcal{S}_{\mathrm{out}} }\delta_{(x,y)}. \tag{6}\]

Thinned NW estimator.The thinned NW estimator is the analog of Full-NW except that \(\mathcal{S}_{\mathrm{in}}\) is replaced by \(\mathcal{S}_{\mathrm{out}}\) in (2) so that the _thinned-NW estimator_ is given by

\[\widehat{f}_{\mathcal{S}_{\mathrm{out}}}(\cdot)\triangleq\frac{\sum_{(x,y) \in\mathcal{S}_{\mathrm{out}}}\mathbf{k}(\cdot,x)y}{\sum_{x\in\mathcal{S}_{ \mathrm{out}}}\mathbf{k}(\cdot,x)}=\frac{\mathbb{Q}_{\mathrm{out}}(y\mathbf{k })}{\mathbb{Q}_{\mathrm{out}}\mathbf{k}} \tag{7}\]whenever the denominator in the display is not zero; and \(0\) otherwise. When compared to the Full-NW estimator, we can easily deduce the computational advantage of this estimator: more efficient \(\mathcal{O}(n_{\mathrm{out}})\) storage as well as the faster \(\mathcal{O}(n_{\mathrm{out}})\) computation for inference at each point.

Thinned KRR estimator.Similarly, we can define the _thinned KRR estimator_ as

\[\widehat{f}_{\mathcal{S}_{\mathrm{out}},\mathcal{N}}(\cdot) =\sum_{i=1}^{n_{\mathrm{out}}}\alpha^{\prime}_{i}\mathbf{k}(\cdot,x^{\prime}_{i}),\quad\text{where} \tag{8}\] \[\boldsymbol{\alpha}^{\prime} \triangleq(\mathbf{K}^{\prime}+n_{\mathrm{out}}\lambda^{\prime} \mathbf{I}_{n_{\mathrm{out}}})^{-1}\begin{bmatrix}y^{\prime}_{1}\\ \vdots\\ y^{\prime}_{n_{\mathrm{out}}}\end{bmatrix}\in\mathbb{R}^{n_{\mathrm{out}}}\quad \text{and}\quad\mathbf{K}^{\prime}\triangleq[\mathbf{k}(x^{\prime}_{i},x^{ \prime}_{j})]_{i,j=1}^{n_{\mathrm{out}}}\in\mathbb{R}^{n_{\mathrm{out}}\times n _{\mathrm{out}}}\]

given some regularization parameter \(\lambda^{\prime}>0\). When compared to Full-KRR, \(\widehat{f}_{\mathcal{S}_{\mathrm{out}},\lambda^{\prime}}\) has training time \(\mathcal{O}(n_{\mathrm{out}}^{3})\) and prediction time \(\mathcal{O}(n_{\mathrm{out}})\).

A baseline approach is standard thinning, whereby we let \(\mathcal{S}_{\mathrm{out}}\) be an i.i.d. sample of \(n_{\mathrm{out}}=\sqrt{n}\) points from \(\mathcal{S}_{\mathrm{in}}\). For NW, let us call the resulting \(\widehat{f}_{\mathcal{S}_{\mathrm{out}}}\) (7) the standard-thinned Nadaraya-Watson (ST-NW) estimator. When \(n_{\mathrm{out}}=\sqrt{n}\), ST-NW achieves an excess risk rate of \(\mathcal{O}(n^{-\frac{\beta}{2\beta+\delta}})\) compared to the Full-NW rate of \(\mathcal{O}(n^{-\frac{2\beta}{2\beta+\delta}})\). For KRR, let us call the resulting \(\widehat{f}_{\mathcal{S}_{\mathrm{out}},\lambda^{\prime}}\) (8) the standard-thinned KRR (ST-KRR) estimator. When \(n_{\mathrm{out}}=\sqrt{n}\), ST-KRR achieves an excess risk rate of \(\mathcal{O}(\frac{m}{n_{\mathrm{out}}})\) compared to the Full-KRR rate of \(\mathcal{O}(\frac{m}{n})\). Our goal is to provide good computational benefits without trading off statistical error. Moreover, we may be able to do better by leveraging the underlying geometry of the input points and summarize of the input distribution more succinctly than i.i.d. sampling.

### Background on kernel thinning

A subroutine central to our approach is kernel thinning (KT) from Dwivedi and Mackey (2010, Alg. 1). We use a variant called KT-Compress++ from Shetty et al. (2013, Ex. 6) (see full details in App. A), which provides similar approximation quality as the original KT algorithm of Dwivedi and Mackey (2010, Alg. 1), while reducing the runtime from \(\mathcal{O}(n^{2})\) to \(\mathcal{O}(n\log^{3}n)\).2 Given an input kernel \(\mathbf{k}_{\textsc{Alg}}\) and input points \(\mathcal{S}_{\mathrm{in}}\), KT-Compress++ outputs a coreset \(\mathcal{S}_{\mathrm{KT}}\subset\mathcal{S}_{\mathrm{in}}\) with size \(n_{\mathrm{out}}\triangleq\sqrt{n}\ll n\). In this work, we leverage two guarantees of KT-Compress++. Informally, \(\mathcal{S}_{\mathrm{KT}}\) satisfies (with high probability):

Footnote 2: In the sequel, we use “KT” and “KT-Compress++” interchangeably since the underlying algorithm (kernel halving (2010, Alg. 1a)) and associated approximation guarantees are the same up to small constant factors.

\[(L^{\infty}\text{ bound})\quad\left\|(\mathbb{P}_{\mathrm{in}}- \mathbb{Q}_{\mathrm{out}})\mathbf{k}_{\textsc{Alg}}\right\|_{\infty} \leq C_{1}\frac{\sqrt{d}\log n_{\mathrm{out}}}{n_{\mathrm{out}}} \tag{9}\] \[(\mathrm{MMD}\text{ bound})\quad\sup_{\|h\|_{\mathbf{k}_{\textsc {Alg}}}\leq 1}|(\mathbb{P}_{\mathrm{in}}-\mathbb{Q}_{\mathrm{out}})h| \leq C_{2}\frac{\sqrt{\log n_{\mathrm{out}}\cdot\log\mathcal{N}_{ \mathbf{k}_{\textsc{Alg}}}(\mathbb{B}_{2}(\mathfrak{R}_{\mathrm{in}}),1/n_{ \mathrm{out}})}}{n_{\mathrm{out}}}, \tag{10}\]

where \(C_{1},C_{2}>0\) are constants that depend on the properties of the input kernel \(\mathbf{k}_{\textsc{Alg}}\) and the chosen failure probability of KT-Compress++, \(\mathfrak{R}_{\mathrm{in}}\) characterizes the radius of \(\{x_{i}\}_{i=1}^{n}\), and \(\mathcal{N}_{\mathbf{k}_{\textsc{Alg}}}(\mathbb{B}_{2}(\mathfrak{R}_{\mathrm{ in}}),1/n_{\mathrm{out}})\) denotes the kernel covering number of \(\mathcal{H}(\mathbf{k}_{\textsc{Alg}})\) over the ball \(\mathbb{B}_{2}(\mathfrak{R}_{\mathrm{in}})\subset\mathbb{R}^{d}\) at a specified tolerance (see Sec. 4.2 for formal definitions).

At its highest level, KT provides good approximation of function averages. The bound (9) (formally stated in Lem. 1) controls the worst-case point-wise error, and is near-minimax optimal by Phillips and Tai (1996, Thm. 3.1). In the sequel, we leverage this type of result to derive generalization bounds for the kernel smoothing problem. The bound (10) (formally stated in Lem. 2) controls the integration error of functions in \(\mathcal{H}(\mathbf{k}_{\textsc{Alg}})\) and is near-minimax optimal by Tolstikhin et al. (2016, Thm. 1, 6). In the sequel, we leverage this type of result to derive generalization bounds for the KRR problem.

### Supervised kernel thinning

We show how the approximation results from kernel thinning can be extended to the regression setting. We construct two meta-kernels, the Nadaraya-Watson meta-kernel \(\mathbf{k}_{\mathrm{SW}}\) and the ridge-regression meta-kernel \(\mathbf{k}_{\mathrm{RR}}\), which take in a _base kernel_\(\mathbf{k}\) (defined over \(\mathcal{X}\) only) and return a new kernel (defined over \(\mathcal{X}\times\mathcal{Y}\)). When running KT, we set this new kernel as \(\mathbf{k}_{\mathrm{ALG}}\).

#### 3.3.1 Kernel-thinned Nadaraya-Watson regression (KT-NW)

A tempting choice of kernel for KT-NW is the kernel \(\mathbf{k}\) itself. That is, we can thin the input points using the kernel

\[\mathbf{k}_{\mathrm{ALG}}((x_{1},y_{1}),(x_{2},y_{2}))\triangleq \mathbf{k}(x_{1},x_{2}). \tag{11}\]

This choice is sub-optimal since it ignores any information in the response variable \(y\). For our supervised learning set-up, perhaps another intuitive choice would be to use KT with

\[\mathbf{k}_{\mathrm{ALG}}((x_{1},y_{1}),(x_{2},y_{2}))\triangleq \mathbf{k}((x_{1},y_{1}),(x_{2},y_{2})), \tag{12}\]

where \((x,y)\) denotes the concatenation of \(x\) and \(y\). While this helps improve performance, there remains a better option as we illustrate next.

In fact, a simple but critical observation immediately reveals a superior choice of the kernel to be used in KT for NW estimator. We can directly observe that the NW estimator is a ratio of the averages of two functions:

\[f_{\mathrm{numer}}(x,y)(\cdot) \triangleq\mathbf{k}(x,\cdot)\langle y,1\rangle_{\mathbb{R}}\] \[\text{and}\quad f_{\mathrm{denom}}(x,y)(\cdot) \triangleq\mathbf{k}(x,\cdot),\]

over the empirical distribution \(\mathbb{P}_{\mathbbm{m}}\) (6). Recall that KT provides a good approximation of sample means of functions in an RKHS, so it suffices to specify a "correct" choice of the RKHS (or equivalently the "correct" choice of the reproducing kernel). We can verify that \(f_{\mathrm{denom}}\) lies in the RKHS associated with kernel \(\mathbf{k}(x_{1},x_{2})\) and \(f_{\mathrm{numer}}\) lies in the RKHS associated with kernel \(\mathbf{k}(x_{1},x_{2})\cdot y_{1}y_{2}\). This motivates our definition for the Nadaraya-Watson kernel:

\[\mathbf{k}_{\mathrm{NW}}((x_{1},y_{1}),(x_{2},y_{2}))\triangleq \mathbf{k}(x_{1},x_{2})+\mathbf{k}(x_{1},x_{2})\cdot y_{1}y_{2} \tag{13}\]

since then we do have \(f_{\mathrm{denom}},f_{\mathrm{numer}}\in\mathcal{H}(\mathbf{k}_{\mathrm{NW}})\). Intuitively, thinning with \(\mathbf{k}_{\mathrm{RR}}\) should simultaneously provide good approximation of averages of \(f_{\mathrm{denom}}\) and \(f_{\mathrm{numer}}\) over \(\mathbb{P}_{\mathbbm{m}}\) (see the formal argument in Sec. 4.1). When \(\mathcal{S}_{\mathrm{out}}=\text{KT-Compress++}(\mathcal{S}_{\mathrm{in}}, \mathbf{k}_{\mathrm{NW}},\delta)\), we call the resulting solution to (7) the kernel-thinned Nadaraya-Watson (KT-NW) estimator, denoted by \(\widehat{f}_{\mathrm{KT}}\).

As we show in Fig. 1(a), this theoretically principled choice does provide practical benefits in MSE performance across sample sizes.

Figure 1: **MSE vs choice of kernels. For exact settings and further discussion see Sec. 5.1.**

#### 3.3.2 Kernel-thinned kernel ridge regression (KT-KRR)

While with NW estimator, the closed-form expression was a ratio of averages, the KRR estimate (4) can not be expressed as an easy function of averages. However, notice that \(L_{\mathcal{S}_{\mathrm{in}}}\) in (3) is an average of the function \(\ell_{f}:\mathcal{X}\times\mathcal{Y}\to\mathbb{R}\) defined as

\[\ell_{f}(x,y)\triangleq f^{2}(x)-2f(x)y+y^{2}\quad\text{for}\quad f\in\mathcal{ H}(\mathbf{k}).\]

Thus, there may be hope of deriving a KT-powered KRR estimator by thinning \(L_{\mathcal{S}_{\mathrm{in}}}\) with the appropriate kernel. Assuming \(f\in\mathcal{H}(\mathbf{k})\), we can verify that \(f^{2}\) lies in the RKHS associated with kernel \(\mathbf{k}^{2}(x_{1},x_{2})\) and that \(-2f(x)y\) lies in the RKHS associated with kernel \(\mathbf{k}(x_{1},x_{2})\cdot y_{1}y_{2}\). We now define the ridge regression kernel by

\[\mathbf{k}_{\mathrm{RR}}((x_{1},y_{1}),(x_{2},y_{2}))\triangleq\mathbf{k}^{2} (x_{1},x_{2})+\mathbf{k}(x_{1},x_{2})\cdot y_{1}y_{2} \tag{14}\]

and we can verify that \(f^{2}(x)-2f(x)y\) lies in the RKHS \(\mathcal{H}(\mathbf{k}_{\mathrm{RR}})\).3 When \(\mathcal{S}_{\mathrm{out}}\triangleq\text{KT-Compress++}(\mathcal{S}_{\mathrm{in} },\mathbf{k}_{\mathrm{RR}},\delta)\), we call the resulting solution to (8) the kernel-thinned KRR (KT-KRR) estimator with regularization parameter \(\lambda^{\prime}>0\), denoted \(\widehat{f}_{\mathrm{KT},\lambda^{\prime}}\). We note that the kernel \(\mathbf{k}_{\mathrm{RR}}\) also appears in (12, Lem. 4), except our subsequent analysis comes with generalization bounds for the KT-KRR estimator. Like for NW, in Fig. 1(b) we do a comparison for KRR-MSE across many kernel choices and conclude that the choice (14) is indeed a superior choice compared to the base kernel \(\mathbf{k}\) and the concatenated kernel (12).

Footnote 3: One might expect the ridge regression kernel to include a term that accounts for \(y^{2}\). However, the generalization bounds turn out to be essentially the same regardless of whether we include this term when defining \(\mathbf{k}_{\mathrm{RR}}\).

## 4 Main results

We derive generalization bounds of our two proposed estimators. In particular, we bound the mean squared error (MSE) defined by \(\left\lVert f-f^{\star}\right\rVert_{2}^{2}=\mathbb{E}_{X}\big{[}(f(X)-f^{ \star}(X))^{2}\big{]}\). Our first assumption is that of a well-behaved density on the covariate space. This assumption mainly simplifies our analysis of Nadaraya-Watson and kernel ridge regression, but can in principle be relaxed.

**Assumption 1** (Compact support).: _Suppose that \(\mathcal{X}\subset\mathbb{B}_{2}(\mathfrak{R}_{\mathrm{in}})\subset\mathbb{R} ^{d}\) for some \(\mathfrak{R}_{\mathrm{in}}>0\) and that the density \(p\) satisfies \(0<p_{\mathrm{min}}\leq p(x)\leq p_{\mathrm{max}}\) for all \(x\in\mathcal{X}\)._

### KT-Nw

For the analysis of the NW estimator, we define function complexity in terms of Holder smoothness following prior work [27].

**Definition 1**.: _For \(L>0\) and \(\beta\in(0,1]\), a function \(f:\mathcal{X}\to\mathbb{R}\) is \((\beta,L)\)-Holder if for all \(x_{1},x_{2}\in\mathcal{X}\), \(\left\lvert f(x_{1})-f(x_{2})\right\rvert\leq L\left\lVert x_{1}-x_{2}\right\rVert ^{\beta}\)._

Our next assumption is that on the kernel. Whereas typically the NW estimator does not require a reproducing kernel, our KT-NW estimator requires that \(\mathbf{k}\) be reproducing to allow for valid analysis.

**Assumption 2** (Shift-invariant kernel).: \(\mathbf{k}\) _is a reproducing kernel function (i.e., symmetric and positive semidefinite) defined by \(\mathbf{k}(x_{1},x_{2})\triangleq\kappa(\left\lVert x_{1}-x_{2}\right\rVert/h)\), where \(h>0\) and \(\kappa:\mathbb{R}\to\mathbb{R}\) is bounded by 1, \(L_{\kappa}\)-Lipschitz, square-integrable, and satisfies:_

\[\log(L_{\kappa}\cdot\kappa^{\dagger}(1/n))=\mathcal{O}(\log n),\quad\text{ where}\quad\kappa^{\dagger}(u)\triangleq\sup\{r:\kappa(r)\geq u\}; \tag{15}\]

_Additionally, there must exist constants \(c_{1},c_{2}>0\) such that_

\[2^{j\beta}\sup_{x\in\mathcal{X}}\int_{\left\lVert z\right\rVert \in[(2^{j-1}-\frac{1}{2})h,(2^{j}+\frac{1}{2})h]}\mathbf{k}(x,x-z)dz\leq c_{1 }\cdot\sup_{x\in\mathcal{X}}\int_{\left\lVert z\right\rVert\in[0,\frac{1}{2} h]}\mathbf{k}(x,x-z)dz\quad\text{and} \tag{16}\] \[(2^{j}+\frac{1}{2})^{d}2^{j\beta}\kappa(2^{j-1}-1)\leq c_{2}\cdot \int_{0}^{\frac{1}{2}}\kappa(u)u^{d-1}du\quad\text{for all}\quad j=1,2,\ldots. \tag{17}\]

When \(\mathbf{k}\) is a compact kernel, such as Wendland, Sinc, and B-spline, Assum. 2 is easily satisfied. In App. G, we prove that Gaussian and Matern (with \(\nu>d/2+1\)) kernels also satisfy Assum. 2. We now present our main result for the KT-NW estimator. See App. B for the proof.

**Theorem 1** (Kt-Nw).: _Suppose that Assum. 1 and 2 hold and that \(f^{\star}\in\Sigma(\beta,L_{f})\) with \(\beta\in(0,1]\). Then for any fixed \(\delta\in(0,1]\), the KT-NW estimator (7) with \(n_{\mathrm{out}}=\sqrt{n}\) and bandwidth \(h=n^{-\frac{1}{2\beta+2d}}\) satisfies_

\[\|\widehat{f}_{\mathrm{KT}}-f^{\star}\|_{2}^{2}\leq Cn^{-\frac{ \beta}{\beta+d}}\log^{2}n, \tag{18}\]

_with probability at least \(1-\delta\), for some positive constant \(C\) that does not depend on \(n\)._

Tsybakov and Tsybakov [27], Belkin et al. [3] show that Full-NW achieves a rate of \(\mathcal{O}(n^{-\frac{2\beta}{2\beta+d}})\), which is minimax optimal for the \((\beta,L)\)-Holder function class. Compared to the ST-NW rate of \(n^{-\frac{\beta}{2\beta+d}}\), KT-NW achieves strictly better rates for all \(\beta>0\) and \(d>0\), while retaining ST-NW's fast query time of \(\mathcal{O}(\sqrt{n})\). Note that our method KT-NW has a training time of \(\mathcal{O}(n\log^{3}n)\), which is not much more than simply storing the input points.

### kt-krr

We present our main result for KT-KRR using finite-rank kernels. This class of RKHS includes linear functions and polynomial function classes.

**Theorem 2** (Kt-krr for finite-dimensional RKHS).: _Assume \(f^{\star}\in\mathcal{H}(\mathbf{k})\), Assum. 1 is satisfied, and \(\mathbf{k}\) has rank \(m\in\mathbb{N}\). Let \(\widehat{f}_{\mathrm{KT},\lambda^{\prime}}\) denote the KT-KRR estimator with regularization parameter \(\lambda^{\prime}=\mathcal{O}(\frac{m\log n_{\mathrm{out}}}{m/n_{\mathrm{out}}^ {2}})\). Then with probability at least \(1-2\delta-2e^{-\frac{\|f^{\star}\|_{\mathbf{k}}^{2}}{e_{1}(\|f^{\star}\|_{ \mathbf{k}}^{2}+\sigma^{2})}}\), the following holds:_

\[\|\widehat{f}_{\mathrm{KT},\lambda^{\prime}}-f^{\star}\|_{2}^{2} \leq\frac{Cm\cdot\log n_{\mathrm{out}}}{\min(n,n_{\mathrm{out}}^{2}}[\|f^{ \star}\|_{\mathbf{k}}+1]^{2} \tag{19}\]

_for some constant \(C\) that does not depend on \(n\) or \(n_{\mathrm{out}}\)._

See App. C for the proof. Under the same assumptions, Wainwright [29, Ex. 13.19] showed that the Full-KRR estimator \(\widehat{f}_{\mathrm{full},\lambda}\) achieves the minimax optimal rate of \(O(m/n)\) in \(O(n^{3})\) runtime. When \(n_{\mathrm{out}}=\sqrt{n}\log^{c}n\), the KT-KRR error rates from Thm. 2 match this minimax rate in \(\widetilde{O}(n^{3/2})\) time, a (near) quadratic improvement over the Full-KRR. On the other hand, standard thinning-KRR with similar-sized output achieves a quadratically poor MSE of order \(\frac{m}{\sqrt{n}}\).

Our method and theory also extend to the setting of infinte-dimensional kernels. To formalize this, we first introduce the notion of kernel covering number.

**Definition 2** (Covering number).: _For a kernel \(\mathbf{k}:\mathcal{Z}\times\mathcal{Z}\to\mathbb{R}\) with \(\mathbb{B}_{\mathbf{k}}\triangleq\{f\in\mathcal{H}:\|f\|_{\mathcal{H}}\leq 1\}\), a set \(\mathcal{A}\subset\mathcal{Z}\) and \(\epsilon>0\), the covering number \(\mathcal{N}_{\mathbf{k}}(\mathcal{A},\epsilon)\) is the minimum cardinality of all sets \(\mathcal{C}\subset\mathbb{B}_{\mathbf{k}}\) satisfying \(\mathbb{B}_{\mathbf{k}}\subset\bigcup_{h\in\mathcal{C}}\{g\in\mathbb{B}_{ \mathbf{k}}:\sup_{x\in\mathcal{A}}\lvert h(x)-g(x)\rvert\leq\epsilon\}\)._

We consider two general classes of kernels.

**Assumption 3**.: _For some \(\mathfrak{C}_{d}>0\), all \(r>0\) and \(\epsilon\in(0,1)\), and \(\mathbb{B}_{2}(r)=\big{\{}x\in\mathbb{R}^{d}:\|x\|_{2}\leq r\big{\}}\), a kernel \(\mathbf{k}\) is_

\[\textsc{LogGrowth}(\alpha,\beta)\quad\text{when}\quad\log\mathcal{ N}_{\mathbf{k}}(\mathbb{B}_{2}(r),\epsilon)\leq\mathfrak{C}_{d}\log(e/\epsilon)^{ \alpha}(r+1)^{\beta}\quad\text{with}\quad\alpha,\beta>0\quad\text{and}\] \[\textsc{PolyGrowth}(\alpha,\beta)\quad\text{when}\quad\log \mathcal{N}_{\mathbf{k}}(\mathbb{B}_{2}(r),\epsilon)\leq\mathfrak{C}_{d}(1/ \epsilon)^{\alpha}(r+1)^{\beta}\quad\text{with}\quad\alpha<2.\]

We highlight that the definitions above cover several popular kernels: LogGrowth kernels include finite-rank kernels and analytic kernels, like Gaussian, inverse multiquadratic (IMQ), and sinc [9, Prop. 2], while PolyGrowth kernels includes finitely-many continuously differentiable kernels, like Matern and B-spline [9, Prop. 3]. For clarity, here we present our guarantee for LogGrowth kernels and defer the other case to App. E.

**Theorem 3** (kt-krr guarantee for infinite-dimensional RKHS).: _Suppose Assum. 1 is satisfied and \(\mathbf{k}\) is LogGrowth\((\alpha,\beta)\) (Assume. 3). Then \(\widehat{f}_{\mathrm{KT},\lambda^{\prime}}\) with \(\lambda^{\prime}=\mathcal{O}(1/n_{\mathrm{out}})\) satisfies the following bound with probability at least \(1-2\delta-2e^{-\frac{\|f^{\star}\|_{\mathbf{k}}^{2}\log^{n}n}{e_{1}(1/f^{\star} \|_{\mathbf{k}}^{2}+\sigma^{2})}}\):_

\[\|\widehat{f}_{\mathrm{KT},\lambda^{\prime}}-f^{\star}\|_{2}^{2} \leq C\Big{(}\frac{\log^{n}n}{n}+\frac{\sqrt{\log^{n}n_{\mathrm{out}}}}{n_{ \mathrm{out}}}\Big{)}\cdot[\|f^{\star}\|_{\mathbf{k}}+1]^{2}. \tag{20}\]

_for some constant \(C\) that does not depend on \(n\) or \(n_{\mathrm{out}}\)._See App. E for the proof. When \(n_{\mathrm{out}}=\sqrt{n}\), ST-KRR achieves an excess risk rate of \(n^{-1/2}\log^{\alpha}n\) for \(\mathbf{k}\) satisfying \(\textsc{LogGrowth}(\alpha,\beta)\). While KT-KRR does not achieve a strictly better excess risk rate bound over ST-KRR, we see that in practice, KT-KRR still obtains an empirical advantage. Obtaining a sharper error rate for the infinite-dimensional kernel setting is an exciting venue for future work.

## 5 Experimental results

We now present experiments on simulated and real-world data. On real-world data, we compare our KT-KRR estimator with several state-of-the-art KRR methods, including Nystrom subsampling-based methods and KRR pre-conditioning methods. All our experiments were run on a machine with 8 CPU cores and 100 GB RAM. Our code can be found at [https://github.com/ag2435/npr](https://github.com/ag2435/npr).

### Simulation studies

We begin with some simulation experiments. For simplicity, let \(\mathcal{X}=\mathbb{R}\) and \(\mathbb{P}=\text{Unif}[-\sqrt{3},\sqrt{3}]\) so that \(\mathrm{Var}[X]=1\). We set

\[f^{\star}(x)=8\sin(8\pi x)\exp(x)\quad\text{and}\quad\sigma=1 \tag{21}\]

and follow (1) to generate \((y_{i})_{i=1}^{n}\) (see Fig. 2). We let the input sample size \(n\) vary between \(2^{8},2^{10},2^{12},2^{14}\) and set the output coreset size to be \(n_{\mathrm{out}}=\sqrt{n}\) in all cases. For NW, we use the Wendland\((0)\) kernel defined by

\[\mathbf{k}(x_{1},x_{2})\triangleq(1-\tfrac{\|x_{1}-x_{2}\|_{2}}{h})_{+}\quad \text{for}\quad h>0. \tag{22}\]

For KRR, we use the Gaussian kernel defined by

\[\mathbf{k}(x_{1},x_{2})\triangleq\exp(-\tfrac{\|x_{1}-x_{2}\|_{2}^{2}}{2h^{2}} )\quad\text{for}\quad h>0. \tag{23}\]

We select the bandwidth \(h\) and regularization parameter \(\lambda^{\prime}\) (for KRR) using grid search. Specifically, we use a held-out validation set of size \(10^{4}\) and run each parameter configuration \(100\) times to estimate the validation MSE since KT-KRR and ST-KRR are random.

Ablation study.In Fig. 2, we compare thinning with our proposed meta-kernel \(\mathbf{k}_{\textsc{Alg}}=\mathbf{k}_{\mathrm{NW}}\) to thinning with the baseline meta-kernels (11) and (12). For our particular regression function (21), thinning with (11) outperforms thinning with (12). We hypothesize that the latter kernel is not robust to the scaling of the response variables. By inspecting (22), we see that \(\|(x_{1},y_{1})-(x_{2},y_{2})\|_{2}\) is heavily determined by the \(y_{i}\) values when they are large compared to the values of \(x_{i}\)--as is the case on the right side of Fig. 2 (when \(X>0\)). Since \(\mathbb{P}\) is a uniform distribution, thinning with (11) evenly subsamples points along the input domain \(\mathcal{X}\), even though accurately learning the left side of Fig. 2 (when \(X<0\)) is not needed for effective prediction since it is primarily noise. Validating our theory from Thm. 1, the best performance is obtained when thinning with \(\mathbf{k}_{\mathrm{NW}}\) (13), which avoids evenly subsampling points along the input domain and correctly exploits the dependence between \(X\) and \(Y\).

In Fig. 2, we perform a similar ablation for KRR. Again we observe that thinning with \(\mathbf{k}_{\textsc{Alg}}((x_{1},y_{1}),(x_{2},y_{2}))=\mathbf{k}(x_{1},x_{2})\) outperforms thinning with \(\mathbf{k}_{\textsc{Alg}}((x_{1},y_{1}),(x_{2},y_{2}))=\mathbf{k}((x_{1},y_{1} ),(x_{2},y_{2}))\), while thinning with \(\mathbf{k}_{\textsc{Alg}}=\mathbf{k}_{\mathrm{RR}}\) achieves the best performance.

Comparison with Full, ST, RPCholesky.In Fig. 3(a), we compare the MSE of KT-NW to Full-NW, ST-NW (a.k.a "Subsample"), and RPCholesky-NW across four values of \(n\). This last method uses the pivot points from RPCholesky as the output coreset \(\mathcal{S}_{\mathrm{out}}\). At all \(n\) we evaluated, KT-NW achieves lower MSE than ST-NW and RPCholesky-NW. Full-NW achieves the lowest MSE across the board, but it suffers from significantly worse run times, especially at test time. Owing to its \(\mathcal{O}(n\log^{3}n)\) runtime, KT-NW is significantly faster than RPCholesky-NW for training and nearly matches ST-NW in both training and testing time. We hypothesize that RPCholesky--while it provides a good low-rank approximation of the kernel matrix--is not designed to preserve averages.

In Fig. 3(b), we compare the MSE of KT-KRR to Full-KRR, ST-KRR (a.k.a "Subsample"), and the RPCholesky-KRR method from Chen et al. [6, Sec. 4.2.2], which uses RPCholesky to select

Figure 2: **Simulated data.**

landmark points for the restricted KRR problem. We observe that KT-KRR achieves lower MSE than ST-KRR, but higher MSE than RPCholesky-KRR and Full-KRR. In Fig. 3(b), we also observe that KT-KRR is orders of magnitude faster than Full-KRR across the board, with runtime comparable to ST-KRR and RPCholesky-KRR in both training and testing.

### Real data experiments

We now present experiments on real-world data using two popular datasets: the California Housing regression dataset from Pace and Barry [17] ([https://scikit-learn.org/1.5/datasets/real_world.html#california-housing-dataset](https://scikit-learn.org/1.5/datasets/real_world.html#california-housing-dataset); BSD-3-Clause license) and the SUSY binary classification dataset from Baldi et al. [2] ([https://archive.ics.uci.edu/dataset/279/susy](https://archive.ics.uci.edu/dataset/279/susy); CC-BY-4.0 license).

California Housing dataset (\(d=8,N=2\times 10^{4}\)).Tab. 1(a) compares the test MSE, train times, and test times. We normalize the input features by subtracting the mean and dividing by the standard deviation and use a 80-20 train-test split. For all methods, we use the Gaussian kernel (23) with bandwidth \(h=10\). We use \(\lambda=\lambda^{\prime}=10^{-3}\) for Full-KRR, ST-KRR, and KT-KRR and \(\lambda=10^{-5}\) for RPCholesky-KRR. On this dataset, KT-KRR lies between ST-KRR and RPCholesky-KRR in terms of test MSE. When \(n_{\text{out}}=\sqrt{n}\), RPCholesky pivot selection takes \(\mathcal{O}(n^{2})\) time by Chen et al. [6, Alg. 2], compared to KT-COMPress++, which compresses the input points in only \(\mathcal{O}(n\log^{3}n)\) time. This difference in big-O runtime is reflected in our empirical results, where we see KT-KRR take 0.0153s versus 0.3237s for RPCholesky-KRR.

SUSY dataset (\(d=18,N=5\times 10^{6}\)).Tab. 1(b) compares our proposed method KT-KRR (with \(h=10,\lambda^{\prime}=10^{-1}\)) to several large-scale kernel methods, namely RPCholesky preconditioning [7], FALKON [22], and Conjugate Gradient (all with \(h=10,\lambda=10^{-3}\)) in terms of test classification error and training times. For the baseline methods, we use the Matlab implementation provided by Diaz et al. [7] ([https://github.com/eepperly/Robust-randomized-preconditioning-for-kernel-ridge-regression](https://github.com/eepperly/Robust-randomized-preconditioning-for-kernel-ridge-regression)). In

Figure 3: **MSE and runtime comparison on simulated data. Each point plots the mean and standard deviation across 100 trials (after parameter grid search).**

our experiment, we use \(4\times 10^{6}\) points for training and the remaining \(10^{6}\) points for testing. As is common practice for classification tasks, we use the Laplace kernel defined by \(\mathbf{k}(x_{1},x_{2})\triangleq\exp(-\|x_{1}-x_{2}\|_{2}/h)\). All parameters are chosen with cross-validation.

We observe that KT-KRR achieves test MSE between ST-KRR and RPCholesky preconditioning with training time almost half that of RPCholesky preconditioning. Notably, our Cython implementation of KT-Compress++ thinned the four million training samples in only 1.7 seconds on a single CPU core--with further speed-ups to be gained from parallelizing on a GPU in the future.

## 6 Conclusions

In this work, we introduce a meta-algorithm for speeding up two estimators from non-parametric regression, namely the Nadaraya-Watson and Kernel Ridge Regression estimators. Our method inherits the favorable computational efficiency of the underlying Kernel Thinning algorithm and stands to benefit from further advancements in unsupervised learning compression methods.

The KT guarantees provided in this work apply only when \(f^{\star}\in\mathcal{H}(\mathbf{k})\) for some base kernel \(\mathbf{k}\). In practice, choosing a good kernel \(\mathbf{k}\) is indeed a challenge common to all prior work. Our framework is friendly to recent developments in kernel selection to handle this problem: Dwivedi and Mackey (2019, Cor. 1) provide integration-error guarantees for KT when \(f^{\star}\notin\mathcal{H}(\mathbf{k})\). Moreover, there are recent results on finding the best kernel (e.g., for hypothesis testing (Bradhakrishnan et al., 2018, Sec. 4.2)). Radhakrishnan et al. (2018) introduce the Recursive Feature Machine, which uses a parameterized kernel \(\mathbf{k}_{M}(x_{1},x_{2})\triangleq\exp(-(x_{1}-x_{2})^{\top}M(x_{1}-x_{2})/ (2h^{2}))\), and propose an efficient method to learn the matrix parameter \(M\) via the average gradient outer product estimator. An exciting future direction would be to combine these parameterized (or "learned") kernels with our proposed KT methods for non-parametric regression.

## 7 Acknowledgements

AG is supported with funding from the NewYork-Presbyterian Hospital.

## References

* (1) Haim Avron, Kenneth L Clarkson, and David P Woodruff. Faster kernel ridge regression using sketching and preconditioning. _SIAM Journal on Matrix Analysis and Applications_, 38(4):1116-1138, 2017.

\begin{table}

\end{table}
Table 1: **Accuracy and runtime comparison on real-world data.** Each cell represents mean ± standard error across 100 trials.

* [2] Pierre Baldi, Peter Sadowski, and Daniel Whiteson. Searching for exotic particles in high-energy physics with deep learning. _Nature communications_, 5(1):4308, 2014.
* [3] Mikhail Belkin, Alexander Rakhlin, and Alexandre B Tsybakov. Does data interpolation contradict statistical optimality? In _The 22nd International Conference on Artificial Intelligence and Statistics_, pages 1611-1619. PMLR, 2019.
* [4] Christos Boutsidis, Petros Drineas, and Malik Magdon-Ismail. Near-optimal coresets for least-squares regression. _IEEE transactions on information theory_, 59(10):6880-6892, 2013.
* [5] Raffaello Camoriano, Tomas Angles, Alessandro Rudi, and Lorenzo Rosasco. Nytro: When subsampling meets early stopping. In _Artificial Intelligence and Statistics_, pages 1403-1411. PMLR, 2016.
* [6] Yifan Chen, Ethan N Epperly, Joel A Tropp, and Robert J Webber. Randomly pivoted cholesky: Practical approximation of a kernel matrix with few entry evaluations. _arXiv preprint arXiv:2207.06503_, 2022.
* [7] Mateo Diaz, Ethan N Epperly, Zachary Frangella, Joel A Tropp, and Robert J Webber. Robust, randomized preconditioning for kernel ridge regression. _arXiv preprint arXiv:2304.12465_, 2023.
* [8] Carles Domingo-Enrich, Raaz Dwivedi, and Lester Mackey. Compress then test: Powerful kernel testing in near-linear time. _arXiv preprint arXiv:2301.05974_, 2023.
* [9] Raaz Dwivedi and Lester Mackey. Generalized kernel thinning. In _International Conference on Learning Representations_, 2022.
* [10] Raaz Dwivedi and Lester Mackey. Kernel thinning. _Journal of Machine Learning Research_, 25(152):1-77, 2024.
* [11] Ahmed El Alaoui and Michael W Mahoney. Fast randomized kernel methods with statistical guarantees. _stat_, 1050:2, 2014.
* [12] Steffen Grunewalder. Compressed empirical measures (in finite dimensions). _arXiv preprint arXiv:2204.08847_, 2022.
* [13] Ming-Yueh Huang and Shu Yang. Robust inference of conditional average treatment effects using dimension reduction. _Statistica Sinica_, 32(Suppl):547, 2022.
* [14] Samory Kpotufe. Fast, smooth and adaptive regression in metric spaces. _Advances in Neural Information Processing Systems_, 22, 2009.
* [15] Beatrice Laurent and Pascal Massart. Adaptive estimation of a quadratic functional by model selection. _Annals of statistics_, pages 1302-1338, 2000.
* [16] Lingxiao Li, Raaz Dwivedi, and Lester Mackey. Debiased distribution compression. _arXiv preprint arXiv:2404.12290_, 2024.
* [17] R Kelley Pace and Ronald Barry. Sparse spatial autoregressions. _Statistics & Probability Letters_, 33(3):291-297, 1997.
* [18] Jeff M Phillips. Coresets and sketches. In _Handbook of discrete and computational geometry_, pages 1269-1288. Chapman and Hall/CRC, 2017.
* [19] Jeff M Phillips and Wai Ming Tai. Improved coresets for kernel density estimates. In _Proceedings of the Twenty-Ninth Annual ACM-SIAM Symposium on Discrete Algorithms_, pages 2718-2727. SIAM, 2018.

* [20] Adityanarayanan Radhakrishnan, Daniel Beaglehole, Parthe Pandit, and Mikhail Belkin. Feature learning in neural networks and kernel machines that recursively learn features. _arXiv preprint arXiv:2212.13881_, 2022.
* [21] Ali Rahimi and Benjamin Recht. Random features for large-scale kernel machines. _Advances in neural information processing systems_, 20, 2007.
* [22] Alessandro Rudi, Luigi Carratino, and Lorenzo Rosasco. Falkon: An optimal large scale kernel method. _Advances in neural information processing systems_, 30, 2017.
* [23] Abhishek Shetty, Raaz Dwivedi, and Lester Mackey. Distribution compression in near-linear time. In _International Conference on Learning Representations_, 2022.
* [24] Rahul Singh, Liyuan Xu, and Arthur Gretton. Sequential kernel embedding for mediated and time-varying dose response curves. _arXiv preprint arXiv:2111.03950_, 2021.
* [25] Ingo Steinwart and Simon Fischer. A closer look at covering number bounds for gaussian kernels. _Journal of Complexity_, 62:101513, 2021.
* [26] Ilya Tolstikhin, Bharath K Sriperumbudur, Krikamol Mu, et al. Minimax estimation of kernel mean embeddings. _Journal of Machine Learning Research_, 18(86):1-47, 2017.
* [27] Alexandre B Tsybakov and Alexandre B Tsybakov. Nonparametric estimators. _Introduction to Nonparametric Estimation_, pages 1-76, 2009.
* [28] Stephen Tu, Rebecca Roelofs, Shivaram Venkataraman, and Benjamin Recht. Large scale kernel learning using block coordinate descent. _arXiv preprint arXiv:1602.05310_, 2016.
* [29] Martin J Wainwright. _High-dimensional statistics: A non-asymptotic viewpoint_, volume 48. Cambridge University Press, 2019.
* [30] Holger Wendland. _Scattered data approximation_, volume 17. Cambridge university press, 2004.
* [31] Yuchen Zhang, John Duchi, and Martin Wainwright. Divide and conquer kernel ridge regression: A distributed algorithm with minimax optimal rates. _The Journal of Machine Learning Research_, 16(1):3299-3340, 2015.
* [32] Yan Zheng and Jeff M Phillips. Coresets for kernel regression. In _Proceedings of the 23rd ACM SIGKDD International Conference on Knowledge Discovery and Data Mining_, pages 645-654, 2017.

Background on KT-Compress++

This section details the KT-Compress++ algorithm of Shetty et al. [23, Ex. 6]. In a nutshell, KT-Compress (Alg. 2) takes as input a point sequence of size \(n\), a compression level \(\mathfrak{g}\), a (reproducing) kernel functions \(\mathbf{k}_{\textsc{Alg}}\), and a failure probability \(\delta\). KT-Compress++ first runs the KT-Compress(\(\mathfrak{g}\)) algorithm of Shetty et al. [23, Ex. 4] to produce an intermediate coreset of size \(2^{\mathfrak{g}}\sqrt{n}\). Next, the KT algorithm is run on the intermediate coreset to produce a final output of size \(\sqrt{n}\).

KT-Compress proceeds by calling the recursive procedure Compress, which uses KT with kernels \(\mathbf{k}_{\textsc{Alg}}\) as an intermediate halving algorithm. The KT algorithm itself consists of two subroutines: (1) KT-split (Alg. 3a), which splits a given input point sequence into two equal halves with small approximation error in the \(\mathbf{k}_{\textsc{Alg}}\) reproducing kernel Hilbert space and (2) KT-swap (Alg. 3b), which selects the best approximation amongst the KT-split coresets and a baseline coreset (that simply selects every other point in the sequence) and then iteratively refines the selected coreset by swapping out each element in turn for the non-coreset point that most improves \(\mathrm{MMD}_{\mathbf{k}_{\textsc{Alg}}}\) error. As in Shetty et al. [23, Rem. 3], we symmetrize the output of KT by returning either the KT coreset or its complement with equal probability.

Following Shetty et al. [23, Ex. 6], we always default to \(\mathfrak{g}=\lceil\log_{2}\log n+3.1\rceil\) so that KT-Compress++ has an overall runtime of \(\mathcal{O}(n\log^{3}n)\). For the sake of simplicity, we drop any dependence on \(\mathfrak{g}\) in the main paper.

```
Input: point sequence \(\mathcal{S}_{\mathrm{in}}\) of size \(n\), compression level \(\mathfrak{g}\), kernel \(\mathbf{k}_{\textsc{Alg}}\), failure probability \(\delta\) \(\mathcal{S}_{\mathrm{C}}\leftarrow\) KT-Compress\((\mathfrak{g},\mathcal{S}_{\mathrm{in}},\delta)\)// coreset of size \(2^{\mathfrak{g}}\sqrt{n}\) \(\mathcal{S}_{\mathrm{C}\ast\ast}\leftarrow\) KT\((\mathcal{S}_{\mathrm{C}},\mathbf{k}_{\textsc{Alg}},\frac{\mathfrak{g}}{\mathfrak{g}+2^{ \mathfrak{g}}(\beta_{n}+1)}\delta)\)// coreset of size \(\sqrt{n}\) return\(\mathcal{S}_{\mathrm{C}\ast\ast}\)
```

**Algorithm 1**KT-Compress++ - Identify coreset of size \(\sqrt{n}\)

```
Input: point sequence \(\mathcal{S}_{\mathrm{in}}\) of size \(n\), compression level \(\mathfrak{g}\), kernel \(\mathbf{k}_{\textsc{Alg}}\), failure probability \(\delta\) return\(\textsc{Compress}(\mathcal{S}_{\mathrm{in}},\mathfrak{g},\mathbf{k}_{\textsc{Alg}}, \frac{\delta}{\mathrm{m}\mathfrak{g}+1(\log_{\mathfrak{g}}n-\mathfrak{g})})\)
```

**Algorithm 2**KT-Compress - Identify coreset of size \(2^{\mathfrak{g}}\sqrt{n}\)

Define the event

\[\mathcal{E}_{\textsc{KT},\delta}\triangleq\{\textsc{KT-Compress++ succeeds}\}. \tag{24}\]

Dwivedi and Mackey [10, Thm. 1, Rmk. 4] show that

\[\mathbb{P}(\mathcal{E}_{\textsc{KT},\delta})\geq 1-\delta.\]

We restate [10, Thm. 4] in our notation:

**Lemma 1** (\(L^{\infty}\) guarantee for KT-Compress++).: _Let \(\mathcal{Z}\subset\mathbb{R}^{d}\) and consider a reproducing kernel \(\mathbf{k}_{\textsc{Alg}}:\mathcal{Z}\times\mathcal{Z}\rightarrow\mathbb{R}\). Assume \(n/n_{\mathrm{out}}\in 2^{\mathbb{N}}\). Let \(\mathcal{S}_{\textsc{KT}}\triangleq\textsc{KT-Compress++}(\mathcal{S}_{\mathrm{ in}},\mathfrak{g},\mathbf{k}_{\textsc{Alg}},\delta)\) and define \(\mathbb{P}_{\text{in}}\triangleq\frac{1}{n}\sum_{z\in\mathcal{S}_{\text{in}}}\delta _{z}\) and \(\mathbb{Q}_{\text{out}}\triangleq\frac{1}{n_{\text{out}}}\sum_{z\in\mathcal{S}_{ \text{KT}}}\delta_{z}\). Then on event \(\mathcal{E}_{\text{KT},\delta}\), the following bound holds:_

\[\left\|(\mathbb{P}_{\text{in}}-\mathbb{Q}_{\text{out}})\mathbf{k}_{ \text{ALG}}\right\|_{\infty} \leq c\frac{\left\|\mathbf{k}_{\text{ALG}}\right\|_{\infty,\text{ in}}}{n_{\text{out}}}\mathfrak{M}_{\mathbf{k}_{\text{ALG}}}(n,n_{\text{out}},d, \delta,R),\quad\text{where} \tag{25}\] \[\mathfrak{M}_{\mathbf{k}_{\text{ALG}}}(n,n_{\text{out}},d,\delta,R) \triangleq\sqrt{\log\Bigl{(}\frac{n_{\text{out}}\,\log_{2}(n/n_{ \text{out}})}{\delta}\Bigr{)}}\times\] (26) \[\qquad\qquad\qquad\biggl{[}\sqrt{\log\bigl{(}\frac{1}{\delta} \bigr{)}}+\sqrt{d\log\Bigl{(}1+\frac{L_{\mathbf{k}_{\text{ALG}}}}{\left\| \mathbf{k}_{\text{ALG}}\right\|_{\infty}}\bigl{(}R_{\mathbf{k}_{\text{ALG}},n }+R\bigr{)}\Bigr{)}}\biggr{]},\] \[L_{\mathbf{k}_{\text{ALG}}} \triangleq\sup_{z_{1},z_{2},z_{3}\in\mathcal{Z}}\frac{\left\| \mathbf{k}_{\text{ALG}}(z_{1},z_{2})-\mathbf{k}_{\text{ALG}}(z_{1},z_{3}) \right\|}{\|z_{2}-z_{3}\|_{2}},\quad\text{and}\] (27) \[R_{\mathbf{k}_{\text{ALG}},n} \triangleq\inf\biggl{\{}r:\sup_{\begin{subarray}{c}z_{1},z_{2} \in\mathcal{Z}\\ \|z_{1}-z_{2}\|_{2}\geq r\end{subarray}}\left|\mathbf{k}_{\text{ALG}}(z_{1},z_ {2})\right|\leq\frac{\left\|\mathbf{k}_{\text{ALG}}\right\|_{\infty}}{n} \biggr{\}}, \tag{28}\]

_for some universal positive constant \(c\)._

Proof.: The claim follows by replacing \(\mathbf{k}\)[10, Thm. 4] with \(\mathbf{k}_{\text{ALG}}\), replacing the sub-Gaussian constant of KT with that of KT-Compress++ in [23, Ex. 5], and replacing \(\left\|\mathbf{k}_{\text{ALG}}\right\|_{\infty}\) with \(\left\|\mathbf{k}_{\text{ALG}}\right\|_{\infty,\text{in}}\triangleq\sup_{z\in \mathcal{S}_{\text{in}}}\mathbf{k}_{\text{ALG}}(z,z)\) throughout. 

We restate [9, Thm. 2] in our notation:

**Lemma 2** (MMD guarantee for KT-Compress++).: _Let \(\mathcal{Z}\subset\mathbb{R}^{d}\) and consider a reproducing kernel \(\mathbf{k}_{\textsc{Alg}}:\mathcal{Z}\times\mathcal{Z}\to\mathbb{R}\). Assume \(n/n_{\mathrm{out}}\in 2^{\mathbb{N}}\). Let \(\mathcal{S}_{\mathrm{KT}}\triangleq\)_ KT-Compress++\((\mathbf{k}_{\textsc{Alg}},\mathfrak{g})(\mathcal{S}_{\mathrm{in}})\) and define \(\mathbb{P}_{\mathrm{in}}\triangleq\frac{1}{n}\sum_{z\in\mathcal{S}_{\mathrm{ in}}}\delta_{z}\) and \(\mathbb{Q}_{\mathrm{out}}\triangleq\frac{1}{n_{\mathrm{out}}}\sum_{z\in \mathcal{S}_{\mathrm{KT}}}\delta_{z}\). Then on event \(\mathcal{E}_{\mathcal{KT},\delta}\), the following bound holds:_

\[\sup_{\begin{subarray}{c}h\in\mathcal{H}(\mathbf{k}_{\textsc{Alg}} )\cdot[(\mathbb{P}_{\mathrm{in}}-\mathbb{Q}_{\mathrm{out}})h]\leq\inf_{ \begin{subarray}{c}\in(0,1)\\ \mathcal{S}_{\mathrm{in}}\in\mathcal{A}\end{subarray}}\left\{2\epsilon+\frac{2 \|\mathbf{k}_{\textsc{Alg}}\|_{\textsc{Alg}}^{1/2}}{n_{\mathrm{out}}}\mathfrak{ M}_{\mathbf{k}_{\textsc{Alg}}}(n,n_{\mathrm{out}},\delta,\mathcal{A},\epsilon) \right\}\quad\text{where}\] \[\mathfrak{M}_{\mathbf{k}_{\textsc{Alg}}}(n,n_{\mathrm{out}}, \delta,R,\epsilon)\triangleq c\sqrt{\log\left(\frac{n_{\mathrm{out}}\log(n/n_ {\mathrm{out}})}{\delta}\right)\cdot\left[\log(\frac{1}{\delta})+\log\mathcal{ N}_{\mathbf{k}_{\textsc{Alg}}}(\mathcal{A},\epsilon)\right]}. \tag{29}\]

_for some universal postive constant \(c\)._

Proof.: The claim follows from replacing \(\mathbf{k}\) in [9, Thm. 2] with \(\mathbf{k}_{\textsc{Alg}}\) and replacing the sub-Gaussian constant of KT with that of KT-Compress++ in [23, Ex. 5]. 

## Appendix B Proof of Thm. 1: KT-NW

Our primary goal is to bound \(\mathbb{E}_{\mathcal{S}_{\mathrm{in}}}[(\widehat{f}_{\mathrm{KT}}(x_{0})-f^{ \star}(x_{0}))^{2}]\) for a fixed \(x_{0}\in\mathcal{X}\). Once we have this bound, bounding \(\|\widehat{f}_{\mathrm{KT}}-f^{\star}\|_{2}^{2}\) is as straightforward as integrating over \(x_{0}\in\mathcal{X}\).

Consider the following decomposition:

\[\mathbb{E}_{\mathcal{S}_{\mathrm{in}}}\bigg{[}\Big{(}\widehat{f} _{\mathrm{KT}}(x_{0})-f^{\star}(x_{0})\Big{)}^{2}\bigg{]} =\mathbb{E}_{\mathcal{S}_{\mathrm{in}}}\bigg{[}\Big{(}\widehat{f} _{\mathrm{KT}}(x_{0})-\widehat{f}(x_{0})+\widehat{f}(x_{0})-f^{\star}(x_{0}) \Big{)}^{2}\bigg{]}\] \[\leq 2\ \mathbb{E}_{\mathcal{S}_{\mathrm{in}}}\bigg{[}\Big{(} \widehat{f}_{\mathrm{KT}}(x_{0})-\widehat{f}(x_{0})\Big{)}^{2}\bigg{]} \tag{30}\] \[\quad+2\ \mathbb{E}_{\mathcal{S}_{\mathrm{in}}}\bigg{[}\Big{(} \widehat{f}(x_{0})-f^{\star}(x_{0})\Big{)}^{2}\bigg{]}. \tag{31}\]

Define the random variables

\[\eta_{i}\triangleq\mathbf{1}\Big{\{}\frac{\|X_{i}-x_{0}\|}{h}\leq 1\Big{\}} \quad\text{for}\quad i=1,2,\ldots,n.\]

Also define the event

\[\mathcal{E}\triangleq\{\sum_{i=1}^{n}\eta_{i}>0\}. \tag{32}\]

Since \(X_{i}\) are i.i.d. samples from \(\mathbb{P}\), it follows that \(\eta_{i}\) are i.i.d. Bernoulli random variables with parameter

\[\overline{p}\triangleq\mathbb{P}(\eta_{i}=1)\geq c_{0}p_{\mathrm{ min}}h^{d}, \tag{33}\]

where \(c_{0}>0\) depends only on \(d\) and \(\kappa\) (see Assum. 2). Denote the denominator terms in \(\widehat{f}\) and \(\widehat{f}_{\mathrm{KT}}\) by

\[\widehat{p}(\cdot)\triangleq\tfrac{1}{n}\sum_{i=1}^{n}\mathbf{k}(\cdot,x_{i}) \quad\text{and}\quad\widehat{p}_{\mathrm{KT}}(\cdot)\triangleq\tfrac{1}{n_{ \mathrm{out}}}\sum_{j=1}^{n_{\mathrm{out}}}\mathbf{k}(\cdot,x_{i}^{\prime}), \tag{34}\]

respectively, and the numerator terms in \(\widehat{f}\) and \(\widehat{f}_{\mathrm{KT}}\) by

\[\widehat{A}(\cdot)\triangleq\tfrac{1}{n}\sum_{i=1}^{n}\mathbf{k}(\cdot,x_{i}) y_{i}\quad\text{and}\quad\widehat{A}_{\mathrm{KT}}(\cdot)\triangleq\tfrac{1}{n_{ \mathrm{out}}}\sum_{j=1}^{n_{\mathrm{out}}}\mathbf{k}(\cdot,x_{i}^{\prime})y_{i} ^{\prime}, \tag{35}\]

respectively.

We now consider two cases depending on the event \(\mathcal{E}\).

_Case I:_ Suppose event \(\mathcal{E}^{c}\) is satisfied. It follows from (34) that \(\widehat{p}(x_{0})=0\), in which case \(\widehat{f}(x_{0})=0\). Since \(\mathcal{S}_{\mathrm{out}}\subset\mathcal{S}_{\mathrm{in}}\), it necessarily follows that \(\widehat{p}_{\mathrm{KT}}(x_{0})=0\) and \(\widehat{f}_{\mathrm{KT}}(x_{0})=0\). Thus, we can bound (30) and (31) by

\[\mathbb{E}_{\mathcal{S}_{\mathrm{in}}}\bigg{[}\Big{(}\widehat{f}_{\mathrm{ KT}}(x_{0})-\widehat{f}(x_{0})\Big{)}^{2}\mathbb{I}[\mathcal{E}^{c}]\bigg{]}=0 \quad\text{and}\]\[\mathbb{E}_{\mathcal{S}_{\mathrm{in}}}\bigg{[}\Big{(}\widehat{f}(x_{0} )-f^{\star}(x_{0})\Big{)}^{2}\mathbb{I}[\mathcal{E}^{c}]\bigg{]} =\mathbb{E}_{\mathcal{S}_{\mathrm{in}}}\Big{[}(0-f^{\star}(x_{0})) ^{2}\ \mathbb{I}[\mathcal{E}^{c}]\Big{]}\] \[\leq(f^{\star})^{2}(x_{0})\mathbb{P}(\mathcal{E}^{c})\] \[\leq(f^{\star})^{2}(x_{0})(1-\overline{p})^{n}\] \[\leq(f^{\star})^{2}(x_{0})\exp\{-Cnh^{d}\}\]

for some positive constant \(C\) that does not depend on \(n\). Note that these are low-order terms compared to the rest of the calculations, so we may ignore them in the final bound.

_Case II:_ Otherwise, we may assume event \(\mathcal{E}\) is satisfied. Let us first bound (30). On event \(\mathcal{E}_{\mathrm{KT},\delta}\) (24), we claim that

\[\mathbb{E}_{\mathcal{S}_{\mathrm{in}}}\bigg{[}\Big{(}\widehat{f} (x_{0})-\widehat{f}(x_{0})\Big{)}^{2}\mathbb{I}[\mathcal{E}]\bigg{]} \leq\frac{Cd\log^{2}n}{nh^{2d}}\quad\text{whenever}\quad\overline{p}=\omega( \sqrt{\tfrac{d}{n}}\log n). \tag{36}\]

We defer the proof to App. B.1.

Letting \(X\triangleq(X_{1},\ldots,X_{n})\) and \(Y\triangleq(Y_{1},\ldots,Y_{n})\) denote the \(x\) and \(y\) components of \(\mathcal{S}_{\mathrm{in}}\), respectively, we can further decompose (31) by

\[\mathbb{E}_{\mathcal{S}_{\mathrm{in}}}\bigg{[}\Big{(}\widehat{f} (x_{0})-f^{\star}(x_{0})\Big{)}^{2}\ \mathbb{I}[\mathcal{E}]\bigg{]} =\mathbb{E}_{X}\bigg{[}\mathbb{E}_{Y|X}\bigg{[}\Big{(}\widehat{f }(x_{0})-\mathbb{E}_{Y|X}\Big{[}\widehat{f}(x_{0})\Big{]}\Big{)}^{2}\bigg{]} \ \mathbb{I}[\mathcal{E}]\bigg{]}\] \[\qquad+\mathbb{E}_{X}\bigg{[}\Big{(}\mathbb{E}_{Y|X}\Big{[} \widehat{f}(x_{0})\Big{]}-f^{\star}(x_{0})\Big{)}^{2}\ \mathbb{I}[\mathcal{E}] \bigg{]},\]

where the first RHS term corresponds to the variance and the second RHS term corresponds to the bias. We claim that

\[\mathbb{E}_{X}\bigg{[}\mathbb{E}_{Y|X}\bigg{[}\Big{(}\widehat{f} (x_{0})-\mathbb{E}_{Y|X}\Big{[}\widehat{f}(x_{0})\Big{]}\Big{)}^{2}\bigg{]}\ \mathbb{I}[ \mathcal{E}]\bigg{]} \leq\sigma_{\xi}^{2}\big{(}n\exp\{-Cnh^{d}\}+\tfrac{C}{nh^{d}} \big{)}\quad\text{and} \tag{37}\] \[\mathbb{E}_{X}\bigg{[}\Big{(}\mathbb{E}_{Y|X}\Big{[}\widehat{f}(x _{0})\Big{]}-f^{\star}(x_{0})\Big{)}^{2}\ \mathbb{I}[\mathcal{E}]\bigg{]} \leq C\cdot L_{f}^{2}h^{2\beta}\log^{2}n, \tag{38}\]

for some constant \(C>0\) that does not depend on either \(n\) or \(h\). We defer the proofs to App. B.2 and B.3. Combining (36) to (38), we have

\[\mathbb{E}_{\mathcal{S}_{\mathrm{in}}}\bigg{[}\Big{(}\widehat{f} (x_{0})-f^{\star}(x_{0})\Big{)}^{2}\mathbb{I}[\mathcal{E}]\bigg{]}\leq\frac{ Cd\log^{2}n}{\text{\small{\sc{\small{\sc{\small{\sc{\small{\sc{\small{ \small{\sc{\small{\small{\small{\small{\small{\small{\small{\leftleft.}}}}}}}}}}}}}}} \times\underbrace{2\sigma_{\xi}^{2}\Big{(}ne^{-Cnh^{d}}+\tfrac{C}{nh^{d}}\Big{)} }_{\text{\small{\sc{\small{\sc{\small{\sc{\small{\sc{\small{\small{\sc{ \small{\small{\small{\small{\small{\small{\left.{\left.}}}}}}}}}}}}}}}}\times \underbrace{2C\sigma_{\xi}^{2}\Big{(}ne^{-Cnh^{d}}+\tfrac{C}{nh^{d}}\Big{)} }_{\text{\small{\sc{\small{\sc{\small{\sc{\small{\small{\sc{\small{\small{ \small{\small{\small{\small{\small{\left{\left.}}}}}}}}}}}}}}}\times\frac{C}{nh^{d}} }\Big{)}}_{\text{\small{\sc{\small{\small{\sc{\small{\small{\small{\small{ \small{\small{\small{\small{\{\small{\small{\small{\small{\left{\left{\left.}}}}}}}}}}}}}}}}} \times\frac{C}{nh^{d}}\Big{)}}_{\text{\small{\sc{\small{\small{\small{ \small{\small{\small{\small{\small{\small{\small{\small{\small{\small{\small{\small{ \left{\left{\left{\left.}}}}}}}}}}}}}}}}}\times\frac{C}{nh^{d}}\Big{)}} \times\underbrace{2CL_{f}^{2}h^{2\beta}\log^{2}n}_{\text{\small{\sc{\small{ \small{\small{\small{\small{\small{\small{\small{\small{\small{\small{\small{ \small{{\left{\left{\left{\left.{\left}}}}}}}}}}}}}}}}\times\frac{C}{nh^{d}} \Big{)}}_{\text{\small{\sc{\small{\small{\small{\small{\small{\small{\small{ \small{\small{\small{\small{\{\small{\small{\left{\left{\left{\left.{\left{\left{\left{\left{\left{\left{\left{\left. \left{\left{\left{\left{\left{\left{\left{\leftleftleftleft({\left({\cdot{\cdot{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{                                                                                                       0 0 1 0}}}}}}}}}}}}{}}}\)\)
}}\)
}}\)

}\)

\)See App. B.1.1 for the proof. In the sequel, we will simply treat the \(\log(1/\delta)\) term as a constant, meaning the \(\log n\) terms dominate in the expressions.

With this lemma in hand, let us prove the claim (36). Define the following events:

\[\mathcal{A}\triangleq\{\widehat{p}_{\mathrm{KT}}(x_{0})=0\}\qquad\mathcal{B} \triangleq\{\widehat{p}_{\mathrm{KT}}(x_{0})\neq 0\}\qquad\mathcal{C}\triangleq \Big{\{}\widehat{p}(x_{0})\geq\tfrac{\mathbb{P}}{2}\Big{\}}.\]

On event \(\mathcal{E}\), consider the following decomposition:

\[\mathbb{E}_{\mathcal{S}_{\mathrm{in}}}\bigg{[}\Big{(}\widehat{f}_ {\mathrm{KT}}(x_{0})-\widehat{f}(x_{0})\Big{)}^{2}\mathbb{I}[\mathcal{E}_{ \mathrm{KT},\delta}]\bigg{]} =\mathbb{E}_{\mathcal{S}_{\mathrm{in}}}\bigg{[}\Big{(}\widehat{f} _{\mathrm{KT}}(x_{0})-\widehat{f}(x_{0})\Big{)}^{2}\,\mathbb{I}[\mathcal{E}_{ \mathrm{KT},\delta}\cap\mathcal{C}^{c}]\bigg{]} \tag{43}\] \[\qquad+\mathbb{E}_{\mathcal{S}_{\mathrm{in}}}\bigg{[}\Big{(} \widehat{f}_{\mathrm{KT}}(x_{0})-\widehat{f}(x_{0})\Big{)}^{2}\,\mathbb{I}[ \mathcal{E}_{\mathrm{KT},\delta}\cap\mathcal{B}\cap\mathcal{C}]\bigg{]}. \tag{44}\]

Bounding (43).Note that almost surely, we have

\[|\widehat{f}(x_{0})|\leq Y_{\mathrm{max}}\quad\text{and}\quad|\widehat{f}_{ \mathrm{KT}}(x_{0})|\leq Y_{\mathrm{max}}.\]

Thus, we have

\[\mathbb{E}_{\mathcal{S}_{\mathrm{in}}}\bigg{[}\Big{(}\widehat{f} _{\mathrm{KT}}(x_{0})-\widehat{f}(x_{0})\Big{)}^{2}\,\mathbb{I}[\mathcal{C}^{c }]\bigg{]} \leq 4Y_{\mathrm{max}}^{2}\,\mathbb{P}\Big{(}n\,\widehat{p}(x_{0}) <\tfrac{n\overline{p}}{2}\Big{)}\] \[\overset{(i)}{=}4Y_{\mathrm{max}}^{2}\mathbb{P}\Big{(}\sum_{i=1} ^{n}\eta_{i}-n\overline{p}<\tfrac{n\overline{p}}{2}-n\overline{p}\Big{)}\] \[\overset{(ii)}{\leq}c_{0}\exp\{-c_{1}nh^{d}\},\]

where (i) follows from subtracting \(n\overline{p}\) from both sides of the probability statement and (ii) follows from concentration of Bernoulli random variables (see App. B.2).

Bounding (44).Note that on event \(\mathcal{E}_{\mathrm{KT},\delta}\cap\mathcal{C}\), we have

\[\widehat{p}_{\mathrm{KT}}(x_{0}) \geq\widehat{p}(x_{0})-\|\widehat{p}-\widehat{p}_{\mathrm{KT}}\| _{\infty}\] \[\overset{(i)}{\geq}\tfrac{\overline{p}}{2}-c_{p}\sqrt{\tfrac{d}{ n}}\log n\] \[\overset{(\ref{eq:B1})}{\geq}c_{1}\overline{p}\overset{(\ref{eq:B2}) }{\geq}c_{2}p_{\mathrm{min}}h^{d}>0. \tag{46}\]

where step (i) follows from applying (41) and substituting \(\widehat{p}\geq\tfrac{\overline{p}}{2}\). Hence the events \(\mathcal{E}_{\mathrm{KT},\delta}\) and \(\mathcal{A}\cap\mathcal{C}\) are mutually exclusive with probability 1, thereby yielding

\[\mathbb{E}_{\mathcal{S}_{\mathrm{in}}}\bigg{[}\Big{(}\widehat{f}_{\mathrm{KT}} (x_{0})-\widehat{f}(x_{0})\Big{)}^{2}\,\mathbb{I}[\mathcal{E}_{\mathrm{KT}, \delta}\cap\mathcal{A}\cap\mathcal{C}]\bigg{]}=0.\]

Bounding (45).On the event \(\mathcal{B}\cap\mathcal{C}\), we have \(\widehat{f}_{\mathrm{KT}}(x_{0})=\frac{\widehat{A}_{\mathrm{KT}}(x_{0})}{ \widehat{p}_{\mathrm{KT}}(x_{0})}\) and \(\widehat{f}(x_{0})=\frac{\widehat{A}(x_{0})}{\widehat{p}(x_{0})}\), which yields

\[\widehat{f}_{\mathrm{KT}}(x_{0})-\widehat{f}(x_{0}) =\frac{\widehat{A}_{\mathrm{KT}}}{\widehat{p}_{\mathrm{KT}}}- \frac{\widehat{A}(x_{0})}{\widehat{p}(x_{0})}=\frac{\widehat{A}_{\mathrm{KT} }(x_{0})\cdot\widehat{p}(x_{0})-\widehat{A}(x_{0})\cdot\widehat{p}_{\mathrm{ KT}}(x_{0})}{\widehat{p}(x_{0})\cdot\widehat{p}_{\mathrm{KT}}(x_{0})}\] \[=\frac{(\widehat{A}_{\mathrm{KT}}(x_{0})-\widehat{A}(x_{0}))\cdot \widehat{p}(x_{0})+\widehat{A}(x_{0})\cdot(\widehat{p}(x_{0})-\widehat{p}_{ \mathrm{KT}}(x_{0}))}{\widehat{p}(x_{0})\cdot\widehat{p}_{\mathrm{KT}}(x_{0})}\] \[\leq\frac{\big{|}\widehat{A}_{\mathrm{KT}}(x_{0})-\widehat{A}(x_{ 0})\cdot\widehat{p}(x_{0})+\widehat{A}(x_{0})\cdot\widehat{p}(x_{0})-\widehat{p }_{\mathrm{KT}}(x_{0})\big{|}}{\widehat{p}(x_{0})\cdot\widehat{p}_{\mathrm{ KT}}(x_{0})}\]

We can invoke (41) and (42) to bound \(|\widehat{p}(x_{0})-\widehat{p}_{\mathrm{KT}}(x_{0})|\) and \(|\widehat{A}_{\mathrm{KT}}(x_{0})-\widehat{A}(x_{0})|\) respectively. Thus, we have

\[\mathbb{E}_{\mathcal{S}_{\mathrm{in}}}\bigg{[}\Big{(}\widehat{f}_{\mathrm{KT}} (x_{0})-\widehat{f}(x_{0})\Big{)}^{2}\,\mathbb{I}[\mathcal{E}_{\mathrm{KT}, \delta}\cap\mathcal{B}\cap\mathcal{C}]\bigg{]}\leq\bigg{(}\frac{c_{\alpha} \sqrt{\frac{d}{n}}\log n\cdot\widehat{p}(x_{0})+c_{p}\sqrt{\frac{d}{n}}\log n \cdot\widehat{A}(x_{0})}{\widehat{p}(x_{0})\cdot\widehat{p}_{\mathrm{KT}}(x_{0} )}\bigg{)}^{2}\]

[MISSING_PAGE_FAIL:18]

Since Assum. 1 is satisfied, \(R\) is constant. Applying (54) to \(\mathfrak{M}_{\mathrm{K}_{\mathrm{NW}}}(n,n_{\mathrm{out}},d,\delta,R)\) as defined by (26), we have the bound

\[\mathfrak{M}_{\mathrm{K}_{\mathrm{NW}}}(n,n_{\mathrm{out}},d,\delta,R)\leq c^{ \prime\prime}\sqrt{\log\bigl{(}\tfrac{n_{\mathrm{out}}}{\delta}\bigr{)}}\Bigl{[} \sqrt{\log\bigl{(}\tfrac{8}{\delta}\bigr{)}}+5\sqrt{d\log n}\Bigr{]}\]

for some positive constant \(c^{\prime\prime}\). Substituting this into (25), we have

\[\bigl{\|}(\mathbb{P}_{\mathsf{in}}-\mathbb{Q}_{\mathrm{out}}) \mathbf{k}_{\mathrm{NW}}\bigr{\|}_{\infty} \leq c_{1}\frac{\|\mathbf{k}\|_{\infty}(1+Y_{\mathrm{max}}^{2})} {n_{\mathrm{out}}}\sqrt{\log\bigl{(}\tfrac{n_{\mathrm{out}}}{\delta}\bigr{)}} \Bigl{[}\sqrt{\log\bigl{(}\tfrac{8}{\delta}\bigr{)}}+5\sqrt{d\log n}\Bigr{]}\] \[\leq c_{2}\frac{\|\mathbf{k}\|_{\infty}(1+Y_{\mathrm{max}}^{2})} {n_{\mathrm{out}}}\sqrt{d}(\sqrt{\log n}+\sqrt{\log(1/\delta)})^{2},\]

for some positive constants \(c_{1},c_{2}\). By definition,

\[\bigl{\|}(\mathbb{P}_{\mathsf{in}}-\mathbb{Q}_{\mathrm{out}})\mathbf{k}_{ \mathrm{NW}}\bigr{\|}_{\infty}=\sup_{z\in\mathcal{Z}}\langle(\mathbb{P}_{ \mathsf{in}}-\mathbb{Q}_{\mathrm{out}})\mathbf{k}_{\mathrm{NW}},\mathbf{k}_{ \mathrm{NW}}(\cdot,z)\rangle_{\mathbf{k}_{\mathrm{NW}}}.\]

Define \(\mathbf{k}_{1}\) and \(\mathbf{k}_{2}\) by (47) and (48), respectively, and note that \(\mathbf{k}_{1}(\cdot,z),\mathbf{k}_{2}(\cdot,z)\in\mathcal{H}(\mathbf{k}_{ \mathrm{NW}})\) for all \(z\in\mathcal{Z}\). We want to show that

\[\sup_{z\in\mathcal{Z}}\langle(\mathbb{P}_{\mathsf{in}}-\mathbb{Q} _{\mathrm{out}})\mathbf{k}_{\mathrm{NW}},\mathbf{k}_{1}(\cdot,z)\rangle_{ \mathbf{k}_{\mathrm{NW}}} \leq c_{2}\frac{\|\mathbf{k}\|_{\infty}(1+Y_{\mathrm{max}}^{2})} {n_{\mathrm{out}}}\sqrt{d}(\sqrt{\log n}+\sqrt{\log(1/\delta)})^{2}\quad\text {and}\] \[\sup_{z\in\mathcal{Z}}\langle(\mathbb{P}_{\mathsf{in}}-\mathbb{Q} _{\mathrm{out}})\mathbf{k}_{\mathrm{NW}},\mathbf{k}_{2}(\cdot,z)\rangle_{ \mathbf{k}_{\mathrm{NW}}} \leq c_{2}\frac{\|\mathbf{k}\|_{\infty}(1+Y_{\mathrm{max}}^{2})} {n_{\mathrm{out}}}\sqrt{d}(\sqrt{\log n}+\sqrt{\log(1/\delta)})^{2},\]

which would imply (41) and (42) (after simplifying all terms besides \(n\), \(d\), and \(\delta\)).

The first inequality follows from replacing all occurrences of the test function \(\mathbf{k}_{\mathrm{NW}}(\cdot,(x,y))\) in the proof of Lem. 1 with the function \(\mathbf{k}_{1}(\cdot,x)\) and noting that \(\langle\mathbf{k}_{\mathrm{NW}}(\cdot,(x_{i},y_{i})),\mathbf{k}_{1}(\cdot,(x, y))\rangle_{\mathbf{k}_{\mathrm{NW}}}=\langle\mathbf{k}_{1}(\cdot,x_{i}),\mathbf{k}_{1}( \cdot,x)\rangle_{\mathbf{k}_{1}}\) from the fact that \(\mathcal{H}(\mathbf{k}_{\mathrm{NW}})=\mathcal{H}(\mathbf{k}_{1})\oplus \mathcal{H}(\mathbf{k}_{2})\) (49).

The second inequality follows from replacing all occurrences of the test function \(\mathbf{k}_{\mathrm{NW}}(\cdot,(x,y))\) in the proof of Lem. 1 with the function \(\mathbf{k}_{2}(\cdot,x)\) and noting that \(\langle\mathbf{k}_{\mathrm{NW}}(\cdot,(x_{i},y_{i})),\mathbf{k}_{2}(\cdot,(x, y))\rangle_{\mathbf{k}_{\mathrm{NW}}}=\langle\mathbf{k}_{2}(\cdot,(x_{i},y_{i})), \mathbf{k}_{2}(\cdot,(x,y))\rangle_{\mathbf{k}_{2}}\), again from the fact that \(\mathcal{H}(\mathbf{k}_{\mathrm{NW}})=\mathcal{H}(\mathbf{k}_{1})\oplus \mathcal{H}(\mathbf{k}_{2})\) (49).

Proof of claim (51).We leverage the fact that the Lipschitz constants defined by (27) satisfies the following additivity property. Letting \(\mathcal{Z}=\mathcal{S}_{\mathrm{in}}\), we have

\[L_{\mathbf{k}_{\mathrm{NW}}} =\sup_{z_{1},z_{2},z_{3}\in\mathcal{Z}}\frac{|\mathbf{k}_{\mathrm{ NW}}(z_{1},z_{2})-\mathbf{k}_{\mathrm{NW}}(z_{1},z_{3})|}{\|z_{2}-z_{3}\|_{2}}\] \[\leq\sup_{z_{1},z_{2},z_{3}\in\mathcal{Z}}\frac{|\mathbf{k}_{1}(z _{1},z_{2})-\mathbf{k}_{1}(z_{1},z_{3})|}{\|z_{2}-z_{3}\|_{2}}+\sup_{z_{1},z_{2},z_{3}\in\mathcal{Z}}\frac{|\mathbf{k}_{2}(z_{1},z_{2})-\mathbf{k}_{2}(z_{1},z_ {3})|}{\|z_{2}-z_{3}\|_{2}}\] \[=L_{\mathbf{k}_{1}}+L_{\mathbf{k}_{2}}.\]

We proceed to bound \(L_{\mathbf{k}_{1}}\) and \(L_{\mathbf{k}_{2}}\) separately. Note that

\[L_{\mathbf{k}_{1}}=L_{\mathbf{k}}.\]

Applying the definition (27) to \(L_{\mathbf{k}_{2}}\), we have

\[L_{\mathbf{k}_{2}} =\sup_{z_{1}=(x_{1},y_{1})}\frac{|\mathbf{k}(x_{1},z_{2})y_{1}y_ {2}-\mathbf{k}(x_{1},x_{3})y_{1}y_{3}|}{\sqrt{\|x_{2}-x_{3}\|^{2}+\|y_{2}-y_{3} \|^{2}}}\] \[=\sup_{z_{1}=(x_{1},y_{1})}\frac{|y_{1}|\cdot|\mathbf{k}(x_{1},x_{ 2})y_{2}-\mathbf{k}(x_{1},x_{2})y_{3}+\mathbf{k}(x_{1},x_{2})y_{3}-\mathbf{k}(x_ {1},x_{3})y_{3}|}{\sqrt{\|x_{2}-x_{3}\|^{2}+\|y_{2}-y_{3}\|^{2}}}\] \[=\sup_{z_{1}=(x_{1},y_{1})}\frac{|y_{1}|\cdot|\mathbf{k}(x_{1},x_{ 2})y_{2}-\mathbf{k}(x_{1},x_{2})y_{3}+\mathbf{k}(x_{1},x_{2})y_{3}-\mathbf{k}(x_ {1},x_{3})y_{3}|}{\sqrt{\|x_{2}-x_{3}\|^{2}+\|y_{2}-y_{3}\|^{2}}}\] \[=\sup_{z_{1}=(x_{1},y_{1})}\frac{|y_{1}|\cdot|\mathbf{k}(x_{1},x_{ 2})y_{2}-\mathbf{k}(x_{1},x_{2})y_{3}+\mathbf{k}(x_{1},x_{2})y_{3}-\mathbf{k}(x_ {1},x_{3})y_{3}|}{\sqrt{\|x_{2}-x_{3}\|^{2}+\|y_{2}-y_{3}\|^{2}}}\] \[=\sup_{z_{1}=(x_{1},y_{1})}\frac{|y_{1}|\cdot|\mathbf{k}(x_{1},x_{ 2})y_{2}-y_{3}|}{\sqrt{\|x_{2}-x_{3}\|^{2}+\|y_{2}-y_{3}\|^{2}}}+\sup_{z_{1}=(x_ {1},y_{1})}\frac{|y_{1}|\cdot|(\mathbf{k}(x_{1},x_{2})-\mathbf{k}(x_{1},x_{3})y_{3} |}{\sqrt{\|x_{2}-x_{3}\|^{2}+\|y_{2}-y_{3}\|^{2}}}\] \[\leq y_{2}\underset{z_{2}=(x_{2},y_{2})}{z_{3}=(x_{3},y_{3})}\] \[\leq Y_{\mathrm{max}}\|\mathbf{k}\|_{\infty}+L_{\mathbf{k}}Y_{\mathrm{ max}}^{2}.\]

Putting together the pieces yields the claimed bound.

[MISSING_PAGE_EMPTY:20]

\[\stackrel{{(i)}}{{\leq}}\mathbb{P}\Big{(}\sum_{i=1}^{n} \eta_{i}\leq\frac{n\overline{p}}{2}\Big{)}+\Big{(}\frac{2}{n\overline{p}}\Big{)} ^{2}\int_{\mathcal{X}}\mathbf{k}^{2}(x_{1},x_{0})p(dx_{1}),\]

where step (i) follows from the fact that \(\frac{\mathbf{k}^{2}(X_{1},x_{0})}{\big{(}\sum_{i=1}^{n}\mathbf{k}(X_{i},x_{0}) \big{)}^{2}}\leq 1\). Using Bernstein's inequality [29, Prop. 2.14], the first term can be bounded by

\[\mathbb{P}\Big{(}\sum_{i=1}^{n}\eta_{i}\leq\frac{n\overline{p}}{2} \Big{)} =\mathbb{P}\Big{(}\sum_{i=1}^{n}\eta_{i}-n\overline{p}\leq-\frac{ n\overline{p}}{2}\Big{)}\] \[\leq\exp\Big{\{}-\tfrac{(n\overline{p})^{2}}{2(n\overline{p}(1- \overline{p})+n\overline{p}/3)}\Big{\}}\leq\exp\{-c_{1}nh^{d}\}\]

for some universal positive constant \(c\). Applying the fact that \(p\) is bounded by Assum. 1 and \(\kappa\) is square-integrable by Assum. 2, we can bound the second term by

\[\Big{(}\tfrac{2}{n\overline{p}}\Big{)}^{2}\int_{\mathcal{X}} \mathbf{k}^{2}(x_{1},x_{0})p(dx_{1}) \stackrel{{(i)}}{{\leq}}\Big{(}\tfrac{2}{n\overline{p }}\Big{)}^{2}p_{\max}h^{d}\int_{\mathbb{R}^{d}}\kappa^{2}(u)du\] \[\stackrel{{(ii)}}{{\leq}}\tfrac{4}{(n\overline{p})^{ 2}}\big{(}c_{1}h^{d}\big{)}\leq\tfrac{c_{2}}{n^{2}h^{2}},\]

for some positive constant \(c_{2}\) that does not depend on either \(h\) or \(n\). Substituting these expressions into (58) yields a bound on \(\mathbb{E}_{X}\big{[}\sigma^{2}(x_{0};X)\;\mathbb{I}[\mathcal{E}]\big{]}\) as desired.

### Proof of claim (38)

Define the following shorthand for the bias:

\[b(x_{0};X)\triangleq\mathbb{E}_{Y|X}\Big{[}\widehat{f}(x_{0})\Big{]}-f^{\star }(x_{0}).\]

We state a more detailed version of the claim.

**Lemma 4** (Bias of Nadaraya-Watson).: _Suppose Assum. 1 and 2 are satisfied and the event \(\mathcal{E}\) (32) holds. If \(f^{\star}\in\Sigma(\beta,L_{f})\) for \(\beta\in(0,1]\), \(L_{f}>0\), then with high probability, the following statements hold true uniformly for all \(x_{0}\in\mathcal{X}\):_

1. _If_ \(\mathbf{k}\) _is compactly supported, then_ \(b(x_{0};X)\leq L_{f}h^{\beta}\)_._
2. _Otherwise, if_ \(\mathbf{k}\) _is non-compactly supported, we have_ \(b(x_{0};X)\leq c\cdot L_{f}h^{\beta}\log n\) _for some positive constant_ \(c\) _that does not depend on_ \(n\)_._

For completeness, we first state the proof of claim (I.a) from Belkin et al. [3, Lem. 2]. On the event \(\mathcal{E}\) (32), we have

\[b(x_{0};X)\stackrel{{(\ref{eq:b_1})}}{{=}}\tfrac{\sum_{i=1}^{n}(f^ {\star}(X_{i})-f^{\star}(x_{0}))\mathbf{k}(X_{i},x_{0})}{\sum_{i=1}^{n}\mathbf{ k}(X_{i},x_{0})}\stackrel{{(i)}}{{\leq}}\tfrac{\sum_{i=1}^{n}L_{f} \|X_{i}\|^{2}\mathbf{k}(X_{i},x_{0})}{\sum_{i=1}^{n}\mathbf{k}(X_{i},x_{0})} \stackrel{{(ii)}}{{\leq}}L_{f}h^{\beta},\]

where step (i) follows from our assumption that \(f^{\star}\in\Sigma(\beta,L_{f})\) and step (ii) follows from our assumption that \(\mathbf{k}\) is compactly supported, so \(\mathbf{k}(x,x_{0})=0\) whenever \(\|x-x_{0}\|>h\). We now proceed to proving claim (I.b).

Step I: Decomposing the bias.For any \(x_{0}\in\mathcal{X}\), define the random variables

\[A_{0}(x_{0}) \triangleq\tfrac{1}{n}\sum_{i=1}^{n}\mathbf{k}(X_{i},x_{0})\mathbb{ I}[\|X_{i}-x_{0}\|\leq h]\quad\text{and} \tag{59}\] \[A_{j}(x_{0}) \triangleq\tfrac{1}{n}\sum_{i=1}^{n}\mathbf{k}(X_{i},x_{0}) \mathbb{I}\big{[}2^{j-1}h<\|X_{i}-x_{0}\|\leq 2^{j}h\big{]}\quad\text{for}\quad j=1,2, \ldots,T, \tag{60}\]

where

\[T\triangleq\lceil\tfrac{\log R}{\log h}\rceil=\mathcal{O}(\log n) \tag{61}\]

when \(p_{X}(\cdot)\) has compact support under Assum. 1 and \(h\) is defined by (40). We call these random variables the _kernel empirical means_. We can directly verify that

\[\sum_{j=0}^{T}A_{0}(x_{0})=\tfrac{1}{n}\sum_{i=1}^{n}\mathbf{k}(X_{i},x_{0}) \quad\text{for all}\quad x_{0}\in\mathcal{X}.\]With these definitions in hand, we may rewrite \(b(x_{0};X)\) in terms of \(A_{0}(x_{0}),A_{1}(x_{0}),\ldots,A_{T}(x_{0})\) as follows:

\[b(x_{0};X) =\frac{\frac{1}{\lambda}\sum_{i=1}^{n}\mathbf{k}(X_{i},x_{0})(f^{*} (X_{i})-f^{*}(x_{0}))}{\frac{1}{\lambda}\sum_{i=1}^{n}\mathbf{k}(X_{i},x_{0})}\] \[=\frac{\frac{1}{\lambda}\sum_{i=1}^{n}\mathbf{k}(X_{i},x_{0})[ \|X_{i}-x_{0}\|\leq h(f^{*}(X_{i})-f^{*}(x_{0}))}{A_{0}(x_{0})+\sum_{j=1}^{n}A_ {j}(x_{0})}\] \[\quad\quad+\frac{\sum_{j=1}^{T}\sum_{i=1}^{n}\mathbf{k}(X_{i},x_{0 })[\|Z^{j-1}h<\|X_{i}-x_{0}\|\leq 2^{j}h](f^{*}(X_{i})-f^{*}(x_{0}))}{A_{0}(x_{0})+ \sum_{j=1}^{T}A_{j}(x_{0})}\] \[\stackrel{{(i)}}{{\leq}}\frac{\frac{1}{\lambda}\sum_ {i=1}^{n}\mathbf{k}(X_{i},x_{0})[\|X_{i}-x_{0}\|\leq h]L_{f}\|X_{i}-x_{0}\|^{ \beta}}{A_{0}(x_{0})+\sum_{j=1}^{T}A_{j}(x_{0})}\] \[\quad\quad\quad+\frac{\sum_{j=1}^{T}\frac{1}{\lambda}\sum_{i=1}^{ n}\mathbf{k}(X_{i},x_{0})[\|Z^{j-1}h<\|X_{i}-x_{0}\|\leq 2^{j}h]L_{f}\|X_{i}-x_{0}\| ^{\beta}}{A_{0}(x_{0})+\sum_{j=1}^{T}A_{j}(x_{0})}\] \[\stackrel{{(ii)}}{{\leq}}\frac{\frac{1}{\lambda}\sum_ {i=1}^{n}\mathbf{k}(X_{i},x_{0})[\|X_{i}-x_{0}\|\leq h]L_{f}h^{\beta}}{A_{0}(x_ {0})+\sum_{j=1}^{T}A_{j}(x_{0})} \tag{62}\] \[\quad\quad\quad+\frac{\sum_{i=1}^{T}\frac{1}{\lambda}\sum_{i=1}^{ n}\mathbf{k}(X_{i},x_{0})[\|Z^{j-1}h<\|X_{i}-x_{0}\|\leq 2^{j}h]L_{f}(2^{j}h)^{ \beta}}{A_{0}(x_{0})+\sum_{j=1}^{T}A_{j}(x_{0})}, \tag{63}\]

where step (i) follows from the fact that \(f^{*}(X_{i})-f^{*}(x_{0})\leq L_{f}\|X_{i}-x_{0}\|^{\beta}\) by Def. 1 and step (ii) follows from the fact that \(\|X_{i}-x_{0}\|\leq 2^{j}h\) under the indicator functions. Applying (59) to (62) and (60) to (63), we have

\[b(x_{0};X)\leq\frac{A_{0}(x_{0})L_{f}h^{\beta}}{A_{0}(x_{0})+\sum_{j=1}^{T}A_ {j}(x_{0})}+\frac{\sum_{j=1}^{T}A_{j}(x_{0})L_{f}(2^{j}h)^{\beta}}{A_{0}(x_{0 })+\sum_{j=1}^{T}A_{j}(x_{0})}\leq L_{f}h^{\beta}\bigg{(}\sum_{i=0}^{T}\frac{ A_{i}(x_{0})2^{\beta}}{\sum_{j=0}^{T}A_{j}(x_{0})}\bigg{)}. \tag{64}\]

For any \(z\in\mathcal{X}\), define the following shorthands:

\[a_{0}(z) \triangleq\mathbb{E}_{X}[\mathbf{k}(X,z)]\mathbb{I}[\|X-z\|\leq h ]\quad\text{and} \tag{65}\] \[a_{j}(z) \triangleq\mathbb{E}_{X}\big{[}\mathbf{k}(X,x)\mathbb{I}\big{[} 2^{j-1}h<\|X-z\|\leq 2^{j}h\big{]}\big{]}\quad\text{for}\quad j=1,2,\ldots,T. \tag{66}\]

We can directly verify that

\[\mathbb{E}_{X}[A_{0}(z)]=a_{0}(z)\quad\text{and}\quad\mathbb{E}_{X}[A_{j}(z)]= a_{j}(z)\quad\text{for all}\quad j=1,2,\ldots,T.\]

Under Assum. 1, \(a_{i}(z)\) can be computed directly from the decay properties of \(\mathbf{k}\) as follows:

\[a_{0}(z) =\int_{\|x-z\|\leq h}\mathbf{k}(x,z)p_{X}(dx)\geq p_{\min}\int_{ \|x-z\|\leq h}\mathbf{k}(x,z)dx\] \[a_{j}(z) =\int_{2^{j-1}<\|x-z\|\leq 2^{j}h}\mathbf{k}(x,z)p_{X}(dx)\leq p_{ \max}\int_{2^{j-1}<\|x-z\|\leq 2^{j}h}\mathbf{k}(x,z)dx\quad\text{for}\quad j=1,2, \ldots,T.\]

**Remark 1**.: _Note that for fixed \(x_{0}\in\mathcal{X}\), \(A_{i}(x_{0})\), Hoeffding's inequality implies that \(A_{i}(x_{0})\) concentrates around \(a_{i}(x_{0})\) for all \(i=0,1,\ldots,T\) with high probability. Assuming that \(\mathbf{k}\) decays sufficiently rapidly (so that \(a_{j}(x_{0})2^{j\beta}=\mathcal{O}(a_{0}(x_{0}))\) for all \(j\in[T]\)), we have_

\[b(x_{0};X)\leq L_{f}h^{\beta}\Big{(}\sum_{i=1}^{T}O(1)\Big{)}=\mathcal{O}(L_{f} h^{\beta}\log n).\]

_It remains to show that this bound holds uniformly over all \(x_{0}\in\mathcal{X}\) with high probability._

Step II: Uniform concentration of empirical kernel means.Fix \(\epsilon\in(0,\frac{h}{2}]\) and let \(\mathcal{C}_{0}\) be a \(\epsilon\)-cover of \(\mathcal{X}\) w.r.t. the Euclidean norm (see [29, Def. 5.1] for the detailed definition). We will optimize the choice of \(\epsilon\) at the end of the proof. By [29, Lem. 5.7], we have

\[|\mathcal{C}_{0}|\leq(1+\frac{2R}{\epsilon})^{d} \tag{67}\]

We now introduce a slightly modified version of (65) and (66) defined as

\[a_{0}^{\epsilon}(z) \triangleq\mathbb{E}_{X}[\mathbf{k}(X,z)\mathbb{I}[\|X-z\|\leq h- \epsilon]]\quad\text{and}\] \[a_{j}^{\epsilon}(z) \triangleq\mathbb{E}_{X}\big{[}\mathbf{k}(X,z)\mathbb{I}\big{[}2^ {j-1}h-\epsilon<\|X-z\|\leq 2^{j}h+\epsilon\big{]}\big{]}\quad\text{for}\quad j=1,2, \ldots,T,\]

respectively. Using the fact that \(\epsilon\leq h/2\), Assum. 1 and 2, and a change of variables, we have

\[a_{0}^{\epsilon}(z)\geq p_{\min}\int_{\|x-z\|\leq\frac{h}{2}}\mathbf{k}(x,z)dx=p _{\min}h^{d}\omega_{d-1}\int_{0}^{\frac{1}{2}}\kappa(u)u^{d-1}du,\quad\text{and}\]\[\mathbb{E}_{X}\big{[}\mathrm{Mass}_{x_{0}^{\prime}}(a)\big{]}\leq p_{ \max}\mathrm{Vol}(a)\quad\text{and}\quad\mathbb{E}_{X}\big{[}\mathrm{Mass}_{x_{0 }^{\prime}}(a,b)\big{]}\leq p_{\max}\mathrm{Vol}(b), \tag{74}\]

where \(\mathrm{Vol}(r)\triangleq\pi^{d}/\Gamma(d/2+1)r^{d}\) denotes the volume of the Euclidean ball \(\mathbb{B}_{2}(r)\subset\mathbb{R}^{d}\).

Step III: Putting things together.For any \(z\in\mathcal{C}_{0}\), note that

\[\mathbf{k}(X_{i},z)\mathbb{I}[\left\|X_{i}-z\right\|\leq h-\epsilon] \in[0,\left\|\mathbf{k}\right\|_{\infty}]\quad\text{and}\] \[\mathbf{k}(X_{i},z)\mathbb{I}\big{[}2^{j-1}h-\epsilon<\left\|X_{i }-z\right\|\leq 2^{j}h+\epsilon\big{]}\in[0,\left\|\mathbf{k}\right\|_{\infty}]\]

and therefore these random variables are sub-Gaussian with parameter \(\sigma=\frac{1}{2}\big{\|}\mathbf{k}\big{\|}_{\infty}\). Thus, we may bound (68) and (69) using Hoeffding's bound [29, Prop. 2.5], obtaining

\[\mathbb{P}(\mathcal{A}_{i}^{e}(z)^{c})\leq\exp\!\left\{-\frac{2n\Delta_{0}^{2 }}{\|\mathbf{k}\|_{\infty}^{2}}\right\}\quad\text{for all}\quad i=0,1,\ldots,T \quad\text{and}\quad z\in\mathcal{C}_{0}, \tag{75}\]

Again by Hoeffding's bound [29, Prop. 2.5], we have

\[\mathbb{P}(\mathcal{M}_{i}(z)^{c})\leq\exp\!\left\{-2nt_{i}^{2}\right\}\quad \text{for all}\quad i=0,1,\ldots,T\quad\text{and}\quad z\in\mathcal{C}_{0}.\]

Next, it remains to choose the values of \(\epsilon\), \(\Delta_{0},\ldots,\Delta_{T}\) and \(t_{0},\ldots,t_{T}\). Consider

\[\Delta_{0}=\tfrac{1}{2}\cdot p_{\min}h^{d}\omega_{d-1}\int_{0}^{\frac{1}{2}} \kappa(u)u^{d-1}du, \tag{76}\]\[\Delta_{j} =2^{-j\beta}\cdot p_{\max}h^{d}\omega_{d-1}\int_{0}^{\frac{1}{2}} \kappa(u)u^{d-1}du\quad\text{for}\quad j=1,2,\ldots,T, \tag{77}\] \[t_{0} =\tfrac{1}{2}p_{\max}\operatorname{Vol}(h-\epsilon),\quad\text{ and}\] (78) \[t_{j} =\tfrac{1}{2}p_{\max}\operatorname{Vol}(2^{j}h+\epsilon)\quad \text{for}\quad j=1,2,\ldots,T. \tag{79}\]

Combining (70), (72), (74), (76), and (78), we have on the event \(\mathcal{E}_{0}\triangleq\bigcap_{z\in\mathcal{C}_{0}}(\mathcal{A}_{0}^{ \epsilon}(z)\cap\mathcal{M}_{0}(z))\) the following bound:

\[A_{0}(x_{0}) \geq\tfrac{1}{2}p_{\min}h^{d}\omega_{d-1}\int_{0}^{\frac{1}{2}} \kappa(u)u^{d-1}du-p_{\max}\tfrac{\pi^{d}}{\Gamma(\frac{d}{2}+1)}(h-\epsilon) ^{d}\cdot L_{k}\epsilon\] \[\geq h^{d}\omega_{d-1}\Big{(}\tfrac{1}{2}p_{\min}\int_{0}^{\frac{ 1}{2}}\kappa(u)u^{d-1}du-p_{\max}\tfrac{\pi^{d}}{\Gamma(\frac{d}{2}+1)\omega_{ d-1}}L_{\mathbf{k}}\epsilon\Big{)}\] \[\stackrel{{(i)}}{{\geq}}\tfrac{1}{4}p_{\min}h^{d} \omega_{d-1}\int_{0}^{\frac{1}{2}}\kappa(u)u^{d-1}du,\]

where step (i) follows from setting

\[\epsilon=\min\bigg{\{}\tfrac{1}{4}\Big{[}p_{\min}\int_{0}^{\frac{1}{2}}\kappa( u)u^{d-1}du\Big{]}\Big{(}p_{\max}\tfrac{\pi^{d}}{\Gamma(\frac{d}{2}+1)\omega_{ d-1}}L_{\mathbf{k}}\Big{)}^{-1},\tfrac{h}{2}\bigg{\}}. \tag{80}\]

Similarly, for each \(j=1,2,\ldots,T\), we may combine (71), (73), (74), (77), and (79) to obtain a bound on \(A_{j}(x_{0})\). Hence, on the \(\mathcal{E}_{j}\triangleq\bigcap_{z\in\mathcal{C}_{0}}(\mathcal{A}_{j}^{ \epsilon}(z)\cap\mathcal{M}_{j}(z))\), we have

\[A_{j}(x_{0}) \leq p_{\max}h^{d}\omega_{d-1}\Big{(}\int_{2^{j-1}-\frac{1}{2}}^{ 2^{j}+\frac{1}{2}}\kappa(u)u^{d-1}du+2^{-j\beta}\int_{0}^{\frac{1}{2}}\kappa(u )u^{d-1}du\Big{)}+p_{\max}\tfrac{\pi^{d}}{\Gamma(\frac{d}{2}+1)}(2^{j}h+ \epsilon)^{d}\cdot\kappa(\tfrac{2^{j-1}h-2\epsilon}{h})\] \[\stackrel{{(i)}}{{\leq}}p_{\max}h^{d}\omega_{d-1} \Big{(}\int_{2^{j-1}-\frac{1}{2}}^{2^{j}+\frac{1}{2}}\kappa(u)u^{d-1}du+2^{-j \beta}\int_{0}^{\frac{1}{2}}\kappa(u)u^{d-1}du+\tfrac{\pi^{d}(2^{j}+\frac{1}{ 2})^{d}}{\Gamma(\frac{d}{2}+1)\omega_{d-1}}\kappa(2^{j-1}-1)\Big{)}\]

where step (i) employs the fact that \(\epsilon\leq h/2\). Note that for \(j=1,2,\ldots,T\):

\[\frac{A_{j}(x_{0})2^{j\beta}}{A_{0}(x_{0})}\leq\frac{4p_{\max}}{p_{\min}} \left(\frac{2^{j\beta}\int_{2^{j-1}-\frac{1}{2}}^{2^{j}+\frac{1}{2}}\kappa(u) u^{d-1}du+\int_{0}^{\frac{1}{2}}\kappa(u)u^{d-1}du+\frac{\pi^{d}(2^{j}+\frac{1}{ 2})^{d}2^{j\beta}}{\Gamma(\frac{d}{2}+1)\omega_{d-1}}\kappa(2^{j-1}-1)}{\int_{0 }^{\frac{1}{2}}\kappa(u)u^{d-1}du}\right)=\mathcal{O}(1), \tag{81}\]

where the last inequality comes from the fact that

\[\frac{2^{j\beta}\int_{2^{j-1}-\frac{1}{2}}^{2^{j}+\frac{1}{2}}\kappa(u)u^{d-1} du}{\int_{0}^{\frac{1}{2}}\kappa(u)u^{d-1}du}=\mathcal{O}(1)\quad\text{and} \quad\frac{\frac{\pi^{d}(2^{j}+\frac{1}{2})^{d}2^{j\beta}}{\Gamma(\frac{d}{2}+1 )\omega_{d-1}}\kappa(2^{j-1}-1)}{\int_{0}^{\frac{1}{2}}\kappa(u)u^{d-1}du}= \mathcal{O}(1)\]

by Assum. 2. Substituting this bound into (64), we have

\[b(x_{0};X)\stackrel{{(\ref{eq:b2})}}{{\leq}}L_{f}h^{\beta}\bigg{(} \sum_{i=0}^{T}\frac{A_{i}(x_{0})2^{j\beta}}{\sum_{j=0}^{T}A_{j}(x_{0})}\bigg{)} \leq L_{f}h^{\beta}\Big{(}\sum_{i=0}^{T}\frac{A_{i}(x_{0})2^{j\beta}}{A_{0}(x_{0 })}\Big{)}\stackrel{{(\ref{eq:b2})}}{{\leq}}L_{f}h^{\beta}TC \stackrel{{(\ref{eq:b2})}}{{\leq}}\mathcal{O}(L_{f}h^{\beta}\log n)\]

as desired. Finally, it remains to control the probability that this bound on \(b(x_{0};X)\) holds. Applying union-bound, we have

\[\mathbb{P}(\mathcal{E}_{0}^{\epsilon}\cup\ldots\cup\mathcal{E}_{T }^{\epsilon}) \stackrel{{(\ref{eq:b2}),(\ref{eq:b2})}}{{\leq}}(1+ \tfrac{2R}{\epsilon})^{d}\sum_{i=0}^{T}\Big{(}\exp\Bigl{\{}-\tfrac{2n\Delta_{i }^{2}}{\|\mathbf{k}\|_{\infty}^{2}}\Bigr{\}}+\exp\bigl{\{}-2nt_{i}^{2}\bigr{\}} \Bigr{)}\] \[\leq(1+\tfrac{2R}{\epsilon})^{d}\sum_{j=0}^{T}\bigl{(}\exp\bigl{\{} -c_{1}nh^{2d}4^{-j\beta}\bigr{\}}+\exp\bigl{\{}-c_{2}nh^{jd}\bigr{\}}\bigr{)}\] \[\leq(1+\tfrac{2R}{\epsilon})^{d}(T+1)\bigl{(}\exp\{-c_{1}nh^{2d}4^ {-T\beta}\}+\exp\bigl{\{}-c_{2}nh^{Td}\bigr{\}}\bigr{)},\]

for some universal positive constants \(c_{1},c_{2}\) that do not depend on \(n\). Note that by (80), we have \((1+\tfrac{2R}{\epsilon})^{d}=\mathcal{O}((1+\tfrac{1}{h})^{d})\). Setting \(h=cn^{-\frac{1}{2\beta+2d}}\) as in (40) and recalling that \(T=\mathcal{O}(\log n)\), we have \(\mathbb{P}(\mathcal{E}_{0}^{\epsilon}\cup\ldots\cup\mathcal{E}_{T}^{\epsilon})\ll 1\) for sufficiently large \(n\). This completes the proof of Lem. 4.

#### b.3.1 Proof of Lem. 5: Uniform concentration of empirical kernel means

Fix any \(x_{0}\in\mathcal{X}\). By definition of \(\mathcal{C}_{0}\), there exists \(x_{0}^{\prime}\in\mathcal{C}_{0}\) such that \(\|x_{0}-x_{0}^{\prime}\|\leq\epsilon\). Consider any \(x\in\mathbb{B}_{2}(h-\epsilon;x_{0}^{\prime})\)4. By triangle inequality, \(\|x-x_{0}\|\leq\|x-x_{0}^{\prime}\|+\|x_{0}^{\prime}-x_{0}\|\leq(h-\epsilon)+\epsilon\). Therefore, we have

Footnote 4: We use the notation \(\mathbb{B}_{2}(r;x)\) to denote the Euclidean ball of radius \(r\) centered at \(x\in\mathbb{R}^{d}\).

\[\mathbb{B}_{2}(h-\epsilon;x_{0}^{\prime})\subset\mathbb{B}_{2}(h;x_{0}). \tag{82}\]

We now introduce the following lemma, which is a finite-sample version of [10, Lem. 8]:

**Lemma 6** (\(L^{\infty}\) bound on \(L^{2}\) kernel error (finite sample)).: _Consider any bounded kernel \(\mathbf{k}\in L^{2,\infty}\), points \(x_{0},x^{\prime}_{0}\in\mathcal{X}\), and function \(g\in L^{2}(\mathbb{P}_{n})\). For any \(r,a,b\geq 0\) with \(a+b=1\), points \(x_{1},\ldots,x_{n}\in\mathcal{X}\), and set \(A\subset\mathcal{X}\), we have_

\[\big{|}\tfrac{1}{n}\sum_{i=1}^{n}g(x_{i})(\mathbf{k}(x_{i},x_{0}) -\mathbf{k}(x_{i},x^{\prime}_{0}))\mathbf{1}_{A}(x_{i})\big{|}\] \[\qquad\leq\|g\|_{A,L^{2}(\mathbb{P}_{n})}\cdot\Big{[}\|\mathbf{k} (\cdot,x_{0})-\mathbf{k}(\cdot,x^{\prime}_{0})\|_{A,\infty}\mathrm{Mass}_{A}^ {\frac{1}{2}}(r)+2\tau_{\mathbf{k},A}(ar)+2\|\mathbf{k}\|_{A,L^{2,\infty}} \mathbb{I}[\|x_{0}-x^{\prime}_{0}\|\geq br]\Big{]}.\]

_where_

\[\|f\|_{A,L^{2}(\mathbb{P}_{n})} \triangleq\big{(}\tfrac{1}{n}\sum_{i=1}^{n}f^{2}(x_{i})\mathbf{1 }_{A}(x_{i})\big{)}^{\frac{1}{2}}\] \[\|f\|_{A,\infty} \triangleq\max_{i\in[n]}\lvert f(x_{i})\mathbf{1}_{A}(x_{i})\rvert\] \[\mathrm{Mass}_{A}(r) \triangleq\tfrac{1}{n}\sum_{i=1}^{n}\mathbb{I}[\|x_{i}-x^{\prime} _{0}\|\leq r,x_{i}\in A]\] \[\tau_{A,\mathbf{k}}(r) \triangleq\sup_{x^{\prime}\in\big{\{}x_{0},x^{\prime}_{0}\big{\}} \big{(}\tfrac{1}{n}\sum_{i=1}^{n}\mathbf{k}^{2}(x_{i},x^{\prime})\mathbb{I}[\| x_{i}-x^{\prime}\|\geq r,x_{i}\in A]\big{)}^{\frac{1}{2}}\] \[\|\mathbf{k}\|_{A,L^{2,\infty}} \triangleq\sup_{x^{\prime}\in\big{\{}x_{0},x^{\prime}_{0}\big{\}} \,\|\mathbf{k}(\cdot,x^{\prime})\|_{A,L^{2}(\mathbb{P}_{n})}}.\]

See App. B.3.2 for the proof. We now use this lemma to prove each of the claims in Lem. 5.

Proof of claim (70).We consider the following basic decomposition:

\[\tfrac{1}{n}\sum_{i=1}^{n}\mathbf{k}(X_{i},x_{0})\mathbb{I}[\|X_{ i}-x_{0}\|\leq h] \tag{83}\] \[\qquad=\tfrac{1}{n}\sum_{i=1}^{n}\mathbf{k}(X_{i},x^{\prime}_{0}) \mathbb{I}[\|X_{i}-x^{\prime}_{0}\|\leq h-\epsilon]\] (84) \[\qquad\qquad-\big{(}\tfrac{1}{n}\sum_{i=1}^{n}\mathbf{k}(X_{i},x ^{\prime}_{0})\mathbb{I}[\|X_{i}-x^{\prime}_{0}\|\leq h-\epsilon]-\tfrac{1}{n} \sum_{i=1}^{n}\mathbf{k}(X_{i},x_{0})\mathbb{I}[\|X_{i}-x_{0}\|\leq h]\big{)}. \tag{85}\]

Note that the term (84) can be directly bounded using the definition of (68). Next, we bound the term (85). Define

\[g\triangleq\mathbf{1}\quad\text{and}\quad A\triangleq\mathbb{B}_{2}(h- \epsilon;x^{\prime}_{0}),\]

so that \(\|g\|_{A,L^{2}(\mathbb{P}_{n})}=\mathrm{Mass}_{x^{\prime}_{0}}^{\frac{1}{2}}(h -\epsilon)\). By property (82), we have

\[\mathbb{I}[\|X_{i}-x^{\prime}_{0}\|\leq h-\epsilon]\leq\mathbb{I}[\|X_{i}-x_{0 }\|\leq h]\quad\text{for all}\quad i=1,2,\ldots,n. \tag{86}\]

Observe that

\[\tfrac{1}{n}\sum_{i=1}^{n}g(X_{i})(\mathbf{k}(X_{i},x_{0})-\mathbf{ k}(x_{i},x^{\prime}_{0}))\mathbf{1}_{A}(x_{i}) \tag{87}\] \[=\tfrac{1}{n}\sum_{i=1}^{n}(\mathbf{k}(X_{i},x^{\prime}_{0})- \mathbf{k}(X_{i},x_{0}))\mathbb{I}[\|X_{i}-x^{\prime}_{0}\|\leq h-\epsilon]\] \[\overset{\eqref{eq:g_1}}{\geq}\tfrac{1}{n}\sum_{i=1}^{n}\mathbf{ k}(X_{i},x^{\prime}_{0})\mathbb{I}[\|X_{i}-x^{\prime}_{0}\|\leq h-\epsilon]-\tfrac{1}{n} \sum_{i=1}^{n}\mathbf{k}(X_{i},x_{0})\mathbb{I}[\|X_{i}-x_{0}\|\leq h],\]

To upper bound (87), we now apply Lem. 6 with \(r=h\), \(a=\frac{1}{2}\), and \(b=\frac{1}{2}\) to obtain

\[\big{|}\tfrac{1}{n}\sum_{i=1}^{n}g(x_{i})(\mathbf{k}(x_{i},x_{0}) -\mathbf{k}(x_{i},x^{\prime}_{0}))\mathbf{1}_{A}(x_{i})\big{|}\] \[\qquad\leq\mathrm{Mass}_{x^{\prime}_{0}}^{\frac{1}{2}}(h-\epsilon )\cdot\Big{[}\|\mathbf{k}(\cdot,x_{0})-\mathbf{k}(\cdot,x^{\prime}_{0})\|_{A, \infty}\mathrm{Mass}_{A}^{\frac{1}{2}}(h)+2\tau_{\mathbf{k},A}(\tfrac{h}{2})+2 \|\mathbf{k}\|_{A,L^{2,\infty}}\mathbb{I}\big{[}\|x_{0}-x^{\prime}_{0}\|>\tfrac {h}{2}\big{]}\Big{]}\] \[\qquad\leq\mathrm{Mass}_{x^{\prime}_{0}}^{\frac{1}{2}}(h-\epsilon )\cdot\Big{[}L_{\mathbf{k}}\epsilon\cdot\mathrm{Mass}_{x^{\prime}_{0}}^{ \frac{1}{2}}(h-\epsilon)\Big{]}, \tag{88}\]

where the last inequality uses the fact that

\[\|\mathbf{k}(\cdot,x_{0})-\mathbf{k}(\cdot,x^{\prime}_{0})\|_{A,\infty}\leq L_ {\mathbf{k}}\|x_{0}-x^{\prime}_{0}\|\leq L_{\mathbf{k}}\epsilon\]

from the Lipschitz property of \(\mathbf{k}\) (see Assum. 2) and the fact that

\[\mathrm{Mass}_{A}^{\frac{1}{2}}(h)=\mathrm{Mass}_{x^{\prime}_{0}}^{\frac{1}{2}}(h -\epsilon),\qquad\tau_{\mathbf{k},A}(\tfrac{h}{2})=0,\quad\text{and}\quad\|x_{i}- x_{0}\|\leq\epsilon\leq\tfrac{h}{2}.\]

Substituting the bounds (68), (87), and (88) into the decomposition (83) yields the desired claim.

[MISSING_PAGE_FAIL:26]

[MISSING_PAGE_FAIL:27]

\[\qquad\cdot\left\|\delta_{x_{0}}(x^{\star})-\delta_{x^{\prime}_{0}}(x^{ \star})\right\|\] \[=\|g\cdot\mathbf{1}_{A}\|_{L^{2}(\mathbb{P}_{n})}\sup_{x^{\prime} \in\left\{x_{0},x^{\prime}_{0}\right\}}\|\mathbf{k}(\cdot,x^{\prime})\cdot \mathbf{1}_{A}\|_{L^{2}(\mathbb{P}_{n})}\cdot\mathbb{I}[\|x_{0}-x^{\prime}_{0} \|>br].\]

## Appendix C Proof of Thm. 2: KT-KRR for finite-dimensional RKHS

We rely on the localized Gaussian/Rademacher analysis of KRR from prior work [29]. Define the _Gaussian critical radius_\(\varepsilon_{n}>0\) to be the smallest positive solution to the inequality

\[\widehat{\mathcal{G}}_{n}(\varepsilon;\mathbb{B}_{\mathcal{H}}(3))\leq\tfrac{R }{2\sigma}\varepsilon^{2},\quad\text{where}\quad\widehat{\mathcal{G}}_{n}( \varepsilon;\mathcal{F})\triangleq\mathbb{E}_{w}\left[\sup_{\begin{subarray}{c }f\in\mathcal{F}:\\ \|f\|_{n}\leq\varepsilon\end{subarray}}\left|\tfrac{1}{n}\sum_{i=1}^{n}w_{i}f( x_{i})\right|\right], \tag{100}\]

\(\mathbb{B}_{\mathcal{H}}(3)\) is the \(\|\cdot\|_{\mathbf{k}}\)-ball of radius 3 and \(w_{i}\overset{i\text{-d}}{\sim}\mathcal{N}(0,1)\).

**Assumption 4**.: _Assume that \(\|f^{\star}\|_{\mathbf{k}}\in\mathbb{B}_{\mathbf{k}}(R)\) and \(\widehat{f}_{\mathrm{KT},\lambda^{\prime}}\in\mathbb{B}_{\mathbf{k}}(c_{ \dagger}R)\), for some constant \(c_{\dagger}>0\)._

Note that for any \(g\in\mathbb{B}_{\mathbf{k}}(c_{\dagger}R)\), we have

\[\left\|g\right\|_{\infty}\leq\sup_{x\in\mathcal{X}}\langle g,\mathbf{k}(\cdot,x)\rangle_{\mathbf{k}}\overset{(i)}{\leq}\sup_{x\in\mathcal{X}}\|g\|_{ \mathbf{k}}\|\mathbf{k}(\cdot,x)\|_{\mathbf{k}}\leq\|g\|_{\mathbf{k}}\sqrt{\| \mathbf{k}\|_{\infty}}\leq c_{\dagger}R\sqrt{\|\mathbf{k}\|_{\infty}}\triangleq B,\]

where step (i) follows from Cauchy-Schwarz. Thus, the function class \(\mathbb{B}_{\mathbf{k}}(c_{\dagger}R)\) is \(B\)-uniformly bounded. Now define the _Rademacher critical radius_\(\delta_{n}>0\) to be the smallest positive solution to the inequality

\[\mathcal{R}_{n}(\delta;\mathcal{H})\leq\delta^{2},\quad\text{where}\quad \mathcal{R}_{n}(\delta;\mathcal{F})\triangleq\mathbb{E}_{x,\nu}\Bigg{[}\sup_{ \begin{subarray}{c}f\in\mathcal{F}:\\ \|f\|_{2}\leq\delta\end{subarray}}\left|\tfrac{1}{n}\sum_{i=1}^{n}\nu_{i}f(x_{ i})\right|\Bigg{]} \tag{101}\]

and \(\nu_{i}=\pm 1\) each with probability \(1/2\).

Finally, we use the following shorthand to control the KT approximation error term,

\[\eta_{n,\mathbf{k}} \triangleq\tfrac{\mathbf{a}^{2}}{n_{\mathrm{out}}}(2+2\mathfrak{W }_{\mathbf{k}}(n,n_{\mathrm{out}},\delta,\mathfrak{W}_{\mathrm{in}},\tfrac{ \mathbf{a}}{n_{\mathrm{out}}})),\quad\text{where} \tag{102}\] \[\mathfrak{R}_{\mathrm{in}} \triangleq\max_{x\in\mathcal{S}_{\mathrm{in}}}\|x\|_{2}\quad \text{and}\quad\mathbf{a}\triangleq\|\mathbf{k}\|_{\infty,\mathrm{in}}+Y_{ \mathrm{max}}^{2} \tag{103}\]

and \(\mathfrak{W}_{\mathbf{k}}\) is an _inflection factor_ defined in (29) that scales with the covering number \(\mathcal{N}_{\mathbf{k}}\) (see Def. 2). With these definitions in place, we are ready to state a detailed version of Thm. 2:

**Theorem 4** (KT-KRR for finite-dimensional RKHS, detailed).: _Suppose the kernel operator associated with \(\mathbf{k}\) and \(\mathbb{P}\) has eigenvalues \(\mu_{1}\geq\ldots\geq\mu_{m}>0\) (by Mercer's theorem). Define \(C_{m}\triangleq 1/\mu_{m}\). Let \(\varepsilon_{n}\) and \(\delta_{n}\) denote the solutions to (101) and (100), respectively. Further assume 5_

Footnote 5: Note that when \(\mathbf{k}\) is finite-rank, this condition is automatically satisfied.

\[n\delta_{n}^{2}>\log(4\log(1/\delta_{n})). \tag{104}\]

_Let \(\widehat{f}_{\mathrm{KT},\lambda^{\prime}}\) denote the KT-KRR estimator with regularization parameter_

\[\lambda^{\prime}\geq 2\xi_{n}^{2}\quad\text{where}\quad\xi_{n}\triangleq \varepsilon_{n}\vee\delta_{n}\lor 4\sqrt{C}_{m}(\|f^{\star}\|_{\mathbf{k}}+1)\eta_{n, \mathbf{k}}.\]

_Then with probability at least \(1-2\delta-2e^{-\frac{n\delta_{n}^{2}}{\varepsilon_{1}(C^{2}+\sigma^{2})}}\), we have_

\[\|\widehat{f}_{\mathrm{KT},\lambda^{\prime}}-f^{\star}\|_{2}^{2}\leq c\big{\{} \xi_{n}^{2}+\lambda^{\prime}\big{\}}\|f^{\star}\|_{\mathbf{k}}^{2}+c\delta_{n} ^{2}. \tag{105}\]

_where recall \(\delta\) is the success probability of KT-Compress++ (24)._

See App. D for the proof. We set \(\lambda^{\prime}=2\xi_{n}^{2}\), so that (105) becomes

\[\|\widehat{f}_{\mathrm{KT},\lambda^{\prime}}-f^{\star}\|_{2}^{2}\leq 3c\xi_{n}^{2}\|f^{ \star}\|_{\mathbf{k}}^{2}+c\delta_{n}^{2}. \tag{106}\]

It remains to bound the quantities \(\varepsilon_{n}\) (100), \(\delta_{n}\) (101), and \(\eta_{n,\mathbf{k}}\) (102). We claim that

\[\varepsilon_{n}\leq c_{0}\tfrac{\sigma}{R}\sqrt{\tfrac{m}{n}} \tag{107}\]\[\delta_{n} \leq c_{1}b\sqrt{\frac{m}{n}} \tag{108}\] \[\eta_{n,\mathbf{k}} \leq c_{2}\frac{\sqrt{m\cdot\log n_{\mathrm{out}}\cdot\log(1/ \delta)}}{n_{\mathrm{out}}}. \tag{109}\]

for some universal positive constants \(c_{0},c_{1},c_{2}\). Now set

\[R=\|f^{*}\|_{\mathbf{k}}\qquad\delta=e^{-1/R^{4}}.\]

Thus, we have

\[\xi_{n} \leq c^{\prime}(\frac{\sigma}{\|f^{*}\|_{\mathbf{k}}}\lor b\vee \frac{4\sqrt{C_{m}}}{\|f^{*}\|_{\mathbf{k}}})\frac{\sqrt{m}}{\sqrt{n}/n_{ \mathrm{out}}}.\]

for some universal positive constant \(c^{\prime}\). Substituting this into (106) leads to the advertised bound (19).

Proof of claim (107).For finite rank kernels, \(\hat{\mu}_{j}=0\) for \(j>m\). Thus, we have \(\sqrt{\frac{2}{n}}\sqrt{\sum_{j=1}^{n}\min\{\varepsilon^{2},\hat{\mu}_{j}\}}= \sqrt{\frac{2}{n}}\sqrt{m\varepsilon^{2}}\). From the critical radius condition (100), we want \(\sqrt{\frac{2}{n}}\sqrt{m\varepsilon^{2}}\leq\frac{R}{4\sigma}\varepsilon^{2}\), so we may set \(\varepsilon_{n}\simeq\frac{\sigma}{R}\sqrt{\frac{m}{n}}\).

Proof of claim (108).By similar logic as above, we have \(\sqrt{\frac{2}{n}}\sqrt{\sum_{j=1}^{n}\min\{\delta^{2},\mu_{j}\}}=\sqrt{\frac{ 2}{n}}\sqrt{m\delta^{2}}\). From the critical radius condition (101), we want \(\sqrt{\frac{2}{n}}\sqrt{m\delta^{2}}\leq\frac{1}{b}\delta^{2}\), so we may set \(\delta_{n}\simeq b\sqrt{2}\sqrt{\frac{m}{n}}\).

Proof of claim (109).Consider the linear operator \(T:\mathcal{H}\to\mathbb{R}^{m}\) that maps a function to the coefficients in the vector space spanned by \(\{\phi_{i}\}_{i=1}^{m}\). Note that

\[\|T\|=\frac{\|Tf\|_{\infty}}{\|Tf\|_{\mathbf{k}}}\leq\sqrt{\|\mathbf{k}\|_{ \infty}}\]

Since the image of \(T\) has dimension \(m\), we have \(\mathrm{rank}(T)\leq m\). Moreover, \(\|\mathbf{k}\|_{\infty}\leq\mu_{1}\cdot\mathfrak{R}_{\mathrm{in}}^{2}\). Now we can invoke [25, Eq. 14] with \(\epsilon=\mathfrak{a}/n_{\mathrm{out}}\) to obtain

\[\mathcal{N}_{\mathbf{k}}(\mathbb{B}_{\mathfrak{a}}^{d}(\mathfrak{R}_{\mathrm{ in}}),\mathfrak{a}/n_{\mathrm{out}})\leq\mathcal{N}(T,\mathfrak{a}/n_{\mathrm{ out}})\leq(1+\mu_{1}\mathfrak{R}_{\mathrm{in}}^{2}n_{\mathrm{out}}/ \mathfrak{a})^{m}.\]

Taking the log on both sides and substituting this bound into (102), we have

\[\eta_{n,\mathbf{k}} =\frac{\mathfrak{a}^{2}}{n_{\mathrm{out}}}(2+\mathfrak{W}_{ \mathbf{k}}(n,n_{\mathrm{out}},\delta,\mathfrak{R}_{\mathrm{in}},\frac{ \mathfrak{a}}{n_{\mathrm{out}}}))\] \[\leq\frac{\mathfrak{a}^{2}}{n_{\mathrm{out}}}(2+\sqrt{\log\!\left( \frac{n_{\mathrm{out}}\log(n/n_{\mathrm{out}})}{\delta}\right)\cdot\left[ \log\!\left(\frac{1}{\delta}\right)+\log\mathcal{N}_{\mathbf{k}}(\mathbb{B}_{ \mathfrak{a}}^{d}(\mathfrak{R}_{\mathrm{in}}),\frac{\mathfrak{a}}{n_{\mathrm{ out}}})\right]})\] \[\leq\frac{\mathfrak{a}^{2}}{n_{\mathrm{out}}}(2+\sqrt{\log\! \left(\frac{n_{\mathrm{out}}\log(n/n_{\mathrm{out}})}{\delta}\right)\cdot \left[\log\!\left(\frac{1}{\delta}\right)+m\log\!\left(1+\frac{2\|T\|n_{ \mathrm{out}}}{\mathfrak{a}}\right)\right]})\] \[\leq c\frac{\sqrt{m\cdot\log n_{\mathrm{out}}\cdot\log(1/\delta) }}{n_{\mathrm{out}}}\]

for some positive constant \(c\) that doesn't depend on \(m,n_{\mathrm{out}},\delta\).

## Appendix D Proof of Thm. 4: KT-KRR for finite-dimensional RKHS, detailed

We rescale our observation model (1) by \(\|f^{*}\|_{\mathbf{k}}\), so that the noise variance is \((\sigma/\|f^{*}\|_{\mathbf{k}})^{2}\) and our new regression function satisfies \(\|f^{*}\|_{\mathbf{k}}=1\). Our final prediction error should then be multiplied by \(\|f^{*}\|_{\mathbf{k}}^{2}\) to recover a result for the original problem. For simplicity, denote

\[\widetilde{\sigma}=\sigma/\|f^{*}\|_{\mathbf{k}}.\]

For notational convenience, define an event

\[\mathcal{E}=\big{\{}\|\widehat{f}_{\mathrm{KT},\lambda^{\prime}}-f^{*}\|_{2}^{ 2}\leq c(\xi_{n}^{2}+\lambda^{\prime})\big{\}},\]

and our goal is to show that \(\mathcal{E}\) occurs with high-probability in terms of \(\mathbb{P}\), the probability regarding all the randomness. For that end, we introduce several events that are used throughout,

\[\mathcal{E}_{\mathrm{conc}}\triangleq\bigg{\{}\sup_{g\in\mathcal{H}}\big{|} \left\|g\right\|_{n}-\left\|g\right\|_{2}\big{|}\leq\frac{\delta_{n}}{2} \bigg{\}}\quad\text{and}\quad\mathcal{E}_{\mathrm{lower}}\triangleq\Big{\{}\| \widehat{f}_{\mathrm{KT},\lambda^{\prime}}-f^{*}\|_{2}>\delta_{n}\Big{\}}, \tag{110}\]where \(\delta_{n}\) is defined in (101) and \(\mathcal{H}\) is the RKHS generated by \(\mathbf{k}\) hence star-shaped. Further, we introduce two technical events \(\mathcal{A}_{\mathrm{KT}}(u),\mathcal{B}_{\mathrm{KT}}\) defined in (123) and (136) respectively, which are proven to occur with small probability, and define a shorthand

\[\mathcal{E}_{\mathrm{good}}\triangleq\mathcal{A}_{\mathrm{KT}}^{c}(\xi_{n})\cap \mathcal{B}_{\mathrm{KT}}^{c}\cap\mathcal{E}_{\mathrm{conc}}\cap\mathcal{E}_{ \mathrm{KT},\delta}.\]

Equipped with these shorthands, observe the following inequality,

\[\mathbb{P}(\mathcal{E}) =\mathbb{P}(\mathcal{E}\cap\mathcal{E}_{\mathrm{lower}})+\mathbb{P }(\mathcal{E}\cap\mathcal{E}_{\mathrm{lower}}^{c})\] \[\geq\mathbb{P}(\mathcal{E}\cap\mathcal{E}_{\mathrm{lower}})+ \mathbb{P}(\mathcal{E}_{\mathrm{lower}}^{c}) \tag{111}\]

where the second inequality is because \(\mathcal{E}_{\mathrm{lower}}^{c}\subseteq\mathcal{E}_{\mathrm{lower}}^{c}\cap \mathcal{E}\) due to the assumption \(\lambda^{\prime}\geq 2\xi_{n}^{2}\geq 2\delta_{n}^{2}\).

If we are able to show the set inclusion \(\{\mathcal{E}_{\mathrm{good}}\cap\mathcal{E}_{\mathrm{lower}}\}\subseteq\{ \mathcal{E}\cap\mathcal{E}_{\mathrm{lower}}\}\) and that \(\mathbb{P}(\mathcal{E}_{\mathrm{good}}^{c})\) is small, we are able refine (111) to the following

\[\mathbb{P}(\mathcal{E})\geq\mathbb{P}(\mathcal{E}_{\mathrm{good}}\cap\mathcal{ E}_{\mathrm{lower}})+\mathbb{P}(\mathcal{E}_{\mathrm{lower}}^{c})\geq 1-\mathbb{P}( \mathcal{E}_{\mathrm{good}}^{c})-\mathbb{P}(\mathcal{E}_{\mathrm{lower}}^{c})+ \mathbb{P}(\mathcal{E}_{\mathrm{lower}})=1-\mathbb{P}(\mathcal{E}_{\mathrm{ good}}^{c}),\]

where the last quantity \(1-\mathbb{P}(\mathcal{E}_{\mathrm{good}}^{c})\) would be large.

To complete this proof strategy, we claim the set inclusion

\[\{\mathcal{E}_{\mathrm{good}}\cap\mathcal{E}_{\mathrm{lower}}\}\subseteq\{ \mathcal{E}\cap\mathcal{E}_{\mathrm{lower}}\} \tag{112}\]

to hold and prove it in App. D.1 and further claim

\[\mathbb{P}(\mathcal{E}_{\mathrm{good}}^{c})\leq c^{\prime\prime}\big{\{} \delta+e^{-c^{\prime}n\delta_{n}^{2}/(B_{\mathcal{H}}^{2}\wedge\bar{\sigma}^{ 2})}\big{\}} \tag{113}\]

which verify in App. D.2.

Putting the pieces together, claims (112) and (113) collectively implies

\[\mathbb{P}(\mathcal{E})\geq 1-c^{\prime\prime}\big{\{}\delta+e^{-c^{\prime}n \delta_{n}^{2}/(B_{\mathcal{H}}^{2}\wedge\bar{\sigma}^{2})}\big{\}}\]

as desired.

### Proof of claim (112)

There are several intermediary steps we take to show the set inclusion of interest (112). We introduce the shorthand

\[\widehat{\Delta}_{\mathrm{KT}}\triangleq\widehat{f}_{\mathrm{KT},\lambda^{ \prime}}-f^{\star}.\]

By invoking Propositions and basic inequalities to come, we successively show the following chain of set inclusions

\[\mathcal{E}_{\mathrm{good}}\cap\mathcal{E}_{\mathrm{lower}} \subseteq\mathcal{E}_{\mathrm{good}}\cap\mathcal{E}_{\mathrm{lower }}\cap\{\|\widehat{\Delta}_{\mathrm{KT}}\|_{n_{\mathrm{out}}}^{2}\leq c(\xi_ {n}^{2}+\lambda^{\prime})\} \tag{114}\] \[\subseteq\mathcal{E}_{\mathrm{good}}\cap\mathcal{E}_{\mathrm{ lower}}\cap\{\|\widehat{\Delta}_{\mathrm{KT}}\|_{n}^{2}\leq c(\xi_{n}^{2}+\lambda^{ \prime})\}\] (115) \[\subseteq\mathcal{E}_{\mathrm{good}}\cap\mathcal{E}_{\mathrm{lower }}\cap\mathcal{E}\] (116) \[\subseteq\mathcal{E}_{\mathrm{lower}}\cap\mathcal{E}. \tag{117}\]

Note that step (117) is achieved trivially by dropping \(\mathcal{E}_{\mathrm{good}}\). Further note that (115) is the crucial intermediary step after which we may apply uniform concentration across \(n\) independent samples. Proof of (115) leverages on the Proposition to come (Prop. 1) that allows \(\|\cdot\|_{n}\) and \(\|\cdot\|_{n_{\mathrm{out}}}\) to be exchangeable for finite rank kernels.

Recovering step (114)Since \(\widehat{f}_{\mathrm{KT},\lambda^{\prime}}\) and \(f^{\star}\) are optimal and feasible, respectively for the central optimization problem of interest

\[\min\nolimits_{f\in\mathcal{H}(\mathbf{k})}\tfrac{1}{n_{\mathrm{out}}}\sum \nolimits_{i=1}^{n_{\mathrm{out}}}(y_{i}^{\prime}-f(x_{i}^{\prime}))^{2}+ \lambda^{\prime}\|f\|_{\mathbf{k}}^{2},\]

we have the basic inequality

\[\tfrac{1}{n_{\mathrm{out}}}\sum\nolimits_{i=1}^{n_{\mathrm{out}}}\left(y_{i}^{ \prime}-\widehat{f}_{\mathrm{KT},\lambda^{\prime}}(x_{i}^{\prime})\right)^{2}+ \lambda^{\prime}\|\widehat{f}_{\mathrm{KT},\lambda^{\prime}}\|_{\mathbf{k}}^{ 2}\leq\tfrac{1}{n_{\mathrm{out}}}\sum\nolimits_{i=1}^{n_{\mathrm{out}}}(y_{i}^ {\prime}-f^{\star}(x_{i}^{\prime}))^{2}+\lambda^{\prime}\|f^{\star}\|_{ \mathbf{k}}^{2}, \tag{118}\]With some algebra, may refine (118) to

\[\tfrac{1}{2}\|\widehat{\Delta}_{\rm KT}\|_{n_{\rm out}}^{2}\leq\Big{|}\tfrac{1}{n_ {\rm out}}\sum_{i=1}^{n_{\rm out}}v^{\prime}_{i}\widehat{\Delta}_{\rm KT}(x^{ \prime}_{i})\Big{|}+\lambda\Big{\{}\|f^{\star}\|_{\mathbf{k}}^{2}-\|\widehat{f }_{\rm KT,\lambda^{\prime}}\|_{\mathbf{k}}^{2}\Big{\}}. \tag{119}\]

where \(\widehat{\Delta}_{\rm KT}=\widehat{f}_{{\rm KT},\lambda^{\prime}}-f^{\star}\).Suppose that \(\|\widehat{\Delta}_{\rm KT}\|_{n_{\rm out}}<\xi_{n}\), then we trivially recover (114) by adding \(\lambda^{\prime}>0\). Thus, we assume that \(\|\widehat{\Delta}_{\rm KT}\|_{n_{\rm out}}\geq\xi_{n}\).

Under the assumption \(\|\widehat{\Delta}_{\rm KT}\|_{n_{\rm out}}\geq\xi_{n}\), which is without loss of generality, we utilize the basic inequality (119) and control its stochastic component

\[\bigg{|}\tfrac{1}{n_{\rm out}}\sum_{i=1}^{n_{\rm out}}v^{\prime}_{i}\widehat{ \Delta}_{\rm KT}(x^{\prime}_{i})\bigg{|},\]

with a careful case work to follow, which is technical by nature.

Case where \(\|\widehat{f}_{{\rm KT},\lambda^{\prime}}\|_{\mathbf{k}}\leq 2\): Under such case, we introduce a technical event

\[\mathcal{A}_{\rm KT}(u)\triangleq\bigg{\{}\exists g\in\mathcal{F}\setminus \mathbb{B}_{2}(\delta_{n})\cap\{\|g\|_{n_{\rm out}}\geq u\}\text{ such that }\Big{|}\tfrac{1}{n_{\rm out}}\sum_{i=1}^{n_{\rm out}}v^{\prime}_{i}g(x^{ \prime}_{i})\Big{|}\geq 3\|g\|_{n_{\rm out}}u\bigg{\}},\]

for any star-shaped function class \(\mathcal{F}\subset\mathcal{H}\). Since \(\|f^{\star}\|_{\mathbf{k}}=1\), triangle inequality implies \(\|\widehat{\Delta}_{\rm KT}\|_{\mathbf{k}}\leq\|\widehat{f}_{{\rm KT},\lambda^ {\prime}}\|_{\mathbf{k}}+\|f^{\star}\|_{\mathbf{k}}\leq 3\). Moreover, on the event \(\mathcal{E}_{\rm lower}\) (\(\subseteq\mathcal{E}_{\rm good}\)), we have \(\|\widehat{\Delta}_{\rm KT}\|_{2}>\delta_{n}\). Thus, we may apply \(\widehat{\Delta}_{\rm KT}\) to the event \(\mathcal{A}_{\rm KT}^{\epsilon}(\xi_{n})\) with \(\mathcal{F}=\mathbb{B}_{\mathcal{H}}(3)\) (i.e., the \(\mathcal{H}\)-ball of radius 3) to attain

\[\Big{|}\tfrac{1}{n_{\rm out}}\sum_{i=1}^{n_{\rm out}}v^{\prime}_{i}\widehat{ \Delta}_{\rm KT}(x^{\prime}_{i})\Big{|}\leq c_{0}\xi_{n}\|\widehat{\Delta}_{ \rm KT}\|_{n_{\rm out}}\text{ on the event }\mathcal{A}_{\rm KT}^{\epsilon}(\xi_{n})\cap \mathcal{E}_{\rm lower}. \tag{120}\]

Upper bounding the stochastic component of the basic inequality (119) by (120) and dropping the \(-\|\widehat{f}_{{\rm KT},\lambda^{\prime}}\|_{\mathbf{k}}^{2}\) term in (119), we have

\[\tfrac{1}{2}\|\widehat{\Delta}_{\rm KT}\|_{n_{\rm out}}^{2}\leq c_{0}\xi_{n} \|\widehat{\Delta}_{\rm KT}\|_{n_{\rm out}}+\lambda^{\prime}.\]

As a last step under the case \(\|\widehat{f}_{{\rm KT},\lambda^{\prime}}\|_{\mathbf{k}}\leq 2\), apply the quadratic formula (specifically, if \(a,b\geq 0\) and \(x^{2}-ax-b\leq 0\), then \(x\leq a^{2}+b\)) to obtain

\[\|\widehat{\Delta}_{\rm KT}\|_{n_{\rm out}}^{2}\leq 4c_{0}^{2}\xi_{n}^{2}+2 \lambda^{\prime}.\]

Case where \(\|\widehat{f}_{{\rm KT},\lambda^{\prime}}\|_{\mathbf{k}}>2\): Under such case, by assumption we have \(\|\widehat{f}_{{\rm KT},\lambda^{\prime}}\|_{\mathbf{k}}>2>1\geq\|f^{\star}\| _{\mathbf{k}}\). Thus, we may derive the following

\[\|f^{\star}\|_{\mathbf{k}}-\|\widehat{f}_{{\rm KT},\lambda^{\prime}}\|_{ \mathbf{k}}<0\quad\text{and}\quad\|f^{\star}\|_{\mathbf{k}}+\|\widehat{f}_{{ \rm KT},\lambda^{\prime}}\|_{\mathbf{k}}>1,\]

which further implies the following inequality

\[\|f^{\star}\|_{\mathbf{k}}^{2}-\|\widehat{f}_{{\rm KT},\lambda^{\prime}}\|_{ \mathbf{k}}^{2}=\{\|f^{\star}\|_{\mathbf{k}}-\|\widehat{f}_{{\rm KT},\lambda^ {\prime}}\|_{\mathbf{k}}\}\{\|f^{\star}\|_{\mathbf{k}}+\|\widehat{f}_{{\rm KT}, \lambda^{\prime}}\|_{\mathbf{k}}\}\leq\|f^{\star}\|_{\mathbf{k}}-\|\widehat{f} _{{\rm KT},\lambda^{\prime}}\|_{\mathbf{k}}. \tag{121}\]

Further writing \(\widehat{f}_{{\rm KT},\lambda^{\prime}}=f^{\star}+\widehat{\Delta}_{\rm KT}\) and noting that \(\|\widehat{\Delta}_{\rm KT}\|_{\mathbf{k}}-\|f^{\star}\|_{\mathbf{k}}\leq\| \widehat{f}_{{\rm KT},\lambda^{\prime}}\|_{\mathbf{k}}\) holds through triangle inequality, we may further refine (121) as

\[\|f^{\star}\|_{\mathbf{k}}-\|\widehat{f}_{{\rm KT},\lambda^{\prime}}\|_{\mathbf{ k}}\leq 2\|f^{\star}\|_{\mathbf{k}}-\|\widehat{\Delta}_{\rm KT}\|_{\mathbf{k}}\leq 2-\| \widehat{\Delta}_{\rm KT}\|_{\mathbf{k}},\]

so that the basic inequality in (119) reduces to

\[\tfrac{1}{2}\|\widehat{\Delta}_{\rm KT}\|_{n_{\rm out}}^{2}\leq\Big{|}\tfrac{1 }{n_{\rm out}}\sum_{i=1}^{n_{\rm out}}v^{\prime}_{i}\widehat{\Delta}_{\rm KT}(x^ {\prime}_{i})\Big{|}+\lambda^{\prime}\{2-\|\widehat{\Delta}_{\rm KT}\|_{ \mathbf{k}}\}. \tag{122}\]

We again introduce a technical event that controls the stochastic component of (122), which is

\[\mathcal{B}_{\rm KT}\triangleq\bigg{\{}\exists g\in\mathcal{F} \setminus\mathbb{B}_{2}(\delta_{n})\cap\{\|g\|_{\mathbf{k}}\geq 1\}: \tag{123}\] \[\Big{|}\tfrac{1}{n_{\rm out}}\sum_{i=1}^{n_{\rm out}}v^{\prime}_{i }g(x^{\prime}_{i})\Big{|}>4\xi_{n}\|g\|_{n_{\rm out}}+2\xi_{n}^{2}\|g\|_{\mathbf{ k}}+\tfrac{1}{4}\|g\|_{n_{\rm out}}^{2}\bigg{\}},\]for a star-shaped function class \(\mathcal{F}\subset\mathcal{H}\).

By triangle inequality, we have \(\|\widehat{\Delta}_{\mathrm{KT}}\|_{\mathbf{k}}\geq\|\widehat{f}_{\mathrm{KT}, \lambda^{\prime}}\|_{\mathbf{k}}-\|f^{\star}\|_{\mathbf{k}}>1\), and on event \(\mathcal{E}_{\mathrm{lower}}\) (\(\subset\mathcal{E}_{\mathrm{good}}\)), we have \(\|\widehat{\Delta}_{\mathrm{KT}}\|_{2}>\delta_{n}\). Thus, we may apply \(g=\widehat{\Delta}_{\mathrm{KT}}\) to the event \(\mathcal{B}_{\mathrm{KT}}^{c}\), and the resulting refined basic inequality is

\[\tfrac{1}{2}\|\widehat{\Delta}_{\mathrm{KT}}\|_{n_{\mathrm{out}}}^ {2} \leq 4\xi_{n}\|\widehat{\Delta}_{\mathrm{KT}}\|_{n_{\mathrm{out}}}+( 2\xi_{n}^{2}-\lambda^{\prime})\|\widehat{\Delta}_{\mathrm{KT}}\|_{\mathbf{k}}+ 2\lambda^{\prime}\] \[\leq 4\xi_{n}\|\widehat{\Delta}_{\mathrm{KT}}\|_{n_{\mathrm{out}}} +2\lambda^{\prime}\quad\text{ on the event }\mathcal{B}_{\mathrm{KT}}^{c} \cap\mathcal{E}_{\mathrm{lower}}\]

where the second inequality is due to the assumption that \(\lambda^{\prime}\geq 2\xi_{n}^{2}\). We apply the quadratic formula (specifically, if \(a,b\geq 0\) and \(x^{2}-ax-b\leq 0\), then \(x\leq a^{2}+b\)) to obtain

\[\|\widehat{\Delta}_{\mathrm{KT}}\|_{n_{\mathrm{out}}}^{2}\leq 4c_{0}^{2}\xi_{n}^ {2}+2\lambda^{\prime}.\]

Putting the pieces together, we have shown

\[\|\widehat{\Delta}_{\mathrm{KT}}\|_{n_{\mathrm{out}}}^{2}\leq c(\xi_{n}^{2}+ \lambda^{\prime})\quad\text{ on the event }\mathcal{A}_{\mathrm{KT}}^{c}(\xi_{n}) \cap\mathcal{B}_{\mathrm{KT}}^{c}\cap\mathcal{E}_{\mathrm{lower}},\]

which is sufficient to recover (114).

Recovering step (115)We now upgrade events

\[\{\|\widehat{\Delta}_{\mathrm{KT}}\|_{n_{\mathrm{out}}}^{2}\leq c(\xi_{n}^{2} +\lambda^{\prime})\}\quad\Longrightarrow\quad\{\|\widehat{\Delta}_{\mathrm{ KT}}\|_{n}^{2}\leq c^{\prime}(\xi_{n}^{2}+\lambda^{\prime})\}\]

by exploiting the events \(\mathcal{E}_{\mathrm{conc}}\cap\mathcal{E}_{\mathrm{KT},\delta}\) (subset of \(\mathcal{E}_{\mathrm{good}}\)) that were otherwise not used when recovering (114). For this end, the following result is a crucial ingredient, which shows that \(\|\cdot\|_{n_{\mathrm{out}}}\) and \(\|\cdot\|_{n}\) are essentially exchangeable with high-probability,

**Proposition 1** (Multiplicative guarantee for KT-Compress++ with \(\mathbf{k}_{\mathrm{RR}}\)).: _Let \(C_{m}\triangleq 1/\mu_{m}\) and suppose \(\delta_{n}\) satisfies (104). Then on event \(\mathcal{E}_{\mathrm{KT},\delta}\cap\mathcal{E}_{\mathrm{conc}}\), where \(\mathcal{E}_{\mathrm{KT},\delta}\) and \(\mathcal{E}_{\mathrm{conc}}\) are defined in (24) and (110) respectively, we have_

\[(1-4C_{m}\cdot\eta_{n,\mathbf{k}})\|g\|_{n}\leq\|g\|_{n_{\mathrm{out}}}\leq(1+ 4C_{m}\cdot\eta_{n,\mathbf{k}})\|g\|_{n} \tag{124}\]

_uniformly over all \(g\in\mathcal{H}\) such that \(\|g\|_{2}>\delta_{n}\)._

See App. D.3 for the proof.

An immediate consequence of Prop. 1 is that

\[\{\|\widehat{\Delta}_{\mathrm{KT}}\|_{n_{\mathrm{out}}}^{2}\leq c(\xi_{n}^{2} +\lambda^{\prime})\}\quad\Longrightarrow\quad\{\|\widehat{\Delta}_{\mathrm{ KT}}\|_{n}^{2}\leq c^{\prime}(\xi_{n}^{2}+\lambda^{\prime})\}\]

on the event \(\mathcal{E}_{\mathrm{KT},\delta}\cap\mathcal{E}_{\mathrm{conc}}\cap\mathcal{E }_{\mathrm{lower}},\), which is sufficient to recover (115).

Recovering step (116)Our last step is to show

\[\{\|\widehat{\Delta}_{\mathrm{KT}}\|_{n}^{2}\leq c^{\prime}(\xi_{n}^{2}+ \lambda^{\prime})\}\quad\Longrightarrow\quad\{\|\widehat{\Delta}_{\mathrm{ KT}}\|_{2}^{2}\leq c^{\prime\prime}(\xi_{n}^{2}+\lambda^{\prime})\}.\]

Such result can be immediately shown on the event \(\mathcal{E}_{\mathrm{conc}}\) by observing that \(\widehat{\Delta}_{\mathrm{KT}}\in\mathcal{H}\), by our assumption that \(f^{\star}\in\mathcal{H}\) and by the definition

\[\widehat{f}_{\mathrm{KT},\lambda^{\prime}}\in\operatorname*{argmin}_{f\in \mathcal{H}(\mathbf{k})}L_{n_{\mathrm{out}}}(f)+\lambda^{\prime}\|f\|_{\mathbf{ k}}^{2}.\]

### Proof of claim (113)

It suffices to show the appropriate bounds for the following four probability terms

\[\mathbb{P}(\mathcal{A}_{\mathrm{KT}}(\xi_{n})),\quad\mathbb{P}(\mathcal{B}_ {\mathrm{KT}}),\quad\mathbb{P}(\mathcal{E}_{\mathrm{conc}}^{c}),\quad\mathbb{ P}(\mathcal{E}_{\mathrm{KT},\delta}^{c}).\]

Fix the shorthand

\[B_{\mathcal{H}}\triangleq\|\mathbf{k}\|_{\infty}^{2}R^{2}<\infty.\]

We know from [10] that \(\mathbb{P}(\mathcal{E}_{\mathrm{KT},\delta}^{c}|\mathcal{S}_{\mathrm{in}})\leq\delta\) and then we may apply [29, Thm. 14.1] to obtain a high probability statement,

\[\mathbb{P}(\mathcal{E}_{\mathrm{conc}}^{c})\leq e^{-c^{\prime}n\delta_{n}^{2}/B _{\mathcal{H}}^{2}}. \tag{125}\]

Now we present two Lemmas that bound the \(\mathbb{P}(\cdot\mid\mathcal{S}_{\mathrm{in}})\) probability of events \(\mathcal{A}_{\mathrm{KT}}(\xi_{n})\) and \(\mathcal{B}_{\mathrm{KT}}\),

**Lemma 7** (Controlling bad event when \(\|\widehat{f}_{\mathrm{KT},\lambda^{\prime}}\|_{\mathbf{k}}\leq 2\)).: _Suppose \(u\geq\xi_{n}\). Then for some constant \(c>0\),_

\[\mathbb{P}(\mathcal{A}_{\mathrm{KT}}(u)\mid\mathcal{S}_{\mathrm{in}})\leq\delta +e^{-cn\delta_{n}^{2}/B_{\mathcal{H}}^{2}}+e^{-cnu^{2}/\widetilde{\sigma}^{2}} \tag{126}\]

_where \(\widetilde{\sigma}=\sigma/\|f^{*}\|_{\mathbf{k}}\)._

See App. D.4 for the proof. Note that by plugging in \(\xi_{n}\) into (126) results in a probability that depends on \(\mathcal{S}_{\mathrm{in}}\) (as \(\xi_{n}\) depends on \(\mathcal{S}_{\mathrm{in}}\)). By invoking the definition of \(\xi_{n}\), we may further refine the probability bound of \(\mathcal{A}_{\mathrm{KT}}(\xi_{n})\) by

\[\mathbb{P}(\mathcal{A}_{\mathrm{KT}}(\xi_{n})\mid\mathcal{S}_{\mathrm{in}}) \leq\delta+e^{-cn\delta_{n}^{2}/B_{\mathcal{H}}^{2}}+e^{-cn\delta_{n}^{2}/ \widetilde{\sigma}^{2}} \tag{127}\]

**Lemma 8** (Controlling bad event when \(\|\widehat{f}_{\mathrm{KT},\lambda^{\prime}}\|_{\mathbf{k}}>2\)).: _For some constants \(c,c^{\prime}>0\),_

\[\mathbb{P}(\mathcal{B}_{\mathrm{KT}}\mid\mathcal{S}_{\mathrm{in}})\leq\delta+e ^{-cn\delta_{n}^{2}/B_{\mathcal{H}}^{2}}+ce^{-n\xi_{n}^{2}/(c^{\prime} \widetilde{\sigma}^{2})} \tag{128}\]

_where \(\widetilde{\sigma}=\sigma/\|f^{*}\|_{\mathbf{k}}\)._

See App. D.5 for the proof. It is notable that \(\xi_{n}\) in the probability bound of (128) contains a term \(\varepsilon_{n}\) defined in (100) that is a function of \(\mathcal{S}_{\mathrm{in}}\). Invoking the definition of \(\xi_{n}\), we observe the probability upper bound (128) can be refined to

\[\mathbb{P}(\mathcal{B}_{\mathrm{KT}}\mid\mathcal{S}_{\mathrm{in}})\leq\delta+e ^{-cn\delta_{n}^{2}/B_{\mathcal{H}}^{2}}+ce^{-n\delta_{n}^{2}/(c^{\prime} \widetilde{\sigma}^{2})}, \tag{129}\]

which does not depend on \(\mathcal{S}_{\mathrm{in}}\).

Putting the pieces together, we have the following probability bound for some constants \(c,c^{\prime}>0\),

\[\mathbb{P}(\mathcal{E}_{\mathrm{good}}^{c}\mid\mathcal{S}_{\mathrm{in}}) \leq\mathbb{P}(\mathcal{A}_{\mathrm{KT}}(\xi_{n})\mid\mathcal{S}_{\mathrm{in}} )+\mathbb{P}(\mathcal{B}_{\mathrm{KT}}\mid\mathcal{S}_{\mathrm{in}})+\mathbb{ P}(\mathcal{E}_{\mathrm{come}}^{c}\mid\mathcal{S}_{\mathrm{in}})+\mathbb{P}( \mathcal{E}_{\mathrm{KT},\delta}^{c}\mid\mathcal{S}_{\mathrm{in}})\]

thereby implying \(\mathbb{P}(\mathcal{E}_{\mathrm{good}}^{c})\leq c^{\prime\prime}\big{\{} \delta+e^{-c^{\prime}n\delta_{n}^{2}/(B_{\mathcal{H}}^{2}\wedge\widetilde{ \sigma}^{2})}\big{\}}\) for some constant \(c^{\prime\prime}\).

### Proof of Prop. 1: Multiplicative guarantee for KT-Compress++ with \(\mathbf{k}_{\mathrm{RR}}\)

Fix \(g\in\mathcal{H}\). Denote \(\langle g,h\rangle=\int g(x)h(x)dx\) as the inner product in the \(L^{2}\) sense. By Mercer's theorem [29, Cor. 12.26], the \(\mathbf{k}\)-norm of \(g\) has a basis expansion \(\|g\|_{\mathbf{k}}^{2}=\sum_{i=1}^{m}\langle g,\phi_{i}\rangle^{2}/\lambda_{i}\) so that

\[\|g\|_{\mathbf{k}}^{2}\leq\sum_{i=1}^{m}\langle g,\phi_{i}\rangle^{2}/\lambda_ {m}=C_{m}\|g\|_{2}^{2}\quad\text{since}\quad C_{m}=1/\lambda_{m}. \tag{130}\]

The assumption \(\|g\|_{2}\geq\delta_{n}\) implies that on the event \(\mathcal{E}_{\mathrm{conc}}\) (110), we have

\[\tfrac{1}{2}\delta_{n}\leq\|g\|_{2}-\tfrac{1}{2}\delta_{n}\leq\|g\|_{n} \tag{131}\]

Moreover, \(g\) must be a non-zero function. Note that \(g^{2}\in\mathcal{H}(\mathbf{k}_{\mathrm{RR}})\) (see App. F.3). Thus, we may apply Lem. 14 to \(f_{1}=f_{2}=g\) and \(a=1,b=0\) to obtain

\[\big{|}\|g\|_{n}^{2}-\|g\|_{n_{\mathrm{out}}}^{2}\big{|}=\bigg{|}\tfrac{1}{n} \sum_{i=1}^{n}g^{2}(x_{i})-\tfrac{1}{n_{\mathrm{out}}}\sum_{i=1}^{n_{\mathrm{ out}}}g^{2}(x_{i}^{\prime})\bigg{|}\leq\|g\|_{\mathbf{k}}^{2}\cdot\eta_{n, \mathbf{k}}. \tag{132}\]

The LHS can be expanded as

\[\big{|}\|g\|_{n}^{2}-\|g\|_{n_{\mathrm{out}}}^{2}\big{|}=\big{|}\|g\|_{n}-\|g\| _{n_{\mathrm{out}}}\big{|}\cdot\underbrace{\|g\|_{n}+\|g\|_{n_{\mathrm{out}}} \big{|}}_{>0\;\text{by}\;\eqref{eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq: eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq: eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq: eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq:eq: eqThus, we have

\[\tfrac{\|g\|_{2}^{2}}{\|g\|_{n}+\|g\|_{n_{\rm out}}} \stackrel{{\eqref{eq:22}}}{{\leq}}\frac{\delta_{n}^{2}}{4 \|g\|_{n}+\|g\|_{n_{\rm out}}}+\frac{\delta_{n}\|g\|_{n}}{\|g\|_{n}+\|g\|_{n_{ \rm out}}}+\frac{\|g\|_{2}^{2}}{\|g\|_{n}+\|g\|_{n_{\rm out}}}\] \[\stackrel{{\eqref{eq:22}}}{{\leq}}\frac{\delta_{n}^ {2}}{2\delta_{n}}+\delta_{n}+\|g\|_{n}\cdot\tfrac{\|g\|_{n}}{\|g\|_{n}+\|g\|_{n _{\rm out}}}\] \[\leq\tfrac{3}{2}\delta_{n}+\|g\|_{n}\] \[\stackrel{{\eqref{eq:22}}}{{\leq}}3\|g\|_{n}+\|g\|_ {n}=4\|g\|_{n}. \tag{135}\]

Using (135) to refine (133), we have on event \(\mathcal{E}_{\text{KT},\delta}\cap\mathcal{E}_{\text{conc}}\):

\[\big{|}\|g\|_{n}-\|g\|_{n_{\rm out}}\big{|}\leq 4C_{m}\|g\|_{n}\cdot\eta_{n, \mathbf{k}}.\]

With some algebra, this implies with probability at least \(1-\delta-\exp(-c^{\prime}n\delta_{n}^{2}/B_{\mathcal{F}}^{2})\):

\[(1-4C_{m}\cdot\eta_{n,\mathbf{k}})\|g\|_{n}\leq\|g\|_{n_{\rm out}}\leq(1+4C_{m }\cdot\eta_{n,\mathbf{k}})\|g\|_{n}\]

uniformly over all non-zero \(g\in\mathcal{H}\) such that \(\|g\|_{2}>\delta_{n}\).

Proof of Lem. 7: Controlling bad event when \(\|\widehat{f}_{\text{KT},\lambda^{\prime}}\|_{\mathbf{k}}\leq 2\)

Recall \(\mathcal{E}_{\text{KT},\delta}\) and \(\mathcal{E}_{\text{conc}}\) defined by (24) and (110). Also recall that \(\mathcal{E}_{\text{KT},\delta}\cap\mathcal{E}_{\text{conc}}\) combined with the assumption \(\|g\|_{2}\geq\delta_{n}\) invokes the event (124). Our aim is to show

\[\mathcal{A}_{\text{KT}}(u)\cap\mathcal{E}_{\text{KT},\delta}\cap\mathcal{E}_{ \text{conc}}\subseteq\{Z_{n}(2u)\geq 2u^{2}\},\quad\text{where}\quad Z_{n}(t) \triangleq\sup_{\begin{subarray}{c}g\in\mathcal{F},\\ \|g\|_{n}\leq t\end{subarray}}\big{|}\tfrac{\widetilde{\sigma}}{n}\sum_{i=1}^{ n}w_{i}g(x_{i})\big{|} \tag{136}\]

so that we have a probability bound

\[\mathbb{P}(\mathcal{A}_{\text{KT}}(u))\leq\mathbb{P}(\mathcal{E}_{\text{KT}, \delta}^{c})+\mathbb{P}(\mathcal{E}_{\text{conc}}^{c})+\mathbb{P}(Z_{n}(2u) \geq 2u^{2}).\]

The first RHS term can be bounded by \(\delta\) (see (24)). The second RHS term can bounded by (125). The third term can be bounded by

\[\mathbb{P}(Z_{n}(2u)\geq 2u^{2})=\mathbb{P}\big{(}Z_{n}(u)\geq u^{2}/2+u^{2} /2\big{)}\stackrel{{(i)}}{{\leq}}\mathbb{P}\big{(}Z_{n}(u)\geq u \varepsilon_{n}/2+u^{2}/2\big{)}\stackrel{{(ii)}}{{\leq}}e^{- \frac{u\Delta^{2}}{8\delta^{2}}},\]

where (i) follows from our assumption that \(u\geq\varepsilon_{n}\) and (ii) follows from applying generic concentration bounds on \(Z_{n}(u)\) (see [29, Thm. 2.26, Eq. 13.66]). Putting together the pieces yields our desired probability bound (126).

Proof of claim (136).Consider the event \(\mathcal{A}_{\text{KT}}(u)\cap\mathcal{E}_{\text{KT},\delta}\cap\mathcal{E}_{ \text{conc}}\). The norm equivalence established on the event \(\mathcal{E}_{\text{KT},\delta}\cap\mathcal{E}_{\text{conc}}\) in Prop. 1 is an important ingredient throughout.

Let \(g\in\mathcal{H}\) be the function that satisfies three conditions: \(\|g\|_{2}\geq\delta_{n}\), \(\|g\|_{n_{\rm out}}\geq u\), and

\[\bigg{|}\tfrac{1}{n_{\rm out}}\sum_{i=1}^{n_{\rm out}}v_{i}^{\prime}g(x_{i}^{ \prime})\bigg{|}\geq 3\|g\|_{n_{\rm out}}u.\]

Define the normalized function

\[\widetilde{g}=u\cdot g/\|g\|_{n_{\rm out}}\]

so that it satisfies \(\|\widetilde{g}\|_{n_{\rm out}}=u\) and also

\[\bigg{|}\tfrac{1}{n_{\rm out}}\sum_{i=1}^{n_{\rm out}}v_{i}^{\prime}\widetilde {g}(x_{i}^{\prime})\bigg{|}\geq 3u^{2}. \tag{137}\]

By triangle inequality, the LHS of (137) can be further upper bounded by

\[\bigg{|}\tfrac{1}{n_{\rm out}}\sum_{i=1}^{n_{\rm out}}v_{i}^{\prime}\widetilde {g}(x_{i}^{\prime})\bigg{|}\leq\bigg{|}\tfrac{1}{n}\sum_{i=1}^{n}v_{i}\widetilde {g}(x_{i})\bigg{|}+\tfrac{u}{\|g\|_{n_{\rm out}}}\bigg{|}\tfrac{1}{n}\sum_{i= 1}^{n}v_{i}g(x_{i})-\tfrac{1}{n_{\rm out}}\sum_{i=1}^{n_{\rm out}}v_{i}^{ \prime}g(x_{i}^{\prime})\bigg{|}. \tag{138}\]Recall the chosen \(g\) satisfies \(\|g\|_{n_{\rm out}}\geq u\). Observe that

\[v_{i}g(x_{i})\stackrel{{\eqref{eq:g_x_i}}}{{=}}(y_{i}-f^{\star}(x_{i }))g(x_{i})=-f^{\star}(x_{i})g(x_{i})+y_{i}g(x_{i}),\]

so we may apply Lem. 14 with \(f_{1}=f^{\star},f_{2}=g\) and \(a=-1,b=1\). Thus, on the event \(\mathcal{E}_{\rm KT,\delta}\cap\mathcal{E}_{\rm conc}\), we have

\[\left|\tfrac{1}{n}\sum_{i=1}^{n}v_{i}g(x_{i})-\tfrac{1}{n_{\rm out}}\sum_{i=1} ^{n_{\rm out}}v^{\prime}_{i}g(x^{\prime}_{i})\right|\leq\|g\|_{\mathbf{k}}(\|f ^{\star}\|_{\mathbf{k}}+1)\cdot\eta_{n,\mathbf{k}}. \tag{139}\]

Thus, we may rearrange (138) and combine with (137) and (139) to obtain

\[\left|\tfrac{1}{n}\sum_{i=1}^{n}v_{i}\widetilde{g}(x_{i})\right|\geq 3u^{2}- \tfrac{u}{\|g\|_{n_{\rm out}}}\|g\|_{\mathbf{k}}(\|f^{\star}\|_{\mathbf{k}}+1) \cdot\eta_{n,\mathbf{k}}\]

Note that

\[\tfrac{\|g\|_{\mathbf{k}}}{\|g\|_{\mathbf{n}_{\rm out}}}=\tfrac{\|g\|_{ \mathbf{k}}}{\|g\|_{2}}\cdot\tfrac{\|g\|_{2}}{\|g\|_{n}}\cdot\tfrac{\|g\|_{n}}{ \|g\|_{n_{\rm out}}}.\]

We tackle each term in turn. First, \(\tfrac{\|g\|_{\mathbf{k}}}{\|g\|_{2}}\stackrel{{\eqref{eq:g_x_i}} }{{\leq}}\sqrt{C}_{m}\). Since we assume \(\|g\|_{2}\geq\delta_{n}\), we have \(\tfrac{\|g\|_{2}}{\|g\|_{n}}\leq\tfrac{\delta_{n}/2+\|g\|_{n}}{\|g\|_{n}} \stackrel{{\eqref{eq:g_x_i}}}{{\leq}}2\) on event \(\mathcal{E}_{\rm conc}\); and \(\tfrac{\|g\|_{n_{\rm out}}}{\|g\|_{n_{\rm out}}}\stackrel{{ \eqref{eq:g_x_i}}}{{\leq}}2\) on event \(\mathcal{E}_{\rm conc}\cap\mathcal{E}_{\rm KT,\delta}\). Taken together,

\[\tfrac{\|g\|_{\mathbf{k}}}{\|g\|_{n_{\rm out}}}\leq 4\sqrt{C}_{m}\quad\text{on event}\quad\mathcal{E}_{\rm conc}\cap\mathcal{E}_{\rm KT,\delta}. \tag{140}\]

As \(u\geq\xi_{n}\geq 4\sqrt{C}_{m}(\|f^{\star}\|_{\mathbf{k}}+1)\eta_{n,\mathbf{k}}\) by assumption, we have therefore found \(\widetilde{g}\) with norm \(\|\widetilde{g}\|_{n_{\rm out}}=u\) satisfying

\[\left|\tfrac{1}{n}\sum_{i=1}^{n}v_{i}\widetilde{g}(x_{i})\right|\geq 3u^{2}-u^{2}=2u^{2}.\]

We may further show that

\[\|\widetilde{g}\|_{n}=\tfrac{u}{\|g\|_{n_{\rm out}}}\|g\|_{n}\leq u\tfrac{\|g \|_{n_{\rm out}}}{\|g\|_{n_{\rm out}}}\leq u\cdot 2\quad\text{on event}\quad\mathcal{E}_{\rm conc}\cap\mathcal{E}_{\rm KT,\delta},\]

where the last inequality follows from the fact that \(\|g\|_{2}\geq\delta_{n}\) and by applying (144). So we observe

\[2u^{2}\leq\left|\tfrac{1}{n}\sum_{i=1}^{n}v_{i}\widetilde{g}(x_{i})\right| \leq\sup_{\|\widetilde{g}\|_{n}\leq 2u}\left|\tfrac{1}{n}\sum_{i=1}^{n}v_{i} \widetilde{g}(x_{i})\right|=Z_{n}(2u)\]

Proof of Lem. 8: Controlling bad event when \(\|\widehat{f}_{\rm KT,\lambda^{\prime}}\|_{\mathbf{k}}>2\)

Our aim is to show for any \(g\in\partial\mathcal{H}\) with \(\|g\|_{\mathbf{k}}\geq 1\),

\[\left|\tfrac{1}{n_{\rm out}}\sum_{i=1}^{n_{\rm out}}v^{\prime}_{i}g(x^{\prime} _{i})\right|\leq 2\xi_{n}\|g\|_{n_{\rm out}}+2\xi_{n}^{2}\|g\|_{\mathbf{k}}+ \tfrac{1}{16}\|g\|_{n_{\rm out}}^{2}\quad\text{with high probability}.\]

Note that it is sufficient to prove our aim for \(g\in\partial\mathcal{H}\) with \(\|g\|_{\mathbf{k}}=1\)--by proving only for \(g\) with \(\|g\|_{\mathbf{k}}=1\), then for any \(h\in\partial\mathcal{H}\) with \(\|h\|_{\mathbf{k}}\geq 1\), we may plug \(g=h/\|h\|_{\mathbf{k}}\) into

\[\left|\tfrac{1}{n_{\rm out}}\sum_{i=1}^{n_{\rm out}}v^{\prime}_{i}g(x^{\prime} _{i})\right|\leq 2\xi_{n}\|g\|_{n_{\rm out}}+2\xi_{n}^{2}+\tfrac{1}{16}\|g\|_{n_{\rm out}}^{2} \tag{141}\]

to recover the aim of interest. So without loss of generality, we show (141) for all \(g\) such that \(g\in\partial\mathcal{H}\) and \(\|g\|_{\mathbf{k}}=1\).

Let \(\mathcal{B}_{\rm KT}\) denote the event where (141) is violated, i.e. there exists \(g\in\partial\mathcal{H}\) with \(\|g\|_{\mathbf{k}}=1\) so that

\[\left|\tfrac{1}{n_{\rm out}}\sum_{i=1}^{n_{\rm out}}v^{\prime}_{i}g(x^{\prime} _{i})\right|>3\xi_{n}\|g\|_{n_{\rm out}}+2\xi_{n}^{2}+\tfrac{1}{4}\|g\|_{n_{\rm out}}^{2}. \tag{142}\]

We prove the following set inclusion,

\[\mathcal{B}_{\rm KT}\cap\mathcal{E}_{\rm KT,\delta}\cap\mathcal{E}_{\rm conc}\]\[\leq \bigg{\{}\exists\,g\in\partial\mathcal{H}\text{ s.t. }\|g\|_{\mathbf{k}}=1 \text{ and }\Big{|}\tfrac{1}{n}\sum_{i=1}^{n}v_{i}g(x_{i})\bigg{|}>2 \varepsilon_{n}\|g\|_{n}+2\varepsilon_{n}^{2}+\tfrac{1}{16}\|g\|_{n}^{2}\bigg{\}}, \tag{143}\]

where we know the RHS event of (143) has probability bounded by \(ce^{-n\xi_{n}^{2}/(c^{\prime}\vec{\sigma}^{2})}\) which is proven in (29, Lem. 13.23). So the set inclusion (143) implies a bound over the event \(\mathcal{B}_{\mathrm{KT}},\)

\[\mathbb{P}(\mathcal{B}_{\mathrm{KT}})\leq\mathbb{P}(\mathcal{E}_{ \mathrm{KT},\delta}^{c})+\mathbb{P}(\mathcal{E}_{\mathrm{conc}}^{c})+ce^{-n \xi_{n}^{2}/(c^{\prime}\vec{\sigma}^{2})},\]

where \(\mathbb{P}(\mathcal{E}_{\mathrm{KT},\delta}^{c})\leq\delta\) by (24) and \(\mathbb{P}(\mathcal{E}_{\mathrm{conc}}^{c})\) by (125).

Choose \(g\) so that \(\|g\|_{\mathbf{k}}=1\) and (142) holds. Condition \(\|g\|_{\mathbf{k}}=1\) as well as the condition (130) resulting from a finite rank kernel \(\mathbf{k}\) implies \(\delta_{n}\leq 1\leq\|g\|_{\mathbf{k}}\leq\sqrt{C_{m}}\|g\|_{2}\). Invoke Prop. 1 for the choice of \(g\) that satisfies \(\|g\|_{2}\geq\delta_{n}/\sqrt{C_{m}}\geq\delta_{n}\), so that on the event \(\mathcal{E}_{\mathrm{KT},\delta}\cap\mathcal{E}_{\mathrm{conc}}\), we have the following norm equivalence,

\[\tfrac{1}{2}\|g\|_{n}\leq\|g\|_{n_{\mathrm{out}}}\leq\tfrac{3}{2 }\|g\|_{n}\quad\text{for any $n$ such that }C_{m}\cdot\eta_{n,\mathbf{k}}\leq 1/18. \tag{144}\]

Then we have the following chain of inequalities, which holds on event \(\mathcal{E}_{\mathrm{conc}}\cap\mathcal{E}_{\mathrm{KT},\delta}\)

\[\bigg{|}\tfrac{1}{n}\sum_{i=1}^{n}v_{i}g(x_{i})\bigg{|} \stackrel{{(i)}}{{\geq}}\bigg{|}\frac{1}{n_{\mathrm{ out}}}\sum_{i=1}^{n_{\mathrm{out}}}v_{i}^{\prime}g(x_{i}^{\prime})\bigg{|}- \bigg{|}\tfrac{1}{n}\sum_{i=1}^{n}v_{i}g(x_{i})-\tfrac{1}{n_{\mathrm{out}}}\sum _{i=1}^{n_{\mathrm{out}}}v_{i}^{\prime}g(x_{i}^{\prime})\bigg{|}\] \[\stackrel{{(ii)}}{{\geq}}3\xi_{n}\|g\|_{n_{\mathrm{ out}}}+2\xi_{n}^{2}+\tfrac{1}{4}\|g\|_{n_{\mathrm{out}}}^{2}-\|g\|_{\mathbf{k}}(\|f^{ \star}\|_{\mathbf{k}}+1)\cdot\eta_{n,\mathbf{k}}\] \[\stackrel{{(140)}}{{\geq}}3\xi_{n}\|g\|_{n_{\mathrm{ out}}}+2\xi_{n}^{2}+\tfrac{1}{4}\|g\|_{n_{\mathrm{out}}}^{2}-4\sqrt{C_{m}}\|g\|_{n_{ \mathrm{out}}}(\|f^{\star}\|_{\mathbf{k}}+1)\cdot\eta_{n,\mathbf{k}}\] \[\stackrel{{(144)}}{{\geq}}(\tfrac{3}{2}\xi_{n}-2 \sqrt{C_{m}}(\|f^{\star}\|_{\mathbf{k}}+1)\cdot\eta_{n,\mathbf{k}})\|g\|_{n}+2 \xi_{n}^{2}+\tfrac{1}{16}\|g\|_{n}^{2}, \tag{145}\]

where step (i) follows from triangle inequality and step (ii) follows from our assumption (142) to bound the first term and our approximation guarantee (139) to bound the second term. By definition of \(\xi_{n}\), we have

\[\tfrac{3}{2}\xi_{n}-2\sqrt{C_{m}}(\|f^{\star}\|_{\mathbf{k}}+1) \cdot\eta_{n,\mathbf{k}}\geq 2\xi_{n}.\]

Using this to refine (145), we have

\[\bigg{|}\tfrac{1}{n}\sum_{i=1}^{n}v_{i}g(x_{i})\bigg{|}\geq 2 \xi_{n}\|g\|_{n}+2\xi_{n}^{2}+\tfrac{1}{16}\|g\|_{n}^{2},\]

which directly implies the inclusion (143) as desired.

## Appendix E Proof of Thm. 3: KT-KRR guarantee for infinite-dimensional RKHS

We state a more detailed version of the theorem:

**Theorem 5** (KT-KRR guarantee for infinite-dimensional RKHS, detailed).: _Assume \(f^{\star}\in\mathcal{H}(\mathbf{k})\) and Assum. 1 is satisfied. If \(\mathbf{k}\) is \(\textsc{LogGrowth}(\alpha,\beta)\), then for some constant \(c\) (depending on \(d,\alpha,\beta\)), \(\widehat{f}_{\mathrm{KT},\lambda^{\prime}}\) with \(\lambda^{\prime}=\mathcal{O}(1/n_{\mathrm{out}})\) satisfies_

\[\|\widehat{f}_{\mathrm{KT},\lambda^{\prime}}-f^{\star}\|_{2}^{2} \leq c\Big{(}\frac{\log^{\alpha}n}{n}+\frac{\sqrt{\log^{\alpha}n_{\mathrm{ out}}}}{n_{\mathrm{out}}}\Big{)}\cdot\big{[}\|f^{\star}\|_{\mathbf{k}}+1\big{]}^{2} \tag{146}\]

_with probability at least \(1-2\delta-2e^{-\frac{n\xi_{n}^{2}}{\epsilon_{1}(1/f^{\star}\|_{\mathbf{k}}^{ \star}+\sigma^{2})}}\)._

_If \(\mathbf{k}\) is \(\textsc{PolyGrowth}(\alpha,\beta)\) with \(\alpha\in(0,2)\), then for some constant \(c\) (depending on \(d,\alpha,\beta\)), \(\widehat{f}_{\mathrm{KT},\lambda^{\prime}}\) with \(\lambda=\mathcal{O}(n_{\mathrm{out}}^{-\frac{2-\alpha}{\alpha}})\) satisfies_

\[\|\widehat{f}_{\mathrm{KT},\lambda^{\prime}}-f^{\star}\|_{2}^{2} \leq c\|f^{\star}\|_{\mathbf{k}}^{\frac{2}{2+\alpha}}n^{-\frac{2}{2+\alpha}}+[ \|f^{\star}\|_{\mathbf{k}}+1]^{2}n_{\mathrm{out}}^{-\frac{2-\alpha}{2}}\log n _{\mathrm{out}}+c^{\prime}b^{\frac{4}{2+\alpha}}n^{-\frac{2}{2+\alpha}} \tag{147}\]

_with probability at least \(1-2\delta-2e^{-\frac{n\xi_{n}^{2}}{\epsilon_{1}(1/f^{\star}\|_{\mathbf{k}}^{ \star}+\sigma^{2})}}\)._

### Generic KT-KRR guarantee

We state a generic result for infinite-dimensional RKHS that only depends on the Rademacher and Gaussian critical radii as well as the KT approximation term, all introduced in App. C.

**Theorem 6** (KT-Krr).: _Let \(f^{\star}\in\mathcal{H}(\mathbf{k})\) and Assum. 1 is satisfied. Let \(\delta_{n}\), \(\varepsilon_{n}\) denote the solutions to (100), (101), respectively. Denote \(\widehat{f}_{\mathrm{KT},\lambda^{\prime}}\) with regularization parameter \(\lambda^{\prime}\geq 2\eta_{n,\mathbf{k}}\), where \(\eta_{n,\mathbf{k}}\) is defined by (102). Then with probability at least \(1-2\delta-2e^{-\frac{n\delta_{n}^{2}}{c(|f^{\star}|^{2}_{\mathbf{k}}+\varepsilon ^{2})}}-c_{1}e^{-c_{2}\frac{n\|f^{\star}\|^{2}_{\mathbf{k}}\varepsilon_{n}^{2} }{\sigma^{2}}}\), we have_

\[\|\widehat{f}_{\mathrm{KT},\lambda^{\prime}}-f^{\star}\|_{2}^{2} \leq\mathbb{U}^{\mathrm{full}}+\mathbb{U}^{\mathrm{KT}},\quad\text{ where }\] \[\mathbb{U}^{\mathrm{full}} \triangleq c\big{(}\varepsilon_{n}^{2}+\lambda^{\prime}\big{)}[\|f^{\star} \|_{\mathbf{k}}+1]^{2}+c\delta_{n}^{2}\quad\text{and}\] \[\mathbb{U}^{\mathrm{KT}} \triangleq c\cdot\eta_{n,\mathbf{k}}\;[\|f^{\star}\|_{\mathbf{k}}+1 ]^{2}.\]

See App. F for the proof. The term \(\mathbb{U}^{\mathrm{full}}\) follows from the excess risk bound of Full-KRR \(\widehat{f}_{\mathrm{full},\lambda}\). The term \(\mathbb{U}^{\mathrm{KT}}\) follows from our KT approximation. Clearly, the best rates are achieved when we choose \(\lambda=2\eta_{n,\mathbf{k}}\).

### Proof of explicit rates

The strategy for each setting is as follows:

1. Bound the Gaussian critical radius (101) using [29, Cor. 13.18], which reduces to finding \(\varepsilon>0\) satisfying the inequality \[\sqrt{\frac{2}{n}}\sqrt{\sum_{j=1}^{n}\min\{\varepsilon^{2},\hat{\mu}_{j}\}} \leq\beta\varepsilon^{2},\quad\text{where}\quad\beta\triangleq\tfrac{\|f^{ \star}\|_{\mathbf{k}}}{4\sigma}\] (148) and \(\hat{\mu}_{1}\geq\hat{\mu}_{2}\geq\ldots\geq\hat{\mu}_{n}\geq 0\) are

[MISSING_PAGE_FAIL:38]

Setting \(\lambda^{\prime}=c_{2}a^{2}n_{\mathrm{out}}^{\frac{2-\alpha}{2}}\log n_{\mathrm{out}}\), we have

\[\|\widehat{f}_{\mathrm{KT},\lambda^{\prime}}-f^{\star}\|_{2}^{2} \leq c\big{(}\varepsilon_{n}^{2}+\lambda^{\prime}+\eta_{n,\mathbf{ k}}\big{)}\cdot[\|f^{\star}\|_{\mathbf{k}}+1]^{2}+c^{\prime}\delta_{n}^{2}\] \[\leq c\|f^{\star}\|_{\mathbf{k}}^{\frac{2}{\alpha+\alpha}}n^{-\frac {2}{2+\alpha}}+[\|f^{\star}\|_{\mathbf{k}}+1]^{2}n_{\mathrm{out}}^{-\frac{2- \alpha}{2}}\log n_{\mathrm{out}}+c^{\prime}b^{\frac{4}{2\pi\alpha}}n^{-\frac{2 }{2+\alpha}}.\]

#### e.2.2 Proof of (146)

We begin by solving (148).

**Lemma 11** (Critical Gaussian radius for LogGrowth kernels).: _Under Assum. 1 and LogGrowth version of Assum. 3, Gaussian critical radius satisfies_

\[\varepsilon_{n}^{2}\simeq\frac{\sigma^{2}}{\|f^{\star}\|_{\mathbf{k}}^{2}} \frac{\log(2c\cdot\frac{\|f^{\star}\|_{\mathbf{k}}}{\alpha}\sqrt{n})^{\alpha} }{n}\cdot L_{\mathbf{k}}(R_{n})C^{\prime\prime}_{\alpha}\]

_for some constant \(C^{\prime\prime}_{\alpha}\) that only depends on \(\alpha\). where we ignore log-log factors._

Proof.: [16, Cor. B.1] implies that

\[\hat{\mu}_{j}\leq 4\exp\!\left(2-2\!\left(\frac{j-1}{L_{\mathbf{k}}(R_{n})} \right)^{\frac{1}{\alpha}}\right)\quad\text{for all}\quad j>L_{\mathbf{k}}(R_{ n})+1\]

Let \(k\) be the smallest integer such that

\[k>L_{\mathbf{k}}(R_{n})+1\quad\text{and}\quad 4\exp\!\left(2-2\!\left(\frac{j-1}{L _{\mathbf{k}}(R_{n})}\right)^{\frac{1}{\alpha}}\right)\leq\varepsilon^{2}.\]

By Assum. 1, \(R_{n}\) is a constant, so the first inequality is easily satisfied for large enough \(n\)

\[k\geq L_{\mathbf{k}}(R_{n})\log\!\left(\frac{2e}{\varepsilon}\right)^{\alpha}+1. \tag{152}\]

Thus, \(k=\lceil L_{\mathbf{k}}(R_{n})\log\!\left(\frac{2e}{\varepsilon}\right)^{ \alpha}+1\rceil\). Then

\[\tfrac{2}{\sqrt{n}}\sqrt{\sum_{j=1}^{n}\min\{\varepsilon^{2},\hat{\mu}_{j}\}} \leq\tfrac{2}{\sqrt{n}}\sqrt{k\varepsilon^{2}+\sum_{j=k+1}^{n}4\exp\!\left(2- 2\!\left(\frac{j-1}{L_{\mathbf{k}}(R_{n})}\right)^{\frac{1}{\alpha}}\right)} \tag{153}\]

Consider the following approximation:

\[\sum_{\ell=k}^{n-1}4\exp\!\left(2-2\!\left(\frac{\ell}{L_{\mathbf{k}}(R_{n})} \right)^{\frac{1}{\alpha}}\right)\leq 4e^{2}\int_{k}^{\infty}e^{-\frac{2t}{L_{ \mathbf{k}}(R_{n})}^{1/\alpha}}dt=\int_{k-1}^{\infty}c^{t^{1/\alpha}}dt,\]

where \(c\triangleq\exp(-(L_{\mathbf{k}}(R_{n})/2)^{-1/\alpha})\in(0,1)\). Defining \(m\triangleq-\log c>0\) and \(k^{\prime}\triangleq k-1\), we have

\[\int_{k^{\prime}}^{\infty}c^{t^{1/\alpha}}dt\leq C_{\alpha}(k^{\prime}b^{-1}+b^ {\alpha-1}m^{-\alpha})e^{-mk^{\prime^{1/\alpha}}}, \tag{154}\]

by Li et al. [16, Eq. 50], where \(C_{\alpha}>0\) is a constant satisfying \((x+y)^{\alpha}\leq C_{\alpha}(x^{\alpha}+y^{\alpha})\) for any \(x,y>0\) and \(b\) is a known constant depending only on \(\alpha\). Plugging in \(k^{\prime}=\lceil L_{\mathbf{k}}(R_{n})\log\!\left(\frac{2e}{\varepsilon} \right)^{\alpha}\rceil\), we can bound the exponential by

\[e^{-mK^{\prime^{1/\alpha}}}\leq e^{-mL_{\mathbf{k}}(R_{n})^{1/\alpha}\log\! \left(\frac{2e}{\varepsilon}\right)}=\left(\tfrac{2e}{\varepsilon}\right)^{- mL_{\mathbf{k}}(R_{n})^{1/\alpha}}.\]

Note that we can simplify the exponent by \(-mL_{\mathbf{k}}(R_{n})^{1/\alpha}=-(L_{\mathbf{k}}(R_{n})/2)^{-1/\alpha}L_{ \mathbf{k}}(R_{n})^{1/\alpha}=-2^{1/\alpha}\). Note that \(k^{\prime}=k-1\geq L(R_{n})=2m^{-\alpha}\). Thus, we can absorb the \(b^{\alpha-1}m^{-\alpha}\) term in (154) into \(k\) and obtain the following bound

\[\sum_{\ell=k}^{n-1}4\exp\!\left(2-2\!\left(\tfrac{\ell}{L_{\mathbf{k}}(R_{n})} \right)^{\frac{1}{\alpha}}\right)\leq C^{\prime}_{\alpha}k^{\prime}\!\left( \tfrac{2e}{\varepsilon}\right)^{-2^{1/\alpha}},\]

where \(C^{\prime}_{\alpha}\) depends only on \(\alpha\). Plugging this bound into (153), we have

\[\tfrac{2}{\sqrt{n}}\sqrt{\sum_{j=1}^{n}\min\{\varepsilon^{2}, \hat{\mu}_{j}\}} \leq\tfrac{2}{\sqrt{n}}\sqrt{k\varepsilon^{2}+C^{\prime}_{\alpha}k \!\left(\tfrac{\varepsilon}{2e}\right)^{2^{1/\alpha}}}\] \[\stackrel{{\eqref{eq:L_k}}}{{\leq}}\tfrac{2e}{\sqrt {n}}\sqrt{L_{\mathbf{k}}(R_{n})\log\!\left(\tfrac{2e}{\varepsilon}\right)^{ \alpha}\!\left(\varepsilon^{2}+C^{\prime}_{\alpha}\!\left(\tfrac{\varepsilon}{2 e}\right)^{2^{1/\alpha}}\right)}\]\[\leq\frac{2e}{\sqrt{n}}\sqrt{L_{\mathbf{k}}(R_{n})\log\left(\frac{2e}{ \varepsilon}\right)^{\alpha}}C^{\prime\prime}_{\alpha}\varepsilon^{2^{1/(1\lor \alpha)}}\]

for some constant \(C^{\prime\prime}_{\alpha}\) that only depends on \(\alpha\) and universal positive constant \(c\). To solve (148), it suffices to solve

\[\frac{2c}{\sqrt{n}}\sqrt{L_{\mathbf{k}}(R_{n})\log\left(\frac{2e}{ \varepsilon}\right)^{\alpha}}C^{\prime\prime}_{\alpha}\varepsilon^{2^{1/(1\lor \alpha)}}\leq\beta\varepsilon^{2},\]

which is implied by the looser bound

\[\frac{1}{\beta^{2}}\cdot\frac{4c^{2}}{n}\cdot L_{\mathbf{k}}(R_{n})C^{\prime \prime}_{\alpha}\leq\varepsilon^{2}\log\left(\frac{2e}{\varepsilon}\right)^{- \alpha}.\]

The solution to (148) (up to log-log factors) is

\[\varepsilon\simeq\frac{\log(2e\cdot\beta\sqrt{n})^{\alpha/2}}{\sqrt{n}}\sqrt{ \frac{4c^{2}}{\beta^{2}}\cdot L_{\mathbf{k}}(R_{n})C^{\prime\prime}_{\alpha}}.\]

We proceed to solve (149).

**Lemma 12** (Critical Gaussian radius for LogGrowth kernels).: _Under Assum. 1 and LogGrowth version of Assum. 3, the Rademacher critical radius satisfies_

\[\delta_{n}^{2}\simeq b^{2}\frac{\log\left(\frac{2e}{\varepsilon}\cdot\sqrt{n} \right)^{\alpha}}{n}\cdot L_{\mathbf{k}}(R_{n})C^{\prime\prime}_{\alpha}.\]

Proof.: Following the same logic as in the proof of Lem. 11 but with \(\beta=1/b\) yields the desired bound. 

Finally, it remains to bound (102). We have

\[\eta_{n,\mathbf{k}} =\frac{\mathtt{a}^{2}}{n_{\mathrm{out}}}(2+2\mathfrak{W}_{ \mathbf{k}}(n,n_{\mathrm{out}},\delta,\mathfrak{R}_{\mathrm{in}},\frac{\mathtt{ a}}{n_{\mathrm{out}}}))\] \[\leq\frac{\mathtt{a}^{2}}{n_{\mathrm{out}}}(2+\sqrt{\log\left( \frac{n_{\mathrm{out}}\log(n/n_{\mathrm{out}})}{\delta}\right)\cdot\left[\log \left(\frac{1}{\delta}\right)+\log\mathcal{N}_{\mathbf{k}}(\mathbb{B}^{d}_{2}( \mathfrak{R}_{\mathrm{in}}),\frac{\mathtt{a}}{n_{\mathrm{out}}})\right]})\] \[\leq\frac{\mathtt{a}^{2}}{n_{\mathrm{out}}}(2+\sqrt{\log\left( \frac{n_{\mathrm{out}}\log(n/n_{\mathrm{out}})}{\delta}\right)\cdot\left[\log \left(\frac{1}{\delta}\right)+\mathfrak{C}_{d}\log(\frac{en_{\mathrm{out}}}{ \mathtt{a}})^{\alpha}(\mathfrak{R}_{\mathrm{in}}+1)^{\beta}\right]})\]

for some universal positive constant \(c\).

In summary, there exists universal positive constants \(c_{0},c_{1},c_{2}\) such that

\[\varepsilon_{n}^{2}\leq c_{0}\frac{\mathtt{a}^{2}}{\|f^{\star}\|_{\mathbf{k}} ^{2}}\frac{\log(2e\cdot\frac{\|f^{\star}\|_{\mathbf{k}}}{n}\sqrt{n})^{\alpha} }{n}\quad\delta_{n}^{2}\leq c_{1}b^{2}\frac{\log(\frac{2e}{\varepsilon}\cdot \sqrt{n})^{\alpha/2}}{n}\quad\eta_{n,\mathbf{k}}\leq c_{2}\frac{\mathtt{a}}{n_ {\mathrm{out}}}\log(\frac{en_{\mathrm{out}}}{\mathtt{a}})^{\alpha/2}\mathfrak{ R}_{\mathrm{in}}^{\beta/2}.\]

Setting \(\lambda^{\prime}=2c_{2}\frac{\mathtt{a}}{n_{\mathrm{out}}}\log(\frac{en_{ \mathrm{out}}}{\mathtt{a}})^{\alpha/2}\), we have

\[\|\widehat{f}_{\mathrm{KT},\lambda^{\prime}}-f^{\star}\|_{2}^{2} \leq c\big{(}\varepsilon_{n}^{2}+\lambda^{\prime}+\eta_{n,\mathbf{k}} \big{)}\cdot\left[\|f^{\star}\|_{\mathbf{k}}+1\right]^{2}+c^{\prime}\delta_{n}^ {2}\] \[\leq c\frac{\log(2e\cdot\frac{\|f^{\star}\|_{\mathbf{k}}}{\mathtt{ a}}\sqrt{n})^{\alpha}}{n}+\left[\|f^{\star}\|_{\mathbf{k}}+1\right]^{2}\frac{c}{n_{ \mathrm{out}}}\log(\frac{en_{\mathrm{out}}}{\mathtt{a}})^{\alpha/2}+c^{\prime }b^{2}\frac{\log(\frac{2e}{\varepsilon}\cdot\sqrt{n})^{\alpha/2}}{n}.\]

## Appendix F Proof of Thm. 6: KT-KRR

Our first goal is to bound the in-sample prediction error. We relate \(\|\widehat{f}_{\mathrm{KT},\lambda^{\prime}}-f^{\star}\|_{n}^{2}\) to \(\|\widehat{f}_{\mathrm{full},\lambda}-f^{\star}\|_{n}^{2}\), where the latter quantity has well known properties from standard analyses of the KRR estimator (refer to [29]). Note that regularization parameter \(\lambda^{\prime}\) of KT based estimator \(\widehat{f}_{\mathrm{KT},\lambda^{\prime}}\) is independently chosen from the regularization parameter \(\lambda\) of the estimator based on original samples \(\widehat{f}_{\mathrm{full},\lambda}\). For \(\widehat{f}_{\mathrm{full},\lambda}\), we choose the regularization parameter

\[\lambda=2\varepsilon_{n}^{2}, \tag{155}\]

which is known to yield optimal \(L^{2}\) error rates.

Define the main event of interest,

\[\mathcal{E}\triangleq\{\|\widehat{f}_{\mathrm{KT},\lambda^{\prime}}-f^{\star}\|_{2} ^{2}\leq c(\varepsilon_{n}^{2}+\delta_{n}^{2}+\lambda^{\prime}+\eta_{n,\mathbf{ k}})[\|f^{\star}\|_{\mathbf{k}}+1]^{2}\}.\]

Our goal is to show \(\mathcal{E}\) occurs with high probability. For that end, we introduce several additional events that are used throughout this proof.

For some constant \(c>\), define the event of an appealing in-sample prediction error of \(\widehat{f}_{\mathrm{KT},\lambda^{\prime}}\),

\[\mathcal{E}_{\mathrm{KT},n}(t)\triangleq\left\{\|\widehat{f}_{\mathrm{KT}, \lambda^{\prime}}-f^{\star}\|_{n}^{2}\leq c\big{[}t^{2}+\lambda^{\prime}+\eta_ {n,\mathbf{k}}\big{]}\cdot(\|f^{\star}\|_{\mathbf{k}}+1)^{2}\right\}\quad\text{ for}\quad t\geq\varepsilon_{n}.\]

where \(\eta_{n,\mathbf{k}}\) is defined in (102). Recall \(\mathcal{E}_{\mathrm{KT},\delta}\) is the event where KT-Compress++ succeeds as defined by (24).

Further as \(f^{\star}\) and \(\widehat{f}_{\mathrm{KT},\lambda^{\prime}}\) are both in \(\{f\in\mathcal{H}:\|f\|_{\mathbf{k}}\leq R\}\), we may deduce that all the functions under consideration satisfies \(\|f\|_{\infty}\leq\|\mathbf{k}\|_{\infty}\|f\|_{\mathbf{k}}\leq\|\mathbf{k}\|_ {\infty}R\) where \(\|\mathbf{k}\|_{\infty}<\infty\). Accordingly, we define a uniform concentration event,

\[\mathcal{E}^{\prime}_{\text{conc}}\triangleq\{\sup_{f\in\mathcal{F}}\big{\|} \|f\|_{2}^{2}-\|f\|_{n}^{2}\big{|}\leq\|f\|_{2}^{2}/2+\delta_{n}^{2}/2\}\quad \text{where}\quad\mathcal{F}=\{f\in\mathcal{H}:\|f\|_{\infty}\leq 2\|\mathbf{k}\|_{ \infty}R\}. \tag{156}\]

Event (156) is analogous to the event \(\mathcal{E}_{\text{conc}}\) previously defined in (110) when dealing with finite rank kernels.

We first show that

\[\mathcal{E}_{\mathrm{KT},n}(\varepsilon_{n}\vee\delta_{n})\cap\mathcal{E}^{ \prime}_{\text{conc}}\subseteq\mathcal{E}. \tag{157}\]

Notice that almost surely we have

\[\|\widehat{f}_{\mathrm{KT},\lambda^{\prime}}-f^{\star}\|_{\infty}\leq 2\| \mathbf{k}\|_{\infty}R,\]

thereby implying

\[\|\widehat{f}_{\mathrm{KT},\lambda^{\prime}}-f^{\star}\|_{2}^{2}\leq 2\;\| \widehat{f}_{\mathrm{KT},\lambda^{\prime}}-f^{\star}\|_{n}^{2}+\delta_{n}^{2} \quad\text{on the event $\mathcal{E}^{\prime}_{\text{conc}}$.} \tag{158}\]

Next invoking the event \(\mathcal{E}_{\mathrm{KT},n}(\varepsilon_{n}\vee\delta_{n})\) along with (158), we have

\[\|\widehat{f}_{\mathrm{KT},\lambda^{\prime}}-f^{\star}\|_{2}^{2} \leq 2c[(\varepsilon_{n}\vee\delta_{n})^{2}+\lambda^{\prime}+\eta_ {n,\mathbf{k}}]\cdot(\|f^{\star}\|_{\mathbf{k}}+1)^{2}+\delta_{n}^{2}\] \[\leq c(\varepsilon_{n}^{2}+\delta_{n}^{2}+\lambda^{\prime}+\eta_ {n,\mathbf{k}})[\|f^{\star}\|_{\mathbf{k}}+1]^{2}.\]

which recovers the event of \(\mathcal{E}\).

The remaining task is to show \(\mathcal{E}\) is of high-probability, which amounts to showing events \(\mathcal{E}_{\mathrm{KT},n}(t)\) and \(\mathcal{E}^{\prime}_{\text{conc}}\) are of high-probability by reflecting on (157). From [29, Thm. 14.1], we may immediately derive

\[\mathbb{P}(\mathcal{E}^{\prime}_{\text{conc}})\geq 1-c_{1}e^{-c_{2}\frac{n \delta_{n}^{2}}{\|\mathbf{k}\|_{\infty}^{2}R^{2}}}\]

for some constants \(c_{1},c_{2}>0\).

We further claim that

\[\mathbb{P}(\mathcal{E}_{\mathrm{KT},n}(t)\mid\mathcal{S}_{\mathrm{in}})\geq 1 -\delta-e^{-\frac{n\delta_{n}^{2}}{c_{0}\sigma^{2}}}-c_{1}e^{-c_{2}\frac{\|f^{ \star}\|_{\mathbf{k}}^{2}R^{2}}{\sigma^{2}}} \tag{159}\]

for some constants \(c_{0},c_{1},c_{2}>0\). Proof of claim (159) is deferred to App. F.1. Plugging in \(t=\varepsilon_{n}\vee\delta_{n}\) into (159), and invoking inequality \(\varepsilon_{n}\vee\delta_{n}\geq\delta_{n}\) so as to decouple the dependence on \(\mathcal{S}_{\mathrm{in}}\), we have

\[\mathbb{P}(\mathcal{E}_{\mathrm{KT},n}(\varepsilon_{n}\vee\delta_{n})\mid \mathcal{S}_{\mathrm{in}})\geq 1-\delta-e^{-\frac{n\delta_{n}^{2}}{c_{0}\sigma^{2}}}-c_{1}e^{ -c_{2}\frac{\|f^{\star}\|_{\mathbf{k}}^{2}R^{2}}{\sigma^{2}}}\]

which further implies

\[\mathbb{P}(\mathcal{E}_{\mathrm{KT},n}(\varepsilon_{n}\vee\delta_{n}))\geq 1 -\delta-e^{-\frac{n\delta_{n}^{2}}{c_{0}\sigma^{2}}}-c_{1}e^{-c_{2}\frac{\|f^{ \star}\|_{\mathbf{k}}^{2}R^{2}_{n}}{\sigma^{2}}}.\]

Putting the pieces together, for some constants \(c_{0},c_{1}>0\), we have

\[\mathbb{P}(\mathcal{E})\geq 1-\delta-c_{0}e^{-c_{1}\frac{n\delta_{n}^{2}}{ \sigma^{2}\wedge(\sigma^{2}/1/\tau^{2}\|_{\mathbf{k}}^{2})\wedge(\|\mathbf{k} \|_{\infty}^{2}R^{2})}}. \tag{160}\]

Overall, (157) and (160) collectively yields the desired result.

### Proof of claim (159)

To prove claim (159), we introduce two new intermediary and technical events. For some positive constant \(c_{0}\), define the event 6 when in-sample prediction error of \(\widehat{f}_{\mathrm{full},\lambda}\) is appealing

Footnote 6: Since the input points in \(\mathcal{S}_{\mathrm{in}}\) are fixed, the randomness in \(\widehat{f}_{\mathrm{full},\lambda}\) originates entirely from the randomness of the noise variables \(\boldsymbol{\xi}\).

\[\mathcal{E}_{\mathrm{full},n}(t)\triangleq\Big{\{}\|\widehat{f}_{\mathrm{full },\lambda}-f^{\star}\|_{n}^{2}\leq 3c_{0}\|f^{\star}\|_{\mathbf{k}}^{2}t^{2} \Big{\}}\quad\text{for}\quad t\geq\varepsilon_{n}. \tag{161}\]

The second intermediary event, denoted as \(\mathcal{E}_{\widehat{\Delta}_{\mathrm{KT}}}(t)\), is the intersection of (169) and (170), which we do not elaborate here due to its technical nature--event \(\mathcal{E}_{\widehat{\Delta}_{\mathrm{KT}}}(t)\) plays an analogous role to \(\mathcal{A}_{\mathrm{KT}}^{c}\cap\mathcal{B}_{\mathrm{KT}}^{c}\) defined in (123) and (136) respectively.

Our goal here is two-folds: first is to show

\[\{\mathcal{E}_{\mathrm{full},n}(t)\cap\mathcal{E}_{\mathrm{KT},\delta}\cap \mathcal{E}_{\widehat{\Delta}_{\mathrm{KT}}}(t)\}\quad\implies\quad\mathcal{E} _{\mathrm{KT},n}(t)\]

and second is to prove the following bound

\[\mathbb{P}\Big{(}\mathcal{E}_{\mathrm{full},n}(t)\cap\mathcal{E}_{\mathrm{KT}, \delta}\cap\mathcal{E}_{\widehat{\Delta}_{\mathrm{KT}}}(t)\mid\mathcal{S}_{ \mathrm{in}}\Big{)}\geq 1-\delta-e^{-\frac{nt^{2}}{c_{0}\sigma^{2}}}-c_{1}e^{-c_{2 }\frac{n\|f^{\star}\|_{\mathbf{k}}^{2}t^{2}}{\sigma^{2}}},\]

from which (159) follows. Note that Wainwright [29, Thm. 13.17] show

\[\mathbb{P}(\mathcal{E}_{\mathrm{full},n}(t))\geq 1-c_{1}e^{-c_{2}\frac{n\|f^{\star} \|_{\mathbf{k}}^{2}t^{2}}{\sigma^{2}}}\]

for some constants \(c_{1},c_{2}>0\) and that \(\mathbb{P}(\mathcal{E}_{\mathrm{KT},\delta}\mid\mathcal{S}_{\mathrm{in}})\geq 1-\delta\). So it remains to bound the probability of event \(\mathcal{E}_{\widehat{\Delta}_{\mathrm{KT}}}(t)\), which we show below.

Given \(f\), define the following quantities

\[L_{n}(f) \triangleq\frac{1}{n}\sum_{i=1}^{n}(f^{2}(x_{i})-2f(x_{i})y_{i}) +\frac{1}{n}\sum_{i=1}^{n}y_{i}^{2}\quad\text{and}\] \[L_{n_{\mathrm{out}}}(f) \triangleq\frac{1}{n_{\mathrm{out}}}\sum_{i=1}^{n_{\mathrm{out}} }(f^{2}(x^{\prime}_{i})-2f(x^{\prime}_{i})y^{\prime}_{i})+\frac{1}{n}\sum_{i=1 }^{n}y_{i}^{2}.\]

In the sequel, we repeatedly make use of the following fact: on event \(\mathcal{E}_{\mathrm{KT},\delta}\) defined in (24), we have

\[|L_{n}(f)-L_{n_{\mathrm{out}}}(f)|\leq\big{(}\|f\|_{\mathbf{k}}^{2}+2\big{)} \cdot\eta_{n,\mathbf{k}}\quad\text{for all non-zero}\quad f\in\mathcal{H}. \tag{162}\]

The claim of (162) is deferred to the end of this section. Given \(f\), we can show with some algebra that

\[L_{n}(f)=\frac{1}{n}\sum_{i=1}^{n}(f(x_{i})-y_{i})^{2}=\|f-f^{\star}\|_{n}^{2 }-\frac{2}{n}\langle Z,\boldsymbol{\xi}\rangle+\frac{1}{n}\sum_{i=1}^{n}\xi_{ i}^{2}, \tag{163}\]

where \(Z\triangleq(f(x_{1})-f^{\star}(x_{1}),\ldots,f(x_{n})-f^{\star}(x_{n}))\) and \(\boldsymbol{\xi}\triangleq(\xi_{1},\ldots,\xi_{n})\) are vectors in \(\mathbb{R}^{n}\). Define the shorthands

\[\widehat{\Delta}_{\mathrm{KT}}\triangleq\widehat{f}_{\mathrm{KT},\lambda^{ \prime}}-f^{\star}\quad\text{and}\quad\widehat{\Delta}_{\mathrm{full}} \triangleq\widehat{f}_{\mathrm{full},\lambda}-f^{\star}.\]

In the sequel, we use the following shorthands:

\[Z_{full}\triangleq(\widehat{\Delta}_{\mathrm{full}}(x_{1}),\ldots,\widehat{ \Delta}_{\mathrm{full}}(x_{n}))\quad\text{and}\quad Z_{KT}\triangleq(\widehat{ \Delta}_{\mathrm{KT}}(x_{1}),\ldots,\widehat{\Delta}_{\mathrm{KT}}(x_{n})).\]

Now for the main argument to bound \(\|\widehat{f}_{\mathrm{KT},\lambda^{\prime}}-f^{\star}\|_{n}^{2}\). When \(\|\widehat{\Delta}_{\mathrm{KT}}\|_{n}<t\), we immediately have \(\|\widehat{\Delta}_{\mathrm{KT}}\|_{n}^{2}<t^{2}\), which implies (159). Thus, we may assume that \(\|\widehat{\Delta}_{\mathrm{KT}}\|_{n}\geq t\). Note that

\[\|\widehat{\Delta}_{\mathrm{KT}}\|_{n}^{2} \stackrel{{\eqref{eq:f_full}}}{{=}}L_{n}(\widehat{f}_{ \mathrm{KT},\lambda^{\prime}})+\frac{2}{n}\langle Z_{KT},\xi\rangle-\frac{1}{ n}\sum_{i=1}^{n}\xi_{i}^{2}\] \[=L_{n}(\widehat{f}_{\mathrm{full},\lambda})+\Big{[}L_{n}( \widehat{f}_{\mathrm{KT},\lambda^{\prime}})-L_{n}(\widehat{f}_{\mathrm{full},\lambda})\Big{]}+\frac{2}{n}\langle Z_{KT},\xi\rangle-\frac{1}{n}\sum_{i=1} ^{n}\xi_{i}^{2}.\]

Given the optimality of \(\widehat{f}_{\mathrm{full},\lambda}\) on the objective (3), we have

\[L_{n}(\widehat{f}_{\mathrm{full},\lambda})\leq\frac{1}{n}\sum_{i=1}^{n}\xi_{i}^ {2}+\lambda\Big{\{}\|f^{\star}\|_{\mathbf{k}}^{2}-\|\widehat{f}_{\mathrm{ full},\lambda}\|_{\mathbf{k}}^{2}\Big{\}}\leq\frac{1}{n}\sum_{i=1}^{n}\xi_{i}^{2}+ \lambda\|f^{\star}\|_{\mathbf{k}}^{2},\]where the last inequality follows trivially from dropping the \(-\|\widehat{f}_{\mathrm{full},\lambda}\|_{\mathbf{k}}^{2}\) term. Thus,

\[\|\widehat{\Delta}_{\mathrm{KT}}\|_{n}^{2} =\tfrac{1}{n}\sum_{i=1}^{n}\xi_{i}^{2}+\lambda\|f^{\star}\|_{ \mathbf{k}}^{2}+\Big{[}L_{n}(\widehat{f}_{\mathrm{KT},\lambda^{\prime}})-L_{n}( \widehat{f}_{\mathrm{full},\lambda})\Big{]}+\tfrac{2}{n}\langle Z_{KT},\xi \rangle-\tfrac{1}{n}\sum_{i=1}^{n}\xi_{i}^{2}\] \[\leq\tfrac{2}{n}\langle Z_{KT},\xi\rangle+\lambda\|f^{\star}\|_{ \mathbf{k}}^{2}+\Big{[}L_{n}(\widehat{f}_{\mathrm{KT},\lambda^{\prime}})-L_{n}( \widehat{f}_{\mathrm{full},\lambda})\Big{]}. \tag{164}\]

Using standard arguments to bound the term \(\tfrac{2}{n}\langle Z_{KT},\xi\rangle\), we claim that on the event \(\mathcal{E}_{\widehat{\Delta}_{\mathrm{KT}}}\), we have

\[\|\widehat{\Delta}_{\mathrm{KT}}\|_{n}^{2}\leq ct^{2}(\|f^{\star}\|_{\mathbf{ k}}+1)^{2}+c^{\prime}\Big{[}L_{n}(\widehat{f}_{\mathrm{KT},\lambda^{\prime}})-L_ {n}(\widehat{f}_{\mathrm{full},\lambda})\Big{]} \tag{165}\]

for some positive constants \(c,c^{\prime}\), and that \(\mathbb{P}(\mathcal{E}_{\widehat{\Delta}_{\mathrm{KT}}}\mid\mathcal{S}_{\mathrm{ in}})\geq 1-e^{-\frac{nt^{2}}{2\sigma^{2}}}\). We defer the proof of claim (165) to the end of this section.

Now we bound the stochastic term \(\Big{[}L_{n}(\widehat{f}_{\mathrm{KT},\lambda^{\prime}})-L_{n}(\widehat{f}_{ \mathrm{full},\lambda})\Big{]}\) in (165)--first observe the following decomposition:

\[L_{n}(\widehat{f}_{\mathrm{KT},\lambda^{\prime}})-L_{n}(\widehat{f}_{\mathrm{ full},\lambda})=\Big{(}L_{n}(\widehat{f}_{\mathrm{KT},\lambda^{\prime}})-L_{n_{ \mathrm{out}}}(\widehat{f}_{\mathrm{KT},\lambda^{\prime}})\Big{)}+\Big{(}L_{n_ {\mathrm{out}}}(\widehat{f}_{\mathrm{KT},\lambda^{\prime}})-L_{n}(\widehat{f}_ {\mathrm{full},\lambda})\Big{)}.\]

On the event \(\mathcal{E}_{\mathrm{KT},\delta}\) (24), the first term in the display can be bounded by

\[L_{n}(\widehat{f}_{\mathrm{KT},\lambda^{\prime}})-L_{n_{\mathrm{out}}}( \widehat{f}_{\mathrm{KT},\lambda^{\prime}})\stackrel{{\eqref{eq: 165}}}{{\leq}}(\|\widehat{f}_{\mathrm{KT},\lambda^{\prime}}\|_{\mathbf{k}}^{2}+ 2)\;\eta_{n,\mathbf{k}}.\]

Note that \(\widehat{f}_{\mathrm{KT},\lambda^{\prime}}\) is the solution to the following optimization problem,

\[\min_{f\in\mathcal{H}(\mathbf{k})}L_{n_{\mathrm{out}}}(f)+\lambda^{\prime}\|f \|_{\mathbf{k}}^{2},\]

so the second term in the display can be bounded by the following basic inequality

\[L_{n_{\mathrm{out}}}(\widehat{f}_{\mathrm{KT},\lambda^{\prime}})+ \lambda^{\prime}\|\widehat{f}_{\mathrm{KT},\lambda^{\prime}}\|_{\mathbf{k}}^{ 2}\leq L_{n_{\mathrm{out}}}(\widehat{f}_{\mathrm{full},\lambda})+\lambda^{ \prime}\|\widehat{f}_{\mathrm{full},\lambda}\|_{\mathbf{k}}^{2}\] \[\text{so that}\quad L_{n_{\mathrm{out}}}(\widehat{f}_{\mathrm{KT}, \lambda^{\prime}})-L_{n_{\mathrm{out}}}(\widehat{f}_{\mathrm{full},\lambda}) \leq\lambda^{\prime}\Big{\{}\|\widehat{f}_{\mathrm{full},\lambda}\|_{\mathbf{k }}^{2}-\|\widehat{f}_{\mathrm{KT},\lambda^{\prime}}\|_{\mathbf{k}}^{2}\Big{\}}.\]

Thus, on event \(\mathcal{E}_{\mathrm{KT},\delta}\), we have

\[L_{n}(\widehat{f}_{\mathrm{KT},\lambda^{\prime}})-L_{n}(\widehat{f}_{ \mathrm{full},\lambda}) \leq(\|\widehat{f}_{\mathrm{KT},\lambda^{\prime}}\|_{\mathbf{k}}^ {2}+2)\;\eta_{n,\mathbf{k}}+\lambda^{\prime}\Big{\{}\|\widehat{f}_{\mathrm{full},\lambda}\|_{\mathbf{k}}^{2}-\|\widehat{f}_{\mathrm{KT},\lambda^{\prime}}\|_{ \mathbf{k}}^{2}\Big{\}}\] \[=2\eta_{n,\mathbf{k}}+\lambda^{\prime}\|\widehat{f}_{\mathrm{ full},\lambda}\|_{\mathbf{k}}^{2}+\{\eta_{n,\mathbf{k}}-\lambda^{\prime}\}\cdot\| \widehat{f}_{\mathrm{KT},\lambda^{\prime}}\|_{\mathbf{k}}^{2}\] \[\stackrel{{(i)}}{{\leq}}2\eta_{n,\mathbf{k}}+ \lambda^{\prime}\|\widehat{f}_{\mathrm{full},\lambda}\|_{\mathbf{k}}^{2}\stackrel{{ (ii)}}{{\leq}}\lambda^{\prime}(\|\widehat{f}_{\mathrm{full},\lambda}\|_{ \mathbf{k}}^{2}+1)\]

where steps (i) and (ii) both follow from the fact that \(\lambda^{\prime}\geq 2\eta_{n,\mathbf{k}}\) (see assumptions in Thm. 6). To bound \(\|\widehat{f}_{\mathrm{full},\lambda}\|_{\mathbf{k}}^{2}\), we use the following lemma:

**Lemma 13** (RKHS norm of \(\widehat{f}_{\mathrm{full},\lambda}\)).: _On event \(\mathcal{E}_{\mathrm{full},n}\) (161), we have the following bound_

\[\|\widehat{f}_{\mathrm{full},\lambda}\|_{\mathbf{k}}^{2}\leq c_{0}(\|f^{\star} \|_{\mathbf{k}}+1)^{2} \tag{166}\]

_for some constant \(c_{0}>0\)._

See App. F.2 for the proof. Putting things together, we have

\[L_{n}(\widehat{f}_{\mathrm{KT},\lambda^{\prime}})-L_{n}(\widehat{f}_{\mathrm{ full},\lambda})\leq c\lambda^{\prime}(\|f^{\star}\|_{\mathbf{k}}+1)^{2}\]

for some constant \(c\)--substituting this bound into (165) yields

\[\|\widehat{f}_{\mathrm{KT},\lambda^{\prime}}-f^{\star}\|_{n}^{2}\leq ct^{2}(\|f^{ \star}\|_{\mathbf{k}}+1)^{2}+c^{\prime}\lambda^{\prime}(\|f^{\star}\|_{\mathbf{ k}}+1)^{2},\]

for some constants \(c,c^{\prime}\), which directly implies (159), i.e. implying

\[\{\mathcal{E}_{\mathrm{full},n}(t)\cap\mathcal{E}_{\mathrm{KT},\delta}\cap \mathcal{E}_{\widehat{\Delta}_{\mathrm{KT}}}(t)\}\quad\Longrightarrow\quad \mathcal{E}_{\mathrm{KT},n}(t).\]Proof of claim (162).Given \(f\), define the function

\[\ell^{\prime}_{f}:\mathcal{X}\times\mathcal{Y}\to\mathbb{R},\quad\text{where}\quad \ell^{\prime}_{f}(x,y)\triangleq f^{2}(x)-2y\cdot f(x) \tag{167}\]

and note that

\[L_{n}(f)-L_{n_{\text{out}}}(f)=\tfrac{1}{n}\sum_{i=1}^{n}\ell^{\prime}_{f}(x_{ i},y_{i})-\tfrac{1}{n_{\text{out}}}\sum_{i=1}^{n_{\text{out}}}\ell^{\prime}_{f}(x^ {\prime}_{i},y^{\prime}_{i}).\]

We first prove a generic technical lemma:

**Lemma 14** (KT-Compress++ approximation bound using \(\mathbf{k}_{\mathrm{RR}}\)).: _Suppose \(f_{1},f_{2}\in\mathcal{H}(\mathbf{k})\) and \(a,b\in\mathbb{R}\). Then the function_

\[\ell_{f_{1},f_{2}}:\mathcal{X}\times\mathcal{Y}\to\mathbb{R},\quad\text{where} \quad\ell_{f_{1},f_{2}}(x,y)\triangleq a\cdot f_{1}(x)f_{2}(x)+b\cdot yf_{1}(x) \tag{168}\]

_lies in the RKHS \(\mathcal{H}(\mathbf{k}_{\mathrm{RR}})\). Moreover, on event \(\mathcal{E}_{\mathcal{KT},\delta}\), we have_

\[\mathbb{P}_{\mathrm{in}}\ell_{f_{1},f_{2}}-\mathbb{Q}_{\mathrm{out}}\ell_{f_{1 },f_{2}}\leq(|a|\cdot\|f_{1}\|_{\mathbf{k}}\|f_{2}\|_{\mathbf{k}}+|b|\cdot\|f _{2}\|_{\mathbf{k}})\cdot\eta_{n,\mathbf{k}}.\]

_uniformly for all non-zero \(f_{1},f_{2}\in\mathcal{H}(\mathbf{k})\)._

See App. F.3 for the proof. Applying the lemma with \(f_{1}\triangleq f,f_{2}\triangleq g\) and \(a=1,b=-2\), we have

\[\mathbb{P}_{\mathrm{in}}\ell^{\prime}_{f}-\mathbb{Q}_{\mathrm{out}}\ell^{\prime }_{f}\leq(\|f\|_{\mathbf{k}}^{2}+2)\cdot\eta_{n,\mathbf{k}},\]

which combined with the observation (168) yields the desired claim.

Proof of claim (165).Case I: First suppose that \(\|\widehat{\Delta}_{\mathrm{KT}}\|_{\mathbf{k}}\leq 1\). Recall that \(\|\widehat{\Delta}_{\mathrm{KT}}\|_{n}\geq t\geq\varepsilon_{n}\) by assumption. Thus, we may apply [29, Lem. 13.12] to obtain

\[\tfrac{1}{n}\langle Z_{KT},\mathbf{\xi}\rangle\leq 2\|\widehat{\Delta}_{\mathrm{ KT}}\|_{n}t\quad\text{w.p. at least}\quad 1-e^{-\frac{nt^{2}}{2\sigma^{2}}} \tag{169}\]

Plugging the above bound into (164), we have with probability at least \(1-e^{-\frac{nt^{2}}{2\sigma^{2}}}\):

\[\|\widehat{\Delta}_{\mathrm{KT}}\|_{n}^{2}\leq 4\|\widehat{\Delta}_{\mathrm{ KT}}\|_{n}t+\lambda\|f^{\star}\|_{\mathbf{k}}^{2}+\Big{[}L_{n}(\widehat{f}_{ \mathrm{KT},\lambda^{\prime}})-L_{n}(\widehat{f}_{\mathrm{full},\lambda}) \Big{]}.\]

We can solve for \(\|\widehat{\Delta}_{\mathrm{KT}}\|_{n}\) using the quadratic formula. Specifically, if \(a,b\geq 0\) and \(x^{2}-ax-b\leq 0\), then \(x\leq a+\sqrt{b}\). Thus, we have with probability at least \(1-e^{-\frac{nt^{2}}{2\sigma^{2}}}\):

\[\|\widehat{\Delta}_{\mathrm{KT}}\|_{n} \leq a+\sqrt{b},\quad\text{where}\] \[a \triangleq 4t\quad\text{and}\] \[b \triangleq\lambda\|f^{\star}\|_{\mathbf{k}}^{2}+\Big{[}L_{n}( \widehat{f}_{\mathrm{KT},\lambda^{\prime}})-L_{n}(\widehat{f}_{\mathrm{full},\lambda})\Big{]}.\]

Using the fact that \((a+\sqrt{b})^{2}\leq 2a^{2}+2b\), we have with probability at least \(1-e^{-\frac{nt^{2}}{2\sigma^{2}}}\):

\[\|\widehat{f}_{\mathrm{KT},\lambda^{\prime}}-f^{\star}\|_{n}^{2} \leq 32t^{2}+2\lambda\|f^{\star}\|_{\mathbf{k}}^{2}+2\Big{[}L_{n}( \widehat{f}_{\mathrm{KT},\lambda^{\prime}})-L_{n}(\widehat{f}_{\mathrm{full},\lambda})\Big{]}\] \[\stackrel{{\eqref{eq:def1}}}{{\leq}}ct^{2}(\|f^{ \star}\|_{\mathbf{k}}+1)^{2}+2\Big{[}L_{n}(\widehat{f}_{\mathrm{KT},\lambda^{ \prime}})-L_{n}(\widehat{f}_{\mathrm{full},\lambda})\Big{]}\]

Case II: Otherwise, we may assume that \(\|\widehat{\Delta}_{\mathrm{KT}}\|_{\mathbf{k}}>1\). Now we apply [29, Thm. 13.23] to obtain

\[\tfrac{1}{n}\langle Z_{KT},\mathbf{\xi}\rangle\leq 2t\|\widehat{\Delta}_{\mathrm{ KT}}\|_{n}+2t^{2}\|\widehat{\Delta}_{\mathrm{KT}}\|_{\mathbf{k}}+\tfrac{1}{16}\| \widehat{\Delta}_{\mathrm{KT}}\|_{n}^{2}\quad\text{w.p. at least}\quad 1-c_{1}e^{-\frac{nt^{2}}{c_{2}\sigma^{2}}}, \tag{170}\]

for some universal positive constants \(c_{1},c_{2}\). Plugging the above bound into (164) and collecting terms, we have with probability at least \(1-c_{1}e^{-\frac{nt^{2}}{c_{2}\sigma^{2}}}\):

\[\tfrac{7}{8}\|\widehat{\Delta}_{\mathrm{KT}}\|_{n}^{2}\leq 4t\|\widehat{\Delta}_{ \mathrm{KT}}\|_{n}+4t^{2}\|\widehat{\Delta}_{\mathrm{KT}}\|_{\mathbf{k}}+ \lambda\|f^{\star}\|_{\mathbf{k}}^{2}+\Big{[}L_{n}(\widehat{f}_{\mathrm{KT}, \lambda^{\prime}})-L_{n}(\widehat{f}_{\mathrm{full},\lambda})\Big{]}.\]Solving for \(\|\widehat{\Delta}_{\rm KT}\|_{n}\) using the quadratic formula, we have with probability at least \(1-c_{1}e^{-\frac{nt^{2}}{c_{2}\sigma^{2}}}\):

\[\|\widehat{\Delta}_{\rm KT}\|_{n} \leq a+\sqrt{b},\quad\text{where}\] \[a \triangleq\tfrac{32}{7}t\quad\text{and}\] \[b \triangleq\tfrac{32}{7}t^{2}\|\widehat{\Delta}_{\rm KT}\|_{\bf k} ^{2}+\tfrac{8}{7}\lambda\|f^{\star}\|_{\bf k}^{2}+\tfrac{8}{7}\Big{[}L_{n}( \widehat{f}_{\rm KT,\lambda^{\prime}})-L_{n}(\widehat{f}_{\rm full,\lambda}) \Big{]}.\]

Using the fact that \((a+\sqrt{b})^{2}\leq 2a^{2}+2b\), we have with probability at least \(1-c_{1}e^{-\frac{nt^{2}}{c_{2}\sigma^{2}}}\):

\[\|\widehat{f}_{\rm KT,\lambda^{\prime}}-f^{\star}\|_{n}^{2} \leq 42t^{2}+10t^{2}\|\widehat{\Delta}_{\rm KT}\|_{\bf k}^{2}+2. 3\lambda\|f^{\star}\|_{\bf k}^{2}+2.3\Big{[}L_{n}(\widehat{f}_{\rm KT,\lambda^ {\prime}})-L_{n}(\widehat{f}_{\rm full,\lambda})\Big{]}\] \[\overset{(i)}{\leq}42t^{2}+10t^{2}\|\widehat{\Delta}_{\rm KT}\|_ {\bf k}^{2}+4.6t^{2}\|f^{\star}\|_{\bf k}^{2}+2.3\Big{[}L_{n}(\widehat{f}_{\rm KT,\lambda^{\prime}})-L_{n}(\widehat{f}_{\rm full,\lambda})\Big{]}\] \[\overset{(155)(166)}{\leq}c_{3}t^{2}(\|f^{\star}\|_{\bf k}+1)^{2} +c_{4}\Big{[}L_{n}(\widehat{f}_{\rm KT,\lambda^{\prime}})-L_{n}(\widehat{f}_{ \rm full,\lambda})\Big{]}\]

for some positive constants \(c_{3},c_{4}\), where step (i) follows from that fact that \(\lambda=2e_{n}^{2}\) by (155).

### Proof of Lem. 13: RKHS norm of \(\widehat{f}_{\rm full,\lambda}\)

Given the optimality of \(\widehat{f}_{\rm full,\lambda}\) on the objective (3), we have the following basic inequality

\[L_{n}(\widehat{f}_{\rm full,\lambda})+\lambda\|\widehat{f}_{\rm full,\lambda}\|_{\bf k}^{2}\leq\tfrac{1}{n}\sum_{i=1}^{n}\xi_{i}^{2}+\lambda\|f^{ \star}\|_{\bf k}^{2}\] \[\implies\|\widehat{f}_{\rm full,\lambda}\|_{\bf k}^{2}\leq\|f^{ \star}\|_{\bf k}^{2}+\tfrac{1}{\lambda}\Big{(}\tfrac{1}{n}\sum_{i=1}^{n}\xi_{i }^{2}-L_{n}(\widehat{f}_{\rm full,\lambda})\Big{)}.\]

Since \(\|\widehat{f}_{\rm full,\lambda}-f^{\star}\|_{n}^{2}\geq 0\), we also have the trivial lower bound

\[L_{n}(\widehat{f}_{\rm full,\lambda}) \overset{(163)}{=}\|\widehat{f}_{\rm full,\lambda}-f^{\star}\|_{ n}^{2}-\tfrac{2}{n}\langle Z_{full},\boldsymbol{\xi}\rangle+\tfrac{1}{n}\sum_{ i=1}^{n}\xi_{i}^{2}\] \[\geq-\tfrac{2}{n}\langle Z_{full},\boldsymbol{\xi}\rangle+\tfrac {1}{n}\sum_{i=1}^{n}\xi_{i}^{2}.\]

Thus,

\[\|\widehat{f}_{\rm full,\lambda}\|_{\bf k}^{2}\leq\|f^{\star}\|_{ \bf k}^{2}+\tfrac{1}{\lambda}\big{(}\tfrac{2}{n}\langle Z_{full},\xi\rangle \big{)} \tag{171}\]

and it remains to bound \(\tfrac{2}{n}\langle Z_{full},\xi\rangle\).

Case I:First, suppose that \(\|\widehat{\Delta}_{\rm full}\|_{\bf k}>1\). Then we may apply [29, Lem. 13.23] to obtain

\[\tfrac{1}{n}\langle Z_{full},\xi\rangle\leq 2\varepsilon_{n}\|\widehat{ \Delta}_{\rm full}\|_{n}+2\varepsilon_{n}^{2}\|\widehat{\Delta}_{\rm full}\|_{ \bf k}+\tfrac{1}{16}\|\widehat{\Delta}_{\rm full}\|_{n}^{2}\quad\text{w.p. at least}\quad 1-c_{1}e^{-\frac{nt^{2}_{n}}{c_{2}\sigma^{2}}}.\]

Combining this bound with (171), we have with probability at least \(1-c_{1}e^{-\frac{nt^{2}_{n}}{c_{2}\sigma^{2}}}\):

\[\|\widehat{f}_{\rm full,\lambda}\|_{\bf k}^{2} \leq\|f^{\star}\|_{\bf k}^{2}+\tfrac{2\varepsilon_{n}^{2}}{ \lambda}\|\widehat{\Delta}_{\rm full}\|_{\bf k}+\tfrac{2}{\lambda}\Big{(}2 \varepsilon_{n}\|\widehat{\Delta}_{\rm full}\|_{n}+\tfrac{1}{16}\|\widehat{ \Delta}_{\rm full}\|_{n}^{2}\Big{)}\] \[\overset{(i)}{\leq}\|f^{\star}\|_{\bf k}^{2}+\tfrac{2\varepsilon _{n}^{2}}{\lambda}(\|\widehat{f}_{\rm full,\lambda}\|_{\bf k}+\|f^{\star}\|_{ \bf k})+\tfrac{2}{\lambda}\Big{(}2\varepsilon_{n}\|\widehat{\Delta}_{\rm full} \|_{n}+\tfrac{1}{16}\|\widehat{\Delta}_{\rm full}\|_{n}^{2}\Big{)}\] \[\overset{(155)}{=}\|f^{\star}\|_{\bf k}^{2}+\|\widehat{f}_{\rm full,\lambda}\|_{\bf k}+\|f^{\star}\|_{\bf k}+\tfrac{2}{\lambda}\Big{(}2\varepsilon _{n}\|\widehat{\Delta}_{\rm full}\|_{n}+\tfrac{1}{16}\|\widehat{\Delta}_{\rm full }\|_{n}^{2}\Big{)},\]

where step (i) follows from triangle inequality. Solving for \(\|\widehat{f}_{\rm full,\lambda}\|_{\bf k}\) using the quadratic formula, we have

\[\|\widehat{f}_{\rm full,\lambda}\|_{\bf k}^{2}\leq 2+\|f^{\star}\|_{\bf k}^{2}+\|f^{ \star}\|_{\bf k}+\tfrac{2}{\lambda}\Big{(}2\varepsilon_{n}\|\widehat{\Delta}_{ \rm full}\|_{n}+\tfrac{1}{16}\|\widehat{\Delta}_{\rm full}\|_{n}^{2}\Big{)}.\]

On the event \(\mathcal{E}_{\rm full,\,n}\) (161), we have \(\|\widehat{\Delta}_{\rm full}\|_{n}\leq c\|f^{\star}\|_{\bf k}\varepsilon_{n}\) for some positive constant \(c\), which implies the claimed bound (166) after some algebra.

Case II(a): Otherwise, assume \(\|\widehat{\Delta}_{\rm full}\|_{\mathbf{k}}\leq 1\) and \(\|\widehat{\Delta}_{\rm full}\|_{n}\leq\varepsilon_{n}\). Applying [29, Thm. 2.26] to the function \(\sup\limits_{\begin{subarray}{c}\|g\|_{\mathbf{k}}\leq 1\\ \|g\|_{n}\leq\varepsilon_{n}\end{subarray}}\big{|}\frac{1}{n}\sum_{i=1}^{n} \xi_{i}g(x_{i})\big{|}\), we have

\[\frac{1}{n}\langle Z_{full},\boldsymbol{\xi}\rangle\leq\frac{\varepsilon_{n}^{ 2}}{2}\quad\text{w.p. at least}\quad 1-e^{-\frac{n\varepsilon_{n}^{2}}{8 \sigma^{2}}}\]

Combining this bound with (171), we obtain

\[\|\widehat{f}_{\rm full,\lambda}\|_{\mathbf{k}}^{2}\leq\|f^{\star}\|_{\mathbf{ k}}^{2}+\tfrac{1}{\lambda}\varepsilon_{n}^{2}\stackrel{{\eqref{eq:f_full}}}{{=}}\|f^{ \star}\|_{\mathbf{k}}^{2}+\tfrac{1}{2},\]

which immediately implies the claimed bound (166).

Case II(b): Finally, assume \(\|\widehat{\Delta}_{\rm full}\|_{\mathbf{k}}\leq 1\) and \(\|\widehat{\Delta}_{\rm full}\|_{n}>\varepsilon_{n}\). Applying [29, Lem. 13.12] with \(u=\varepsilon_{n}\), we have

\[\tfrac{1}{n}\langle Z_{full},\boldsymbol{\xi}\rangle\leq 2\varepsilon^{2} \quad\text{w.p. at least}\quad 1-e^{-\frac{n\varepsilon_{n}^{2}}{2\sigma^{2}}}.\]

Combining this bound with (171), we obtain

\[\|\widehat{f}_{\rm full,\lambda}\|_{\mathbf{k}}^{2}\leq\|f^{\star}\|_{\mathbf{ k}}^{2}+\tfrac{4}{\lambda}\varepsilon_{n}^{2}\stackrel{{\eqref{eq:f_full}}}{{=}}\|f^{ \star}\|_{\mathbf{k}}^{2}+2,\]

which immediately implies the claimed bound (166).

### Proof of Lem. 14: KT-Compress++ approximation bound using \(\mathbf{k}_{\rm RR}\)

By Grunewalder [12, Lem. 4], \(\ell_{f_{1},f_{2}}\) lies in the RKHS \(\mathcal{H}(\mathbf{k}_{\rm RR})\), which is a direct sum of two RKHS:

\[\mathcal{H}(\mathbf{k}_{\rm RR})=\mathcal{H}(\mathbf{k}_{1})\oplus\mathcal{H}( \mathbf{k}_{2}),\]

where \(\mathbf{k}_{1},\mathbf{k}_{2}:\mathcal{Z}\times\mathcal{Z}\to\mathbb{R}\) are the kernels defined by

\[\mathbf{k}_{1}((x_{1},y_{1}),(x_{2},y_{2}))\triangleq\mathbf{k}^{2}(x_{1},x_{ 2})\quad\text{and}\quad\mathbf{k}_{2}((x_{1},y_{1}),(x_{2},y_{2}))\triangleq \mathbf{k}(x_{1},x_{2})\cdot y_{1}y_{2}.\]

Applying Lem. 2 with

\[\mathcal{Z}=\mathcal{X}\times\mathcal{Y},\quad\mathbf{k}_{\text{ ALG}}=\mathbf{k}_{\rm RR},\quad\text{and}\quad\epsilon^{\star}=\frac{(\| \mathbf{k}\|_{\infty,in}^{1/2}+Y_{\max})^{2}}{n_{\rm out}},\]

yields the following bound on event \(\mathcal{E}_{\rm KT,\delta}\) (24):

\[\sup\limits_{\begin{subarray}{c}h\in\mathcal{H}(\mathbf{k}_{\rm RR}):\\ \|h\|_{\mathbf{k}_{\rm RR}}\leq 1\end{subarray}}\hskip-1.0pt|(\mathbb{P}_{ \text{in}}-\mathbb{Q}_{\rm out})h|\leq 2\epsilon^{\star}+\frac{\|\mathbf{k}_{\rm RR }\|_{\infty,in}^{1/2}}{n_{\rm out}}\cdot\mathfrak{W}_{\mathbf{k}_{\rm RR}}(n, n_{\rm out},\delta,\mathfrak{R}_{\text{in}},\epsilon^{\star}).\]

We claim that

\[\|\mathbf{k}_{\rm RR}\|_{\infty,\text{in}}^{1/2}\leq\|\mathbf{k}\|_{\infty, \text{in}}+Y_{\max}^{2}\quad\text{and} \tag{172}\]

\[\log\mathcal{N}_{\mathbf{k}_{\rm RR}}^{\dagger}(\mathcal{S}_{\text{in}}, \epsilon^{\star})\leq c\cdot\log\mathcal{N}_{\mathbf{k}}(\mathcal{S}_{\text{ in}},\tfrac{\|\mathbf{k}\|_{\infty,\text{in}}^{1/2}+Y_{\max}}{n_{\rm out }}), \tag{173}\]

for some positive constant \(c\), where \(\mathcal{N}_{\mathbf{k}_{\rm RR}}^{\dagger}\) is the cardinality of the cover of \(\mathcal{B}_{\mathbf{k}_{\rm RR}}^{\dagger}\triangleq\left\{\ell_{f}^{\prime} /\|\ell_{f}^{\prime}\|_{\mathbf{k}_{\rm RR}}:f\in\mathcal{H}(\mathbf{k})\right\}\) for \(\ell_{f}^{\prime}\) defined by (167). Proof of the claims (172) and (173) are deferred to the end of this section. By definition of \(\mathfrak{W}_{\mathbf{k}_{\rm RR}}\), we have

\[\mathfrak{W}_{\mathbf{k}_{\rm RR}}(n,n_{\rm out},\delta,\mathfrak{R}_{\text{in }},\epsilon^{\star})\stackrel{{\eqref{eq:f_full}}}{{\leq}} \sqrt{c}\cdot\mathfrak{W}_{\mathbf{k}}(n,n_{\rm out},\delta,\mathfrak{R}_{ \text{in}},\tfrac{\|\mathbf{k}\|_{\infty,\text{in}}^{1/2}+Y_{\max}}{n_{\rm out }})\triangleq\mathfrak{W}_{\mathbf{k}}^{\prime}.\]

On event \(\mathcal{E}_{\rm KT,\delta}\), we have

\[\sup\limits_{\begin{subarray}{c}h\in\mathcal{H}(\mathbf{k}_{\rm RR }):\\ \|h\|_{\mathbf{k}_{\rm RR}}\leq 1\end{subarray}}\hskip-1.0pt|(\mathbb{P}_{\text{in}}- \mathbb{Q}_{\rm out})h|\leq\frac{2(\|\mathbf{k}\|_{\infty,\text{in}}^{1/2}+Y_{ \max})^{2}}{n_{\rm out}}+\frac{\|\mathbf{k}\|_{\infty,\text{in}}+Y_{\max}^{2}}{n _{\rm out}}\cdot\mathfrak{W}_{\mathbf{k}}^{\prime}\] \[\stackrel{{\eqref{eq:f_full}}}{{=}}\frac{\|\mathbf{k}\|_{ \infty,\text{in}}+Y_{\max}^{2}}{n_{\rm out}}\cdot[2+\mathfrak{W}_{\mathbf{k}}^{ \prime}], \tag{174}\]

where step (i) follows from the fact that \((\|\mathbf{k}\|_{\infty,\text{in}}^{1/2}+Y_{\max})^{2}\leq 2(\|\mathbf{k}\|_{\infty, \text{in}}+Y_{\max}^{2})\).

Since \(f_{1},f_{2}\) are non-zero, we have \(\|\ell_{f_{1},f_{2}}\|_{\mathbf{k}}>0\). Thus, the function \(h\triangleq\ell_{f}/\|\ell_{f}\|_{\mathbf{k}_{\mathrm{RR}}}\in\mathcal{H}( \mathbf{k}_{\mathrm{RR}})\) is well-defined and satisfies \(\|h\|_{\mathbf{k}_{\mathrm{RR}}}=1\). Applying (174), we obtain

\[|\mathbb{P}_{\mathrm{in}}h-\mathbb{Q}_{\mathrm{out}}h| \leq\frac{\|\mathbf{k}\|_{\infty,\mathrm{in}}+Y_{\mathrm{max}}^{2} }{n_{\mathrm{out}}}\cdot(2+\mathfrak{W}_{\mathbf{k}}^{\prime})\quad\text{on event}\quad\mathcal{E}_{\mathrm{KT},\delta}.\]

Multiplying both sides by \(\|\ell_{f}\|_{\mathbf{k}_{\mathrm{RR}}}\) and noting that

\[\|\ell_{f,g}\|_{\mathbf{k}_{\mathrm{RR}}}^{2} =\|a\cdot f_{1}f_{2}\|_{\overline{\mathcal{H}}\cap\overline{ \mathcal{H}}}^{2}+\|b\cdot f_{2}\otimes\langle\cdot,1\rangle_{\mathbb{R}}\|_{ \mathcal{H}\otimes\mathcal{R}}^{2}\] \[\leq a^{2}\|f_{1}\|_{\mathbf{k}}^{2}\|f_{2}\|_{\mathbf{k}}^{2}+b ^{2}\|f_{2}\|_{\mathbf{k}}^{2}\] \[\leq(|a|\cdot\|f_{1}\|_{\mathbf{k}}\|f_{2}\|_{\mathbf{k}}+|b| \cdot\|f_{2}\|_{\mathbf{k}})^{2},\]

we have on event \(\mathcal{E}_{\mathrm{KT},\delta}\),

\[\mathbb{P}_{\mathrm{in}}\ell_{f_{1},f_{2}}-\mathbb{Q}_{\mathrm{out}}\ell_{f_{1 },f_{2}}\leq(|a|\cdot\|f_{1}\|_{\mathbf{k}}\|f_{2}\|_{\mathbf{k}}+|b|\cdot\|f_ {2}\|_{\mathbf{k}})\cdot\frac{\|\mathbf{k}\|_{\infty,\mathrm{in}}+Y_{\mathrm{ max}}^{2}}{n_{\mathrm{out}}}\cdot(2+\mathfrak{W}_{\mathbf{k}}^{\prime}),\]

which directly implies the bound (162) after applying the shorthand (102).

Proof of (172)Define \(Y_{\mathrm{max}}\triangleq\sup_{y\in(\mathcal{S}_{\mathrm{in}})_{y}}y\). We have

\[\|\mathbf{k}_{\mathrm{ALG}}\|_{\infty,\mathrm{in}} =\sup_{(x_{1},y_{1}),(x_{2},y_{2})\in\mathcal{S}_{\mathrm{in}}} \{\mathbf{k}(x_{1},x_{2})^{2}+\mathbf{k}(x_{1},x_{2})\cdot y_{1}y_{2}+(y_{1}y_ {2})^{2}\}\] \[\leq\sup_{x_{1},x_{2}\in(\mathcal{S}_{\mathrm{in}})_{x}}\mathbf{k} (x_{1},x_{2})^{2}+\sup_{x_{1},x_{2}\in(\mathcal{S}_{\mathrm{in}})_{x}}\mathbf{ k}(x_{1},x_{2})\cdot\sup_{y_{1},y_{2}\in(\mathcal{S}_{\mathrm{in}})_{y}}y_{1}y_{2}\] \[\quad+\sup_{y_{1},y_{2}\in(\mathcal{S}_{\mathrm{in}})_{y}}(y_{1}y _{2})^{2}\] \[=\|\mathbf{k}\|_{\infty,\mathrm{in}}^{2}+\|\mathbf{k}\|_{\infty, \mathrm{in}}\cdot Y_{\mathrm{max}}^{2}+Y_{\mathrm{max}}^{4}\] \[\leq\left(\|\mathbf{k}\|_{\infty,\mathrm{in}}+Y_{\mathrm{max}}^{2 }\right)^{2}.\]

Proof of (173)Since \(\mathcal{H}(\mathbf{k}_{\mathrm{RR}})\) is a direct sum, we have

\[\log\mathcal{N}_{\mathbf{k}_{\mathrm{RR}}}^{\dagger}(\mathcal{S}_{\mathrm{in}},\epsilon^{\star})\leq\log\mathcal{N}_{\mathbf{k}_{1}}^{\dagger}(\mathcal{S}_{ \mathrm{in}},\epsilon^{\star}/2)+\log\mathcal{N}_{\mathbf{k}_{2}}^{\dagger}( \mathcal{S}_{\mathrm{in}},\epsilon^{\star}/2), \tag{175}\]

where \(\mathcal{N}_{\mathbf{k}_{1}}^{\dagger}\) and \(\log\mathcal{N}_{\mathbf{k}_{2}}^{\dagger}\) are the covering numbers of \(\mathcal{B}_{\mathbf{k}_{1}}^{\dagger}\triangleq\left\{f^{2}/\|f^{2}\|_{ \mathbf{k}_{1}}:f\in\mathcal{H}(\mathbf{k})\right\}\) and \(\mathcal{B}_{\mathbf{k}_{2}}^{\dagger}\triangleq\left\{f\otimes\langle\cdot,y \rangle_{\mathbb{R}}/\|f\otimes\langle\cdot,y\rangle_{\mathbb{R}}\|_{\mathbf{ k}_{2}}:f\otimes\langle\cdot,y\rangle_{\mathbb{R}}\in\mathcal{H}(\mathbf{k}_{2})\right\}\), respectively.

Note that

\[\log\mathcal{N}_{\mathbf{k}_{1}}^{\dagger}(\mathcal{S}_{\mathrm{in}},\epsilon^{\star}) \leq 2\log\mathcal{N}_{\mathbf{k}}(\mathcal{S}_{\mathrm{in}}, \epsilon^{\star}/(2\|\mathbf{k}\|_{\infty}^{1/2}))\] \[\leq 2\log\mathcal{N}_{\mathbf{k}}(\mathcal{S}_{\mathrm{in}},(1+ \frac{Y_{\mathrm{max}}}{\|\mathbf{k}\|_{\infty,\mathrm{in}}^{1/2}})\frac{\| \mathbf{k}\|_{\infty,\mathrm{in}}^{1/2}+Y_{\mathrm{max}}}{2n_{\mathrm{out}}})\] \[\leq 2\log\mathcal{N}_{\mathbf{k}}(\mathcal{S}_{\mathrm{in}}, \frac{\|\mathbf{k}\|_{\infty,\mathrm{in}}^{1/2}+Y_{\mathrm{max}}}{2n_{\mathrm{ out}}}).\]

Define a kernel on \(\mathbb{R}\) by \(\mathbf{k}_{\mathbb{R}}(y_{1},y_{2})\triangleq y_{1}y_{2}\). When \(\sup_{y\in(\mathcal{S}_{\mathrm{in}})_{y}}|y|\leq Y_{\mathrm{max}}\), we have

\[\mathcal{N}_{\mathrm{ka}}([-Y_{\mathrm{max}},Y_{\mathrm{max}}],\epsilon)= \mathcal{O}(Y_{\mathrm{max}}^{2}/\epsilon)\quad\text{for}\quad\epsilon>0.\]

Similarly, note that

\[\log\mathcal{N}_{\mathbf{k}_{2}}^{\dagger}(\mathcal{S}_{\mathrm{in}},\epsilon^{\star}) \leq\log\mathcal{N}_{\mathbf{k}}(\mathcal{S}_{\mathrm{in}}, \epsilon^{\star}/(\|\mathbf{k}\|_{\infty}^{1/2}+\|\mathbf{k}_{\mathbb{R}}\|_{ \infty}^{1/2}))+\log\mathcal{N}_{\mathrm{ka}}(\mathcal{S}_{\mathrm{in}},\epsilon^ {\star}/(\|\mathbf{k}\|_{\infty,\mathrm{in}}^{1/2}+\|\mathbf{k}_{\mathbb{R}}\|_{ \infty}^{1/2}))\] \[\lesssim\log\mathcal{N}_{\mathbf{k}}(\mathcal{S}_{\mathrm{in}}, \frac{\|\mathbf{k}\|_{\infty,\mathrm{in}}^{1/2}+Y_{\mathrm{max}}}{n_{\mathrm{ out}}})+\log\Bigl{(}\frac{Y_{\mathrm{max}}^{2}(\|\mathbf{k}\|_{\infty, \mathrm{in}}^{1/2}+Y_{\mathrm{max}})}{n_{\mathrm{out}}}\Bigr{)}\]

Substituting the above two log-covering number expressions into (175) yields

\[\log\mathcal{N}_{\mathbf{k}_{\mathrm{Aac}}}(\mathcal{S}_{\mathrm{in}},\epsilon^{\star}) \lesssim 3\log\mathcal{N}_{\mathbf{k}}(\mathcal{S}_{\mathrm{in}}, \frac{\|\mathbf{k}\|_{\infty,\mathrm{in}}^{1/2}+Y_{\mathrm{max}}}{n_{\mathrm{ out}}})+\log\Bigl{(}\frac{Y_{\mathrm{max}}^{2}(\|\mathbf{k}\|_{\infty, \mathrm{in}}^{1/2}+Y_{\mathrm{max}})}{n_{\mathrm{out}}}\Bigr{)}.\] \[\leq c\cdot\log\mathcal{N}_{\mathbf{k}}(\mathcal{S}_{\mathrm{in}},\frac{\|\mathbf{k}\|_{\infty,\mathrm{in}}^{1/2}+Y_{\mathrm{max}}}{n_{\mathrm{ out}}})\]

for some universal positive constant \(c\).

Non-compact kernels satisfying Assum. 2

The boundedness, Lipschitz assumption, square-integrability, and (15) follow from [10, App. O] and [10, Rmk. 8]. Thus, it only remains to verify (16) and (17) for each kernel.

### Gaussian

For the kernel by \(\mathbf{k}(x_{1},x_{2})\triangleq\exp(-\frac{\|x_{1}-x_{2}\|^{2}}{2h^{2}})\), we have \(\kappa(u)\triangleq\exp(-u^{2}/2)\).

Verifying (16).For any \(j\geq 1\) and \(x\in\mathcal{X}\), we have

\[\int_{\|z\|\in[(2^{j-1}-\frac{1}{2})h,(2^{j}+\frac{1}{2})h]} \,\mathbf{k}(x,x-z)dz \leq\int_{\|z\|\geq(2^{j-1}-\frac{1}{2})h}\,\mathbf{k}(x,x-z)dz\] \[=\big{(}2\pi h^{2}\big{)}^{d/2}\mathbb{P}_{X\sim\mathcal{N}(0,h^ {2}\mathbf{I}_{d})}\big{[}\|X\|_{2}\geq(2^{j-1}-\frac{1}{2})h\big{]}\] \[=\big{(}2\pi h^{2}\big{)}^{d/2}\mathbb{P}_{X\sim\mathcal{N}(0, \mathbf{I}_{d})}\big{[}\|X\|_{2}^{2}\geq(2^{j-1}-\frac{1}{2})^{2}\big{]}\] \[=\big{(}2\pi h^{2}\big{)}^{d/2}\mathbb{P}_{X\sim\mathcal{N}(0, \mathbf{I}_{d})}\big{[}\|X\|_{2}^{2}-d\geq(2^{j-1}-\frac{1}{2})^{2}-d\big{]}. \tag{176}\]

By [15, Lem. 1], we have

\[\mathbb{P}_{X\sim\mathcal{N}(0,\mathbf{I}_{d})}\Big{[}\|X\|_{2}^{2}-d>2\sqrt{ dt}+2t\Big{]}\leq e^{-t}\quad\text{for any}\quad t\geq 0. \tag{177}\]

Define \(t\triangleq 2d\) and \(R\triangleq 2\sqrt{t}\). We can directly verify that \(R^{2}-d\geq 2\sqrt{dt}+2t\). Thus, we may further upper bound (176) by

\[\mathbb{P}_{X\sim\mathcal{N}(0,\mathbf{I}_{d})}\big{[}\|X\|_{2}^{2 }-d\geq(2^{j-1}-\frac{1}{2})^{2}-d\big{]} \leq\mathbb{P}_{X\sim\mathcal{N}(0,\mathbf{I}_{d})}\Big{[}\|X\|_{ 2}^{2}-d\geq 2\sqrt{dt}+2t\Big{]}\] \[\stackrel{{\eqref{eq:R}}}{{\leq}}e^{-R^{2}/4}\leq e ^{-(2^{j-2}-\frac{1}{4})^{2}},\]

whenever \(R\geq 2\sqrt{2d}\), or equivalently, \(j\geq\log_{2}(1+4\sqrt{2d})\). Under this regime, we have

\[2^{j\beta}\int_{\|z\|\in[(2^{j-1}-\frac{1}{2})h,(2^{j}+\frac{1}{ 2})h]}\,\mathbf{k}(x,x-z)dz\leq 2^{j\beta}(2\pi h^{2})^{d/2}e^{-(2^{j-1}- \frac{1}{4})^{2}}<C\]

for some positive constant \(C\) that does not depend on \(j\) or \(n\) as desired.

Verifying (17).Fixing \(j\geq 1\), we have

\[(2^{j}+\frac{1}{2})^{d}2^{j\beta}\kappa(2^{j-1}-1) \leq 2^{j(d+\beta)+d}\exp(-\frac{1}{2}(2^{j-1}-1)^{2})\] \[\leq\exp\bigl{(}(\log 2)(j(d+\beta)+d)-(2^{j-1}-1)^{2})\bigr{)}\] \[\leq\exp\bigl{(}\max_{j\in[T]}\bigl{\{}(\log 2)(j(d+\beta)+d)-(2^{ j-1}-1)^{2})\bigr{\}}\bigr{)}\]

Note that \((\log 2)(j(d+\beta)+d)-(2^{j-1}-1)^{2}\) is concave over \(j>1\) and maximized at \(j=\lfloor\log(1+\sqrt{1+2(\beta+d)})\rfloor\). Treating \(\int_{0}^{\frac{1}{2}}\kappa(u)u^{d-1}du\) as a constant, there exists \(c_{2}\) such that (17) is satisfied for all positive integers \(j\).

### Matern

We consider the kernel \(\mathbf{k}(x_{1},x_{2})\triangleq c_{\nu-\frac{d}{d}}(\frac{\|x_{1}-x_{2}\|_{2 }}{h})^{\nu-\frac{d}{2}}K_{\nu-\frac{d}{d}}(\frac{\|x_{1}-x_{2}\|_{2}}{h})\) with \(\nu>d\), where \(K_{a}\) denotes the modified Bessel function of the third kind [30, Def. 5.10], and \(c_{b}\triangleq\frac{2^{1-b}}{\Gamma(b)}\). We have \(\mathbf{k}(x_{1},x_{2})=\kappa(\frac{\|x_{1}-x_{2}\|_{2}}{h})\triangleq \widetilde{\kappa}_{\nu-\frac{d}{d}}(\frac{\|x_{1}-x_{2}\|_{2}}{h})\), where

\[\widetilde{\kappa}_{b}(u)\triangleq c_{b}u^{b}K_{b}(u).\]Verifying (16).Fix \(j\in\{0,1,\dots,T\}\). Applying Jensen's inequality, we have

\[\sup_{x\in\mathcal{X}}\int_{\|z\|\in[(2^{j-1}-\frac{1}{2})h,(2^{j}+ \frac{1}{2})h]}\mathbf{k}(x,x-z)dz \leq\sup_{x\in\mathcal{X}}\Bigl{(}\int_{\|z\|\in[(2^{j-1}-\frac{1} {2})h,(2^{j}+\frac{1}{2})h]}\mathbf{k}^{2}(x,x-z)dx\Bigr{)}^{\frac{1}{2}}\] \[\leq\sup_{x\in\mathcal{X}}\Bigl{(}\int_{\|z\|\geq(2^{j-1}-\frac{1} {2})h}\mathbf{k}^{2}(x,x-z)dx\Bigr{)}^{\frac{1}{2}}\] \[=\tau_{\mathbf{k}}((2^{j-1}-\frac{1}{2})h),\]

where \(\tau_{\mathbf{k}}(\cdot)\) is the kernel tail decay defined by [10, Assum. 3]. We may use the same logic as in [10, App. O.3.6]--but ignoring the \(A_{\nu,\gamma,d}\) term and making the substitutions, \(a\leftarrow\nu-\frac{d}{2}\), \(\gamma\leftarrow\frac{1}{h}\), and \(\Gamma(\nu-1)\leftarrow\Gamma(2\nu-1)\)--to obtain

\[\tau_{\mathbf{k}}^{2}(R)\leq h^{d}\cdot 2\pi\tfrac{2^{2-2\nu-d}}{\Gamma^{2}( \nu-\frac{d}{2})}\cdot\tfrac{\pi^{\frac{d}{2}}}{\Gamma(\frac{d}{2}+1)}\cdot \Gamma(2\nu-1)\exp(-\tfrac{R}{2h})\quad\text{for}\quad R\geq\tfrac{2\nu-d}{ \sqrt{2}}h.\]

Hence, we have

\[2^{j\beta}\sup_{x\in\mathcal{X}}\int_{\|z\|\in[(2^{j-1}-\frac{1}{2})h,(2^{j}+ \frac{1}{2})h]}\mathbf{k}(x,x-z)dz\leq 2^{j\beta}C_{h,d,\nu}\exp(-\tfrac{1}{4}(2 ^{j-1}-\tfrac{1}{2}))=\mathcal{O}(1),\]

whenever \((2^{j-1}-\frac{1}{2})h\geq\frac{2\nu-d}{\sqrt{2}}h\Leftrightarrow j\geq 1+ \log(\frac{2\nu-d}{\sqrt{2}}+\frac{1}{2})\) for some constant \(C_{h,d,\nu}\) that does not depend on \(j\).

Verifying (17).Following similar logic as in [10, App. O.3.1], we have

\[\widetilde{\kappa}_{a}(u)\leq\min\bigl{\{}1,\sqrt{2\pi}c_{a}u^{a-1}\exp\bigl{(} -\tfrac{u}{2}\bigr{)}\bigr{\}}\quad\text{for}\quad u\geq 2(a-1).\]

Fixing \(j\geq 1\), we have

\[(2^{j}+1)^{d}2^{j\beta}\kappa(2^{j-1}-1)\leq 2^{j(d+\beta)+d}\min\Bigl{\{}1, \sqrt{2\pi}c_{\nu-\frac{d}{2}}(2^{j-1}-1)^{\nu-\frac{d}{2}-1}\exp(-\tfrac{1}{2 }(2^{j-1}-1))\Bigr{\}}.\]

Note that when \(\nu-\frac{d}{2}-1<1\), the RHS can be rewritten as \(C_{\beta,d}(2^{j-1})^{d+\beta}\exp(\tfrac{1}{2}2^{j-1})\) for some constant \(C_{\beta,d}\) that doesn't depend on \(j\). When \(\nu-\frac{d}{2}-1\geq 1\), the RHS can be upper-bounded by \(C^{\prime}_{\beta,d}(2^{j-1})^{j(\nu+\beta+\frac{d}{2}-1)}\exp(-\tfrac{1}{2}2 ^{j-1})\) for some constant \(C^{\prime}_{\beta,d}\) that doesn't depend on \(j\). Observe that the function \(t^{b}e^{-t/2}\) attains its maximum at \(t=2b\). Hence, the RHS can be bounded by a constant that does not depend on \(n\) as desired.

### NeurIPS Paper Checklist

1. **Claims** Question: Do the main claims made in the abstract and introduction accurately reflect the paper's contributions and scope? Answer: [Yes] Justification: Abstract and introduction give clear outlines on our contributions, and we present our contributions in the main text accordingly. We have also included pointers in the introduction that would link to the referred main text containing specific contributions. Guidelines: * The answer NA means that the abstract and introduction do not include the claims made in the paper. * The abstract and/or introduction should clearly state the claims made, including the contributions made in the paper and important assumptions and limitations. A No or NA answer to this question will not be perceived well by the reviewers. * The claims made should match theoretical and experimental results, and reflect how much the results can be expected to generalize to other settings. * It is fine to include aspirational goals as motivation as long as it is clear that these goals are not attained by the paper.
2. **Limitations** Question: Does the paper discuss the limitations of the work performed by the authors? Answer: [Yes] Justification: In Sec. 6, we discuss limitations as well as future work to address these limitations. Guidelines: * The answer NA means that the paper has no limitation while the answer No means that the paper has limitations, but those are not discussed in the paper. * The authors are encouraged to create a separate "Limitations" section in their paper. * The paper should point out any strong assumptions and how robust the results are to violations of these assumptions (e.g., independence assumptions, noiseless settings, model well-specification, asymptotic approximations only holding locally). The authors should reflect on how these assumptions might be violated in practice and what the implications would be. * The authors should reflect on the scope of the claims made, e.g., if the approach was only tested on a few datasets or with a few runs. In general, empirical results often depend on implicit assumptions, which should be articulated. * The authors should reflect on the factors that influence the performance of the approach. For example, a facial recognition algorithm may perform poorly when image resolution is low or images are taken in low lighting. Or a speech-to-text system might not be used reliably to provide closed captions for online lectures because it fails to handle technical jargon. * The authors should discuss the computational efficiency of the proposed algorithms and how they scale with dataset size. * If applicable, the authors should discuss possible limitations of their approach to address problems of privacy and fairness. * While the authors might fear that complete honesty about limitations might be used by reviewers as grounds for rejection, a worse outcome might be that reviewers discover limitations that aren't acknowledged in the paper. The authors should use their best judgment and recognize that individual actions in favor of transparency play an important role in developing norms that preserve the integrity of the community. Reviewers will be specifically instructed to not penalize honesty concerning limitations.
3. **Theory Assumptions and Proofs**Question: For each theoretical result, does the paper provide the full set of assumptions and a complete (and correct) proof? Answer: [Yes] Justification: We have clarified the assumptions and models required for all the theorems and corollaries provided in the main text and appendix. Also we provide a complete proof in the appendix for all the stated results. Guidelines: * The answer NA means that the paper does not include theoretical results. * All the theorems, formulas, and proofs in the paper should be numbered and cross-referenced. * All assumptions should be clearly stated or referenced in the statement of any theorems. * The proofs can either appear in the main paper or the supplemental material, but if they appear in the supplemental material, the authors are encouraged to provide a short proof sketch to provide intuition. * Inversely, any informal proof provided in the core of the paper should be complemented by formal proofs provided in appendix or supplemental material. * Theorems and Lemmas that the proof relies upon should be properly referenced.
4. **Experimental Result Reproducibility** Question: Does the paper fully disclose all the information needed to reproduce the main experimental results of the paper to the extent that it affects the main claims and/or conclusions of the paper (regardless of whether the code and data are provided or not)? Answer: [Yes] Justification: We describe details of the experiments in Sec. 5 and provide links to all code and data. Guidelines: * The answer NA means that the paper does not include experiments. * If the paper includes experiments, a No answer to this question will not be perceived well by the reviewers: Making the paper reproducible is important, regardless of whether the code and data are provided or not. * If the contribution is a dataset and/or model, the authors should describe the steps taken to make their results reproducible or verifiable. * Depending on the contribution, reproducibility can be accomplished in various ways. For example, if the contribution is a novel architecture, describing the architecture fully might suffice, or if the contribution is a specific model and empirical evaluation, it may be necessary to either make it possible for others to replicate the model with the same dataset, or provide access to the model. In general. releasing code and data is often one good way to accomplish this, but reproducibility can also be provided via detailed instructions for how to replicate the results, access to a hosted model (e.g., in the case of a large language model), releasing of a model checkpoint, or other means that are appropriate to the research performed. * While NeurIPS does not require releasing code, the conference does require all submissions to provide some reasonable avenue for reproducibility, which may depend on the nature of the contribution. For example 1. If the contribution is primarily a new algorithm, the paper should make it clear how to reproduce that algorithm. 2. If the contribution is primarily a new model architecture, the paper should describe the architecture clearly and fully. 3. If the contribution is a new model (e.g., a large language model), then there should either be a way to access this model for reproducing the results or a way to reproduce the model (e.g., with an open-source dataset or instructions for how to construct the dataset). 4. We recognize that reproducibility may be tricky in some cases, in which case authors are welcome to describe the particular way they provide for reproducibility. In the case of closed-source models, it may be that access to the model is limited in some way (e.g., to registered users), but it should be possible for other researchers to have some path to reproducing or verifying the results.
5. **Open access to data and code** Question: Does the paper provide open access to the data and code, with sufficient instructions to faithfully reproduce the main experimental results, as described in supplemental material? Answer: [Yes] Justification: We provide a link to our GitHub repository containing all code in Sec. 5. Guidelines: * The answer NA means that paper does not include experiments requiring code. * Please see the NeurIPS code and data submission guidelines ([https://nips.cc/public/guides/CodeSubmissionPolicy](https://nips.cc/public/guides/CodeSubmissionPolicy)) for more details. * While we encourage the release of code and data, we understand that this might not be possible, so "No" is an acceptable answer. Papers cannot be rejected simply for not including code, unless this is central to the contribution (e.g., for a new open-source benchmark). * The instructions should contain the exact command and environment needed to run to reproduce the results. See the NeurIPS code and data submission guidelines ([https://nips.cc/public/guides/CodeSubmissionPolicy](https://nips.cc/public/guides/CodeSubmissionPolicy)) for more details. * The authors should provide instructions on data access and preparation, including how to access the raw data, preprocessed data, intermediate data, and generated data, etc. * The authors should provide scripts to reproduce all experimental results for the new proposed method and baselines. If only a subset of experiments are reproducible, they should state which ones are omitted from the script and why. * At submission time, to preserve anonymity, the authors should release anonymized versions (if applicable). * Providing as much information as possible in supplemental material (appended to the paper) is recommended, but including URLs to data and code is permitted.
6. **Experimental Setting/Details** Question: Does the paper specify all the training and test details (e.g., data splits, hyperparameters, how they were chosen, type of optimizer, etc.) necessary to understand the results? Answer: [Yes] Justification: We provide train-test splits and hyperparameters in the main paper. Guidelines: * The answer NA means that the paper does not include experiments. * The experimental setting should be presented in the core of the paper to a level of detail that is necessary to appreciate the results and make sense of them. * The full details can be provided either with the code, in appendix, or as supplemental material.
7. **Experiment Statistical Significance** Question: Does the paper report error bars suitably and correctly defined or other appropriate information about the statistical significance of the experiments? Answer: [Yes] Justification: In all figures, we plot error bars representing standard deviation across 100 trials. In all tables, we report mean +/- standard error across 100 trials. Guidelines: * The answer NA means that the paper does not include experiments. * The authors should answer "Yes" if the results are accompanied by error bars, confidence intervals, or statistical significance tests, at least for the experiments that support the main claims of the paper.

* The factors of variability that the error bars are capturing should be clearly stated (for example, train/test split, initialization, random drawing of some parameter, or overall run with given experimental conditions).
* The method for calculating the error bars should be explained (closed form formula, call to a library function, bootstrap, etc.)
* The assumptions made should be given (e.g., Normally distributed errors).
* It should be clear whether the error bar is the standard deviation or the standard error of the mean.
* It is OK to report 1-sigma error bars, but one should state it. The authors should preferably report a 2-sigma error bar than state that they have a 96% CI, if the hypothesis of Normality of errors is not verified.
* For asymmetric distributions, the authors should be careful not to show in tables or figures symmetric error bars that would yield results that are out of range (e.g. negative error rates).
* If error bars are reported in tables or plots, The authors should explain in the text how they were calculated and reference the corresponding figures or tables in the text.
8. **Experiments Compute Resources** Question: For each experiment, does the paper provide sufficient information on the computer resources (type of compute workers, memory, time of execution) needed to reproduce the experiments? Answer: [Yes] Justification: We indicate the computer resources for running all experiments in Sec. 5. Guidelines: * The answer NA means that the paper does not include experiments. * The paper should indicate the type of compute workers CPU or GPU, internal cluster, or cloud provider, including relevant memory and storage. * The paper should provide the amount of compute required for each of the individual experimental runs as well as estimate the total compute. * The paper should disclose whether the full research project required more compute than the experiments reported in the paper (e.g., preliminary or failed experiments that didn't make it into the paper).
9. **Code Of Ethics** Question: Does the research conducted in the paper conform, in every respect, with the NeurIPS Code of Ethics [https://neurips.cc/public/EthicsGuidelines?](https://neurips.cc/public/EthicsGuidelines?) Answer: [Yes] Justification: We have reviewed the NeurIPS Code of Ethics and our paper conforms with it. Guidelines: * The answer NA means that the authors have not reviewed the NeurIPS Code of Ethics. * If the authors answer No, they should explain the special circumstances that require a deviation from the Code of Ethics. * The authors should make sure to preserve anonymity (e.g., if there is a special consideration due to laws or regulations in their jurisdiction).
10. **Broader Impacts** Question: Does the paper discuss both potential positive societal impacts and negative societal impacts of the work performed? Answer: [NA] Justification: Our work reduces the computational costs of classical methods and is applied to standard datasets. Thus, it has no outsize societal impact. Guidelines: * The answer NA means that there is no societal impact of the work performed.

* If the authors answer NA or No, they should explain why their work has no societal impact or why the paper does not address societal impact.
* Examples of negative societal impacts include potential malicious or unintended uses (e.g., disinformation, generating fake profiles, surveillance), fairness considerations (e.g., deployment of technologies that could make decisions that unfairly impact specific groups), privacy considerations, and security considerations.
* The conference expects that many papers will be foundational research and not tied to particular applications, let alone deployments. However, if there is a direct path to any negative applications, the authors should point it out. For example, it is legitimate to point out that an improvement in the quality of generative models could be used to generate deepfakes for disinformation. On the other hand, it is not needed to point out that a generic algorithm for optimizing neural networks could enable people to train models that generate Deepfakes faster.
* The authors should consider possible harms that could arise when the technology is being used as intended and functioning correctly, harms that could arise when the technology is being used as intended but gives incorrect results, and harms following from (intentional or unintentional) misuse of the technology.
* If there are negative societal impacts, the authors could also discuss possible mitigation strategies (e.g., gated release of models, providing defenses in addition to attacks, mechanisms for monitoring misuse, mechanisms to monitor how a system learns from feedback over time, improving the efficiency and accessibility of ML).
11. **Safeguards** Question: Does the paper describe safeguards that have been put in place for responsible release of data or models that have a high risk for misuse (e.g., pretrained language models, image generators, or scraped datasets)? Answer: [NA] Justification: We do not release models or data as part of this paper. Guidelines: * The answer NA means that the paper poses no such risks. * Released models that have a high risk for misuse or dual-use should be released with necessary safeguards to allow for controlled use of the model, for example by requiring that users adhere to usage guidelines or restrictions to access the model or implementing safety filters. * Datasets that have been scraped from the Internet could pose safety risks. The authors should describe how they avoided releasing unsafe images. * We recognize that providing effective safeguards is challenging, and many papers do not require this, but we encourage authors to take this into account and make a best faith effort.
12. **Licenses for existing assets** Question: Are the creators or original owners of assets (e.g., code, data, models), used in the paper, properly credited and are the license and terms of use explicitly mentioned and properly respected? Answer: [Yes] Justification: We include URL and licenses for baseline code and datasets used in Sec. 5.2. Guidelines: * The answer NA means that the paper does not use existing assets. * The authors should cite the original paper that produced the code package or dataset. * The authors should state which version of the asset is used and, if possible, include a URL. * The name of the license (e.g., CC-BY 4.0) should be included for each asset. * For scraped data from a particular source (e.g., website), the copyright and terms of service of that source should be provided. ** If assets are released, the license, copyright information, and terms of use in the package should be provided. For popular datasets, paperswithcode.com/datasets has curated licenses for some datasets. Their licensing guide can help determine the license of a dataset.
* For existing datasets that are re-packaged, both the original license and the license of the derived asset (if it has changed) should be provided.
* If this information is not available online, the authors are encouraged to reach out to the asset's creators.
13. **New Assets** Question: Are new assets introduced in the paper well documented and is the documentation provided alongside the assets? Answer: [Yes] Justification: We release our code with documentation at [https://github.com/ag2435/npr](https://github.com/ag2435/npr) under a BSD-3 Clause license. Guidelines: * The answer NA means that the paper does not release new assets. * Researchers should communicate the details of the dataset/code/model as part of their submissions via structured templates. This includes details about training, license, limitations, etc. * The paper should discuss whether and how consent was obtained from people whose asset is used. * At submission time, remember to anonymize your assets (if applicable). You can either create an anonymized URL or include an anonymized zip file.
14. **Crowdsourcing and Research with Human Subjects** Question: For crowdsourcing experiments and research with human subjects, does the paper include the full text of instructions given to participants and screenshots, if applicable, as well as details about compensation (if any)? Answer: [NA] Justification: We do not have any studies or results regarding crowdsourcing experiments and human subjects. Guidelines: * The answer NA means that the paper does not involve crowdsourcing nor research with human subjects. * Including this information in the supplemental material is fine, but if the main contribution of the paper involves human subjects, then as much detail as possible should be included in the main paper. * According to the NeurIPS Code of Ethics, workers involved in data collection, curation, or other labor should be paid at least the minimum wage in the country of the data collector.
15. **Institutional Review Board (IRB) Approvals or Equivalent for Research with Human Subjects** Question: Does the paper describe potential risks incurred by study participants, whether such risks were disclosed to the subjects, and whether Institutional Review Board (IRB) approvals (or an equivalent approval/review based on the requirements of your country or institution) were obtained? Answer: [NA] Justification: We do not have any studies or results including study participants. Guidelines: * The answer NA means that the paper does not involve crowdsourcing nor research with human subjects.

* Depending on the country in which research is conducted, IRB approval (or equivalent) may be required for any human subjects research. If you obtained IRB approval, you should clearly state this in the paper.
* We recognize that the procedures for this may vary significantly between institutions and locations, and we expect authors to adhere to the NeurIPS Code of Ethics and the guidelines for their institution.
* For initial submissions, do not include any information that would break anonymity (if applicable), such as the institution conducting the review.