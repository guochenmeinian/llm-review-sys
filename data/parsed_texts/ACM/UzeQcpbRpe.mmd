[MISSING_PAGE_FAIL:1]

in the blockchain. UTP is responsible for recording and processing all unconfirmed transactions in real time. It comprises five nodes, each of which runs a modified Bitcoin Core. Subsequently, we propose two novel clustering heuristics specifically designed for unconfirmed transactions, aiming to uncover additional address associations that are beyond the capabilities of the SOTA clustering heuristics. The principles of our proposed clustering heuristics are derived from the Replace-by-fee (RBF) proposed by Bitcoin Improvement Proposal (BIP)125 (Ferrari et al., 2017) and the unconfirmed transaction dependency chain mentioned in BIP141 (Shi et al., 2017). Experimental results reveal the effectiveness of our approach in leveraging unconfirmed transactions to uncover address associations, significantly improving the clustering results of the SOTA clustering heuristics. To validate our approach, we construct a labeled dataset based on Bitcoin ordinal insertions (Shi et al., 2017) and demonstrate that our approach improves the recall with high precision by at least three times compared to the SOTA clustering heuristics. The increase in recall indicates that our approach uncovers additional address associations, thus reducing entities incorrectly clustered. Furthermore, we show that our approach reduces the number of entities in the clustering results of the SOTA clustering heuristics by at least 20.28%, which can reduce the error of addresses that should belong to the same entity, but being clustered into multiple entities. Finally, we find that unconfirmed transactions have a greater impact on the clustering results for future periods than those from past periods.

To the best of our knowledge, our study is the first to explore unconfirmed transactions to cluster addresses in Bitcoin. In summary, our main contributions in this paper are threefold:

* **Novel heuristics**: We propose two novel clustering heuristics to uncover additional address associations by analyzing the specific behavior patterns in unconfirmed transactions, in order to improve Bitcoin address clustering. Experimental results show that our proposed clustering heuristics can effectively utilize unconfirmed transactions to uncover address associations, significantly improving recall with high precision by at least three times.
* **Data collection**: We introduce a reliable data collection framework to record and process all unconfirmed transactions in Bitcoin in real time. We release a part of the dataset2 as a benchmark for future studies.
* **Labeling method**: We present a method for constructing a labeled dataset based on Bitcoin ordinal insertions. This method addresses, to some extent, the critical issue in the field of Bitcoin address clustering, i.e., the lack of labeled datasets to validate clustering results. In this paper, we construct and release a dataset3 encompassing 20 entities and 62,971 addresses.

Footnote 2: See details at [https://drive.google.com/drive/folders/1VCip9qro8shd/VdlnQMB4AS](https://drive.google.com/drive/folders/1VCip9qro8shd/VdlnQMB4AS) vdd.jlT/pass-sharing

## 2. Background

### Mempool in a Bitcoin Node

Bitcoin is established on a set of Bitcoin nodes, each of which stores a ledger of confirmed transactions. Bitcoin blockchain acts as the distributed ledger.

As shown in Figure 1, before a transaction is stored in the blockchain, it (as an _unconfirmed_ transaction) will be temporarily stored in the mempool of a node. The node will validate (or reject) the transaction that is from other nodes or initiated by itself based on established criteria. For instance, it validates the correctness of signatures. If the transaction meets the established criteria, the node will add the transaction to its mempool. Miners select transactions from their own mempools and then packaging these transactions to a block. They compete to append the block to the blockchain through proof-of-work. The winning miner propagates his or her block to other nodes, while other nodes append the block to their own ledgers. When the block is appended to the ledgers of all nodes, it indicates that the block is appended to the blockchain. Then, the transactions in the block become _confirmed_ transactions. Note that a portion of unconfirmed transactions might never get confirmed due to, e.g., being replaced or paying insufficient fees. These transactions are considered as _failed_ transactions.

Each unconfirmed transaction in the mempool has some additional fields, e.g., _replaceable, time, depends_, and _spentby_, which are not present in confirmed transactions. The latter three fields are exclusively available when a transaction is in Bitcoin mempool and disappear once the transaction is confirmed. (1) The field _replaceable_ is a Boolean value, indicating whether this transaction can be replaced by another transaction. (2) The field _time_ annotates the moment at which the transaction enters a particular node's mempool that may exhibit minor variances across different mempools. (3) The field _depends_ of a transaction records unconfirmed transactions whose UTXO(s) is spent by this transaction. (4) The field _spentby_ of a transaction records unconfirmed transactions spending outputs of this transaction. These fields contain rich information about a transaction before it is confirmed, which can be utilized in our study for Bitcoin address clustering.

### Bitcoin Address Clustering

The SOTA clustering heuristics rely on behavior patterns in confirmed transactions to uncover address associations, which indicate whether these addresses are controlled by the same entity. For example, a common heuristic, known as the _co-spend_ heuristic, considers that all inputs of a transaction are controlled by the same entity, because a valid transaction requires the signature of private keys corresponding to all inputs. In practice, however, a few studies (Ferrari et al., 2017; Shi et al., 2017; Shi et al., 2017) advocate the exclusion of Conjoin transactions (Shi et al., 2017) prior to applying the _co-spend_ heuristic. This is mainly because Conjoin transactions employ a trustless method for combining

Figure 1. Life-cycle of a Bitcoin transaction.

multiple Bitcoin payments into a single transaction, thereby obfuscating the relationship between senders and recipients.

In addition, various heuristics, known as the _change_ heuristics, have been introduced in previous studies (Bittlestone et al., 2017; Bittlestone et al., 2017; Bittlestone et al., 2018; Bittlestone et al., 2019). In Bitcoin, an Unspent Transaction Output (UTXO) represents a certain amount of bitcoins. It is an indivisible unit and must be fully spent in a transaction. This results in the need for senders to use a change address to receive the remaining amount of bitcoins. Thus, the address of the sender (the input address) and the change address should be controlled by the same entity. For such heuristics, it is key to identify change addresses in transactions.

So far, the SOTA clustering heuristics focus only on behavior patterns in confirmed transactions that are already stored in the blockchain. However, they all ignore the additional information of a transaction before it is stored in the blockchain.

## 3. Approach

### Overview

As shown in Figure 2, our approach consists of two components: Data Collector and Heuristics Executor. Data Collector contains two sub-components: Confirmed Transaction Collector (CTC) and Unconfirmed Transaction Processor (UTP). CTC copies confirmed transactions from the ledger of a node, while UTP collects and processes all unconfirmed transactions that appeared in mempools of deployed nodes. Data Collector subsequently transfers both confirmed and unconfirmed transactions to Heuristics Executor. Then, Heuristics Executor, consisting of our proposed clustering heuristics and the SOTA clustering heuristics, clusters Bitcoin addresses.

### Data Collector

**CTC.** As shown in Figure 2, CTC with one node running a Bitcoin client, referred to as Bitcoin Core, copies confirmed transactions from the ledger of the node. In CTC, we optimize BlockSci (Bittlestone et al., 2017), a widely used Bitcoin transaction parsing tool, as BlockSci-modified4, which can parse Taproot addresses (Kumar et al., 2018).

Footnote 4: See details at [https://github.com/UnconfirmedTransactions/BlockSci-modified](https://github.com/UnconfirmedTransactions/BlockSci-modified)

**UTP.** UTP consists of a set (five in this paper) of nodes, each of which runs a modified Bitcoin Core. It aims to collect as many unconfirmed transactions as possible in Bitcoin and continuously reconstruct the state of the Bitcoin mempool in each node. This state hereby contains the details of each transaction in the mempool at a moment. Here, UTP tries to solve two key issues as follows:

(1) _How can UTP collect unconfirmed transactions in real time?_

When using the Remote Procedure Call interface provided by Bitcoin Core to collect unconfirmed transactions, the first call has to obtain hashes of unconfirmed transactions in the mempool presently. Then, the second call retrieves detailed transactions based on these hashes. Due to the time gap between these two calls, part of the transactions may be removed from the mempool, resulting in missing these removed transactions. To collect unconfirmed transactions in real time, we modify Bitcoin Core. Our modified Bitcoin Core5 can monitor the arrival of each transaction, then record transaction details from the moment it enters the mempool until it is confirmed or failed. The arrival of each unconfirmed transaction triggers UTP of a node for recording in real time to ensure that no unconfirmed transactions received by the node are missed.

Footnote 5: See details at [https://github.com/UnconfirmedTransactions/BitcoinCore-modified](https://github.com/UnconfirmedTransactions/BitcoinCore-modified)

(2) _How can UTP collect unconfirmed transactions in Bitcoin as many as possible?_ Due to multiple factors such as the decentralized network of Bitcoin, network latency, and bandwidth limitations, unconfirmed transactions received by different nodes might vary. To achieve a comprehensive collection of unconfirmed transactions in Bitcoin, we perform experiments to evaluate the completeness of unconfirmed transactions collected by UTP. We increase the

Figure 3. The number of transactions collected vs. the number of nodes running a modified Bitcoin core.

Figure 2. Our approach for Bitcoin address clustering by combining unconfirmed transactions and confirmed transactions.

number of nodes and measure the number of deduplicated unconfirmed transactions collected per day from May 1, 2022 to May 7, 2022. Figure 3 shows that the number of deduplicated unconfirmed transactions rarely increases when the number of nodes reaches five. That is, UTP can collect approximately all unconfirmed transactions in Bitcoin when deploying five nodes. Therefore, we deploy five nodes, each of which runs a modified Bitcoin Core, to collect all unconfirmed transactions in Bitcoin. Table 1 shows the fields of an unconfirmed transaction in the mempool. In this paper, we focus on seven fields, i.e., _fee, vsize, time, removetime, depends, spentby_, and _replaceable_, which are relevant to subsequent analysis of behavior patterns in unconfirmed transactions. As shown in Table 1, there are additional fields that are not present in confirmed transactions, such as the field _ancestorount_.

Finally, we build a mempool state database for the mempools of five nodes. In the database, we set _time_ and _removetime_ as indexes for each unconfirmed transaction. Given a specific time, the database is able to retrieve all unconfirmed transactions in each mempool at the moment. Note that a transaction output may be spent by multiple unconfirmed transactions. We make two adjustments to the original transaction structure. Specifically, the first field _output.is_, spent_, a Boolean type, indicates whether the _output_ has been spent by transactions. The second field _output.spent_,_tx_ is a list containing hashes of transactions that spend this _output_.

Since failed transactions are removed from the mempool and no longer exist in Bitcoin, we can simply identify failed transactions by excluding confirmed transactions from unconfirmed transactions.

### Novel Clustering Heuristics

We explore two mechanisms in unconfirmed transactions to design novel clustering heuristics.

**(1) Replace-by-fee (RBF)**(Gupta et al., 2017). It allows a sender to replace his or her unconfirmed transaction by initiating another transaction that pays a higher fee. Due to the limitation of fixed block size, miners give priority to transactions with a higher feenerate (_fee/vsize_) to maximize their profit. Note that a transaction can only be replaced when the field _replaceable_ of the transaction is set to true.

**(2) Unconfirmed transaction dependency chain**(Zhou et al., 2018). The Bitcoin mempool is designed to accept unconfirmed transactions that spend UTXO(s) of other unconfirmed transactions. The user can initiate a new transaction to spend UTXO(s) of his or her unconfirmed transactions. As a result, it is common to form an unconfirmed transaction dependency chain in the mempool. In a dependency chain, each unconfirmed transaction spends UTXO(s) of the preceding unconfirmed transaction, which in turn spends UTXO(s) of another unconfirmed transaction, and so forth. Dependency chains typically form for two reasons. One is that users want miners to store their multiple transactions in the blockchain at one time, without waiting for a transaction to be confirmed before initiating a new one that spends UTXO(s) of the transaction. The other reason is related to a transaction pattern known as Child-Pays-for-Parent (CPF). To incentivize miners to store the parent transaction of a user in the blockchain early, the user can initiate a child transaction that pays a high fee and spends UTXO(s) of the parent transaction.

For the first mechanism, we design a clustering heuristic, _replacement change_ shown in Figure 2, to identify the change address.

**Replacement Change heuristic.** Let \(T\) denote a set of transactions, defined as \(T=\{tx_{1},tx_{2},\ldots,tx_{N}\}\) with \(n\geq 2\). We identify the change address if (1) the field _replaceable_ of each transaction in \(T\) is True; (2) transactions in \(T\) spend the same UTXO; (3) fees of transactions in \(T\) increase as the field _time_ increases; and (4) the address appears in the output of each transaction in \(T\) and the amounts received by the address decrease as the field _time_ increases.

This heuristic works for the following reason. In real-world trade of goods, the price of goods is typically negotiated between two parties and does not change arbitrarily. When the sender increases the fee, the amount paid to the recipient remains the same, while the amount received by the change address decreases. As shown in Figure 4, _tx2_, _tx3_, and _tx4_ all attempt to spend the 0.35 BTC in _addr1_. When the fee increases, the amount received by _addr2_ remains the same, and the amount received by _addr3_ decreases. Therefore, we can identify _addr2_, which consistently receives the same amount, as the recipient address, and identify _addr3_, which receives a gradually smaller amount, as the sender's change address.

For the second mechanism, we design another clustering heuristic, _dependency chain_ shown in Figure 2, for the unconfirmed transaction dependency chain.

**Dependency Chain heuristic.** Let \(T\) denote a sequence of unconfirmed transactions, defined as \(T=\langle tx_{1},tx_{2},\ldots,tx_{n}\rangle\) with \(n\geq 2\).

\begin{table}
\begin{tabular}{l l} \hline
**Name** & **Content** \\ \hline
1 & \begin{tabular}{l} kid \\ wtsid \\ inputs \\ outputs \\ \end{tabular} & 
\begin{tabular}{l} hash of transaction, not including witness data. \\ hash of transaction, including witness data. \\ the inputs of transaction. \\ the outputs of transaction. \\ \end{tabular} \\
2 & \begin{tabular}{l} \\ few \\ vsize \\ \end{tabular} & 
\begin{tabular}{l} transaction fee in BTC \\ virtual transaction size \\ \end{tabular} \\
3 & 
\begin{tabular}{l} weight \\ transaction weight \\ \end{tabular} \\
3 & \begin{tabular}{l} time\end{tabular} & 
\begin{tabular}{l} local time when the transaction enters mempool \\ \end{tabular} \\
3 & \begin{tabular}{l} time when the transaction is removed \\ height\({}^{*}\) \\ \end{tabular} & 
\begin{tabular}{l} block height when transaction enters mempool \\ \end{tabular} \\
4 & \begin{tabular}{l} descendantcount\({}^{*}\) \\ \end{tabular} & 
\begin{tabular}{l} number of descendant transactions \\ \end{tabular} \\
4 & \begin{tabular}{l} descendantsize\({}^{*}\) \\ \end{tabular} & 
\begin{tabular}{l} size of descendant transactions \\ \end{tabular} \\
4 & \begin{tabular}{l} descendantsize\({}^{*}\) \\ \end{tabular} & 
\begin{tabular}{l} modified fees of descendant transactions \\ \end{tabular} \\
4 & \begin{tabular}{l} ancestorcount\({}^{*}\) \\ \end{tabular} & 
\begin{tabular}{l} number of ancestor transactions \\ \end{tabular} \\
4 & \begin{tabular}{l} ancestorsize\({}^{*}\) \\ \end{tabular} & 
\begin{tabular}{l} modified fees of ancestor transactions \\ \end{tabular} \\
4 & \begin{tabular}{l} descendantsize\({}^{*}\) \\ \end{tabular} & 
\begin{tabular}{l} unconfirmed transactions used as inputs \\ \end{tabular} \\
5 & \begin{tabular}{l} **spentby\({}^{*}\)** \\ \end{tabular} & 
\begin{tabular}{l} unconfirmed transactions spending outputs \\ \end{tabular} \\
6 & \begin{tabular}{l} replaceable\({}^{*}\) \\ \end{tabular} & 
\begin{tabular}{l} whether this transaction could be replaced \\ \end{tabular} \\ \hline \end{tabular}

* Fields with a star (\({}^{*}\)) are only present in unconfirmed transactions.

\end{table}
Table 1. Fields of an unconfirmed transaction.

Figure 4. Example of _replacement change_ heuristic.

Each transaction \(tx_{k}\) in the range \(2\leq k\leq n\) spends partial outputs of the previous transaction \(tx_{k-1}\), denoted as \(O_{k-1}\). Considering that \(tx_{1}\) is the first transaction and spends outputs of confirmed transactions, we use \(O_{0}\) to represent all inputs of \(tx_{1}\). For every \(k\) in the range \(2\leq k\leq n\), if (1) the hash of \(tx_{k}\) is in the field _spenthy_ of \(tx_{k-1}\); or (2) the hash of \(tx_{k-1}\) is in the field _depends_ of \(tx_{k}\), all transactions in \(T\) are initiated by one same entity, i.e., \(\bigcup_{k=0}^{n}O_{k}\) are all controlled by the same entity.

This heuristic works for two reasons. First, in the design of popular Bitcoin wallets like Binance, Coinbase, Electrum, and BlueWallet, users can view and spend UTXO(s) of unconfirmed transactions initiated by themselves. To protect funds for users, these wallets do not allow users to view and spend UTXO(s) sent to them in the unconfirmed transactions initiated by others. Second, a Bitcoin transaction is considered irreversible after the blockchain receives six new blocks. Therefore, for commercial trades, users do not use unconfirmed transactions as an indicator of fund arrival and do not spend UTXO(s) of unconfirmed transactions. Instead, they have to wait for new blocks to ensure the security and irreversibility of the transactions. As a result, transactions between different entities do not form an unconfirmed transaction dependency chain.

As shown in Figure 5, we can identify two dependency chains: (\(tx_{1}\), \(tx_{2}\), \(tx_{4}\)) and (\(tx_{1}\), \(tx_{2}\), \(tx_{3}\)), while the three transactions \(tx_{1}\), \(tx_{3}\) and \(tx_{6}\) and the two transactions \(tx_{1}\) and \(tx_{3}\) do not form a dependency chain. Applying this new heuristic, we can cluster \(\{addr_{0},addr_{1},addr_{3}\}\) into the first entity and \(\{addr_{0},addr_{1},addr_{4}\}\) into a second entity. These two entities can be further merged into a larger entity due to the common address \(addr_{0}\) in both clusters.

## 4. Evaluation

To evaluate the effectiveness of our approach, this section presents the experimental results to address three key issues as follows:

1. **Clustering result validation.** Is the clustering result of our approach accurate, and does our approach possess the capability to uncover additional address associations? (Section 4.3)
2. **Impact measurement.** How much impact does our approach have on the clustering results of the SOTA clustering heuristics? (Section 4.4)
3. **Temporal analysis.** What pattern does the impact of our approach show across different periods? (Section 4.5)

### Dataset

We collect a total of 116,514,258 unconfirmed transactions (from May 1, 2022 to May 31, 2023). Among these, 113,296,795 (97.24%) unconfirmed transactions become confirmed transactions, while the rest of them become failed transactions. These confirmed transactions involve 179,352,220 Bitcoin addresses, while the failed transactions involve 12,366,745 Bitcoin addresses, 843,892 of which are not recorded in any confirmed transactions. As shown in Appendix A, we perform two case studies on these unconfirmed transactions. Both demonstrate the presence of behavior patterns in unconfirmed transactions, while not present in confirmed transactions.

### Baseline

As shown in Figure 2, we employ six SOTA clustering heuristics as the baseline.

**Co-spend** (short for CS) considers all inputs of a transaction are controlled by the same entity if the transaction is not a Coinjoin transaction. We use the algorithm developed by Goldfeder _et al._(Goldfeder et al., 2016) to determine whether a transaction is a Coinjoin transaction.

**Androulaki _et al._** (short for A) (A) identify the change address of a transaction sender if (1) the transaction must have exactly two outputs; and (2) the address is the only _fresh_ address in the outputs, meaning that it has not been previously used in the blockchain.

**Meiklejohn _et al._** (short for M) (Makel et al., 2016) identify the change address of a transaction sender if (1) the transaction is not a coinbase transaction; (2) the address is the only _fresh_ address in the outputs; and (3) there is no address used as both an input and an output in this transaction.

**Goldfeder _et al._** (short for G) (Goldfeder et al., 2016) utilize the criteria established by Meiklejohn _et al._(Makel et al., 2016), but they also add a further condition: (4) the transaction cannot be a Coinjoin transaction.

**Ermilov _et al._** (short for E) (Goldfeder et al., 2016) identify the change address of a transaction sender if (1) the number of inputs is not two; (2) the transaction has exactly two outputs; (3) there is no address used both as an input and an output in the transaction; (4) the address is the only _fresh_ address in outputs; and (5) the amount received by the address is precise to a minimum of four decimal places.

**Kappos _et al._** (short for K) (Makel et al., 2016) identify the change address of a transaction sender if (1) the transaction is a node in a _peel chain_; (2) the amount received by the address is spent and the spent transaction is also a node in the _peel chain_.

To describe experimental results clearly, we assign a name for each clustering result, composed of the heuristic and the state of transactions. The SC clustering result refers to the result of applying one of the SOTA clustering heuristics to confirmed transactions. The SF clustering result refers to the result of applying one of the SOTA clustering heuristics to failed transactions. The NU clustering result refers to the result of applying our proposed clustering heuristics to unconfirmed transactions. We denote the merging of clustering results with a plus sign. For instance, SC-SF represents a merge of SC and SF clustering results under the same heuristic. In cases where no clustering heuristic is applied, we refer to it as None, with each address being considered as an isolated entity.

### Clustering Result Validation

To validate clustering results, we construct a labeled dataset and analyze the clustering results from multiple metrics.

**Labeling method.** Validating clustering results requires the availability of labeled datasets. However, there is no publicly available

Figure 5. Example of _dependency chain_ heuristic.

labeled dataset since Bitcoin is pseudo-anonymous, and the transactions we analyze are relatively recent. Thus, we propose a method for constructing a labeled dataset to validate our clustering results.

The labeling method is based on Bitcoin ordinal inscriptions (Shen et al., 2017). Bitcoin ordinal inscriptions are digital assets created by attaching information to an individual satoshi, the smallest denomination in Bitcoin, through the Ordinals protocol (Shen et al., 2017). Two features are worth noting in this protocol. First, creating an individual ordinal inscription must follow a two-phase procedure: a commit transaction and a reveal transaction (Shen et al., 2017). Thus, both commit and reveal transactions are initiated by the same entity. Second, an ordinal inscription collection consists of a set of individual ordinal inscriptions created by an artist or a group of artists. The parent-child inscription mechanism is utilized to create a collection, with child inscriptions being created exclusively by the owner of the parent inscription, resulting in all children being members of the same collection (Shen et al., 2017). Thus, all ordinal inscriptions of a collection are created by the same entity. In summary, the input addresses of both commit and reveal transactions for each inscription in a collection are controlled by the same entity (see more details in Appendix B.1).

The specific process of the labeling method is given as follows. First, we gather a Bitcoin ordinal inscription collection, defined as \(S=\{o_{1},o_{2},\ldots,o_{n}\}\) with \(n\geq 2\). For each ordinal inscription \(o_{k}\) in \(S\), we identify its corresponding commit transaction \(ctx_{k}\) and reveal transaction \(ctx_{k}\). Next, we extract the input addresses of transaction \(ctx_{k}\) and \(ctx_{k}\) in the range \(1\leq k\leq n\), denoted as \(l_{k}\). Finally, we consider \(\bigcup_{k=0}^{n}l_{k}\) are controlled by the same entity.

For this paper, we gather 20 collections (entities) from the website (Shen et al., 2017) and label 62,971 addresses as the validation dataset. Specific details of the dataset are described in Appendix B.2.

**Validation metrics.** We measure clustering results from two aspects. First, we show the number of entities successfully identified (\(N\)). Second, we evaluate the quality of addresses in each identified entity through four metrics: Precision (\(P\)), Recall (\(R\)), Weighted Precision (\(WP\)), and Weighted Recall (\(WR\)). The first two metrics are commonly used in the study (Bahdanau et al., 2016), while the last two metrics are introduced in the study (Shen et al., 2017). The definitions of these four metrics are as follows, where \(m\) denotes the total number of entities, i.e., 20, and \(E_{i}\) denotes \(i\)th entity. Addresses of \(E_{i}\) are clustered into \(n\) clusters, with \(c_{ij}\) representing the \(j\)th cluster of \(E_{i}\). We denote the union of these clusters as \(C_{i}\). We use the set \(v_{ij}\) to denote the addresses of \(E_{i}\) that are clustered into the cluster \(c_{ij}\). We denote the union of \(v_{ij}\) as \(V_{i}\). \(v_{ij}\) represents the proportion of the set \(c_{ij}\) within entity \(E_{i}\). The greater the number of addresses within a cluster, the more accurately it reflects the characteristics of the entity and, thus, the higher its significance in the clustering results.

\[P=\frac{\sum_{i=1}^{m}|V_{i}|}{\sum_{i=1}^{m}|C_{i}|},\quad R= \frac{\sum_{i=1}^{m}|V_{i}|}{\sum_{i=1}^{m}|E_{i}|}\] \[WP=\frac{1}{m}\sum_{i=1}^{m}\sum_{j=1}^{n}w_{ij}\frac{|w_{ij}|}{| C_{i}|},\quad WR=\frac{1}{m}\sum_{i=1}^{m}\sum_{j=1}^{n}w_{ij}\frac{|w_{ij}|}{|E_{ i}|}\]

where \(v_{ij}=E_{i}\cap c_{ij}\), \(V_{i}=\bigcup_{j=1}^{n}w_{ij}\), \(C_{i}=\bigcup_{j=1}^{n}c_{ij}\), \(w_{ij}=\frac{|c_{ij}|}{|C_{i}|}\).

**Validation results.** Table 2 demonstrates the effectiveness of our proposed clustering heuristics compared to the SOTA clustering heuristics. Our proposed clustering heuristics identify more entities while achieving a precision of over 90%. Notably, our proposed heuristic significantly improves recall. Even in the cases of CS+M and CS+G, where the improvement is the smallest, our proposed clustering heuristics still improve recall by three times. This indicates that our proposed clustering heuristics can uncover many additional address associations that are beyond the scope of the SOTA clustering heuristics. Both weighted precision and weighted recall exhibit a significant improvement, further showing our proposed clustering heuristics can uncover additional address associations and identify more addresses belonging to the same entity. Significantly, the results for both CS+M and CS+G are identical. This is because CS already achieves the exclusion of Coinjoin transactions, which is the sole distinction between CS+G and CS+M.

### Impact Measurement

Building upon the demonstrated effectiveness of our proposed clustering heuristics in Section 4.3, we proceed with measuring their impact on the SC clustering results.

**Settings.** We apply the SOTA clustering heuristics to failed transactions and our proposed clustering heuristics to unconfirmed transactions to uncover additional address associations. When no clustering heuristic is applied, we consider each address in the confirmed transactions between May 1, 2022 and May 31, 2023 as an isolated entity, resulting in a total count of 179,352,220 isolated entities.

**Measurement metric.** We employ the reduced number of entities in the clustering results as the metric to measure the impact of our approach. Suppose the SOTA clustering heuristics cluster addresses of an entity into \(n\) clusters, denoted as \(\{C_{1},C_{2},\ldots,C_{n}\}\) with \(n\geq 2\). Our proposed clustering heuristics produce an additional cluster, denoted as \(C_{n+1}\). If \(C_{n+1}\cap C_{i}\neq\emptyset\) for \(i\) in the range \(1\leq i\leq n\), \(C_{n+1}\) can merge these \(n\) clusters, resulting in a reduced number of entities. It is worth noticing that \(C_{i}\) may contain only one Bitcoin address for \(i\) in the range \(1\leq i\leq n\). Therefore, the reduction in the number of entities reflects the ability of our approach to reduce the error of addresses that should belong to the same entity being clustered into multiple entities.

**Measurement results.** Figure 6(a) shows the impact of failed transactions on the SC clustering results. The SC+SF clustering result has a reduced number of entities compared to the SC clustering result across various SOTA clustering heuristics. Notably, the most

\begin{table}
\begin{tabular}{l c c c c c} \hline \hline Heuristics & N & P(\%) & R(\%) & WP(\%) & WR(\%) \\ \hline CS & 8 & 0.09 & **4.47** & 7.37 & 2.81 \\ CS+NU & 18 & 94.27 & **74.32** & 42.23 & 18.73 \\ \hline CS+A & 10 & 26.89 & **3.93** & 14.11 & 2.85 \\ CS+A-NU & 10 & 94.49 & **95.58** & 35.53 & 18.24 \\ \hline CS+M & 12 & 55.29 & **11.84** & 11.75 & 0.24 \\ CS+M-NU & 15 & 90.29 & **52.04** & 27.89 & 6.23 \\ \hline CS+G & 12 & 55.29 & **11.84** & 11.75 & 0.24 \\ CS+G+NU & 15 & 90.29 & **52.04** & 27.89 & 6.23 \\ \hline CS+E & 9 & 35.43 & **4.96** & 11.96 & 2.81 \\ CS+E+NU & 19 & 94.58 & **73.87** & 42.15 & 18.74 \\ \hline CS+K & 12 & 75.21 & **12.46** & 12.52 & 8.32 \\ CS+K+NU & 16 & 90.43 & **77.53** & 27.72 & 16.28 \\ \hline \hline \end{tabular}
\end{table}
Table 2. Comparison between our proposed clustering heuristics and SOTA clustering heuristics.

significant reduction is observed in the result of the CS heuristic, with a reduction of 1,770,474 entities (2.41% of the total entities). This highlights that failed transactions contain additional address associations that can be uncovered by the SOTA clustering heuristics but are currently ignored.

Figure 6(b) shows the impact of our proposed clustering heuristics on the SC clustering results. The SC+NU clustering result has significantly fewer entities than the SC clustering result across various clustering heuristics. Notably, the CS+M clustering result is the most affected, with a reduction of 9,377,248 entities (21.01% of the total entities). This indicates that our proposed clustering heuristics reveal numerous address associations in unconfirmed transactions that are beyond the scope of the SOTA clustering heuristics.

Figure 6(c) shows the comprehensive impact of both failed transactions and our proposed clustering heuristics on the SC clustering results. The results indicate that a portion of the SF clustering results and NU clustering results exhibit no overlap, further reducing the number of entities. The CS+M clustering result is the most affected, with a reduction of 10,214,920 entities (22.89% of the total entities). Our approach utilizes failed transactions and our proposed clustering heuristics to uncover numerous additional address associations, significantly improving the SC clustering results.

### Temporal Analysis

Considering that the state of a transaction changes over time, and UTP and CTC capture distinct state information about the same transaction at different moments, our approach has varying degrees of impact on the SC clustering results across different periods. In the following, we conduct a monthly temporal analysis of our approach's impact on the SC clustering results in different periods. Moreover, we also measure this impact by the reduced number of entities in the clustering results.

First, as shown in Figure 7, our approach has the most significant impact on the SC clustering results in the current month, and the impact on other months decreases month by month. Notably, we observe that the clustering results of our approach in the current month have a more significant impact on the SC clustering results in the subsequent month compared to the previous month. This is primarily attributed to the fact that unconfirmed transactions collected by UTP in the current month may be confirmed in the subsequent month, thus leading to a more significant impact on the SC clustering results in the subsequent month.

Second, as shown in the diagonal, the impact of our approach exhibits a growing trend over time, indicating its enduring effect. Notably, the impact experiences a significant enhancement in January 2023. Our analysis attributes this phenomenon primarily to the emergence and widespread adoption of Bitcoin ordinal insertions in January 2023 (Mikolov et al., 2013). When users create a collection of ordinal inscriptions, they often utilize unconfirmed transaction dependency chains to create numerous ordinal inscriptions at the same time.

## 5. Discussion

### The impact of Coinjoin transactions on clustering heuristics

Coinjoin transactions render the SOTA clustering heuristics ineffective. However, our proposed clustering heuristics utilize replacement transactions and unconfirmed transaction dependency

Figure 6. Comparison of the number of entities in the SC clustering result and other three clustering results. While an isolated entity contains only one Bitcoin address, a non-isolated entity contains multiple Bitcoin addresses.

Figure 7. Temporal impact of our approach on the SC clustering results.

chains. To ensure timely transaction confirmation, users avoid employing Coinjoin transactions to facilitate operations in both cases. Furthermore, the _replacement transaction_ heuristic identifies the change address definitely, unlike the SOTA clustering heuristics, which may produce false positives.

**False positive of our proposed clustering heuristics.** The _dependency chain_ heuristic may produce false positives under the following specific situation. To accelerate the confirmation of a transaction, the sender transmits the transaction hash and the corresponding UTXO to the recipient before the transaction is confirmed. The recipient then utilizes this UTXO to initiate a new transaction, forming an unconfirmed transaction dependency chain. In this dependency chain, the Bitcoin addresses involved are not controlled by the same entity. However, this situation remains infrequent due to its potential association with unconfirmed transaction attacks, a subtype of double-spend attacks.

**Labeled dataset construction.** With the development of third-party platforms (no-code inscription tools) for Bitcoin ordinal inscriptions, users often use these platforms to create ordinal inscription collections for convenience. In this situation, a third-party platform creates multiple collections on behalf of users. Consequently, all input addresses for the ordinal inscription creation transactions in these collections are controlled by the third-party platform. While this situation introduces certain imperfections into the labeled dataset we construct, the address associations within each entity in our dataset remain accurate. Furthermore, a significant portion of ordinal inscription collections in our dataset are created in the early days when Bitcoin ordinal inscriptions are prevalent, predating the development of third-party platforms. Therefore, our dataset is minimally affected by this situation.

**User privacy leakage in unconfirmed transactions.** The experimental results in Section 4 reveal that unconfirmed transactions can significantly reduce the anonymity of Bitcoin, but it ultimately benefits Bitcoin users by motivating further research into privacy protocols for the mempool. Individuals who are worried about protecting their privacy may opt to cryptocurrencies that prioritize privacy, such as Zcash. However, prior studies demonstrate that even these cryptocurrencies do not guarantee complete anonymity (Kallurkar et al., 2016; Kallurkar et al., 2016).

## 6. Related Work

### Clustering Bitcoin Addresses

Many studies attempt to achieve de-anonymization by proposing various clustering heuristics. The SOTA clustering heuristics can generally be categorized into two main groups: the co-spend heuristic and the change heuristic. The co-spend heuristic, observed in the white paper (Sandvikumar et al., 2016), is applied in many studies (Bahdanau et al., 2015; Kallurkar et al., 2016; Kallurkar et al., 2016; Kallurkar et al., 2016). On the basis of the co-spend heuristic, Kalodner _et al._(Kallurkar et al., 2016) propose to reduce clustering interference caused by Coinjoin transactions. Then, Meiklejohn _et al._(Meiklejohn et al., 2016) and Androulaki _et al._(Bahdanau et al., 2015) propose the change heuristic to determine which transaction output is the address to receive change. Goldfeder _et al._(Goldfeder et al., 2016) and Ermilov _et al._(Ermilov et al., 2016) further refine this heuristic. The change heuristic has been used in multiple studies to track illicit final flows (Kallurkar et al., 2016; Kallurkar et al., 2016; Kallurkar et al., 2016; Kallurkar et al., 2016; Kallurkar et al., 2016; Kallurkar et al., 2016; Kallurkar et al., 2016). Recently, Kappos _et al._(Kappos et al., 2016) consider the transaction pattern _peel chain_ to identify the change address.

There are also studies on analyzing the effectiveness of various clustering heuristics (Bahdanau et al., 2015; Kallurkar et al., 2016; Kallurkar et al., 2016; Kallurkar et al., 2016; Kallurkar et al., 2016; Kallurkar et al., 2016). Cazabet _et al._(Cazabet et al., 2016) highlight that only employing the co-spend heuristic has a relatively low recall but a high precision. Nick _et al._(Nick et al., 2016) assess the accuracy of various clustering heuristics using a ground-truth dataset and find that, on average, over 69% of an entity's addresses could be successfully clustered using only the co-spend heuristic. Zheng _et al._(Zheng et al., 2016) demonstrate that the existing clustering heuristics do not guarantee the comprehensiveness, accuracy, and efficiency of the clustering results. Liu _et al._(Liu et al., 2016) point out that all clustering heuristics rely on confirmed transactions stored in the blockchain. In this paper, we propose two clustering heuristics to uncover additional address associations in unconfirmed transactions.

### Analyzing Bitcoin Mempool

Related studies focus on two issues: predicting the transaction confirmation time and analyzing unconfirmed transactions.

**Predicting the transaction confirmation time.** Many studies (Bahdanau et al., 2015; Kallurkar et al., 2016; Kallurkar et al., 2016; Kallurkar et al., 2016; Kallurkar et al., 2016) propose various methods to estimate the confirmation time. Gundlach _et al._(Gundlach et al., 2015) predict the confirmation time of Bitcoin transactions by modeling the confirmation time as the time to ruin of a Cramer-Lundberg (CL) model. Ko _et al._(Kallurkar et al., 2016) and Zhang _et al._(Zhang et al., 2016) employ machine learning techniques to predict confirmation time of unconfirmed transactions, taking into account various factors such as the confirmation time of historical transactions, block states, and mempool states.

**Analyzing unconfirmed transactions.** Saad _et al._(Saad et al., 2016; Kallurkar et al., 2016) investigate the impact of DDoS attacks on the mempool size and the fees paid by users. Meanwhile, Dae-Yong _et al._(Cazabet et al., 2016) examine the variation of unconfirmed transactions in different mempools through the Jaccard similarity index. They find that unconfirmed transactions in mempools are significantly different when a new block is produced. Kallurkar _et al._(Kallurkar et al., 2016) focus on statistics of failed transactions and the primary reasons for the transaction failure. Furthermore, they point out that the area of failed transactions remains unexplored. To further explore the impact of the mempool on users, we focus on the user privacy disclosed by unconfirmed transactions (including failed transactions) in the mempool, and design clustering heuristics for unconfirmed transactions.

## 7. Conclusion and Future Work

In this paper, we present a practical approach to cluster Bitcoin addresses by combining confirmed and unconfirmed transactions, significantly improving Bitcoin address clustering. The key idea is to explore specific behavior patterns in unconfirmed transactions and propose two novel clustering heuristics for unconfirmed transactions. Then, we construct a labeled dataset based on Bitcoin ordinal insertion to validate the clustering result, and measure the impact of our approach. Experimental results reveal that our proposed clustering heuristics can uncover additional address associations and reduce the error of addresses controlled by the same entity being clustered into multiple entities.

In future, we aim to extend our analysis to other cryptocurrencies based on the UTXO model, such as Litecoin and Dogecoin. We will also analyze the Ethereum mempool and use the mempool data to explore the traceability of funds under the account-balance model.

## References

* (1)
* Androulaki et al. (2013) Elli Androulaki, Ghassan Karame, Marc Roeschlin, Tobias Scherer, and Sethjan Capplan. 2013. Evaluating the Privacy in Bitcoin. In _Proceedings of the 17th International Conference on Financial Cryptography and Data Security__(FC)__(Lecture Notes in Computer Science, Vol. 7859)_. Springer, 34-51.
* Camabet et al. (2017) Henry Camabet, Ryan Bascour, and Matthias Latapy. 2017. Tracking Bitcoin Users Activity Using Community Detection on a Network of Weak Signals. In _Proceedings of the 6th International Conference on Complex Networks and Their Applications__(Complex Networks)__(Studies on Computational Intelligence, Vol. 609)_. Springer, 166-177.
* Chiavalis (2022) Chainalysis. 2022. Chainalysis: The Blockchain Data Platform. [https://www.ch/aimalysis.com/](https://www.ch/aimalysis.com/).
* Conti et al. (2018) Mauro Conti, Sandeep Kumar E, Chahgan Lal, and Sushmha Raj. 2018. A Survey on Security and Privacy Issues of Bitcoin. _IEEE Communications Surveys & Tutorials_ 24, 2 (2018), 3416-3452.
* Dintler (2017) Jesse Dintler. 2017. The Imperfect Crime: How the WannaCry Hackers Could Get Nablhed. [https://www.scientificamerican.com/article/the-imperfect-crime-how-the-wannaver-hakers-could-get-embled](https://www.scientificamerican.com/article/the-imperfect-crime-how-the-wannaver-hakers-could-get-embled).
* Emilov et al. (2017) Dmitry Emilov, Maxim Panov, and Yury Yanovich. 2017. Automatic Bitcoin Address Clustering. In _Proceedings of 16th International Conference on Machine Learning and Applications__(ICMLA)_. IEEE, 641-646.
* Goldfrider et al. (2018) Steven Goldfrider, Harry A Kalodner, Dillon Reisman, and Arvind Narayanan. 2018. When the cookie meets the blockchain: Privacy risks of web payments via cryptosurrencies. _Proceedings on Privacy Enhancing Technologies__2018_, 4 (2018), 179-190.
* Gong et al. (2022) Yuan Gong, Kan-Fu Chow, Hing-Fung Ting, and Siu-Ming Yiu. 2022. Analyzing the Error Rate of Bitcoin Clustering Heuristics. In _Proceedings of the 2022 International Conference on Advances in Digital Forensics__(IPIP)__(IPIP)__(Advances in Information and Communication Technology, Vol. 653)_. Springer, 187-205.
* Greenberg (2021) Andy Greenberg. 2021. Prospectore Trace $13.4M in Bitcounts from the Silk Road to Uth District's Lappte. [https://www.world.com/2015/01/prosecure-trace-13-4-million-bitcoin-index-multiplex-lappte](https://www.world.com/2015/01/prosecure-trace-13-4-million-bitcoin-index-multiplex-lappte).
* Gullback et al. (2021) Rowel Gullback, Martin Gygiysen, David T. Koops, and Jacques Resing. 2021. Predicting confirmation times of Bitcoin transactions. _ACM SIGMETRICS Performance Evaluation Review_ 48, 4 (2021), 16-19.
* Paradise and Todd (2015) David A. Paradise and Peter Todd. 2015. Opin-full Evidence-by-Free Signaling. [https://github.com/bitcoin/bitcoin-history-of-the-015-dimeslawful-briefs/](https://github.com/bitcoin/bitcoin-history-of-the-015-dimeslawful-briefs/).
* Harrison and Fetter (2016) Martin Harrison and Christoph Fetter. 2016. The Unreasonable Effectiveness of Address Clustering. In _Proceedings of the 2016 International Conference on Ubiquitous Intelligence & Computing, Advanced and Trusted Computing, Scalable Computing and Communications, Cloud and Big Data Computing, Internet of People, and Smart World Congress__(UIC/ATC/ScalCom/CBDCom/IoIP/SmartWorld)_. IEEE, 368-373.
* Huang et al. (2018) Danny Yuxing Huang, Maxwell Matthias Alipouilla, Vector Guo Li, Luca Invernizzi, Elie Burstein, Kyle Melbbers, Jonathan Levin, Kirill Levchenko, Alex C. Snoeren, and Damon Mackey. 2018. Tracking Bankroom: End-to-end, In _Proceedings of the 39th IEEE Symposium on Security and Privacy__(S&P)_. IEEE, 618-631.
* Huang et al. (2014) Danny Yuxing Huang, Hitesh Dhamadossari, Sarah Meklejohn, Vacha Dave, Chris Grave, Damon McCoy, Stefan Savage, Nicholas Weaver, Alex C. Snoeren, and Kruill Levchenko. 2014. Bitcoin: Mentiecting Social Cycles. In _Proceedings of the 21st Annual Network and Distributed System Security Symposium__(NDSS)_. The Internet Society.
* Hochrain (2022) Blockchain.com Inc. 2022. The world's most popular way to buy, sell, and trade cryptofts. [https://www.blockchain.com/](https://www.blockchain.com/).
* Shridharli and Chandavarkar (2022) Harish Shridharli and R. R. Chandavarkar. 2022. Unconfirmed Transactions in Cryptocurrency: Reasons, Statistics, and Mitigation. In _Proceedings of 2022 International Conference on Public Key Infrastructure and its Applications__(PKII)_. IEEE, 1-7.
* Kalodner et al. (2020) Harry A. Kalodner, Mathee Moser, Kevin Lee, Steven Goldfrider, Martin Plattner, Alishah Chador, and Arvind Narayanan. 2020. BlockSci: Design and applications of a blockchain analysis platform. In _Proceedings of the 29th USENIX Security Symposium__(USENIX Security)_. USENIX Association, 2712-2738.
* Kappas et al. (2018) George Kappas, Razoran Yousaf, Mary Muller, and Sarah Meklejohn. 2018. An Empirical Analysis of Anonymity in Zecah. In _Proceedings of the 27th USENIX Security Symposium__(USENIX Security)_. USENIX Association, 663-477.
* Kappas et al. (2022) George Kappas, Razoran Yousaf, Bainer Stink, Sofia Rollett, Bernhard Hushofter, and Sarah Meklejohn. 2022. How to Feel a Million: Validating and Expanding Bitcoin Clusters. In _Proceedings of the 31th USENIX Security Symposium__(USENIX security)_. USENIX Association, 2207-2223.
* Kim et al. (2020) Dave-Tong Kim, Mezyem Essaid, and Hongtael Ju. 2020. Examining Bitcoin memposible Ubose Based Consistently Index. In _Proceedings of the 21st Asia-Pacific Network Operations and Management Symposium__(AIMOS)_. IEEE, 287-290.
* Ko et al. (2019) Kyunghkan Ko, Tareyed Jeong, Sajan Maharjan, Chachyeon Lee, and James Wen-Ki Hong. 2019. Prediction of Bitcoin Transactions included in the Nest Block. In _Proceedings of the 1st International Conference on Blockchain and Trustworthy Systems__(BiosICS)__(Communications in Computer and Information Science, Vol. 1158)_. Springer, 591-597.
* Kumar et al. (2017) Amrit Kumar, Clement Fischer, Shruti Tople, and Prateek Saxena. 2017. A Traceability Analysis of Monroe's Blockchain. In _Proceedings of the 22nd European Symposium on Research in Computer Security__(ESORICS)__(Lecture Notes in Computer Science, Vol. 1409)_. Springer, 153-173.
* Li et al. (2019) Yang Li, Zili Liu, and Zihin Zheng. 2019. Quantitative Analysis of Bitcoin Transferred in Bitcoin Exchange. In _Proceedings of the 1st International Conference on Blockchain and Trustworthy-Systems__(BICS)__(Communications in Computer and Information Science, Vol. 1156)_. Springer, 549-562.
* Liu et al. (2016) Kevin Liu, Zinhao Zhang, Adam Dong, and Gail-Pon Ahn. 2016. Behind closed doors: measurement and analysis of Cryptol-leader reasons in Bitcoin. In _Proceedings of the 2016 APW CoNPOS__(in Electronic Crime Research (GCME)_. IEEE, 1-13.
* Lu et al. (2023) Feng Lu, Zhizhan Li, Kun Jia, Panwei Xiang, Aimin Zhou, Jiayin Qi, and Zhibin Li. 2023. Bitcoin Address Clustering Based on Change Address Improvement. _IEEE Transactions on Computational Social Systems_ (2023), 1-12.
* Lombrohn et al. (2015) Eric Lombrohn, Johnson Lau, and Pieter Wulle. 2015. Vegetable Witness (Consensus layer). [http://github.com/bitcoin/bitcoin/bitcoin-threadkit/](http://github.com/bitcoin/bitcoin/bitcoin-threadkit/).
* Maswell (2013) Greg Maswell. 2013. CoinJibm: Bitcoin privacy for the real world. [https://bitcoi.mio/dee/e2024-02942](https://bitcoi.mio/dee/e2024-02942).
* Nideki et al. (2013) Sarah Nideki, Marjori Panuaro, Grant Jordan, Kirill Levchenko, Damon McCoy, Geoffrey M. Voelker, and Stefan Savage. 2013. A fistful of bitcoins: characterising payments among min with no names. In _Proceedings of the 2013 Internet Measurement Conference__(IMC)_. ACM, 127-140.
* Moore and Narayanan (2022) Mike Moore and Arvind Narayanan. 2022. Reinterviewing Address Clustering in Bitcoin. In _Proceedings of the 26th International Conference on Financial Cryptography and Data Security__(PC)__(Lecture Notes in Computer Science, Vol. 13411)_. Springer, 386-403.
* Nakamura (2009) Satoshi Nakamura. 2009. Bitcoin: A peer-to-peer electronic cash system. [https://bitcoins.org/bitcoin.pdf](https://bitcoins.org/bitcoin.pdf).
* Nideki (2015) Jason-David Nideki. 2015. Data-Driven De-Anonymization in Bitcoin. In _Master's__(IEEE'15)_.
* Nideki (2020) United States Department of Justice. 2020. Global Disruption of Three Terror Finance Cyber-Enabled Campaigns. [https://www.justice.gov/ap/pr/global-disruption-three-torror-finance-cyber-enabled-campaigns](https://www.justice.gov/ap/pr/global-disruption-three-torror-finance-cyber-enabled-campaigns).
* Ormi et al. (2014) OrioltaiNohri, Ossenay, Terencek. & Analyze Bitcoin Ordinals. [https://www.ordalnibus.com/](https://www.ordalnibus.com/).
* Paquet-Closston et al. (2019) Masaru Paquet-Closston, Bernhard Hashofter, and Benoit Dupont. 2019. Ram-sonware payments in the Bitcoin ecosystem. _Journal of Cybersecurity_ 5, 1 (2019), v1008.003.
* Paquet-Closston et al. (2019) Masaru Paquet-Closston, Matteo Romiti, Bernhard Hashofter, and Thomas Charvel. 2019. Spams meet Cryptocurrencies: Sortration in the Bitcoin Ecosystem. In _Proceedings of the ACM Conference on Advances in Financial Technologies__(AFT)_. ACM, 76-88.
* Pontoff et al. (2017) Rebecca S. Pontoff, Danny Yuxing Huang, Perinvalle Doerfler, Saha Afror, and Damon McCoy. 2017. Backpage and Bitcoin: Uncovering Human Traffekers. In _Proceedings of the 23rd International Conference on Knowledge Discovery and Data Mining__(SIGKDD)_. ACM, 1595-1604.
* Reid and Harrigan (2011) Fergdi Reid and Martin Harrigan. 2011. An Analysis of Anonymity in the Bitcoin System. In _Proceedings of the 21st International Conference on Privacy, Security, Risk and Trust__(POSASAT)_. IEEE, 1318-1326.
* Rodemur (2002) Casey Rodemur. 2002. Optimal Numbers. [https://github.com/ardinals/ord/blob/master/lip/imperfect-invalid](https://github.com/ardinals/ord/blob/master/lip/imperfect-invalid).
* Said et al. (2019) Mohammad Soad, Laurent Nillis, Charles A. Kanhoua, Jongbren Kim, Danellun Nyang, and Aziz Mohsen. 2019. Memorpolization for Defending Against DDS Attacks in PoW-based Blockchain Systems. In _Proceedings of the 2019 International Conference on Blockchain and Cryptocurrency__(CBC)_. IEEE, 285-292.
* Saad et al. (2018) Muhammad Saad, My T. Thal, and Aixa Mohasan. 2018. POSTER: Detering DIDS Attacks on Blockchain-based Cryptocurrencies through Memory Compression. In _Proceedings of the 2018 on Asia Conference on Computer and Communications Security__(AIMOS)_. ACM, 809-811.
* Spankovic et al. (2014) Michele Spankovic, Federico Muggi, and Stefano Zanera. 2014. Bitdodine: Extracting Intelligence from the Bitcoin Network. In _Proceedings of the 18th International Conference on Financial Cryptography and Data Security__(PC)__(Lecture Notes in Computer Science, Vol. 843)_. Springer, 457-468.
* Tooper et al. (2021) Tooper, Rowel Gundlach, and Shelah Kapodinia. 2021. Robustness analysis of Bitcoin confirmation times. _ACM SIGMETRICS Performance Evaluation Review_ 48, 4 (2021), 20-23.
* Wang et al. (2022) Kai Wang, Junfeng, Dingjie Chen, Yu Zhao, Duqeng Huang, Chen, and WeiL Han. 2022. A large-scale Empirical Analysis of Passomware Activities in Bitcoin. _ACM Transactions on the Web_ 16, 2 (2022), 71-72.
* Wang and Yu (2023) Qin Wang and Guanglieng Yu. 2023. Understanding BRC-20: Hope or Hype. (2023).
* Wang et al. (2018) Yunpeng Wang, Jin Yang, Tao Li, Fangdong Zhu, and Xiangjun Zhou. 2018. Anti-dust: A method for identifying and preventing Blockchain's data attacks. In_Proceedings of the 2018 International Conference on Information Systems and Computer Aided Education (ICBC)_. IEEE, 274-280.
* [146] Peter Wulle, Jonas Nick, and Anthony Towns. 2020. Tapport: SegWi version 1 spending rules. [https://github.com/bitcoin/big-blob/master/big-034.mediawiki.io](https://github.com/bitcoin/big-blob/master/big-034.mediawiki.io)
* [147] Haaron Yousaf, George Kappas, and Sarah Meiklejohn. 2019. Tracing Transactions Across Cryptocurrency Letters. In _Proceedings of the 28th USENIX Security Symposium (USENIX Security)_. USENIX Association, 837-856.
* [148] Linzeng Zhang, Rui Zhong, Qin Li, Jai Xie and Christofi Liu. 2021. Transaction Confirmation Time Estimation in the Bitcoin Blockchain. In _Proceedings of the 22nd International Conference on Web Information Systems Engineering (WISE)_. _Lecture Notes in Computer Science_, Vol. 13081, Springer, 30-45.
* [149] Linzeng Zhang, Rui Zhong, Qin Li, Jai Xie and Chengfei Liu. 2022. Bitcoin Transaction Confirmation Time Prediction: A Classification View. In _Proceedings of the 23rd International Conference on Web Information Systems Engineering (WISE)_ (_Lecture Notes in Computer Science_, Vol. 13724_). Springer, 155-169.
* [150] Baoban Zheng, Liekuang Zhu, Jiang Shen, Xiaoliang Du, and Mohsen Guizani. 2020. Identifying the vulnerabilities of bitcoin anonymous mechanism based on address clustering. _Science China Information Sciences_ 63, 3 (2020), 1-15.

## Appendix A Case Studies

Although unconfirmed transactions or even failed transactions are not stored in the blockchain, they still reveal the motivations behind why users initiate these transactions. This information is highly valuable for analyzing transaction behaviors. In this section, we demonstrate the utility of failed transactions in analyzing transaction behaviors through two case studies.

### Binance Exchange Address Analysis

One of the main safeguards used by Bitcoin exchanges to prevent attacks is the use of cold and hot storage technology, with carefully designed risk control systems [23].

There are three main types of addresses controlled by Bitcoin exchanges: hot wallet addresses, cold wallet addresses, and user wallet addresses. The primary function of the hot wallet is to maintain a bitcoin pool for the user's withdrawal demand. The user wallet address is created by the Bitcoin exchange and the private key of the address is held by the Bitcoin exchange. Users can deposit bitcoins to Bitcoin exchange by the user wallet address.

Figure 8 shows a failed transaction related to the Binance exchange, a confirmed transaction to replace the failed transaction, and another two confirmed transactions related to Binance exchange. The address _bc1q...7s3h_ is labeled with the Binance exchange by Blockchain.com [15]. When the transaction _66c1...9dc6_ is confirmed, the transaction _dc4s.6f51_ is initiated to transfer bitcoins in the address _bc1q...wtwq_ to Binance exchange address. Three minutes after the transaction _dc4s.6f51_ is initiated, the same user initiates the transaction _4161...bb25_. The second transaction spends the same UTXO as the first transaction but pays a much higher fee. As a result, miners choose the second transaction to pack into a block that is eventually confirmed. The transaction _dc4s...ef51_ turns out to be a failed transaction that is removed by all Bitcoin nodes and can never be confirmed again. Then, another transaction _6903...4583_ is initiated with 100 inputs and 1 output, which transfers bitcoins in the address _19Fa...Ht5X_ to the address _bc1q...7s3h_.

From the content of the transaction _dc4s...ef51_ and transaction _6903...4583_, the purpose of the address _bc1q...wtwq_ is to transfer its bitcoins to the address _bc1q...7s3h_. A question worth analyzing is why the user would replace the transaction _dc4s...ef51_ with the second one _4161...bb25_.

To answer this question, we investigate 127 confirmed transactions involving the address _bc1q...wtwq_. All outgoing transactions of the address _bc1q...wtwq_ consist of one input and one output. When the address _bc1q...wtwq_ transfers bitcoins to other addresses, the recipient address is always the address _19Fa...Ht5X_. Then, the address _19Fa...Ht5X_ transfer bitcoins to the address _bc1q...7s3h_. Both incoming and outgoing transactions of the address _bc1q...wtwq_ occur in pairs, i.e., the address receives bitcoins and then transfers out all the bitcoins it receives. Therefore, we infer that the transaction _dc4s...ef5_ was a mistake by the Binance exchange. Address _bc1q...7s3h_ is a hot wallet address of Binance exchange, and under the rules of Binance exchange, address _bc1q_ cannot transfer bitcoins directly to address _bc1q...7s3h_. Therefore, when the transaction _dc4s...ef51_ was initiated, the operator or script discovered the misoperation and initiated another high-fee transaction _4161...bb25_ to replace the first one.

As seen from the above discussion, the addresses controlled by the Binance exchange have distinct roles and perform specific responsibilities. The Binance exchange carefully plans the transaction relationships among addresses to prevent the casual transfer of bitcoins among them.

Through analysis of unconfirmed transactions, we can shed light on the Binance exchange's internal risk prevention and control mechanisms, and can assist regulators in verifying the cryptocurrency exchange's reported information and inadvertently disclosed transfer behavior.

### Potential Dust Attacks Against Whale Addresses

The dust attack is defined as malicious behavior targeting Bitcoin users and privacy by sending tiny amounts of bitcoins to victims' addresses [45]. The aim of the dust attacker is to reveal the user's identity by collecting information on where these tiny amounts are combined when the user initiates a new transaction through their cryptocurrency wallet software. The attackers track the transaction activity of these addresses in an attempt to link the dusted addresses and identify the person or company behind them [45].

Figure 9 shows a potential dust attack against whale addresses found in a failed transaction. Figure 9 contains two confirmed transactions and one failed transaction. In this scenario, the transaction _3180...362_ is first initiated with two inputs and two outputs. When this transaction is confirmed, the address _1KgX...T2Q_ transfers its expected bitcoins to the address _1FU6...8hKf_ through the transaction _496e...9ce3_. We cannot find anything unusual about this address _1KgX...T2Q_ from confirmed transactions.

However, before the transaction _496e...9ce3_ is initiated, the transaction _1f25...bb25_ is first initiated. These two transactions spend the same UTXO _1KgX...T2Q_. Due to the much higher fee of the transaction _496e...9ce3_, miners choose the transaction _496e...9ce3_ to package into a block that eventually is confirmed. Therefore, the transaction _f125...6b94_ turns out to be a failed transaction. However, the failed transaction _f125...6b94_ reflects the malicious behavior of the user that is not presented in confirmed transactions.

More specifically, the transaction _f125...6b94_ has one input and 9 outputs. It is noteworthy that all 8 outputs of this transaction have the same revenue, i.e. 0.00000666 BTC ($ 0.12). The remainingoutput is the same as the sender and is the change address of the sender. The address _be1q__-_wexzt_, _be1q__9hz6_ and _lFeac__-_b6uF_ are labeled with _FBIS_, _FB12 (Silk Road)_ and _MitGox Hacker_ respectively by Blockchain.com [15]. The stolen bitcoins of the Bitfinex Hack 2016 continue to converge to the address _bc1q__-_wext_ that currently has a balance of more than 94,643 BTC without any transfers out. Nearly 70,000 BTC confisted by the U.S. government from the black market site _Silk Road_ are transferred to the address _bc1q__-_b7hz6_ in early November, 2020. As of this writing, the bitcoins have not been moved or liquidated. Former Mt.Gox CEO Mark Karpeles confirmed that the bitcoins residing at the address _lFeac__-_b6uF_ were stolen from the Mt.Gox exchange. The address _lF5Z__-_b7hjG_ is controlled by the FTX exchange which declared bankruptcy on November 14, 2022. The other addresses except _1FU_6__-_shkf_ also have a large balance when this failed transaction _f125__-_b6u9a_ is initiated. Currently, the balance of the address _3CkU__-_wz5M_ is 0. But, the balance of the address _3CkU__-_wz5M_ is more than 50,620 BTC when the failed transaction _f125__-_b6u9a_ is initiated. Therefore, the address _IKqX__-_JYEQ_ sends a very small amount of bitcoins to multiple whale addresses via the transaction _f125__-_b6u9a_, with the purpose of a dust attack.

Focusing only on confirmed transactions in the blockchain fails to uncover hidden users' intentions. On the one hand, unconfirmed transactions can also be used to identify malicious behavior that cannot be identified by confirmed transactions alone. On the other hand, unconfirmed transactions allow for the identification of malicious behavior before it takes place.

## Appendix B Bitcoin ORDIAL INSCRIPTION

### Detailed reasons for the effectiveness of the labeling method

Since taproot script spends can only be made from existing taproot outputs [46], inscriptions are created using a two-phase commit/reveal procedure. First, a taproot output is created in the commit transaction, committing to a script that contains the inscription content. Second, the reveal transaction spends the output of the commit transaction, revealing the inscription content in the blockchain.

To make an inscription a child of another, the parent inscription has to be inscribed and present in the wallet. Users use an inscription as an input in the reveal transaction, designating it as the parent of the new inscription. For a root to be acknowledged as the parent of a new inscription, the inputs of the reveal transaction should contain the parent inscription, thereby proving that the creator of the child inscription controls the parent inscription.

### Validation dataset

Our collection consists of 20 Bitcoin ordinal inscription collections, as shown in Table 2. These collections are created between February and May 2023, during the early phase of Bitcoin ordinal inscription development. The earliest collection _Familiar Fronts_ in our dataset emerges in February 2023, with over two-thirds of these collections created from February to April 2023. Of these 20 collections, most contain hundreds to thousands of addresses, while a few contain about 10,000 addresses each.

In these collections, there is only one input address in reveal transactions for each ordinal inscription. Moreover, entities have the option to reuse addresses when creating ordinal inscriptions. For instance, the creator of the _ibClub Pass_ collection uses 21 addresses to create 500 ordinal inscriptions.

Figure 8. Binance exchange address analysis.

\begin{table}
\begin{tabular}{l c|l c} \hline \hline
**Name** & **Number** & **name** & **Number** & 1229 \\ \hline DagePunkts & 11,596 & Battle of BTC & 11,318 & 1248 \\ BTC Virus & 9,993 & Bucks & 10,024 & 1285 \\ Bitcoin Crypto DickButts & 8,195 & Mesh Beutless & 3,305 & 1286 \\ OrdiMarks & 2,317 & Boss & 1,819 & 1207 \\
420 Rabbits & 1,192 & Block Gods & 1,049 & 1289 \\ Tapprot Cows & 557 & Fact Parals Warts & 399 & 1288 \\ STARRBEIDER & 374 & NetCitesSkill & 354 & 1289 \\ Cahie A: Kaz Marquis & 196 & Familiar Fronts & 169 & 1289 \\ Mago & 110 & Ordinal Cat Warrators & 102 & 1289 \\
107 Islands & 101 & LibClub Pass & 21 & 1289 \\ \hline \hline \end{tabular}
\end{table}
Table 3. Number of addresses per collection that we collect.

Figure 9. Potential dust attack against whale addresses.